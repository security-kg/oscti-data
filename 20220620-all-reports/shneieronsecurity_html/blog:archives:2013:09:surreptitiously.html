<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>Surreptitiously Tampering with Computer Chips - Schneier on Security</title>
	<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Feed" href="https://www.schneier.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Comments Feed" href="https://www.schneier.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Surreptitiously Tampering with Computer Chips Comments Feed" href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/feed/" />
<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='schneier-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/style.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='schneier-main-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/dist/css/style.css?ver=1.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.5.2/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js?ver=3.5.1' id='jquery-js'></script>
<link rel="https://api.w.org/" href="https://www.schneier.com/wp-json/" /><link rel="alternate" type="application/json" href="https://www.schneier.com/wp-json/wp/v2/posts/5012" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.schneier.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.schneier.com/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html" />
<link rel='shortlink' href='https://www.schneier.com/?p=5012' />
<link rel="alternate" type="application/json+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2013%2F09%2Fsurreptitiously.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2013%2F09%2Fsurreptitiously.html&#038;format=xml" />
	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
	<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-32x32.png" sizes="32x32" />
<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-180x180.png" />
<meta name="msapplication-TileImage" content="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			#schneier_promotion-2 img {
    max-width: 180px;
}		</style>
		</head>

<body class="post-template-default single single-post postid-5012 single-format-standard theme-schneier woocommerce-no-js">

	<div id="wrapper">
		<div id="main">

			<header>
				<div id="header">
					<h1>
						<a href="https://www.schneier.com/" rel="home">
							Schneier on Security						</a>
					</h1>
				</div>
			</header>

			<nav>
				<div class="nav" id="header-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-50175" class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li id="menu-item-50916" class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li id="menu-item-50166" class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li id="menu-item-50169" class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li id="menu-item-50170" class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li id="menu-item-50171" class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li id="menu-item-50167" class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li id="menu-item-50174" class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>

			
<aside>
	<div class="sidebar" id="sidebar-one">
		<section><div class="sidesection widget widget_schneier_search" id="schneier_search-3"><h3>Search</h3>
<p class="small">
	<em>Powered by <a href="https://duckduckgo.com/">DuckDuckGo</a></em></p>

<form method="get" action="https://duckduckgo.com/">

	<input type="hidden" name="kh" value="1" /><!-- use https -->

	<input id="search" name="q" size="15" maxlength="255" />

	<input type="submit" value="Go" /><br>

	<input type="radio" name="sites" id="searchblog" value="www.schneier.com/blog" />
	<label for="searchblog">Blog</label>

	<input type="radio" name="sites" id="searchessays" value="www.schneier.com/essays" />
	<label for="searchessays">Essays</label>

	<input type="radio" name="sites" id="searchall" value="www.schneier.com" checked="" />
	<label for="searchall">Whole site</label>

</form>
</div></section><section><div class="sidesection widget widget_schneier_social" id="schneier_social-2"><h3>Subscribe</h3>
<div id="subscription-buttons">

	<a href="https://www.schneier.com/feed/atom"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/rss-32px.png" alt="Atom Feed" /></a><a href="https://www.facebook.com/bruce.schneier"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/facebook-32px.png" alt="Facebook" /></a><a href="https://twitter.com/schneierblog/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/twitter-32px.png" alt="Twitter" /></a><a href="https://www.amazon.com/Schneier-on-Security/dp/B0053HDDWW/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/kindle-32px.png" alt="Kindle" /></a><a href="https://www.schneier.com/crypto-gram"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/email-32px.png" alt="E-Mail Newsletter (Crypto-Gram)" /></a>
</div>
</div></section>	</div>
</aside>

			<div id="content">

				
		<p id="breadcrumbs">

			<a href="https://www.schneier.com">Home</a><a href="https://www.schneier.com/blog/archives/">Blog</a>		</p>

		
<article id="post-5012" class="post-5012 post type-post status-publish format-standard hentry category-uncategorized tag-academic-papers tag-hardware tag-intel tag-nsa tag-random-numbers tag-security-engineering tag-tamper-detection">

	<div class="article">

		<h2 class="entry">Surreptitiously Tampering with Computer Chips</h2>
		<p>This is really interesting research: &#8220;<a href="http://people.umass.edu/gbecker/BeckerChes13.pdf">Stealthy Dopant-Level Hardware Trojans</a>.&#8221; Basically, you can tamper with a logic gate to be either stuck-on or stuck-off by changing the doping of one transistor.  This sort of sabotage is undetectable by functional testing or optical inspection.  And it can be done at mask generation &#8212; very late in the design process &#8212; since it does not require adding circuits, changing the circuit layout, or anything else.  All this makes it <i>really</i> hard to detect.</p>
<p>The paper talks about several uses for this type of sabotage, but  the most interesting &#8212; and devastating &#8212; is to modify a chip&#8217;s random number generator.  This technique could, for example, reduce the amount of entropy in Intel&#8217;s hardware random number generator from 128 bits to 32 bits.  This could be done without triggering any of the built-in self-tests, without disabling any of the built-in self-tests, and without failing any randomness tests.</p>
<p>I have no idea if the NSA convinced Intel to do this with the hardware random number generator it embedded into its CPU chips, but I do know that it could.  And I was always leery of Intel strongly pushing for applications to use the output of its hardware RNG directly and not putting it through some strong software PRNG like <a href="https://en.wikipedia.org/wiki/Fortuna_%28PRNG%29">Fortuna</a>. And now Theodore Ts&#8217;o <a href="https://plus.google.com/117091380454742934025/posts/SDcoemc9V3J">writes</a> this about Linux: &#8220;I am so glad I resisted pressure from Intel engineers to let /dev/random rely only on the RDRAND instruction.&#8221;</p>
<p>Yes, this is a conspiracy theory.  But I&#8217;m not willing to discount such things anymore.  That&#8217;s the worst thing about the NSA&#8217;s actions.  We have <a href="https://www.schneier.com/essay-435.html">no</a> <a href="https://www.schneier.com/essay-447.html">idea</a> whom we can trust.</p>

		
			<p class="entry-tags">
				<span class="tags-links">Tags: <a href="https://www.schneier.com/tag/academic-papers/" rel="tag">academic papers</a>, <a href="https://www.schneier.com/tag/hardware/" rel="tag">hardware</a>, <a href="https://www.schneier.com/tag/intel/" rel="tag">Intel</a>, <a href="https://www.schneier.com/tag/nsa/" rel="tag">NSA</a>, <a href="https://www.schneier.com/tag/random-numbers/" rel="tag">random numbers</a>, <a href="https://www.schneier.com/tag/security-engineering/" rel="tag">security engineering</a>, <a href="https://www.schneier.com/tag/tamper-detection/" rel="tag">tamper detection</a></span>			</p>

		
		
		<p class="posted">
			<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html" rel="bookmark">Posted on September 16, 2013 at 1:25 PM</a>			â€¢
			<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html#comments">242 Comments</a>		</p>

		<aside><div class="schneier-share share" data-uri="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html" data-title="Surreptitiously Tampering with Computer Chips" data-order="facebook twitter tumblr" data-social-share-privacy="true" /></aside>
	</div>

</article>


	<h3 id="comments">Comments</h3>

	
		<article class="comment even thread-even depth-1" id="comment-204406">

			<div class="comment by-nicholas-weaver ">

				<p class="commentcredit">

					<span class="commenter">Nicholas Weaver</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204406">
						September 16, 2013 1:48 PM					</a>

				</p>

				<p>One bit of subtleness is the effect of the design decision by Intel to <b><i>not</i></b> to include the tRNG in the JTAG chain (a test feature that allows reading/setting portions of the chip), but only use a Built In Self Test (BIST) based on a 32b CRC.</p>
<p>The BIST is &#8220;replace tRNG with LFSR (Linear Feedback Shift Register) known pRNG on the input, cycle the output, and do a 32b CRC checksum on the results&#8221;.  Thus one brute-forces the constants so that it passes the BIST CRC test(s), since the test input is known, and with only 32b of CRC, brute force will find an answer.</p>
<p>Intel did this BIST-only because:</p>
<blockquote><p>
If there is a BIST failure during startup, the DRNG will refuse to issue random numbers and will issue a BIST failure notification to the on-chip test circuitry. This BIST logic avoids the need for conventional on-chip test mechanisms (e.g., scan and JTAG) that could undermine the security of the DRNG.
</p></blockquote>
<p><a href="http://software.intel.com/en-us/articles/intel-digital-random-number-generator-drng-software-implementation-guide" rel="nofollow ugc">http://software.intel.com/en-us/articles/intel-digital-random-number-generator-drng-software-implementation-guide</a></p>
<p>On one hand, that makes sense-ish: JTAG on the INPUT (the ability to tie into the more general test chip framework rather than just a known initiated LFSR) to the hardware RNG would be questionable, as it would be easy to hijack.  (Although given the microcode design on modern microprocesors, you could also possibly hijack RDRAND with alternate microcode).</p>
<p>But at the same time, there is no way to read the whole output with JTAG (which would prevent these &#8216;stuck-bit&#8217; attacks from working), yet such a connection would prevent this attack from working.</p>
<p>Three months ago, my attitude would be &#8216;yeah, makes sense as a tradeoff to do this BIST design, pity you can trojan it.&#8217;.</p>
<p>Today?  Paranoia is infectious: its a great example of the corrosive damage that the NSA has done to US cyber-security.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204407">

			<div class="comment by-gareth-owen ">

				<p class="commentcredit">

					<span class="commenter">Gareth Owen</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204407">
						September 16, 2013 1:52 PM					</a>

				</p>

				<p>We need to examine intel&#8217;s RNG more closely.  Maybe we need more effective ways of evaluating RNGs in a black-box implementation &#8211; although my feeling is this has been explored without great success.</p>
<p>Intel&#8217;s RNG is clearly suspect now &#8211; but until we can test it then what can we do?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204408">

			<div class="comment by-nicholas-weaver ">

				<p class="commentcredit">

					<span class="commenter">Nicholas Weaver</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204408">
						September 16, 2013 1:55 PM					</a>

				</p>

				<p>I suspect that the chip reverse-engineers are frantically adding techinques to determine the doping on transistors.  But its a very hard problem, because in addition to being a late-bound attack, this can be done with just TWO different masks that are corrupted, so it would be quite reasonable for an attacker in the fab to produce a small batch of trojaned chips.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204409">

			<div class="comment by-smc ">

				<p class="commentcredit">

					<span class="commenter">smc</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204409">
						September 16, 2013 2:01 PM					</a>

				</p>

				<p>Is this open to test? I don&#8217;t have the maths, but can you generate a whole pile of random numbers out of the stock intel method and measure the entropy in some way?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204410">

			<div class="comment by-steven ">

				<p class="commentcredit">

					<span class="commenter">Steven</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204410">
						September 16, 2013 2:20 PM					</a>

				</p>

				<p>LavaRand, anyone?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204411">

			<div class="comment by-steven ">

				<p class="commentcredit">

					<span class="commenter">Steven</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204411">
						September 16, 2013 2:36 PM					</a>

				</p>

				<p>Back when the NSA was pushing the Clipper chip, they were getting pushback, and one of the objections was that the whole design was secret. So at one point they briefed someone on the design, who was then allowed to report some details to the rest of the community.</p>
<p>One thing I remember is that the design included an RNG, and it was not a hardware RNG. It was a software RNG, the NSA explained, &#8220;because software can be audited.&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204412">

			<div class="comment by-alyssa ">

				<p class="commentcredit">

					<span class="commenter">Alyssa</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204412">
						September 16, 2013 2:48 PM					</a>

				</p>

				<p>can&#8217;t trust software.<br />
can&#8217;t trust firmware.<br />
can&#8217;t trust hardware.<br />
argh.</p>
<p>p.s. kudos for spelling &#8220;Surreptitiously&#8221; !</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204413">

			<div class="comment by-curious ">

				<p class="commentcredit">

					<span class="commenter">Curious</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204413">
						September 16, 2013 2:52 PM					</a>

				</p>

				<p>@smc</p>
<p>I&#8217;m a curious on that part too. This is the NIST standard they claim to foil but they don&#8217;t explain how.</p>
<p><a href="http://csrc.nist.gov/publications/nistpubs/800-22-rev1a/SP800-22rev1a.pdf" rel="nofollow ugc">http://csrc.nist.gov/publications/nistpubs/800-22-rev1a/SP800-22rev1a.pdf</a></p>
<p>Now, to be fair, even if the chip fails you wouldn&#8217;t necessarily know if it was a trojan or simply a bad chip but I don&#8217;t think one would care either, just replace it.</p>
<p>I think they need to substantiate the claim that they can defeat the NIST standard more thoroughly.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204414">

			<div class="comment by-nobodyspecial ">

				<p class="commentcredit">

					<span class="commenter">nobodyspecial</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204414">
						September 16, 2013 3:05 PM					</a>

				</p>

				<p>@smc &#8211; not on a single chip.<br />
I can produce a perfectly randomly distributed stream of numbers &#8211; but I know what they are, so I know the next one in the sequence.</p>
<p>Presumably you could do an analysis of a sufficiently large number of chips and see if they are correlated. But you don&#8217;t know if the RNG&#8217;s NSA mode only turns on in those chips sold to China, or to the CIA, or on MacBooks or only when running specific encryption packages or versions of a specific OS.<br />
And since these chips have downloadable microcode updates the feature could be enabled/disabled at any time.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204415">

			<div class="comment by-nicholas-weaver ">

				<p class="commentcredit">

					<span class="commenter">Nicholas Weaver</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204415">
						September 16, 2013 3:34 PM					</a>

				</p>

				<p>The chip wouldn&#8217;t fail the NIST testing because things go through AES first, so it looks random until you collect greater than the # of bits of actual entropy.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204416">

			<div class="comment by-gonzo ">

				<p class="commentcredit">

					<span class="commenter">gonzo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204416">
						September 16, 2013 3:35 PM					</a>

				</p>

				<p>I find this discussion fascinating in the context of hopes, expressed by some in earlier threads, of ditching 8086 legacy devices in favor of CPUs that operate on a much higher level of abstraction.</p>
<p>There seems to be an inherent tension there.</p>
<p>We can write a program that operates on &#8220;DOS&#8221; using 386 era hardware that can generate VERY GOOD random streams for CRYPTO purposes using Yarrow or Fortuna.   We can add kludges of various kinds to sprinkle true &#8220;physical world&#8221; entropy into the mix, yes, even using that old hardware.   (We did a project in college where we made one of those &#8220;drop the ball down through a series of pegs&#8221; gadgets to create entropic information &#8212; it used a magnetic ball, plastic pegs and substrate, and a series of magnetic switches and logic gates, if memory serves).</p>
<p>We can alternatively rely on a hardware RNG built right into a modern era Intel processor.   But it seems no one trusts the implementation, so in reality, best practices strongly militate toward avoiding reliance on the raw hardware RNG outputs, and washing the products somehow with additional software routines.</p>
<p>If you have to rely on a software routine to achieve confidence from the hardware RNG, you then have to ask what you REALLY gain from that implementation over, say, simply going back to 8 bit computer era liner congruential generators, or a counter-based block cipher implementation and putzing around with software to clean the result.</p>
<p>In my gut, I&#8217;d almost rather have a kludged up software solution based on a much older processor but with transparency of the implementation than to have to post-process a result from an untrusted implementation in hardware.</p>
<p>Its a fascinating discussion, and as someone mentioned, a measure of the true CORROSIVE effects of the policy implemented by the NSA and permitted by the political class.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204417">

			<div class="comment by-curious ">

				<p class="commentcredit">

					<span class="commenter">Curious</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204417">
						September 16, 2013 3:45 PM					</a>

				</p>

				<p>Heh, this other Curious one above here makes me sound more like a techie.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204418">

			<div class="comment by-gonzo ">

				<p class="commentcredit">

					<span class="commenter">gonzo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204418">
						September 16, 2013 3:54 PM					</a>

				</p>

				<p>@curious</p>
<p>I&#8217;m very much <em>not</em> a techie, and make no bones about it.  Over the years I&#8217;ve learned a lot about this stuff by trying to read and absorb things that those smarter than me can offer.   If anything I post is foolish or simply wrong, I am not abashed &#8212; the only dumb question is that not asked as they say.   If I have misconceptions, they are probably common to those with my (in)experience and, so, having them out there, refuted, corrected, etc., cannot but help the overall level of understanding.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204419">

			<div class="comment by-stanislav-datskovskiy ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.loper-os.org' rel='external nofollow ugc' class='url'>Stanislav Datskovskiy</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204419">
						September 16, 2013 4:03 PM					</a>

				</p>

				<p>The ugly but inevitable solution: use TRNGs made of discrete components, which can be verified with an oscilloscope. And replaced, if need be, with vintage (perhaps Soviet, via eBay) versions.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204420">

			<div class="comment by-skeptical ">

				<p class="commentcredit">

					<span class="commenter">Skeptical</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204420">
						September 16, 2013 4:08 PM					</a>

				</p>

				<p>My real concern about the Project Bullrun disclosure is that the NSA may have weakened security features in programs and systems in a way that left them vulnerable to intrusion by other actors (criminals and other governments).</p>
<p>However, the NSA is of course also responsible for helping to safeguard such programs and systems.  As far as I can tell, they take that responsibility seriously &#8211; on the same level with which they take their offensive mission.</p>
<p>It seems likely to me therefore that the NSA would be unlikely to introduce a vulnerability exploitable by others.  Acquiring keys from a company is one thing &#8211; that doesn&#8217;t necessarily render the lock more vulnerable to others.  But weakening hardware features in the manner you described certainly would.</p>
<p>My question is:</p>
<p>Is there any evidence that the NSA has weakened protections in a way that would leave systems or programs vulnerable to intrusion by parties OTHER THAN the NSA or the US Government?</p>
<p>If not&#8230; this may all be much ado about nothing.  The police can acquire keys to apartments from building supervisors and owners under certain circumstances (exigent circumstances or a warrant).  That police ability does not mean the lock is more susceptible to being picked by criminals.</p>
<p>If I want to restrict police ability to search my residence, then I must rely on legal mechanisms, not perfect physical security features.  And by and large, those legal mechanisms work.  Nor have we seen evidence that those mechanisms have failed in the case of the NSA &#8211; instead we&#8217;ve seen examples where the NSA has made mistakes, then voluntarily disclosed them to the supervising FISC, and then complied with procedures and redesign to prevent such mistakes from occurring again.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204421">

			<div class="comment by-curious ">

				<p class="commentcredit">

					<span class="commenter">Curious</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204421">
						September 16, 2013 4:10 PM					</a>

				</p>

				<p>@NobodySpecial</p>
<p>Except that is not how the trojan actually works. It works by reducing the overall entropy in the system, not by allowing the attacker to predict what the next in a series of &#8220;random&#8221; data would be. The type of hack you describe is quite limited because it requires the attacker to actually be doing a side-channel in real time.</p>
<p>Nicolas Weaver. GIGO. If the entropy of the data is reduced before AES is implemented AES can&#8217;t magically increase the entropy again. So a post-hoc analysis of the entropy after AES would reveal the hack.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204422">

			<div class="comment by-muddy-road ">

				<p class="commentcredit">

					<span class="commenter">Muddy Road</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204422">
						September 16, 2013 4:25 PM					</a>

				</p>

				<p>Re: &#8220;&#8230;.leery of Intel strongly pushing for applications to use the output of its hardware RNG directly and not putting it through some strong software PRNG like Fortuna.&#8221;</p>
<p>I think you may have answered your own question.</p>
<p>However, certainly INTEL should like to respond and emphatically deny as well as show proof  the NSA or other entity has not  corrupted their chip architecture.</p>
<p>Frankly, my position would be guilty until proven innocent beyond all doubt at this point.</p>
<p>A sad thing if you think about it too long.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204423">

			<div class="comment by-greg ">

				<p class="commentcredit">

					<span class="commenter">Greg</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204423">
						September 16, 2013 4:27 PM					</a>

				</p>

				<p>Off topic&#8230;</p>
<p>Curious: I disable RC4 ciphers for SSL in Firefox. No ill-effects at all. Except for my ISP&#8217;s website: VirginMedia&#8230;<br />
Fishy!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204424">

			<div class="comment by-bauke-jan-douma ">

				<p class="commentcredit">

					<span class="commenter">Bauke Jan Douma</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204424">
						September 16, 2013 4:27 PM					</a>

				</p>

				<p>Let&#8217;s face it &#8212; we&#8217;ll always run behind on the tech.</p>
<p>What&#8217;s needed is a mentality shift.  There&#8217;s apparently no operational concept<br />
these days in the US of &#8216;public morale&#8217;, the ethics and loyalties of a public servant,<br />
within a so called democratic soceity, the responsibility towards joe and jane citizen.</p>
<p>Here&#8217;s an interesting short talk by Chomsky, on &#8220;Legal Vs Moral&#8221;:<br />
<a href="http://www.youtube.com/watch?v=lcJLsompHJU&#038;feature=c4-overview-vl&#038;list=PLUPB_KWeZWccRU-kZNddE73srvUGCbvTN" rel="nofollow ugc">http://www.youtube.com/watch?v=lcJLsompHJU&#038;feature=c4-overview-vl&#038;list=PLUPB_KWeZWccRU-kZNddE73srvUGCbvTN</a></p>
<p>bjd</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204425">

			<div class="comment by-ac ">

				<p class="commentcredit">

					<span class="commenter">ac</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204425">
						September 16, 2013 4:27 PM					</a>

				</p>

				<p>@Skeptical</p>
<p><i>Is there any evidence that the NSA has weakened protections in a way that would leave systems or programs vulnerable to intrusion by parties OTHER THAN the NSA or the US Government?</i></p>
<p>Yes.  Weakening protections necessarily implies the latter.</p>
<p><i>The police can acquire keys to apartments from building supervisors and owners under certain circumstances (exigent circumstances or a warrant). That police ability does not mean the lock is more susceptible to being picked by criminals.</i></p>
<p>Is that because building supervisors never have their apartments robbed, because building supervisors are never criminals, or because the police are never criminals?  Having extra keys out there does in fact reduce security.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204426">

			<div class="comment by-papppfaffe ">

				<p class="commentcredit">

					<span class="commenter">papppfaffe</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204426">
						September 16, 2013 4:33 PM					</a>

				</p>

				<p>There is another subtlety specifically about the Linux /dev/random implementation, which also borders on conspiracy theory: According to the audit on <a href="http://pastebin.com/A07q3nL3" rel="nofollow ugc">http://pastebin.com/A07q3nL3</a>, the output of the hardware random generator, if one is present, is added <em>as an afterthought</em>, after all other sources of randomness have been mixed and hashed.</p>
<p>In other words, the function get_random_bytes returns the value hash(<i>some_other_random_stuff</i>) XOR <i>rdrand_output</i>.</p>
<p>Now, still according to the link I gave above, if you assume a malicious CPU, it can most probably access the value <i>v</i>=hash(<i>some_other_random_stuff</i>) in a register, then set its <i>rdrand_output</i>=<i>v</i> XOR <i>tampered_value</i>, et voilÃ , the last XOR before the function returning will result in setting the return value to <i>tampered_value</i>, effectively eliminating all other sources of randomness and giving a perfectly predictable tampered &#8220;random number&#8221;.</p>
<p>Scary, that.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204427">

			<div class="comment by-steve ">

				<p class="commentcredit">

					<span class="commenter">Steve</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204427">
						September 16, 2013 5:05 PM					</a>

				</p>

				<p>@gonzo: it&#8217;s not truly an alternative, you can do both. Have a good-quality entropy collector, feed it entropy from device drivers <em>and</em> entropy from your on-chip TRNG. Then by the definition of &#8220;good-quality entropy collector&#8221;, if either of those sources of entropy is good then the output is good. The TRNG protects you against side-channel attacks on your devices, and the devices protect you against Intel-sabotaged reduced entropy in the TRNG. Only if the attacker can do both at once do they win.</p>
<p>A key feature of any entropy collector is that when you put data in you give it a (lower-bound) estimate of the entropy contained in that data. As long as the actual total entropy exceeds the total of your estimate, your output is solid. Furthermore, part of the definition of &#8220;good quality&#8221; is that you can feed in completely untrustworthy data with an estimate of 0, and it still won&#8217;t make your output any more predictable than it would be without that input. So a kernel entropy collector can accept untrusted &#8220;randomness&#8221; from user-land without any risk that one process subverts another process&#8217;s use of random data. Even if something goes wrong and you are over-estimating the entropy, your output might not be critically weakened. Fortuna is <em>designed</em> to mitigate against attackers having partial knowledge of its internal state and its inputs.</p>
<p>The temptation offered by a TRNG is that because it&#8217;s fast and inexhaustible, you might choose to rely on it when other sources of entropy are (for the time being) used up. Intel engineers unaware of any NSA exploit might in good faith (albeit perhaps too naively impressed with their own creations) recommend that people do this when implementing /dev/random or CryptGenRandom().</p>
<p>But if it&#8217;s your only source of entropy, and it&#8217;s compromised, that&#8217;s when you could be in trouble. So implementers of /dev/random shouldn&#8217;t give in to temptation (and by the sounds of it Ts&#8217;o didn&#8217;t) &#8212; they can for example block until multiple sources of entropy are available so as never to have to rely on just one. And crucially, as long as they&#8217;re able to pick a number smaller than the true entropy of the device, it is still a perfectly useful source of randomness.</p>
<p>All this is of course assuming that the chip your code is running on isn&#8217;t also grossly compromised in other ways. At the absurd (technically infeasible) extreme, if Intel somehow managed to sneak a radio transmitter into a chip that reports every value it handles straight to the NSA, then your output will never be solid no matter what code you run.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204428">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204428">
						September 16, 2013 5:08 PM					</a>

				</p>

				<p>@ Curious,</p>
<ul><i>GIGO. If the entropy of the data is reduced before AES is implemented AES can&#8217;t magically increase the entropy again. So a post-hoc analysis of the entropy after AES would reveal the hack</i></ul>
<p>Would you care to explain how you do this &#8220;post-hoc analysis of the entropy after AES&#8221;?</p>
<p>Please remember how CS-PRNGs work like AES-CTR&#8230;</p>
<p>I think you are having the problem many people have with the notion of entropy with respect to testing for non-determanistic behaviour when you only have the output to measure. There are very many algorithms that whilst fully determanistic can not be shown to be such from just observing their output even when the algorithm is well known to those carrying out the tests. These algorithms include but are not limited to crypto-hash, block ciphers, stream ciphers, one way hash functions and key expansion functions.</p>
<p>@ gonzo,</p>
<ul><i>I find this discussion fascinating in the context of hopes, expressed by some in earlier threads, of ditching 8086 legacy devices in favor of CPUs that operate on a much higher level of abstraction.</i></ul>
<p>Actually I&#8217;m the possible exception to that. I would like the hardware to be as simple as possible, but the programing interface for jobbing code cutters to be as high as possible.</p>
<p>As I explained the design proceadur is generaly get a core that meets minimal specifications (in terms of complexity etc) and then put a wrapper around it to give the required level of abstraction. So a striped down RISC core gets a microcode wrapper, or some form of byte code or executable code and shell scripts etc. In all cases the wrapper is an interrpreta thus in most cases it realy does not matter at what level of abstraction the wrapper is provided it&#8217;s BELOW the standard programing layer.</p>
<p>I could give the full reasoning behind it but it would chew up a large amount of thread space, and be a bit pointless as I&#8217;ve given the reasoning before.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204429">

			<div class="comment by-brian-m ">

				<p class="commentcredit">

					<span class="commenter">Brian M.</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204429">
						September 16, 2013 5:20 PM					</a>

				</p>

				<p>Just run some tests if you don&#8217;t trust something. Tests for PRNG algorithms have been done over and over.  There&#8217;s the <a href="http://en.wikipedia.org/wiki/Diehard_tests" rel="nofollow ugc">Diehard tests</a> and some <a href="http://smackerelofopinion.blogspot.com/2012/10/intel-rdrand-instruction-revisited.html" rel="nofollow ugc">results from running Dieharder on rdrand</a>.</p>
<p>At some point, you just have to take a risk and get on with what you were going to do.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204430">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204430">
						September 16, 2013 5:33 PM					</a>

				</p>

				<p>@Brian M.</p>
<p>This reflects a very common misunderstanding.  Tests like Diehard can only reveal statistical properties, but in general can never demonstrate unpredictability.</p>
<p>An absolutely insecure generator (from which billions or trillions of past and future output bits can be readily computed from a small sample of consecutive output bits collected at any point in the sequence) can have perfect statistical properties, up to its period.</p>
<p>And the period can be made so long that no feasible amount of sampling is likely to detect it.</p>
<p>A crypto PRBG must have good statistical properties &#8212; those properties are a <b>necessary</b> condition for security, but <i>not</i> a sufficient condition.</p>
<p>If a clever agent who wants to violate your confidentiality fiddles your PRBG, you can bet that he will make sure that its output is statistically perfect.  And in fact, the Intel design, by using its AES post-processing, does exactly that:  no matter how predictable the internal source bits may be, the output will look perfect under statistical analysis.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204432">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204432">
						September 16, 2013 5:35 PM					</a>

				</p>

				<p>@ Bruce,</p>
<ul><i>That&#8217;s is the worst thing about the NSA&#8217;s actions. We have no idea whom we can trust.</i></ul>
<p>You forgot to add,</p>
<ul>including ourselves.</ul>
<p>No I&#8217;m not talking about mental illness just the age old failings of &#8220;over confidence&#8221;, &#8220;lack of knowledge&#8221; and plain old &#8220;errors and ommissions&#8221;. As has frequently been observed &#8220;To err is human&#8221;.</p>
<p>P.S. Speaking of &#8220;errors&#8221; you&#8217;ve obviously typed this quickly and commited one of the grevious sins I frequently commit ðŸ˜‰  In &#8220;That&#8217;s is&#8221; the &#8220;is&#8221; should not be there.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204433">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204433">
						September 16, 2013 5:48 PM					</a>

				</p>

				<p>@ Stanislav Datskovskiy,</p>
<ul><i>The ugly but inevitable solution: use TRNGs made of discrete components which can be verified with an oscilloscope.</i></ul>
<p>Actually it&#8217;s the prefered way to do it to be quite honest, but these days the test gear is a bit more complex than an oscilloscope.</p>
<p>@ All,</p>
<p>If you are thinking of getting a TRNG from some place, it&#8217;s very important to have direct access to the output of the buffer immediatly after the &#8220;physical source&#8221; of randomness prior to any debiasing or hashing, and you should monitor it continuosly.</p>
<p>If you don&#8217;t then how do you tell if the &#8220;physical source&#8221; has gone wrong or is suffering from external influance?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204434">

			<div class="comment by-gonzo ">

				<p class="commentcredit">

					<span class="commenter">gonzo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204434">
						September 16, 2013 5:55 PM					</a>

				</p>

				<p>@Brian M</p>
<p>I agree with Mark.</p>
<p>You can generate a 20 megabyte file of binary data using the old DOS DELPHI&#8217;s &#8220;random&#8221; command and have it appear to perform well in the DIEHARD battery.   The stream will have distribution and other characteristics that look fairly random on almost all of the tests.</p>
<p>But its an illusion.</p>
<p>&#8220;Random&#8221; under that particular version of Delphi is a LCG that generates the same series of 2^32 numbers every time its run.   When you seed it with the randomize command, it simply drops you into that formulaic sequence at a point determined by the system clock.   So while the data looks random in its outward characteristics, its trivial to exploit the stream if used directly for functions where true random numbers would be crucial.</p>
<p>I believe some &#8220;online Texas Holdem poker&#8221; companies found this out to their great dismay some time ago.   They used the 2^32 limited PRNG I mentioned to shuffle the deck of cards.  Hackers had developed a tool where by a player knowing his own two cards and the three in the &#8220;flop&#8221; (visible after no more than 2 rounds of betting) would be able to determine every single other players&#8217; hand and the final two cards that would fall &#8212; thereby knowing &#8220;when to hold em and when to fold em&#8221; as the saying goes.</p>
<p>It was an object lesson about deterministic RNGs and their risks.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204435">

			<div class="comment by-dave-walker ">

				<p class="commentcredit">

					<span class="commenter">Dave Walker</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204435">
						September 16, 2013 5:56 PM					</a>

				</p>

				<p>Having misspent my youth doing more solid state Physics than was strictly good for me, I did kinda wonder whether something like this would be feasible.</p>
<p>I&#8217;m also reminded of the old LANCE Ethernet controller, which had a design flaw the result of which was the early demise of the vast majority of these units with a stuck transistor. Apparently, the problem was down to proximity between a group of transistors, and an inadequate electron sink between some of them. Over time, electrons would bleed into one of this group of transistors, and this would eventually wedge it.</p>
<p>So, not only is it possible &#8211; if you know what you&#8217;re doing &#8211; to under- or over-dope a gate to make it stick, but other conditions (involving electron sinks) could be set such that transistors operate as normal at time of shipping, but wedge some short-ish (a year, maybe 18 months) time later.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204436">

			<div class="comment by-robert-thau ">

				<p class="commentcredit">

					<span class="commenter">Robert Thau</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204436">
						September 16, 2013 7:12 PM					</a>

				</p>

				<p>There&#8217;s another way for NSA to arrange to selectively hack RDRAND behavior &#8212; distribute a &#8220;microcode update&#8221; to selected targets which cuts bits off the hardware random source, or cuts it out entirely, and gives the victim, say, an AES-whitened version of the real-time clock.  (Or something a little less crude.)  This would require separate access to the entropy source and whitener at the &#8220;microcode&#8221; level, but that may exist.  It would also require NSA to have the Intel-internal documentation and signing keys required to produce a microcode update, but they most likely have those, one way or another.</p>
<p>This has the advantage that the processors Intel ships, including anything likely to wind up in a test lab, really do behave exactly as advertised; the NSA can confine the weakness to selected targets in the field.  The flip side is that they have to be able to execute privileged code on selected targets in the field, but they seem to be good at that.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204437">

			<div class="comment by-stanislav-datskovskiy ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.loper-os.org' rel='external nofollow ugc' class='url'>Stanislav Datskovskiy</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204437">
						September 16, 2013 7:33 PM					</a>

				</p>

				<p>At the risk of repeating myself: at this point, anyone who relies on a TRNG made of anything other than discrete components &#8211; for anything more important than playing games &#8211; is a fool.</p>
<p>If your application is actually important (Bad Things will happen to you or your loved ones in the event of compromise) &#8211; these discrete components should be ones which you purchased and soldered <i>personally</i>.</p>
<p>And I dare say: the junkyard (or eBay) is a more trustworthy source of such components than a Western electronics vendor. Expect to see a climb in the prices of well-preserved Soviet, East German, Czech, etc. clones of 1980s and early 1990s-era CPUs.</p>
<p>Of course, a perfectly-honest TRNG does you little good if the whole rest of the system is thoroughly pwned. RNGs remain interesting, however, because a diddled unit can result in weak keys, leading to the compromise of countless physically-distant systems which would otherwise function perfectly.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204438">

			<div class="comment by-vilmos ">

				<p class="commentcredit">

					<span class="commenter">Vilmos</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204438">
						September 16, 2013 7:49 PM					</a>

				</p>

				<p>Heh, the US successfully &#8220;infected&#8221; the Soviet technological leviathan to a level that the Soviets had no idea what was safe (hint: they stole everything). Now it looks like the US successfully infected its own computer industry. I am not sure the people who came up with these things and approved them really thought it through. They accomplished two things:</p>
<ol>
<li>short term, they will get access to a lot of data.</li>
<li>long term, they killed their computer (and all hight tech) industry competitiveness (and 1. too).</li>
</ol>
<p>An article about how the US screwed the Soviets.</p>
<p><a href="http://fcw.com/articles/2004/04/26/tech-sabotage-during-the-cold-war.aspx" rel="nofollow ugc">http://fcw.com/articles/2004/04/26/tech-sabotage-during-the-cold-war.aspx</a></p>
<p>Vilmos</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204439">

			<div class="comment by-dirk-praet ">

				<p class="commentcredit">

					<span class="commenter">Dirk Praet</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204439">
						September 16, 2013 7:57 PM					</a>

				</p>

				<p>Since this is not entirely my area of expertise, my simple question is: if there is any doubt about Intel&#8217;s hardware random number generator, why then not throw it out completely and replace it by, say, Fortuna ?  Performance reasons ?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204440">

			<div class="comment by-berecz-ferko ">

				<p class="commentcredit">

					<span class="commenter">Berecz Ferko</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204440">
						September 16, 2013 8:09 PM					</a>

				</p>

				<p>@Clive:</p>
<p>Have you used C64 or equivalent hardware for Internet usage? I don&#8217;t recall hearing about modern firmware and other modern exploit vectors for these older systems.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204441">

			<div class="comment by-steve ">

				<p class="commentcredit">

					<span class="commenter">Steve</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204441">
						September 16, 2013 8:10 PM					</a>

				</p>

				<p>@Bruce Schneier: &#8220;We have no idea whom we can trust.&#8221;</p>
<p>Hasn&#8217;t this always been the case?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204442">

			<div class="comment by-another-kevin ">

				<p class="commentcredit">

					<span class="commenter">Another Kevin</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204442">
						September 16, 2013 8:30 PM					</a>

				</p>

				<p>I&#8217;m also more than a bit concerned that the NSA has influenced outfits like Intel, Phoenix, American Megatrends, and Insyde to place spyware in the firmware level. I strongly suspect that every computer manufactured in the last few years can be commanded by the NSA to disgorge at least a key log. Which means that passwords are secure only if they have never been typed on the keyboard. We have no idea how deep this particular rabbit hole goes.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204443">

			<div class="comment by-orly ">

				<p class="commentcredit">

					<span class="commenter">orly</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204443">
						September 16, 2013 8:50 PM					</a>

				</p>

				<p><b>Air Force Seeks Full Spectrum Dominance Over &#8220;Any And All&#8221; Computers</b></p>
<p><a href="http://infowars.net/articles/may2008/140508Computers.htm" rel="nofollow ugc">http://infowars.net/articles/may2008/140508Computers.htm</a></p>
<p><a href="http://www.wired.com/dangerroom/2008/05/air-force-mater/" rel="nofollow ugc">http://www.wired.com/dangerroom/2008/05/air-force-mater/</a></p>
<p>And the results were?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204444">

			<div class="comment by-stanislav-datskovskiy ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.loper-os.org' rel='external nofollow ugc' class='url'>Stanislav Datskovskiy</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204444">
						September 16, 2013 8:52 PM					</a>

				</p>

				<p>Vilmos, the pipeline sabotage incident is well-known.</p>
<p>However, vintage Soviet CPUs are probably safe. Simply because the logic density of that time left very little room to hide hardware-level nasties. I would even venture to guess that all silicon created before the era of ubiquitous networking is probably &#8220;clean.&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204445">

			<div class="comment by-curious ">

				<p class="commentcredit">

					<span class="commenter">Curious</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204445">
						September 16, 2013 8:54 PM					</a>

				</p>

				<p>@Gonzo</p>
<p>I think you misunderstand me. There are two different people calling themselves &#8216;Curious&#8217; here. I was simply referring to that other guy to sort of point that out. ðŸ™‚ Wish he would write with some other handle to be honest.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204446">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204446">
						September 16, 2013 9:04 PM					</a>

				</p>

				<p><b>RobertT and I discussed this here before:</b></p>
<p><a href="https://www.schneier.com/blog/archives/2011/07/research_in_sec.html#c558510" rel="nofollow ugc">https://www.schneier.com/blog/archives/2011/07/research_in_sec.html#c558510</a></p>
<p>I was working on finding risks in the whole process but RobertT warned us to focus on the masks. Of course, the irony is that I was promoting a DOD fab to protect <em>them</em> from fab/mask subversion, whereas they&#8217;re using them against <em>us.</em> Sigh&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204447">

			<div class="comment by-entropy-bad-religion ">

				<p class="commentcredit">

					<span class="commenter">Entropy- Bad Religion</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204447">
						September 16, 2013 9:11 PM					</a>

				</p>

				<p>RdRand was implemented mainly because plenty of VPS servers have no human operator providing entropy and /dev/[u]random has no idea there isn&#8217;t sufficient entropy and provides PRNG anyways even if it&#8217;s completely feeble.</p>
<p>RHEL is apparently exclusively using RdRand for all their PRNG so beware. RHEL is definitely an O/S the NSA would love to backdoor, it&#8217;s running banks, stock exchanges, air traffic control in some countries&#8230;</p>
<p>Most devs are using /dev/urandom on Linux nowadays, so that&#8217;s what is mostly maintained. Apparently they don&#8217;t have time to maintain /dev/random which is for legacy systems.</p>
<p>OpenBSD PRNG now has only one random device, /dev/random and it&#8217;s safe to use on an embedded device with barely any interactive entropy since it&#8217;s completely different from linux /dev/random and doesn&#8217;t blindly trust itself to always have sufficient entropy for PRNG</p>
<p>What total clownshoes the global security industry has become. Between exponential complexity, sloppy code, hardware backdoors, toolchain/compiler backdoors, broken crypto like RC4/TLS 1.0/1.1, and rogue spy agencies ballooning into totalitarianism this has all effectively gone to hell.</p>
<p>I used to be critical of Stallman but now appears he was right all along. A machine that interprets the code instead of having to compiling it with backdoors, where you can press halt and find out exactly what is going on that is built on trusted open hardware is probably our only hope of maintaining security because this NSA/CSIS/GCHQ/MSS/FSS/MI6/NZSIS/ASIO/DGSE rogue agency nightmare isn&#8217;t going away anytime soon. Time to dust off my SICP book and order up some FPGAs for the sole purpose of messaging and encrypting files.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204448">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204448">
						September 16, 2013 9:13 PM					</a>

				</p>

				<p>@ Dirk Praet</p>
<p>Question is &#8220;did they subvert the RNG and <em>only</em> the RNG?&#8221; Or did they embed an &#8220;errata&#8221; that gives them total access?</p>
<p>If it&#8217;s just RNG, using a different source would be good enough. Using Fortuna would also be good and their bad TRNG could even be used in it b/c the enemy would need the other seed material. If subverted thoroughly, then we have bigger problems that basically come down to trusted features can&#8217;t be on an Intel chip. And maybe not an American one. And that means no x86 unless you&#8217;re cloning or emulating it, far as I know.</p>
<p>(VIA is another alternative to Intel for x86 that also has crypto acceleration, however they also have strong US ties. So who knows&#8230;)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204449">

			<div class="comment by-larry ">

				<p class="commentcredit">

					<span class="commenter">Larry</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204449">
						September 16, 2013 9:32 PM					</a>

				</p>

				<p>OK so there is a new attack on PRNGs.  Sounds like opportunity.  There has to be a way to create a verifiable RNG hardware source.  Doesn&#8217;t have to be on a chip.  Time something radioactive.  Look at the timing of photons in a photomultiplier.  I never liked the psudo part of random number generators anyway.  Random random numbers, and don&#8217;t be greedy about the number of bits at a time so that it stays testable.  Deal with the whiteness issues some other way.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204450">

			<div class="comment by-entropy-bad-religion ">

				<p class="commentcredit">

					<span class="commenter">Entropy- Bad Religion</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204450">
						September 16, 2013 9:39 PM					</a>

				</p>

				<p>@Larry reverse biased diodes to generate random noise <a href="http://web.jfet.org/hw-rng.html" rel="nofollow ugc">http://web.jfet.org/hw-rng.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204451">

			<div class="comment by-oops ">

				<p class="commentcredit">

					<span class="commenter">Oops</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204451">
						September 16, 2013 9:42 PM					</a>

				</p>

				<p>Wrong link <a href="http://en.wikipedia.org/wiki/Noise_generator" rel="nofollow ugc">http://en.wikipedia.org/wiki/Noise_generator</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204452">

			<div class="comment by-joe-in-australia ">

				<p class="commentcredit">

					<span class="commenter">Joe in Australia</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204452">
						September 16, 2013 9:55 PM					</a>

				</p>

				<p>This <i><a href="http://www.forbes.com/sites/kashmirhill/2013/07/24/blueprints-of-nsa-data-center-in-utah-suggest-its-storage-capacity-is-less-impressive-than-thought/" rel="nofollow ugc">Forbes</a></i> story gives a conservative data storage estimate of 3 exabytes (2^60 bytes) for the NSA&#8217;s Utah facility. If you stored 1024-bit keys plus their factors in a totally naive way you could fit about 2^53 keys-plus-factors in that amount of storage. Realistically you wouldn&#8217;t do that: you wouldn&#8217;t need to store both factors; you wouldn&#8217;t need to have the keys always online; and you could afford to use a lengthy search to find the right one. Anyway.</p>
<p>Suppose the NSA have subverted popular RNGs so that they actually only produce a small subset of possible number sequences. The number of possible keys you could generate would be large enough that there would be no tell-tale collisions, but small enough for the NSA to store all the possible keys. In other words, suppose that the number of possible sequences is merely 2^53.  Nobody without a data facility comparable in size to the NSA would be able to exploit this, but as far as the NSA is concerned, every key produced would already have been broken.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204453">

			<div class="comment by-dan ">

				<p class="commentcredit">

					<span class="commenter">Dan</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204453">
						September 16, 2013 10:03 PM					</a>

				</p>

				<p>You know, Bruce, with your renowned presence in the media, you could actually ask Intel for a formal comment on this blog post and they would probably give one.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204454">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204454">
						September 16, 2013 10:06 PM					</a>

				</p>

				<p>Steve<br />
<i>At the absurd (technically infeasible) extreme, if Intel somehow managed to sneak a radio transmitter into a chip that reports every value it handles straight to the NSA, then your output will never be solid no matter what code you run.</i><br />
&#8211;Well, there is a peripheral&#8230;and I generally don&#8217;t see a lot of cables besides power transformers coming off most laptops.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204455">

			<div class="comment by-larry ">

				<p class="commentcredit">

					<span class="commenter">Larry</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204455">
						September 16, 2013 10:09 PM					</a>

				</p>

				<p>We have single point of failure systems now.  How do we make it so that this isn&#8217;t the case?  What if we trade cheap for secure and multiply source the hardware?  Make it run with some kind of voting protocol, and multiply source the hardware running that.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204457">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204457">
						September 16, 2013 10:41 PM					</a>

				</p>

				<p>@Entropy- Bad Religion: The first design is on your reference is actually badly broken: I tried it and it failed. My guess is that 74ALS is implemented quite differently these days (e.g. extra stages) and not anymore usable as analog amplifier.</p>
<p>The second design using two transistors works well and is quite tolerant to voltage and resistor variations. Use any standard small-signal NPN transistors, but avoid extra slow ones. Normal ones have something like 0.2W maximum load and &gt;= 100MHz F_t. 12V is quite enough, BTW, E-B reverse breakdown comes out to something in the 5&#8230;6V range. And use a coupling capacitor!</p>
<p>What you get is a mixture of about half thermal noise (not strictly random) and half quantum-tunneling (physics thinks this is the only real random thing in the world), which is pretty good. One problem is that amplifying the signal dramatically reduces noise bandwidth, unless you are careful. The original signal has &gt; 10M zero-crossings/second (best my equipment can do), after just one transistor amplification stage, that is down to about 1M zero-crossings/second in my experiments. (That was the original motivation for the ALS gates, I think, as they are really fast.)  Still, if you sample conservatively, or with something slow like a sound-card or standard A/D converter on a microcontroller, you should get something like 1bit/sample. Be careful, assume something like 0.1bit/sample, hash together, whiten and you get pretty solid randomness for a few bucks (assuming that sound-card is present).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204458">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204458">
						September 16, 2013 10:50 PM					</a>

				</p>

				<p>@oops: That design is highly problematic. I tried it and you get less than 1mV usable signal. This needs very careful shielding, filtering of power, amplification, etc. to be useful at all. To make matters worse, the original signal is small enough that you cannot really measure it with amateur-level equipment. Most people will just end up sampling the mains signal and/or its harmonics coupled in somewhere.</p>
<p>A 2-transistor avalanche source is much more tolerant to environmental influences, a lot easier to use and the original signal is already strong enough that a cheap digital oscilloscope can give you reasonable measurements and FFT, so you can verify that it actually works.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204460">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204460">
						September 16, 2013 10:54 PM					</a>

				</p>

				<p>@Nick Weaver: Indeed. Not having the outputs in JTAG is either very sloppy design from a security POV, or intentional to prevent detection of a compromised CPRNG. In any case it is a strong reason all by itself to not trust the generator exclusively.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204461">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204461">
						September 16, 2013 10:56 PM					</a>

				</p>

				<p>@ Entropy Bad Religion</p>
<p>I&#8217;d prefer a design along those lines. Reason is it can be simple, can use components that aren&#8217;t say microscopic, and whose parts can be foreign sources. Favorite quote in the article, though:</p>
<p>&#8220;Looking at the latest Linux sources is generally the best way of getting the very latest random code.&#8221;</p>
<p>Lol. Of course, I designed a way to use shuffled decks of cards or 8-sided die to get bias free data. I just type the numbers into a program till it reaches entropy point, then it whitens it. The cards give 5-bits each and die 3-bits each. Hadn&#8217;t had to use it.</p>
<p>I like the LavaRnd concept. A days meteor burst data might be nice too. Or just intercepting background cell phone activity to feed into a Fortuna style generator using other private inputs too.</p>
<p>So many ways. Random numbers is a truly easy problem compared to the endpoint security that matters most.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204462">

			<div class="comment by-rc ">

				<p class="commentcredit">

					<span class="commenter">RC</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204462">
						September 16, 2013 11:37 PM					</a>

				</p>

				<p>@Vilmos<br />
<i>Heh, the US successfully &#8220;infected&#8221; the Soviet technological leviathan to a level that the Soviets had no idea what was safe</i></p>
<p><b>yup and heh, now NSA is likely allied with most western countries (and who knows, maybe even Russia) and &#8220;the regular people&#8221; has become their enemy, their Soviet Union.</b></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204463">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204463">
						September 17, 2013 12:07 AM					</a>

				</p>

				<p>@stanislav &#8211; you preempted exactly what I was about to say. If the TRNG is not miniaturized then it can be verified with relative ease. The most logical choice is to use zener diodes as a noise source. I guess you could also easily embed a tiny radiation source (legislation already allows americum-241 in domestic ionization smoke detectors so given that I doubt there would be an issue re export and transport of completed PCs) and a cheap GM tube in a shielded enclosure. You could probably make it quite small too. The problem is &#8211; like everything else we have spoken of in the past few days &#8211; you have to trust the entire system as a collective. It doesn&#8217;t matter if the TRNG module is feeding perfectly random data when, for example UART on the other end is covertly altering what&#8217;s seen.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204464">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204464">
						September 17, 2013 12:42 AM					</a>

				</p>

				<p>@Vilmas &#8211; I have heard Putin&#8217;s office is so concerned about this that they have gone back to using a typewriter for sensitive documents (of course there are meatspace attacks against that too &#8211; ribbon reading, etc.)</p>
<p>@Joe &#8211; you know, I was considering something today. Given we know the approximate floor area of the facility we could probably make some assumptions about equipment density (e.g. space between rack units, etc) and use either budget or square footage of area to assume what brute force capability they have.</p>
<p>e.g. if we assume they are using COTS hardware (say x86 machines with, say 4 graphics cards each) and a standard rack will hold 42RU or 20 2U boxes (single RU boxes won&#8217;t accommodate that many cards) plus 2U left over for their switching hardware, then we can get a rough idea based on floor area. If we assume an average rack occupies about 24&#215;42&#8243; of floor space and a decent graphics card like a 5970 can do 1103658/sec brute forcing AES. So, assuming work can be divided evenly and it scales linearly (which it won&#8217;t but this is just a rough estimate) we can assume 88292640/sec per equipment rack. When you think about the size of the facility then the idea that they can break certain web encryption standards certainly gains some credence.</p>
<p>Now, if they were using custom cracking hardware like ASICs then we start getting downright scary.</p>
<p>That said this would have to be carefully targeted and carte blanche surveillance would still not be feasible. Perhaps the most plausible idea is that they use their cracking cluster to obtain the private keys of SSLized sites that are of widespread use and import (and where merely asking for the key has failed)</p>
<p>Just thinking . . .</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204465">

			<div class="comment by-just-a-lawyer ">

				<p class="commentcredit">

					<span class="commenter">Just-a-lawyer</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204465">
						September 17, 2013 1:15 AM					</a>

				</p>

				<p>@Bruce:</p>
<p>Someone told me &#8211; may be in August of 2011 &#8211; most CPUs (esp. those from Intel) do inherit stack-(or cache?)areas which can be accessed and loaded with code. Shall be some sneaky &#8220;only-for-us-developers&#8221; backdoor-like gadget.</p>
<p>Might that 1) be true and 2) a problem in this context?</p>
<p>Best regards from</p>
<p>a lawyer in Germany.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204466">

			<div class="comment by-a-lawyer-in-toontown ">

				<p class="commentcredit">

					<span class="commenter">a lawyer in ToonTown</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204466">
						September 17, 2013 1:31 AM					</a>

				</p>

				<p>Re: <b>Microcode</b></p>
<p><i>TAILS Linux</i> updates the Microcode with each boot.</p>
<p>For a privacy/security conscious distribution, I wonder what&#8217;s <i>really</i> being updated and why?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204467">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204467">
						September 17, 2013 1:35 AM					</a>

				</p>

				<p>The truth is imagination is the only limit to the ways that a modern chip could be Trojan&#8217;ed.</p>
<p>This referenced paper tries to use the implant masks so that the chip can pass even detailed optical inspection. Personally I think this is a waste of time for deep sub micron designs, what they are using (with implants levels) is a trick we used to use back in the old days of 1um structures (early 90&#8217;s) to create logic gates that would be difficult to reverse engineering. Today there are much more interesting effects that can be generated by intentionally fiddling with the OPC algorithms.<br />
Let me explain:<br />
ANY chip made in a technology below 130nm (late 1990&#8217;s technology) has used special fudge algorithms (called optical proximity correction), modern chips at being made at 20nm gate lengths so the OPC is VERY advanced.<br />
<a href="http://en.wikipedia.org/wiki/Optical_proximity_correction" rel="nofollow ugc">http://en.wikipedia.org/wiki/Optical_proximity_correction</a><br />
OPC is intended to correct for process abnormalities so that your layout design database contains what you actually want, rather than what is necessary for this to print properly, you see adjacent cells that are completely unrelated in the design database effect the chip processing due to etch rates and sub-wavelength lithography effects. These &#8220;errors&#8221; need to be fixed before the masks are made so the &#8220;layout&#8221; database gets lots of correction information added JUST before the masks are made. The whole field of OPC algorithms is a kept VERY secret and the exact structures vary form one manufacturer to the next so nobody (on the design team) really knows what to expect (and would probably never understand the exact purpose of the added structures even if they looked at the post OPC database). Now IF you appropriately fiddled with the &#8220;fill and OPC correction polygons&#8221; you could easily build or alter gates, if your introduced &#8220;error&#8221; was ever discovered everyone would assume it was &#8220;just another OPC F-up&#8221;</p>
<p>BTW: There are other Masking stage added structures called &#8220;Fill&#8221; and Phase Shift masks that could also be used to hide information.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204468">

			<div class="comment by-ben ">

				<p class="commentcredit">

					<span class="commenter">Ben</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204468">
						September 17, 2013 2:03 AM					</a>

				</p>

				<p><cite>If not&#8230; this may all be much ado about nothing. The police can acquire keys to apartments from building supervisors and owners under certain circumstances (exigent circumstances or a warrant). That police ability does not mean the lock is more susceptible to being picked by criminals.</cite></p>
<p>This wins &#8220;worst analogy in the thread&#8221;, as having locks with master keys (as is common in big buildings) does make them more susceptible to picking.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204469">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204469">
						September 17, 2013 2:35 AM					</a>

				</p>

				<p>Another issue to consider is &#8220;Fake chips&#8221;<br />
You would be surprised at the range of fake chips I&#8217;ve seen, they range from simple amplifiers where a cheap, usually Asian &#8220;compatible&#8221; part, gets  re-stamped with some high dollar logo like Maxim or LinearTech.  But this is also happening for digital and mixed signal VLSI parts making something like a discrete TRNG an obvious target for faking.</p>
<p>Since almost all PCB&#8217;s are assembled in Asia it is fairly easy to substitute these fake chips into the production line especially if they are cheaper. A discrete TRNG might only cost $1 but I guarantee you I can build a functional equivalent (especially if I make it a PRNG) for say $0.25 so the PCB (stuffers) can make an extra $0.75 per PCB. The whole electronics assembly process is VERY competitive so their total profit for a laptop PCB might be less than $1 however if they use a fake TRNG chip they make $1.75, this is why its so difficult to keep fakes out of the supply chain.</p>
<p>Of course if say the Russians (or the NSA) wanted to seed the supply chain with fake Trojaned TRNG chips than they might even pay the PBC assemblers $1 to use their chip.</p>
<p>Once the whole system is assembled it is almost impossible to tell if its a fake or not. I&#8217;ve seen cases where everything was a perfect copy, right down to the chip layout itself&#8230;..but it just wasn&#8217;t one of our chips, it was a fake and had some subtle flaws.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204470">

			<div class="comment by-bosko-brajkovic ">

				<p class="commentcredit">

					<span class="commenter">BoÅ¡ko BrajkoviÄ‡</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204470">
						September 17, 2013 2:58 AM					</a>

				</p>

				<p>yeah man and what of firmware downloads for a bunch of the hardware like bios, game cards, cdrom drives and stuff how many times man have you seen a gpg signature how many times man have you seen checksums to go along with it tell me man how we arent fucked on a daily basis by all of this proprietary hardware and software?</p>
<p>the bullshit on windows systems never ceases to fascinate me:</p>
<p>INSTALL this bullshit program with no available source code and we promise it will work as advertised.</p>
<p>(goodfellas voice over) you want more options? fuck you &#8211; pay me. you want faster updates? fuck you &#8211; pay me.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204471">

			<div class="comment by-peter ">

				<p class="commentcredit">

					<span class="commenter">Peter</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204471">
						September 17, 2013 3:31 AM					</a>

				</p>

				<p>@Mike the goat, the thing about typewriters was misreporting. They never stopped using typewriters; an order of ribbons got blown up into a &#8220;story&#8221; because of the silly season.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204472">

			<div class="comment by-unimportant ">

				<p class="commentcredit">

					<span class="commenter">unimportant</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204472">
						September 17, 2013 4:18 AM					</a>

				</p>

				<p>@BoÅ¡ko BrajkoviÄ‡: &#8220;how many times man have you seen a gpg signature&#8221;</p>
<p>Some manufacturers embed the uploadable authenticated and encrypted firmware code within an authenticated application (e.g. by using Authenticode). A separate PGP signature would be better for the educated consumer, but it also only confuses normal users.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204473">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204473">
						September 17, 2013 5:02 AM					</a>

				</p>

				<p>@ Gweihir,</p>
<ul><i>This needs very careful shielding, filtering of power, amplification, etc to be useful at all. To make matters worse, the original signal is small enough that you cannot really measure it with amateur-level equipment. Most people will just end up sampling the mains signal and/or its harmonics coupled in somewhere.</i></ul>
<p>This is true of all random sources&#8230;</p>
<p>For home constructors of TRNGs you are going to have to make your own PCBs &#8211;they don&#8217;t need to be through hole plated though&#8211; using good RF and analog design rules (see an Amature Radio guide from the likes of the ARRL).</p>
<p>One big thing to note is that you need to take the signal from both sides of the noise source with suitable ac coupling. That is as follows,</p>
<p>(+V)&#8211;[RES]&#8211;(A)&#8211;[Noise Diode]&#8211;(B)&#8211;[RES]&#8211;(-V)</p>
<p>And you suitibly small values of capacitor from points A and B into the following circuit.</p>
<p>In practice you would make the footprint of the noise source on the PCB as small as possible and put an AC-Ground gaurd ring around it on both sides of the PCB. You would also not use just single resisters from either DC power supply, as a minimum you would use a Tee Filter. That is use two resistors in series with capacitors from the junction between them to the AC-Ground guard rings. You would also use power supply line filtering across the whole circuit but grounded to DC-ground. The cutoff frequency of the low pass power supply filtering should be as low as is reasonably possible. Likewise that of the tee filters which must be atleast a decade below the cut off frequency of the effective high pass fillter of the ac coupling going to the following amplifier stage which must be biased for minimum noise not maximum gain and very wide bandwidth. One type of amplifier suited to this is grounded base or grounded gate.</p>
<p>As for sheilding you need to issolate the noise source from the amplifier and dc filtering and in turn shield all three from other parts of the circuit. There are shielding materials and shielding materials silver plated mu-metal has been used in the past but is impractical for most home constructors. One trick you can use is strips of double sided PCB, however it generates a lot of heat so it needs to be done before you fit components. You design your layout PCB with ground planes on the top and bottom layers. You then cut strips of unetched PCB material to form the side walls, these strips are about 1cm wide and file the edges carfully so the copper comes right down to the edge. You solder in place support wires on the layout PCB at the corners of where the shield box is to go. Using these &#8220;tack solder&#8221; the strips of PCB at right angles to the layout PCB, then &#8220;seam solder&#8221; the PCB strips all along the bottom edge to the layout PCB do this on both sides of the PCB strips. However&#8230; how do you get signals etc in and out ðŸ™‚ there are two basic ways use PCB tracks and remember to file a notch in the edge of the side wall PCB strip so it does not short. Alternativly before soldering the side walls on drill holes through sufficient to take the component legs remembering to use a larger drill to clear back the copper from the hole on both sides. Better if you have them are small &#8220;feed-through capacitor&#8221; filter components which you solder in place, however they are not likely to be at your local Radio Shack (but the likes of Digi-Key sell them &#8220;mail order &#8220;http://www.digikey.co.uk/product-search/en/filters/feed-through-capacitors ).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204474">

			<div class="comment by-berecz-ferko ">

				<p class="commentcredit">

					<span class="commenter">Berecz Ferko</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204474">
						September 17, 2013 5:40 AM					</a>

				</p>

				<p>@Clive (I feel you missed this above):</p>
<p>Have you used C64 or equivalent hardware for Internet usage? I don&#8217;t recall hearing about modern firmware and other modern exploit vectors for these older systems.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204475">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204475">
						September 17, 2013 6:20 AM					</a>

				</p>

				<p>@berecz &#8211; A device like the C64 would likely be able to support a very basic TCP/IP stack but you would be limited to text only web and even then only small pages would render. Actually the only use I could think of would be as a dumb terminal, in which case it solves nothing as you are just shifting trust to another machine. modern crypto would be unusable. 64k of RAM is not enough.</p>
<p>An Amiga or an 80386 would be a much more suitable machine. There are TCP stacks for DOS and even a basic browser (google arachne). An early Motorola based Mac would also be another option.</p>
<p>Personally I would go for a pre UEFI era Pentium 4. When things started to get &#8220;dirty&#8221; is anyone&#8217;s guess though. Stanislav&#8217;s suggestion of a soviet PC clone is a good one.</p>
<p>But we are all just guessing.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204476">

			<div class="comment by-dirk-praet ">

				<p class="commentcredit">

					<span class="commenter">Dirk Praet</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204476">
						September 17, 2013 6:31 AM					</a>

				</p>

				<p>@ a lawyer in ToonTown</p>
<p><i>TAILS Linux updates the Microcode with each boot.</i></p>
<p>Could you elaborate on that and tell us where you got that from ?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204477">

			<div class="comment by-out-of-memory ">

				<p class="commentcredit">

					<span class="commenter">out of memory</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204477">
						September 17, 2013 7:00 AM					</a>

				</p>

				<p>If the RNG is compromised I don&#8217;t think they implemented it in a way to detect it by measuring entropy. I think they would use a kind of strong pattern within the generated numbers generated.</p>
<p>Thinking in solutions we could use RNG to get the numbers very quick and disorder them by using some local based informations (think of generating a unique key out of hardware serial numbers, time, fan rpm, &#8230;, maybe informations of browser cache, too or the last few mails received and sent).</p>
<p>I was just thinking loud so feel free to put fingers in your ears, if that were stupid thoughts.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204478">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204478">
						September 17, 2013 7:08 AM					</a>

				</p>

				<p>@Clive Robinson: Actually, no. For example, the two-transistor avalanche generator works quite well with 330R  pull-up resistor which leads to a  low-impedance output signal with enough amplitude that you can just amplify without any additional shielding or special filtering.</p>
<p>Taking a differential signal form a noise diode does not help. In fact, it is a pretty stupid approach, as it limits you to use a differential amplifier in the next stage, with corresponding worse bandwidth. From you other &#8220;tips&#8221;, I have to deduce that you actually have no clue what you are talking about for this application and have not done any of this yourself in an experimental fashion as what you say is mostly complete nonsense. Sorry, but this is not RF design or high-quality audio. As long as the signal that you get is mostly noise, you are fine. No need for custom PCBs or bizarre shielding arrangements at all.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204479">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204479">
						September 17, 2013 8:20 AM					</a>

				</p>

				<p>@ Berecz Ferko,</p>
<ul><i>Have you used C64 or equivalent hardware for Internet usage?</i></ul>
<p>No.</p>
<p>Though I have used other 8bit micros for SLIP connections they were a lot faster.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204480">

			<div class="comment by-unimportant ">

				<p class="commentcredit">

					<span class="commenter">unimportant</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204480">
						September 17, 2013 8:30 AM					</a>

				</p>

				<p>A quick-n-dirty approach is to sample otherwise unused floating A/D channels of a micro-controller. This kind of an entropy source must then be fed combined with other entropy sources into a PRNG.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204481">

			<div class="comment by-microcode ">

				<p class="commentcredit">

					<span class="commenter">microcode</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204481">
						September 17, 2013 8:31 AM					</a>

				</p>

				<p>Tails is based off Debian and if you look at dmesg you will sometimes see &#8220;failed to update microcode&#8221; which could just be a regular kernel function. I have no idea but wondered myself what that is doing. I&#8217;m sure its in their design document though or we could ask them</p>
<p>Personally I don&#8217;t use it because its full of junk/bloatware. I use a base openbsd install with softraid crypto as since 5.3 openbsd can boot cryptodisks eliminating an unencrypted boot loader that you have to carry around on USB or hide.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204482">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204482">
						September 17, 2013 8:50 AM					</a>

				</p>

				<p>@ Gweihir,</p>
<ul><i>Taking a differential signal form a noise diode does not help. In fact, it is a pretty stupid approach, as it limits you to use a differential amplifier in the next stage, with corresponding worse bandwidth.</i></ul>
<p>I did not say &#8220;take a differential signal&#8221; but &#8220;take the signal from both sides&#8221; ie two signals. Nor did I say &#8220;use a differenntial amplifier in the next stage&#8221; I actualy sugested using a ground base or grounded gate amplifier which is not a differential amplifier is it?</p>
<p>Also do you know what the input impedence for a grounded base or grounded gate stage is and it&#8217;s coresponding bandwidth even when biased for minimum noise?</p>
<p>Oh and why all the sheilding and filtering&#8230; have you put a mobile phone or WiFi card near your &#8220;prototype&#8221; I suspect not. GSM mobile phones and un sheilded amplifiers be the audio or RF don&#8217;t play nicely. The GSM phone produces a pulsed output that gets picked up on most conductors including cheap design PCBs and the first diode junction they hit generaly acts as a diode detector and demodulates what is in effect an AM signal. Thus the amplifier output has a nice pulse train sitting on it as you would see on you oscilloscope screen if you turned the time base down to an appropriate rate or if you want a simple demonstration involving no tools or test equipment tune a radio to a radio station call somebody on A GSM phone and just bring it within about a foot or so of the radio.</p>
<p>Oh and the reason for a signal from either side of the noise diode I&#8217;ll let you think about for a while.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204483">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204483">
						September 17, 2013 9:41 AM					</a>

				</p>

				<p>@ Mike the Goat</p>
<p>&#8220;Personally I would go for a pre UEFI era Pentium 4. &#8221;</p>
<p>That&#8217;s my preference too. Remember, too, that there&#8217;s plenty of UNIX RISC workstations with varying processors/hardware: Compaq Alphas, HP PA-RISC, Sun SPARC&#8217;s, SGI MIPS and so on. Back when they were high end, the majority of my power user activities were done on a Pentium 2 (233MHz) PC w/ 64MB of RAM and 28K dialup. Seeing how much I got done, I&#8217;m pretty sure modern revolutionaries could turn one of the other machines into something useful. ðŸ˜‰</p>
<p>Btw, one must worry about one other thing: <b>processor errata can lead to subversion.</b> The errata are basically hardware bugs whereby the processor doesn&#8217;t act in accordance with its specification. Vendors of processors often produce errata lists with their processors. They can make for interesting reading, esp. when the error is in security-enforcing functionality like MMU or control flow. Kris Kaspersky has a <a href="http://www.cs.dartmouth.edu/~sergey/cs108/2010/D2T1%20-%20Kris%20Kaspersky%20-%20Remote%20Code%20Execution%20Through%20Intel%20CPU%20Bugs.pdf" rel="nofollow ugc">great presentation</a> on it.</p>
<p><b>Don&#8217;t forget the Chinese processor and OS</b></p>
<p>The Chinese have been making their own processors based on MIPS (Loongson) b/c they&#8217;re worried about subversion. One machine is open down to the firmware I think, which is why Stallman uses it. They also have an OS, Kylin?, that&#8217;s a modified FreeBSD. They might have subverted these things for their benefit but I doubt NSA has.</p>
<p>So, if you have something you must keep from NSA, but China is no worry, then maybe use Chinese gear. It&#8217;s really just remix of my old maxim of &#8220;use the other side&#8217;s equipment if you don&#8217;t trust your side.&#8221;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204484">

			<div class="comment by-rng ">

				<p class="commentcredit">

					<span class="commenter">RNG</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204484">
						September 17, 2013 9:54 AM					</a>

				</p>

				<p>I like the method of utilizing smoke detectors for their alpha radiation and then measuring the intervals of decay (and running them through a whitener like Von Neumann&#8217;s simple method).  There are a couple of ways to do this</p>
<p>1) With a video camera to visually record the decay as seen here:  <a href="http://www.inventgeek.com/Projects/alpharad/overview.aspx" rel="nofollow ugc">http://www.inventgeek.com/Projects/alpharad/overview.aspx</a></p>
<p>2) By using a radiation detector as seen in this design: <a href="http://www.etoan.com/random-number-generation/index.html" rel="nofollow ugc">http://www.etoan.com/random-number-generation/index.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204485">

			<div class="comment by-loongson ">

				<p class="commentcredit">

					<span class="commenter">loongson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204485">
						September 17, 2013 11:00 AM					</a>

				</p>

				<p>Problem with using Chinese hardware like Lenovo is they are still backdoored, and every other country knows this and has probably figured them out. We need hw with no backdoors or RNG tampering so looks like only solution is a FPGA though Lemote/loongson laptops running BSD look pretty enticing, and BSD doesn&#8217;t rely on hw crypto for random memory address at boot, or for RNG.</p>
<p>There&#8217;s always a beagle board too and wishful thinking that ARM hasn&#8217;t been tampered with yet.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204486">

			<div class="comment by-alext ">

				<p class="commentcredit">

					<span class="commenter">AlexT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204486">
						September 17, 2013 11:07 AM					</a>

				</p>

				<p>Absolutely, positively fascinating discussion ! Thanks to all contributors !</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204487">

			<div class="comment by-wd ">

				<p class="commentcredit">

					<span class="commenter">WD</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204487">
						September 17, 2013 11:12 AM					</a>

				</p>

				<p>Is it out of the question for industry to come up with analog discrete random number generator devices which <em>can</em> be audited? Aren&#8217;t we tired of everyone&#8217;s BS?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204488">

			<div class="comment by-tony ">

				<p class="commentcredit">

					<span class="commenter">Tony</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204488">
						September 17, 2013 12:07 PM					</a>

				</p>

				<p>Ted did write &#8220;I am so glad I resisted pressure from Intel engineers to let /dev/random rely only on the RDRAND instruction.&#8221; &#8230; but he later admitted that it was misleading.  Nobody from Intel ever tried to have /dev/random depend solely on the RDRAND instruction. The Intel engineer contributing the patches to the Linux kernel  stated that RDRAND is not suitable for that given the ways that exisitng applications and libraries use /dev/random.</p>
<p>Dig through the Linux kernel mailing list archives to see the discussions and proposed patches &#8211; it is all public.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204489">

			<div class="comment by-anyone-what-to-build-some-chips ">

				<p class="commentcredit">

					<span class="commenter">Anyone what to build some chips?</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204489">
						September 17, 2013 12:29 PM					</a>

				</p>

				<p>I think it is about time we do to hardware what the GPL did to software, open it up.  You can&#8217;t trust what you can&#8217;t verify.</p>
<p>Also, there is enough entropy in the universe.  All that is required is mechanism to collect it, encode it, and use it.</p>
<p>That being said, the average user will continued to get screwed while we put trust in companies and governments to get it right.  Even in the best of situations they often get it wrong.  Chalk it up to indifference or malice.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204490">

			<div class="comment by-paul ">

				<p class="commentcredit">

					<span class="commenter">paul</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204490">
						September 17, 2013 12:41 PM					</a>

				</p>

				<p>I think RobertT&#8217;s argument about OPC needs to be made slightly more complicated. If you have visual access to the chips, you can still check whether the visible structures make the things you called for in your layout &#8212; the OPC just changes the masking to get the structures you want out of light whose wavelength isn&#8217;t short enough to do th job simply. You would have to use an OPC trojan to affect a non-visible layer.</p>
<p>There are, however, more invasive and expensive methods, e.g. focused ion beams, that could verify that the gates were actually what you wanted, but it&#8217;s not clear you&#8217;d have a working chip afterward. So you&#8217;d have to rely on statistical methods and manufacturing surveillance.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204491">

			<div class="comment by-gonzo ">

				<p class="commentcredit">

					<span class="commenter">gonzo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204491">
						September 17, 2013 12:44 PM					</a>

				</p>

				<p>Hey guys&#8230;.</p>
<p>I was discussing this with my dear other last night and she had an interesting perspective from her position in the medical field:  &#8220;If you can&#8217;t fix it, embrace it, once you embrace it, you can deal with it using the tools you have.  Use ALL the tools you have.&#8221;</p>
<p>This got me thinking about the fact that the NSA and other &#8220;adversaries&#8221; (including hackers with their Playstation 3 devices and video card brute force farms) have leveraged the exponential increase in computing power, memory, and storage FAR FAR beyond what folks in the user space have done in terms of their work protecting secrets.</p>
<p>What fallows is partially comedic absurdity (call it my quest for levity), and I got a chuckle writing it.</p>
<p>But burried somewhere in here is also a thought on overall technological arms race.    The NSA has huge, but not unlimited, resources for processing and memory.  How about we take that disparity out of the equation or at least reduce its impact.</p>
<p>Here is where the tongue gets planted in cheek&#8230; ahem:</p>
<p>As far as random numbers go, why not &#8220;embrace&#8221; determinism, but make the haystack so big and the process so convoluted (exponential branching with cascading points of divergence for the stream) that the cryptographic goal is accomplished.  Stop calling (or EXPECTING) it to be a random number generator.  What you really need for cryptographic purposes is a &#8220;totally unpredictable nonce engine&#8221;</p>
<p>Example:    Fill a directory on a 2 gigabyte ram drive with 500 t0 700 megabytes of junk:  MP3s, video files, 100 days of the Huffington Post Comments section, weeks and weeks of Slashdot.com articles and comments, the previous hour&#8217;s twitter feeds for 3000 or so super active  + moderately active users, blocks of data from stock tickers and investing &#8220;wire&#8221; reports, the AP photo feed, a bunch of arbitrarily selected LINUX repository files, whatever.   Add another 500 to 700 megabytes of PRNG gunk.  I don&#8217;t care what from, linear congruential, XOR shift, Intel&#8217;s processor instruction, an ARC4 stream, or a little of everything.</p>
<p>Set up a process to &#8220;stir&#8221; this pot.   That means arbitrarily discarding items in the pot, replacing items, XOR scrambling of parts of the pot, whatever.   Really use the system processing power and memory so that every 30 seconds a large percentage of the pot will have changed.</p>
<p>Separately, set up a process that then traces an outrageously convoluted path through the muck.   Maybe while you have the stirring process working at a file level, the convoluted path through the entire mess operates at the sector level?   It will be completely deterministic, of course, but set it up so that every byte of &#8220;output&#8221; at least 33% of the pool of muck will have affected it.  The path through the pool should be different for, for example, for every possibility that could come up as the next number in a PRNG with 2^32 possibilities.  But not only that, the pool should be changing so fast that even two identical paths starting through the muck will land in hugely different places.   A simple, flawed, whatever PRNG can pick which files (or sectors) in the muck to dip into, it can determine which bytes to start with, it will determine how much of each file/sector to grab, it will determine what order to combine these samples, it will determine which out of several thousand operations will be performed on these samples (XOR with each other, encode with various ciphers using either other samples or counter based keys, flipping various bits, application of compression, processing through a stream cipher, arithmetic operations, truncation, XOR against frame grabs from a VM running a texture intensive video game in demo mode, whatever).   Keep adding possibilities, keep adding branches, and dump some of the output of this step back into the original constantly evolving pool&#8230;  and at the tail end add whatever whitening process may be desired&#8230;. if it is even necessary</p>
<p>Do all this &#8230; such that every X time slices, the above process will have Y bytes of nonse material available for sampling by whatever applications need it.   This should flow through a particular memory location like a ticker tape.   Hell, maybe make the window for this output the debug registers on the processor itself.</p>
<p>The idea here is that although the process to come up with these little bits of nonce material is completely determinable, the pool of data that generates and is manipulated to get the output is (a) so large as to be infeasible to capture remotely; and (b) changing so quickly, and from so many sources of new bytes, that even physical access of the &#8220;state&#8221; of the mess at any particular point simply will not be of any value at N+ time slices later.   Make the process to generate the nonce material require memory pools and processor power of a magnitude that make it infeasible to set up any kind of video card farm.   Have the process that accesses web materials to throw in the pool go out and &#8220;access/download&#8221; ten times the amount of stuff that actually goes into the pool, such that an adversary monitoring these access attempts cannot duplicate the part of the pool that is mucked up with daily internet detritus of other (more locally) generated not really random garbage.</p>
<p>It probably will take some tweaking of the path through the muck and all the transformations to have the statistics one desires in the output, but in the end, you ought to have a stream that passes the tests for random characteristics.  It won&#8217;t be random, not per se, but it ought to be totally infeasible to hack and compromise.</p>
<p>In a similar frame of thought, for block ciphers, imagine a cipher that runs 10,000 rounds based on a preliminary key schedule, and then uses the results of rounds 10,001 through 10,032 to generate the key schedule (and perhaps tweak lookup tables and portions of the cipher etc) for the actual encryption operation which is performed using another 100 rounds.  Is there a delay to the user?  Sure.   But a properly designed system like this would add mountains to the computational infeasibility of breaking the codes.</p>
<p>Its an outrageously inefficient approach, and THAT is the idea.  LOL.   If the government minders want a technological arms race, give them one.</p>
<p>Bonus points if you sprayed coffee on your USB compromised keyboard while reading this.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204492">

			<div class="comment by-wasnt-me ">

				<p class="commentcredit">

					<span class="commenter">wasn&#039;t me</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204492">
						September 17, 2013 1:28 PM					</a>

				</p>

				<p>Or just suppose if a fabless US-based SoC designer like Cavium could be pressured into weakening the encryption in their Nitrox chips.  These are so incredibly powerful for offloading SSL and VPN encryption, up to several Gbit/sec, which would be very difficult to do any other way.  These may end up in all sorts of appliance and shipped off all over the world.  And then you would have backdoored huge volumes of sensitive Internet traffic for many years to come.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204493">

			<div class="comment by-name-withheld-for-obvious-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obvious.reasons</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204493">
						September 17, 2013 2:12 PM					</a>

				</p>

				<p>Thanks Gonzo&#8211;how&#8217;d you know I would spill my coffee? Sounds a little too deterministic to me.<br />
Off to get a CF (compact flash) keyboard, comes with a write lock.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204494">

			<div class="comment by-br ">

				<p class="commentcredit">

					<span class="commenter">BR</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204494">
						September 17, 2013 3:50 PM					</a>

				</p>

				<p>The NSA project to defeat encryption is codenamed Bull Run.</p>
<p>The IBM program to implement the RNG function in Ivy Bridge processors is codenamed Bull Mountain.</p>
<p><a href="http://software.intel.com/en-us/articles/intel-digital-random-number-generator-drng-software-implementation-guide/" rel="nofollow ugc">IntelÂ® Digital Random Number Generator (DRNG) Software Implementation Guide</a></p>
<p>It could be a spectacularly bad coincidence, but as Bruce notes, we have no idea whom we can trust.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204495">

			<div class="comment by-greg ">

				<p class="commentcredit">

					<span class="commenter">greg</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204495">
						September 17, 2013 3:58 PM					</a>

				</p>

				<blockquote><p>
  you can tamper with a logic gate to be either stuck-on or stuck-off by changing the doping of one transistor. This sort of sabotage is undetectable by functional testing
</p></blockquote>
<p>Well, sure, you won&#8217;t catch it in simulation pre-silicon, but the whole point of ATE is to run test vectors at the factory to detect bad flops, bad combinatorial gates, and shorted/open wires, that are a result of manufacturing errors and bin out the bad parts.</p>
<p>As long as the RNG is hooked up to flops, and those flops are hooked up to jtag and test logic that eventually connects to a pin, then flops stuck to 1 or 0 can be detected by ATE.</p>
<p>they&#8217;d have to fiddle the doping and then they&#8217;d have to fiddle the ATE to ignore any failure from that flop for the part ot get out of the factory. But even then, once you have the part, you could put the part on your own tester, run the test vectors, and detect that the bit is stuck.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204496">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204496">
						September 17, 2013 4:42 PM					</a>

				</p>

				<p>@ Greg,</p>
<p>My take away from what was said, is that you can cause it to stick not initialy but after a short time of operation, so it would get through initial ATE butbe a juvinial failure in a non obvious way.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204497">

			<div class="comment by-name-withheld-for-obvious-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obvious.reasons</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204497">
						September 17, 2013 5:11 PM					</a>

				</p>

				<p>@Greg, Clive</p>
<p>Also, milspec, EIA, and a half dozen other standards requirements mean destructive testing in addition to ATE tests. SPC might miss a deliberate valance layer as destructive runs tend to be based on smaller sample sets. So it could be possible to get it past a consumer or industrial QA process but less likely for non-counterfeit milspec parts.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204498">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204498">
						September 17, 2013 7:00 PM					</a>

				</p>

				<p>@Clive Robinson: Sorry, but no game. The &#8220;buzzword overload&#8221; strategy does not work against me.</p>
<p>I still think you have no clue. Your design is overly complex, it use the worst noise source possible, it is non-transparent and now you want to play games with the supply lines? And, no, there is zero need for a base-to-ground amplifier, the source is already low impedance and decoupling the signal is not a concern here, IT IS NOISE! If it gets distorted, that does not matter for the intended application at all.</p>
<p>Are you actively trying to discourage people by selecting the most complex solution that has a chance of delivering the intended result and using a lot of complex and hard to master RF engineering stuff that is completely misplaced in this discussion? That would either be stupid or plain malicious!</p>
<p>And while shielding (a plain, cut up can of tomatoes is quite enough, no need for any &#8216;magic&#8217; pass-through capacitors, these you only need if you need a very stable signal line-to-ground impedance, because you have some calibrated filter or oscillator in there) is nice, it is not necessary with the 2-transistor avalanche construction. Even a mobile phone next to it does not matter as long as you use sound entropy gathering practices (entropy pool) and a conservative entropy per sample estimation.</p>
<p>This is not magic or difficult, no matter how much you try to make it sound like it is.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204499">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204499">
						September 17, 2013 7:20 PM					</a>

				</p>

				<p>@Paul<br />
  You&#8217;re kinda right that you can still inspect the chip and see what you get and compare to what you want but on 20nm designs this inspection will need to be done with a SEM because the structures are way to small for visible light. Remember the OPC does not need to do much to change the function. A NOR gate can become a funny sort of dynamic memory if one of the parallel fets has a via missing on the source or drain side. Naturally I&#8217;ll make sure the test vector set can never discover this.  So all I needed to do was introduce an error into the OPC function that would result in the miss processing o ONE well chosen via in the TRNG.</p>
<p>I dont know if you&#8217;ve ever worked on 20nm Failure analysis but I can assure you it is a major project to find this sort of problem, we&#8217;re talking maybe $1M in expense using tools like FIB and SIM&#8217;s machines. Before you even start down this road you need to have an idea about what you are looking for a &#8220;smoking gun&#8221;. Most design guys move onto the next project as soon as they possibly can, they verify the function of their block and their gone. Monitoring the chip in production is a &#8220;production engineers&#8221; job and they&#8217;re usually so green that they dont even know what the are looking for, especially with a block as critical as the TRNG, or anything security for that matter.</p>
<p>As I&#8217;ve said before, but not in this post, make the OPC mask changes after the first silicon is verified, you&#8217;ll get most of the production volume with little or no top level engineering oversight. Masks changes are made during production for a variety of reasons., maybe to fix bugs in another section or enable so called &#8220;risk functions&#8221; (functional blocks that were added but not originally enabled) there are plenty of opportunities to make these changes during the life of the project.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204500">

			<div class="comment by-jimmy-the-geek ">

				<p class="commentcredit">

					<span class="commenter">Jimmy the Geek</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204500">
						September 17, 2013 8:50 PM					</a>

				</p>

				<p>Bruce, thanks for doing what you do. You&#8217;re always an education.</p>
<p>Re: paranoia&#8230;:</p>
<p>&#8220;Next in importance to personal freedom is immunity from suspicions, and jealous observation. Men may be without restraints upon their liberty: they may pass to and fro at pleasure: but if their steps are tracked by spies and informers, their words noted down for crimination, their associates watched as conspirators, who shall say that they are free? Nothing is more revolting to Englishmen than the espionage which forms part of the administrative system of continental despotisms. It haunts men like an evil genius, chills their gaiety, restrains their wit, casts a shadow over their friendships, and blights their domestic hearth.</p>
<p>The freedom of a country may be measured by its immunity from this baleful agency. Rulers who distrust their own people, must govern in a spirit of absolutism; and suspected subjects will be ever sensible of their bondage.&#8221;</p>
<p>-The Constitutional History Of England</p>
<ul>
<li>by T. E. May</li>
</ul>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204501">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204501">
						September 17, 2013 10:18 PM					</a>

				</p>

				<p>@Gweihir</p>
<p>your solution sounds interesting, do you have schematics so that I can run some simulations. Also do you have wideband FFT&#8217;s of the output zoomed in around the 900Mhz and 2400Mhz bands, because this ubiquitous RF does leak into all manner of poorly designed /constructed equipment.</p>
<p>If I understood correctly your noise source is the Avalanche breakdown of an NPN junction.  This should be OK for vertical NPN structures But I&#8217;ll need to give a little thought to the long term stability of Lateral Bipolar structures under these bias condition.</p>
<p>BTW Clive&#8217;s shielding paranoia is not without reason, because these days it is very easy to build a powerful RF transmitter and hide it near critical equipment.<br />
There are three secrets to avoid accidentally demodulating injected signals.<br />
&#8211; keep the source impedance low (which can introduce its own supply rejection problems) because supply&#8217;s can be a major source of unintended signal ingress, they tend to have long total wiring lengths (equals large antenna effects)<br />
&#8211; Keep the active / wiring areas small (minimize unintentional antenna&#8217;s)<br />
&#8211; Shield it.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204502">

			<div class="comment by-wakko-warner ">

				<p class="commentcredit">

					<span class="commenter">Wakko Warner</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204502">
						September 17, 2013 11:22 PM					</a>

				</p>

				<p>@Tony<br />
I agree with you. The whole RDRAND issue is baseless.<br />
There is no reason to suspect that the workings of RDRAND are in some way subverted. And yes, it is all in the open since LKML is public.</p>
<p>@Bruce<br />
Please do read the answers of the Intel engineers in the thread you posted and also the LKML. Also, it would be a real, big, mistake to scare the people away from something that is actually working as advertised. When we do this we should have solid grounds under our feet or else we are only going to play in favor of NSA.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204503">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204503">
						September 18, 2013 12:29 AM					</a>

				</p>

				<p>@Wakko &#8211; you may state that the TRNG is working as advertised but we all know it is impossible to validate. For this reason Tso&#8217;s solution of using RdRAND as just one source of entropy rather than having /dev/random pump out RdRAND derived data directly. Surely this is a good compromise? If people need high throughput random data and don&#8217;t have an issue with Intel&#8217;s implementation then perhaps we can have a /dev/rdrandom</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204504">

			<div class="comment by-wakko-warner ">

				<p class="commentcredit">

					<span class="commenter">Wakko Warner</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204504">
						September 18, 2013 1:54 AM					</a>

				</p>

				<p>@Mike<br />
I perfectly agree with you. Linux&#8217;s RNG should keep working as it is now. What i was simply saying is that the statement of Ts&#8217;o is simply exaggerated and that there is no real reason to even suspect any wrongdoing from Intel.</p>
<p>My point is that one thing is being paranoid, and i can assure you that i am, another thing is pushing people away from technologies that have a real chance to make security stronger just because of &#8220;voices&#8221; or &#8220;suspects&#8221;.</p>
<p>If we let panic get at us, then the NSA will become stronger as we will walk away from hardware-based RNGs because &#8220;it&#8217;s a black box&#8221;.<br />
I have already read many comments about scared people wanting to disable RDRNG from their OSes just because of what are IMO baseless statements&#8230; this is bad&#8230; this is going to really damage security not improve it.</p>
<p>After all, if you think about it, the whole CPU is a black-box. As is a black-box the chipset, the RAM and any IC inside your machine. From what we know the CPU could easily detect specific sequences of commands and subvert them, it could even wait for an external command to enable this behaviour and there is just no way to tell it.<br />
And why worry about the hardware when the same OS used by 90% of people and governments worldwide <em>is</em> a black-box? What are the chances that Windows does have a backdoor from NSA inside it? I believe there is a very good chance&#8230; much higher than the subverted RDRAND hypothesis.</p>
<p>Let me tell you, this whole NSA thing really hurt my trust in anything ever made in USA. NSA did a very bad job as &#8220;protecting USA&#8221; as i believe (and i won&#8217;t hide that i do hope) many of us will walk away from any technological business in USA (when we will have a chance to do it).<br />
As an european i really feel betrayed. What&#8217;s worse is that no one in politics here is really giving &#8220;a shit&#8221; about all this.<br />
They don&#8217;t even seem to understand the implications of this all. They don&#8217;t even seem to realize that the USA government betrayed us all&#8230; their supposed f*cking allies!</p>
<p>Lets for one moment think that the EU did this to the USA&#8230; what would have happened? So why isn&#8217;t there any real reaction from my own country (Italy and Europe)? The only thing they seem to care is keep Berlusconi out of jail!</p>
<p>At this point what we (europeans) should do is drop any hardware and software coming from USA (and Russia, and China, etc.), it is clear we cannot trust anyone anymore. We should invest in our own chip-industries, in our own hardware-industries, in our own software developers&#8230; instead we letting every other country develop their (and our) technology and always trusted whoever sold us our chips, our software and so on. As anyone can easily understand, especially now, this is extremely dangerous for the security of any country. The same USA is buying chips from China/Taiwan/etc. without worrying that they <em>might</em> be compromised.</p>
<p>So as you see it is not that i have any interest in &#8220;defending&#8221; Intel&#8230; but, at the moment, i have no reason to think that Intel is any worse than AMD, or VIA or any other big american or chinese company.</p>
<p>Sometimes i really think that i should get back from the attic my old MSX and use that&#8230; at least it is all made from the good old TTL family of ICs and the good old Z80 which are very unlikely to be broken by NSA.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204505">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204505">
						September 18, 2013 2:26 AM					</a>

				</p>

				<p>@wakko &#8211; I agree with you. Given the concern perhaps Ts&#8217;o can have his code look on boot for a specific flag so those who do not wish to use RdRAND as even a source of entropy can simply edit their grub/lilo config and tack on a &#8220;rdrand=0&#8221;. I think having something like a sysctl that you can write to while multiuser to disable/enable using RdRAND would be too difficult to implement given how it is currently designed but I may be wrong. Ideally though at a minimum even if a kernel boot argument is out of the question they should add a simple entry to the kernel .config so you can choose to force it off at compile time (I haven&#8217;t looked at kernel source since 2.6 so it may already be there). This would be trivial to implement as the &#8220;old&#8221; behavior is the default where a modern Intel hwrng equipped chip is not detected.</p>
<p>I think given the way the kernel handles it there is no risk and only potential benefit from using RdRAND in addition to all the other sources of entropy the kernel uses. That said it is important to give users an option to easily disable a feature that some consider controversial.</p>
<p>On an unrelated note I am going to make a hardware RNG in the next few weeks just as a purely academic exercise and teaching tool. My plan of attack is to either use a tiny source coupled to either a Geiger-Muller tube or a CCD. The former would be slightly more expensive but would mean that I could use a very simple microcontroller to detect and time the milliseconds between &#8220;hits&#8221; and then send this stream through a hash to whiten the output. Seeing as one of the boards I was looking at has an integrated temperature and barometric pressure I guess I can use this data too. A simple daemon can read the data from the serial port and pump it straight into /dev/random. The latter idea of using a CCD I don&#8217;t like as much. You could pump the output of each frame from the camera into a bit of code that reports the location of any &#8220;lit up&#8221; pixels which can be expressed as an integer (if we give, say each pixel from the top left corner onwards a number) and add to that the number of dark frames in between hits and the delay in ms between each lit frame. It seems like this would create non trivial overhead on the PC (although it need only be used periodically to seed the PRNG) which is why I like the microcontroller idea much better.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204506">

			<div class="comment by-wakko ">

				<p class="commentcredit">

					<span class="commenter">Wakko</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204506">
						September 18, 2013 2:34 AM					</a>

				</p>

				<p>@Mike<br />
I think you might find this interesting:<br />
<a href="https://www.sparkfun.com/tutorials/132" rel="nofollow ugc">https://www.sparkfun.com/tutorials/132</a></p>
<p>Good luck with your project.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204507">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204507">
						September 18, 2013 2:41 AM					</a>

				</p>

				<p>Wakko: thanks. That looks very simple.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204508">

			<div class="comment by-wakko ">

				<p class="commentcredit">

					<span class="commenter">Wakko</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204508">
						September 18, 2013 2:42 AM					</a>

				</p>

				<p>@Mike<br />
Oh btw&#8230; if you want to increase the speed of the &#8220;hits&#8221; in your geiger tube you might add close to it a source of alpha-particles (assuming that your geiger tube can detect them) such as the one you can find in old smoke detectors (americium-241). Make sure you don&#8217;t pulverize/eat/inhale it or you are in deep trouble.<br />
Another good alternative is to buy on eBay one of those &#8220;glow in the dark&#8221; uranium-glass balls who emit gamma-rays.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204509">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204509">
						September 18, 2013 3:26 AM					</a>

				</p>

				<p>Wakko: I am sure we have a 1 microcurie reference source of cobalt 60 somewhere. Might be perfect.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204510">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204510">
						September 18, 2013 3:44 AM					</a>

				</p>

				<p>@Wakko:  (nice handle, BTW)</p>
<p>I do recommend preserving the mechanical integrity of a smoke detector radiation source.  (Don&#8217;t cut or file, or scratch or abrade with tools, the tiny piece of metal which may be mounted at the center of a metal disc or other structure.)</p>
<p>Believe it or not, such a source <em>if intact</em> is not really dangerous to swallow &#8212; but of course, this is NOT recommended!  The tiny quantity of Am-241 is plated with metals intended to keep the Americium atoms INSIDE the source, and the radiation emitted during the time it takes to pass through the digestive tract is not large.</p>
<p>These sources typically emit between 15000 and 25000 Î± particles / second.  Î± particles are actually the nuclei of helium atoms, and because of their (relatively) giant size have very low penetrating power.  A radiation detector (such as a G-M tube) for these particles must have a very thin window at one end:  this window needs to be near the Am-241 source.</p>
<p>If you put a piece of ordinary Scotch tape over the source, the Î± flux drops essentially to zero:  give it a try!  If you touch the source with your finger, almost all of the Î± particles stop in the outer layers of your skin (again, not the best safety practice to have the source in skin contact).</p>
<p>Smoke alarms use these sources, because they are about as benign a radiation source as one can find (and because the Americium is a byproduct of nuclear reactor operation).  The plastic structure of the smoke alarm fully contains the Î± radiation, and the only gas emission is a minute quantity of harmless helium.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204512">

			<div class="comment by-fabq ">

				<p class="commentcredit">

					<span class="commenter">FabQ</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204512">
						September 18, 2013 5:31 AM					</a>

				</p>

				<p>Based on what I learned in class, it seems that controlling doping at the level required by this paper is really hard, expensive and error-prone. It seems easy to detect this with mask set inspection&#8230; any fabrication experts here?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204513">

			<div class="comment by-dirk-praet ">

				<p class="commentcredit">

					<span class="commenter">Dirk Praet</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204513">
						September 18, 2013 5:34 AM					</a>

				</p>

				<p>@ Wakko Warner</p>
<p><i>What I was simply saying is that the statement of Ts&#8217;o is simply exaggerated and that there is no real reason to even suspect any wrongdoing from Intel.</i></p>
<p>Hanlon&#8217;s razor may apply. @Clive has previously made a couple of good points about their engineers&#8217; competence in that particular field. I very much like @Mike the goat&#8217;s suggestion of an &#8220;rdrand=0&#8221; boot argument so the user/admin can choose whether or not to use it. IMHO simple to implement and everybody happy.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204514">

			<div class="comment by-wakko-warner ">

				<p class="commentcredit">

					<span class="commenter">Wakko Warner</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204514">
						September 18, 2013 9:48 AM					</a>

				</p>

				<p>@MarkH<br />
Thank you for your recommendations and informations.</p>
<p>@Dirk Praet<br />
Yes. I have now read the guide here <a href="http://software.intel.com/en-us/articles/intel-digital-random-number-generator-drng-software-implementation-guide" rel="nofollow ugc">http://software.intel.com/en-us/articles/intel-digital-random-number-generator-drng-software-implementation-guide</a></p>
<p>Of course it is still a black-box&#8230; but i think they put a lot of work and expertize into this hardware random number generator it would be very strange if they would let anyone sabotage it.</p>
<p>If i have well-understood this document then their RNG is incredibly fast&#8230; it tops over 500MByte/s of high-quality random data&#8230; this is well enough to wipe a whole 1TByte HD in a matter of 30 minutes or so&#8230; i still find it hard to believe it&#8230; this is the clear advantage of having something built straight inside the CPU (another advantage is that there is pretty much no way to mess with it).</p>
<p>Since the RDRAND is available at all privilege levels there is not even need to ask for the OS approval before using it&#8230; a couple of assembly lines will do the job and you will know that no one has messed with it. Since it doesn&#8217;t do I/O it doesn&#8217;t require any kernel-level driver. Any user-land software can use it without special privileges.</p>
<p>I am no expert but the architecture includes several self-tests who, i believe, make it particularly hard for an attacker to control it by any external (or internal) means. By reading this document it is quite clear that who made it wanted to make a good, secure RNG&#8230; i would be quite surprised to learn that after all this work they broke it on purpose.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204515">

			<div class="comment by-greg ">

				<p class="commentcredit">

					<span class="commenter">greg</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204515">
						September 18, 2013 12:37 PM					</a>

				</p>

				<p>Clive: you can cause it to stick not initialy but after a short time of operation, so it would get through initial ATE</p>
<p>From the paper: Since the n-dopant is applied to the entire active area<br />
of the p-MOS transistor, including the metal contacts, a direct connection from<br />
these contacts to the n-well is created.</p>
<p>It sounds like they&#8217;re talking about doping a transistor so the output is always high or always low. This should be detectable by ATE.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204516">

			<div class="comment by-brian-m ">

				<p class="commentcredit">

					<span class="commenter">Brian M.</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204516">
						September 18, 2013 1:10 PM					</a>

				</p>

				<p>@gonzo, @MarkH:</p>
<p>&#8220;It is impossible to prove definitively whether a given sequence of numbers (and the generator that produced it) is random.&#8221; &#8212; <a href="http://www.random.org/analysis/" rel="nofollow ugc">Random.org</a></p>
<p>Nothing is a predictor of future entropy when your machine can be rooted.  &#8220;Gee, my white noise generator is giving me a sine wave.  What happened?&#8221;</p>
<p>However, a chip <i>can</i> be tested.  Want to test a big sample?  Get a big sample.</p>
<p>The hack under discussion is that the mask is modified (not a minor thing in semiconductor production) to change the bit range.  If the test suite is any good, a reduction in entropy would be shown.  The Dieharder test result I linked was run for 45 minutes, with a rate of &#8220;~6.374 billion bits <i>per second</i>.&#8221;  That seems to be a sufficiently large sample for analysis.</p>
<p>Random.org states that it samples atmospheric noise for its randomness.  But how do <i>you</i> know that?  It could be another cleverly designed NSA front.  Who can you trust?  Math that you do yourself.  So look at the source code for the test suite, and run it.</p>
<p>At some point, you take your chances with what you have.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204517">

			<div class="comment by-coyne-tibbets ">

				<p class="commentcredit">

					<span class="commenter">Coyne Tibbets</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204517">
						September 18, 2013 1:21 PM					</a>

				</p>

				<p>The solution should be the similar to the &#8220;sock drawer problem&#8221;.  Use the chip to generate, say, 5 billion random numbers and see if there are more than 2<sup>32</sup> unique results.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204518">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204518">
						September 18, 2013 1:52 PM					</a>

				</p>

				<p>Well Clive, you&#8217;ve got me stumped.  You prescribe taking two signals &#8212; one from either side of the diode.  Unless charge is being created or destroyed inside the diode, the voltage waveforms ought to be accurately complementary &#8211; ne c&#8217;est pas?</p>
<p>Is the idea to XOR them as an integrity check against interfering signals?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204519">

			<div class="comment by-alo ">

				<p class="commentcredit">

					<span class="commenter">alo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204519">
						September 18, 2013 2:36 PM					</a>

				</p>

				<p>Onsemi <a href="http://www.onsemi.com/PowerSolutions/product.do?id=MC74HCU04A" rel="nofollow ugc">MC74HCU04A</a> should be suitable for that <a href="http://web.jfet.org/hw-rng.html" rel="nofollow ugc">HW random bit generator</a>.  It is an active part and other manufacturers have similar logic ICs, too.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204520">

			<div class="comment by-maybe-was-me ">

				<p class="commentcredit">

					<span class="commenter">Maybe was me</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204520">
						September 18, 2013 3:03 PM					</a>

				</p>

				<p>@ wasn&#8217;t me</p>
<p><i>&#8220;Or just suppose if a fabless US-based SoC designer like Cavium could be pressured into weakening the encryption in their Nitrox chips. These are so incredibly powerful for offloading SSL and VPN encryption, up to several Gbit/sec, which would be very difficult to do any other way. These may end up in all sorts of appliance and shipped off all over the world. And then you would have backdoored huge volumes of sensitive Internet traffic for many years to come.&#8221;</i></p>
<p>This is precisely what the Snowden documents claim.  From the excerpts of the budget requests the Guardian released, the NSA specifically claims that they are &#8220;working&#8221; to make various VPN encryption chips &#8220;exploitable.&#8221;  There is no mention as to whether this is through sabotage or cooperation from said manufacturer(s).  Indeed, it is likely NSA has means and methods to do both.</p>
<p>The Guardian for some weird reason redacted the precise name and/or manufacturer of the specific chips the NSA was after (perhaps they were foreign companies and the Guardian felt that those were &#8220;operational details&#8221; that didn&#8217;t need to be exposed).  Or perhaps they were American companies that would be embarrassed if it were disclosed they were working with NSA to essentially make their product useless.  Either way, I found it odd that Guardian used redaction.</p>
<p>Also, as an aside, John Gilmore (of IETF) posted an interesting story on the IETF maling list the other day detailing some of his experiences with NSA meddling in the IPsec protocol that was supposed to be a part of IPv6 (this was back in the late 90&#8217;s I believe).  He essentially said the NSA people were making things for more complex and confusing than need be and appeared to be trying to stop IPsec from being a viably secure protocol all together.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204521">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204521">
						September 18, 2013 3:51 PM					</a>

				</p>

				<p>@RobertT: I just did some experiments last year when I was bored. Also, as I said above, I do not have equipment to go above 25MHz or so, but that is not an issue here, you are not going to sample the signal much faster than at 100kHz or so anyways in a practical set-up. You want to run it though an A/D for minimal digitization loss and resilience. Personally, I don&#8217;t trust the designs that amplify it until it is square and then sample it digitally. Too much risk of seeing only a dominant signal, and then shielding, supply filtering, etc. all become a potentially serious issue. With an A/D, you get the noise even if it is being just 10% of the final signal or less. As you need to hash it down anyways (say at an estimated 0.1bit of entropy per A/D sample), that is quite enough.</p>
<p>Use a large entropy pool, mix this in conservatively and you are fine.That is a fundamental difference to &#8220;normal&#8221; signal processing here: You are not concerned about keeping other signals out, you just want to make sure your original signal is still in there strong enough so that it influences final sampling.</p>
<p>So any 2.4GHz or 900Mhz signals do not really matter. (You do not really need to worry about these signals in audio either, do you? You also can also run all sorts of statistical tests and an FFT in addition to detect such a problem on the software side. And if an attacker can place something really close to your hardware, you are screwed anyways, as they then likely can directly manipulate that hardware.)</p>
<p>As to circuits, I did use the classical 2-transistor design from <a href="http://web.jfet.org/hw-rng.html" rel="nofollow ugc">http://web.jfet.org/hw-rng.html</a>, but with a 330R pullup, 12V supply and a pair of BC550C I had lying around. 330R pullup is the smallest not causing thermal overload to the transistors. I found little difference in the signal compared to 10k pullup, but of course less sensitivity to environmental signals. That gives about 50mVss of noise, with a flat spectrum that begins to level off at about 50MHz (could be my equipment though). I tried a number of different setups, and I was going to try a darlington as second transistor, but I got side-tracked and seem to have misplaced my notes. Experiments with single-transistor amplifiers were pretty unsatisfactory, as strongly dependent on the transistor. I will try the HCU idea that alo suggested (@alo: Thanks, should have had the idea to use an explicitly unbuffered one myself!) at some time, but have not yet gotten around to it. OTOH, 50mV is already strong enough for an 16bit audio input and certainly for a microphone input and may be strong enough for other 16bit A/D converters. And depending on the actual sample rate, you can just say screw bandwidth and use an OpAmp as amplifier. (Just don&#8217;t forget the S&amp;H if you do this yourself. A sound-card should already have all this and be fine. OTOH, a soundcard fill have some low-pass filters as well, so make sure not to sample too fast.)</p>
<p>Bottom line is that you do not need that many random bits, and they do not need to be that good individually, as long as you can be sure some quantifiable fraction is actually truly random.</p>
<p>Side note: I did a different generator a long time ago, based on OpAmp input noise. It used a 741 with shortened inputs and came out at something like 400k zero-crosses/sec. And it was sensitive to environment noise like hell. Needed complete encapsulation and a voltage regulator inside that to produce anything useful at all.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204522">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204522">
						September 18, 2013 4:15 PM					</a>

				</p>

				<p>@alo: Just saw that NPX actually gives an example for using the 74HCU04 as analog amplifier in their datasheet. Nice! Only 5Mhz unity-gain bandwidth product, but quite enough and no way to get this cheaper and simpler.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204523">

			<div class="comment by-curious ">

				<p class="commentcredit">

					<span class="commenter">Curious</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204523">
						September 18, 2013 4:44 PM					</a>

				</p>

				<p>Are acceptable random number generators always &#8220;open source&#8221; material?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204524">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204524">
						September 18, 2013 5:41 PM					</a>

				</p>

				<p>@ Mark H,</p>
<ul><i>Is the idea to XOR them as an integrity check against interfering signal?</i></ul>
<p>You could do that but you&#8217;ld get spikes due to phase delay and having differing &#8220;mid-points&#8221; on the logic that converted analog to digital in a simple circuit.</p>
<p>So not XOR ðŸ˜‰</p>
<p>But your idea is on target. If you read back I was talking about both AC and DC grounds which might have given you the clue ,-)</p>
<p>Due to the AC coupling on the amplifiers inputs and outputs you lose the &#8220;mid-point&#8221; voltage. For various reasons limiters etc are bad news so a zero crossing detector is the better way to go. Also &#8220;noise&#8221; is almost by definition asymetric and simply integrating the signal unless done over a long period will not give you the mid-point back, but simple two resistors and take from their junction will give you a mid point for a zero crossing detector.</p>
<p>But also if you integrate this mid-point signal over various time intervals in various ways it will give you an indication of if there are things amiss in the analog section.</p>
<p>In some very broadband systems in the past they have mixed the two noise signals with a phase quadriture oscillator and then fed the two phase quadriture signals into a balanced mixer with DC connected IF. This is in effect a &#8220;direct conversion&#8221; receiver the output of which shows many evils relativly easily.</p>
<p>Whilst Gweihir&#8217;s design will work, running transistors in avalanche mode unless they are specificaly designed for it is not usually a good idea due to the failure modes. And even if you verify one particular transistor from one particular manufacture unless the data sheet specificaly mentions the avalanche charecteristics they are very likely to change for various manufacturing reasons. The big problem with the design is although it&#8217;s simple it&#8217;s not robust and from a security perspective that&#8217;s a major issue. The unoficial CIA moto is &#8220;trust but verify&#8221; for TRNGs thats the wrong way around it&#8217;s &#8220;verify as you trust&#8221; which is the complaint I have with the Intel on chip TRNG, you can not verify it and thats a no no. The other issue as I&#8217;ve mentioned previously on this blog is the difference between real-entropy and faux-entropy there are a number of issues but the big one with entropy-pool systems is the entropy estimator. This should stop values being read from the pool if the real-entropy drops below a certain point. If you get the estimator wrong then you could end up with a pool that is little more than a simple card shuffling algorithm in one direction or loosing most of the usefull entropy by compleatly under reading.</p>
<p>Whilst I have no problem with people experimenting, specifications are there for a reason. You would not want to trust your life on a specification less TRNG any more than you would trust your life in a car built for fun without it being tested against the relavant standards. And from that point of view several dice in a beer glass might be a safer option.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204525">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204525">
						September 18, 2013 5:44 PM					</a>

				</p>

				<p>Come to think of it, the problem with RDRAND is not that it is easy to backdoor. The problem is that it has been made extremely hard to detect a back-doored instance in the field. No JTAG reading before whitening. No possibility to switch whitening off. Both are stupid and unnecessary and do not increase security, no matter what is claimed.</p>
<p>My conclusion is that while there may be no backdoored instances yet, there certainly has been significant malicious influence on the design to prepare for the future deployment of malicious instances. This may not even be the lead designer (David Johnston), but he either has no clue how to design a TRNG that is verifiable in the field or he deliberately allowed or was coerced to allow a design where that is not possible. It is really incompetence or maliciousness (not necessarily his, but some people think differently: <a href="http://blog.jim.com/crypto/rdrand.html" rel="nofollow ugc">http://blog.jim.com/crypto/rdrand.html</a>) here, there is no 3rd option.</p>
<p>And a TRNG that cannot be verified in the field is just dead hardware that eats power and should never be used in any critical function anyways. A pity, this could have been a nifty hardware function.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204526">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204526">
						September 18, 2013 6:33 PM					</a>

				</p>

				<p>@ Gweihir, Clive Robinson, RobertT</p>
<p>Yes the main problem with many cool ideas you guys have been discussing is verifying it isnt subverted and keeps its randomness over time. Im not sure thats doable. Also, amount of numbers generated might need to be high. So, I maintain that it&#8217;s best to use CRNGs with seed generated low tech &amp; hand entered via a trusted path during install or startup.</p>
<p>Manual methods of mine: deck of cards with many removed so only eight ranks exist. (Combine two such for 16). Learn to shuffle &#8220;too well.&#8221; Shuffle it for a min or two. Then, with 8 ranks (2^3) and 4 suites (2^2), we have 5 bits of entropy. 80 bits is considered safe minimum by many that requires 16 cards to produce. Around another 10 give 128 bits. Use a few more to choose the CRNG or any layering of them or iterations before use for each. Then use its output for random numbers.</p>
<p>speedup: Dedicated airgapped cheap machine for making keys and RN&#8217;s decent idea anyway. Use low tech method to get strong CRNG going, then use it to seed other machines. Encrypt its state with strong password and it can be backed up for if you think the CRNG machine was subverted.</p>
<p>Low tech 2: another near zero bias method I came up with was when I noticed 8-sided D&amp;D die correlate to 3 bits perfectly. Divide no of bits you need by 3, round answer up, and do that many 8sided die rolls. Shoebox helps. Testing die for bias is easier than detecting subversion of electric stuff. And cards cant be subverted meaningfully that I know.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204527">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204527">
						September 18, 2013 7:01 PM					</a>

				</p>

				<p>@Clive Robinson: Stop the FUD already!</p>
<p>This is a <em>robust</em> design and it is <em>not</em> my design, but something that has been known for a very long time and if your fuzzily claimed &#8220;failure modes&#8221; where a significant concern, they would be known. It does work and work well with a wide variety of generic small-signal NPN transistors. It works well with a wide variation of emitter current.  Still, running statistical test to detect hardware failure is of course part of any sane TRNG design, as components do fail, and it may not even be the noise source.</p>
<p>However, your FUD about &#8220;midpoint&#8221; is just complete BS, it does not matter here, unless you do a simplistic zero-cross detector design, which I have argued against. Your mentioning of a &#8220;phase quadriture oscillator&#8221; (and that is &#8220;quadrature&#8221;, btw.) is completely irrelevant and only serves to confuse. What have you done, Googled HF design? You certainly do not understand what is being discussed.</p>
<p>You know, I had a lecture once that taught tactics for confusing &#8220;opponents&#8221;, and I detect quite a few of the relevant techniques in what you are posting in this thread. In order to keep the tone civil, I leave the possible conclusions to the other readers, but &#8230;.</p>
<p>I am going to stop now pointing out that what you say is tangential, irrelevant, plain wrong and indicates you do not understand the problem. Be it hereby said for the future things you are doubtlessly going to post.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204528">

			<div class="comment by-muddy-road ">

				<p class="commentcredit">

					<span class="commenter">Muddy Road</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204528">
						September 18, 2013 7:15 PM					</a>

				</p>

				<p>A NO TRUST model of future development is essential.</p>
<p>But, let me make it clear, it&#8217;s  government and corporate leaders that cannot be trusted.</p>
<p>There are many wonderfully talented and intelligent people creating and maintaining the internet who are also honest, ethical and responsible. Most of them certainly work for government or corporations. We can work with those who have not openly or secretly sided with corruption and lawlessness. Are they loyal to Americans or the bosses?</p>
<p>Start small, build out and build up that&#8217;s the way.</p>
<p>As an aside, I agree laws need to be written and the politics of internet communication, privacy,  security  need work, a great deal of work.</p>
<p>However, as it stands right now we have a dysfunctional government that even at this moment is contemplating shutting itself down based on some flaky fantasy.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204529">

			<div class="comment by-rockford ">

				<p class="commentcredit">

					<span class="commenter">Rockford</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204529">
						September 18, 2013 9:20 PM					</a>

				</p>

				<p>@Clive:<br />
<i>The unoficial CIA moto is &#8220;trust but verify&#8221; for TRNGs thats the wrong way around it&#8217;s &#8220;verify as you trust&#8221; which is the complaint I have with the Intel on chip TRNG, you can not verify it and thats a no no</i></p>
<p>A question:<br />
Is it possible to verify or even reverse engineer an on chip TRNG using an optican microscope and either 1) endless amount of patience or 2) some pattern recognition software that reads the input from the microscope?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204530">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204530">
						September 18, 2013 10:14 PM					</a>

				</p>

				<p>@ Wakko and Mike the Goat</p>
<p>Re Smoke Detectors</p>
<p><a href="http://www.cs.berkeley.edu/~daw/rnd/smoke-alarm" rel="nofollow ugc">http://www.cs.berkeley.edu/~daw/rnd/smoke-alarm</a></p>
<p>&#8220;Dr. Mike&#8221; was apparently working on that a while back. Several people thinking about an idea is usually a good sign. Publish your design if you can make one out of cheap smoke detectors that&#8217;s also cheap and easy to build. Alpha particles aren&#8217;t that dangerous so there might be some take up of <em>that</em> radiation-based design. ðŸ˜‰</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204531">

			<div class="comment by-martinr ">

				<p class="commentcredit">

					<span class="commenter">martinr</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204531">
						September 18, 2013 10:37 PM					</a>

				</p>

				<p>what puzzles me most about Intels RDRAND:  Why the hell do they artificially thin out the randomness from 1.5Gbit/s into 6Gbit/s?  this will amplify the bias of the collector.  The AES-CBC-MAC conditioner will make the bias invisible to the statistical tests, but not make it go away.</p>
<p>For robustness, it would have been better to compress the output from the collector by a factor (1:4 or more) e.g. using a secure hash function.  This would have taken care of most bias and weak/bad sample related issues already.  With the DRNG forced between the entropy source and the RDRAND output a software-based compression of several consecutive RDRAND outputs seems necessary, maybe something like 17:1 or 23:1</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204532">

			<div class="comment by-jon-dubois ">

				<p class="commentcredit">

					<span class="commenter">Jon DuBois</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204532">
						September 18, 2013 11:38 PM					</a>

				</p>

				<p>Wouldn&#8217;t reducing the entropy by a factor of 2^96 show up in many statistics tests? Couldn&#8217;t you just compare it to several software generators?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204533">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204533">
						September 19, 2013 12:45 AM					</a>

				</p>

				<p>@Gweihir<br />
  I&#8217;d suggest you study the effects of high power RF ingress into unprotected circuits before concluding that everything Clive says is FUD.</p>
<p>With sufficient field strength EVERY bit of wire in the system becomes an antenna every diode a rectifying (down-modulating) junction. With high field strength 2.5Ghz of power supply lines become small resonant antennas, look at the &#8220;self resonant frequencies&#8221; for even the best decoupling surface mount capacitors, you&#8217;ll see that most ceramic caps have SRF&#8217;s well below 1Ghz.  Wire lengths of just a few cm&#8217;s can will have a few nano henrys of inductance. Look at what this means for single ended reference signals (say the bandgap reference use by your ADC)</p>
<p>Now you might say this is all so far out of the signal band BUT once you sample it you effectively down convert the RF signal and its modulation.  The Beat pattern from this down conversion might still fall out of band, or it might not, to know which you&#8217;ll need to do some good old fashioned RF signal planning.</p>
<p>High field strength RF ingress might not be of concern for the average home PC owner but it is definitely something to consider IF you are trying to keep state level adversaries out of your high value commercial server systems.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204534">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204534">
						September 19, 2013 3:17 AM					</a>

				</p>

				<p>@Gweihir:</p>
<p>This is almost completely redundant with RobertT&#8217;s comment, but maybe I can put it a little differently:</p>
<p>1) Clive&#8217;s info is (as far as I can tell, and I&#8217;ve been following this blog for a long time) predominantly based on real-world experience.  Sometimes I disagree with his take on things (and yes, sometimes I get impatient with the way he presents things, though he&#8217;s gotten a lot better at it), but when he says &#8220;X can get you into trouble,&#8221; I consider it prudent to take a damn good critical look at X before making use of it.  In my opinion, attributing unworthy motives to somebody who&#8217;s trying to help means it&#8217;s time to sit down and take some long deep breaths.</p>
<p>2) It doesn&#8217;t matter <b>at all</b> that radio frequencies are outside the band of signals for your circuit.  What matters is whether the <b>modulation</b> frequencies* applied to those RF carriers are in your circuit&#8217;s band.  Because the circuit&#8217;s signal band corresponds (very roughly) to audio frequencies, the likelihood of modulation in that range is very high indeed.  So in fact, RF signals in the 100s of MHz can very badly bias an RNG that operates only in the kHz range.</p>
<p>*As RobertT notes, in practice there can be situations that are more complex than this.  I refer to the simplest (and most benign) case.</p>
<hr />
<p>Anyone not already aware of point 2 has BIG knowledge gaps concerning electronic engineering.  I learned about the dangers of unintended RF detection to signal processing circuits before I learned to drive a car &#8212; and I&#8217;m reminded of this problem every time I&#8217;m listening to music and a truck driver passes my house with his AM transmitter keyed ðŸ™‚</p>
<hr />
<p>I wouldn&#8217;t bother to make a hardware RNG unless I took confidentiality very, very seriously.  And because I take confidentiality very, very seriously, I want to educate myself about <i>real-world</i> failure modes.  If an RNG is inadequately protected from RF interference, it could make long bursts of nastily biased output, even while passing 100 tests a day.</p>
<hr />
<p>Bruce has tried to explain the &#8220;security mindset.&#8221;  Plain Old Regular Engineers focus the majority of their attention on How Things Work.  Security Engineers don&#8217;t worry much about that (that&#8217;s what Plain Old Regular Engineers are for).  Security Engineers are constantly exploring, &#8220;how can this fail?&#8221; and &#8220;how can it be INDUCED to fail in a way that breaks security?&#8221;</p>
<p>Clive seems to have a near-encyclopedic knowledge of security-compromising failure modes.  Sometimes I wonder whether he soldered triode valve circuits for A. M. Turing.</p>
<hr />
<p>Before I finish my sermon, two anecdotes I found instructive:</p>
<p>A.  (read in a magazine) A man who had worked as a telegrapher (this was a job category once!) when he was very young had ajdusted the pivot screws nice and snugly on his telegraph key.  An old-timer told him, &#8220;you&#8217;ve got to leave some play on that key, or you&#8217;ll get glass elbow.&#8221;  The youngster ignored this advice, and learned to his considerable pain what glass elbow is.</p>
<p>B.  (told by a gentleman I met some years ago) As a youngster, he worked in shop making furniture.  For cutting very large pieces, they had special cutting room with a giant circular saw that was suspended from a rig on the ceiling that enabled it to be moved about anywhere in the room; the operator would walk the saw about to make the cut.  He was preparing to cut a large piece of maple to size, and an old-timer said, &#8220;you&#8217;ve got to watch that maple:  it&#8217;s hard, and then it&#8217;s soft.&#8221;  He only understood what that meant when he suddenly found himself with the whirring saw blade a finger&#8217;s breadth from his chest.</p>
<p>I think of Clive as an &#8220;old-timer&#8221; who has collected a lot of lore about how things can go wrong, and is generous enough to take his time to educate people on this blog.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204535">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204535">
						September 19, 2013 5:00 AM					</a>

				</p>

				<p>@ Rockford,</p>
<ul><i>Is it possible to verify or even reverse engineer an on chip TRNG using an optican microscope and either 1) endless amount of patience or 2) some pattern recognition software that reads the input from the microscope?</i></ul>
<p>I&#8217;m not the best person to answer this but I&#8217;ll say what I understand the problems are.</p>
<p>Firstly visable light optical methods won&#8217;t work due to the wavelength -v- transistor size. So you have to think in terms of optical methods that use much shorter wavelength (there is an old rule of thumb that indicates 16:1, that is the wavelength should be atleast 16 times shorter than the dimension you are trying to measure). But that aspect is just the start of the problem so we will ignore it for now.</p>
<p>Semi-conductors are often thought of as two dimensional not three dimensional objects and without being destructive you can not look inside a box that is not transparent to the frequency you are using.</p>
<p>So you have to ask an important question,</p>
<p>If I destructivly examine the contents of the box is it possible to have hidden features that get destroyed as part of the process of the destructive part of the examination?</p>
<p>And as far as I can tell the answer to that is likely to remain yes, which if true would mean the answer to your question is unfortunatly no.</p>
<p>However, the US DoD is putting a very large pile of money on making the answer to the question yes. If not 100% yes atleast some significant percentage of yes.</p>
<p>Is this a usefull thing to do? I actually think so.</p>
<p>The reason for this is one of dividends. If they find methods to find a significant fraction of such subvertion then it makes it ever increasingly expensive for those trying to subvert the system. And yes it becomes a game of cat-n-mouse with ever increasing cost which would appear endless, which on it&#8217;s own simply becomes a game of who can outspend their opponets perceived or actual.</p>
<p>But there is another aspect to consider which is plurality of supply lines. At some cost point it becomes less expensive to switch to a mitigation methodology. With out going into the ins and outs of it you can as NASA did with their &#8220;voting systems&#8221; half a century ago find ways to see changes in behaviour that would otherwise be difficult to detect.</p>
<p>In this way you accept the fact that systems &#8220;may&#8221; be untrustworthy but design it out of the system to the point it can be mitigated to the required level of confidence.</p>
<p>Ultimately it becomes security by obscurity where by the oponent has to guess what measures the deffenders use to detect them, and they have to get each and every one right or lose the game. The defender on the other hand does not, thus the attackers costs rise at some power law above that of the defender (this is the opposit way around to what is considered the normal defencive problem with attackers where you hear &#8220;the terrorists only have to get lucky once&#8221;). In effect it becomes &#8220;probabalistic security&#8221; with the high cost going to the attacker not the defender.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204536">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204536">
						September 19, 2013 6:14 AM					</a>

				</p>

				<p>@ Rockford,<br />
&#8220;Is it possible to verify or even reverse engineer an on chip TRNG using an optican microscope and either 1) endless amount of patience or 2) some pattern recognition software that reads the input from the microscope?&#8221;</p>
<p>Up until about 10 years ago it was easy to reverse engineer almost any chip with just a microscope a camera an XY moveable stage and a diamond polisher . Basically you take photos and move the stage by so and so many mm on one axis, take another photo and repeat.</p>
<p>Once you have photographed the top layer you take the diamond polisher and polish back the surface to remove the top layer and repeat the photo process on the next layer. A chip might have 7 levels of metal and one level of Poly typically the rest of the layers are uninteresting because you can guess them.</p>
<p>With a little work you can identify the logic gate function for each of the patterns, this gives you all the logic primitives used on the chip you than only need to figure out how they connect to one another.  The interconnect information is like a of wiring list for a PCB.</p>
<p>With all of this information you can now simulate the circuit and see exactly what it does.</p>
<p>With something like a TRNG the real secret sauce will be in the ways in which the &#8220;random&#8221; events are generated.</p>
<p>Most on chip TRNG&#8217;s uses multiple jittery ring oscillators that are sampled at a rate significantly below the cycle jitter accumulation rate. (if say a 10Mhz oscillator is used than it might accumulate 2 nsec of jitter per cycle so we want more than 100nsec of unknown meaning you sample this jittery ring oscillator with a fixed frequency source (at less then once every 50 cycles = 50*100nsec = 5usec.<br />
This gives you one bit of random data every 5usec repeat for extra bits.</p>
<p>Just because MOST Trgn&#8217;s are done this way it does not mean that ALL Trng&#8217;s do this. Today it is becoming common to use higher order Sigma Delta modulators as the noise source (these operate as chaotic circuits where small errors get accumulated and multiplied by the loop gain) To analysis this circuit you&#8217;ll need to understand how to simulate Sigma Delta modulators and use tools like Spice to simulate. The exact way this noise shaping loop works will depend on the interaction of the on chip capacitors and maybe resistors in the loop. You need to have a fair idea what you are looking at before you know how to simulate it.</p>
<p>OK so this was what happened 10 years ago, today thing can be done the same way but the process is made more difficult because the structures are below 1/10 of the wavelength of viable light. You can compensate by using deep UV optics with a 130nm illumination laser. With this process you&#8217;ll be just about able to extract a 45nm chip, remember the cell dimensions will still be several 100nm so you can still figure out what cells are used and still kinda trace the interconnect.  At sub 20nm I&#8217;m not sure how to reverse engineer a chip.</p>
<p>Part of the problem is that there is no pointer saying LOOK HERE TRGN, so you must figure the location of the cell by other means (It helps if you can find an ISSCC presentation with a chip photo)</p>
<p>BTW&#8221; if you dont want to do this yourself there are specialty companies that will do the whole reverse engineering for you. for something like a 20nm TRGN you would probably need to pay them somewhere between $10K and $100K.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204538">

			<div class="comment by-z-lozinski ">

				<p class="commentcredit">

					<span class="commenter">Z.Lozinski</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204538">
						September 19, 2013 6:53 AM					</a>

				</p>

				<p>@Clive, @Rockford,</p>
<p>There is a nice article on the &#8220;The State-of-the-Art in IC Reverse Engineering&#8221; (from 2009) written by two engineers from Chipworks, and hosted by the International Association for Cryptologic Research.  Chipworks is a reverse engineering company.</p>
<p><a href="http://www.iacr.org/archive/ches2009/57470361/57470361.pdf" rel="nofollow ugc">http://www.iacr.org/archive/ches2009/57470361/57470361.pdf</a></p>
<p>Clive has already mentioned the problem of using an optical microscope.  The Chipworks paper has a case study of the reverse engineering of a Sony camera chip, and there is a  scanning electron micrograph (SEM) showing the planar structure of the 3 transistors that form the circuit behind an individual pixel sensor.   You can also use SEM to give the profiles through the chip and see the 3D structure, which shows you the interconnects and metal layers.</p>
<p>The authors also make the point that you can use scanning capacitance microscopy to determine positive and negative doping.  SCM was invented in IBM Yorktown in the late 1980s, and the original application was semiconductor dopant profiling.</p>
<p>The legal aspects of this are are covered by the American Bar Association:</p>
<p><a href="http://www.americanbar.org/newsletter/publications/gp_solo_magazine_home/gp_solo_magazine_index/intellectprop_judicialsupport.html" rel="nofollow ugc">http://www.americanbar.org/newsletter/publications/gp_solo_magazine_home/gp_solo_magazine_index/intellectprop_judicialsupport.html</a></p>
<p>So, if you don&#8217;t have someone who is actively trying to make a chip (or a part of a chip) that cannot be reverse engineered, you should be able to analyse it.   For current chip technology, assume a lab with (I&#8217;m guessing) upwards if $100K of equipment.  A university physics lab would have what you need.   Then you need staff to do the actual analysis (or graduate students).</p>
<p>If you have an organization actively trying to make the chip hard to reverse engineer, then as Clive says, you are in an arms race.  Don&#8217;t bet against FIPS 140-2 &#8220;Level 4 attackers&#8221; (ie state-funded actors).  There is a lot of interesting history in the evolution of the protection of banking hardware security modules (HSMs) which shows this sort of arms race in action.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204539">

			<div class="comment by-z-lozinski ">

				<p class="commentcredit">

					<span class="commenter">Z.Lozinski</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204539">
						September 19, 2013 8:21 AM					</a>

				</p>

				<p>Some fun reading.  Sergei Skorobogatov, from the Computer Lab in Cambridge, has written up all the techniques he knows for reverse engineering hardware.</p>
<p>There are some nice pictures of just what sort of information you can extract from a chip with various technologies from fuming Nitric Acid to lasers and infra-red cameras.</p>
<p><a href="http://www.cl.cam.ac.uk/~sps32/PartII_040213.pdf" rel="nofollow ugc">http://www.cl.cam.ac.uk/~sps32/PartII_040213.pdf</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204540">

			<div class="comment by-rockford ">

				<p class="commentcredit">

					<span class="commenter">Rockford</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204540">
						September 19, 2013 8:46 AM					</a>

				</p>

				<p>@Clive Robinson, RobertT, Z.Lozinski</p>
<p>Thank you for your insight. You guys rock!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204541">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204541">
						September 19, 2013 9:01 AM					</a>

				</p>

				<p>Clive et al: there is an interesting paper on dopant level compromising of the Intel RNG <a href="http://people.umass.edu/gbecker/BeckerChes13.pdf" rel="nofollow ugc">here</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204542">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204542">
						September 19, 2013 10:08 AM					</a>

				</p>

				<p>Hmm, off topic but just doing a bit of rough mass based on the 90000sqft data center area of the new MD facility of the NSA. Scary but using COTS hardware I described earlier they would have the ability to try 1,986,584,000,000 tries a sec at an AES key when brute forcing. Now if that space was filled with /custom/ ASICs then the figure would be astronomically scary. Which is why I use 4096 bit RSA when I have to use asymmetric.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204543">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204543">
						September 19, 2013 11:36 AM					</a>

				</p>

				<p>@ Jon DeBois,</p>
<ul>Wouldn&#8217;t reducing the entropy by a factor of 2^96 show up in many statistics tests? Couldn&#8217;t you just compare it to several software generators?</ul>
<p>Simple answers not always, not realy.</p>
<p>The longer answer goes back something like 150 years ago to a man who probably more than any other put the nail in the coffin of &#8220;pre-ordained&#8221; and &#8220;all-knowing&#8221; which prior to the 20th century had led mathematicians to belive that all questions were answerable even when dealing with &#8220;God&#8217;s Domain&#8221; of infinity.</p>
<p>Georg Cantor was not a happy bunny about the then almost universal mathmatical view of the world and some time prior to 1874 he had come up with a simple and very elegant argument as to why it was wrong. However for reasons unknown he chose to publish a much more almost impenitrable argument that in many ways was ignored (as I shall now do ðŸ˜‰</p>
<p>Although published much later his simple &#8211;Cantor&#8217;s diagonal&#8211; argument can be seen as the death knell of the old order and both Kurt Godel and Alan Turing used it for their to seminal works that have defined the limitations of logical systems and computer long before the first computer was built (neither Pascal or Babbage count for differing reasons).</p>
<p>The diagonal argument deals with infinite sequencies and shows that no matter how many you know there will be many times more.</p>
<p>The most fundemental difference between a TRNG and a PRNG is the former &#8211;is in theory&#8211; infinite and non determanistic and the latter finite and determanistic.</p>
<p>Thus a TRNG could push out any sequence at any time whilst a PRNG will only push out a predetermined sequence. But there is a problem there is the issue of what the observer sees at the output of the black box RNG. For each bit out there can be two choices as the sequence continues as you would expect there is 2^N possible sequences but&#8230; how many generators are there?</p>
<p>The answer is you don&#8217;t know and you can&#8217;t know you can only say that in human terms there is adefinately one for each sequence seen (actualy it&#8217;s rather more than infinity if you look at Cantor&#8217;s other work). Further it&#8217;s actually not possible to say if the sequence you have observed is the product of a PRNG or a TRNG that by chance has generated that sequence.</p>
<p>Thus all sequences are in effect equiprobable and all those you can observe are by definition finite which is a very small fraction of what sequences are possible. So for what ever statistical test you devise to try to measure a finite sequence you cannot do any more than say &#8220;there is a generator that has produced this sequence and it has passed the tests that stand witness to it&#8217;s lack of statistical anomalies tested for&#8221;. It&#8217;s why a CS-PRNG can stand in for a TRNG over a short length of it&#8217;s output, and if it&#8217;s state size is large enough then from any normal measure it can not produce sufficient output for you to be able to tell if it is a TRNG or CS-PRNG.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204544">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204544">
						September 19, 2013 12:02 PM					</a>

				</p>

				<p>@ RobertT</p>
<blockquote><p> Up until about 10 years ago it was&#8230; </p></blockquote>
<p>Great info&#8230;</p>
<blockquote><p> 20nm TRGN you would probably need to pay them somewhere between<b> $10K and $100K.</b> </p></blockquote>
<p>I am surprised this is a lot cheaper than I thought it would be.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204545">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204545">
						September 19, 2013 1:24 PM					</a>

				</p>

				<p>@Mike the goat:</p>
<p>There&#8217;s plenty to be scared about &#8230; but probably not their ability to crack encryption.  That&#8217;s why backdoors (such as the topic of this thread) are so important.</p>
<p>To find a 128-bit key by exhaustive search needs (on average) about 170,000,000,000,000,000,000,000,000,000,000,000,000 tries.  The best known attack on a single AES-128 key reduces that only by half.  Bearing this in mind, the ability to test 2,000,000,000,000 keys per second is utterly useless (unless NSA has broken your PRBG, see topic of this thread).</p>
<hr />
<p>As to RSA:  all public key systems depend on &#8220;computational security,&#8221; which means that any key can be cracked by executing algorithms that are much, much faster than exhaustive search, but whose cost is high enough to render cracking impractical.</p>
<p>Usually, cryptographers speak of cost rather abstractly, by quantifying the &#8220;order&#8221; of operations required to complete the algorithm.</p>
<p>However, it can be amusing to make the cost estimate more concrete.  Elsewhere on Bruce&#8217;s blog, I estimated that factoring a 1024-bit RSA modulus (the best known attack) using GNFS (the best known algorithm) would consume at least $200,000 of electricity.  Allowing for improvements in technology, and perhaps better electric rates, let&#8217;s take this to be $100,000 today.  The way GNFS factoring scales, the number-crunching to factor a 2048-bit RSA modulus would be at least a million times greater (actually, a lot more than a million).  But as a baseline figure, let&#8217;s say $100,000,000,000 of electricity.</p>
<p>Leaving cost to one side (NSA would need several years of their whole budget, to buy the electricity of factor ONE MODULUS), to perform this factoring in one year would require continuous 24-hour-per-day consumption of more than one quarter of the entire electrical generation capacity in the United States.  This is to say nothing about the quantity of hardware required, and how much that would cost.  Also, you might enjoy sparing a moment to ask &#8220;how do I cool my data center at a rate of 200 gigawatts?&#8221; (if I don&#8217;t, temperatures will rise problematically &#8212; and given the poor efficiency of typical cooling systems, cooling can increase energy total cost by a substantial margin).</p>
<p>For 4096 bit RSA, the cost becomes much, much worse.</p>
<p>Now, this analysis assumes:</p>
<p>(a) NSA didn&#8217;t break the random generator used to create the key (per topic of this thread)</p>
<p>(b) nobody has discovered a better attack on RSA than factoring the modulus</p>
<p>(c) nobody has discovered a factoring algorithm better than GNFS</p>
<p>(d) most efficient available off-the-shelf computer hardware doing the computation</p>
<p>Note that with respect to (d), although NSA obviously can afford to do custom silicon development, what really matters isn&#8217;t speed:  it&#8217;s the number of joules per arithmetic operation.  The optimum for this probably won&#8217;t be the latest super-duper CPUs (or GPUs), but rather fairly generic medium-speed processors.  It seems unlikely to me that the energy per computation could be improved over the commercial state-of-the-art by better  than a factor of 10 &#8212; most of the world&#8217;s computing capacity is now (or at least, will shortly be) in people&#8217;s pockets, powered by lightweight batteries, so a LOT of R&amp;D goes into efficiency.</p>
<p>Let&#8217;s give NSA the benefit of hyper-optimized (factor of 10) hardware.  If the hardware is free (say, found in a dumpster), and they are willing to devote almost all of their budget to paying for electricity (thereby, firing most of their employees and contractors), they could factor one 2048-bit modulus per year.  Still, the computer cluster&#8217;s power consumption would likely exceed the output of the world&#8217;s largest generating station (the Three Gorges Dam in China).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204546">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204546">
						September 19, 2013 3:31 PM					</a>

				</p>

				<p>Mark: of course my estimate doesn&#8217;t get them nearly close enough to breaking, say an AES128 key. That said, it is a frightening amount of computational capacity when you take into account what else they may have up their sleeve to reduce their workload. My fear is that they have a viable cryptanalytic attack on AES. It is my opinion that a government doesn&#8217;t push a technology unless it has the technology somewhere to break it (eg DES). If this is the case, even if moderately computationally expensive then all bets are off. I have similar concerns about the RSA problem. It is admittedly unlikely but they may have a breakthrough on factorization.</p>
<p>That said if I was the NSA I would not even bother with this route and would instead pursue ways to leak keys, weaken crypto hardware etc.</p>
<p>Something to consider &#8211; let&#8217;s pretend they did subvert a popular VPN concentrator as reported and they didn&#8217;t have it leak its key in some crafty manner. Pretend that the keys generated are made correctly but with a very low entropy (deliberately) RNG, ala a deliberate Debian SSL bug (but not quite as weak and overt). Your big cluster would now be necessary for breaking these weak keys.</p>
<p>Even better have the RNG doing something that looks random but isn&#8217;t, like encrypting the output of the RTC with AES. They know the key, they know the time (and the device is likely NTP enabled so there is a fair amount of accuracy there) so they should be able to work from there.</p>
<p>My thoughts on RSA are to trust it but increase the safety margin to 4096, which should be well above any technology we could anticipate them to have (unless they have fundamentally broken it by a new means of factoring). I don&#8217;t think it is unreasonable and ads minimal overhead.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204547">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204547">
						September 19, 2013 4:49 PM					</a>

				</p>

				<p>@ people worrying over RSA</p>
<p>There was a method that was resistant to classical and quantum attacks on signature schemes. Impractical esp due to size of data. Today, we have tons of bandwidth/storage and a bunch of solid hash functions. So&#8230; <b>Merkle signatures</b> to the rescue?</p>
<p><a href="http://www.emc.com/emc-plus/rsa-labs/historical/recent-improvements-efficient-use-merkle-trees.htm" rel="nofollow ugc">http://www.emc.com/emc-plus/rsa-labs/historical/recent-improvements-efficient-use-merkle-trees.htm</a></p>
<p>Simpler alternative: sign with multiple signatures each using a different hard problem (RSA, NTRUsign, etc.). Can combine them HMAC style to prevent transferring several KB of signatures on every transfer. And remember that we only need asymmetric for secret exchange if non-repudiation isn&#8217;t an issue. From that point, our symmetric algorithms can do all the work.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204548">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204548">
						September 19, 2013 5:52 PM					</a>

				</p>

				<p>@RobertT: It is really not a concern here. First, you have a very low source impedance and a pretty strong signal. Second, and I guess this is something all the folks here that understand RF engineering have real trouble coping with, as long as you have enough of the noise signal left (and you do not need a lot), all the interference in the world does not make it circuit fail. I know where well that shielding is a major concern in RF design as most circuits become unusable even with a little interference. Not so here.</p>
<p>That said, my impression is that Clive has really no clue about RF engineering, but googeled a few things. Requiring mu-Metal for RF shielding is just stupid, as it pretending lead-in capacitors are somehow special (or needed here). His non-understanding that doing zero-cross detection only results in a very non-resilient design is telling. And his claim that the avalanche-construction is a severe risk and on amateur level is just plain wrong.</p>
<p>What really annoys me though is that he tries to sabotage the discussion for a little self-aggrandizement. That is just plain repulsive and immoral.</p>
<p>@Mark H: The modulation frequency does only matter unless it is a modulation the circuit can actually decode and the base carrier does not get dampened out. Just to be sure, I have placed my cellphone next to a sample circuit and made a call. No change in the output spectrum at all. That tells me that the argument about interference and &#8220;modulation&#8221; is nonsense for <em>this</em> circuit, just as I expected. What you seem to forget, is that this is a very low impedance source and that coupling something there requires massively more RF energy and that the components are far too slow to be able to demodulate the frequency ranges in question.</p>
<p>And no, Clive&#8217;s comments in this discussion are laced with nonsense, blustering and wrong information. Sorry, but he just has no clue here and seems to be desperate to hide it and thereby hurts everybody looking for information. He is spreading FUD, nothing more.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204549">

			<div class="comment by-gonzo ">

				<p class="commentcredit">

					<span class="commenter">gonzo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204549">
						September 19, 2013 7:36 PM					</a>

				</p>

				<p>All&#8230;. I don&#8217;t think we&#8217;re well served by bickering with each other or getting into e(ngineering) dick measuring contests.</p>
<p>Frankly, none of us here likely will use a hardware RNG based on a home built circuit. None of us have that sort of problem. A RNG in hardware we can trust on a system that is not compromised is the goal. Lets keep our eyes on it and avoid the circular firing squad.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204550">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204550">
						September 19, 2013 8:57 PM					</a>

				</p>

				<p>gonzo,</p>
<p>I concur that the place we&#8217;d like to reach, is to have trustworthy components and systems generally available.</p>
<p>To the extent that this can be accomplished, it is likely to take a decade.</p>
<p>Today, tomorrow, and for years to come, there are and will be people and organizations with critical security requirements, who need trustworthy solutions before our hoped-for nirvana is attained.</p>
<p>And some of them &#8220;likely will use a hardware RNG based on a home built circuit.&#8221;  This is not an academic exercise.</p>
<p>In governments we have dangerous* adversaries who not are only extremely powerful in resources, but also actually using the compulsion of law and police power to force substantial <i>organizations</i> to become secret accomplices.  How many integrated circuit foundries are beyond the reach of such compulsion?</p>
<p>The security community is in a situation analogous to an intelligence organization just learning that a &#8220;sleeper&#8221; agent was imbedded in it for years.  It&#8217;s unlikely that EVERYTHING is compromised &#8230; but every technique, every file, every device, every operation, MAY have been compromised in some way.  In order to restore security, everything must be assumed to be contaminated until its soundness has been carefully evaluated.</p>
<p>It has become reasonable to assume that any factory-produced TRNG has a non-negligible probability of having been intentionally compromised.  As has been discussed here, when the (supposedly) random bit source is inaccessibly enclosed in a black box, it is impossible by inspection of outputs to verify that they are actually unpredictable.  The availability of unpredictable numbers is the root foundation of all cryptographic symbol-manipulation techniques &#8212; so an anti-confidentiality organization like NSA (or, almost certainly, the government of PRC) must consider the compromise of RNG hardware an extremely high value target.</p>
<p>Personally, I find paranoia and conspiracy theories to be exceedingly irritating, and almost always brainlessly stupid.  I don&#8217;t like being railroaded into a situation where paranoia is the cautious default posture.  Unfortunately, it is what it is.</p>
<p>*empowered to imprison and (in the countries containing most of humanity) kill, openly and legally</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204551">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204551">
						September 19, 2013 10:07 PM					</a>

				</p>

				<p>@ MarkH</p>
<p>Well said! The comparison to an organization learning of a sleeper is excellent.</p>
<p><b>The analogy implies the correct response ðŸ˜‰</b></p>
<p>Of course, knowing that we&#8217;re being hit with that kind of panic we should remember our own advice to lay people after 9/11: don&#8217;t panic. We have to remain calm. We must rationally address the situation and not let our paranoia feed into the analysis too much. We must identify risk areas, then make mitigating decisions where possible.</p>
<p>One thing that helps me is that they don&#8217;t have full access to everything. Their leaks don&#8217;t indicate that. If anything, their leaks indicate they tried to unnoticeably <em>weaken</em> many important things for <em>future</em> attacks. And what they weakened was mostly made by American companies. This should relax INFOSEC pro&#8217;s in that it tells us:</p>
<ol>
<li>We might be safe[r] if we just augment the security-critical functions of COTS gear that they likely targeted.</li>
<li>We can probably rely on foreign made chips to not have NSA backdoors, although we should assume host govt might have one &amp; test for counterfeits.</li>
<li>The countries identified in leaks to be targets of NSA activities will become safer for both data and security-critical products in near future as they try to resist US subversion (or US anything).</li>
<li>That NSA&#8217;s adversaries know they have strong focus on traffic analysis can be used against them by smart adversaries.</li>
<li>
<p>That NSA prefers subversion might boost the use of both open-source and subversion resistant development processes.</p>
</li>
</ol>
<p>So, far from extreme paranoia, people concerned for their privacy have much to be grateful for and happy about. I mean, imagine if our country had the SS with NSA&#8217;s tech: none of us would be openly talking about this and any counter move would be <em>very</em> hard to pull off. We&#8217;re all speaking, breathing, having public conversations, private one&#8217;s too albeit anxiously, and have strategies for handling parts of the situation near-term. We remember this, then maybe we all stay sane and come up with ways of reducing our risk until a real solution emerges. If it does.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204552">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204552">
						September 19, 2013 11:29 PM					</a>

				</p>

				<p>@Mark: I know someone else mentioned this elsewhere but Linus the other day was asked at a conference whether the NSA had attempted to subvert the Linux kernel. He answered in the negative while nodding in the affirmative. Whether he was joking or was trying to hint at just thst , perhaps without overtly violating an NSL or gag order is anyone&#8217;s guess.</p>
<p>The problem we all face as system administrators and security oriented IT professionals is that our employers pay us to ensure their machines are secure. We can no longer even testify to the fact that we believe them to be safe (although really we never could warrant them bug or remotely exploitable flaw free) and this might be an issue for the eagles in the legal dept as they ponder compliance with infosec legislature and for those organizations who handle financial data Sarbanes-Oxley &amp;c.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204553">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204553">
						September 20, 2013 3:16 AM					</a>

				</p>

				<p>@Nick:</p>
<p>Personally, I don&#8217;t think it particularly likely that the Intel RNG has been subverted.  Regrettably, I don&#8217;t know any way to confirm this, and it doesn&#8217;t seem plausible that anyone will be able to give assurances on which we can rely.</p>
<p>Though NSA  and the FBI certainly don&#8217;t have access to everything, giant US companies like Intel are (ironically) the most vulnerable to their hammers of persuasion.  It would seem completely sensible to me, for an NSA infosec boffin working on the problem of increasing world-wide traffic visibility to advise &#8220;go for the Intel RNG &#8212; it will pay us back more than any other measure we can possibly take, and <i>at very modest expense</i>.&#8221;</p>
<p>Those of us with engineering ability can concretely make some little steps to advance the situation, even though there will be many problems that remain difficult to remedy.</p>
<p>Starting from the premise that if your random source is broken, then EVERYTHING is broken, I think it should be entirely practical to publish &#8220;open source&#8221; build-it-yourself TRNG designs &#8212; and also to provide certain materials for them, in such a way that everything is 100% auditable.  In other words, to set up a trust-worthy source whose message is &#8220;don&#8217;t trust us concerning ANYTHING &#8212; you can and should verify the security case yourself.&#8221;  This would be the diametric opposite of Intel.</p>
<p>Ordinary consumers will never go that route, nor commercial operations.  But there will be individuals and organizations around the world needing to take high precautions, with life, limb and liberty at hazard.  It&#8217;s possible to provide options for these cases, and I think there are enough geeks who &#8220;support the cause&#8221; to provide the necessary technical backup (mainly, in the form of painstaking security design review).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204554">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204554">
						September 20, 2013 4:34 AM					</a>

				</p>

				<p>@gonzo: Actually, I am in the process of deploying a TRNG in an experimental fashion. That is why I have looked at these things for a while.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204555">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204555">
						September 20, 2013 5:33 AM					</a>

				</p>

				<p>@ Gweihir,</p>
<p>I realy don&#8217;t know what your issue is and what you are saying is not helping you, as the comments of others are indicating.</p>
<p>Especialy when some of your statements are just wrong and apear to be based on what you would like to think I am saying, not on what I am actualy saying.</p>
<p>In your latest posting you say,</p>
<ul><i>Requiring mu-Metal for RF shielding is just stupid, as is pretending lead-in capacitors are somehow special (or needed here). His non-understanding that doing zero-cross detection only results in a very non-resilient design is telling. And his claim that the avalanche-construction is a severe risk and on amateur level is just plain wrong.</i></ul>
<p>I&#8217;ve only refered to mu-metal once and I said,</p>
<p>&lt;</p>
<p>ul&gt;As for sheilding you need to issolate the noise source from the amplifier and dc filtering and in turn shield all three from other parts of the circuit. There are shielding materials and shielding materials silver plated mu-metal has been used in the past but is impractical for most home constructors.</p>
<p>&lt;</p>
<p>ul&gt;</p>
<p>I have quite clearly said &#8220;silver plated mu-metal has been used in the past&#8221; which is a verifiable fact, I also went on to say &#8220;but is impractical&#8221;. So I&#8217;m not sure how you think I am saying it&#8217;s required&#8230; Perhaps you would care to state how you arived at that idea, especialy when I explained another method in some detail immediatly after my statment about it being impractical?</p>
<p>Further contrary to what you say I did not say &#8220;mu-metal for RF shielding&#8221; I said &#8220;silver plated mu-metal&#8221; with respect to shielding &#8211;not &#8220;RF&#8221;&#8211; that issolated the noise source from the dc filtering of the supply and the following amplifier sections. The &#8220;silver plated&#8221; asspect is what provides the RF shiielding the mu-metal is for magnetic shielding. As any audio design engineer over fourty will tell you circuitry dealing with low level signals often needed to be magneticaly shielded from laminated iron E-Core transformers used in the power supply and other places. Low power mains power supply transformers these days come as two basic types laminated iron E-Core which could be problematic in a small enclosure or ferite toroidal transformers that are generaly not problematic unless the core gets damaged.</p>
<p>As for your comments about feed through capacitors if you go back and re-read what I wrote I gave three ways for required connections to ingress and egress from the sheilded areas. I indicated that the feed throughs were the best option. Now feel free to take acception to that but don&#8217;t give as a reason any competant EMC or EmSec design engineer would say is possibly the least important reason for using them. You will find them used in many many forms of secure equipment especialy those that have broadband signals and also test equipment ranging from oscilloscopes through much RF test gear as well as anttena amplifiers for communal dwellings and cabe televison head end amps. Whilst not as ubiquitus as other components they are fairly standard, which is why DigiKey has so many types available.</p>
<p>With regards your &#8220;his claim that the avalanche-construction is a severe risk&#8221; is again very far from what I have said. I have noted that many transistors are not designed with avalanche mode operation in mind and some designs will be changed without the avalanche charecteristics taken into account. Without using a part specificaly designed for avalanche mode you run the risk of damaging the device or making it fail long before it&#8217;s MTTF. I once heard a design representative from Motorola refer to using ordinary signal transistors this way as like &#8220;trying to drive your car in reverse down a motorway and trying to keep up, you get a lot of noise but lousey milage and repair bills&#8221;.</p>
<p>You should have noted from the fact I say &#8220;noise source&#8221; I am being agnostic to the type. And for longevity noise diodes have been specifficaly designed for the job thus it is part of their normal specifications and can be relied on over time. You could also use voltage regulator diodes or some LEDs but whilst they are being used in their normal mode of operation the noise charecteristics are generaly not given as part of their data sheets thus may well change as manufacturing processes improve or the devices age.</p>
<p>As for your comments about detection / conversion you have not said what issue you have in particular with a zero crossing detector. As you should appreciate all designs are compramises for various reasons some of which change with time and technological improvments. Further you have not said what your chosen method is, you have just made comments about sound cards. Which is at variance to your other comments about bandwidth of amplifiers. Further you appear to think 74 family logic is the way to go but appear not to have been aware of the differences between 74ALS and 74HCU parts both in operation and output configuration, which is usually given in quite some detail in the data books section that charecterise the family types. Which also tends to suggest you are not familier with their input configurations and the issues arising from their out of specification usage.</p>
<p>Any way I will as this is getting well of topic leave it for now befor either Bruce or the Moderator showes either of us the yellow card.</p>
<p>However when this thread has quitend down in a week or so and if Bruce allows it I will be quite happy to continue the technical aspects of this discussion with you.</p>
<p>[]</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204556">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204556">
						September 20, 2013 11:35 AM					</a>

				</p>

				<p>@ Mike the goat</p>
<p>&#8220;We can no longer even testify to the fact that we believe them to be safe (although really we never could warrant them bug or remotely exploitable flaw free) and this might be an issue for the eagles in the legal dept as they ponder compliance with infosec legislature and for those organizations who handle financial data Sarbanes-Oxley &amp;c.&#8221;</p>
<p>name.withheld said something similar. I cannot overemphasize how misleading (and impractical) such statements are. The revelations show us the systems are vulnerable to <em>The All-knowing, All-powerful NSA</em>, not <em>every blackhat companies worry about.</em> If NSA is in such companies&#8217; threat profile, then&#8230; then I don&#8217;t know what they&#8217;re thinking. If they&#8217;re worried about the threats that <em>actually damage them</em>, then there&#8217;s plenty of tech that can we can have confidence in and NSA&#8217;s actions have almost zero effect on that.</p>
<p>Also, what legal compliance requirements force anyone to be secure against a domestic TLA with legal authorization to hack them? Has anyone been prosecuted for not being NSA proof? This is <b>an imaginary concern.</b>  NSA &amp; INFOSEC compliance are two different issues in 99+% of cases. On other hand, I can think of a few companies and individuals that suffered greatly for doing the opposite: resisting the NSA.</p>
<p>Of course, recent events would worry in the exceptional case where the NSA is actually in your threat profile and you&#8217;re operating stateside in a public way. Good luck with that, all I can say.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204557">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204557">
						September 20, 2013 11:41 AM					</a>

				</p>

				<p>@ MarkH</p>
<p>&#8220;Those of us with engineering ability can concretely make some little steps to advance the situation, even though there will be many problems that remain difficult to remedy.</p>
<p>Starting from the premise that if your random source is broken, then EVERYTHING is broken, I think it should be entirely practical to publish &#8220;open source&#8221; build-it-yourself TRNG designs &#8212; and also to provide certain materials for them, in such a way that everything is 100% auditable. In other words, to set up a trust-worthy source whose message is &#8220;don&#8217;t trust us concerning ANYTHING &#8212; you can and should verify the security case yourself.&#8221; This would be the diametric opposite of Intel.</p>
<p>Ordinary consumers will never go that route, nor commercial operations. But there will be individuals and organizations around the world needing to take high precautions, with life, limb and liberty at hazard. It&#8217;s possible to provide options for these cases, and I think there are enough geeks who &#8220;support the cause&#8221; to provide the necessary technical backup (mainly, in the form of painstaking security design review).&#8221;</p>
<p>All sounds good. Particularly, pushing solutions that are open to hard review and require less trust. It&#8217;s why I like high assurance or subversion resistant methodologies for critical stuff. Most dev&#8217;s and reviewers don&#8217;t understand them, though, and such processes are as exciting (sarcasm) as SOX audits. Hopefully the fact that they&#8217;re seeing subversion everywhere might inspire them to bite the bullet and build working solutions despite them not being the coolest, prettiest, fastest, etc.</p>
<p>And if you get a verifiable TRNG, certainly publish it. We could always use more of them, esp verifiable ones. I&#8217;m sure i&#8217;ll get tired of rolling dice and shuffling cards eventually. ðŸ˜‰</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204558">

			<div class="comment by-paul-bonneau ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://armednonviolent.blogspot.com/p/my-articles.html' rel='external nofollow ugc' class='url'>Paul Bonneau</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204558">
						September 20, 2013 12:55 PM					</a>

				</p>

				<p>Interesting reading, gang.</p>
<p>One can go overboard with the paranoia. The point is not so much to prevent the snoops learning things (although there is some entertainment value in doing that); the point is not to care what they learn. I wrote about that factor here:</p>
<p><a href="http://www.ncc-1776.org/tle2013/tle736-20130901-05.html" rel="nofollow ugc">http://www.ncc-1776.org/tle2013/tle736-20130901-05.html</a></p>
<p>Go buy yourself another case of .308 ammo; trust me, you&#8217;ll feel better.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204559">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204559">
						September 20, 2013 1:38 PM					</a>

				</p>

				<p>@Paul:</p>
<p>US intelligence agencies, chartered to operate against foreign adversaries for purposes of national security, have already provided so much data to DEA &#8212; for use in prosecuting <i>domestic cases</i> &#8212; that DEA has a special protocol for its attorneys to create fictitious &#8220;cover stories.&#8221;  These prosecutorial lies are intended to explain where all that info came from, while shielding its secret, likely unlawful, and certainly unconstitutional sources.  See <a href="http://www.reuters.com/article/2013/08/05/us-dea-sod-idUSBRE97409R20130805" rel="nofollow ugc">http://www.reuters.com/article/2013/08/05/us-dea-sod-idUSBRE97409R20130805</a></p>
<p>We are still very far from the condition of East Germany.</p>
<p>We are moving in the East German direction, not only in terms of universal domestic surveillance, but also the post-2001 government assertion of authority to deny due process to US citizens by:</p>
<p>â€¢ Detention in Guantanamo, see <a href="http://en.wikipedia.org/wiki/American_detainees_at_Guantanamo_Bay" rel="nofollow ugc">http://en.wikipedia.org/wiki/American_detainees_at_Guantanamo_Bay</a></p>
<p>â€¢ Imprisonment for years without charges in violation of habeas corpus, see <a href="http://en.wikipedia.org/wiki/Jos%C3%A9_Padilla_(prisoner)#Habeas_corpus" rel="nofollow ugc">http://en.wikipedia.org/wiki/Jos%C3%A9_Padilla_(prisoner)#Habeas_corpus</a></p>
<p>â€¢ Murder, see <a href="http://www.cbsnews.com/8301-202_162-57585798/who-were-the-4-u.s-citizens-killed-in-drone-strikes/" rel="nofollow ugc">http://www.cbsnews.com/8301-202_162-57585798/who-were-the-4-u.s-citizens-killed-in-drone-strikes/</a></p>
<p>Men with guns CAN break down the door of your house in consequence of NSA spying on YOU.  And if you pick up that .308 in self defense because you hear a break-in during the dark of night, they may kill you.  See <a href="http://abcnews.go.com/US/tucson-swat-team-defends-shooting-iraq-marine-veteran/story?id=13640112" rel="nofollow ugc">http://abcnews.go.com/US/tucson-swat-team-defends-shooting-iraq-marine-veteran/story?id=13640112</a> &#8212; or the writings of Radley Balko.</p>
<p>I agree with you, that it&#8217;s foolish and unhelpful to say &#8220;it&#8217;s East Germany!&#8221;  At the same time, it is dangerous to say &#8220;it&#8217;s no big deal.&#8221;  The assault on privacy and liberty is not academic &#8212; this is real.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204560">

			<div class="comment by-curious ">

				<p class="commentcredit">

					<span class="commenter">Curious</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204560">
						September 20, 2013 3:03 PM					</a>

				</p>

				<p>It should be obvious that Paul here isn&#8217;t really referring to anyone actually owning firearms. ðŸ˜ Except perhaps referring to himself. ðŸ™‚</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204561">

			<div class="comment by-curious ">

				<p class="commentcredit">

					<span class="commenter">Curious</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204561">
						September 20, 2013 3:06 PM					</a>

				</p>

				<p>Oh, someone posted before me I see now. My comment was not intended for MarkH here.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204562">

			<div class="comment by-name-withheld-for-obvious-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obvious.reasons</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204562">
						September 20, 2013 4:02 PM					</a>

				</p>

				<p>For the &#8220;Bruce Schneier Bloggers&#8221;&#8230;</p>
<p>First, let me state that I do not see myself as a Bruce Schneier&#8217;s Bloggers (BSB&#8217;ers)&#8211;yet. But, I have participated in blogging on several topics&#8211;for the last 12 months&#8211;and I see an obstacle and an opportunity.</p>
<p>1.) We, at least those that have a moderate level of computational, cryptographic, mathematical, and/or engineering background would be well served to organize. NOTE:This can be impractical as most persons on this blog are highly independent, organizing as a group is predicted to be improbable.</p>
<p>2.) The ad-hock nature of the blog does not lend itself, for several reasons, readily to address the issues expressed by the SB&#8217;ers in an effective and timely manner.</p>
<p>3.) As there is a significant amount of anonymity within the community, it is unlikely that this forum is appropriate for even discussing this issue.</p>
<p>4.) If a &#8220;known&#8221; coordinator could be identified, and persons that have an interest in the issues brought to the attention of the community, can produce a &#8220;blind&#8221; cooperative to start developing some of the ideas and concepts that have been expressed here.</p>
<p>5.) This is only a series of suggestions, it is not difficult to make suggestions given the current circumstances.</p>
<p>If anyone has an idea that could allow for a plausible answer to the day&#8217;s problems besides more tinfoil&#8211;that&#8217;d be great.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204563">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204563">
						September 20, 2013 4:44 PM					</a>

				</p>

				<p>@ Bruce,</p>
<blockquote><p> This technique could, for example, reduce the amount of entropy in Intel&#8217;s hardware random number generator from 128 bits to 32 bits. This could be done without triggering any of the built-in self-tests, without disabling any of the built-in self-tests, and <b>without failing any randomness tests.</b> </p></blockquote>
<p>I see this as a strange claim.<br />
1- Why wouldn&#8217;t it fail randomness tests if the entropy was reduced from 128 to 32 bits? Can&#8217;t statistical tests show the reduction of entropy effect?<br />
2- If the above is true, then reduction of entropy has no effect on the RND from a security standpoint  ðŸ˜‰</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204564">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204564">
						September 20, 2013 7:34 PM					</a>

				</p>

				<p><i>I don&#8217;t think we&#8217;re well served by bickering with each other or getting into e(ngineering) dick measuring contests.</i><br />
gonzo<br />
&#8211;Wait til you talk about antennas&#8230;&#8221;mine&#8217;s bigger, no mine is..&#8221;</p>
<p>name.withheld.for.obvious.reasons<br />
&#8211;It&#8217;s a great idea, but I&#8217;m busy w/ school and most others probably w/ work.  And we&#8217;re scattered all over the place.  However, I do think we all can start by building tiny trusted devices for various purposes, and giving/selling to our circles.  If someone has access to a nice lab, can we work out some inspections.  The math assistance center at my school is a perfect environment (walls are painted w/ dry-erase paint) to cover the walls in math; someone could mod a room in their house.  It&#8217;s actually a lot of fun to write on the walls again lol.</p>
<p>We need to break this awkwardness of security and try yet again this extremely challenging problem of trust (maybe that&#8217;s why it&#8217;s so attractive b/c it&#8217;s hard).</p>
<p>I&#8217;d love to see some kinetic action and try some secure builds and not just bits zipping around the net.  My observations are there&#8217;s generally a couple people who are the &#8220;glue&#8221; to a group and get things done.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204565">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204565">
						September 20, 2013 7:40 PM					</a>

				</p>

				<p>name.withheld.for.obvious.reasons<br />
&#8211;And I need to stop my outbursts, sorry all.  Never again.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204566">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204566">
						September 20, 2013 7:54 PM					</a>

				</p>

				<p>@Wael:</p>
<p>This question probably confuses more people than anything else related to cryptography.  Though I lack a secondary school diploma, but I&#8217;ll do my best to explain.</p>
<p>&#8220;Entropy&#8221; as used here means unpredictability, and is very closely related to &#8220;randomness&#8221;.  These are notions we understand intuitively, but are not simple to define formally.</p>
<p>One big contributor to the confusion is the term &#8220;randomness test.&#8221;  No test performed on a finite sample of data can prove randomness, but it can <i>disprove</i> randomness, so it would be more accurate to call these tests &#8220;non-randomness oracles.&#8221;</p>
<p>Any useful function of a random variable (that is, of an input that is at least partly unpredictable) has a distribution (that is, likelihoods of various outputs) that can be calculated.  Though (by definition) we can&#8217;t predict any particular output of such a function, we know how often certain outputs should be found in relation to other outputs, when averaged over a quite large sample (that is, a sequence of successive outputs of the function).  These are statistical properties of the function.</p>
<p>The misleadingly named &#8220;randomness tests&#8221; measure statistical properties, and compare those properties to the properties expected of a function of a true random variable.</p>
<p>The problem is, a partially predictable &#8212; or even completely predictable &#8212; sequence can perfectly match the statistical properties of a random sequence.</p>
<p>The <a href="http://en.wikipedia.org/wiki/Linear_feedback_shift_register" rel="nofollow ugc">LFSR</a> is a simple logical construction capable of producing long sequences of &#8220;random-looking&#8221; bits.</p>
<p>For example, a 64-bit LFSR can be constructed to generate seemingly random bits at a rate of 1 gigabit per second for more than 500 years before it repeats itself (it actually creates the same astronomically long sequence over and over again).  If you collected a day, a month, a year or even a century of output from this generator, <b>that output would pass any randomness test.</b>  However, if you collect <i>any</i> 128 output bits in a row, you can by analysis predict any future output (for example, whether the 9,477,213,482nd bit following the captured 128 bits will be a 1 or a 0) &#8212; and similarly, &#8220;predict&#8221; all previous outputs as well.  <b>The entropy is practically zero.</b></p>
<hr />
<p>For the record, there are many ways to generate &#8220;random looking&#8221; bits.  There&#8217;s a whole science of this, they&#8217;re call pseudo-random bit generators (PRBGs, or PRNGs for those who say &#8216;number&#8217; instead of &#8216;bit&#8217;).  The LFSR is by far the easiest to &#8220;crack&#8221; in the sense of predicting outputs from a sample of output.  But even the hardest to crack is fully predictable to anyone knowing the internal state of the generator.</p>
<p>IF somebody who wants to violate your confidentiality has tampered with your PRBG, he can preserve its statistical properties (so it passes all the randomness tests), while retaining his ability to predict outputs.  And it&#8217;s not necessary to have perfect prediction:  even if the generator is partly random, by reducing the entropy the attacker can cut the number of trials necessary to guess his way past your encryption, sufficiently that it&#8217;s practical for him to do so.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204567">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204567">
						September 20, 2013 8:33 PM					</a>

				</p>

				<p>@ MarkH,</p>
<p>Thank you for the explanation. I think there are several things to talk about here. I&#8217;ll need to think how to put it. I understand what you are saying and I think we maybe talking about two different and related things (not sure yet). I was Hoping to have a break this weekend, but.. This is also fun, and may be a long discussion&#8230;</p>
<p>I&#8217;m not going to fall in the trap of &#8220;secondary degree thing&#8221; you maybe a stochastic processes and statistics professor somewhere pulling my leg and trying to make me to look uneducated ðŸ˜‰</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204568">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204568">
						September 21, 2013 12:13 AM					</a>

				</p>

				<p>@ Wael,</p>
<p>One way of looking at information entropy is it defines &#8220;the number of possabilities&#8221;, anything that is predictable reduces the possabilities.</p>
<p>My son intuativly understands this from playing with lego bricks. If you have a pile of lego bricks it is not a model. As you start to build a model you start reducing the outcome of what it is going to be to an observer. Each brick added fixes it&#8217;s relationship to the model and in the process has gone from it&#8217;s maximum entropy as a free brick to a much reduced entropy as a brick connected to one or more others. As more bricks get added and the model gets closer to compleation the entropy of not just the model but each brick inside it falls. To the observer the unknown model reduces in possabilities untill the information about what it is, is in part then whole is conveyed to the observer. At some point sufficient information is conveyed such that the observer can start to predict where other bricks will be placed and thus be able to compleate the model in their mind. If you think about it the number of ways the model can be built is maximum whilst all the bricks are disconected and at a minimum when all connected but&#8230; there are many ways to build the model one is you build the model by adding free bricks to the model individualy. Another is to build recognisable parts and then put the parts together. Another is to go through just putting two bricks together over and over, then putting two block parts together to make four brick parts, then eight etc etc, this conveys information about the final model more slowly. Finaly you could just randomly put parts together to make odd sized sub parts that are to the observer just random clumps of bricks untill the form of the model finally appears.</p>
<p>But consider the last method, sometimes those odd clumps will look like part made sub parts to the observer but are they? What if the maker has no model in mind and is aimlessly puting parts together at what point can you tell purposful from aimless brick assembly?</p>
<p>Further consider the difference between an observer who can see the brick pile and one who can not. As you see the first recognisable part being constructed you might correctly or inccorectly decide that is the model or a sub part of the model. You only know when the maker stops. But likewise consider if they make two identicle sub parts in succession does knowing the size of the brick pile convey any information? Is the maker just going to carry on making identicle parts or stop after say the fifth or start making different parts. You don&#8217;t know from just observation but by being able to examine the brick pile you may be able to make more valid deductions than by just observing the model makers output.</p>
<p>Hopefully thats given you a bit more feel for the idea of information entropy, and what you can and can not do as the observer of the output of an unknown process.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204569">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204569">
						September 21, 2013 2:57 AM					</a>

				</p>

				<p>@Clive Robinson: Sorry, there is nothing to discuss. You have nothing to contribute on the electronics side. That is not to mean you generally do not understand electronics, I have no opinion about that. But I am convinced you do not understand this thing we are talking about here.</p>
<p>Just some comments:</p>
<ol>
<li>HCU is so rarely used that I just did not think of it. It is quite exotic as it is a digital circuit basically unsuitable for digital use. Your nebulous references to &#8220;datasheets&#8221; is fascinating though, and I deduce you have no clue what HCU is or why it does not have the problem the ALS gates have as that can be described with a single sentence: No buffer stages on HCU. Now the implications of that are a bit more complicated to understand.</li>
<li>mu-Metal is for shielding against magnetic (B) fields that are static or changing with low frequency (less than 1kHz). What we are talking about here is shielding against Electro-Magnetic radiation, and that is a completely different beast. Requires some high-school level of physics to know that though. Seems though that you have read up on what mu-Metal actually is by now, although the implications seem to not quite have sunk in yet.</li>
<li>The avalanche construction is using a diode in reverse breakdown. While a Z-Diode is optimized for that (and for low noise in addition, which makes it mostly unsuitable for this application), a NPN E-B diode is not. Still, it is a normal semi-conductor, the voltages are low and no thermal problems are to be expected. You seem to have some kind of irrational fear of using a device for something not in its data-sheet. There really is not need for that as long as the principle of operation is understood. It is also not a risk here, as of course failure will be detected in any sane design.</li>
</ol>
<p>Side note: I think I understand that alleged statement by the alleged Motorola representative a lot better than you: What he said rather strongly indicates this was for a completely different scenario, likely using a transistor with E and C swapped. It still works to some degree if the voltages are low enough, but it can indeed result in a quick wreck and the properties of the transistor are really, really bad used this way.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204570">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204570">
						September 21, 2013 3:09 AM					</a>

				</p>

				<p>@Wael: The thing is that these randomness tests are statistical and you have (in the sense of Colmogorov complexity) not only those 32 bits in the output, but also a minimal description of AES, its mode and the key used, and that will be a few 1000 bits. That sabotages the tests. An attacker that knows the key and AES can remove the AES and key and ends up with just the 32 bit which can then be brute-forced.</p>
<p>Now, why not make statistical tests that removes the AES? Quite simple: The problem is the AES key. While AES could be removed from the Colmogorov complexity of the output, the AES key can only be removed when it is known. And as long as it is unknown, you have still 128+32 bit of entropy in there, and no statistical test can go that far, it requires too much data. You would have one expected collision in 2^80 full length samples by the &#8220;birthday paradox&#8221;, i.e. need something like 16Byte * 2^80 output samples for the statistical test to have a real chance of finding something. That is about 10&#8217;000&#8217;000&#8217;000 metric tons of 4TB disks in storage ðŸ˜‰</p>
<p>(Lots of detail omitted and lots of fuzziness, but the idea is sound.)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204571">

			<div class="comment by-johannes ">

				<p class="commentcredit">

					<span class="commenter">Johannes</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204571">
						September 21, 2013 3:26 AM					</a>

				</p>

				<p>@Dirk Praet &#8211; September 17, 2013 6:31 AM<br />
@ a lawyer in ToonTown</p>
<p>TAILS Linux updates the Microcode with each boot.</p>
<p>&#8220;Could you elaborate on that and tell us where you got that from ?&#8221;</p>
<p><i><a href="https://tails.boum.org/contribute/design/" rel="nofollow ugc">https://tails.boum.org/contribute/design/</a></p>
<p>&#8220;3.9 Hardware support</p>
<p>Tails generally ships the latest kernel from Debian unstable or Debian Backports as a compromise between stability and recent hardware support. <b>Recent Intel and AMD microcode are included as well.</b></p>
<p>The x86 hardware architecture is the main supported one.&#8221;</i></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204572">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204572">
						September 21, 2013 5:16 AM					</a>

				</p>

				<p>@ Clive Robonson, Gweihir</p>
<p>The randomness test only tests the RND generator and is independent of consumers of its functionality, like AES. So AES details are not a factor influencing our characterization of the RNG. This is supposed to be a surgical test of one component of the chip. My brain is not working very well this early in the morning (3:12 AM) but I&#8217;ll think about it more and continue&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204573">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204573">
						September 21, 2013 5:23 AM					</a>

				</p>

				<p>Come to think of it, is AES a consumer of the RNG ? Hmm better go to sleep&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204574">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204574">
						September 21, 2013 6:51 AM					</a>

				</p>

				<p>Johannes is right. Here&#8217;s a Debian page on the microcode update. TAILS uses Debian Live.</p>
<p><a href="http://packages.debian.org/wheezy/intel-microcode" rel="nofollow ugc">http://packages.debian.org/wheezy/intel-microcode</a></p>
<p>So, yes, even TAILS could be subverted if the microcode updates include subversion. I&#8217;ve always been a fan of using non-x86 hardware to throw off sophisticated, fire-and-forget attacks. Just got some more motivation along a different angle. ðŸ˜‰</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204575">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204575">
						September 21, 2013 7:08 AM					</a>

				</p>

				<p>@ Wael</p>
<p>Way I think of it is that a cipher (e.g. AES) is designed to turn an input into something that <i>looks</i> random. The key and the plaintext could both be all zeros, a very non random thing, but after AES is done with them they&#8217;ll look just as random as something run through with a 128-bit key. It&#8217;s the nature of ciphers: they scramble and randomize data to hide patterns in it.</p>
<p>Most (or all?) statistical tests test a given set of data to see if it <i>looks random</i>. Raw sources of entropy whose data looks random consistently in these tests might actually be random. The problem is that ciphers make everything look random so anything you pass through will automatically pass a statistical test for randomness. So, one must test the original source for its randomness properties <i>before it passes through a cipher.</i></p>
<p>The Risk: If enemy can predict your input numbers (bad TRNG/low entropy) &amp; knows how the CRNG is constructed, then the post-processing steps like AES will provide you no benefit. The real security is in unpredictableness of the numbers fed into AES, a whitener, or whatever. The more predictable the raw source is, the more risk of attack on it.</p>
<p>And NSA can probably brute force certain CRNG constructions if the seeds are weak.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204576">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204576">
						September 21, 2013 9:01 AM					</a>

				</p>

				<p>@ Nick P,</p>
<p>Why is everyone talking about AES and ciphers. I know what these compression algorithms do (lol). Just look at the simplest part of the question. If you have a source of randomness, can a test quantify its entropy? Please don&#8217;t talk about ciphers (or Legos :)) now. We&#8217;ll tackle the other parts later.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204577">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204577">
						September 21, 2013 9:10 AM					</a>

				</p>

				<p>@ Nick P, again&#8230;</p>
<blockquote><p> The key and the plaintext could both be all <b>zeros, a very non random thing </b></p></blockquote>
<p>Says who? They may very well be random, although highly unlikely</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204578">

			<div class="comment by-name-withheld-for-obvious-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obvious.reasons</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204578">
						September 21, 2013 10:33 AM					</a>

				</p>

				<p>The microcode updates that source a blob, converting the hex to bin yields a small stub&#8211;but it is the comments in microcode.c (Intel CPU Firmware Update Driver) has some interesting source modification notes&#8211;including removing the BIOS image from the kernel and eliminating the IOC read() of the in-proc blob.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204579">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204579">
						September 21, 2013 11:05 AM					</a>

				</p>

				<p>@Wael:</p>
<p>pseudo-random â‰  random</p>
<p>AES was mentioned in a couple of posts above, because a block cipher (like AES) is one of many ways to construct a PRBG (pseudo-random bit generator).  The output of a decent PRBG looks random, and has all of the statistical properties of a true RNG:  it will pass any &#8220;randomness test.&#8221;</p>
<p>The key concept isn&#8217;t AES, but the difference between pseudo-randomness and randomness.  So, two ways to think about the difference:</p>
<p><b>Determinism</b></p>
<p>Imagine that we can monitor perfectly (missing nothing) a fixed population of atoms of some unstable isotope.  From any chosen starting instant, there will be some finite time interval before the next atom spontaneously decays.  That time interval has well-defined statistical properties:  we can say calculate a time by which the probability of next decay is 0.1, 0.5 or 0.9 with precision.  But no person &#8212; anywhere, using any conceivable technique, even with the most complete knowledge of those atoms that is physically possible to learn &#8212; can dependably predict when the next decay will occur.</p>
<p>That time interval is non-deterministic, even though its statistical properties of a large sample of such intervals is well known.</p>
<p>By contrast, the output of a typical PRBG is fully deterministic<sup>1</sup>.  A person knowing the construction and seed of the PRBG can predict all future outputs with 100% accuracy.</p>
<p><sup>1</sup> A PRBG can be made partly deterministic by progressively &#8220;mixing in&#8221; random bits, but that doesn&#8217;t affect the distinction between deterministic and non-deterministic.</p>
<p><b>Minimal Encoding</b></p>
<p>A way to think of &#8220;entropy&#8221; that is pretty close to its rigorous definition in information theory, is that it answers the question, &#8220;what is the most compact possible encoding of the data set?&#8221;</p>
<p>For example, consider the 64-bit LFSR example I cited last night.  One way to encode its output is to note that it is strictly periodic, playing the same 2^64 output bits over and over.  So we could &#8220;write down&#8221; all 2^64 bits, along with some bits<sup>2</sup> to express &#8220;repeat these ad infinitum.&#8221;  This would fully encode the bit sequence, consuming 2^64 bits.  <i>If there were no smaller encoding,</i> we could say &#8220;this generator has 2^64 bits of entropy&#8221;.</p>
<p>However, we can make a much more compact encoding by noting the LFSR algorithm, plus the 64-bit feedback pattern, plus the 64 bits of current state (or &#8220;seed&#8221;).  Suddenly, the encoding has shrunk from from the order of 10^38 to 10^2.  Presumably, this is the most compact encoding possible, so we can say that our LFSR has roughly 100 bits of entropy.</p>
<p>By contrast, consider a sequence of 2^64 bits generated by &#8220;tosses of a fair coin,&#8221; or by suitable processing of measured time intervals between spontaneous radioactive decays.  There is no predictability to those bits:  there is no underlying pattern.  No compression algorithm could shrink such data even by a few percent.  <i>The most compact possible encoding of this sequence would be about 2^64 bits in size:  its entropy is 2^64.</i></p>
<p>If someone (let&#8217;s call him Oscar) makes a PRBG using AES 128 in CTR mode, the bits needed to encode the algorithm, plus 128 bits of key and 128 bits of seed fully encode the resulting bit sequence.  That generator can easily make 2^64 bits of &#8220;random-looking&#8221; output, but the entropy is only 256 bits.</p>
<p>Hope this helps!</p>
<p><sup>2</sup> There are different ways of encoding the PRBG algorithms:  for example, as source code!  How this is done would affect the encoded size, but it boils down to a (somewhat) constant offset.  Compared to the entropy needed for crypto purposes, algorithm encoding is so tiny  that it can be neglected for comparison purposes.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204580">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204580">
						September 21, 2013 11:43 AM					</a>

				</p>

				<p>@ MarkH,<br />
Clearly I need to articulate my statements better.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204581">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204581">
						September 21, 2013 12:11 PM					</a>

				</p>

				<p>@Wael:</p>
<p>Probably ðŸ˜‰</p>
<blockquote><p>&#8220;If you have a source of randomness, can a test quantify its entropy?&#8221;</p></blockquote>
<p>A function of <i>any finite sample</i> of the source&#8217;s <i>outputs</i> can estimate an upper bound for its entropy, but cannot give the lower bound.</p>
<p>In other words, if the sequence is an endless repetition of &#8220;010101&#8221;, a function &#8212; PKZIP, for example ðŸ™‚ &#8212; can demonstrate the tiny quantity of entropy.  But I believe that it is impossible to devise an effective procedure able to reliably detect the very low entropy in the outputs of PRBGs.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204582">

			<div class="comment by-name-withheld-for-obvious-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obvious.reasons</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204582">
						September 21, 2013 3:40 PM					</a>

				</p>

				<p>@figureitout</p>
<p>Yes, life is rarely convenient but neither is the subversion of network computing technologies AND our data (meta or otherwise). I appreciate your enthusiasm and your situation. In my opinion is we &#8220;have&#8221; to make the time. Industry and academic professionals, the print and digital press, and LEA&#8217;s and are representatives are all but silent on this issues surrounding a rogue government and government agency. In a way you can say it falls to (the figurative) us. I can see that this is the direction Bruce is headed. It would be useful if as a group (the BSB&#8217;ers) engage the various communities. Academia (Cambrigde&#8211;the brit ond, CMU, Berkeley, MIT, Stanford, etc.), businesses (small and medium size companies that are outside the soon to be drawn circle. organizations (FAS, CDT, EFF, EPIC, IEEE, Union of Concerned Scientists, and other civic minded) and other stand groups or individual. The idea is to develop &#8220;buzz&#8221; about this kinda thing.</p>
<p>Oh, and I have a small clean room. Started last year when I realized that the landscape was changing rapidly. But I originally began the operation planning to do a small light manufacturing and hiring four dozen &#8220;collaborators&#8221;, but this situation has upset the apple cart. Spent six months restructuring the company. Required me to rethink the whole managent and operations theory to form an efficient and scalable framework that is antithetical to the way the development is compartmentalized and served by small enclaves (similar to the way LEA&#8217;s do business but without the requirement of classification systems used by the likes of the NSA or their contractors. This cultural of secrecy is beyond the breach, I suggest a way to achieve a more respectful society is to make honesty a cornerstone&#8211;not something that is to be feared. I&#8217;ve worked in some environments and classified systems are inherently flawed as classification creates a &#8220;shielded&#8221; bias. A satellite system, Air Force/Navy, that recently need redeployment (original had a short service life) was to be replaced, I was asked to review/critique the new system. My honest appraisal was not well recieved by the program manager and thus the classification saved the system. It also affects contracts and government services that are wrapped in the &#8220;national security blanket&#8221;.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204583">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204583">
						September 21, 2013 4:41 PM					</a>

				</p>

				<p>@ Wael,</p>
<p>OK if you want an &#8220;entropy estimator&#8221; on a running TRNG there has been one in standard use (see the German not English BSI standard AIS-31) for a while. It&#8217;s the work of Ueli Maurer.</p>
<p>It&#8217;s mentioned and refrenced in this paper that you might find of interest,</p>
<p><a href="http://www.cmi.univ-mrs.fr/~golubev/srcpdf/rng_test.pdf" rel="nofollow ugc">http://www.cmi.univ-mrs.fr/~golubev/srcpdf/rng_test.pdf</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204584">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204584">
						September 21, 2013 5:15 PM					</a>

				</p>

				<p>@gweihir<br />
&#8221;  It is really not a concern here. First, you have a very low source impedance and a pretty strong signal. Second, and I guess&#8230;..&#8221;</p>
<p>U da man<br />
/sarc</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204585">

			<div class="comment by-evdokim-ulyanov ">

				<p class="commentcredit">

					<span class="commenter">Evdokim Ulyanov</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204585">
						September 21, 2013 5:32 PM					</a>

				</p>

				<p>@Nick P:</p>
<p><i>&#8220;So, yes, even TAILS could be subverted if the microcode updates include subversion.&#8221;</i></p>
<p>I wonder why they feel they need to load it at all &#8211; and I thought this was a FOSS project &#8211; the microcode is proprietary, correct?</p>
<p><i>&#8220;I&#8217;ve always been a fan of using non-x86 hardware to throw off sophisticated, fire-and-forget attacks.&#8221;</i></p>
<p>Where may I purchase it?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204586">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204586">
						September 21, 2013 5:54 PM					</a>

				</p>

				<p>@Wael: The &#8220;AES&#8221; is the AES in the whitener in RdRand, and it is not consumer-side at all, it sits between the hardware generator and the RdRand instruction and you cannot get at the hardware generator past it. If you could get at the hardware generator directly, it would be (relatively) easy to find sabotage or to bypass it.</p>
<p>For example, if you have a structurally simple hardware noise generator (e.g. avalanche construction, whether Zener or 2-transistor or something else does not matter), a statistical test can tell you how much true randomness is in the observed output signal, if all error sources are also simple (mains noise for example). One thing where that fails is if somebody beams, e.g., strong RF modulated with a noise-like but predictable signal at it. If that is a concern, better put some thick copper shielding in there and make sure said RF does not get in via supply or signal lines. Supply lines you just filter. Signal lines are a bit more tricky and depend on the specifics of your circuit, but low impedance, high signal levels and short wires are king, as the RF power needed to &#8220;get into the circuit&#8221; will approach something that makes the shielding glow pretty fast and become impractical or obvious.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204587">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204587">
						September 21, 2013 7:20 PM					</a>

				</p>

				<p>@ Evdokim Ulyanov</p>
<p>&#8220;I wonder why they feel they need to load it at all &#8211; and I thought this was a FOSS project &#8211; the microcode is proprietary, correct?&#8221;</p>
<p>They can include whatever they want. Binaries for proprietary hardware are common in Linux use these days. As for microcode, those updates are often to fix problems (&#8220;errata&#8221;). So I could see them wanting a working processor before their security tech loads.</p>
<p>&#8220;Where may I purchase it?&#8221;</p>
<p><b>Replacing Intel or x86 chips for subversion resistance. Options.</b></p>
<p><i>Instruction Sets</i></p>
<p>Alternative ISA&#8217;s include POWER/PPC, SPARC, Alpha, PA-RISC, ARM (naturally), and MIPS. Many old workstation computers were quite functional and used these. So, for these, I suggest Googling (to review pro&#8217;s/cons) and buying old machines from eBay. Especially look for hardware supported by OpenBSD, NetBSD, or Linux so you have up-to-date, patched software rather than proprietary UNIX. Or, if you dare, you can virtualize or security-enhance the UNIX/OS they&#8217;re built on to keep its applications/toolset.</p>
<p><i>Prebuilt, very usable</i></p>
<p>Hardware vendors to eBay include VIA x86&#8217;s, Apple PPC Mac&#8217;s, Genesi Efika, or Freescale for PPC; IBM servers for POWER; Sun SPARC servers or Sunblade SPARC workstations; Compaq Alpha servers/workstations; HP PA-RISC servers/workstations; SGI&#8217;s Octane/Origin MIPS; homebrew PS2 (MIPS) or PS3 (Cell). These are all built to run desktop, workstation or server loads. Also, Loongson is China&#8217;s chip and they have both BSD- and Linux-based stacks built on it. Top contender for anti-NSA chip.</p>
<p>Note: Super old, slow and obsolete ones like VAX, Pyramid, Motorola&#8217;s, and so on if you want that.</p>
<p><i>Embedded, simple and/or special-purpose</i></p>
<p>The systems above are old and/or complex. Past few years, I advised people wanting modern non-Intel (and non-server) stuff to look at embedded companies. Freescale, Curtis-Wright, AMCC, etc come to mind. There&#8217;s <em>plenty</em> of embedded boards for ARM, MIPS, PPC, and even x86. They&#8217;re usually pretty simple compared to a desktop or server board. You can get as much or as little functionality as you want. And there&#8217;s more foreign suppliers available. Just get an embedded board with a high end processor, plenty of RAM and ability to integrate with peripherals. You can build a simplified desktop out of that, esp if it runs Linux. (Many do.)</p>
<p>Note: that was all 32- and 64-bit stuff. I&#8217;ve known of people willing to do stuff on 8-bit and 16-bit machines. You can actually do quite a bit on those machines. You&#8217;re just going to take a [huge] hit in avail software, usability, and performance. Maybe security too without memory protection.</p>
<p><i>Processor cores on FPGA&#8217;s</i></p>
<p>This route is rougher but you might find online guides. Who knows. The concept is you get a core and you put it on an FPGA. Might have to add other stuff to make it work. The core might be x86 compatible, one of other ISA&#8217;s I mentioned, or an open ISA such as OpenRISC. Or even the rigorously analysed VAMP verified processor. You can build your system ground up. If it proves out and there&#8217;s demand, maybe you can turn it into a dedicated ASIC and have a foreign fab build it. Who knows.</p>
<p><i>High level processors</i></p>
<p>We&#8217;ve discussed this recently on this blog. I&#8217;ve brought it up in previous discussions about language-based security. If language was securable and runtime safety was hardware supported/accelerated, then building a complicated system w/out common issues like code injection might be easier, right? And a high level language or architecture could help detect subversions if it promoted layering, information hiding, etc. So, the idea here is to outright buy or put on an FPGA a core supporting a higher level language. Examples I&#8217;ve seen are LISP machine&#8217;s (LISP processors), Forth machines, JOP-style Java processors (think server type is called Vega), HISC instruction set, and crash-safe.org&#8217;s recent tagged design. If not build a desktop, you might use one of these for purpose-built devices or a trusted front end to many less truthworthy devices.</p>
<p><i>Just remember</i></p>
<p>Remember that you must define your threat model for this stuff. I don&#8217;t like x86 because <em>everyone</em> attacks them. I prefer an obscurity benefit on top of a hardened system. However, people worried about black hats and foreign TLA&#8217;s would do well to use a recent Intel processor b/c they have lower errata than previous chips and features that benefit security (e.g. IOMMU). I&#8217;d say the same about certain embedded PPC and ARM systems made by Freescale. Problem with these? NSA might have backdoored them. If you&#8217;re worried about NSA, you&#8217;re going for foreign made equipment from China (Loongson) or something. But then you won&#8217;t have the local features and experience. And <em>they</em> might have backdoored it.</p>
<p>So, as you can see, worrying about nation state subversion of hardware you depend on is like working through a maze. My solution has been to separate such concerns on <em>different physical hardware</em>. If NSA is the threat, do it on a machine dedicated to that stuff. If it&#8217;s China and malware, do it on a machine safe against that. Unless you&#8217;re specifically at risk to NSA (few are), the other threats should be top priority. You can always get a dedicated embedded system for your battle with US TLA&#8217;s. And I&#8217;d recommend you don&#8217;t operate it in America on the public internet. Air gaps with simple, non-executable transfer mechnisms are your friend. ðŸ˜‰</p>
<p>EDIT TO ADD</p>
<p>Edit to add more foreign and embedded chips to look into: Fujitsu FR-V; RISE MP-6 (x86 compatible); Transmeta Crusoe (x86 compatible); NEC RISC chips such as VR and a 2005 one supporting auto-parallelism; Toshiba TX MIPS-based processors; higher end SuperH (one was in Dreamcast).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204588">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204588">
						September 21, 2013 8:13 PM					</a>

				</p>

				<p>As a supplement to Nick&#8217;s valuable information on non-Intel processors:</p>
<p>In my opinion, the boot firmware in all &#8220;PC-compatible&#8221; x86 systems (BIOS or EFI/UEFI) is a worrisome security hazard.  This x86 boot firmware is (with very rare exceptions):</p>
<p>â€¢ complex<br />
â€¢ bloated<br />
â€¢ proprietary<br />
â€¢ closed source</p>
<p>Efforts toward open-source BIOS have been hampered in part by the prevalence of proprietary hardware on PC-compatible mainboards.</p>
<p>Such boot firmware is an excellent locus for attack vectors, and (coming almost always from a very small number of vendors) readily subject to subversion by powerful agencies.</p>
<p>It&#8217;s a relief to transition to computing platforms without that particular nastiness.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204589">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204589">
						September 21, 2013 9:28 PM					</a>

				</p>

				<p>Also of interest to add to Nick P&#8217;s list,</p>
<p>Have a look at the high end Microchip PIC chips you can do a surprising amount with the (the real prob with PIC24 and down is no software interupt or MMU but with a little thought it&#8217;s not much of an issue). Oh and they are almost dirt cheap in very small quantities (some are sub $2) and loaded down with usefull I/O components.</p>
<p>With regards Forth many many moons ago it&#8217;s inventor Charles Moore striped it down to 27 basic instructions and then got it running on a TMS DSP chip in 4K of ROM. There are considerably more powerfull DSP chips knocking around these days for just a dollar or two. It&#8217;s unlikely. That DSP chips have been backdoored in anyway becausse in many ways they are Sub-RISC and theres not realy anywhere to hide one, even time based side channels would tend to show up due to DSP normal usage would be compromised and thus discovered very quickly.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204590">

			<div class="comment by-evdokim-ulyanov ">

				<p class="commentcredit">

					<span class="commenter">Evdokim Ulyanov</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204590">
						September 21, 2013 9:49 PM					</a>

				</p>

				<p>@ Nick P, MarkH, Clive Robinson</p>
<p>What else can I say but <i>thank you.</i></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204591">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204591">
						September 21, 2013 10:23 PM					</a>

				</p>

				<p>@ RobertT,</p>
<p>You mentioned using ring oscillators for TRNG&#8217;s as well as Sigma Delta loops. Of the two I prefer the &#8220;look&#8221; of RO&#8217;s using metastability as the randomnes source.</p>
<p>I&#8217;ve been looking around for &#8220;non analog&#8221; ways to exploit the inherant metastability. However finding non-pay wall documentation is proving a little hard. The best I&#8217;ve found so far is,</p>
<p><a href="http://www.iacr.org/archive/ches2008/51540162/51540162.pdf" rel="nofollow ugc">http://www.iacr.org/archive/ches2008/51540162/51540162.pdf</a></p>
<p>And this gives an interesting model of behaviour,</p>
<p><a href="http://eprint.iacr.org/2011/637.pdf" rel="nofollow ugc">http://eprint.iacr.org/2011/637.pdf</a></p>
<p>Do you have any others that are worth looking at?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204592">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204592">
						September 21, 2013 10:32 PM					</a>

				</p>

				<p>@ Evdokim Ulyanov,</p>
<ul><i>What else can I say but thank you</i></ul>
<p>Well in the fullness of time you could come back and tell us which method you selected and why. That way it will encorage others and we will all be that bit more secure because of it ðŸ™‚</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204593">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204593">
						September 21, 2013 11:38 PM					</a>

				</p>

				<p>@Clive R<br />
 Sorry but I&#8217;m not really up to date on the TRNG literature, I had a list of all of these RNG circuits about a year ago. but that was life time and several countries back.</p>
<p>Personally I&#8217;d never even try to do this sort of thing with &#8220;digital&#8221; cells because their output is not very random, its typically just unbelievably complex, which is not quite the same thing as random.</p>
<p>As for other approaches 4th order Sigma Delta loops are very good sources for Chaotic outputs. I&#8217;m still not certain if I should consider Chaotic to be &#8220;random&#8221; or simple indeterminable.  But this is not a circuit that can be created without the help of an Analog IC design team.</p>
<p>Personally I&#8217;d always use a Fully Differential SD design style with as perfect symmetry as was possible for the actual layout.  The problem with Single ended is usually at the sampler stage where Power Supply noise can feed through with very little rejection. In the fully differential design the cross-over of the Output_sigN and Output_SigP is what generates a changing bit. Since both signals see the same power Supply and common mode noise you get about 30dB to 40dB better rejection of injected disturbance signals.</p>
<p>Many papers use lower order SD loops but I&#8217;d be VERY careful about using these as part of a TRNG design. the problem is that the parts are designed mainly for Audio applications and Hearing is very sensitive to &#8220;tones&#8221; so practically all commercial SD&#8217;s add Dither. Dither is Noise added to the loop to dominate and scramble any tonality of the loop. Unfortunately the Dither is generated by a long sequence LFSR (good luck finding out the details) This is practically the same circuit that was used for early DSSS comms systems, SO guess what the Dither adds &#8220;Processing Gain&#8221; to the TRNG output, which is not exactly something that you ever want in a TRNG.</p>
<p>Higher order SD (3rd and 4th order) loops are inherently unstable (similar to Lorenz chaotic circuits) so dither is unnecessary Interestingly the Loop characteristic itself shapes the noise and this loop characteristic is often discernible in the SD output but I&#8217;m not convinced that this knowledge is of any use at all.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204594">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204594">
						September 22, 2013 2:09 AM					</a>

				</p>

				<p>Re oscillator jitter as an entropy source:</p>
<p>I&#8217;m getting <i>way</i> out of my depth here, but to my limited understanding, ring oscillators are used not because they have any particular virtues to recommend them &#8212; but because they are the most practical to synthesize from the MOSFET building blocks of modern CPUs.</p>
<p>I remember (almost exactly 20 years ago &#8230; wow the years go by quick) working at a semiconductor shop, where a young engineer was tasked to design the PLL oscillator for the programmable-frequency clock on a CPU (as I recall, that was a fairly novel feature back then).  He gave me a quick explanation of his voltage-controlled ring oscillator, and how it&#8217;s a rather poor-quality oscillator &#8230; but good enough for a PLL.</p>
<p>The company had their own fab on-site, enabling them to test design changes quickly.</p>
<p>@Ð•Ð²Ð´Ð¾ÐºÐ¸Ð¼:  Ð½Ðµ Ð·Ð° Ñ‡Ñ‚Ð¾</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204595">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204595">
						September 22, 2013 2:52 AM					</a>

				</p>

				<p>@RobertT: Just be careful in your entropy estimation and dither noise is not an issue. You need to make sure your statistical tests are prepared to subtract it though, or you may end up with an undetected non-working generator. Unless you signal is very weak with regard to maximum input range, you should be fine. And for cross-verification, you can always put in a sine-wave instead of your noise source and look at what the spectrum does.</p>
<p>Incidentally, even long-sequence LFSRs are not that hard to break. If the dither is strong enough to be cleanly recognizable, reconstructing the LFSR is easy. Hmm. Would they put the noise just into the lowest-order bit only? Anyways, the data-sheet should allow establishing an upper bound, as it <em>is</em> noise after all (just not the type we want).</p>
<p>@MarkH: I would not trust oscillator jitter as randomness source, unless the oscillator set was specifically designed and evaluated for this use (like in the Via C3). Its primary advantage is that it is mostly all digital. But my intuition is that separating chaotic behavior (complex, but deterministic) and random behavior (non-deterministic) is really tricky and can easily go wrong, leaving you with much less entropy in the output than you thought.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204596">

			<div class="comment by-mike-the-goat ">

				<p class="commentcredit">

					<span class="commenter">Mike the goat</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204596">
						September 22, 2013 3:26 AM					</a>

				</p>

				<p>It is funny how many people suggest that diehard/etc. test can somehow detect a subverted RNG. If the intel RNG was just taking, say the current time and pumping it through a block cipher we would really be done the wiser (provided it is whitened adequately, of course).</p>
<p>You could prove this yourself by making a for loop that shoots the output of date +%s into, say openssl in AES-128-CBC mode, then pump the output into <a href="http://www.fourmilab.ch/random" rel="nofollow ugc">ent</a> or diehard.</p>
<p>You can imagine with a little more creativity you could make the output even more pseudorandom.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204597">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204597">
						September 22, 2013 5:58 AM					</a>

				</p>

				<p>@Mike the goat: It can if you have access to the raw bits generated by the &#8220;analog&#8221; generator. But you have a point: A generator as you describe, pretending to be a raw (&#8220;analog&#8221;) bit generator would be hard/impossible to detect if done right. You would need to have things like a bias that has some thermal drift, maybe some non-random components, etc. for a convincing fake.  It would be dead-obvious on the chip though.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204598">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204598">
						September 22, 2013 6:56 AM					</a>

				</p>

				<p>@ Mike the goat,</p>
<ul><i>It is funny how many people suggest that diehard/etc. test can somehow detect a subverted RNG.</i></ul>
<p>Yes, but I&#8217;ve been waiting for someone to notice two things and put them together,</p>
<p>1, NIST point people via theirs standards at these and similar tests.</p>
<p>2, NIST takes it&#8217;s technical advice in this area from the NSA, and it&#8217;s rumourd the NSA have &#8220;baked in&#8221; weakness in an EC RNG&#8230;</p>
<p>And put them together as something along the lines of &#8220;The easiest way to hide the RNG weakness is to fix the tests&#8221; or something similar.</p>
<p>Thankfull so far nobody has, as trying to disprove that would be niegh on impossible with the fact that there can be,</p>
<ul><i>No one RNG to rule them all,<br />
No one RNG test to find them,<br />
No one RNG test to bind them all,<br />
Into the darkess to hide them&#8221;.</i></ul>
<p>[With appologies to J.R.R.Tolkien]</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204599">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204599">
						September 22, 2013 8:49 AM					</a>

				</p>

				<p>@ MarkH,</p>
<ul><i>I&#8217;m getting way out of my depth here, but to my limited understanding, ring oscillators are used not because they have any particular virtues to recommend them &#8212; but because they are the most practical to synthesize from the MOSFET building blocks of modern CPUs</i></ul>
<p>Yes, in my &#8220;dead tree cave&#8221; I&#8217;ve a number of books and technical papers on using CMOS inverters as both amplifiers and oscillators, the oldest (and here I might be leaking a &#8220;bit&#8221; on my age ðŸ˜‰ is a Motrola &#8220;McMOS Handbook&#8221; from Oct 1973 which claims on it&#8217;s title pace to be a &#8220;First Edition&#8221;.  Chaptor 8 (Anolog) and 12 (timepiece) give quite a bit of info sadly though of metastability and jitter there is a paucity of information other than the equivalant of 4uV broad band noise at each gate input&#8230;</p>
<p>Likewise nearly all other information I&#8217;ve got in the cave is about reducing both metastability and jitter, not enhancing it for entropy extraction. So much so I feal like a 17th century navigator whose charts all have &#8220;here be dragons&#8221; on them.</p>
<p>A little over a decade and a half ago I designed a quick and dirty noise generator based on using a Schmitt nand gate as a chaotic VCO by adjusting the input bias point from a Zener noise source amplified by other gates. This was put on the Clk input of D type with the Data input being driven by an14pin DIP TTL compatable Xtal Osc. The output of this &#8220;roulet wheel&#8221; generator going into a hand full of logic on an ISA bus card. It was fine for Monte Carlo simulations but it was by no means crypto grade. This was because it was faiirly clear the Zener noise source was only responsible for around 80% of the noise voltage driving the Schmitt nand gate input and that from the &#8220;analog amp&#8221; gates was both temprature and powersupply noise sensitive.</p>
<p>Oh one thing of note you can use a 74LS Schmitt gate as a 30MHz. Oscillator with an AT cut crystal, if you take the output of a miniture electret mic it makes a fun little FM transmitter / Bug you can tune into with an ordinary FM radio.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204600">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204600">
						September 22, 2013 9:14 AM					</a>

				</p>

				<p>@ RobertT,</p>
<ul><i>Sorry but I&#8217;m not really up to date on the TRNG literature, I had a list of all of these RNG circuits about a year ago. but had a list of all of these RNG circuits about a year ago. but that was life time and several countries back.</i></ul>
<p>Ouch&#8230;</p>
<ul><i>Personally I&#8217;d never even try to do this sort of thing with&#8221;digital&#8221; cells because their output is not very random, its typically just unbelievably complex, which is not quite the same thing as random.</i></ul>
<p>Which is kind of the conclusion I&#8217;d come to a decade or so ago. It&#8217;s just that in the past decade papers keep turning up claiming fantastic figures for output rate etc and I wanted to see &#8220;what all the noise is about&#8221;. In all the papers I&#8217;ve seen the authors appear to take it as read that the AGWN from metastability / jitter is &#8220;random&#8221; not &#8220;chaotic&#8221; or &#8220;determanistic&#8221; caused by other effects such as on chip activity noise.</p>
<p>It just buggs my &#8220;curiosity gland&#8221; in a similar way that PUFs did with you some time back.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204601">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204601">
						September 22, 2013 10:01 AM					</a>

				</p>

				<p>name.withheld.for.obvious.reasons<br />
&#8211;Likewise, organizing a secure build w/o the ways of middlemanagement in Dilbert or a locked-down military environment will be tricky.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204602">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204602">
						September 22, 2013 10:48 AM					</a>

				</p>

				<p>@ name.withheld and figureitout</p>
<p><b>The fab security issue. Options. </b></p>
<p>Fabs for semiconductor chips are ridiculously complicated and expensive. I&#8217;ve tried to work out how to have several countries running a fab for the low nm processes only because they&#8217;re already so expensive to build that my mere tens of millions (!) in security might be justifiable.</p>
<p>So, what does a person without $1+ billion do who worries about chip subversion and stubbornly continues to use electronics? ðŸ˜‰</p>
<ol>
<li>Stick to old models of stuff I posted above and wall them off.</li>
<li>Use simple or open models of chip built at foreign fabs in countries that spy on US.</li>
<li>Partner with a fab operator to cover the security expense of operating a run with extra security.</li>
<li>Partner with a fab operator to maintain continual security.</li>
<li>
<p>Buy an existing fab off <a href="https://en.wikipedia.org/wiki/List_of_semiconductor_fabrication_plants" rel="nofollow ugc">the list.</a> The best one you can afford.</p>
</li>
<li>
<p>Pay a fab company to build you a working fab.</p>
</li>
</ol>
<p>1 will be easiest. Problem is old stuff is in finite supply and old problems might not be easy to fix. 2 lends itself to people using simpler, text-based computers that run on the cheapest and most easily source foreign computers. Time to break out the DOS and CP/M apps.</p>
<p>3 is about stopping the subversion of a given project. The idea is that, between your design and them manufacturing it, there are steps they can take to subvert it. The activities of 3 are focused on those. 4 is worried about the whole fab being subverted long-term to work against you. Efforts here will need to focus on physical, personnel, manufacturing, and communications security. 3 was expensive. 4 is getting into ridiculously expensive category.</p>
<p>5 might be more practical. In 5, you work against the economic motives by arranging to buy a fab. You might give them time to build their next one. Buy it in a country that doesn&#8217;t worry you too much. The advantage here is that it&#8217;s established with efficient operation and staff who understand the issues. Security can be incrementally implemented into the workflow.</p>
<p>6 is the ideal setup. With 6, one can bake security into every aspect of fab operation by using a risk assessment methodology (and a bit of security mindset). There&#8217;s going to no doubt be plenty of methods or setups in fabs that would&#8217;ve been much easier to secure if done differently. A design starting from scratch can make different choices.</p>
<p>If 5 or 6 are chosen, one can always make most of the chips for commercial and military market. The <em>fab</em> might exist to produce the few chips you need to trust, but most of the <em>chips</em> can be for others and pay back the cost a bit. A bit of the market might be willing to pay a premium for chips with low subversion risk.</p>
<p>If 3, 4, 5, or 6 are chosen, one of the best projects might be to create building block chips. Lets say we have a limited investment allowing only a few runs. Single-purpose, throw-away hardware doesn&#8217;t cut it here. It would be best to make a few useful chips (CPU/MCU/DSP/FPGA) that could cover a huge number of applications and even be retargetted to them. So, if you had only a few runs, you&#8217;d at least have a pool of trustworthy chips you could keep using or reusing in different projects. If you get more runs later, then you have a few proven and mostly paid for designs ready to go.</p>
<p>Disclaimer: I&#8217;m neither an electronic engineer nor a fab operator. None of this is gospel.</p>
<p>Previous discussion with RobertT and Clive on technical details here.</p>
<p><a href="https://www.schneier.com/blog/archives/2011/07/research_in_sec.html" rel="nofollow ugc">https://www.schneier.com/blog/archives/2011/07/research_in_sec.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204603">

			<div class="comment by-name-withheld-for-obviuos-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obviuos.reasons</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204603">
						September 22, 2013 1:27 PM					</a>

				</p>

				<p>@Nick P</p>
<p>Very thoughtful treatment on the topic Nick, you inspired me to come up with an additional option&#8230;let me make a comment first. Yes sub 200nm fab is exceedingly expensive and since the off shoring of fabs to Taiwan I&#8217;ve always seen the domestic sourcing of all types of components as suspect. SEMTech was supposed to be a fab consortisium to keep fab capabilities with the domestic purview. We seem to, here in the US, forgotten the value of domestic production. The DoD has taken a dangerous approach to procurement for the sole purpose of &#8220;selling&#8221; weapon systems. What does that have to do with National Security? Eisenhower was the last President to oversee the War Department before it became its own department. I could cover this topic but I digress.</p>
<ol>
<li>Petition fab OEM&#8217;s to embrace a community (worldwide) to adopt a secure fab platform source chain. Everyone benefits from a reliable fab process, no one wants to see for example Airbus 380&#8217;s falling out of the sky because they cannot acquire reliable components. </li>
</ol>
<p>On a side note I am very concerned about the toolchain integrity of RTL and synthesis tools for fabless production. I see it as the choke point</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204605">

			<div class="comment by-name-withheld-for-obvious-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obvious.reasons</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204605">
						September 22, 2013 1:54 PM					</a>

				</p>

				<p>@Clive</p>
<p>&lt;</p>
<p>blockquote&gt;<br />
Yes, in my &#8220;dead tree cave&#8221; I&#8217;ve a number of books and technical papers on using CMOS inverters as both amplifiers and oscillators, the oldest (and here I might be leaking a &#8220;bit&#8221; on my age ðŸ˜‰ is a Motrola &#8220;McMOS Handbook&#8221; from Oct 1973 which claims on it&#8217;s title pace to be a &#8220;First Edition&#8221;. Chaptor 8 (Anolog) and 12 (timepiece) give quite a bit of info sadly though of metastability and jitter there is a paucity of information other than the equivalant of 4uV broad band noise at each gate input&#8230;<br />
&lt;/block quote&gt;<br />
Glad to know I am not the only one holding on to data books but I don&#8217;t have any that predate the 1980&#8217;s. In fact in 2000 I became so concerned with what I term &#8220;information integrity&#8221;. Just yesterday I was stating a dir to audit time stamps and 2 lines in the standard output showed the same file name (not consecutively, sorted by mod times). Went to scrap the output to the console but I erred by issuing a few commands and scrolled back the console buffer and the duplicated entry was no longer there. And I knew I should have caught it before doing anything else.</p>
<p>My favorite source data books are from National Semi, was tragic to lose Jim Williams last year. The timing of his death and its impact on NS is a story in and of itself.</p>
<p>Keep your copies Clive, please identify a suitable home for them in the event you are taken. We may need them more than we know.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204606">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204606">
						September 22, 2013 2:15 PM					</a>

				</p>

				<p>Nick P<br />
&#8211;The wave really repeated in that link, I&#8217;ve been sidetracked in reading the archives, wanted my PIR be read by my arduino.</p>
<p>Something seems not right, reverting to ebay for secure sourcing, I&#8217;ve had my mail packages tampered w/ before, really didn&#8217;t appreciate that; trust gone there.</p>
<p>Seems pretty impractical; saving up for a few runs seems best where I and maybe others can sleep at the facility and monitor the entire process.  Would need to interview some engineers.  I really want to visit a fab lab.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204607">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204607">
						September 22, 2013 2:26 PM					</a>

				</p>

				<p>@ Nick P,</p>
<p>You might find this interesting, especialy when you look at the date,</p>
<p><a href="http://theinvisiblethings.blogspot.co.uk/2009/06/more-thoughts-on-cpu-backdoors.html" rel="nofollow ugc">http://theinvisiblethings.blogspot.co.uk/2009/06/more-thoughts-on-cpu-backdoors.html</a></p>
<p>@ Name.witheld&#8230;,</p>
<p>Yes I have some very old and now impossible to replace books in the cave, but weighing in around 7000Kg it&#8217;s become a bit of a problem in terms of &#8220;caring for the beast&#8221; and like the rest of us I&#8217;m not as young as I was yesterday.</p>
<p>But rest assured I&#8217;ve no intention of going out the Viking way, but have not yet made my mind up who would best benifit by the collection.</p>
<p>You have to be carefull&#8230; In South East London &#8220;Croydon Council&#8221; have decided to flog of some very rare artifacts they were bequested. And it looks like not only are they selling at the wrong time and thus willl lose a considerable. Amount off the value they will also be lost not just to those in London but to the whole Nation as they will in all probability go abroad into private collections&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204608">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204608">
						September 22, 2013 4:03 PM					</a>

				</p>

				<p>@ name.withheld</p>
<p>&#8220;We seem to, here in the US, forgotten the value of domestic production.&#8221;</p>
<p>I agree. We&#8217;re too dependent on other countries, especially competitors, for critical things. Plus, putting semiconductor manufacturing in control of people who might backdoor you just seems&#8230; stupid. It&#8217;s why the old discussion I had here involved US funding a state-of-the-art fab they control for chips that <em>have</em> to be trustworthy. Of course, now I&#8217;m working on how to get chips that <em>aren&#8217;t</em> American so <em>Americans</em> can trust them. Life&#8217;s 180&#8217;s are certainly amusing.</p>
<p>&#8220;On a side note I am very concerned about the toolchain integrity of RTL and synthesis tools for fabless production. I see it as the choke point &#8221;</p>
<p>Absolutely. Goes all the way back to Reflections on Trusting Trust. Many people cite that to worry about compilers. They&#8217;re missing the bigger picture of it. The old work on security told us how to architect, specify and to a degree implement secure systems. The aforementioned paper pointed out that we must also trust the tools that turn those abstractions into something concrete. So, as you said, the RTL &amp; synthesis tools will be an issue. I think we&#8217;ll need something similar to Leroy&#8217;s CompCert verifying compiler but for hardware designs. Fortunately, there&#8217;s been a ton of work on hardware verification of all kinds. Verisoft&#8217;s VAMP and total verified stack being my favorite. Look up the papers on how they architected that to verify each layer and interaction. Great stuff. Any complex subversion resistant design will be using similar techniques.</p>
<p>I think it shouldn&#8217;t be hard to create a verifiable translation system from lower levels to chip structures. I&#8217;m pretty sure existing tools already do that to a degree, albeit as a proprietary black box. Might be a matter of licensing the technology from a larger vendor, breaking it into verifiable pieces, building/vetting each one, vet the combo, and use trusted distribution techniques from there to get it to end users. The software should also be <em>very</em> easy to port to arbitrary hardware so it can all be bootstrapped and also hardware remains vendor/ISA neutral. Forth or LISP are almost an ideal target for the verified translator, as their core is easy to port. (There are also Forth/Lips processors, established open implementations, &amp; VLISP was rigorously verified.) Even if it doesn&#8217;t <em>fully</em> verify the hardware, it verifies so much of it that it leaves only the most low-level steps of the production process to worry about. Less worry is always better.</p>
<p>Note: My usual method for high assurance translators is to use a typical (fast) translator for development, then do the final run with the provably correct (often ridiculously slow) translator. I mean, what if the only trustworthy bootstrap a person has is a 100MHz machine with 32MB RAM and they&#8217;re running bare metal LISP (w/ no unsafe optimizations) on it? And memory is constantly swapped to disk? The conversion could take&#8230; a while. So, to make up for it, I&#8217;ve always advocated combining trusted and untrusted systems for software lifecycle management where critical steps happen on trusted system before signature or release. Seems like a decent compromise?</p>
<p>@ figureitout</p>
<p>&#8220;Something seems not right, reverting to ebay for secure sourcing, I&#8217;ve had my mail packages tampered w/ before, really didn&#8217;t appreciate that; trust gone there.</p>
<p>And the irony is that, if your PC is using modern Intel or AMD, a stealthy subversion is <em>much</em> easier for attacker in question (NSA). ðŸ˜‰ Interception and modification of something you buy on eBay is tricky. It must be targeted, it requires knowledge of the product, it can&#8217;t interfere with shipping time too much, etc. So, if you&#8217;re worried about that, browse what to buy with an anonymous browsing solution, have someone else buy/receive it for you, pay extra for overnight shipping (shorten attack window), and pay the person aiding you via cash. Many black hats use this strategy (minus overnight shipping) to acquire laptops for their online activities.</p>
<p>&#8220;seems pretty impractical&#8221;</p>
<p>COTS has proven to be the most practical. It also proved to be easy to subvert. So, anything we make that is hard to subvert is going to be impactical. And impractical aspect may be directly proportional to subversion resistance. Security is anything but convenient in this category.</p>
<p>&#8220;saving up for a few runs seems best where I and maybe others can sleep at the facility and monitor the entire process. Would need to interview some engineers. I really want to visit a fab lab.&#8221;</p>
<p>Sounds like a decent idea. For recruits, maybe look into those CCC parties thrown supporting Wikileaks. There were plenty of hackers and anti-government types there. They have the security mindset (maybe), are usually ideological, and could learn enough tech.</p>
<p>I&#8217;d also like to visit one some time for the heck of it. I&#8217;d particularly be interested in wrapping my mind around all the technology there. I mean, in high end fabs, individual machines can go up to $50 million. Mind-boggling. It would suck to spill a can of soda on <em>that</em>.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204609">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204609">
						September 22, 2013 4:31 PM					</a>

				</p>

				<p>@Nick P:</p>
<blockquote><p>&#8220;It would suck to spill a can of soda on *that*.&#8221;</p></blockquote>
<p>Possibly, one wouldn&#8217;t be invited to visit again.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204610">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204610">
						September 22, 2013 7:10 PM					</a>

				</p>

				<p>@Clive R</p>
<p>&#8220;ouch&#8221;</p>
<p>I miss for the old days when the who and why were obvious but the what-to-do was an unknown, these days the what-to-do is second  nature but the who and why questions remain, sure makes for a world of shadows.</p>
<p>@Gweihir<br />
 You need to understand the concept of &#8220;processing gain&#8221; as it applies to any spread spectrum comms system. Unfortunately the inclusion of an LFSR creates a long sequence locking mechanism which reveals the true nature of the source noise. What is important here is ensuring that the &#8220;noise input&#8221; is an order of magnitude greater than the dither added.</p>
<p>As for using the digital baseband byte wise/word-wise outputs of the SD-ADC, frankly I&#8217;d much rather access directly the bit-wise outputs of the modulator elements (pre-decimation) the algorithmic nature of FIR and IIR digital filters is a big unknown I&#8217;d rather not deal with.  All SD ADC&#8217;s are noise shaping loops, so maintaining this extra noise and complexity makes your adversaries problems that much more difficult.  BTW you will need to add a couple of Zero&#8217;s to the transfer function to flatten the frequency response of the noise.</p>
<p>Re: NIST random number tests.<br />
I agree with what Nick P and others have said about all TRNG output  looking perfect after algorithmic processing. It is well known that modern crypto algorithms are indeed that good.  So instead of GIGO you get still have the GI but the next stage looks perfect, it makes this just too easy a solution.</p>
<p>I&#8217;ve had this argument many times in design reviews where these difficult to achieve NIST spec&#8217;s (diehard etc) become the rational for resorting to algorithmic digital processing complexity because NO raw True Random can actually pass all the tests.<br />
 For low level signals (like noise) getting more than about 40dB signal to distortion ratios is very difficult. This lowish SNDR means that there are obvious spurs in the FFT of most raw TRNG data. Fortunately a little bit of digital post processing and all the spurs completely disappear.  Indirectly the NIST is rewarding the &#8220;dishonest&#8221; TRNG maker because the tests are practically impossible to pass if you dont &#8220;cheat&#8221;. Additionally any competent adversary will make it their business to understand how you cheated, so they alone can unscramble the scrambled mess that you are claiming is &#8220;raw trng&#8221; data.</p>
<p>Frankly I&#8217;d much rather a situation where the real world limitations of the TRNG problem were reflected in the spec because then the security community can than deal with the reality of biased rng streams.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204611">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204611">
						September 22, 2013 10:13 PM					</a>

				</p>

				<p>@RobertT: What does that have to do with Spread-Spectrum? I was asking about the dither amplitude and whether it was strong enough to be recognized directly. Maybe you are just using big words to say &#8220;no&#8221;? Also don&#8217;t forget that the LFSR has a base clock frequency and in is putting out pulses very often in that raster. A real spread-spectrum design uses a cryptographically strong sequence and far longer spacing and there you have no chance to find the signal. Not so for an LFSR.</p>
<p>As for your second paragraph, I guess you are talking about an oscillator-jitter generator (no bit-wise output otherwise), and of course you would never put that through an ADC, that is just for an avalanche generator.</p>
<p>For the tests, I completely agree. They would do far better having statistical tests applicable before whitening, as after whitening these tests become meaningless. But we may see the hand of the NSA here: If you do raw-generator tests before whitening, you can very likely detect generators that have tampered with (well, maybe with an additional check of the chip, but some attack-targets of the NSA must have that capability) <em>and</em> you have to make these raw outputs available! With making the tests strong enough to fail on almost all non-whitened output, but weak enough to succeed easily in whitened output (as they cannot made strong enough to detect bad cryptographically whitened output), they have removed the need to make the raw signal available. I think that is highly suspicious.</p>
<p>Contrast that with the VIA C3 generator, where you get the raw output if you want it. There you can see all the non-random things and it allows you to find out whether the generator really displays all the faults in behaving randomly its design indicates. The VIA C3 generator also shows how damn easy it is to give access to the raw noise, just a shift register and one switch is enough.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204612">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204612">
						September 22, 2013 10:30 PM					</a>

				</p>

				<p>Nick P<br />
&#8211;It was just textbooks thankfully, but it affected my education; people need to factor in all these hidden costs of their pathetic ops.  I&#8217;ve known of people shipping drugs to their school mailbox; so they need to get their head out of their rear.</p>
<p>You don&#8217;t need to tell me about stealthy subversion, I&#8217;ve seen plenty of ridiculous hacks that still puzzle me.</p>
<p>I think there would be shots fired if you spilled soda on such a machine; I mean I would probably shed a tear.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204613">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204613">
						September 23, 2013 12:38 AM					</a>

				</p>

				<p>The point with understanding the LSFR&#8217;s dither is that it adds pseudo noise to the SD loop.  If the SD input were locked at zero signal (normally mid point), then the pseudo random nature of the LSFR output still whitens the SD&#8217;s raw bit output sequence making an output that appears &#8220;white&#8221; while it is actually highly deterministic. Anyone that knows the type of LSFR that is used can perform a simple correlation operation  on the bit serial output and remove the effect of the dither.</p>
<p>In a way this is exactly the same problem as the algorithmic cryptographic whitening of TRNG&#8217;s but just applied one stage earlier. I&#8217;ve referenced to spectrum spreading because the all the Receiver techniques/tricks for DSSS type systems operating 20dB or more below the channel AWGN limit, can be used to analyze the effect of LFSR&#8217;s  on RNG sequences.</p>
<p>Maybe you need to study and simulate some lower order ADC Sigma Delta modulators.  With first and second order loops the output of the first integrator stage is basically tracking the input signal. This means that the comparator is always just looking at small differences (Deltas) except when input signals are slewing very quickly.<br />
Meaning you must add dither or the &#8220;error&#8221; into the loop because it might not naturally accumulate quickly enough to keep all the frequency components of the SD loop noise shaping function out of the baseband region.</p>
<p>Re second paragraph.<br />
Internally nearly all Sigma Delta&#8217;s output a serial bit sequence at the input clock &#8220;Over Sampled signal rate&#8221; So for an OSR of say 128. A 10Khz ADC bandwidth requires a clock rate of 1.28Mhz, this is the raw bit stream. This bit stream is digitally filtered (typically FIR or IIR filters) to produce the baseband data.  I&#8217;m saying I&#8217;d rather use the OSR data (for TRNG) than the baseband post filtered data. this is nothing to do with loop jitter.</p>
<p>Anyway I&#8217;m done with this discussion, I&#8217;m happy to acknowledge that I know practically nothing about this topic, so I&#8217;m probably just writing complete FUD.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204614">

			<div class="comment by-gweihir ">

				<p class="commentcredit">

					<span class="commenter">Gweihir</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204614">
						September 23, 2013 2:54 AM					</a>

				</p>

				<p>@RobertT: Thanks, I did not realize you were talking about Sigma-Delta converters. I am still firmly stuck at the successive-approximation stage for faster A/Ds. Should have realized that SD is probably cheaper to do for 16 bit audio by now and also fast enough.  My interest in audio electronics is small, so I do not really follow the development there.</p>
<p>Just one thing about LFSRs: You actually do not need to know what type it is, you can synthesize an equivalent one from the bit-stream using the Berlekamp-Massey algorithm. Did this a long time ago in a cryptography lab.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204615">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204615">
						September 23, 2013 11:29 AM					</a>

				</p>

				<p>&#8220;Possibly one wouldn&#8217;t be invited to visit again&#8221; (MarkH)</p>
<p>&#8220;I think there would be shots fired if you spilled soda on such a machine; I mean I would probably shed a tear.&#8221; (figureitout)</p>
<p>Probably true on both counts. lol</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204616">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204616">
						September 23, 2013 1:35 PM					</a>

				</p>

				<p>@ Clive Robinson,</p>
<blockquote><p> <i> German not English BSI standard AIS-31 &#8230;</i></p></blockquote>
<p>Thank you Sir[1]! Maybe one of the things I was looking for. Problem is, unfortunately, Mein Deutsch  ist sehr schlecht :(, and I could not find the german version either.</p>
<p>This will take sometime, but may help answer some of the questions I have.</p>
<p>[1] I had a British colleague, that I called him Sir once. He said I am not &#8220;Sir&#8221;, I was not knighted.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204617">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204617">
						September 23, 2013 2:04 PM					</a>

				</p>

				<p>Please remember, an automatic entropy estimator can tell you that the entropy is not greater than X (i.e., can estimate an upper bound).</p>
<p>But the actual entropy may be smaller than X by an astronomically large factor, and there is no way to make the estimator &#8220;smart&#8221; enough to prevent such an outcome.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204618">

			<div class="comment by-cointelpro ">

				<p class="commentcredit">

					<span class="commenter">Cointelpro</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204618">
						September 23, 2013 4:09 PM					</a>

				</p>

				<p>204 comments on that subject: this thread is obviously trolled, in the interest of NSA.</p>
<p>Trolling ways: fights, poems, moquing, damage control: all elements of the Cointelpro techniques as detailed in <a href="http://cryptome.org/2012/07/gent-forum-spies.htm" rel="nofollow ugc">http://cryptome.org/2012/07/gent-forum-spies.htm</a> ; these began, one or two months ago, to surface in threads of schneier.com.</p>
<p>Next time you feel that you are answering to a Cointelpro agent, do not forget to state also that:<br />
&#8220;I have the feeling that you was payed to deploy technique #24 of Cointelpro in your comment, as defined by <a href="http://cryptome.org/2012/07/gent-forum-spies.htm" rel="nofollow ugc">http://cryptome.org/2012/07/gent-forum-spies.htm</a> &#8230;&#8221;<br />
Do not forget to replace 24 by the right number.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204619">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204619">
						September 23, 2013 4:40 PM					</a>

				</p>

				<p>@ Wael,</p>
<ul><i>I had a British colleague, that I called him Sir once. He said I am not&#8221;Sir&#8221;, I was not knighted</i></ul>
<p>Yup it can be confusing ðŸ™‚</p>
<p>The simple rule is &#8220;sir&#8221; on it&#8217;s own is an honerific not a title, it becomes a title when it&#8217;s with the name such as &#8220;Sir Clive&#8221; or &#8220;Sir Clive Sinclair&#8221; but don&#8217;t say &#8220;Sir Sinclair&#8221; it&#8217;s bad form</p>
<p>So the honourific use is if you don&#8217;t know someones name or you&#8217;ve not been introduced then it would be &#8220;goodevening sir&#8221; you also use it on it&#8217;s own when acknowledging an officer in the armed forces as a mark of respect to the monarch. It used to be that school children would call their teachers Sir or Miss or Mam / Madam respectivly.</p>
<p>Also watch out for the use of Mr, Miss or Mrs, it would be Mr Robinson or Mr Clive Robinson. Not Mr Clive, this is known in my and older generations as &#8220;Slave Talk&#8221; and it&#8217;s considered to be very wrong and way beyond being Un-PC.</p>
<p>The use of Mr/Miss/Mrs/Ms is going out of fashion so I would probably be introduced to you as &#8220;Wael meet Clive, Clive meet Wael&#8221; or &#8220;Wael this is Clive Robinson&#8221;.</p>
<p>Other things that are going out of fashion are the realy old things. As I am &#8220;a person of property and title&#8221; (briefly Lord of the Manor) this ment I was considered to be a step above a gentelman so instead of Mr. C.Robinson I could sign letters etc as C.Robinson Esq. for esquire, which I beleive is reserved in the US for the legal profession</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204620">

			<div class="comment by-dirk-praet ">

				<p class="commentcredit">

					<span class="commenter">Dirk Praet</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204620">
						September 23, 2013 7:31 PM					</a>

				</p>

				<p>@ Cointelpro</p>
<p>Interesting link, but you obviously haven&#8217;t been here long enough to know that the bulk of these posts have been made by long-time commentors in good standing like @ Clive Robinson, @ Nick P, @ RobertT, @ Gweihir, @ name.withheld.for.obvious.reasons , @ Wael and several others.</p>
<p>Instead of venting baseless accusations, you would probably have served yourself better by trying to understand the ongoing discussions, in the process getting a valuable free course on several subject matters. That&#8217;s what I did. And yes, we regularly disagree on stuff.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204621">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204621">
						September 23, 2013 11:01 PM					</a>

				</p>

				<p>@ Gweihir,</p>
<blockquote><p><i>The &#8220;AES&#8221; is the AES in the whitener in RdRand, and it is not consumer-side at all, it sits between the hardware generator and the RdRand instruction and you cannot get at the hardware generator past it. If you could get at the hardware generator directly, it would be (relatively) easy to find sabotage or to bypass it.</i></p></blockquote>
<p>That is what I was thinking needs to be done as part of the test. If the RNG with its building blocks are a black box, then statistical tests would fail to show sabotage (unless the papers @ Clive Robinson pointed to show otherwise)&#8230; Chips are very complex, and functional tests may not be sufficient to detect subversion. Part of the tests that I suppose are not available to the public are verification tests, which would have better chance finding subversion.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204622">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204622">
						September 23, 2013 11:53 PM					</a>

				</p>

				<p>@ Clive Robinson,</p>
<blockquote><p><i>One way of looking at information entropy is it defines &#8220;the number of possabilities&#8221;, anything that is predictable reduces the possabilities.</i></p></blockquote>
<p>I think about it differently. I believe there is nothing random in this universe. Everything has order. If we cannot detect a pattern or predict the future of a sequence, we call it random. &#8220;Randomness&#8221; is a defect in our understanding or a side effect of an incomplete or erroneous model of some phenomena.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204623">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204623">
						September 24, 2013 2:26 AM					</a>

				</p>

				<p>@Wael:</p>
<blockquote><p>&#8220;If the RNG with its building blocks are a black box, then statistical tests would fail to show sabotage&#8230;&#8221;</p></blockquote>
<p>Yes.  I&#8217;ve been doing my best to explain <i>why</i> such tests can never prove that an RNG is cryptographically secure.</p>
<blockquote><p>&#8220;Chips are very complex, and functional tests may not be sufficient to detect subversion.&#8221;</p></blockquote>
<p>I think that is the consensus among those who have considered the question.  I would strengthen the conclusion:  functional testing not only may fail to detect subversion; such testing cannot give a high degree of assurance that subversion did not occur.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204624">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204624">
						September 24, 2013 6:38 AM					</a>

				</p>

				<p>@ Wael,</p>
<p>I know this. Is going to sound like the first line of a joke but it&#8217;s neither a joke or funny,</p>
<p>&#8220;When is a chip not a chip?&#8221;</p>
<p>The answer is to all intents and purposes you don&#8217;t know. It falls to those two well known saws,</p>
<p>&#8220;If it walks like a duck and quacks like a duck&#8230;&#8221;</p>
<p>&#8220;The contents are what it says on the tin.&#8221;</p>
<p>And for the majority of chips used in the electronics industry the supply side goes with the &#8220;what it says on the tin&#8221; and just a few go through the &#8220;duck test&#8221; as part of the QA process.</p>
<p>As I&#8217;m sure you realise from software testing once you get above a certain degree of complexity full functional testing is not actually possible let alone full state testing by the chip manufacturer. So what chance has the end user got?</p>
<p>Once you get out of the certainties of logic you find those gates are realy all analog circuits and suffer the attendant problems and hidden cludges (how you turn a SR Latch into a D type register being one). You thus get such problems as metastability where every once in a while (about one time in a billion or better) the logic will go to the wrong state, go to the wrong state and flip back, take an age to go to the right state or just latch up untill the power is recycled all of which does not usually play nicely with down stream functionality. Now you can not stop this behaviour only mitigate it in some way usually by adding aditional logic.</p>
<p>When production chips are tested they are tested to see at what clock speed they will run at by some measure of reliability. And in times past a manufacture would put a speed rating on the device and price accordingly. However there is a lot of profit in premium product but the main turn over is in non premium parts, so the chip manufactures mark down a lot of what would be premium parts into lower speed ratings, which is where &#8220;over clockers&#8221; get some of their fun.</p>
<p>Unfortunately this gives rise to some low moral individuals buying the low cost parts and relabeling them as premium parts and putting them back in the supply chain. Various techniques have been tried to stop the practice but such parts make it onto the market and into products regardless.</p>
<p>The problem is that once a chip is encapsulated you cannot perform some qualifing tests so the only way to be sure a chip is what it is is by destructive testing, which kind of makes them difficult to use as production parts. Which is why &#8220;goods inward test&#8221; is at best a partial procedure.</p>
<p>There are also those who know this and use it to actually make &#8220;Chinese Knock Offs&#8221; whereby they make their own copies of the chips only by using cheaper production techniques.</p>
<p>One side effect is the metastability issue raises it&#8217;s ugly little head, in making copies the mitigation logic in problem areas may well get left out as it&#8217;s not directly &#8220;functional&#8221;. This brings the soft MTBF figures way way down on the knock off parts&#8230; Testing for this in &#8220;goods inwards&#8221; is a compleat non starter due to time constraints and the stress testing that would show it up would do a bit more than &#8220;burn the part in&#8221;.</p>
<p>But&#8230; all these Digital TRNGs work on metastability, such as connecting the output of an inverter back to it&#8217;s inputto make it oscillate and then changing it&#8217;s input bias point or supply voltage to change the frequency in some supposadly unpredictable way. Two or more of these are then gated to gether and fed into the clock input of a following circuit that acts like either a frequency counter or mixer, in either case thecounter LSBs or mixer output is assumed to have the addative metastabillity jitter on it&#8217;s output.</p>
<p>There are two main issues with this,</p>
<p>Firstly the metastability is in effect the byproduct of the analog bias points of the inverter being used as a high gain amplifier with a total of 360 degree feedback making it an oscillator. There is an old saying in the RF electronics design world &#8220;Oscillators don&#8217;t, Amplifiers do&#8221; which gives rise to another saying &#8220;If you want to design an oscillator design an amplifier&#8221;. Basicaly both are highly sensitive to design parameters and this includes the bias points. Now this brings up an issue, of is metastability random or chaotic? Chaos is complex but still determanistic, random is not determanistic. Thus is the gain in the chaotic system sufficient to amplify the non determanistic quantum/thermal effects at the bias points to make them predominant or even present at the output? The simple answer appears to be &#8220;we hide behind the duck test&#8221; which is a &#8220;cop out&#8221;. As has been noted by RobertT when it comes to looking like AGWN there are many quite simple circuits (LFSRs, LFGs/Lfibs, CAs and add/mul/squ mod n) that all produce what looks like AGWN but are without doubt fully determanistic. Some of these can be found in the likes of Sigma Delta (SD) DTRNGs. So are we kidding ourselves about the supposed randomnes of DTRNGs?</p>
<p>Secondly these DTRNGs are usually buried deep within the chip and as I&#8217;ve indicated sensitive to temprature voltage and the activities of circuits around them, testing them reliably is impossible in any meaningfull time frame and impossible once their output has been de-biased and then put through a crypto function.</p>
<p>Can these DTRNGs by nobbled, yes, can it be reliably detected after being put through a crypto function, yes if you know the method and key no otherwise. What about keyless crypto functions such as hashes&#8230; well we know how to find collisons in one kind of hash and we are aware that the NSA knowes atleast one other. Also we know that some hash functions are &#8220;brittle&#8221; in that small changes in their design makes them very weak, but you only see this if you can see both the inputs and outputs to run tests on.</p>
<p>Now getting back to the simple DTRNG of two oscillators and a D type, if you look at the output on an oscilloscope with the time base turned down you can see what looks like regularly spaced bunchin of the waveform. If you measure the frequency difference of the two oscillators you will see it nicely correlates in period and phase to the bunching. This means that without doubt the output is serialy correlated and the bits are not independent of each other. Von Neuman debiasing only works when the bits are fully independant otherwise it simply has the effect of dividing the bit ouput rate by four. You can see this on the oscilloscope screen but to a lesser extent. So with two high stability oscillators or oscillators locked to a refrence the entropy of this DTRNG is very close to or ZERO&#8230; This is quite clear in the output if you run the right statistical tests in the right way, thus run the wrong tests or in the wrong way and this DTRNG of zero entropy and easy predictability will pass&#8230;</p>
<p>Is it easy to lock these oscillators up? yes and in effect invisably if you examine the chip layout with a &#8220;digital eye&#8221; not an &#8220;analog eye&#8221;. To see how, go and look up &#8220;injection lockinng&#8221; and how it&#8217;s used in your colour TV &#8220;chroma burst&#8221; system as used in both NTSC and PAL (PAL gets it&#8217;s name from correcting a problem in NTSC which alows phase drift and thus chroma problems).</p>
<p>Now as has been mentioned GIGO does not work with encryption primatives unless you either know the key or the method the output is &#8220;golden&#8221;.</p>
<p>Now as I&#8217;ve repeatedly stated you need access to the raw TRNG output to check the system functionality. This alows you to check both the TRNG and the crypto function. Not providing it is such bad practice it raises suspicion in it&#8217;s own right. As I&#8217;ve said &#8220;verify and trust&#8221; is the only trustworthy path so I consider Intels DTRNG untrustworthy by definition.</p>
<p>So getting back to the argument. Locking the oscillators up is fairly trivial, thus the result from the D type is a highly predictable digitised sine wave. If you likewise fritz the crypto function if it&#8217;s a hash or know the key if it&#8217;s AES etc then you know or can fairly quickly find the DTRNG output.</p>
<p>As I noted above the output will be fine for Monte Carlo and other similar activities but very dangerous for Crypto work.</p>
<p>Similar arguments can be made for all DTRNGs so you need to be able to &#8220;verify&#8221; and/or mitigate with other sources of entropy in some kind of entropy pool where the mixing function is especialy good at dealing with long sequence serial corelation. One such involves the use of &#8220;Chinese Remainder&#8221; maths on primes to get maximal sequence sampaling/shuffeling.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204625">

			<div class="comment by-jack-gatrost ">

				<p class="commentcredit">

					<span class="commenter">Jack Gatrost</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204625">
						September 24, 2013 9:39 AM					</a>

				</p>

				<p>A question for any mathematicians out here:</p>
<p>If the byte streams from two different random number generators are bitwise XOR&#8217;ed, &#8230;</p>
<p>1)  Can the result end up any less &#8220;random&#8221;?</p>
<p>2)  Is there any reason to expect a more random value from this action?</p>
<p>For example, mixing with bitwise XOR the output from a hardware RNG with a software PRNG output.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204626">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204626">
						September 24, 2013 10:42 AM					</a>

				</p>

				<p>@ Jack Gatrost,</p>
<ul><i>A question for any mathematicians out here If the byte streams from two different random number generators are bitwise XOR&#8217;ed</i></ul>
<p>As you don&#8217;t say if the two byt streams are independent or not there are several answers.</p>
<p>If the streams are not interdependant and fully random, over a long period the output is assumed to still be random and the effective entropy the normalisation of the addition of the entropy of the two streams.</p>
<p>However of short distances there is the probability that the two streams will match and produce all zero&#8217;s, all one&#8217;s or a very regular pattern the probability of this is fairly easily found with a truth table by hand or simple mathmatics.</p>
<p>If however they are not fully independent then the situation is different and depending on how dependent they are and any offset involved defines how much entropy there is.</p>
<p>The simple case is when the streams are the same or one is the inverse of the other the output is going to be zero or one so the outp is fully determanistic so no entropy at all.</p>
<p>Lesss well known is that form many sequencies that have been linearly generated adding them together is the equivalent of simply adding them together (think of adding two sine waves together with a phase differance and you end up with another sine wave but phase shifted). So the entropy remains the same.</p>
<p>Even non linear sequencies exhibit this shift behaviour. To see why you need to do a Walsh Analysis (equivalent of a Fourier Analysis but using digital sequencies not frequencies) on the non linear sequence to remove the basic sequencies and identify the correlations which either cancel or sum to one when shifted in time (ie as linear components).</p>
<p>I hope that provides you with sufficient information to dig further if you wish.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204627">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204627">
						September 24, 2013 11:46 AM					</a>

				</p>

				<p>@ Jack Gatrost, @ Clive Robinson</p>
<blockquote><p> A question for any mathematicians out here If the byte streams from two different random number generators are bitwise XOR&#8217;ed </p></blockquote>
<p>The output will still be random (as long as A and B are two independent sources, as @ Clive Robinson mentioned), with a different distribution. If the two streams A and B have a uniform distribution (Probability Distribution Function, pdf), and we XOR them (approximate that with an addition operation), then the output will be random with a Gaussian pdf, or normal distribution (the bell curve). This results from convolution.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204628">

			<div class="comment by-markh ">

				<p class="commentcredit">

					<span class="commenter">MarkH</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204628">
						September 24, 2013 6:27 PM					</a>

				</p>

				<p>@ Jack Gatrost:</p>
<p>Disclaimer:  I&#8217;m no mathematician.  The following is my non-expert understanding.</p>
<p>If a bit sequence has &#8220;perfect&#8221; entropy (1 bit of entropy per bit of data:  for example, the results of &#8220;fair coin tosses&#8221;), then it can be XORed with any other independent bit sequence, and the data will be just as entropic (disordered).  This is the cornerstone of the Vernam (one-time pad) cipher.</p>
<p>As a practical matter, if the entropy of an RNG is satisfactory, there&#8217;s nothing to be gained by XORing it with a PRNG.</p>
<p>On the other hand, if the RNG output is imperfect (not perfectly entropic), a usual way to enhance the output entropy is using a hash function.  For ordinary hashes, the digest (output) is of fixed size, based on inputs of varying and potentially large size.</p>
<p>For example, suppose a careful evaluation of an RNG concludes that the entropy per output bit is at least 0.25.  One could then collect RNG output into &#8220;batches&#8221; of 1024 bits, applying SHA-256 to each batch.  The 256 bit digest (output) from the hash operation should then have 1 bit of entropy per bit of output:  the hashing process destroys any &#8220;patterned-ness&#8221; (predictability) in the raw RNG output.</p>
<p>To improve the quality of RNG output for crypto purposes, hashing (I believe) is a much safer procedure than simply XORing with output from a PRNG (whose entropy is limited to its seed).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204629">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204629">
						September 24, 2013 8:27 PM					</a>

				</p>

				<p>Slightly off Topic: Re XORing multiple RNG sequences</p>
<p>Many Forensic Accounting tools rely on the data set Order created by adding groups of Random numbers. Benfords law is just such an effect.</p>
<p><a href="http://en.wikipedia.org/wiki/Benford&#039;s_law" rel="nofollow ugc">http://en.wikipedia.org/wiki/Benford&#039;s_law</a></p>
<p>My point is that the data order created in large random data sets can often be simply the result of the way we process/view the data. Leading Digit theory is a direct consequence of using Base10 arithmetic and it is not an effect that most people (even security professionals) are watching out for when they create / manipulate RNG data sets.  This means that a bit wise XOR of RNG sequences is safe but an actual ADD of two or more Random Number sets not safe. Small difference in the arithmetic operator but a huge difference in the result.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204630">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204630">
						September 24, 2013 8:51 PM					</a>

				</p>

				<p>@ RobertT</p>
<p>Bitwise XOR operation is identical to bitwise ADD operation (ADD with no carry). Would you care to explain the unsaftey of the ADD operation?</p>
<p>0+0 = 0<br />
0+1 = 1<br />
1+0 = 1<br />
1+1 = 0 (ADD, not ADC)</p>
<p>XOR has an identical &#8220;truth table&#8221;.</p>
<p>In fact you can use the add operation instead of the XOR operation to exchange the values of two variables in place in three steps, just like you can with an XOR.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204631">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204631">
						September 24, 2013 9:24 PM					</a>

				</p>

				<p>@Wael,<br />
 It is precisely this minor difference between a simple bitwise  Add and an Add-with-Carry that can create problems.  Unless you are looking for exactly this type of issue the two Arithmetic operators look very similar, so it comes as a surprise to many that one reduces randomness whereas the other preserves it.</p>
<p>You might say that no security professional would be dumb enough to make this mistake&#8230;&#8230;my only retort would be&#8230;..I have no shortage of experience with security professionals making far more fundamental mistakes than this subtle arithmetic operator difference.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204632">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204632">
						September 24, 2013 10:19 PM					</a>

				</p>

				<p>@ RobertT,</p>
<p>At the risk of looking stupid, I am not convinced that adding two random numbers reduces randomness. Add with carry or otherwise. As far as I know, adding two random variables changes the distribution, but not the randomness per se. The addition of two uniform distribution, independent random variables results in a random variable with normal distribution. Perhaps you believe that a Gaussian PDF is less random than a uniform PDF?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204633">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204633">
						September 24, 2013 10:33 PM					</a>

				</p>

				<p>@ RobertT,</p>
<p>Hmm after Googling a bit, it seems that I forgot to mention the limit &#8211; the central limit theorem&#8230; Oh well. getting off topic now&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204634">

			<div class="comment by-soothsayer ">

				<p class="commentcredit">

					<span class="commenter">Soothsayer</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204634">
						September 24, 2013 11:19 PM					</a>

				</p>

				<p>I didn&#8217;t spend a lot of time on the paper &#8212; but it appears the technique works ONLY because the BIST on the intel implementation uses a 32 BIT PRBS .. probably NIST check is equally flawed.</p>
<p>Otherwise this paper makes absolutely no sense &#8212; you can force one gate to be stuck at a level and no test can detect it .. good luck to all the logic on this planet.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204635">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204635">
						September 25, 2013 12:22 AM					</a>

				</p>

				<p>@ Wael,</p>
<p>Whilst I remember (insomnia is a harsh mistres)? I think you were looking for a determanistic sequence that passed all the Diehard test witnesses. Also more stringent tests for determanistic tests such as the TestU01 [1] suite of Crush [2] tests,</p>
<p>Whell if you look at the work of Makoto Matsumoto you will find two examples,</p>
<p>1, The Mersenne Prime Twister<br />
2, WELL -Well Equidistributed Long-period Linear</p>
<p>It appears MT19937 passes Diehard and is used as an argument for the adoption of more stringent tests [3].</p>
<p>TestU01 has three sets of tests and other usefull code, it is written in C and runs on Linux. It is both more extensive and easier to use than Diehard (originaly from 1997). It is recognised that with it&#8217;s fixed sample size and sample. Format that even the Diehard tests are generaly not used to best advantage even in non cryptographic fields such as Econometrics. There are other collections of tests that are more effective [4] that have been made available in software for by others.</p>
<p>[1] <a href="http://www.iro.umontreal.ca/~simardr/testu01/tu01.html" rel="nofollow ugc">http://www.iro.umontreal.ca/~simardr/testu01/tu01.html</a></p>
<p>[2] <a href="http://www.iro.umontreal.ca/~simardr/testu01/guideshorttestu01.pdf" rel="nofollow ugc">http://www.iro.umontreal.ca/~simardr/testu01/guideshorttestu01.pdf</a></p>
<p>[3] <a href="http://www.iro.umontreal.ca/~lecuyer/myftp/papers/testu01.pdf" rel="nofollow ugc">http://www.iro.umontreal.ca/~lecuyer/myftp/papers/testu01.pdf</a></p>
<p>[4] See volume 2 of Donald Knuths Semi-numerical Algorithms second edition.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204636">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204636">
						September 25, 2013 12:56 AM					</a>

				</p>

				<p>@Wael,<br />
Re:  XOR Vs ADC (add with carry)<br />
I really dont have the math skills needed to formally answer this sort of issue, maybe Bruce or some other Math/Cyrpto experts can help.</p>
<p>I can however assure you that I have fallen victim to this exact sort of issue before. For me it is also counter-intuitive that a linear operator like ADC (Add with carry) can in ANY way reduce random-ness. But it is hard to argue with the facts when the leading digit (or four MSB&#8217;s ) depending on which way you want to view the problem can be predicted with 30% accuracy (rather than 1 in 10 or 1 in 15 as would hopefully be the case for Decimal or Hex RNG numbers)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204637">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204637">
						September 25, 2013 1:13 AM					</a>

				</p>

				<p>@ RobertT, Wael,</p>
<p>Talking of &#8220;Benford&#8217;s Law&#8221; not only have a use in forensics, it&#8217;s had a use in cryptography going back to the 1930&#8217;s.</p>
<p>Basicaly many people used &#8220;book codes&#8221; and would use common or busines related almanacs for the pad. The fact that they contained tables of numeric data that followed Benford&#8217;s law aided cryptanalysis.</p>
<p>As some people might know adding indipendent and uniformly distributed numbers togther changes the distribution from flat to succeessivly normal distribution, which is useful for doing many types of simulation. The general advice being add four to six random numbers together.</p>
<p>However there is an easy trap to fall into which if you by mistake do it modulo a number with common factors to the size of the uniformly distributed set you go back from a normal distribution to a uniform distribution.</p>
<p>You see this happen in C programs where people don&#8217;t understand the implicit case rules for converting unsigned ints from the RNG function to either signed or floats used in their program and the consiquences of adding two or more full range unsigned ints into another equaly sized unsigned int.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204638">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204638">
						September 25, 2013 1:47 AM					</a>

				</p>

				<p>@ RobertT</p>
<blockquote><p> But it is hard to argue with the facts when the leading digit (or four MSB&#8217;s ) depending on which way you want to view the problem can be predicted with 30% accuracy (rather than 1 in 10 or 1 in 15 as would hopefully be the case for Decimal or Hex RNG numbers) </p></blockquote>
<p> I believe you, you don&#8217;t need to assure me. Sometimes I refuse to let math answer some questions.</p>
<p>@ Clive Robinson,</p>
<p>Thanks for correcting me, the keyword is &#8220;successively&#8221;.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204639">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204639">
						September 25, 2013 2:01 AM					</a>

				</p>

				<p>@ Clive Robinson,</p>
<blockquote><p> Whilst I remember (insomnia is a harsh mistres)?&#8230; </p></blockquote>
<p>Insomnia is my sweetheart ðŸ˜‰ sometimes I stay up two nights in a row. My record was four. Thanks for the links, I&#8217;ll check them out. One thing that puzzles me is the links you, @ Nick P, and @ Dirk Praet find and share with us. And that is especially true for the link @ Dirk Praet posted:</p>
<blockquote><p><i>AFAIK there is no such law. What you are citing is <b>Opinion 820</b> from the New York State Bar Association Committee on Professional Ethics (NYSBA)</i></p></blockquote>
<p>That just&#8230; Kills me! How in the world did you get that @ Dirk Praet?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204640">

			<div class="comment by-name-withheld-for-obvious-reasons ">

				<p class="commentcredit">

					<span class="commenter">name.withheld.for.obvious.reasons</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204640">
						September 25, 2013 11:06 AM					</a>

				</p>

				<p>@figureitout</p>
<p>I&#8217;d be more specific about hardware, but, as Bruce&#8217;s generous support of this forum makes giving details problematic. As you are probably aware there are lible laws that have time to time cropped up and I would be doing a disservice to Bruce&#8211;as I am speaking about a commerical product using a pseudo anonymous ID (though the ip_addr leads &#8220;somewhere&#8221;).<br />
What I feel comfortable in saying is that the platform was not very robust (programmatically) but it is a good piece of hardware. AD&#8217;s analog components are well designed and their competence in the design and fab is of a high caliber. I am not trying to give AD any cover, it is the errant attack that could be launched against Bruce that gives me the most concern. I should probaly write a white paper for the IEEE describing the engineering process that produced a whole series of &#8220;Doh&#8221; moments. And, I did have one on my part, committig to a development strategy that I knew was risky and going against my better judgement&#8230;</p>
<p>@Nick P</p>
<p>Whilst I was consulting on a &#8220;project&#8221;, the work performed in tempest rated environment, the attenttion to detail that could cause anomolies in the development process. More than once I was witness to processes and procedures that were not treated in a manner that would even merit a ISO15408 qualification. On area I&#8217;ve had the chance to (for a six month trail period) oversea a QA program at a major systems manufacturer, one of our efforts was to achieve a Baldridge award. If you have spent any time with senior management, you know that driving development that can answer &#8220;all&#8221; the constraints of robust architectures and products. As a member of a committee I remember pleading the case for taking deliberate steps, not statements of desired outcomes, but committments to make the destination reachable. I&#8217;ve yet to see an org achieve this&#8211;Richard Feynman is the name used to refer to me, and I see that as a compliment.</p>
<p>A few monts ago I engaged you in a conversation about engineering security, we both made the same observations&#8230;and I can guess that is why Bruce&#8217;s thinking appeals to both of us. An honest assesment of what is possible can differ greatly from what is possible, in both the positive and negative terms.<br />
If we are serious, I&#8217;d draft a white paper that is both detailed in critism but is complete in its resolution/solution. One thing I&#8217;ve been successful with is always having a solution to present, after I describe what is so wrong with whatever project/product/system.</p>
<p>Didn&#8217;t proof this&#8211;have a business affair that requires my attention&#8230;excuse the misspellings&#8230;gotta go.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204641">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204641">
						September 26, 2013 12:41 PM					</a>

				</p>

				<p>This talk on PS3 hacking has a nice list of useful features to consider for tamper-resistant systems starting around 12:50 into video.</p>
<p><a href="https://www.youtube.com/watch?v=PR9tFXz4Quc" rel="nofollow ugc">https://www.youtube.com/watch?v=PR9tFXz4Quc</a></p>
<p>Earlier in the vid they also show how long each system lasted before being hacked and how it was hacked. Many smart, motivated people tried to hack these consoles. So, I think this gives you a useful measure of what protection period to expect from these types of features when the attackers aren&#8217;t thought to have a whole lab of equipment for chip hacking.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204642">

			<div class="comment by-random-commenter ">

				<p class="commentcredit">

					<span class="commenter">Random Commenter</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204642">
						October 3, 2013 2:21 AM					</a>

				</p>

				<p>@steve:</p>
<blockquote><p>
  At the absurd (technically infeasible) extreme, if Intel somehow managed to sneak a radio transmitter into a chip that reports every value it handles straight to the NSA, then your output will never be solid no matter what code you run.
</p></blockquote>
<p>It seems this is technically feasible:<br />
<a href="http://www.prisonplanet.com/secret-3g-intel-chip-gives-snoops-backdoor-pc-access.html" rel="nofollow ugc">http://www.prisonplanet.com/secret-3g-intel-chip-gives-snoops-backdoor-pc-access.html</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204643">

			<div class="comment by-j-thomas ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://www.jtxp.org' rel='external nofollow ugc' class='url'>J.Thomas</a></span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204643">
						October 4, 2013 10:32 AM					</a>

				</p>

				<p>Being impressed and inspired by this monster-thread, i&#8217;d definitely like to point some of you who are seeking open electronic trng concepts for an TRNG, to these URLs:<br />
<a href="http://www.jtxp.org/tech/xr232web.htm" rel="nofollow ugc">http://www.jtxp.org/tech/xr232web.htm</a> (sorry, only german)<br />
and<br />
<a href="http://www.jtxp.org/tech/xr232usb_en.htm" rel="nofollow ugc">http://www.jtxp.org/tech/xr232usb_en.htm</a><br />
Thanks in advance for sharing your knowledge/feedback/criticism!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204644">

			<div class="comment by-someone ">

				<p class="commentcredit">

					<span class="commenter">someone</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204644">
						October 7, 2013 12:55 AM					</a>

				</p>

				<p>&#8220;Efforts toward open-source BIOS have been hampered in part by the prevalence of proprietary hardware on PC-compatible mainboards.</p>
<p>Such boot firmware is an excellent locus for attack vectors, and (coming almost always from a very small number of vendors) readily subject to subversion by powerful agencies.&#8221;</p>
<p>I could see how something like coreboot could pretty much eliminate cold boot attacks. Say, if the computer starts up, it only will boot from say a USB stick with /boot (which you then hide/destroy), fishy UUIDs just make it wipe the DRAM.</p>
<p>I mean, if they have physical access you your hardware, that&#8217;s bad to begin with.</p>
<p>I think this was from another thread:</p>
<p>&#8220;&gt; The forensics magazine I occasionally get had an advertisement for an interesting device &#8211; basically a briefcase like UPS&#8230; allowing you to take a FDE enabled PC back to your office where you can do a cold boot attack at your leisure.</p>
<p>There are some fairly simple defenses against this kind of trick. One could, for instance, embed a GPS receiver into the machine. Better still, a 3-axis accelerometer. Any appreciable motion and the keys get zeroed and repeatedly bit-walked over.&#8221;</p>
<p>You could also get an internal battery, inside the chassis, have a daemon wipe any keys in the event of tampering. It all depends how much effort they will put in. There are a lot of attacks that could work in principle. This thread is about tampering with chips, and everyone has been talking about RNG. But I wonder (I don&#8217;t know this) how does AES-NI actually work? It seems like it could be that the chip could be made to store keys in SRAM, in some special area, that could be accessed later. I don&#8217;t know anything about that. That&#8217;s only a worry if they can access your hardware. Maybe epoxy the CPU to the motherboard so it breaks if removal is attempted? That would probably be unreliable.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204645">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204645">
						October 7, 2013 2:52 AM					</a>

				</p>

				<p>@ Someone,</p>
<p>If you have read this blog for some time you will know that I&#8217;ve investigated building computers into thermite lined safes which are built into &#8220;firebrick&#8221; supporting structures.</p>
<p>What I did not go into was the other aspects of physical security which is the sensors both electrical and mechanical that trigger the firing circuits of the thermite and other chemical based protection methods.</p>
<p>Whilst it would not be impossible to &#8220;bomb disposal&#8221; your way in the probability of doing so is very small, things like &#8220;explosive disruption&#8221; and &#8220;saline cutters&#8221; all have disadvantages that can be used against attempts to use them. After all they are designed to stop a bomb exploding not stop information being lost in the process of their use.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204646">

			<div class="comment by-semi-industry-eng ">

				<p class="commentcredit">

					<span class="commenter">Semi Industry Eng</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204646">
						October 17, 2013 5:04 PM					</a>

				</p>

				<p>I am a H/W engineer at a major Si company and would just like to point out that the idea of altering the masks in the layout stage is basically insane, for a variety of reasons.</p>
<p>First of all, the production masks are maintained in a versioned repo &#8211; all changes (and who made them) are tracked. The keys are held by specific individuals (gatekeepers). Of course, this in itself doesn&#8217;t prove that you couldn&#8217;t have a mole.</p>
<p>But, secondly, this mole would have to have an amazingly broad knowledge of computer technology &#8211; all the way from the RTL and circuit design, right down to the gate-level physics in the transistor. The hypothesized mole would have to a) have worked out what the circuit does and how it can be subverted (requires full access to the RTL, as well as to the standard cells), b) worked out where to attack the circuit in order to subvert it, c) know how to manually &#8220;hack&#8221; the mask set.</p>
<p>Masks today are at such small dimensions that they have to be mathematically deformed to counteract the refractory effects of light because the dimensions of the features being fabricated are beginning to approach the wavelengths of light being used to activate the photoresist (see <a href="http://videoprocessing.ucsd.edu/~stanleychan/research/Lithography.html" rel="nofollow ugc">http://videoprocessing.ucsd.edu/~stanleychan/research/Lithography.html</a> for example). There are dozens of masks applied in a specific sequence and exactly the right masks must be altered in exactly the right way to produce the desired &#8220;trojan&#8221;.</p>
<p>In short, the mask set isn&#8217;t something you can just manually &#8220;hack&#8221;. It is generated algorithmically from the RTL and must follow a large number of &#8220;design rule checks&#8221;, the violation of any of which is likely to result in bad parts. The hypothesized hacker/mole in this paper&#8217;s scenario would be, by construction, avoiding the automated tool-chain so he would have to manually work out the optical deformations of the mask required to get the correct doping pattern. He would also have to ensure he altered all and only the correct masks. And when he was done making his alterations, he would have to somehow check these into the versioned repository without detection. Finally, when the production masks are re-generated with each new spin of the parts through the fab facility (in early stages of the design, this could be occurring every few weeks), he would have to repeat this hacking of the masks.</p>
<p>Nothing is impossible but I would argue that this is a very low ROI attack vector, especially for any kind of cutting-edge silicon where you are dealing with a set of design-rules so large that no &#8220;manual&#8221; process could be implemented in reasonable time/cost to avoid going through the official tool-chain.</p>
<p>I will refrain from speculating here about other, more cost-effective hardware attacks.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204647">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204647">
						October 17, 2013 6:45 PM					</a>

				</p>

				<p>@Semi Industry Eng</p>
<p>First off lets be clear on a couple of points:<br />
1) No chip mask flow can be hacked by some outsider and certainly not some script-kiddy&#8230;.its an inside job<br />
2) The ideal person to do this is the team leader for a design critical and security critical block, it is also possible (even probable) that this individual does not understand the crytograpihic importance of the  minor changes they are making, they have simple been instructed / paid to get this information off chip somehow.</p>
<p>OK with that said&#8230;</p>
<p>I&#8217;ve never said that hacking a chip mask set would be easy, just that it is possible. I agree with most of what you are saying although specific aspects of the final chip flow vary from company to company, so accordingly so should the exact attack method vary to leverage the security weaknesses in the mask creation flow.</p>
<p>For most of my mask hacking cases I&#8217;ve assumed the hack happens at the actual mask creation stage, with some support for the final hack being inserted at the layout stage.</p>
<p>Let me give you an example:<br />
  Lets say the only information you want to get off chip is the state of the ALU Carry flag.  Nothing more just this single bit.</p>
<p>Now imagine the ALU hardware designer told the layout person that this signal is critical and should be hand routed first. From my experience it is common for critical signals to be hand routed and nobody would question the head of the ALU team. OK so what we have is a signal that is fixed in the design, Lets say this signal gets a shield layer so say an M2 routed signal has an M3 shield to minimize signal cross coupling and capacitive loading.  In reality this shield has no function EXCEPT to introduce some dedicated routing / signal coupling that will be utilized later.</p>
<p>OK so we have a design database that will pass all our LVS and formal verification flows. it is logically correct. Now lets connect the shield to say AGND (AVSS) and make that AVSS route ALSO go to an opamp input. This shared routing has just ONE via actually connecting it to AVSS, so by eliminating this Via we have a floating input to an opamp that conveniently routes right along side the ALU bit that we want to take off chip.</p>
<p>Now we are left with the problem: How to make that one via disappear.  Personally I&#8217;d make this happen at the OPC (optical proximity correction) stage, I&#8217;ve never seen a real closed loop flow implemented at this point, so whatever correction pattern the tool spits out goes on the masks no questions asked nobody even looks at it, (if you have ever had to dig through a Mebes database looking at hammerheads and trying to figure out how a real OPC error occurred you&#8217;ll know what I&#8217;m talking about). So we want an OPC change that opens the VIA, remember this via has no function in the normal sense that the chip functions exactly the same with or without the via, however without the via it leaks information on the state of the Carry flag and it leaks it into the Analog domain where all routing is normally hand done.</p>
<p>Since it has no function no test can ever discover that the Via is missing we just have &#8220;noise&#8221; on an analog output. The normal function of this Analog output might be to measure local onchip temperature so it will normally be time integrated, probably in the firmware.  Basically nobody knows it is noisy nor cares it is noisy EXCEPT the person that knows this noise is actually the ALU carry state.</p>
<p>The whole flow could be completed with only two or maybe three people needing to know, probably the most critical person is the guy at the mask shop that knows which VIA to messup the OPC on.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204648">

			<div class="comment by-john-langman ">

				<p class="commentcredit">

					<span class="commenter">John Langman</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204648">
						October 24, 2013 11:00 AM					</a>

				</p>

				<p>Surreptitiously Tampering with Computer Chips</p>
<p>Whilst the theory of tampering with chips is great for the theorists, reality is much harder, Most Microcircuits are not designed from the transistor level up-it just takes too long-.<br />
Whilst tampering with devices at the transistor level is possible many devices are simply designed to ignore stuck at zero or stuck at one scenarios, I feel the white paper mentioned is idealogically correct but not rooted in the real chip design world. The authors assume that a 100 million plus chip design is flawless, which is simply not true, chips are designed to be robust in functionality and to provide data sheet compliance not perfect design.</p>
<p>Major Microcircuits are designed using libraries of &#8216;Macros&#8217;. Therefore to &#8216;tamper&#8217; with a design requires tampering with the Macro, and its test vectors and its physical layout, because after a design is &#8216;assembled&#8217; it is simulated including physical layout, and this simulation must comply with the spec, so tampering means changing the simulation outcome as well. and the JTAG test pin placements and a whole host of things designed to assure that it is right first time. So if ALL of the above are tampered then it clearly and logically WILL pass internals start up self tests-but why wouldn&#8217;t it-. If any part of the tool chain is individually subverted then the device will likely fail simulation and self test. Again I feel the extreme and un detailed nature of this paper is foisting an untested and unrealistic scenario on users. The authors assume that self test checks the whole chip which it does not,</p>
<p>Similarly devices can have multiple vendors with self design (see ARM implementations) each vendors devices will therefore be unique in implementation whilst being data sheet functional compliant and interchangeable with other vendors ( see 8051 Micro controllers vendor lists-some 40 plus vendors and 40 plus implementations and processes-)</p>
<p>The Right First Time scenario is vitally important. Each mask step requires a UV and or Deep UV special mask ( possibly at veery fine geometries a phase Mask that only passes half wavelengths of UV) which are super expensive Like millions of dollars each and a major design (see core i7 intel at circa 1 Billion+ individual transistors) may require 12 or more masks all at the same price. In the scenario of tampering with the design a significant number of process steps have to be subverted and there will be a huge price to pay, and even Intel will balk ( read refuse) at mask change costs running into circa 25 to 100 million dollars to satisfy an NSA or any other subversion agency. These kind of costs show up in the financial accounts available to the public and investors. So whilst theory is great practice is much much more difficult. As for the detection requirement the user base finds this stuff out super quick,Intel and AMD have found their co-processor implementations subject to oops moments -see history of Maths co-processor implementations and the effects on Spreadsheets-</p>
<p>The user base is so large today and so diverse that the community of users numbering 100s of millions will for sure find the non compliance, and they will publish that the device does not meet the published specification. So modifying the Random Number Generator design ( carefully chosen item in the paper:- an rng and judgmental words &#8216;devastating&#8217; to raise maximum interest and worry ) is theoretically possible, however the authors ignore the huge user base that actually really needs a rng and then tests for it. I would argue that the statement that a dumbed down rng is undetectable is not true</p>
<p>Its is not difficult to plot a rng output on a schmoo diagram or to plot a test algorithm and see a devices capability, incapacity or inaccuracy, &#8216;cos the results will be bunched up in one place on the graph, a sure give away of non compliance as a rng. So no its is not difficult to detect tampering -even assuming anyone can get a chip company to comply with a government agency demand for changes! Just because Intel pushes one aspect does not make a subversion an actaulity. Untested assumptions are just that untested, have the authors done a real world rng check on an Intel, AMD, et al 386/486/686/Pentium/Core duo/i Core device to support their case with real world test plots and comparisons?</p>
<p>And yes the Open Source world will take a negative view of requests from any &#8216;outside&#8217; source and I hope they continue to do so, we need the capability and robustness of their attitude for our competitive landscape but reflective comments justifying a previous action are intellectually dishonest, just say Intel pissed you off with the attitude in the email/phone call or whatever I am happy with that.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204649">

			<div class="comment by-john-langman ">

				<p class="commentcredit">

					<span class="commenter">John Langman</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204649">
						October 24, 2013 6:27 PM					</a>

				</p>

				<p>Reverse Engineering or Design Analysis sometimes notated &#8216;Tear Down&#8217; of microcircuits is not new and has been an activity pursued across the chip world for 30 years or more. Reverse Engineering can extract circuitry; although an en-mass RE of an Intel i7 core would be economically dubious, partials are quite common. Why? well patent infringement is the usual quoted reason but also just to identify and copy specific functionality.  Material use, and Dopant levels can be measured at the device level especially as most of the processes are published documents so its not necessary to identify all the materials. Papers research, allied with FIB, EM. SEM, et al in microscopy can RE a device only depending how much time and money you have to thro&#8217; at the device</p>
<p>Note that the RNG quoted in the Theoretical Tampering is not a RNG but a pseudo random number generator. There are multiple research papers from across the world on the behavior and implementation of PRNG, none of them particularly flattering to the efficacy of the &#8216;random&#8217; output. One author pointing out that PRNGs have a certain level of  determinism&#8230;&#8230;. and that the output is a function of the seed.</p>
<p>If you want a genuine RNG prepare to work hard, and check well, implementation is non trivial, will be classified as armaments and require end user certificates prior to shipping, and all before acceptance of an output.</p>
<p>Built in Self Test test vectors whether implemented or not, or vectored into JTAG are not proof of subversion that is just paranoia, RNG and PRNG are non trivial to accurately test at the output, however if the design topology can be tested for design compliance including stuck at zero or stuck at one the logic will appear to be non functioning, and whether it is a transistor or a logic gate, the resultant will be non functioning logic as far as the JTAG/BIST or Chip Probe test is concerned and the device will be in the reject bin. If the JTAG/BIST or probe test passes the test vector it is reasonable to assume correct functionality, if the supposed tampering has taken place then a whole mess of stuff has too have been changed -that way madness lies</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204650">

			<div class="comment by-robertt ">

				<p class="commentcredit">

					<span class="commenter">RobertT</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204650">
						October 24, 2013 10:02 PM					</a>

				</p>

				<p>@ John Langman</p>
<p>Sensible comments.</p>
<p>Not sure if the Intel dig was aimed at me, for the record I&#8217;ve never worked for Intel or any of their affiliates. I&#8217;ve worked on one product that was designed / fabed exclusively for Intel,  both parties were very happy with the project, so there&#8217;s no bad blood there at all. From memory the only slightly derogatory comment that I&#8217;ve ever made about Intel wrt chip design was that they are generally not very skilled at analog or RF IC design&#8230;I think my position is well supported by their lack of success with past efforts in the Analog/RF space, my opinion is based mainly on private discussions with other Analog IC designers.</p>
<p>Wrt TRNG&#8217;s are you sure embedded TRNG&#8217;s are considered Armaments, I know I&#8217;ve put simple TRNG circuits on everything from RFID tags to Cell phone chip sets but I&#8217;ve never heard of a requirement for registration or export licenses.  btw very simple TRNG circuits can give very good quality output results (even the cheapest RFID tag TRNG passed all Die-Hard tests)</p>
<p>WRT Jtag / Bist for RNG&#8217;s, there is a catch22 that ideally the core TRNG circuit should have as little external controllability as possible. This is done so that the start-up / load state cannot  be influenced even if the TEST / JTAG mode is somehow operationally selected.  direct Observability of the TRNG output can also be potentially problematic, especially if the real secret sauce is in the algorithmic &#8220;entropy&#8221; stage.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204651">

			<div class="comment by-johnlangmanconsultant-com ">

				<p class="commentcredit">

					<span class="commenter">johnlangman@consultant.com</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204651">
						October 27, 2013 3:39 PM					</a>

				</p>

				<p>Any true rng is listed as armaments and will be subject to export controls, in the uk I purchased ATT rngs and had to supply end user cetificates and comply with export regulations. If your system provides pseudo rng then it will not be a controlled device. However there is a large body of work showing that prng are deterministic and that output &#8216;is&#8217; a function of the seed. Note that the seed source itself is not without determinism. That is not to belittle prngs just saying that the &#8216;theoretical&#8217; paper choose rng as a deliberatly provacative implementation and I challenge some of their assumptions. With 40 years in microelectronics and some 10 in RE I would like more robustness,, less paranoia,, and more clarity.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-204652">

			<div class="comment by-whiskers-in-menlo ">

				<p class="commentcredit">

					<span class="commenter">Whiskers in Menlo</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204652">
						November 16, 2013 11:03 PM					</a>

				</p>

				<p>Bruce said it &#8212; the issue is a lack of trust.</p>
<p>If you do not trust some hardware or software function<br />
the obvious solution is to replace the parts you do<br />
not trust.</p>
<p>Today I would look hard at external USB hardware&#8230;<br />
Consider password safe living on a USB stick but<br />
a smart device.   Invest $50 in a Beaglebone black to<br />
see what I mean.   Memory, CPU, ability to load any<br />
OS you select, ability to load any SW you care to load.<br />
Disconnect it or set it to replace /dev/random.   In a<br />
year or so there will be USB3 devices although network<br />
devices may still be quicker.</p>
<p>In defense of Intel, a number of benchmark programs depend<br />
on random numbers and their (Intel) hardware is going to be faster<br />
than a quality software solution.  Winning benchmarks is the<br />
job of a lot of folk and in a random selection of Intel folk will find<br />
someone that will make this type of statement.</p>
<p>For those that have serious needs for unique impossible to guess<br />
random numbers they should promptly find multiple options unique<br />
to their site.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-204653">

			<div class="comment by-raphidae ">

				<p class="commentcredit">

					<span class="commenter">raphidae</span> â€¢

					<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/#comment-204653">
						September 1, 2015 9:37 PM					</a>

				</p>

				<p>Link&#8217;s dead. Can find source here: <a href="https://janhkrueger.de/gitpup/RSSArtikel/raw/master/BeckerChes13.pdf" rel="nofollow ugc">https://janhkrueger.de/gitpup/RSSArtikel/raw/master/BeckerChes13.pdf</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

	<p class="subscribe-comments">
		<a href="https://www.schneier.com/blog/archives/2013/09/surreptitiously.html/feed/">
			<img alt="Atom Feed" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/rss.png">
			Subscribe to comments on this entry		</a>
	</p>

		<div id="respond" class="comment-respond">
		<h2 class="comments-open-header">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/archives/2013/09/surreptitiously.html#respond" style="display:none;">Cancel reply</a></small></h2><form action="https://www.schneier.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><a href="https://www.schneier.com/wp-login.php?redirect_to=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2013%2F09%2Fsurreptitiously.html" title="Login">Login</a><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">URL:</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Remember personal info?</label></p>

<p class="comment-form-author">

	<label for="comm_capt_challenge">
		Fill in the blank: the name of this blog is Schneier on ___________ (required):	</label>

	<input id="comm_capt_challenge" name="comm_capt_challenge" size="30" type="text" />
</p>

<div class="comment-form-comment">

	<label for="comment">Comments:</label>

	<textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea>

	<div id="preview-box" class="preview-box hide"></div>
	<img class="comment-loading hide" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/loader.gif" />

</div>

<p id="allowed">

	<strong>Allowed HTML</strong>
	&lt;a href=&quot;URL&quot;&gt; &bull; &lt;em&gt; &lt;cite&gt; &lt;i&gt; &bull; &lt;strong&gt; &lt;b&gt; &bull; &lt;sub&gt; &lt;sup&gt; &bull; &lt;ul&gt; &lt;ol&gt; &lt;li&gt; &bull; &lt;blockquote&gt; &lt;pre&gt;
	<strong>Markdown Extra</strong> syntax via <a href="https://michelf.ca/projects/php-markdown/extra/">https://michelf.ca/projects/php-markdown/extra/</a>
</p>

<input type="hidden" id="wp_comment_nonce" name="wp_comment_nonce" value="4b1534b792" /><input type="hidden" name="_wp_http_referer" value="/blog/archives/2013/09/surreptitiously.html" />
<input type="button" id="comment-preview" class="comment-preview comment-actions" value="Preview" />
<input type="button" id="comment-write" class="comment-write comment-actions hide" value="Edit" />

<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit" /> <input type='hidden' name='comment_post_ID' value='5012' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	<div class="stepthrough">
		<a href="https://www.schneier.com/blog/archives/2013/09/tom_tomorrow_fr.html" rel="prev">â† Tom Tomorrow from 1994</a>		<a href="https://www.schneier.com/blog/archives/2013/09/the_limitations.html" rel="next">The Limitations of Intelligence â†’</a>	</div>

	
<p id="powered">Sidebar photo of Bruce Schneier by Joe MacInnis.</p>
		</div>

		
<aside>
	<div class="sidebar" id="sidebar-two">
		<section><div class="sidesection widget widget_schneier_about" id="schneier_about-2"><h3>About Bruce Schneier</h3><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/Bruce-Schneier.jpg" /><p><p class="small">I am a <a href="https://public-interest-tech.com/">public-interest technologist</a>, working at the intersection of security, technology, and people. I've been writing about security issues on my <a href="/">blog</a> since 2004, and in my monthly <a href="/crypto-gram/">newsletter</a> since 1998. I'm a fellow and lecturer at Harvard's <a href="https://www.hks.harvard.edu/faculty/bruce-schneier">Kennedy School</a>, a board member of <a href="https://www.eff.org/">EFF</a>, and the Chief of Security Architecture at <a href="https://inrupt.com/">Inrupt, Inc.</a> This personal website expresses the opinions of none of those organizations.</p>
</p></div></section><section><div class="sidesection widget widget_schneier_related_posts" id="schneier_related_posts-2"><h3>Related Entries</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/archives/2021/03/illegal-content-and-the-blockchain.html">Illegal Content and the Blockchain</a></li><li><a href="https://www.schneier.com/blog/archives/2021/03/national-security-risks-of-late-stage-capitalism.html">National Security Risks of Late-Stage Capitalism</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/weis-2021-call-for-papers.html">WEIS 2021 Call for Papers</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/ransomware-profitability.html">Ransomware Profitability</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/presidential-cybersecurity-and-pelotons.html">Presidential Cybersecurity and Pelotons</a></li><li><a href="https://www.schneier.com/blog/archives/2021/01/police-have-disrupted-the-emotet-botnet.html">Police Have Disrupted the Emotet Botnet</a></li>
</ul>
</div></section><section><div class="sidesection widget widget_schneier_featured_essays" id="schneier_featured_essays-2"><h3>Featured Essays</h3>
	<ul>
		<li><a href="https://www.schneier.com/essays/archives/2016/04/the_value_of_encrypt.html">The Value of Encryption</a></li><li><a href="https://www.schneier.com/essays/archives/2016/03/data_is_a_toxic_asse.html">Data Is a Toxic Asset, So Why Not Throw It Out?</a></li><li><a href="https://www.schneier.com/essays/archives/2014/01/how_the_nsa_threaten.html">How the NSA Threatens National Security</a></li><li><a href="https://www.schneier.com/essays/archives/2009/01/terrorists_may_use_g.html">Terrorists May Use Google Earth, But Fear Is No Reason to Ban It</a></li><li><a href="https://www.schneier.com/essays/archives/2007/01/in_praise_of_securit.html">In Praise of Security Theater</a></li><li><a href="https://www.schneier.com/essays/archives/2006/08/refuse_to_be_terrori.html">Refuse to be Terrorized</a></li><li><a href="https://www.schneier.com/essays/archives/2006/05/the_eternal_value_of.html">The Eternal Value of Privacy</a></li><li><a href="https://www.schneier.com/essays/archives/2005/09/terrorists_dont_do_m.html">Terrorists Don&#039;t Do Movie Plots</a></li>	</ul>

	<p><a href="https://www.schneier.com/essays/">More Essays</a></p></div></section><section><div class="sidesection widget widget_schneier_archives" id="schneier_archives-2"><h3>Blog Archives</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/calendar.html/">Archive by Month</a></li><li><a href="https://www.schneier.com/blog/newcomments.html/">100 Latest Comments</a></li></ul>

<h4>Blog Tags</h4><ul class="top-tags"><li><a href="https://www.schneier.com/tag/3d-printers/">3d printers</a></li><li><a href="https://www.schneier.com/tag/9-11/">9/11</a></li><li><a href="https://www.schneier.com/tag/aaron-swartz/">Aaron Swartz</a></li><li><a href="https://www.schneier.com/tag/academic/">academic</a></li><li><a href="https://www.schneier.com/tag/academic-papers/">academic papers</a></li><li><a href="https://www.schneier.com/tag/accountability/">accountability</a></li><li><a href="https://www.schneier.com/tag/aclu/">ACLU</a></li><li><a href="https://www.schneier.com/tag/activism/">activism</a></li><li><a href="https://www.schneier.com/tag/adobe/">Adobe</a></li><li><a href="https://www.schneier.com/tag/advanced-persistent-threats/">advanced persistent threats</a></li><li><a href="https://www.schneier.com/tag/adware/">adware</a></li><li><a href="https://www.schneier.com/tag/aes/">AES</a></li><li><a href="https://www.schneier.com/tag/afghanistan/">Afghanistan</a></li><li><a href="https://www.schneier.com/tag/air-marshals/">air marshals</a></li><li><a href="https://www.schneier.com/tag/air-travel/">air travel</a></li><li><a href="https://www.schneier.com/tag/airgaps/">airgaps</a></li><li><a href="https://www.schneier.com/tag/al-qaeda/">al Qaeda</a></li><li><a href="https://www.schneier.com/tag/alarms/">alarms</a></li><li><a href="https://www.schneier.com/tag/algorithms/">algorithms</a></li><li><a href="https://www.schneier.com/tag/alibis/">alibis</a></li><li><a href="https://www.schneier.com/tag/amazon/">Amazon</a></li><li><a href="https://www.schneier.com/tag/android/">Android</a></li><li><a href="https://www.schneier.com/tag/anonymity/">anonymity</a></li><li><a href="https://www.schneier.com/tag/anonymous/">Anonymous</a></li><li><a href="https://www.schneier.com/tag/antivirus/">antivirus</a></li><li><a href="https://www.schneier.com/tag/apache/">Apache</a></li><li><a href="https://www.schneier.com/tag/apple/">Apple</a></li><li><a href="https://www.schneier.com/tag/applied-cryptography/">Applied Cryptography</a></li><li><a href="https://www.schneier.com/tag/artificial-intelligence/">artificial intelligence</a></li><li><a href="https://www.schneier.com/tag/assassinations/">assassinations</a></li></ul><p><a href="https://www.schneier.com/blog/tags.html/">More Tags</a></p></div></section><section><div class="sidesection widget widget_schneier_latest_book" id="schneier_latest_book-3"><h3>Latest Book</h3><a href="https://www.schneier.com/books/click-here/"><img class="sidepic" alt="Click Here to Kill Everybody" src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2018/07/book-ch2-200w.png" /></a><p><a href="https://www.schneier.com/books/">More Books</a></p></div></section><section><div class="sidesection widget widget_schneier_promotion" id="schneier_promotion-2">
<a href="https://www.eff.org/issues/bloggers/legal/join">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/join-eff@2x.png" id="effbutton" alt="Support Bloggers' Rights!" title="Support Bloggers' Rights!" /></a>

<a href="https://npo.networkforgood.org/Donate/Donate.aspx?npoSubscriptionId=8252">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/support-epic@2x.png" alt="Defend Privacy--Support Epic" title="Defend Privacy--Support Epic" /></a>
</div></section>	</div>
</aside>

		<footer>
			<nav>
				<div class="nav" id="footer-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="menu"><li class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>
		</footer>

		</div><!--#main-->
	</div><!--#wrapper-->

		<script type="text/javascript">
		(function () {
			var c = document.body.className;
			c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
			document.body.className = c;
		})();
	</script>
	<script type='text/javascript' src='https://c0.wp.com/p/woocommerce/5.1.0/assets/js/jquery-cookie/jquery.cookie.min.js' id='jquery-cookie-js'></script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/socialshareprivacy.js?ver=1.0.1' id='social-share-privacy-js'></script>
<script type='text/javascript' id='social-share-privacy-icons-js-extra'>
/* <![CDATA[ */
var schneierSocial = {"path":"https:\/\/www.schneier.com\/wp-content\/themes\/schneier\/assets\/vendor\/socialshareprivacy\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/icons.js?ver=1.0.0' id='social-share-privacy-icons-js'></script>
<script type='text/javascript' id='schneier-comment-js-extra'>
/* <![CDATA[ */
var schneierComment = {"translateErrorSecurityAnswerWrong":"Your response to the challenge question ('The name of this blog is Schneier on ____') was not correct. Please try again.","ajax_url":"https:\/\/www.schneier.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/js/comment.js?ver=1.0.1' id='schneier-comment-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>

</body>

</html>
