<!DOCTYPE html>
<html lang="en-US">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>Duqu 2.0 - Schneier on Security</title>
	<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Feed" href="https://www.schneier.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Comments Feed" href="https://www.schneier.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Schneier on Security &raquo; Duqu 2.0 Comments Feed" href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/feed/" />
<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<style id='woocommerce-inline-inline-css' type='text/css'>
.woocommerce form .form-row .required { visibility: visible; }
</style>
<link rel='stylesheet' id='schneier-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/style.css?ver=1.0.0' type='text/css' media='all' />
<link rel='stylesheet' id='schneier-main-css'  href='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/dist/css/style.css?ver=1.0.2' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.5.2/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js?ver=3.5.1' id='jquery-js'></script>
<link rel="https://api.w.org/" href="https://www.schneier.com/wp-json/" /><link rel="alternate" type="application/json" href="https://www.schneier.com/wp-json/wp/v2/posts/7095" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.schneier.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.schneier.com/wp-includes/wlwmanifest.xml" /> 

<link rel="canonical" href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html" />
<link rel='shortlink' href='https://www.schneier.com/?p=7095' />
<link rel="alternate" type="application/json+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2015%2F06%2Fduqu_20.html" />
<link rel="alternate" type="text/xml+oembed" href="https://www.schneier.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2015%2F06%2Fduqu_20.html&#038;format=xml" />
	<noscript><style>.woocommerce-product-gallery{ opacity: 1 !important; }</style></noscript>
	<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-32x32.png" sizes="32x32" />
<link rel="icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-180x180.png" />
<meta name="msapplication-TileImage" content="https://149400697.v2.pressablecdn.com/wp-content/uploads/2020/06/cropped-favicon-1-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			#schneier_promotion-2 img {
    max-width: 180px;
}		</style>
		</head>

<body class="post-template-default single single-post postid-7095 single-format-standard theme-schneier woocommerce-no-js">

	<div id="wrapper">
		<div id="main">

			<header>
				<div id="header">
					<h1>
						<a href="https://www.schneier.com/" rel="home">
							Schneier on Security						</a>
					</h1>
				</div>
			</header>

			<nav>
				<div class="nav" id="header-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu" class="menu"><li id="menu-item-50175" class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li id="menu-item-50916" class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li id="menu-item-50166" class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li id="menu-item-50169" class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li id="menu-item-50170" class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li id="menu-item-50171" class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li id="menu-item-50167" class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li id="menu-item-50174" class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>

			
<aside>
	<div class="sidebar" id="sidebar-one">
		<section><div class="sidesection widget widget_schneier_search" id="schneier_search-3"><h3>Search</h3>
<p class="small">
	<em>Powered by <a href="https://duckduckgo.com/">DuckDuckGo</a></em></p>

<form method="get" action="https://duckduckgo.com/">

	<input type="hidden" name="kh" value="1" /><!-- use https -->

	<input id="search" name="q" size="15" maxlength="255" />

	<input type="submit" value="Go" /><br>

	<input type="radio" name="sites" id="searchblog" value="www.schneier.com/blog" />
	<label for="searchblog">Blog</label>

	<input type="radio" name="sites" id="searchessays" value="www.schneier.com/essays" />
	<label for="searchessays">Essays</label>

	<input type="radio" name="sites" id="searchall" value="www.schneier.com" checked="" />
	<label for="searchall">Whole site</label>

</form>
</div></section><section><div class="sidesection widget widget_schneier_social" id="schneier_social-2"><h3>Subscribe</h3>
<div id="subscription-buttons">

	<a href="https://www.schneier.com/feed/atom"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/rss-32px.png" alt="Atom Feed" /></a><a href="https://www.facebook.com/bruce.schneier"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/facebook-32px.png" alt="Facebook" /></a><a href="https://twitter.com/schneierblog/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/twitter-32px.png" alt="Twitter" /></a><a href="https://www.amazon.com/Schneier-on-Security/dp/B0053HDDWW/"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/kindle-32px.png" alt="Kindle" /></a><a href="https://www.schneier.com/crypto-gram"><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/email-32px.png" alt="E-Mail Newsletter (Crypto-Gram)" /></a>
</div>
</div></section>	</div>
</aside>

			<div id="content">

				
		<p id="breadcrumbs">

			<a href="https://www.schneier.com">Home</a><a href="https://www.schneier.com/blog/archives/">Blog</a>		</p>

		
<article id="post-7095" class="post-7095 post type-post status-publish format-standard hentry category-uncategorized tag-hacking tag-hotels tag-iran tag-kaspersky tag-malware tag-network-security tag-nuclear-power tag-phones">

	<div class="article">

		<h2 class="entry">Duqu 2.0</h2>
		<p>Kaspersky Labs has <a href="https://securelist.com/blog/research/70504/the-mystery-of-duqu-2-0-a-sophisticated-cyberespionage-actor-returns/">discovered</a> and <a href="https://securelist.com/files/2015/06/The_Mystery_of_Duqu_2_0_a_sophisticated_cyberespionage_actor_returns.pdf">publicized details of</a> a new nation-state surveillance malware system, called Duqu 2.0. It&#8217;s being attributed to Israel.</p>
<p>There&#8217;s a lot of details, and I recommend reading them. There was probably a Kerberos zero-day vulnerability involved, allowing the attackers to send updates to Kaspersky&#8217;s clients. There&#8217;s code specifically targeting anti-virus software, both Kaspersky and others. The system includes anti-sniffer defense, and packet-injection code. It&#8217;s designed to reside in RAM so that it better avoids detection. This is all very sophisticated.</p>
<p>Eugene Kaspersky wrote an <a href="http://www.forbes.com/sites/eugenekaspersky/2015/06/10/why-hacking-us-was-a-silly-thing-to-do/">op-ed</a> condemning the attack &#8212; and making his company look good &#8212; and almost, but not quite, comparing attacking his company to attacking the Red Cross:</p>
<blockquote><p>Historically companies like mine have always played an important role in the development of IT. When the number of Internet users exploded, cybercrime skyrocketed and became a serious threat to the security of billions of Internet users and connected devices. Law enforcement agencies were not prepared for the advent of the digital era, and private security companies were alone in providing protection against cybercrime ¬≠ both to individuals and to businesses. The security community has been something like a group of doctors for the Internet; we even share some vocabulary with the medical profession: we talk about &#8216;viruses&#8217;, &#8216;disinfection&#8217;, etc. And obviously we&#8217;re helping <a href="http://www.forbes.com/sites/eugenekaspersky/2015/05/07/five-ways-it-security-companies-help-cyberpolice/">law enforcement</a> develop its skills to fight cybercrime more effectively.</p></blockquote>
<p>One thing that struck me from a very good <a href="http://www.wired.com/2015/06/kaspersky-finds-new-nation-state-attack-network/">Wired article</a> on Duqu 2.0:</p>
<blockquote><p>Raiu says each of the infections began within three weeks before the P5+1 meetings occurred at that particular location. &#8220;It cannot be coincidental,&#8221; he says. &#8220;Obviously the intention was to spy on these meetings.&#8221;</p>
<p>Initially Kaspersky was unsure all of these infections were related, because one of the victims appeared not to be part of the nuclear negotiations. But three weeks after discovering the infection, Raiu says, news outlets began reporting that negotiations were already taking place at the site. &#8220;Somehow the attackers knew in advance that this was one of the [negotiation] locations,&#8221; Raiu says.</p>
<p>Exactly how the attackers spied on the negotiations is unclear, but the malware contained modules for sniffing WiFi networks and hijacking email communications. But Raiu believes the attackers were more sophisticated than this. &#8220;I don&#8217;t think their style is to infect people connecting to the WiFi. I think they were after some kind of room surveillance &#8212; to hijack the audio through the teleconference or hotel phone systems.&#8221;</p></blockquote>
<p>Those meetings are talks about Iran&#8217;s nuclear program, which we <a href="http://www.wsj.com/articles/israel-spied-on-iran-talks-1427164201">previously believed</a> Israel spied on. Look at the details of the attack, though: hack the hotel&#8217;s Internet, get into the phone system, and turn the hotel phones into room bugs. Very clever.</p>

		
			<p class="entry-tags">
				<span class="tags-links">Tags: <a href="https://www.schneier.com/tag/hacking/" rel="tag">hacking</a>, <a href="https://www.schneier.com/tag/hotels/" rel="tag">hotels</a>, <a href="https://www.schneier.com/tag/iran/" rel="tag">Iran</a>, <a href="https://www.schneier.com/tag/kaspersky/" rel="tag">Kaspersky</a>, <a href="https://www.schneier.com/tag/malware/" rel="tag">malware</a>, <a href="https://www.schneier.com/tag/network-security/" rel="tag">network security</a>, <a href="https://www.schneier.com/tag/nuclear-power/" rel="tag">nuclear power</a>, <a href="https://www.schneier.com/tag/phones/" rel="tag">phones</a></span>			</p>

		
		
		<p class="posted">
			<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html" rel="bookmark">Posted on June 12, 2015 at 6:18 AM</a>			‚Ä¢
			<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html#comments">59 Comments</a>		</p>

		<aside><div class="schneier-share share" data-uri="https://www.schneier.com/blog/archives/2015/06/duqu_20.html" data-title="Duqu 2.0" data-order="facebook twitter tumblr" data-social-share-privacy="true" /></aside>
	</div>

</article>


	<h3 id="comments">Comments</h3>

	
		<article class="comment even thread-even depth-1" id="comment-250999">

			<div class="comment by-mathew-smith ">

				<p class="commentcredit">

					<span class="commenter">Mathew Smith</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-250999">
						June 12, 2015 6:40 AM					</a>

				</p>

				<p>In the Citizen4 movie documentary, there is a moment where Snowden implies that the voIP phones in the hotel room could be hacked. He said it was a routine tactic.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251000">

			<div class="comment by-alanm ">

				<p class="commentcredit">

					<span class="commenter">alanm</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251000">
						June 12, 2015 7:09 AM					</a>

				</p>

				<p>I&#8217;m surprised it took this long for someone to attack one of the anti-virus vendors.</p>
<p>Like Kaspersky says in his article: there&#8217;s only two types of companies, those who&#8217;ve been hacked and those who don&#8217;t know they&#8217;ve been hacked.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251001">

			<div class="comment by-winter ">

				<p class="commentcredit">

					<span class="commenter">Winter</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251001">
						June 12, 2015 8:05 AM					</a>

				</p>

				<p>This is the result from the Intelligence Community going all out into offensive capacity and nothing on defenses.</p>
<p>They all want to build vulnerabilities and backdoors into the infrastructure so they can spy. Meanwhile, their home base is pilfered.</p>
<p>What use are the offensive cyber-war capabilities of the NSA, CIA, and FBI when they cannot protect their own turf against spies?</p>
<p>The same for Germany, where all these surveillance capabilities of their own secret service cannot even protect their own parliament against being rooted.<br />
<a href="http://www.theregister.co.uk/2015/06/12/bundestag_malware_outbreak_confusion/" rel="nofollow ugc">http://www.theregister.co.uk/2015/06/12/bundestag_malware_outbreak_confusion/</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251002">

			<div class="comment by-anura ">

				<p class="commentcredit">

					<span class="commenter">Anura</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251002">
						June 12, 2015 8:06 AM					</a>

				</p>

				<p>@alanm</p>
<p>What makes you think this is a first time antivirus vendors have been exploited? There have been plenty of exploits in the past; a buffer overflow when scanning a file or updating software, and an otherwise harmless file downloaded by a user can cause arbitrary code to execute under the SYSTEM account. Complex software interacting with everything on the system and running with root/admin permissions is almost guaranteed to result in serious exploits.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251003">

			<div class="comment by-rgaff ">

				<p class="commentcredit">

					<span class="commenter">rgaff</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251003">
						June 12, 2015 9:37 AM					</a>

				</p>

				<p>Anura is right.  This is certainly NOT the first time an antivirus vendor has been hacked&#8230;  It&#8217;s just the first one that I can remember who announced the fact to the world.  Most companies including antivirus vendors prefer to just keep quiet about such things, fearing that publicity of their failings will adversely affect their bottom line.</p>
<p>I am surprised and impressed by Kapersky for instead making it a public teachable moment&#8230;  It seems that the main factor in delaying so long before announcing is they were responsibly giving some time for all those 0-days to be fixed first&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251004">

			<div class="comment by-heartbleed ">

				<p class="commentcredit">

					<span class="commenter">Heartbleed</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251004">
						June 12, 2015 9:57 AM					</a>

				</p>

				<p>Kaspersky malware vector: all Windows exploits.<br />
OMB malware vector: (apparently) all Windows exploits.<br />
Mandiant malware vector: all Windows exploits.<br />
RSA malware vector: all Windows exploits.<br />
Online banking malware vector: all Windows exploits (Krebs).<br />
Google in China malware vector: all Windows exploits.<br />
‚Ä¶</p>
<p>Is Windows a hugely successful target because of its relative market share, or because of its Byzantine architecture that is difficult to secure? Who cares!!</p>
<p>Why would anyone continue to expose themselves with this ridiculously insecure OS?!</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251005">

			<div class="comment by-naked-emperor ">

				<p class="commentcredit">

					<span class="commenter">Naked Emperor</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251005">
						June 12, 2015 10:12 AM					</a>

				</p>

				<p>What heartbleed says just above:  WTF, people- you keep showering in Windows gasoline, expect immolation.   It&#8217;s like the worst slapstick vaudeville schtick, all these butthurt Windows slaves.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251006">

			<div class="comment by-roger-dodger ">

				<p class="commentcredit">

					<span class="commenter">Roger Dodger</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251006">
						June 12, 2015 10:27 AM					</a>

				</p>

				<p>@Anura</p>
<p>Well said.</p>
<p>That does apply to their own networks. And they have been hacked before. Actually, even the pursuit of performing malware analysis on a mass scale is guaranteed to get some screw ups. But, I mean targeted, APT style attacks.</p>
<p>@Winter</p>
<p>Yes, the OPM hack appears to be one of the biggest clusterfucks I have seen in quite sometime. And I see a new clusterfuck everyday.</p>
<p><a href="http://www.wired.com/2015/06/opm-breach-security-privacy-debacle/" rel="nofollow ugc">http://www.wired.com/2015/06/opm-breach-security-privacy-debacle/</a></p>
<p>Probably more like &#8220;they got everyone&#8221;, then &#8220;four million&#8221;. And if they cross check that data with live records (death, marriage, credit, etc), they would hit the motherlode vein for undercovers. Which I mention because they surely would. This goes back to the 80s, one report said.</p>
<p>@Bruce, @all</p>
<p>&#8216;Level of sophistication&#8217;. Kaspersky plays up the &#8220;high level of sophistication&#8221; in these medias and reports strongly. They do this as part of sales presentation both to themselves and the audience. The reason is attributing nation state level attacks is extremely vague work. &#8220;Level of sophistication&#8221; is a major weight there.</p>
<p>There are really four criteria for nation state level attacks to deduce attribution:</p>
<ol>
<li>Level of sophistication</li>
<li>Target analysis &#8212; &#8220;who&#8221; was hacked</li>
<li>Where the scene of the crime took place. Where does the data eventually end up. Where are the proxies. Where did the attack come from.</li>
<li>Signature identifiers in code, including CNC.</li>
</ol>
<p>All of these can and have been faked or otherwise obscured. In fact, no one can really say for sure who is government and who is not.</p>
<p>There are a variety of factors in all of these weights. For instance, &#8220;3&#8221; might include data on something like &#8220;working hours&#8221;.</p>
<p>&#8220;4&#8221; can include snippets of code similar to snippets of code found in previous attacks. Here, the code is attributed to a large family of seemingly US based code.</p>
<p>Flaws, therefore, are not much looked at. There are some severe flaws. This was a highly risky operation.</p>
<ol>
<li>They reused code, probably, from previously used operations.</li>
<li>They used the same attack code against Kaspersky as they did against global operations of high value targets. </li>
<li>Many of those operations, especially the Kaspersky operation, would have been far safer to perform up close and personal. Sneakier, more cautiously. Hack the hardware going in. Get someone in there that works for you. Get someone there to work for you. Or hack it, but hack it closer up, where you are not digging around in the dark. Segment the hacks, if necessary. Figure out the scope of the network. Hit home systems, friends of friends systems. Work your way from the outside of the circle in. Kaspersky was a very hard target and should have had a much more longer term, safer approach.</li>
<li>The signature identifiers in the code track back to certain nation states.</li>
<li>CNC systems are a very poor way to deliver information out. For a nation state.</li>
<li>&#8220;ugly.gorilla&#8221; name was used for CNC communication, the report cited. &#8220;Ugly Gorilla&#8221; is a leader of a primary Chinese government hacking group, according to Mandiant. No other efforts were made to paint this as Chinese. So, that says &#8220;American all over it&#8221;. A bit too clearly. Even if &#8220;hidden&#8221;. They made no other pains, even sloppily reusing code. Probably an emotion laden &#8220;fuck you&#8221;. Though, saying &#8220;fuck you China&#8221; on a gun you use to kill a Russian cop&#8230; er. Why not just put your driver&#8217;s license on it, while you are at it?</li>
</ol>
<p>This was caught, exposed, throw to the press. But&#8230; the real more serious threat for the hackers here was that they might have been caught and it kept secret. True information then fed to them with false information.</p>
<p>From the data, I do not think these systems are American. I think there may have been some American influence. Stuxnet, for instance, was probably based on some American ideas about attack strategies against the Siemens systems. America probably supplied Siemens vulnerability information.</p>
<p>There is a level of sophistication which makes it clear this is nation state level. It appears to be Israeli. Maybe joint-Israel-American, but whatever the case, a lot of sloppy work, with elements of high level &#8216;nation state&#8217; sophistication.</p>
<p>I do not think Israel was trying to finger America. They may have wanted to throw some confusion on the issue. Or they may have sincerely disliked China. (I have never met an Israeli who expresses such a view, but then again, I probably just don&#8217;t meet that sort.)</p>
<p>Lotsa, lotsa speculation though.</p>
<p>Very wide margins in all of this for disinformation, and clever misdirection.</p>
<p>On one level, everyone is assuming it is nation state because of the sophistication of the code&#8230; but on another level, they are ignoring clear areas where there is seemingly astounding lack of sophistication.</p>
<p>So either there are gaps in the sophistication&#8230; or that was sophisticated misdirection in and of its&#8217; self.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251007">

			<div class="comment by-roger-dodger ">

				<p class="commentcredit">

					<span class="commenter">Roger Dodger</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251007">
						June 12, 2015 10:33 AM					</a>

				</p>

				<p>@Matthew Smith</p>
<blockquote><p>In the Citizen4 movie documentary, there is a moment where Snowden implies that the voIP phones in the hotel room could be hacked. He said it was a routine tactic.</p></blockquote>
<p>Have not seen it yet, wait for most movies to hit rental. Hopefully tonight. Hear it is very good.</p>
<p>VOIP often is poorly installed and default passwords are left.</p>
<p>Not much trickery to that, unfortunately. Nor in hacking hotel security.</p>
<p>A lot of hotels have wide open wifis.</p>
<p>Stingrays are relatively inexpensive, and can be delivered foreign or reconstructed from innocuous parts and code downloaded. Cell towers will also be static, and can be hacked. That requires sophistication.</p>
<p>Reconstructing or delivering stingrays overseas requires some level of sophistication.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251008">

			<div class="comment by-grayslady ">

				<p class="commentcredit">

					<span class="commenter">grayslady</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251008">
						June 12, 2015 12:45 PM					</a>

				</p>

				<p>From an article in Spiegel.de:</p>
<p>&#8220;In 2011, Kaspersky analysts found a few oddities in the program code for the previous version of Duqu, which confirmed the suspicions. These suggested that the code&#8217;s authors were from a country in the GMT + 2 time zone, and that they worked noticeably less on Fridays and not at all on Saturdays, which corresponds to the Israeli work week, in which the Sabbath begins on Friday.&#8221;</p>
<p>To me, this is an impressive level of in-depth analysis by Kaspersky. I&#8217;ve always been curious about attribution to various state actors when I read U.S. statements saying that &#8220;such and such&#8221; a country was responsible for a U.S. hack, especially when it seems relatively easy to fake an IP address.</p>
<p>Meanwhile, given what Kapersky says about the financial resources required to write these types of intrusive programs, I guarantee that the money to finance this didn&#8217;t come from the Israeli budget but from the U.S. We already know, courtesy of Edward Snowden, that the NSA shares raw data with Israel. A quid pro quo comes to mind here. Let the U.S. finance the research but ostensibly keep its hands clean when Israel gets caught.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251009">

			<div class="comment by-albert ">

				<p class="commentcredit">

					<span class="commenter">albert</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251009">
						June 12, 2015 1:07 PM					</a>

				</p>

				<p>@Heartbleed,</p>
<p>Thank you for mentioning the 408.23kg sasquatch in the room.</p>
<p>Windows‚Ñ¢ is targeted because it is in ubiquitous in the banking, political, legal, manufacturing and corporate sectors. You have all their employees whose systems are lovely attack vectors. I think the military is less enthusiastic. I can&#8217;t imagine spy agencies using it, but they love it when others do.<br />
.<br />
Security aside, working with Windows‚Ñ¢ was always a love/hate situation for me. In the past, I hoped it would die just because it sucked as an OS. Apparently, that wasn&#8217;t enough. With all its Achilles heels, will &#8216;security&#8217; finally destroy it?</p>
<p>One can only hope.</p>
<p>.<br />
&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251010">

			<div class="comment by-65535 ">

				<p class="commentcredit">

					<span class="commenter">65535</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251010">
						June 12, 2015 1:24 PM					</a>

				</p>

				<p>If the code resides in RAM would Address Space Layout Randomization (ASLR) have helped mitigate this attack?</p>
<p><a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization" rel="nofollow ugc">https://en.wikipedia.org/wiki/Address_space_layout_randomization</a></p>
<p>I notice that Kaspersky Labs was us Domain Controllers which mean Windows. And, then I read that ASLR is only enabled for certain .exe‚Äôs like DLL‚Äôs. So, there are holes in the windows ASLR implementation.</p>
<p>‚ÄúMicrosoft&#8217;s Windows Vista (released January 2007) and later have ASLR enabled for only those executables and dynamic link libraries specifically linked to be ASLR-enabled. For compatibility, it is not enabled by default for other applications. Typically, only older software is incompatible and ASLR can be fully enabled by editing a registry entry &#8220;HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\MoveImages&#8221;, or by installing Microsoft&#8217;s Enhanced Mitigation Experience Toolkit.‚Äù &#8211; Wikipedia</p>
<p><a href="https://en.wikipedia.org/wiki/Address_space_layout_randomization#Microsoft_Windows" rel="nofollow ugc">https://en.wikipedia.org/wiki/Address_space_layout_randomization#Microsoft_Windows</a></p>
<p>I wonder if the EMET kit was installed in Kaspersky‚Äôs systems.</p>
<p>All and all the malware is fairly amazing [using magic strings to re-infect systems].</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251011">

			<div class="comment by-82de478ea93bdd87 ">

				<p class="commentcredit">

					<span class="commenter">82de478ea93bdd87</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251011">
						June 12, 2015 1:52 PM					</a>

				</p>

				<p>@ Heartbleed.</p>
<p>Very true!</p>
<p>I understand a security company like Kaspersky Labs runs Windows on some machines as its flagship product to non-enterprise customers is an antivirus package, but they can do better on their internal networks.</p>
<p>There are powerful and secure operating systems, like OpenBSD, that will make these attacks more difficult, if possible at all while providing a full set of secure services.</p>
<p>Kerberos is too large, too difficult, too &#8220;engineered&#8221;, to be trusted.  Security must be simple, easy to understand, easy to audit.  This one is the reason we dropped Kerberos on OpenBSD a year ago.  Its codebase is too large to be effectively audited.</p>
<p>Windows itself is a bad operating system.  It was built on a weak base, and its growth is full of mistakes and bad design decisions.</p>
<p>@ albert</p>
<p>No, Windows is not targeted because it is ubiquitous.  It is targeted because it is poorly written.  Period.</p>
<p>Why is it so difficult to understand?  Let us talk about Linux and Unix operating systems.  Linux is widely used, it is used in academia, it is used in datacenters.  Is it not a valuable target?  It is!  Only a few attacks are known against current Linux distributions, a lot fewer than the ones available on Windows.</p>
<p>What about OpenBSD?  Is it one of the most secure operating systems because no one has interest on attacking it?  Certainly not!  As an operating system that does not have known attacks against its base system (apart of mistakes made by system managers and users) anyone developing a tool to attack it will become immediately famous.  Most services running on a stock OpenBSD installation are the same ones available on Linux (OpenSSH, nsd, unbound&#8230;).  Why are these services less vulnerable?  Because OpenBSD has proactive security.  It is not lack of interest on these operating systems, it is just that Linux and BSDs are developed following good coding practices and modern secure coding styles.</p>
<p>Are we talking about getting in trouble?  Windows.<br />
Do we want something pretty but not very secure?  OS X, iOS, Android&#8230;<br />
Do we want a mainstream operating system that provides good security?  Any reasonable Linux or BSD distribution will do the trick.<br />
Do we want rock solid security?  OpenBSD.</p>
<p>Are we talking about information security?  I would drop any closed source tool, not to say the ones written in the United States for obvious reasons.</p>
<p>Open source is the way to go to get security; there are lots of people auditing the code, not only developers, and giving valuable feedback.  Just look into the OpenBSD mailing lists to see how the open source model should work.  OpenBSD is not only the product of a dedicated team of highly skilled developers, it has a lot of contributions by end users that read, understand and improve its source code too.</p>
<p>A fundamental principle on computer and information security: you cannot trust a product whose source code you cannot see.</p>
<p>I cannot understand how Kaspersky Labs calls themselves a &#8220;security company&#8221; when they are running one of the worst operating systems on their internal networks.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251012">

			<div class="comment by-964907216836963 ">

				<p class="commentcredit">

					<span class="commenter">964907216836963</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251012">
						June 12, 2015 2:14 PM					</a>

				</p>

				<p>@Hartbleed: &#8220;Why would anyone continue to expose themselves with this ridiculously insecure OS?!&#8221;</p>
<p>Because if you find yourself target of an attack of such sophistication, your OS doesn&#8217;t really seem to matter:<br />
&#8220;US Navy wants 0-day intelligence to develop weaponware<br />
[&#8230;]<br />
The Navy&#8217;s definition of ‚Äú widely used software‚Äù includes ‚ÄúMicrosoft, Adobe, JAVA, EMC, Novell, IBM, Android, Apple, CISCO IOS, Linksys WRT, and Linux, and all others.‚Äù&#8221;<br />
<a href="http://www.theregister.co.uk/2015/06/12/us_navy_wants_0day_intelligence_to_develop_weaponware/" rel="nofollow ugc">http://www.theregister.co.uk/2015/06/12/us_navy_wants_0day_intelligence_to_develop_weaponware/</a></p>
<p>@Roger Dodger: &#8220;This was caught, exposed, throw to the press. But&#8230; the real more serious threat for the hackers here was that they might have been caught and it kept secret. True information then fed to them with false information.&#8221;</p>
<p>The hackers already knew that they were caught, so there was no point in holding back the information &#8211; better turn it into publicity instead, hoping that nobody leaks it beforehand, while you are waiting for the 0-days to be patched, thereby damaging your reputation, or uses it for blackmail:<br />
&#8220;Another indication that a spear-phishing email was used was the fact that while Kaspersky was investigating the breach, the attackers wiped the mailbox and browsing history from the infected employee‚Äôs system, preventing Kaspersky from fully analyzing it.<br />
The wipe occurred just four hours before Kaspersky identified the employee‚Äôs machine as ‚Äúpatient zero,‚Äù suggesting the intruders knew they‚Äôd been caught and were racing to eliminate evidence before Kaspersky could find it. Raiu suspects they may have been tipped off when Kaspersky disconnected many of its critical systems from the Internet after discovering the breach. He notes, however, that the company has backups and logs of the employee‚Äôs system, and once they‚Äôre able to compile and review them, he‚Äôs confident they‚Äôll produce evidence of how the attackers got in.&#8221;<br />
<a href="http://www.wired.com/2015/06/kaspersky-finds-new-nation-state-attack-network/" rel="nofollow ugc">http://www.wired.com/2015/06/kaspersky-finds-new-nation-state-attack-network/</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251013">

			<div class="comment by-964907216836963 ">

				<p class="commentcredit">

					<span class="commenter">964907216836963</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251013">
						June 12, 2015 2:46 PM					</a>

				</p>

				<p>@82de478ea93bdd87: &#8220;I cannot understand how Kaspersky Labs calls themselves a &#8220;security company&#8221; when they are running one of the worst operating systems on their internal networks.&#8221;</p>
<p>Well, I would think that they don&#8217;t use Windows end user default configuration, but probably have people paid for hardening whatever OS that is they use. (I won&#8217;t go into the closed vs. open source sabotage possibilities debate.)</p>
<p>P.S.: I&#8217;m not trying to defend Windows. I just don&#8217;t see any point in finger pointing here. Pick OS(es) according to your wishes, but accept that there may be other use cases (e.g. compatibility).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251014">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251014">
						June 12, 2015 2:52 PM					</a>

				</p>

				<p>@ Bruce Schneier</p>
<p>The attack scheme is clever. Matthew Smith pointed out it&#8217;s a known attack vector. Even before that, I think you reported on security research where all kinds of conference phones where hacked. If it&#8217;s software and COTS, then they might hack it is my view. That&#8217;s why organized crime and certain security focused groups do critical meetings with no technology present at all along with bug sweeps. You&#8217;d think the countries doing the most attacks, err our U.N. &#8220;Security&#8221; Council, would&#8217;ve learned this by now. üòâ</p>
<p>Far as the malware, I think that detailed document is the single greatest argument for a POLA architecture that I&#8217;ve seen to date. Compromising the tiniest things gave them access to pages and pages of privileges. That&#8217;s just ridiculous given we had systems that did the opposite in the 70&#8217;s and 80&#8217;s. It&#8217;s long past time our proprietary and FOSS teams start building POLA into their architectures. I&#8217;m even fine with it being subsidized by the taxpayers to tune of billions of dollars if we can&#8217;t do it any other way.</p>
<p>Meanwhile, I&#8217;ll continue to recommend the more radical and minimalist architectures to any who ask while citing documents such as this when they complain. Securing a Windows system while using standard Windows apps/services is impossible or close to it. Securing a UNIX, Linux, or Mac system can be just as hard. Only the POLA and clean slate architectures stand a chance.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251015">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251015">
						June 12, 2015 3:27 PM					</a>

				</p>

				<p>@ 82de478ea93bdd87</p>
<p>&#8220;Only a few attacks are known against current Linux distributions, a lot fewer than the ones available on Windows.&#8221;</p>
<p>Linux has had hundreds of vulnerabilities. The nation states have attack kits for it. Black hats have even hit it. That it&#8217;s rarely hit these days is caused by two things: (a) most attacks on back-ends hit application layer where most vulnerabilities are found; (b) Linux desktops are rare, especially among juicy targets.</p>
<p>&#8220;Windows is not targeted because it is ubiquitous. It is targeted because it is poorly written. Period.&#8221;</p>
<p>Windows is targeted because it has 90+% market share and most targets run Windows (see above report). Even malware writers have said this before. Period.</p>
<p>&#8220;What about OpenBSD? &#8221;</p>
<p>It&#8217;s had many potential vulnerabilities in OS and ported applications. They called them &#8220;bugs&#8221; (not vulnerabilities) and do patch most rather quickly. My method for OpenBSD hacking is &#8220;Watch mailing list for bug announcements. Quickly determine if it&#8217;s exploitable. If so, turn it into a payload. Hit target system. Profit.&#8221; So, it&#8217;s special in terms of quality focus but still can be hacked if anyone bothered to try. (Few bother.) Especially at layers below kernel that they don&#8217;t care about, privilege escalation because they refuse M.A.C., in a VM because Theo doesn&#8217;t worry about those issues, and covert channels because they probably never heard of them.</p>
<p>Note: It&#8217;s reputation adds more risk as it&#8217;s often used for &#8220;fire-and-forget&#8221; appliances. This can be reinterpreted as &#8220;they don&#8217;t patch or they patch very rarely.&#8221; The more they trust it, the more likely the bad guys get in. üòâ</p>
<p>&#8220;Do we want rock solid security?&#8221;</p>
<p>You&#8217;d have to use an OS that supports POLA with a security-focus. The mainstream OS&#8217;s lack POLA, have no trusted path, are full of covert channels, are architecturally weak, use complex implementations, run tons in kernel mode, and so on. Everything you <em>don&#8217;t</em> want in a secure system. That OpenBSD has these problems is why it was abandoned in Navy&#8217;s Montery Security Project as not secure enough or even structured enough to make a security argument. So, you&#8217;ll probably have to use a minimalist setup. Most &#8220;secure&#8221; desktops are cheating by <a href="http://os.inf.tu-dresden.de/papers_ps/nizza.pdf" rel="nofollow ugc">combining</a> separation kernels with user-mode Linux and security-critical stuff outside the kernel. Only two (usable) offerings in open-source aiming for a whole POLA stack are <a href="http://genode.org/about/publications" rel="nofollow ugc">GenodeOS</a> and <a href="http://www4.cs.fau.de/Projects/JX/" rel="nofollow ugc">JX</a>.</p>
<p>So, feel free to download, use, or improve one of the POLA-enforcing systems. Anything else is false security waiting to be smashed because it lacks the very <a href="http://www.cs.virginia.edu/~evans/cs551/saltzer/" rel="nofollow ugc">properties</a> that make security work. Especially Windows-, UNIX-, or Mach-like systems. I remember geniuses working hard back in the day to reimplement the latter two securely. Even a 17,000 line of code UNIX couldn&#8217;t be secured while maintaining backward compatibility and took <em>extensive</em> changes to architecture/implementation. Good luck trying to protect a hundred Kloc or 1+ Mloc UNIX while maintaining risky architecture and compatibility with insecure applications. Although, the CERT people do appreciate such efforts to protect their job security.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251016">

			<div class="comment by-big-%d7%90%d6%b8%d7%97 ">

				<p class="commentcredit">

					<span class="commenter">Big ◊ê÷∏◊ó</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251016">
						June 12, 2015 4:20 PM					</a>

				</p>

				<p>duqu2 for the VIPs, Flash for the masses</p>
<p><a href="http://thewire.in/2015/06/09/israeli-firm-strong-arms-indian-techie-for-exposing-suspicious-code/" rel="nofollow ugc">http://thewire.in/2015/06/09/israeli-firm-strong-arms-indian-techie-for-exposing-suspicious-code/</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251017">

			<div class="comment by-albert ">

				<p class="commentcredit">

					<span class="commenter">albert</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251017">
						June 12, 2015 4:27 PM					</a>

				</p>

				<p>@82de478ea93bdd87,</p>
<p>If Linux/Unix/OpenBSD were ubiquitous in the <i>areas I mentioned</i>, they would certainly be more heavily targeted, regardless of how &#8216;secure&#8217; they are, simply because that&#8217;s where the high value targets are.<br />
.<br />
Yes, Linux is used in academia, Apache is the most popular Web server. [A company I worked for (a Windows house) specifically bought a Linux box just to run their website, at the insistence of my Windows-hating boss, and it wasn&#8217;t even a security issue.]<br />
.<br />
&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251018">

			<div class="comment by-kenny ">

				<p class="commentcredit">

					<span class="commenter">Kenny</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251018">
						June 12, 2015 4:35 PM					</a>

				</p>

				<p>I suggest reading through the detailed PDF from Kaspersky on how Duqu 2.0 works. The level of sophistication, esp the techniques that were used to hide the malware from the Kaspersky products, was really staggering. The malware plug in architecture had over 100 plug-ins.</p>
<p>Credit to Kaspersky for being transparent about the attack.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251019">

			<div class="comment by-rodger-dodger ">

				<p class="commentcredit">

					<span class="commenter">Rodger Dodger</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251019">
						June 12, 2015 7:00 PM					</a>

				</p>

				<p>@grayslady</p>
<blockquote><p>&#8220;In 2011, Kaspersky analysts found a few oddities in the program code for the previous version of Duqu, which confirmed the suspicions. These suggested that the code&#8217;s authors were from a country in the GMT + 2 time zone, and that they worked noticeably less on Fridays and not at all on Saturdays, which corresponds to the Israeli work week, in which the Sabbath begins on Friday.&#8221;</p></blockquote>
<blockquote><p>Meanwhile, given what Kapersky says about the financial resources required to write these types of intrusive programs, I guarantee that the money to finance this didn&#8217;t come from the Israeli budget but from the U.S. We already know, courtesy of Edward Snowden, that the NSA shares raw data with Israel. A quid pro quo comes to mind here. Let the U.S. finance the research but ostensibly keep its hands clean when Israel gets caught.</p></blockquote>
<p>Smashing insight, Mrs Gray. (I so love the modern proliferation of the name &#8220;Gray&#8221; these days. Always reminds me of classy, innocuous sophistication with a bit of hard to fathom morality at the backbone.)</p>
<p>Reminds me a bit of the sloppiness in the dubai assassination. A mixture of extraordinary sophistication, distinct innocuousness&#8230; and downright clumsiness.</p>
<p>But hard to argue with that, as contrary to the trumpets of the media, <i>no one actually got caught, just fake faces on pictures</i>.</p>
<p>I do not want to see Israel take much blame here, last thing they need is their foaming at the mouth critics get another morsel.</p>
<p>America can handle the criticism. And that is what Russia really, badly wants to believe.</p>
<p>@964907216836963</p>
<blockquote><p>,The hackers already knew that they were caught, so there was no point in holding back the information &#8211; better turn it into publicity instead, hoping that nobody leaks it beforehand, while you are waiting for the 0-days to be patched, thereby damaging your reputation, or uses it for blackmail:</p></blockquote>
<blockquote><p>The wipe occurred just four hours before Kaspersky identified the employee‚Äôs machine as ‚Äúpatient zero,‚Äù suggesting the intruders knew they‚Äôd been caught and were racing to eliminate evidence before Kaspersky could find it. Raiu suspects they may have been tipped off when Kaspersky disconnected many of its critical systems from the Internet after discovering the breach. </p></blockquote>
<p>Insightful catches, 964907216836963.</p>
<p>I forgot there was an zero day in there that got immediate rush to patch. And the detail that they that there was evidence they were aware they were caught. I took the later as likely just SOP, and missed the obvious implications there. I do believe you are correct. I think my suspicious bias got in the way of seeing that clearly.</p>
<p>You seem to be talented at getting into people&#8217;s heads and figuring out their likely angle of perspective. So, two questions that are bugging me on this, if you could? I can&#8217;t figure this out.</p>
<p>What do you make of this?</p>
<blockquote><p>Additionally, the security firm Symantec, which obtained samples of Duqu 2.0 provided by Kaspersky, uncovered more victims of the targeted attack code among its own customers, and found that some of these victims were in the US‚Äîa fact that would be cause for even more concern if the attack were perpetrated by the US government.</p></blockquote>
<p>Also, what do you make of the &#8220;ugly.gorilla&#8221; reference? (And, considering the strong value of the term, the unknown to me term &#8220;romanian.anti-hacker&#8221;.)</p>
<blockquote><p>They would first send one of two ‚Äúmagic strings‚Äù to the driver‚Äîeither ‚Äúromanian.anti-hacker‚Äù or ‚Äúugly.gorilla‚Äù‚Äîfrom an IP address in Jakarta or Brazil. The strings triggered the driver to add the IP addresses to a whitelist so communication to them wouldn‚Äôt be flagged.</p></blockquote>
<p><a href="http://www.bloomberg.com/bw/articles/2014-05-19/u-dot-s-dot-charges-five-chinese-military-hackers-with-online-spying" rel="nofollow ugc">http://www.bloomberg.com/bw/articles/2014-05-19/u-dot-s-dot-charges-five-chinese-military-hackers-with-online-spying</a></p>
<blockquote><p>The U.S. government and private security researchers have been tracking the depredations of Chinese hackers on U.S. companies for years, including the online footprints of Ugly Gorilla, the alias of one of the indicted hackers, Wang Dong. Ugly Gorilla has been identified with the campaigns of Comment group, one of the best-known teams that has been linked to intrusions at hundreds of organizations in the past decade.</p></blockquote>
<p>I do not see any unrelated, previous usage of the exact term &#8220;romanian anti-hacker&#8221;, anywhere.</p>
<p>Just kind of weird. Like a personal signature at a crime scene or something.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251020">

			<div class="comment by-anotherjustin ">

				<p class="commentcredit">

					<span class="commenter">AnotherJustin</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251020">
						June 12, 2015 7:15 PM					</a>

				</p>

				<p>&#8220;grayslady ‚Ä¢ June 12, 2015 12:45 PM</p>
<p>From an article in Spiegel.de:</p>
<p>&#8220;In 2011, Kaspersky analysts found a few oddities in the program code for the previous version of Duqu, which confirmed the suspicions. These suggested that the code&#8217;s authors were from a country in the GMT + 2 time zone, and that they worked noticeably less on Fridays and not at all on Saturdays, which corresponds to the Israeli work week, in which the Sabbath begins on Friday.&#8221;</p>
<p>This is ridiculous on it&#8217;s own, it&#8217;s exactly what one would do if one wanted to point blame elsewhere.  Of course one would emulate another time-zone.  That much is easy.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251021">

			<div class="comment by-rodger-dodger ">

				<p class="commentcredit">

					<span class="commenter">Rodger Dodger</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251021">
						June 12, 2015 8:10 PM					</a>

				</p>

				<p>@AnotherJustin</p>
<p><i>time zone suggesting israeli</i></p>
<blockquote><p>This is ridiculous on it&#8217;s own, it&#8217;s exactly what one would do if one wanted to point blame elsewhere. Of course one would emulate another time-zone. That much is easy.</p></blockquote>
<p>Yes. It is interesting to speculate. But one of these viruses, believe it was some Kaspersky report indicated the detail of evidence the developers worked eastern time, us. Now this. And why did it hack us targets or use nicks like &#8220;ugly gorilla&#8221;, &#8220;anti-romanian hacker&#8221; (seems like the two together kind of say &#8216;f u&#8217;). Hard to believe either US or Israel would do that.</p>
<p>Also Auschwitz connection seems like an &#8216;all too obvious&#8217; Israel tie. Why would they do that THEN hack the guys who catch this kind of thing, unless they wanted to get caught? And with plenty of evidence tying back to every &#8220;other&#8221; US &amp; Israeli suspected hack job.</p>
<p>Nobody knows anything about most state hacks, the many Chinese ones included, probably. Why would China consistently hack from their own shore?</p>
<p>Only the suspected governments really know, and they are not saying. Possibly to their own detriment.</p>
<p>Non-evidence lead investigations can collect a lot of seemingly significant evidence pushing a favorite theory and misstatements and erroneous conclusions can cling together and make one giant ball of paper that is entirely misleading.</p>
<p>Could be an attempt to cause relationship problems between the US and Israel, or ready for a really bad attack after years of building up a seemingly dead accurate attribution&#8230; all the while never literally naming names. Just implying.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251022">

			<div class="comment by-82de478ea93bdd87 ">

				<p class="commentcredit">

					<span class="commenter">82de478ea93bdd87</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251022">
						June 13, 2015 10:35 AM					</a>

				</p>

				<p>@964907216836963</p>
<p><cite>Well, I would think that they don&#8217;t use Windows end user default configuration, but probably have people paid for hardening whatever OS that is they use. (I won&#8217;t go into the closed vs. open source sabotage possibilities debate.)</cite></p>
<p>Closed versus open source is not only about sabotage possibilities, a real threat that becomes even more dangerous for U.S.-based corporations, but also about the lack of enough qualified eyes spotting bugs in the source.</p>
<p>@Nick P</p>
<p><cite>It&#8217;s had many potential vulnerabilities in OS and ported applications. They called them &#8220;bugs&#8221; (not vulnerabilities) and do patch most rather quickly. My method for OpenBSD hacking is &#8220;Watch mailing list for bug announcements. Quickly determine if it&#8217;s exploitable. If so, turn it into a payload. Hit target system. Profit.&#8221; So, it&#8217;s special in terms of quality focus but still can be hacked if anyone bothered to try. (Few bother.) Especially at layers below kernel that they don&#8217;t care about, privilege escalation because they refuse M.A.C., in a VM because Theo doesn&#8217;t worry about those issues, and covert channels because they probably never heard of them.</cite></p>
<p>How many of these potential vulnerabities in OpenBSD can be exploited?  We call &#8220;bugs&#8221; what is a bug and &#8220;vulnerability&#8221; what is a vulnerability.  A local/remote denial of service may be annoying, but it is not a vulnerability, it is a bug that may degrade a service.  Even if a service is vulnerable, how many chances have a cracker to exploit it?  Most services are chroot&#8217;ed, systrace limits the amount of damage that can be done, we have partial ASLR support since 2003 and complete ASLR support since 2008, strong randomization, and lots of proactive security measures just in place.</p>
<p>Virtual machines are unsecure on most architectures; we fully support virtualization where it can be done right (e.g. some high-end SPARC64 gear), however we do not support it where it cannot be done in the right way.</p>
<p>What do you mean when saying &#8220;especially at layers below kernel that we don&#8217;t care about&#8221;?  Firmware?  How can we audit/fix, let us say, the firmware on a hard disk or solid state drive?  No one has the tools required to work at so low level right now, except firmware developers.  We cannot audit Intel ME or vPro technologies for obvious reasons, but there is a chance to apply some limits to the control imposed by hardware where possible.</p>
<p><cite>It&#8217;s reputation adds more risk as it&#8217;s often used for &#8220;fire-and-forget&#8221; appliances. This can be reinterpreted as &#8220;they don&#8217;t patch or they patch very rarely.&#8221; The more they trust it, the more likely the bad guys get in. üòâ</cite></p>
<p>Sadly, you are right here.  There are lots of appliances that are never patched because &#8220;OpenBSD is secure&#8221;.  People should follow stable at least.</p>
<p><cite>You&#8217;d have to use an OS that supports POLA with a security-focus. The mainstream OS&#8217;s lack POLA, have no trusted path, are full of covert channels, are architecturally weak, use complex implementations, run tons in kernel mode, and so on. Everything you <em>don&#8217;t</em> want in a secure system. That OpenBSD has these problems is why it was abandoned in Navy&#8217;s Montery Security Project as not secure enough or even structured enough to make a security argument. So, you&#8217;ll probably have to use a minimalist setup. Most &#8220;secure&#8221; desktops are cheating by combining separation kernels with user-mode Linux and security-critical stuff outside the kernel. Only two (usable) offerings in open-source aiming for a whole POLA stack are GenodeOS and JX.</cite></p>
<p>Sorry, but it looks more like a legal requirement than a technical one.  Now I am unemployed, but in the past I had been working on environments where OpenBSD and OpenSSH were not allowed &#8220;because they were not listed as secure&#8221; while Windows was ok.</p>
<p>There are two approaches to computer security: the administrative one, based on certifications, and the technical one, based on facts.  Sadly, only one of these models work.  When exploiting a computer network no one will care if your operating system and tools have a lot of certifications if it is full of exploits.</p>
<p>Ironically, OpenBSD is &#8220;not POSIX compliant&#8221; because it lacks certification (a process that at the end can be outlined as paying big amounts of money to a group to get a certification to each new release of the operating system) while Windows is fully POSIX compliant.</p>
<p>Perhaps the fact I am unemployed (as I had been most of my life) skews my point of view on this matter, but I do not care about the certifications a software product has.  I only care about facts, and I like OpenBSD.</p>
<p>Of course, to be really secure we cannot install anything we want on an OpenBSD server/workstation/appliance, but this restriction applies to POLA operating systems too.  There are limits about what can be done with a computer if we want it remain secure.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251023">

			<div class="comment by-rgaff ">

				<p class="commentcredit">

					<span class="commenter">rgaff</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251023">
						June 13, 2015 11:10 AM					</a>

				</p>

				<p>@ 82de478ea93bdd87</p>
<p>Hello OpenBSD evangelist-possibly-developer&#8230;  So when are you going to get MAC?  sigh.  Never.  Never ever.  Not in a million years.  But merely auditing code, as great as it is&#8230; is not enough&#8230;  Defense in depth man!</p>
<p><a href="https://allthatiswrong.wordpress.com/2010/01/20/the-insecurity-of-openbsd/" rel="nofollow ugc">https://allthatiswrong.wordpress.com/2010/01/20/the-insecurity-of-openbsd/</a></p>
<p><a href="https://en.wikipedia.org/wiki/Defense_in_depth_(computing)" rel="nofollow ugc">https://en.wikipedia.org/wiki/Defense_in_depth_(computing)</a></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251024">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251024">
						June 13, 2015 12:01 PM					</a>

				</p>

				<p>@ 82de478ea93bdd87</p>
<p>&#8220;How many of these potential vulnerabities in OpenBSD can be exploited? We call &#8220;bugs&#8221; what is a bug and &#8220;vulnerability&#8221; what is a vulnerability. &#8221;</p>
<p>Don&#8217;t know, don&#8217;t even care. The point is that bugs pour out of OpenBSD development process much like others. I&#8217;ve seen processes such as Fagan Inspections, Cleanroom, Praxis&#8217; Correct by Construction, and others where defects either existing or making it to a commit are rare. Praxis CbC defect rate was 0.1 per kloc for example. Then there&#8217;s the majority of projects doing the opposite. See the problem? You&#8217;d think quality-focused developers would learn and use what&#8217;s empirically proven to work.</p>
<p>&#8220;What do you mean when saying &#8220;especially at layers below kernel that we don&#8217;t care about&#8221;? Firmware? How can we audit/fix, let us say, the firmware on a hard disk or solid state drive? &#8221;</p>
<p>You can either (a) not support untrustworthy hardware or (b) support it with a warning that it&#8217;s secure except for specific components that you name. If your team does that, then your good by my standards. Otherwise, putting OpenBSD on such a piece of hardware then calling it a secure machine, as many do, is deceptive. I&#8217;m glad you mentioned SPARC, though, as it was one of my solutions to this problem back in the day. So much more open than the rest. Current solution for many projects is doing open hardware or firmware then porting OSS to it. Back to SPARC, Aeroflex-Gaisler has even has open SPARC processors to use along with board to buy. Check them out.</p>
<p>And user-mode drivers for availability. Let&#8217;s not forget that. Proven in practice to help via safety-critical microkernels and Minix 3. OpenBSD have that or are drivers still a big risk area?</p>
<p>&#8220;Sorry, but it looks more like a legal requirement than a technical one. &#8221;</p>
<p>Strawman followed by a bunch of others and red herrings whether intentional or not. There&#8217;s only one proven approach to building secure systems: a clear, appropriate set of requirements; a clear security policy for the system; a simplified, layered, modular design proven to implement both with all execution paths and error states fail-safe; an implementation of the same with language subset &amp; guidelines to avoid most errors; strong verification that the above correspond to each other; testing of components &amp; whole system; pen testing; covert channel analysis components &amp; system; source to object code verification; trusted distribution (which OpenBSD just got lol); good installation and configuration guidance. Every system built this way resisted or contained most to all attacks while most systems not built this way have had many vulnerabilities.</p>
<p>The Montery Project, like similar ones, aimed to be certified to medium or high assurance security. That meant its software development had to adhere to above principles. Such principles produce a TCB that clearly illustrates to reviewers that it <em>should</em> do its job under about any conceivable circumstance. Such a security argument also requires small amount of kernel mode code, which BSD&#8217;s/Linux&#8217;s all fail on. Mandatory controls &amp; strong isolation primitives are also required to contain damage from compromised applications. Theo is opposed to those IIRC. So, OpenBSD could never endure a high security evaluation because it lacks critical features and the rigorous development process necessary to make a believable, assurance argument. Montery switched to the STOP OS used in XTS-400 because it&#8217;s one of the few that has these and was only one of those they had on hand.</p>
<p>For examples of these principles in real systems, see Section 7 Assurance (p 117) in <a href="http://aesec.com/eval/NCSC-FER-94-008.pdf" rel="nofollow ugc">this</a> old MLS system or <a href="http://www.eros-os.org/papers/IEEE-Software-Jan-2002.pdf" rel="nofollow ugc">this</a> capability system (inspired by <a href="http://www.cis.upenn.edu/~KeyKOS/" rel="nofollow ugc">this</a> one). These kinds of architectures and development processes are rigorous enough to believe the result will either be secure or the closest thing to it achievable. Whereas OpenBSD leverages the kind of monolithic, complex, ad-hoc style that&#8217;s traditionally been responsible for our systems&#8217; vulnerabilities and ensured they&#8217;re severe. OpenBSD team is commendable in trying to hunt the bugs they produce and introducing mechanisms to attempt to reduce their impact. Ahead of mainstream OS&#8217;s in that regard. Yet, it&#8217;s far from secure at any given moment because it doesn&#8217;t do what security takes.</p>
<p>And I bet the team would never, under any circumstances, re-implement the system in a way that would pass an EAL6 evaluation or even have a convincing security argument for its many execution states. That&#8217;s why I classify it Low-Medium assurance. It&#8217;s also why it continues to have risks that are impossible (or improbable) with methods and architectures such as above. I cited GenodeOS and JX because they know what assurance takes and are at least attempting to use some of the above principles. Not endorsing their current security, just the attempt. I&#8217;d love to see a splinter group of OpenBSD&#8217;s talented people try to pick up where eg EROS left off and implement a whole OS on it piece by piece using established security engineering techniques. The results would probably be better than proprietary offerings given what they&#8217;ve accomplished using a monolithic approach.</p>
<p>They won&#8217;t, though. OpenBSD team, like others, failed to learn from the successes and failures of the past. Didn&#8217;t even learn UNIX lessons where secure attempts pulled everything non-essential out of kernel mode into a ring in between kernel and apps. Often used segments, too, for internal isolation in each layer. OpenBSD hasn&#8217;t even bested ancients such as UCLA Secure UNIX or Trusted Xenix in design assurance, much less a MILS or capability architecture.</p>
<p>So, the system is not to be trusted and people wanting to build high security must start with a different foundation. I would consider using OpenBSD for an untrusted component doing, say, Internet interface. I have before. Not the TCB, though. It will just get hacked by the pro&#8217;s and it will be too complex for me to even see the hack coming. That&#8217;s what always happens to monolithic systems with excess complexity, privilege, and bugs.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251025">

			<div class="comment by-justin ">

				<p class="commentcredit">

					<span class="commenter">Justin</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251025">
						June 13, 2015 2:53 PM					</a>

				</p>

				<p>@ Nick P</p>
<p>I like OpenBSD, and I like reading the criticisms of it, too.</p>
<p>For a mainstream OS that runs a lot of mainstream software, I happen to think it&#8217;s pretty good.  For me, it&#8217;s a &#8220;sensible&#8221; operating system that&#8217;s easy to administer without a lot of fuss or nasty surprises when it comes to day-to-day security.</p>
<p>The security model is simple.  It&#8217;s based on user/group/world permissions and chroot.  A lot of that mainstream software is ported with sensible options and configuration for best practical security.</p>
<p>Linux has MAC, courtesy of NSA.  It isn&#8217;t even used in a lot of mainstream Linux distributions, and even in those distributions, it isn&#8217;t even applied to secure a lot of risky applications, such as (???) web browsers.  The &#8220;right&#8221; security policies simply haven&#8217;t been developed.  Meanwhile OpenBSD&#8217;s DAC probably stronger than Linux&#8217;s DAC, simply because of code auditing and attention to quality.</p>
<p>Regarding some of the development philosophies that were mentioned:</p>
<p><i>&#8230; Praxis&#8217; Correct by Construction, and others where defects either existing or making it to a commit are rare. Praxis CbC defect rate was 0.1 per kloc for example.</i></p>
<p><a href="http://www.eschertech.com/products/correct_by_construction.php" rel="nofollow ugc">What I read about it</a> is this:   <i>&#8220;Testing is still performed, but its role is to validate the correct-by-construction process rather than to find bugs.&#8221;</i>  That sounds like a mushy philosophy to me.  You develop software according to some model, and then you are as likely to find issues in the model or specification itself as in the code.  In real life, those might not be discovered until testing.  And in real life, beyond the simple fact that more code has more errors, defect rate per kloc is a somewhat bogus metric, because you are not specifying what counts as one defect vs. more than one defect, whether it&#8217;s in the actual code, or in the specification or model, and furthermore you can only count what&#8217;s been discovered.  The assumption of reaching perfection at the end of any development process is arrogant.</p>
<p>Don&#8217;t get me wrong, I&#8217;m not against these high-assurance methodologies, and your posts about them pique my curiosity.  It&#8217;s just that I have a hard time shaking the impression that theory doesn&#8217;t always carry over into practice, where <b>in the real world, software is developed <a href="http://www.infoworld.com/article/2647071/applications/the-sorry-state-of-software-quality.html" rel="nofollow ugc">poorly</a> or <a href="http://www.urbandictionary.com/define.php?term=Vaporware" rel="nofollow ugc">not at all</a>.&lt;.b&gt;</b></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251026">

			<div class="comment by-tomtrottier ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://TomTrottier.com' rel='external nofollow ugc' class='url'>TomTrottier</a></span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251026">
						June 13, 2015 6:56 PM					</a>

				</p>

				<p>Isn&#8217;t it elementary, if you wish to preserve secrets, to:<br />
1. sweep for bugs<br />
2. disconnect phones<br />
3. draw curtains.<br />
?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251027">

			<div class="comment by-hasboo-rah ">

				<p class="commentcredit">

					<span class="commenter">Hasboo-rah</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251027">
						June 13, 2015 9:49 PM					</a>

				</p>

				<p>A hearty welcome to the two unctuous newcomers Roger Dodger &amp; anotherJustin! Extra international goodwill for oleaginous flattery and double overtime on the sabbath!</p>
<p>&#8216;I do not want to see Israel take much blame here, last thing they need is their foaming at the mouth critics get another morsel.&#8217;  Yeah, those crazy foaming at the mouth critics, namely everybody in the world except the US ambassador to the UN.<br />
<a href="http://www.ifamericansknew.org/stat/un.html" rel="nofollow ugc">http://www.ifamericansknew.org/stat/un.html</a> for 190-1 yuks</p>
<p>&#8216;This is ridiculous on it&#8217;s own, it&#8217;s exactly what one would do if one wanted to point blame elsewhere.&#8217; Or if out-of-control genocidaires stepped on their crank like that time they tried to bomb the British foreign office. Or Manhattan.<br />
<a href="http://www.veteranstoday.com/2015/01/12/mapping-911-fort-lee/" rel="nofollow ugc">http://www.veteranstoday.com/2015/01/12/mapping-911-fort-lee/</a></p>
<p>&#8216;Hard to believe either US or Israel would do that.&#8217; Yeah, that&#8217;s what Rachel Corrie said to herself right before she said SPFFTHPT.</p>
<p>&#8216;Could be an attempt to cause relationship problems between the US and Israel&#8217; Ah, the Eitan gambit! In other news, the only possible explanation for the Dubai clusterfuck is &#8216;a foreign agency, an enemy of Israel, is trying to harm Israel.&#8217;</p>
<p>&#8216;years of building up a seemingly dead accurate attribution.&#8217; What, did they find duqu2 in Khaled Mash&#8217;al&#8217;s ear?</p>
<p>Good job, bubeleh, blowing years of US-funded work in a Russian honeypot. At this rate Pollard will be home in no time.</p>
<p>By the way, Marc Grossman sez condolences on the F-16s, the replacement neutron bombs are in the mail.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251028">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251028">
						June 13, 2015 11:54 PM					</a>

				</p>

				<p>@ Justin</p>
<p>Fair opening. Most simultaneously neutral and positive statement I&#8217;ve seen yet lol. I&#8217;m going to address your points one by one to clear up some common misconceptions.</p>
<p>&#8220;For a mainstream OS that runs a lot of mainstream software, I happen to think it&#8217;s pretty good.&#8221;</p>
<p>The problem is that all the mainstream OS&#8217;s intentionally use bad architecture and security decisions. OpenBSD aims at being a non-mainstream OS that supposedly makes better decisions. It does in small, tactical ways. Yet, the overall big picture is just as bad: monolithic design with slow IPC, poor decomposition, tons of overprivileged code, no POLA, and an inherently insecure API. Largely SSDI: Same Shit, Different Implementation.</p>
<p>Even though I like it as a UNIX, too. üôÇ</p>
<p>re OpenBSD security model, MAC, etc.</p>
<p>Ok, the most basic security model is dividing a system into subjects (active) and objects (passive/resources) with rules on what can access what. There are a number of security models that are proven to protect desktops/servers to varying degrees. MLS (eg GEMSOS) did for military&#8217;s security model for protecting secrecy; Biba (eg Windows Integrity Control) prevents integrity violations of various layers; system-level ACL&#8217;s offer fine-grained protection without context; Domain Type Enforcement (eg LOCK, SELinux) can do most of above with context; capability model can enforce arbitrary policies on everything in system with modeling ease of OOP. DTE and capabilities are most powerful model with also most efficiency overhead. Either could be used and were in exemplar secure systems.</p>
<p>OpenBSD, based on my limited knowledge, uses several security models: 2-level Biba via kernel &amp; user mode protection of MMU; discretionary access control; whatever chroot is considered. The huge amount of code in kernel mode and number of ways to interact with it mean the Biba protection isn&#8217;t trustworthy. The discretionary access control model is known to be so weak (see Windows CVE&#8217;s) better ones were invented to deal with it. chroot depends on the Biba-protected TCB and inherents its risk as it might be bypassed. So, OpenBSD&#8217;s security model sucks despite them implementing it stronger than most UNIX&#8217;s.</p>
<p>Note: NSA&#8217;s involvement in SELinux is probably not an issue. The Type Enforcement technology was developed over many projects with microkernels and <em>much</em> stronger security for <em>their</em> use. Got adopted commercially at SCC &amp; in McAfee Sidewinder firewall. SELinux was a prototype implementation of that &#8220;Flask architecture&#8221; on Linux to encourage development of CMW-like features and came with a warning that it alone didn&#8217;t make anything secure. Pretty above board to me. I argued for a strong re-implementation of it to medium-high assurance, though, to prevent vulnerabilities. It wasn&#8217;t done &amp; vulnerabilities followed&#8230;</p>
<p>Alternative</p>
<p>So, let&#8217;s just say hypothetically we&#8217;re wanting a secure UNIX. The first thing we do is search for information on past attempts to (a) make highly secure computers and (b) secure UNIX itself. Both lead to the same assurance techniques (eg Orange Book B3/A1) I mentioned before. We would&#8217;ve discovered things like UCLA Secure UNIX, Trusted Xenix, LOCK/IX, the Trusted Mach + UNIX hybrids, and so on. They&#8217;d have showed us to keep kernel code minimal, be careful on interfaces, use more than two rings of protection, put just security-critical code in kernel mode, modify API&#8217;s to remove their risks, eliminate setuid issue, ensure an unspoofable trusted path, use language subset to eliminate some coding vulnerabilities, covert channel suppression, and so on. These were all common in secure UNIX designs that were getting anywhere with reviewers and NSA pentesters.</p>
<p>So, then we&#8217;d start building this. Each API we&#8217;d implement to understand it, we&#8217;d analyse its success/failure states, we&#8217;d decide how to handle failures, we&#8217;d do a minimal covert channel analysis, and we&#8217;d implement it <em>outside kernel</em> of course. Kernel itself would handle tasks that couldn&#8217;t be done anywhere else, manage those things data, and wall itself off from outside influence as much as possible. The system would be carefully layered with little to no looping possible between layers. Inspections and simplified coding style would show absence of defects that plague other systems. Proven methods such as bounds-checked arrays, segments, rings, reverse stacks, Xenix&#8217;s setuid trick, and others would be used where possible to eliminate entire classes of attack. The result would have such a strong design and assurance argument that it would get B2/EAL5+ at minimum, eclipsing all but two of the competition.</p>
<p>The above isn&#8217;t the path OpenBSD or any NIX-like OS&#8217;s took. OpenBSD team, particularly, could&#8217;ve achieved it given the time they put into quality. Instead, they began and continue an uphill battle to achieve good security engineering results while applying few of its principles. Thing is, if they built a <a href="http://web.ornl.gov/~jar/doecmw.pdf" rel="nofollow ugc">CMW</a> or <a href="http://os.inf.tu-dresden.de/Studium/KMB/WS2009/12-Security-Architectures.pdf" rel="nofollow ugc">MILS</a> system, I&#8217;d probably still be using it and its quality would be giving the proprietary vendors a beating. Instead, they built another insecure BSD with better bug hunting and countermeasures to some UNIX issues. Everyone&#8217;s loss&#8230;</p>
<p>re Correct by Construction</p>
<p>What you read about <em>Eschersoft&#8217;s</em> &#8220;Correct by Construction&#8221; process doesn&#8217;t apply to <em>Praxis&#8217;s</em>. I think Praxis originated the Correct by Construction label for their specific software process. Confusingly, others in the niche use it as a term for the whole category of processes that all aim to get things right the first time. The one you cited has achieved some decent results. Yet, Praxis&#8217;s method is <a href="http://www.anthonyhall.org/c_by_c_secure_system.pdf" rel="nofollow ugc">here</a>. I think you&#8217;ll find their overall process to be quite thorough. They also gripe about unit testing by arguing (correctly) that it&#8217;s often a waste of effort given the nature of most errors. They focus on eliminating interface errors while semi-automating test generation for test cases that make sense. Margaret Hamilton took a similar approach for Apollo software and her team&#8217;s stuff worked flawlessly.</p>
<p>Far as its defect count, those are representative of the total number of flaws found since the system was delivered to the customer. Their process rarely produces any significant flaw. That a system runs flawlessly or at least according to spec every day of every year since its delivery says plenty about its quality. That they regularly delivered such results says plenty about the effectiveness of their methodology. It&#8217;s why I brought it up although Fagan Inspections and Cleanroom are easier to do for a BSD team.</p>
<p>re real world</p>
<p>That&#8217;s not the real world: that&#8217;s the majority of software projects or companies. They are (a) not knowledgeable about this stuff, (b) not equipped with resources to use it, and (c) rarely even care to attempt such a thing. The results reflect their market, management, and/or individual attitudes. The companies that aim for quality, predictability, and security are delivering it in spades to their customers. Examples off the top of my head include the DO-178B companies, Esterel, AdaCore, Altran/Praxis, iMatix, Green Hills, many smartcard vendors, all Type 1 vendors, the Cleanroom companies that warrantied code, a local one that does too, and quite a few more. Each of these invest in system engineering with strong techniques for correctness and/or security while making a profit selling it.</p>
<p>So, in the real world, these things exist and are applied by wise companies. Not all of them can do it. Not all should. But OSS projects aiming for high security have every reason to do at least as much as proprietary companies did. Proprietary companies that got results, too. Meanwhile, the majority of the market and OpenBSD&#8217;s architects continue down the paths that got NSA results. The SIGINT side, that is. üòâ</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251029">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251029">
						June 14, 2015 8:09 PM					</a>

				</p>

				<p>82de478ea93bdd87<br />
&#8211;While OpenBSD is up there and I&#8217;m using it as a stepping stone to something perhaps better, you sound like a fanboy.  Rootkits below OS, doesn&#8217;t matter your OS; so it works until then and it&#8217;s a bad feeling when you can&#8217;t find it or get rid of it.  You mentioned unemployment (apply yourself&#8230;) but Windows still reins supreme b/c you can get hella &#8220;real&#8221; work done on it (not reconfiguring stuff or opening a terminal everytime); aka the analog/hardware engineers that don&#8217;t screw w/ IDE&#8217;s and just want PSPICE to run.  Lots of software I need mostly runs on Windows (ham radio software and others for RF chips/boards).  Main thing is Windows terminal sucks, not fun at all, Unix reins supreme there.  Raspberry Pi has made huge leaps (and Ubuntu, and most especially Debian and all it&#8217;s derivatives (ahem Kali and Tails&#8230;)) in terms of &#8220;usefulness&#8221; and getting stuff up and running quickly.</p>
<p>I don&#8217;t really get why OpenBSD want you to connect so bad to a bunch of sketchy http mirrors during install, any reason for that?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251030">

			<div class="comment by-justin ">

				<p class="commentcredit">

					<span class="commenter">Justin</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251030">
						June 14, 2015 9:16 PM					</a>

				</p>

				<p>@ Nick P</p>
<p>Thanks for the explanation.  I think there is a lot to your arguments.  I appreciate your bringing them out in such detail for me and addressing my points.  I am starting to see more where you are coming from now.  In particular:</p>
<blockquote><p>OpenBSD aims at being a non-mainstream OS that supposedly makes better decisions. It does in small, tactical ways. Yet, the overall big picture is just as bad: monolithic design with slow IPC, poor decomposition, tons of overprivileged code, no POLA, and an inherently insecure API.  Largely SSDI: Same Shit, Different Implementation.</p></blockquote>
<p>I totally agree with all that.  I like OpenBSD for what it is, but of course, let&#8217;s not pretend it to be something that it is not.  There are a lot of things about Unix that should be done differently if one had it to do over, but OpenBSD does not reinvent Unix.  I have no affiliation with OpenBSD. Just a sometime user and fan, always open to alternatives and other ideas.</p>
<blockquote><p>The companies that aim for quality, predictability, and security are delivering it in spades to their customers.</p></blockquote>
<p>I don&#8217;t really have a way to evaluate that statement, because to the extent that there are companies really doing that, they are concentrating more on delivering to their customers than marketing their name to the general public.  Such companies seem to have a very small web footprint, and their customers don&#8217;t seem to be the type to talk very much, either.  That&#8217;s partly why I am so curious about your posts about the same.</p>
<p>@ Figureitout</p>
<blockquote><p>I don&#8217;t really get why OpenBSD want you to connect so bad to a bunch of sketchy http mirrors during install, any reason for that?</p></blockquote>
<p>Redundancy.  I don&#8217;t know.  A lot of Linux distributions do that, too.  Should it matter if you verify checksums?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251031">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251031">
						June 14, 2015 11:46 PM					</a>

				</p>

				<p>Justin<br />
&#8211;A lot of linux distros I can just download an ISO (check checksums, even though we know attacks have spoofed bank login websites, why couldn&#8217;t checksums be false and their sites be spoofed..?).  OpenBSD I do that nervously and I have to go download the rest of the parts from some http mirrors in Hungary (why should I trust a site here, or anywhere&#8230;?).  I&#8217;ve done otherwise, downloaded them on a USB then installed after searching just for file name, not file path (should order CD, but mail interdiction is an actual concern for me); but they really encourage to do this all on a multitude of http sites that just look like typical dead hacked sites.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251032">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251032">
						June 15, 2015 1:13 AM					</a>

				</p>

				<p>@Figureitout, @Justin,</p>
<p>But FreeBSD already uses a checksum, MD5 &#8230; I think OpenBSD does the same.</p>
<p>And Security advisories are signed with a PGP key, for example here is the advisory for <a href="https://www.freebsd.org/security/advisories/FreeBSD-SA-15:10.openssl.asc" rel="nofollow ugc">TLS security &#8220;issue&#8221;</a>. Remember that one?</p>
<p>With FreeBSD you have several options of obtaining the OS: you can get a minimal boot disk, an ISO image (source and binaries), or order the physical DVD for a fee. How else would you get the OS?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251033">

			<div class="comment by-justin ">

				<p class="commentcredit">

					<span class="commenter">Justin</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251033">
						June 15, 2015 1:16 AM					</a>

				</p>

				<p>@ Figureitout</p>
<p>You can just download an ISO for OpenBSD: say,</p>
<p><a href="ftp://ftp.openbsd.org/pub/OpenBSD/5.7/amd64/install57.iso" rel="nofollow ugc">ftp://ftp.openbsd.org/pub/OpenBSD/5.7/amd64/install57.iso</a></p>
<p>Verify the <a href="ftp://ftp.openbsd.org/pub/OpenBSD/5.7/amd64/SHA256.sig" rel="nofollow ugc">signed SHA256 hash</a> with the <a href="http://www.openbsd.org/cgi-bin/man.cgi/OpenBSD-current/man1/signify.1?query=signify&amp;arch=i386" rel="nofollow ugc">signify(1)</a> utility.</p>
<p>When it installs, you have the option of choosing to fetch the files from the CD itself rather than a mirror.  Even if you install, say from &#8220;floppy57.fs&#8221;, and have to download the install files from a &#8220;sketchy&#8221; mirror, I believe those files will still be verified.  One of the developers has a write-up of it <a href="http://www.tedunangst.com/flak/post/signify" rel="nofollow ugc"><b>here</b></a>.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251034">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251034">
						June 15, 2015 1:49 AM					</a>

				</p>

				<p>@ Justin, Wael,</p>
<p>As @Figureitout has indicated in the past, just trying to get anything across the net or by mail order gives an oportunity not just for interception but identification as a potential person of interest.</p>
<p>Futher it is known that creating CDs with malware on and substituting them in transit for the real ones is a &#8220;known&#8221; tactic of the likes of the FEYES.</p>
<p>As for &#8220;secure hashes&#8221; and &#8220;signed code&#8221; Stuxnet has shown that this is not an obstacle of much strength where the FEYES are concerned.</p>
<p>We have no idea let alone guarantee that the likes of NSA or GCHQ &#8220;contractors&#8221; have not &#8220;black bagged&#8221; the OpenBSD signing key, or have not added malware at some point in the development chain to enable the injection of rogue code so that it gets signed.</p>
<p>After all if CA&#8217;s who&#8217;s sole purpose in life is securing their own signing key and it&#8217;s usage, have been repeatedly subverted what hope for a group of geographicaly dispersed volunteers?</p>
<p>As I&#8217;ve pointed out before the secure delivery of code has all the same issues of securely distributing KeyMat and then some more on top&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251035">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251035">
						June 15, 2015 2:29 AM					</a>

				</p>

				<p>@Clive Robinson, @all,</p>
<p>Just skimmed through the 46 pages of the Kaspersky report. Malware depended on several zero-day vulnerabilities, that they claim were patched. Malware also attempted to hide its signature by using varying compression and encryption algorithms of the payload. It also used steganography for outbound traffic (appending exfilterated information to pictures of various formats.) It also used tunneling and port forwarding to disguise traffic as &#8220;legitimate&#8221;. And the bulk of its manifestation were memory resident; no HD persistence was utilized, which a static trusted boot mechanism would flag. Sounds like a class III attacker &#8230;</p>
<p>I guess the best thing is to air gap sensitive equipment. And by air gap, I mean isolated from the surrounding environment.</p>
<p>The other day I noticed that notes I update on my iPhone were being synced to my iPad, and I never opted to use iCloud. Noticed in the settings under my email account that &#8220;notes&#8221; was turned on. I don&#8217;t know the mechanism of how notes is synced, but apparently even turning it off may only mean it won&#8217;t be downloaded to my other device. Turning it off may not stop notes from being uploaded to some server&#8230; I guess if it&#8217;s good for notes, then it applies to everything else&#8230; It&#8217;s reasonable to assume everything on the mobile device is backed up somewhere remote. Don&#8217;t feel like monitoring the traffic &#8212; too boring, I&#8217;ll just operate under that assumption.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251036">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251036">
						June 15, 2015 2:56 AM					</a>

				</p>

				<p>Kaspersky says:</p>
<p><i></p>
<blockquote><p><b>PERSISTENCE MECHANISM:</b><br />
The Duqu 2.0 malware platform was designed in a way that survives almost exclusively in memory of the infected systems, without need for persistence. To achieve this, the attackers infect servers with high uptime and then re-infect any machines in the domain that get disinfected by reboots. Surviving exclusively in memory while running kernel level code through exploits is a testimony to the technical prowess of the group. In essence, the attackers were confident enough they can survive within an entire network of compromised computers without relying on any persistence mechanism at all.<br />
<b>The reason why there is no persistence with Duqu 2.0 is probably because the attackers wanted to stay under the radar as much as possible.</b> Most modern anti-APT technologies can pinpoint anomalies on the disk, such as rare drivers, unsigned programs or maliciously-acting programs. <b>Additionally, a system where the malware survives reboot can be imaged and then analyzed thoroughly at a later time.</b> With Duqu 2.0, forensic analysis of infected systems is extremely difficult ‚Äì one needs to grab memory snapshots of infected machines and then identify the infection in memory..</p></blockquote>
<p></i></p>
<p>I would also speculate that an attack of this sort targets virtual machines as well! I would say the main reason, from a high level, is the separation of domains principle isn&#8217;t implemented properly, which results in malware gaining access to kernel mode from a user mode word document or other apps. The Castle can be penetrated and the Prison can be escaped from &#8230; Of course intrusion detection, updating mechanisms (MSI) and crypto operations were shot as well. On top of that, firewalls were fooled when traffic went through normally and &#8220;legitimately&#8221; open ports (80, 443, etc)</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251037">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251037">
						June 15, 2015 5:47 AM					</a>

				</p>

				<p>@ Wael,</p>
<blockquote><p>The Castle can be penetrated and the Prison can be escaped from &#8230;</p></blockquote>
<p>If you remember back one major design function of the prison was that each jail/cell had an MMU controled by the hypervisor &#8211;not the cell CPU&#8211; as the door. The MMU was set so that the jail only had sufficient memory to run a small function and no more, so &#8220;no run of the castle&#8221;. Thus there would be insufficient room for malware to reside and thus &#8220;nowhere to hide&#8221;&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251038">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251038">
						June 15, 2015 5:59 AM					</a>

				</p>

				<p>@Clive Robinson,</p>
<p>No room for additional malware, but what about room for malware that replaces existing ligitware?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251039">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251039">
						June 15, 2015 6:36 AM					</a>

				</p>

				<p>@ Justin, Figureitout, Wael, Clive</p>
<p>It seems Justin finally mentioned it and Clive beat me to it: the hashes/checksums don&#8217;t mean crap unless their source is verified. The OpenBSD team <em>just recently</em> added trusted distribution of their software via signify program. Before that, you mainly got it from their (possibly-compromised) website, (possibly-compromised) mirrors, and spy agencies posing as mirrors. A lot of assurance there.</p>
<p>So, they did eliminate the need to rely on HTTPS to get the packages. Of course, you need to use HTTPS to get the first copy with signify. So, there&#8217;s still a chicken and the egg problem. They have some guidance of this on their signify page but it&#8217;s still basically luck or tons of labor. And let&#8217;s hope a subversion didn&#8217;t get through in which case they&#8217;re all compromised.</p>
<p>@ Wael, Clive</p>
<p>Isolation that fine grained basically can only use segments for performance reasons. I&#8217;m not sure we&#8217;ve discussed enough the most important point: pointer protection. The old hardware systems I&#8217;ve been citing do that as well as some new ones. Pointer abuse is at the center of all kinds of injection problems. ROP even uses existing code by abusing pointers to it. So, any architecture should consider paying a premium to (a) protect pointers or (b) detect violations of their anticipated usage. I know Clive mentions this in his Prison concept but implementation details matter <em>a lot</em> for performance. Many architectures were canned because their pointer mechanism had too much overhead.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251040">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251040">
						June 15, 2015 8:04 AM					</a>

				</p>

				<p>@ Wael,</p>
<blockquote><p>No room for additional malware, but what about room for malware that replaces existing ligitware?</p></blockquote>
<p>Again it was protected by a couple of the foundation ideas.</p>
<p>Firstly, the Hypervisor CPU, loads the cell CPU program function, which is in a particular form that makes a hash or similar check fast. Then every so often during operation the Hypervisor asserts the cell CPU &#8220;halt&#8221; line, and then checksums the fixed memory and range checks variables including cell CPU registers etc, if they checksum fails or the variables are out of range then thy hypervisor keeps the halt assertrd and kicks it up to the next level. If they are OK the hypervisor unasserts the halt line and the cell CPU continues executing unaware it was ever halted (there are real world time issues but there are ways of dealing with this).</p>
<p>The Second way is by &#8220;signature analysis&#8221;, all computer programs are determanist based on the instructions and data, thus well formed sub functions of any program are quite predictable in performance. Varience to the expected signiture causes the hypervisor to assert the cell CPU halt line and do the first check.</p>
<p>It is because both tests are probabilistic in nature I named it probabalistic security. Thus the more often you schedual the cell check the less chance malware has to go undetected.</p>
<p>The important thing to realise is that the program fragments that run each cell have to be &#8220;well formed&#8221; in certain respects as getting that wrong not only reduces performance it also reduces security. Importantly most &#8220;parallel methods&#8221; produce suitably well formed code that just requires minor memory rearangment.</p>
<p>@ Nick P, Wael,</p>
<blockquote><p>Pointer abuse is at the center of all kinds of injection problems.</p></blockquote>
<p>Yes and one way to reduce such issues is via an MMU to keep pointers in fixed range. Another way again with an MMU is to use a sliding window, such that pointers are in effect removed from the control of the cell CPU to that of the hypervisor. This second method requires some often odd looking ways to use memory but it can be quite efficient.</p>
<blockquote><p>I know Clive mentions this in his Prison concept but implementation details matter *a lot* for performance. Many architectures were canned because their pointer mechanism had too much overhead</p></blockquote>
<p>Performance is a relative measure, and thus you have to decide as you do with speed-v-memory etc what measure you wish to optimize.</p>
<p>Way back in the mists of time for most ICT folk K&amp;R realised that programer time was way more expensive than CPU time, thus they made certain choices which whilst increasing CPU time significantly eased the complexity for programers and thus at a stroke made programers more productive. In more recent times the system performance bottle necks have moved from hardware bound to OS bound hence one reason for &#8220;direct access&#8221; to IO hardware push we see and it&#8217;s attendant issues. Oracle were one of the first to go down this route, by taking the hard disk access out of the *nix kernel in various ways.</p>
<p>Specmanship was the rage of the 1980&#8217;s and 1990&#8217;s and was at the end of the day fairly pointless, due to raw system performance doubling about every year (remember system performance is bound by memory and I/O as well as CPU). Often the length of time it took programers to switch to a supposadly improved algorithm the raw performance improvment had solved the problem.</p>
<p>Today hardware cost is negligible compared to other costs hence the push to multiple CPU systems. Provided pointer use is bound in range to what a CPU can see local to it then issues such as cache misses that realy criple performance are avoided.</p>
<p>Thus if software is designed to use only local not far pointers or other hardware mechanisms (MMU based sliding windows) to keep far pointers local to the CPU pointer performance is often not an issue.</p>
<p>More interestingly perhaps is the on chip gains of segmented caches, shared memory and Harvard RISC not von Newman CISC CPUs. Software designed for traditional IaX86 systems obviously will behave like a dog on such a system, however when designed for the architecture the performance radicaly changes. The advantage of modern compilers is they can take a big chunk of such issues away from the programer. That said part of the prison design was to not alow the application programers to get even remotely close to the hardware. The system specialists who design and build the tasklet fragments the application programers &#8220;script&#8221; do that.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251041">

			<div class="comment by-georgel ">

				<p class="commentcredit">

					<span class="commenter">GeorgeL</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251041">
						June 15, 2015 10:25 AM					</a>

				</p>

				<p>@ Clive Robinson</p>
<p>While looking up &#8220;compilers&#8221; I encountered an entry on this blog from 2006. You had made some remarks on assembly code watermarking in response to comments posted to &#8220;countering trusting trust.&#8221; Has your observations changed since then? It&#8217;s been a while&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251042">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251042">
						June 15, 2015 4:46 PM					</a>

				</p>

				<p>@Clive Robinson, @Nick P,</p>
<blockquote><p>Again it was protected by a couple of the foundation ideas.<br />
Firstly, the Hypervisor CPU, loads the cell CPU program function, which is in a particular form that makes a hash or similar check fast. </p></blockquote>
<p>So this is still vulnerable just like hash based verification is, the way it‚Äôs currently implemented in any OS today, on any platform. What makes this any different?</p>
<blockquote><p>Then every so often during operation the Hypervisor asserts the cell CPU &#8220;halt&#8221; line, and <b>then checksums</b> the fixed memory and range checks variables including cell CPU registers etc, <b>if they checksum fails</b> or <b>the variables are out of range</b> then thy hypervisor keeps the halt assertrd and kicks it up to the next level. If they are OK the hypervisor unasserts the halt line and the cell CPU continues executing unaware it was ever halted (there are real world time issues but there are ways of dealing with this).</p></blockquote>
<p>Okay, I get the Hypervisor operation of halting the execution thread on a particular imprisoned CPU ‚Äî this is the ‚ÄúWarden‚Äù in action. I understand how variables can be checked if they aren&#8217;t within boundaries. The part about checksumming fixed memory and CPU registers is, I think, a bit hard. These values aren&#8217;t known a-priori and can take any value. There is no way to distinguish good hashes from bad hashes unless there is a reference used for comparison. I think we had this discussion a while back, and I took it that the reference is actually a ‚Äúsocial‚Äù or ‚Äúcrowd‚Äù reference, meaning the given thread is redundantly run on several CPUs under the control of the hypervisor, which will use some sort of voting mechanism to decide what&#8217;s an acceptable hash and what isn&#8217;t. There maybe other ways that you haven&#8217;t elaborated on.</p>
<blockquote><p>The Second way is by &#8220;signature analysis&#8221;, all computer programs are determanist based on the instructions and data, thus well formed sub functions of any program are quite predictable in performance. Varience to the expected signiture causes the hypervisor to assert the cell CPU halt line and do the first check.</p></blockquote>
<p>Signature based analysis at the code block level is a current research topic with early deployment. <a href="https://www.signup4.net/Upload/TERA10A/20142362E/1-GS-14-John%20Hopkins%20University-APL-Breiner.pdf" rel="nofollow ugc">CodeDNA</a> combines techniques used in genetics to detect various strains of a known malware.</p>
<blockquote><p>It is because both tests are probabilistic in nature I named it probabalistic security. Thus the more often you schedual the cell check the less chance malware has to go undetected.<br />
The important thing to realise is that the program fragments that run each cell have to be &#8220;well formed&#8221; in certain respects as getting that wrong not only reduces performance it also reduces security. Importantly most &#8220;parallel methods&#8221; produce suitably well formed code that just requires minor memory rearangment.</p></blockquote>
<p>I thought it was probabilistic because of other reasons, such as the voting mechanism and the ‚Äúprobability‚Äù that a piece of code is actually malware. This explanation also makes sense.</p>
<p>@Nick P,</p>
<blockquote><p>Pointer abuse is at the center of all kinds of injection problems‚Ä¶</p></blockquote>
<p>Yes, but it&#8217;s not alone. Having a formidable barrier between different privilege levels contains the injection damage. Then again, pointer abuse is typically at the boundaries or beyond ‚Äî not at the center üòâ</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251043">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251043">
						June 15, 2015 5:07 PM					</a>

				</p>

				<p>Justin, Figureitout, Wael, Clive Robinson,</p>
<blockquote><p>It seems Justin finally mentioned it and Clive beat me to it: the hashes/checksums don&#8217;t mean crap unless their source is verified. </p></blockquote>
<p>Just go to different mirrors and make sure the Hash is consistent. Then make sure the hash of the files you downloaded matches.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251044">

			<div class="comment by-justin ">

				<p class="commentcredit">

					<span class="commenter">Justin</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251044">
						June 15, 2015 5:37 PM					</a>

				</p>

				<p>@ Wael</p>
<blockquote><p>Just go to different mirrors and make sure the Hash is consistent. Then make sure the hash of the files you downloaded matches.</p></blockquote>
<p>That&#8217;s not good enough for the truly paranoid:  if your own internet connection is compromised by a MITM, the checksum may be altered but consistent no matter which mirror you think you are getting it from.</p>
<p>I suppose you could go through TOR &#8212; try to download the (very small) checksum file from different mirrors through different TOR exit nodes, and verify that it does appear the same everywhere.</p>
<p>At some point an attacker has to create a make-believe world with the wrong checksum for those files, and maintain the consistency of that make-believe world in order to fool someone successfully.  It&#8217;s not going to fool anyone who has sufficient independent means of verifying those checksums.  Unless the whole world is fooled, and as Nick P suggests, OpenBSD is indeed compromised.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251045">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251045">
						June 15, 2015 5:48 PM					</a>

				</p>

				<p>@Justin,</p>
<p>Okay, go to different mirrors using different platforms on different days, locations, times, running different Operating Systems&#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251046">

			<div class="comment by-justin ">

				<p class="commentcredit">

					<span class="commenter">Justin</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251046">
						June 15, 2015 6:35 PM					</a>

				</p>

				<p>@Wael</p>
<blockquote><p>Okay, go to different mirrors using different platforms on different days, locations, times, running different Operating Systems&#8230;</p></blockquote>
<p>Yes, at some point you will have pretty good assurance that the checksum file you have downloaded is actually the one being published on the internet.  Otherwise, if you find any discrepancies, it would be interesting to download the file corresponding to the wrong checksum, and compare it to the file with the right checksum.  Do an installation, and compare it with a known good installation.  What is different?</p>
<p>I myself have had trouble with something interfering with (blocking) my download of OpenBSD in the past, no matter where I tried to get it from.  By patient trial and error, I found a mirror that offered a download by https with a self-signed certificate, and that seemed to work.  Then the DSLAM in my area was upgraded, and apparently no more trouble since then &#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251047">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251047">
						June 15, 2015 9:30 PM					</a>

				</p>

				<p>@ Justin</p>
<p>The companies do advertise but only to likely customers. Altran is huge. Green Hills Software is a top embedded company whose marketing gets a bit over the top at times. A lot of companies doing things this way respond to surveys about use of formal methods or low defect processes with interesting results. That&#8217;s only way I knew about them. Most of them do word of mouth, though. That&#8217;s how I did things. Although it reduces advertising costs, the real benefits are these: (a) competitors have a hard time outdoing you while having to carefully fish for details; (b) the impression of exclusivity, quality, and first-class support demand higher prices (and profits). So, it is really a niche market mostly dominated by small businesses with a number of very large firms (esp defense contractors). Yet, it&#8217;s there and happens in real world.</p>
<p>I think their philosophy is something similar to what OpenBSD team taught me. They say they build the software for them and people like them. They don&#8217;t really care about what other people want (esp crud). They build features they need the way they want them built at certain quality, portability, performance, and documentation levels. People that like that and are willing to make sacrifices choose OpenBSD. Likewise, companies willing to pay extra, ask for reasonable features, and move in a reasonable timeframe can get top-tier results from a niche of firms serving such companies. They make so much money doing this that they really don&#8217;t care about the mass market and most are always hiring albeit conservatively.</p>
<p>I hope that makes some sense. I really don&#8217;t have much more thorough as that market is so scattered, isolated, and drowned out by the rest. This is my take from what I&#8217;ve pieced together on the market over the years.</p>
<p>@ Wael</p>
<p>re pointers</p>
<p>There&#8217;s already a formidable barrier between levels with constant bypasses. As Schell &amp; Karger found out, then later Hamilton &amp; Praxis, most of the major errors in problems are interface errors. Components of different domains must interface to get the job done. This leaves plenty potential for problems. It&#8217;s why even MILS had high assurance message engines for inter-partition communication.</p>
<p>Anyway, regarding pointers, they underly the most common things in the system: low-overhead argument passing, buffers, arrays, strings, and compound data structures. There&#8217;s an abuse for every type of these. Coincidentally, the most common abuses are in these areas and others involving pointers. Security enforcement code often relies on correct pointer operation as well. So, protecting pointers is paramount. That capability-security people came up with all kinds of ways of doing this is their best contribution to the field.</p>
<p>re mirrors</p>
<p>&#8220;Just go to different mirrors and make sure the Hash is consistent. Then make sure the hash of the files you downloaded matches.&#8221;</p>
<p>I did that. The even had the same name and hash. Yet, the Windows7Cracked.iso file I downloaded was infected with malware. It was like the attacker tricked a bunch of people into thinking it was real and they just uploaded it in return. üòõ</p>
<p>@ Clive, Wael</p>
<p>The reason I try to ignore anything doing checks for probabilistic security is overhead. Check out how many cycles it takes to hash several bytes (i.e. a register). Assuming you do every register in parallel, that&#8217;s still plenty of cycles. Compare to these:</p>
<p>Tag on pointer &#8211; 1-2 cycles to ensure read-only &amp; bounds-check</p>
<p>Tags on basic datatypes &#8211; around the same (parallel, simple hardware)</p>
<p>Segments &#8211; 2 cycles on Intel Atom</p>
<p>Paging &#8211; 8 cycles very basic MMU check</p>
<p>IBMON-cache control flow protection &#8211; 0.5% worst overhead on top of regular ops</p>
<p>Aegis hashing &#8211; Merkle check in max 160 cycles in hardware for 128-bit memory blocks on 130nm node</p>
<p>SecureMe Hashing &#8211; SHA-1 HMAC at max 80 cycles for 128-bit on 2GHz clock</p>
<p>Cryptopage hashing &#8211; max is 1520 cycles for 19 deep Merkle Tree</p>
<p>As you can see, the strong security methods protecting critical primitives have simple building blocks with low overhead. Every hashing scheme that&#8217;s been bult is anywhere from 10-1000x slower with only probablistic security. That&#8217;s despite all prototypes assuming top-rate performance at processor level while simple things were built on machines with 60&#8217;s-80&#8217;s technology.</p>
<p>So, performance might not be as important as it once was. Yet, it seems a bit much to drop from stong, foundational security mechanisms to probabilistic ones and pay 10x <em>more</em> in overhead. The only time I&#8217;d consider it is for designs where nothing outside SOC is trusted. Then, the crypto and hashing are suddenly necessary. Past that, I think simple designs benefit for widespread application <em>and</em> performance. Even microcontrollers might use one of the top few schemes.</p>
<p>Note: Although I think Clive&#8217;s design is less efficient for endpoints it might <em>more</em> value than most in the cloud model. The measured resource usage, determinism, containment, flexibility, and so on match their needs. His model would also have almost no overhead compared to traditional hypervisors. Might want to look into applying it to those, grid computing, and so on. Could more potential waiting especially on these inherently virtualizable processors popping up.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251048">

			<div class="comment by-clive-robinson ">

				<p class="commentcredit">

					<span class="commenter">Clive Robinson</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251048">
						June 16, 2015 1:17 AM					</a>

				</p>

				<p>@ Nick P, Wael,</p>
<p>The hash I&#8217;m talking about is not a crypto hash, it does not need to be. Further the hashing is only used on the cell &#8220;executable memory&#8221;[1] not the cell memory used for variables or the cell CPU registers as these have to be checked for range not absolute value.</p>
<p>The simple non hash case is, as the hypervisor loads the tasklet into the cell CPU executable memory, it has &#8211;or could have&#8211; a copy of the tasklet in it&#8217;s own memory that it simply does a byte for byte comparison on to perform the executable memory part of the &#8220;cell check&#8221;.</p>
<p>The hash is used for reducing the amount of memory used in the hypervisor for storing and checking the executable memory of the tasklet.</p>
<p>This non crypto hash can be done because the machine code in the cell executable memory is derived from a higher level language and thus contains considerable &#8220;known redundancy&#8221;[2]. What I&#8217;m currently looking at is if it&#8217;s more effective for the hypervisor to be given the high level code &#8211;rather than the executable code&#8211; that it then transcribes into machine code on the fly to be put in the cell executable memory and if the transcribing process will also be fast enough to use to check the cell executable memory, thus reduce the hypervisor memory overhead.</p>
<p>[1] I say &#8220;executable memory&#8221; rather than program memory as it has a more strict interpretation. That is it is static and constant and of a type that could be stored as a ROM image.</p>
<p>[2] The reason it is &#8220;known redundancy&#8221; is two fold, firstly as with any high level to low level transcoding the aim of the higher level language is to provide a known set of functions with minimal coding of the function identifier. This is the idea behind the likes of the P-Code and Java &#8220;byte code&#8221; interpreters / compilers. Secondly the transcoding can be done by replacing each byte code with a set string or set series of strings that contain the CPU machine code. This is a fully determanistic process so will always provide a known translation.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251049">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251049">
						June 16, 2015 3:59 AM					</a>

				</p>

				<p>@Clive Robinson, @Nick P,</p>
<blockquote><p>Further the hashing is only used on the cell &#8220;executable memory&#8221;[1] <b>not the cell memory used for variables or the cell CPU registers</b> as these have to be checked for range not absolute value.</p>
<p>The simple non hash case is, as the hypervisor loads the tasklet into the cell CPU executable memory, it has &#8211;or could have&#8211;<b> a copy of the tasklet in it&#8217;s own memory that it simply does a byte for byte comparison </b>on to perform the executable memory part of the &#8220;cell check&#8221;.</p></blockquote>
<p>Aha! Now that makes sense. Performance is not a concern for me at this point. It can be optimized later &#8230;</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251050">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251050">
						June 16, 2015 11:49 AM					</a>

				</p>

				<p>@Nick P,</p>
<blockquote><p>There&#8217;s already a formidable barrier between levels with constant bypasses. As Schell &amp; Karger found out, then later Hamilton &amp; Praxis, most of the major errors in problems are interface errors. Components of different domains must interface to get the job done. This leaves plenty potential for problems. It&#8217;s why even MILS had high assurance message engines for inter-partition communication.</p></blockquote>
<p>Agreed, but I included the interface in the &#8220;barrier&#8221; so the barrier is still not formidable. I&#8217;m starting to thing that two domains isn&#8217;t sufficient (user mode / kernel mode or supervisor mode.) Most Operating Systems use two rings even if the underlying HW supports more, for example on Intel only <a href="https://en.m.wikipedia.org/wiki/Protection_ring" rel="nofollow ugc">Ring 0 and Ring 3</a> are used. The addition of HW supported virtualization effectively adds another layer of privilege levels, for example on an ARM device with TrustZone extensions, there will be Normal World (which consists of user mode and supervisor mode) and then there is Secure World; more or less a virtualization component with a separate micro kernel, exclusive interrupt bits and other HW capabilities. The interface between SW and NW has some weaknesses, and that leads me to think a few more layers of privilege levels are in order &#8212; something Multics did (8 rings, in the Wiki link above.)</p>
<p>Re pointers, yea, sounds right üôÇ</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251051">

			<div class="comment by-nick-p ">

				<p class="commentcredit">

					<span class="commenter">Nick P</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251051">
						June 16, 2015 12:30 PM					</a>

				</p>

				<p>@ Wael</p>
<p>Yes, the ring model isn&#8217;t good enough. The B3/A1 class systems that used it in the past used all the hardware rings with only security kernel in Ring 0 (see <a href="http://www.cse.psu.edu/~trj1/cse443-s12/docs/ch6.pdf" rel="nofollow ugc">here</a>, esp SCOMP). Most also supplemented rings with segments to enforce more fine-grained protection on memory &amp; storage. My gripe was plenty of code was in Ring 1 and 2 with potential for interface attacks. Breaking that up enough would cause too much overhead on such processors.</p>
<p>The tagged, esp type-safe, systems used type checks at data and function call levels to enforce POLA throughout. They ranged from checking a scalar value that was a type all the way to the types of every argument in a function call. The capability systems used protected pointers (capabilities) for access control. The mechanism was flexible enough to do fine-grained POLA, control flow, MLS, and so on with varying performance tradeoffs. IBM mainframes, PA/RISC, and Itanium have memory keys that restrict which processes access which memory albeit with a low number in hardware cache. A recent category of machines use hardware-supported encryption and hashing to protect a system per memory page.</p>
<p>So, I&#8217;d suggest you ignore the ring model as much as possible in favor of the other models. I mean, use it where you have to for sure. Otherwise, it seems the tagged, capability, stronger CFI, and crypto architectures are showing most promise for fine-grained protection with reasonable performance hit. Work also continues on the popular hypervisor model with interesting work but they&#8217;re all scattered rather than converging. You might be able to use one TrustZone solution for one problem but not the others. Integration is usually easier than solving the hardest design problems, though, so at least they&#8217;re working on the hard stuff. üòâ</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251052">

			<div class="comment by-rodger-dodger ">

				<p class="commentcredit">

					<span class="commenter">Rodger Dodger</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251052">
						June 16, 2015 2:37 PM					</a>

				</p>

				<p>@Hasboo-rah</p>
<blockquote><p>A hearty welcome to the two unctuous newcomers Roger Dodger &amp; anotherJustin! Extra international goodwill for oleaginous flattery and double overtime on the sabbath!&#8217;I do not want to see Israel take much blame here, last thing they need is their foaming at the mouth critics get another morsel.&#8217;</p></blockquote>
<p>Oh, gollee gosh, gee whiz. You got me, you clever man. I admit it, I am actually a Mossad counter-intelligence agent!</p>
<p>Darn it. I just hate it when you supergeniuses blow my cover, which seems to be so very often.</p>
<p>And what a valuable covert operation you just exposed, too! Why, there were millions of dollars invested in this.</p>
<p>Heck, I spent all these years building up an american legend, learning how to speak american, I have an american family (supposedly), who are Protestants (supposedly), work on American soil (true story)&#8230; and here I go and post on some forum somewhere and completely blow my cover, because I am outsmarted by my willingness to engage in a little pro-Israel propaganda!</p>
<p>Gosh all those decades, all those people involved, all that money, all those resources to build up such an extensive, multi-level cover dating back to school times&#8230; and it is all exposed because of some clever armchair wannabe counterintelligence officer on a forum!</p>
<p>Gollee gosh, gee whiz.</p>
<p>If it was not for you guys, I would have gotten away with it too! You really have done your homework!</p>
<p>ROFL.</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251053">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251053">
						June 17, 2015 10:28 PM					</a>

				</p>

				<p>Wael<br />
<i>How else would you get the OS?</i><br />
&#8211;I don&#8217;t know, probably the usual downloading the ISO from a hacked site, on my hacked router and modem, and burn an install disk w/ a program I didn&#8217;t write nor read full source on my infected PC.  All I know is I don&#8217;t trust it from the start and I feel like punching a wall now.</p>
<p>Justin<br />
&#8211;I DO NOT trust plain FTP anymore, this is what I&#8217;m saying.  HTTP, FTP protocols are pretty nice in a fairy land; but not on the internet of today (slowly but surely turning to sh*t).</p>
<p>W // CR // NP // J RE: pointers<br />
&#8211;Came across error message today and started reading on something that I&#8217;ve definitely used just wasn&#8217;t aware of concept; far pointers ( <a href="https://en.wikipedia.org/wiki/Far_pointer" rel="nofollow ugc">https://en.wikipedia.org/wiki/Far_pointer</a> ).  Strikes me as an immediate security threat.  Led to the &#8220;A20 Line&#8221; wiki&#8230; ( <a href="https://en.wikipedia.org/wiki/A20_line" rel="nofollow ugc">https://en.wikipedia.org/wiki/A20_line</a> ), dude fricking security vulnerability or it just feels wrong!</p>
<p><i></p>
<blockquote><p>Referenced the last way, an increase of one in the offset yields F800:8000, which is a proper address for the processor, but since it translates to the physical address 0x00100000 (the first byte over 1 MB) the processor would need another address-line to actually access this byte. Since such a line doesn&#8217;t exist on the 8086 line of processors, the 21st bit above, while set, gets dropped, causing the address F800:8000 to &#8220;wrap around&#8221; and to actually point to the physical address 0x0000000.</p></blockquote>
<p></i></p>
<p>[&#8230;]<br />
<i></p>
<blockquote><p>The 80286 had a bug where it failed to force the A20 line to zero in real mode. Due to this bug, the combination F800:8000 would no longer point to the physical address 0x0000000 but the correct address 0x00100000. As a result some DOS programs would no longer work. In order to remain compatible with these programs, IBM decided to fix the problem on the motherboard.  This was accomplished by inserting a logic gate on the A20 line between the processor and system bus, which got named Gate-A20. Gate-A20 can be enabled or disabled by software to allow or prevent the address bus from receiving a signal from A20. It is set to non-passing for the execution of older programs which rely on the wrap-around. At boot time, the BIOS first enables Gate-A20 when counting and testing all of the system&#8217;s memory, and disables it before transferring control to the operating system.</p></blockquote>
<p></i></p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251054">

			<div class="comment by-wael ">

				<p class="commentcredit">

					<span class="commenter">Wael</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251054">
						June 17, 2015 11:41 PM					</a>

				</p>

				<p>@Figureitout,</p>
<blockquote><p>probably the usual downloading the ISO from a hacked site, on my hacked router and modem, and burn an install disk w/ a program I didn&#8217;t write nor read full source on my infected PC</p></blockquote>
<p>It&#8217;s ok as long as you air gap your platform after OS installation. Good for some use cases, not good for use cases that require connectivity.</p>
<blockquote><p>HTTP, FTP protocols are pretty nice in a fairy land; but not on the internet of today (slowly but surely turning to sh*t).</p></blockquote>
<p>Oh, man! These protocols hit rock bottom long ago, then started digging and struck a crap well üòâ</p>
<p>A20, HIMEM.sys, Expanded memory? Man, you bring back old memories! Get with the times dude! By the way, some of the hardware bugs from this era were useful, and were extensively used üòâ</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251055">

			<div class="comment by-figureitout ">

				<p class="commentcredit">

					<span class="commenter">Figureitout</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251055">
						June 18, 2015 12:42 AM					</a>

				</p>

				<p>Wael<br />
&#8212;<em>Maybe</em> ok, &#8220;fire-and-forget&#8221; malware (the most destructive/worthless) still ruins that.  I&#8217;m planning an airgapped PC as best as I can do (but I still want to transfer files to-an&#8217;-fro&#8217; it via a data diode/guard-ish device; otherwise it&#8217;s worthless (no device is truly &#8220;air-gapped&#8221; these days or ever was anyway, just temporarily &#8220;offline&#8221;)).  It&#8217;s annoying doing stuff on it though!  Like getting firmware source I need and compiling, it was a hot mess what I was doing; eventually it needed to compile w/ my USB stick in! Argh, delete delete.</p>
<p>And I&#8217;m w/ the times, just been looking into making my own bootloader (similar to Truecrypt, locking it before OS boots but adding some personal touches), maybe OS (I&#8217;d just want to add lots of programs, like modified liveCD&#8217;s) for x86 PC&#8217;s.  If things keep getting worse and worse though maybe not (the PC I was going to do it on just died again and I don&#8217;t want to save it lol, got enough PC&#8217;s to save üôÅ ).</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment odd alt thread-odd thread-alt depth-1" id="comment-251056">

			<div class="comment by-leslie-fish ">

				<p class="commentcredit">

					<span class="commenter"><a href='http://lesliebard.blogspot.com' rel='external nofollow ugc' class='url'>Leslie Fish</a></span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251056">
						June 18, 2015 2:41 AM					</a>

				</p>

				<p>Why are you assuming this was an Israeli job?  It sounds more like the sort of work the Saudi government would pay good money for.  The combination of skill and sloppiness doesn&#8217;t sound like Israeli work either, which tends to be very meticulous.  Is this just more of the Arab-inspired assumption of blame the Jews for everything, or is there some <em>real</em> evidence?</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

		<article class="comment even thread-even depth-1" id="comment-251057">

			<div class="comment by-0x98483938 ">

				<p class="commentcredit">

					<span class="commenter">0x98483938</span> ‚Ä¢

					<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/#comment-251057">
						June 26, 2015 12:20 PM					</a>

				</p>

				<p>There are probably dozens of memory corruption vulnerabilities in AV HIPS and file scanner engines. Also, most use keygens to encrypt data under TLS for phoning home, you reverse those you can MITM.</p>
<p>I find it humorous that people think the US government hires a bunch of half-wits for their hardware design and research..</p>
<p>I&#8217;ve assumed they have MMU backdoors and prime and EC methods for years.. Who needs RCE or clownish-logistics hardware and software kits if you have those?</p>
<p>Toshiba is coming out with quantum crypto in 2017.. OTP and air gap till then..</p>

				
			</div>

		</article>

		</li><!-- #comment-## -->

	<p class="subscribe-comments">
		<a href="https://www.schneier.com/blog/archives/2015/06/duqu_20.html/feed/">
			<img alt="Atom Feed" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/rss.png">
			Subscribe to comments on this entry		</a>
	</p>

		<div id="respond" class="comment-respond">
		<h2 class="comments-open-header">Leave a comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="/blog/archives/2015/06/duqu_20.html#respond" style="display:none;">Cancel reply</a></small></h2><form action="https://www.schneier.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><a href="https://www.schneier.com/wp-login.php?redirect_to=https%3A%2F%2Fwww.schneier.com%2Fblog%2Farchives%2F2015%2F06%2Fduqu_20.html" title="Login">Login</a><p class="comment-form-author"><label for="author">Name</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p>
<p class="comment-form-email"><label for="email">Email</label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" /></p>
<p class="comment-form-url"><label for="url">URL:</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Remember personal info?</label></p>

<p class="comment-form-author">

	<label for="comm_capt_challenge">
		Fill in the blank: the name of this blog is Schneier on ___________ (required):	</label>

	<input id="comm_capt_challenge" name="comm_capt_challenge" size="30" type="text" />
</p>

<div class="comment-form-comment">

	<label for="comment">Comments:</label>

	<textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea>

	<div id="preview-box" class="preview-box hide"></div>
	<img class="comment-loading hide" src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/loader.gif" />

</div>

<p id="allowed">

	<strong>Allowed HTML</strong>
	&lt;a href=&quot;URL&quot;&gt; &bull; &lt;em&gt; &lt;cite&gt; &lt;i&gt; &bull; &lt;strong&gt; &lt;b&gt; &bull; &lt;sub&gt; &lt;sup&gt; &bull; &lt;ul&gt; &lt;ol&gt; &lt;li&gt; &bull; &lt;blockquote&gt; &lt;pre&gt;
	<strong>Markdown Extra</strong> syntax via <a href="https://michelf.ca/projects/php-markdown/extra/">https://michelf.ca/projects/php-markdown/extra/</a>
</p>

<input type="hidden" id="wp_comment_nonce" name="wp_comment_nonce" value="4b1534b792" /><input type="hidden" name="_wp_http_referer" value="/blog/archives/2015/06/duqu_20.html" />
<input type="button" id="comment-preview" class="comment-preview comment-actions" value="Preview" />
<input type="button" id="comment-write" class="comment-write comment-actions hide" value="Edit" />

<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Submit" /> <input type='hidden' name='comment_post_ID' value='7095' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p></form>	</div><!-- #respond -->
	
	<div class="stepthrough">
		<a href="https://www.schneier.com/blog/archives/2015/06/security_and_hu_4.html" rel="prev">‚Üê Security and Human Behavior (SHB 2015)</a>		<a href="https://www.schneier.com/blog/archives/2015/06/the_history_of_2.html" rel="next">The History of Internet Insecurity ‚Üí</a>	</div>

	
<p id="powered">Sidebar photo of Bruce Schneier by Joe MacInnis.</p>
		</div>

		
<aside>
	<div class="sidebar" id="sidebar-two">
		<section><div class="sidesection widget widget_schneier_about" id="schneier_about-2"><h3>About Bruce Schneier</h3><img src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2019/10/Bruce-Schneier.jpg" /><p><p class="small">I am a <a href="https://public-interest-tech.com/">public-interest technologist</a>, working at the intersection of security, technology, and people. I've been writing about security issues on my <a href="/">blog</a> since 2004, and in my monthly <a href="/crypto-gram/">newsletter</a> since 1998. I'm a fellow and lecturer at Harvard's <a href="https://www.hks.harvard.edu/faculty/bruce-schneier">Kennedy School</a>, a board member of <a href="https://www.eff.org/">EFF</a>, and the Chief of Security Architecture at <a href="https://inrupt.com/">Inrupt, Inc.</a> This personal website expresses the opinions of none of those organizations.</p>
</p></div></section><section><div class="sidesection widget widget_schneier_related_posts" id="schneier_related_posts-2"><h3>Related Entries</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/archives/2021/03/illegal-content-and-the-blockchain.html">Illegal Content and the Blockchain</a></li><li><a href="https://www.schneier.com/blog/archives/2021/03/national-security-risks-of-late-stage-capitalism.html">National Security Risks of Late-Stage Capitalism</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/weis-2021-call-for-papers.html">WEIS 2021 Call for Papers</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/ransomware-profitability.html">Ransomware Profitability</a></li><li><a href="https://www.schneier.com/blog/archives/2021/02/presidential-cybersecurity-and-pelotons.html">Presidential Cybersecurity and Pelotons</a></li><li><a href="https://www.schneier.com/blog/archives/2021/01/police-have-disrupted-the-emotet-botnet.html">Police Have Disrupted the Emotet Botnet</a></li>
</ul>
</div></section><section><div class="sidesection widget widget_schneier_featured_essays" id="schneier_featured_essays-2"><h3>Featured Essays</h3>
	<ul>
		<li><a href="https://www.schneier.com/essays/archives/2016/04/the_value_of_encrypt.html">The Value of Encryption</a></li><li><a href="https://www.schneier.com/essays/archives/2016/03/data_is_a_toxic_asse.html">Data Is a Toxic Asset, So Why Not Throw It Out?</a></li><li><a href="https://www.schneier.com/essays/archives/2014/01/how_the_nsa_threaten.html">How the NSA Threatens National Security</a></li><li><a href="https://www.schneier.com/essays/archives/2009/01/terrorists_may_use_g.html">Terrorists May Use Google Earth, But Fear Is No Reason to Ban It</a></li><li><a href="https://www.schneier.com/essays/archives/2007/01/in_praise_of_securit.html">In Praise of Security Theater</a></li><li><a href="https://www.schneier.com/essays/archives/2006/08/refuse_to_be_terrori.html">Refuse to be Terrorized</a></li><li><a href="https://www.schneier.com/essays/archives/2006/05/the_eternal_value_of.html">The Eternal Value of Privacy</a></li><li><a href="https://www.schneier.com/essays/archives/2005/09/terrorists_dont_do_m.html">Terrorists Don&#039;t Do Movie Plots</a></li>	</ul>

	<p><a href="https://www.schneier.com/essays/">More Essays</a></p></div></section><section><div class="sidesection widget widget_schneier_archives" id="schneier_archives-2"><h3>Blog Archives</h3>
<ul>

	<li><a href="https://www.schneier.com/blog/calendar.html/">Archive by Month</a></li><li><a href="https://www.schneier.com/blog/newcomments.html/">100 Latest Comments</a></li></ul>

<h4>Blog Tags</h4><ul class="top-tags"><li><a href="https://www.schneier.com/tag/3d-printers/">3d printers</a></li><li><a href="https://www.schneier.com/tag/9-11/">9/11</a></li><li><a href="https://www.schneier.com/tag/aaron-swartz/">Aaron Swartz</a></li><li><a href="https://www.schneier.com/tag/academic/">academic</a></li><li><a href="https://www.schneier.com/tag/academic-papers/">academic papers</a></li><li><a href="https://www.schneier.com/tag/accountability/">accountability</a></li><li><a href="https://www.schneier.com/tag/aclu/">ACLU</a></li><li><a href="https://www.schneier.com/tag/activism/">activism</a></li><li><a href="https://www.schneier.com/tag/adobe/">Adobe</a></li><li><a href="https://www.schneier.com/tag/advanced-persistent-threats/">advanced persistent threats</a></li><li><a href="https://www.schneier.com/tag/adware/">adware</a></li><li><a href="https://www.schneier.com/tag/aes/">AES</a></li><li><a href="https://www.schneier.com/tag/afghanistan/">Afghanistan</a></li><li><a href="https://www.schneier.com/tag/air-marshals/">air marshals</a></li><li><a href="https://www.schneier.com/tag/air-travel/">air travel</a></li><li><a href="https://www.schneier.com/tag/airgaps/">airgaps</a></li><li><a href="https://www.schneier.com/tag/al-qaeda/">al Qaeda</a></li><li><a href="https://www.schneier.com/tag/alarms/">alarms</a></li><li><a href="https://www.schneier.com/tag/algorithms/">algorithms</a></li><li><a href="https://www.schneier.com/tag/alibis/">alibis</a></li><li><a href="https://www.schneier.com/tag/amazon/">Amazon</a></li><li><a href="https://www.schneier.com/tag/android/">Android</a></li><li><a href="https://www.schneier.com/tag/anonymity/">anonymity</a></li><li><a href="https://www.schneier.com/tag/anonymous/">Anonymous</a></li><li><a href="https://www.schneier.com/tag/antivirus/">antivirus</a></li><li><a href="https://www.schneier.com/tag/apache/">Apache</a></li><li><a href="https://www.schneier.com/tag/apple/">Apple</a></li><li><a href="https://www.schneier.com/tag/applied-cryptography/">Applied Cryptography</a></li><li><a href="https://www.schneier.com/tag/artificial-intelligence/">artificial intelligence</a></li><li><a href="https://www.schneier.com/tag/assassinations/">assassinations</a></li></ul><p><a href="https://www.schneier.com/blog/tags.html/">More Tags</a></p></div></section><section><div class="sidesection widget widget_schneier_latest_book" id="schneier_latest_book-3"><h3>Latest Book</h3><a href="https://www.schneier.com/books/click-here/"><img class="sidepic" alt="Click Here to Kill Everybody" src="https://149400697.v2.pressablecdn.com/wp-content/uploads/2018/07/book-ch2-200w.png" /></a><p><a href="https://www.schneier.com/books/">More Books</a></p></div></section><section><div class="sidesection widget widget_schneier_promotion" id="schneier_promotion-2">
<a href="https://www.eff.org/issues/bloggers/legal/join">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/join-eff@2x.png" id="effbutton" alt="Support Bloggers' Rights!" title="Support Bloggers' Rights!" /></a>

<a href="https://npo.networkforgood.org/Donate/Donate.aspx?npoSubscriptionId=8252">
	<img src="https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/images/support-epic@2x.png" alt="Defend Privacy--Support Epic" title="Defend Privacy--Support Epic" /></a>
</div></section>	</div>
</aside>

		<footer>
			<nav>
				<div class="nav" id="footer-nav">
					<div class="menu-main-menu-container"><ul id="menu-main-menu-1" class="menu"><li class="menu1 menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-50175 current-menu-item"><a href="https://www.schneier.com">Blog</a></li>
<li class="menu2 menu-item menu-item-type-post_type menu-item-object-page menu-item-50916"><a href="https://www.schneier.com/crypto-gram/">Newsletter</a></li>
<li class="menu3 menu-item menu-item-type-post_type menu-item-object-page menu-item-50166"><a href="https://www.schneier.com/books/">Books</a></li>
<li class="menu4 menu-item menu-item-type-custom menu-item-object-custom menu-item-50169"><a href="https://www.schneier.com/essays/">Essays</a></li>
<li class="menu5 menu-item menu-item-type-custom menu-item-object-custom menu-item-50170"><a href="https://www.schneier.com/news/">News</a></li>
<li class="menu6 menu-item menu-item-type-custom menu-item-object-custom menu-item-50171"><a href="https://www.schneier.com/talks/">Talks</a></li>
<li class="menu7 menu-item menu-item-type-post_type menu-item-object-page menu-item-50167"><a href="https://www.schneier.com/academic/">Academic</a></li>
<li class="menu8 menu-item menu-item-type-post_type menu-item-object-page menu-item-50174"><a href="https://www.schneier.com/blog/about/">About Me</a></li>
</ul></div>				</div>
			</nav>
		</footer>

		</div><!--#main-->
	</div><!--#wrapper-->

		<script type="text/javascript">
		(function () {
			var c = document.body.className;
			c = c.replace(/woocommerce-no-js/, 'woocommerce-js');
			document.body.className = c;
		})();
	</script>
	<script type='text/javascript' src='https://c0.wp.com/p/woocommerce/5.1.0/assets/js/jquery-cookie/jquery.cookie.min.js' id='jquery-cookie-js'></script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/socialshareprivacy.js?ver=1.0.1' id='social-share-privacy-js'></script>
<script type='text/javascript' id='social-share-privacy-icons-js-extra'>
/* <![CDATA[ */
var schneierSocial = {"path":"https:\/\/www.schneier.com\/wp-content\/themes\/schneier\/assets\/vendor\/socialshareprivacy\/"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/vendor/socialshareprivacy/js/icons.js?ver=1.0.0' id='social-share-privacy-icons-js'></script>
<script type='text/javascript' id='schneier-comment-js-extra'>
/* <![CDATA[ */
var schneierComment = {"translateErrorSecurityAnswerWrong":"Your response to the challenge question ('The name of this blog is Schneier on ____') was not correct. Please try again.","ajax_url":"https:\/\/www.schneier.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://149400697.v2.pressablecdn.com/wp-content/themes/schneier/assets/js/comment.js?ver=1.0.1' id='schneier-comment-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>

</body>

</html>
