<!DOCTYPE html>
<html lang="en">

<head class="sans-serif">

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="baidu-site-verification" content="KeThzeyMOr" />
    <meta name="baidu-site-verification" content="code-NIlrS7gNhx" />

    <title>Minecraft API with Workers + CoffeeScript</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/tippy.js/3.4.1/themes/light.css" />

    <link rel="stylesheet" type="text/css" href="/assets/built/index.css?v=fdf4009e30" />

    <script type="text/javascript" src="/assets/built/index.js?v=fdf4009e30"></script>
    <script src="/assets/js/check-for-tex.js" defer></script>

    <link rel="shortcut icon" href="/favicon.png" type="image/png" />
    <link rel="canonical" href="https://blog.cloudflare.com/minecraft-api-with-workers-coffeescript/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="The Cloudflare Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Minecraft API with Workers + CoffeeScript" />
    <meta property="og:description" content="If you&#x27;ve ever played a video game in the past couple of years, chances are you know about Minecraft. You might be familiar with the game or even planted a tree or two, but what you might not know about is the vast number of Minecraft online communities." />
    <meta property="og:url" content="https://blog.cloudflare.com/minecraft-api-with-workers-coffeescript/" />
    <meta property="og:image" content="https://blog.cloudflare.com/content/images/2018/07/profile2.png" />
    <meta property="article:published_time" content="2018-07-31T08:00:00.000Z" />
    <meta property="article:modified_time" content="2020-08-20T17:57:56.000Z" />
    <meta property="article:tag" content="Cloudflare Workers" />
    <meta property="article:tag" content="Serverless" />
    <meta property="article:tag" content="Developers" />
    <meta property="article:tag" content="Programming" />
    
    <meta property="article:publisher" content="https://www.facebook.com/cloudflare" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Minecraft API with Workers + CoffeeScript" />
    <meta name="twitter:description" content="If you&#x27;ve ever played a video game in the past couple of years, chances are you know about Minecraft. You might be familiar with the game or even planted a tree or two, but what you might not know about is the vast number of Minecraft online communities." />
    <meta name="twitter:url" content="https://blog.cloudflare.com/minecraft-api-with-workers-coffeescript/" />
    <meta name="twitter:image" content="https://blog.cloudflare.com/content/images/2018/07/profile2.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Guest Author" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Cloudflare Workers, Serverless, Developers, Programming" />
    <meta name="twitter:site" content="@cloudflare" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "The Cloudflare Blog",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog-cloudflare-com-assets.storage.googleapis.com/2019/06/logo-cloudflare-dark-1.svg",
            "width": 109,
            "height": 40.5
        }
    },
    "author": {
        "@type": "Person",
        "name": "Guest Author",
        "image": {
            "@type": "ImageObject",
            "url": "https://blog-cloudflare-com-assets.storage.googleapis.com/2019/10/Screen-Shot-2019-10-09-at-11.21.59-AM.png",
            "width": 362,
            "height": 364
        },
        "url": "https://blog.cloudflare.com/author/guest-author/",
        "sameAs": []
    },
    "headline": "Minecraft API with Workers + CoffeeScript",
    "url": "https://blog.cloudflare.com/minecraft-api-with-workers-coffeescript/",
    "datePublished": "2018-07-31T08:00:00.000Z",
    "dateModified": "2020-08-20T17:57:56.000Z",
    "image": "https://blog.cloudflare.com/content/images/2018/07/profile2.png",
    "keywords": "Cloudflare Workers, Serverless, Developers, Programming",
    "description": "If you&#x27;ve ever played a video game in the past couple of years, chances are you know about Minecraft. You might be familiar with the game or even planted a tree or two, but what you might not know about is the vast number of Minecraft online communities. ",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.cloudflare.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.5" />
    <link rel="alternate" type="application/rss+xml" title="The Cloudflare Blog" href="https://blog.cloudflare.com/rss/" />
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','cfDataLayer','GTM-PKQFGQB');</script>
<!-- End Google Tag Manager -->

<!-- Google Optimize -->
<script src="https://www.googleoptimize.com/optimize.js?id=GTM-N4JSZJ8"></script>

<link rel="shortcut icon" href="https://blog.cloudflare.com/content/images/2019/12/favicon-8.png" type="image/png">

<meta name="msvalidate.01" content="CF295E1604697F9CAD18B5A232E871F6" />
<meta class="swiftype" name="language" data-type="string" content="en" />
<!--<script src="/assets/js/index.js"></script>-->
<script type="text/javascript" src="//cdn.bizible.com/scripts/bizible.js" async=""></script>
<script>
var trackRecruitingLink = function(role, url) {
   ga('send', 'event', 'recruiting', 'jobscore-click', role, {
     'transport': 'beacon',
     'hitCallback': function(){document.location = url;}
   });
}
</script> 
<script type="text/javascript">
	(function() {
		var didInit = false;
		function initMunchkin() {
			if(didInit === false) {
				didInit = true;
				Munchkin.init('713-XSC-918');
			}
		}
		var s = document.createElement('script');
		s.type = 'text/javascript';
		s.async = true;
		s.src = '//munchkin.marketo.net/munchkin.js';
		s.onreadystatechange = function() {
			if (this.readyState == 'complete' || this.readyState == 'loaded') {
				initMunchkin();
			}
		};
		s.onload = initMunchkin;
		document.getElementsByTagName('head')[0].appendChild(s);
		})();
</script>
<script>
var HTMLAttrToAdd = document.querySelector("html");
HTMLAttrToAdd.setAttribute("lang", "en");
</script>
<style>
    table {
        background-color: transparent;
    }
    td {
		padding: 5px 1em;
    }
    pre {
        max-height: 500px;
        overflow-y: scroll;
    }
</style>
<!-- Cloudflare Web Analytics -->
<script
        defer
        src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "f446eacb44504e50864bad7c47ffa9e8"}'></script>
<!-- End Cloudflare Web Analytics -->

</head>

<body id="main-body" class="post-template tag-workers tag-serverless tag-developers tag-programming sans-serif">

    <div class="site-wrapper">

        <header class="flex flex-row flex-wrap justify-between items-end mw8 center mv3 pl3 pr2">
    <div class="w-100 flex items-end justify-between justify-start-l">
        <div class="w-100 tr">
            <span class="dn di-l">
                <a href="https://www.cloudflare.com/plans/enterprise/contact/" class="f1 gray4 no-underline underline-hover">Contact Sales:
                </a>
                <a href="tel:+18889935273" class="f1 gray4 no-underline underline-hover">+1 (888) 274-3482</a>
            </span>
        </div>
    </div>
    <div class="w-100 w-50-l flex items-end justify-between justify-start-l">
        <a href="https://blog.cloudflare.com" class="header-logo mr4">
            <img src="https://blog-cloudflare-com-assets.storage.googleapis.com/2019/06/logo-cloudflare-dark-1.svg" alt="The Cloudflare Blog" class="header-logo" />
        </a>
        <h2 class="mt0 mb1">
            <a href="/" class="fw5 f5 gray3 no-underline">
                <span class="dn di-l">The Cloudflare Blog</span>
            </a>
        </h2>
    </div>
    <div class="w-100 w-50-l dn db-l">
        <div class="w-100 tr mkto-sub-message">
            <p class="f2">Thanks for being here, come back soon. Get notified of new posts:</p>
        </div>
        <div class="w-100 tr">
            <script src="//app-ab13.marketo.com/js/forms2/js/forms2.min.js"></script>
            <div class="marketo-form-container">
                <form id="mktoForm_1653"></form>
            </div>
            <script>
                MktoForms2.loadForm("//app-ab13.marketo.com", "713-XSC-918", 1653, function(form) {
                    document.querySelectorAll('#mktoForm_1653 .mktoEmailField')[0].placeholder = "Email Address";

                    form.onSuccess(function(vals, thanksURL){
                        // Hide form and show success msg
                        document.getElementById("mktoForm_1653").style.display = "none";
                        document.getElementsByClassName("mkto-sub-message")[0].style.display = "none";

                        document.getElementsByClassName("js-form-success-msg")[0].style.display = "block";
                        return false;
                    });
                });
            </script>
        </div>
        <div class="w-100 tr dn js-form-success-msg">
            <p class="f2">Subscription confirmed. Thank you for subscribing!</p>
        </div>
    </div>
</header>

<nav id="nav" class="w-100 bb b--black-10 z-1">
    <div id="desktop-nav-items-container" class="flex flex-row flex-wrap justify-between items-center mw8 center mv3 mv0-l">
        <div class="nav-item nav-item-desktop ml3 mr2 dn db-l pv3" data-tag="product-news">
            <a href="/tag/product-news/" class="no-underline gray1 f2 fw5 pv3">Product News</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="speed-and-reliability">
            <a href="/tag/speed-and-reliability/" class="no-underline gray1 f2 fw5 pv3">Speed &amp; Reliability</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="security">
            <a href="/tag/security/" class="no-underline gray1 f2 fw5 pv3">Security</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="serverless">
            <a href="/tag/serverless/" class="no-underline gray1 f2 fw5 pv3">Serverless</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="cloudflare-network">
            <a href="/tag/cloudflare-network/" class="no-underline gray1 f2 fw5 pv3">Cloudflare Network</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="developers">
            <a href="/tag/developers/" class="no-underline gray1 f2 fw5 pv3">Developers</a>
        </div>
        <div class="nav-item nav-item-desktop mh2 dn db-l pv3" data-tag="deep-dive">
            <a href="/tag/deep-dive/" class="no-underline gray1 f2 fw5 pv3">Deep Dive</a>
        </div>
        <div class="nav-item nav-item-desktop ml2 mr3 dn db-l pv3" data-tag="life-at-cloudflare">
            <a href="/tag/life-at-cloudflare/" class="no-underline gray1 f2 fw5 pv3">Life @Cloudflare</a>
        </div>
        <a href="/search/"><img src="/assets/images/magnifier.svg?v=fdf4009e30" class="js-search-box-trigger mw2 pointer ph3 ph2-l" />
        </a>
        <img src="/assets/images/hamburger.svg?v=fdf4009e30" class="w2 pointer js-mobile-nav-trigger ph3 db dn-l" />
    </div>

    <div class="js-mobile-nav-container dn">
        <div class="flex flex-column flex-wrap bg-gray9 o-95 absolute w-100 ph3 z-1">
            <div class="pv3 ph2">
                <a href="/tag/product-news/" class="no-underline gray1 f4 fw7">Product News</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/speed-and-reliability/" class="no-underline gray1 f4 fw7">Speed &amp; Reliability</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/security/" class="no-underline gray1 f4 fw7">Security</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/serverless/" class="no-underline gray1 f4 fw7">Serverless</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/cloudflare-network/" class="no-underline gray1 f4 fw7">Cloudflare Network</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/developers/" class="no-underline gray1 f4 fw7">Developers</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/deep-dive/" class="no-underline gray1 f4 fw7">Deep Dive</a>
            </div>
            <div class="pv3 ph2">
                <a href="/tag/life-at-cloudflare/" class="no-underline gray1 f4 fw7">Life @Cloudflare</a>
            </div>
        </div>
    </div>
</nav>
        


<main id="post" class="flex flex-row flex-wrap items-center justify-center pt2 pt4-l">
    <article
        class="post-full mw-100 ph3 ph0-l fs-20px post tag-workers tag-serverless tag-developers tag-programming ">
        <h1 class="f6 f7-l fw4 gray1 pt1 pt3-l mb1">Minecraft API with Workers + CoffeeScript</h1>


        <p class="f3 fw5 gray5 db di-l mt2" localize datetime="2018-07-31T09:00:00+01:00">Loading...</p>
        <noscript>
            <p class="f3 fw5 gray5 db di-l mt2">July 31, 2018 9:00AM</p>
        </noscript>

        <ul class="flex flex-wrap pl0 mt4">
            <li class="list flex items-center ml0 pl0 pb1">
                <a href="/author/guest-author/" class="static-avatar pr1">
                    <img class="author-profile-image h2 w2 br-100 mr2" src="https://blog-cloudflare-com-assets.storage.googleapis.com/2019/10/Screen-Shot-2019-10-09-at-11.21.59-AM.png" alt="Guest Author" />
                </a>
                <div class="author-name-tooltip">
                    <a href="/author/guest-author" class="fw5 f3 no-underline black mr3">Guest Author</a>
                </div>
            </li>
        </ul>

        <section class="post-full-content">
            <div class="post-content lh-copy gray1">
                <!--kg-card-begin: markdown--><p><em>The following is a guest post by <a href="https://ashcon.app">Ashcon Partovi</a>, a computer science and business undergraduate at the University of British Columbia in Vancouver, Canada. He's the founder of a popular Minecraft multiplayer server, <a href="https://stratus.network/forums">stratus.network</a>, that provides competitive, team-based gameplay to thousands of players every week</em></p>
<p>If you've ever played a video game in the past couple of years, chances are you know about <a href="https://en.wikipedia.org/wiki/Minecraft"><em>Minecraft</em>.</a> You might be familiar with the game or even planted a tree or two, but what you might not know about is the vast number of <em>Minecraft</em> online communities. In this post, I'm going to describe how I used Cloudflare Workers to deploy and scale a production-grade API that solves a big problem for these <em>Minecraft</em> websites.</p>
<h3 id="introducingtheproblem">Introducing the Problem</h3>
<p>Here is an example of my <em>Minecraft</em> <a href="https://stratus.network/ElectroidFilms">player profile</a> from one of the many multiplayer websites. It shows some identity information such as my username, a bitmap of my avatar, and a preview of my friends. Although rendering this page with 49 bitmap avatars may seem like an easy task, it's far from trivial. In fact, it's unnecessarily complicated.</p>
<p>Here is the current workflow to render a player profile on a website given their username:</p>
<ol>
<li>Find the UUID from the player's username.</li>
</ol>
<pre><code>curl api.mojang.com/users/profiles/minecraft/ElectroidFilms
{
    &quot;id&quot;: &quot;dad8b95ccf6a44df982e8c8dd70201e0&quot;,
    &quot;name&quot;: &quot;ElectroidFilms&quot;
}
</code></pre>
<ol start="2">
<li>Use that UUID to fetch the latest player information from the session server.</li>
</ol>
<pre><code>curl sessionserver.mojang.com/session/minecraft/profile/dad8b95cc...
{
    &quot;id&quot;: &quot;dad8b95ccf6a44df982e8c8dd70201e0&quot;,
    &quot;name&quot;: &quot;ElectroidFilms&quot;,
    &quot;properties&quot;: [{
      &quot;name&quot;: &quot;textures&quot;,
      &quot;value&quot;: &quot;eyJ0aW1lc3RhbXAiOjE1MzI1MDI...&quot; // &lt;base64&gt;
    }]
}
</code></pre>
<ol start="3">
<li>Decode the textures string which is encoded as base64.</li>
</ol>
<pre><code>echo &quot;eyJ0aW1lc3RhbXAiOjE1MzI1MDIwNDY5NjIsIn...&quot; | base64 --decode
{
    &quot;timestamp&quot;: 1532502046962,
    &quot;profileId&quot;: &quot;dad8b95ccf6a44df982e8c8dd70201e0&quot;,
    &quot;profileName&quot;: &quot;ElectroidFilms&quot;,
    &quot;textures&quot;: {
      &quot;SKIN&quot;: {&quot;url&quot;: &quot;textures.minecraft.net/texture/741df6aa0...&quot;},
      &quot;CAPE&quot;: {&quot;url&quot;: &quot;textures.minecraft.net/texture/e7dfea16d...&quot;}
    }
}
</code></pre>
<ol start="4">
<li>Fetch the texture from the URL in the decoded JSON payload.</li>
</ol>
<pre><code>curl textures.minecraft.net/texture/741df6aa027... &gt; skin.png
</code></pre>
<ol start="5">
<li>Cache the texture in a database to avoid the 60-second rate limit.</li>
</ol>
<pre><code>mongo
&gt; db.users.findOneAndUpdate(
      { _id: &quot;dad8b95ccf6a44df982e8c8dd70201e0&quot; },
      { skin_png: new BinData(0, &quot;GWA3u4F42GIH318sAlN2wfDAWTQ...&quot;) })
</code></pre>
<p>Yikes, that's 5 complex operations required to render a single avatar! But that's not all, in my example profile, there are 49 avatars, which would require a total of <code>5 * 49 = 245</code> operations.</p>
<p>And that's just <em>fetching</em> the data, we haven't even started to serve it to players! Then you have to setup a host to serve the web traffic, ensure that the service scales with demand, handle cache expiration of assets, and deploy across multiple regions. Then you have to deploy There has to be a better way!</p>
<h3 id="prototypingwithworkers">Prototyping with Workers</h3>
<p>I'm a strong believer in the future of serverless computing. So naturally, when I learned how <a href="https://developers.cloudflare.com/workers/about/">Cloudflare Workers</a> allow you to run JavaScript code in 150+ points of presence, I started to tinker with the possibilities of solving this problem. After looking at the documentation and using the <a href="https://cloudflareworkers.com">Workers playground</a>, I quickly put together some JavaScript code that aggregated all that profile complexity into a single request.</p>
<pre><code class="language-javascript">addEventListener('fetch', event =&gt; {
  event.respondWith(renderPlayerBitmap(event.request))
})

async function renderPlayerBitmap(request) {
  var username = request.url.split(&quot;/&quot;).pop()
  console.log(&quot;Starting request for... &quot; + username)

  // Step 1: Username -&gt; UUID
  var uuid = await fetch(&quot;https://api.mojang.com/users/profiles/minecraft/&quot; + username)
  if(uuid.ok) {
    uuid = (await uuid.json()).id
    console.log(&quot;Found uuid... &quot; + uuid)

    // Step 2: UUID -&gt; Profile
    var session = await fetch(&quot;https://sessionserver.mojang.com/session/minecraft/profile/&quot; + uuid)
    if(session.ok) {
      session = await session.json()
      console.log(&quot;Found session... &quot; + JSON.stringify(session))

      // Step 3: Profile -&gt; Texture URL
      var texture = atob(session.properties[0].value)
      console.log(&quot;Found texture... &quot; + texture)

      // Step 4 + 5: Texture URL -&gt; Texture PNG + Caching
      texture = JSON.parse(texture)
      return fetch(texture.textures.SKIN.url, cf: {cacheTtl: 60})
    }
  }

  return new Response(undefined, {status: 500})
}

</code></pre>
<p>Within a couple minutes I had my first Workers implementation! I gave it my username and it was able to make all the necessary sub-requests to return my player's bitmap texture.</p>
<p><img src="https://ashcon.nyc3.digitaloceanspaces.com/blog/worker_playground.png" alt="worker_playground"></p>
<p>After realizing the potential of Workers, I started to wonder if I could use it for more than just a single script. What if I could design and deploy a production-ready API for <em>Minecraft</em> that runs exclusively on Workers?</p>
<h3 id="designinganapi">Designing an API</h3>
<p>I wanted to address an essential problem for <em>Minecraft</em> developers: too many APIs with too many restrictions. The hassle of parsing multiple requests and handling errors prevents developers from focusing on creating great experiences for players. There needs to be a solution that requires only <strong>1 HTTP request with no rate limiting and no client-side caching.</strong> After looking at the various use-cases for the existing APIs, I created a JSON schema that encompassed all the essential data into a single response:</p>
<pre><code>GET: api.ashcon.app/mojang/v1/user/&lt;username|uuid&gt;
</code></pre>
<pre><code class="language-json">{
  &quot;uuid&quot;: &quot;&lt;uuid&gt;&quot;,
  &quot;username&quot;: &quot;&lt;username&gt;&quot;,
  &quot;username_history&quot;: [
    {
      &quot;username&quot;: &quot;&lt;username&gt;&quot;,
      &quot;changed_at&quot;: &quot;&lt;date|null&gt;&quot;
    }
  ],
  &quot;textures&quot;: {
    &quot;slim&quot;: &quot;&lt;boolean&gt;&quot;,
    &quot;custom&quot;: &quot;&lt;boolean&gt;&quot;,
    &quot;skin&quot;: {
      &quot;url&quot;: &quot;&lt;url&gt;&quot;,
      &quot;data&quot;: &quot;&lt;base64&gt;&quot;
    },
    &quot;cape&quot;: {
      &quot;url&quot;: &quot;&lt;url|null&gt;&quot;,
      &quot;data&quot;: &quot;&lt;base64|null&gt;&quot;
    }
  },
  &quot;cached_at&quot;: &quot;&lt;date&gt;&quot;
}
</code></pre>
<p>One of the primary goals I had in mind was to minimize sub-requests by clients. For example, instead of giving developers a URL to a <code>image/png</code> static asset, why not fetch it for them and embed it as a base64 string? Now that's simplicity!</p>
<h3 id="gettingstarted">Getting Started</h3>
<p>For this project, I decided to use <a href="https://coffeescript.org">CoffeeScript</a>, which transcompiles to JavaScript and has a simple syntax. We'll also need to use <a href="https://webpack.js.org">Webpack</a> to bundle all of our code into a single JavaScript file to upload to Cloudflare.</p>
<pre><code class="language-coffeescript"># Welcome to CoffeeScript!

str = &quot;heyo! #{40+2}&quot;    # 'heyo! 42'
num = 12 if str?         # 12
arr = [1, null, &quot;apple&quot;] # [1, null, 'apple']
val = arr[1]?.length()   # null
hash =                   # {key: 'value'}
  key: &quot;value&quot;

add = (a, b, {c, d} = {}) -&gt;
  c ?= 3
  d ?= 4
  a + b + c + d

add(1, 2, d: 5) # 1 + 2 + 3 + 5 = 11
</code></pre>
<p>First, let's make sure we have the proper dependencies installed for the project! These commands will create a <code>package.json</code> file and a <code>node_modules/</code> folder in our workspace.</p>
<pre><code>mkdir -p workspace/src
cd workspace
npm init --yes
npm install --save-dev webpack webpack-cli coffeescript coffee-loader workers-preview
</code></pre>
<p>Now, we're going to edit our <code>package.json</code> to add two helper scripts for later. You can delete the default <code>&quot;test&quot;</code> script as well.</p>
<pre><code class="language-json">&quot;scripts&quot;: {
  &quot;build&quot;: &quot;webpack&quot;,
  &quot;build:watch&quot;: &quot;webpack --watch&quot;,
  &quot;preview&quot;: &quot;workers-preview &lt; dist/bundle.js&quot;
}
</code></pre>
<p>We also need to initialize a <code>webpack.config.js</code> file with a CoffeeScript compiler.</p>
<pre><code class="language-javascript">const path = require('path')

module.exports = {
  entry: {
    bundle: path.join(__dirname, './src/index.coffee'),
  },
  output: {
    filename: 'bundle.js',
    path: path.join(__dirname, 'dist'),
  },
  mode: 'production',
  watchOptions: {
    ignored: /node_modules|dist|\.js/g,
  },
  resolve: {
    extensions: ['.coffee', '.js', '.json'],
    plugins: [],
  },
  module: {
    rules: [
      {
        test: /\.coffee?$/,
        loader: 'coffee-loader',
      }
    ]
  }
}
</code></pre>
<p>Before we start coding, we'll create a <code>src/index.coffee</code> file and make sure everything is working so far.</p>
<pre><code class="language-coffeescript">addEventListener('fetch', (event) -&gt;
  event.respondWith(route(event.request)))

# We will populate this with our own logic after we test it!
route = (request) -&gt;
  fetch('https://api.ashcon.app/mojang/v1/user/ElectroidFilms')
</code></pre>
<p>Open your terminal in the <code>workspace/</code> directory and run the following commands:</p>
<pre><code>npm run build
npm run preview
</code></pre>
<p>Your computer's default internet browser will open up a new window and preview the result of our Worker. If you see a JSON response, then everything is working properly and we're ready to go!</p>
<p><img src="https://ashcon.nyc3.digitaloceanspaces.com/blog/worker_example.png" alt="worker_example"></p>
<h3 id="writingproductioncodeforworkers">Writing Production Code for Workers</h3>
<p>Now that we're setup with a working example, we can design our source code file structure. It's important that we break up our code into easily testable chunks, so I've gone ahead and outlined the approach that I took with this project:</p>
<pre><code>src/
  index.coffee  # routing and serving requests
  api.coffee    # logic layer to mutate and package requests
  mojang.coffee # non-logic layer to send upstream requests
  http.coffee   # HTTP requesting, parsing, and responding
  util.coffee   # util methods and extensions
</code></pre>
<p>If you've feeling adventurous, I've included a simplified version of my API code that you can browse through below. If you look at each file, you'll have a fully working implementation by the end! Otherwise, you can continue reading to learn about my deployment and analysis of the APIs impact.</p>
<h4 id="httpcoffee"><code>http.coffee</code></h4>
<p>Since our API will be making several HTTP requests, it's a good idea to code some common <code>request</code> and <code>respond</code> methods that can be reused among multiple requests. At the very least, we need to support parsing JSON or base64 responses and sending JSON or string data back to the client.</p>
<pre><code class="language-coffeescript"># Send a Http request and get a response.
#
# @param {string} url - Url to send the request.
# @param {string} method - Http method (get, post, etc).
# @param {integer} ttl - Time in seconds for Cloudflare to cache the request.
# @param {boolean} json - Whether to parse the response as json.
# @param {boolean} base64 - Whether to parse the response as a base64 string.
# @returns {promise&lt;
#   json -&gt; [err, json]
#   base64 -&gt; string|null
#   else -&gt; response
# &gt;} - A different response based on the method parameters above.
export request = (url, {method, ttl, json, base64} = {}) -&gt;
  method ?= &quot;GET&quot;
  response = await fetch(url, method: method, cf: {cacheTtl: ttl} if ttl)
  if json # Return a tuple of [err, json].
    if err = coerce(response.status)
      [err, null]
    else
      [null, await response.json()]
  else if base64 # Return base64 string or null.
    if response.ok
      Buffer.from(await response.arrayBuffer(), &quot;binary&quot;).toString(&quot;base64&quot;)
  else # If no parser is specified, just return the raw response.
    response

export get = (url, options = {}) -&gt;
  request(url, Object.assign(options, {method: &quot;GET&quot;}))

# Respond to a client with a http response.
#
# @param {object} data - Data to send back in the response.
# @param {integer} code - Http status code.
# @param {string} type - Http content type.
# @param {boolean} json - Whether to respond in json.
# @param {boolean} text - Whether to respond in plain text.
# @returns {response} - Raw response object.
export respond = (data, {code, type, json, text} = {}) -&gt;
  code ?= 200
  if json
    type = &quot;application/json&quot;
    # &quot;Pretty-print&quot; our JSON response with 2 spaces.
    data = JSON.stringify(data, undefined, 2)
  else if text
    type = &quot;text/plain&quot;
    data = String(data)
  else
    type ?= &quot;application/octet-stream&quot;
  new Response(data, {status: code, headers: {&quot;Content-Type&quot;: type}})

export error = (reason = null, {code, type} = {}) -&gt;
  code ?= 500
  type ?= &quot;Internal Error&quot;
  # An example would be: &quot;Internal Error - 500 (this is the reason)&quot;
  respond(&quot;#{code} - #{type}&quot; + (if reason then &quot; (#{reason})&quot; else &quot;&quot;), code: code, text: true)

export badRequest = (reason = null) -&gt;
  error(reason, code: 400, type: &quot;Bad Request&quot;)

export notFound = (reason = null) -&gt;
  error(reason, code: 404, type: &quot;Not Found&quot;)

export tooManyRequests = (reason = null) -&gt;
  error(reason, code: 429, type: &quot;Too Many Requests&quot;)

# Convert common http error codes into error responses.
#
# @param {integer} code - Http status code.
# @returns {response|null} - An error response or null if a 200 code.
export coerce = (code) -&gt;
  switch code
    when 200 then null
    # Some Minecraft APIs use 204 as a stand-in for a 404.
    when 204 then notFound()
    when 400 then invalidRequest()
    # Theoretically this should never happen, but sometimes does.
    when 429 then tooManyRequests()
    else error(&quot;Unknown Response&quot;, code: code)
</code></pre>
<p>The <code>cf</code> key can be used to control various Cloudflare features, including how sub-requests are cached. See the <a href="https://developers.cloudflare.com/workers/reference/cloudflare-features/">Workers documentation</a> for a more in-depth explanation.</p>
<pre><code class="language-coffeescript">cf:
  cacheTtl: 120 # Cache for 2 mins.
  # Pro+ only.
  polish: &quot;lossless&quot; # Compress image data.
  # Enterprise only.
  cacheTtlByStatus:
    &quot;200-299&quot;: 60 # Cache for 60 secs.
    &quot;300-399&quot;: 0  # Cache but expire instantly.
    &quot;400-404&quot;: 10 # Cache for 10 secs.
    &quot;405-599&quot;: -1 # Do not cache at all.
  cacheKey: url # Cache lookup key, defaults to the request URL.
</code></pre>
<h4 id="mojangcoffee"><code>mojang.coffee</code></h4>
<p>Now that we have code to send and parse requests, we can create an interface to retrieve data from the upstream APIs. It's good to note that there should be no mutation logic in this file, it's purpose is just to get the old APIs, not change them.</p>
<pre><code class="language-coffeescript">import { get } from &quot;./http&quot;

# Get the UUID of a username at the current time.
#
# @param {string} name - Minecraft username.
# @throws {204} - When no user exists with that name.
# @returns {[err, json]} - An error or username and UUID response.
export usernameToUuid = (name) -&gt;
  get(&quot;https://api.mojang.com/users/profiles/minecraft/#{name}&quot;, json: true)

# Get the history of usernames for the given UUID.
#
# @param {string} id - The UUID to check the username history.
# @returns {[err, json]} - An error or the username history.
export uuidToUsernameHistory = (id) -&gt;
  get(&quot;https://api.mojang.com/user/profiles/#{id}/names&quot;, json: true)

# Get the session profile of the UUID.
#
# @param {string} id - UUID to get the session profile.
# @returns {[err, json]} - An error or the session profile.
export uuidToProfile = (id) -&gt;
  get(&quot;https://sessionserver.mojang.com/session/minecraft/profile/#{id}&quot;, json: true)
</code></pre>
<h4 id="apicoffee"><code>api.coffee</code></h4>
<p>This is where the bulk of our API logic will reside. I've broken up the process into 3 interdependent tasks that are executed in order:</p>
<ol>
<li>Given a username, fetch its UUID.</li>
<li>Given a UUID, fetch the user's profile.</li>
<li>Given a user's profile, decode and fetch the textures.</li>
</ol>
<pre><code class="language-coffeescript">import { get, respond, error, notFound, badRequest } from &quot;./http&quot;
import { usernameToUuid, uuidToProfile, uuidToUsernameHistory } from &quot;./mojang&quot;

# Get the uuid of a user given their username.
#
# @param {string} name - Minecraft username, must be alphanumeric 16 characters.
# @returns {[err, response]} - An error or the dashed uuid of the user.
export uuid = (name) -&gt;
  if name.asUsername() # Fits regex of a Minecraft username.
    [err, res] = await usernameToUuid(name)
    if id = res?.id?.asUuid(dashed: true)
      [null, respond(id, text: true)]
    else # Response was received, but contains no UUID.
      [err || notFound(), null]
  else
    [badRequest(&quot;malformed username '#{name}'&quot;), null]

# Get the full profile of a user given their uuid or username.
#
# @param {string} id - Minecraft username or uuid.
# @returns {[err, json]} - An error or user profile.
export user = (id) -&gt;
  if id.asUsername()
    [err, res] = await uuid(id)
    if err # Could not find a player with that username.
      [err, null]
    else # Recurse with the new UUID.
      await user(id = await res.text())
  else if id.asUuid()
    # Fetch the profile and usernames in parallel.
    [[err0, profile], [err1, history]] = await Promise.all([
      uuidToProfile(id = id.asUuid())
      uuidToUsernameHistory(id)])
    # Extract the textures from the profile.
    # Since this operation is complex, off-load
    # the logic into its own method.
    [err2, texture] = await textures(profile)
    if err = err0 || err1 || err2
      [err, null] # One of the last three operations failed.
    else
      # Everything is good, now just put the data together.
      [null, respond(
        uuid: profile.id.asUuid(dashed: true)
        username: profile.name
        username_history: history.map((item) -&gt;
          username: item.name
          changed_at: item.changedToAt?.asDate())
        textures: texture
        cached_at: new Date(),
      json: true)]
  else
    [badRequest(&quot;malformed uuid '#{id}'&quot;), null]

# Parse and decode base64 textures from the user profile.
#
# @param {json} profile - User profile from #uuidToProfile(id).
# @returns {json} - Enhanced user profile with more convient texture fields.
textures = (profile) -&gt;
  unless profile # Will occur if the profile api failed.
    return [error(&quot;no user profile found&quot;), null]
  properties = profile.properties
  if properties.length == 1
    texture = properties[0]
  else
    texture = properties.filter((pair) -&gt; pair.name == &quot;textures&quot; &amp;&amp; pair.value?)[0]
  # If a embedded texture does not exist or is empty,
  # that user does not have a custom skin.
  if !texture || (texture = JSON.parse(atob(texture.value)).textures).isEmpty()
    skinUrl = &quot;http://assets.mojang.com/SkinTemplates/steve.png&quot;
  # Fetch the skin and cape data in parallel, and cache for a day.
  [skin, cape] = await Promise.all([
    get(skinUrl ?= texture.SKIN?.url, base64: true, ttl: 86400)
    get(capeUrl = texture.CAPE?.url, base64: true, ttl: 86400)])
  unless skin
    [error(&quot;unable to fetch skin '#{skinUrl}'&quot;), null]
  else
    texture =
      slim: texture.SKIN?.metadata?.model == &quot;slim&quot;
      skin: {url: skinUrl, data: skin}
      cape: {url: capeUrl, data: cape} if capeUrl
    [null, texture]
</code></pre>
<h4 id="indexcoffee"><code>index.coffee</code></h4>
<p>Now, we parse the request's route and respond with the corresponding API.</p>
<pre><code class="language-coffeescript">import &quot;./util&quot;
import { notFound } from &quot;./http&quot;
import { uuid, user } from &quot;./api&quot;

addEventListener(&quot;fetch&quot;, (event) -&gt;
  event.respondWith(route(event.request)))

route = (request) -&gt;
  [base, version, method, id] = request.url.split(&quot;/&quot;)[3..6]
  if base == &quot;mojang&quot; &amp;&amp; id?
    if version == &quot;v1&quot;
      v1(method, id)
    else
      notFound(&quot;unknown api version '#{version}'&quot;)
  else
    notFound(&quot;unknown route&quot;)

v1 = (method, id) -&gt;
  if method == &quot;uuid&quot;
    [err, res] = await uuid(id)
  else if method == &quot;user&quot;
    [err, res] = await user(id)
  err || res || notFound(&quot;unknown v1 route '#{method}'&quot;)
</code></pre>
<h4 id="utilcoffee"><code>util.coffee</code></h4>
<p>Finally, we'll add some prototype extensions that we used along the way.</p>
<pre><code class="language-coffeescript"># Insert a string at a given index.
#
# @param {integer} i - Index to insert the string at.
# @param {string} str - String to insert.
String::insert = (i, str) -&gt;
  this.slice(0, i) + str + this.slice(i)

# Ensure that the string is a valid Uuid.
#
# If dashed is enabled, it is possible the input
# string is not the same as the output string.
#
# @param {boolean} dashed - Whether to return a dashed uuid.
# @returns {string|null} - A uuid or null.
String::asUuid = ({dashed} = {}) -&gt;
  if match = uuidPattern.exec(this)
    uuid = match[1..].join(&quot;&quot;)
    if dashed
      uuid.insert(8, &quot;-&quot;)
          .insert(12+1, &quot;-&quot;)
          .insert(16+2, &quot;-&quot;)
          .insert(20+3, &quot;-&quot;)
    else
      uuid
uuidPattern = /^([0-9a-f]{8})(?:-|)([0-9a-f]{4})(?:-|)(4[0-9a-f]{3})(?:-|)([0-9a-f]{4})(?:-|)([0-9a-f]{12})$/i

# Ensure that the string is a valid Minecraft username.
#
# @returns {string|null} - Minecraft username or null.
String::asUsername = -&gt;
  if usernamePattern.test(this) then this else false
usernamePattern = /^[0-9A-Za-z_]{1,16}$/i

# Ensure that the unix number is a Date.
#
# @returns {date} - The number as a floored date.
Number::asDate = -&gt;
  new Date(Math.floor(this))

# Determine if the object is empty.
#
# @returns {boolean} - Whether the object is empty.
Object::isEmpty = -&gt;
  Object.keys(this).length == 0
</code></pre>
<h3 id="analyzingaworkersdeployment">Analyzing a Workers Deployment</h3>
<p>I've had this code deployed and tested by real <em>Minecraft</em> users for the past few weeks. As a developer that has global web traffic, it's pivotal that players can quickly get access to my services. The essential advantage of Workers is that I don't need to deploy several replicas of my code to different cloud regions, it's everywhere! That means players from any part of the world get the same great web experience with minimal latency.</p>
<p><img src="https://ashcon.nyc3.digitaloceanspaces.com/blog/worker_world_dns.png" alt="worker_world_dns"></p>
<p>As of today, the API is processing over <strong>400k requests per day</strong> from users all over the world! Cloudflare caches responses in the closest point of presence to the client, so I don't need to setup a database and developers don't need to worry about rate-limiting.</p>
<p><img src="https://ashcon.nyc3.digitaloceanspaces.com/blog/worker_success.png" alt="worker_success"></p>
<p>Since each request to the API generates 4 to 5 additional sub-requests, it handles approximately <strong>1.8 million fetches per day</strong> with a 88% cache hit rate.</p>
<p><img src="https://ashcon.nyc3.digitaloceanspaces.com/blog/worker_requests.png" alt="worker_requests"></p>
<h3 id="wrappingup">Wrapping Up</h3>
<p>Cloudflare Workers have enabled me to solve complex technical problems without worrying about host infrastructure or cloud regions. It's simple, easy to deploy, and works blazing fast all around the world. And for <strong>50 cents for every 1 million requests</strong>, it's incomparable to the other serverless solutions on the market.</p>
<p>If you're not already convinced to start using Workers, here's the deployment history of my API. I went from <strong>0 to 5 million requests</strong> with no scaling, no resizing, no servers, no clusters, and no containers. Just code.</p>
<p><img src="https://ashcon.nyc3.digitaloceanspaces.com/blog/worker_progress.png" alt="worker_progress"></p>
<p>If you're interested in looking at all of the code used in the post, you can find it here:<br><a href="https://github.com/Electroid/mojang-api">https://github.com/Electroid/mojang-api</a></p>
<p>And if you're a <em>Minecraft</em> developer, my API is open for you to use for free:</p>
<pre><code>curl https://api.ashcon.app/mojang/v1/uuid/ElectroidFilms
curl https://api.ashcon.app/mojang/v1/user/ElectroidFilms
</code></pre>
<p>You can also use this <a href="https://github.com/Electroid/mojang-api/tree/master/avatar">extra goodie</a> that will crop just the face from a player texture:</p>
<pre><code>curl https://api.ashcon.app/mojang/v1/avatar/ElectroidFilms &gt; avatar.png
open avatar.png
</code></pre>
<!--kg-card-end: markdown-->
            </div>
        </section>

        <a href="/tag/workers/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2">Cloudflare Workers</a>
        <a href="/tag/serverless/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2">Serverless</a>
        <a href="/tag/developers/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2">Developers</a>
        <a href="/tag/programming/" class="dib pl2 pr2 pt1 pb1 mb2 bg-gray8 no-underline blue3 f2">Programming</a>
    </article>
</main>

<div class="pv4 flex flex-row flex-wrap mw7 center">
    <div class="w-100 ph3 bt b--gray8">
        <p class="orange fw5 f4 mt4 ttu">Related Posts</p>
    </div>

    <article class="w-100 w-100-m w-50-l ph3 mb4">
        <p class="f3 fw5 gray5" data-iso-date="2021-03-20T12:00:00Z">March 20, 2021 12:00PM</p>
        <a href="/random-employee-chats-cloudflare/" class="no-underline gray1 f4 fw5">
            <h2 class="gray1 f4 fw5 mt2">Random Employee Chats at Cloudflare</h2>
        </a>

        <p class="gray1 lh-copy">We developed the Random Employee Chats application internally, with the goal of recreating the pre-pandemic informal interactions. Here's how we moved from a shared spreadsheet to Cloudflare Workers to automate the entire process....</p>
        <ul class="flex pl0 fw6 f2">
            <span>By&nbsp;</span>
            <li class="list flex items-center">
                <div class="author-name-tooltip">
                    
                    <a href="/author/sven/" class="fw5 f2 black no-underline">Sven Sauleau</a>
                </div>
            </li>
            <li class="list flex items-center">
                <div class="author-name-tooltip">
                    <span class="fw5 f2 black no-underline">,&nbsp;</span>
                    <a href="/author/david-wragg/" class="fw5 f2 black no-underline">David Wragg</a>
                </div>
            </li>
        </ul>
        <div class="flex flex-row flex-wrap">
            
            <a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a>
            <span class="f1 fw2 blue3 no-underline underline-hover">,&nbsp;</span>
            <a href="/tag/workers-kv/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers KV</a>
            <span class="f1 fw2 blue3 no-underline underline-hover">,&nbsp;</span>
            <a href="/tag/cron/" class="no-underline f1 fw2 blue3 underline-hover">Cron</a>
            <span class="f1 fw2 blue3 no-underline underline-hover">,&nbsp;</span>
            <a href="/tag/wrangler/" class="no-underline f1 fw2 blue3 underline-hover">Wrangler</a>
        </div>
    </article>
    <article class="w-100 w-100-m w-50-l ph3 mb4">
        <p class="f3 fw5 gray5" data-iso-date="2020-12-25T14:00:00Z">December 25, 2020 2:00PM</p>
        <a href="/using-one-cron-parser-everywhere-with-rust-and-saffron/" class="no-underline gray1 f4 fw5">
            <h2 class="gray1 f4 fw5 mt2">Using One Cron Parser Everywhere With Rust and Saffron</h2>
        </a>

        <p class="gray1 lh-copy">Cron parsers are everywhere, each supporting their own extensions on the cron string format, which made consistency between parts of Cron Triggers difficult to achieve. Today weâ€™re showing how we easily solved this problem with Rust without needing to write the same code twice....</p>
        <ul class="flex pl0 fw6 f2">
            <span>By&nbsp;</span>
            <li class="list flex items-center">
                <div class="author-name-tooltip">
                    
                    <a href="/author/aaron-loyd/" class="fw5 f2 black no-underline">Aaron Loyd</a>
                </div>
            </li>
        </ul>
        <div class="flex flex-row flex-wrap">
            
            <a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a>
            <span class="f1 fw2 blue3 no-underline underline-hover">,&nbsp;</span>
            <a href="/tag/serverless/" class="no-underline f1 fw2 blue3 underline-hover">Serverless</a>
            <span class="f1 fw2 blue3 no-underline underline-hover">,&nbsp;</span>
            <a href="/tag/rust/" class="no-underline f1 fw2 blue3 underline-hover">Rust</a>
        </div>
    </article>
    <article class="w-100 w-100-m w-50-l ph3 mb4">
        <p class="f3 fw5 gray5" data-iso-date="2020-10-09T12:00:00+01:00">October 09, 2020 12:00PM</p>
        <a href="/exploring-webassembly-ai-services-on-cloudflare-workers/" class="no-underline gray1 f4 fw5">
            <h2 class="gray1 f4 fw5 mt2">Exploring WebAssembly AI Services on Cloudflare Workers</h2>
        </a>

        <p class="gray1 lh-copy">Edge networks present a significant opportunity for Artificial Intelligence (AI) performance and applicability. AI technologies already make it possible to run compelling applications like object and voice recognition, navigation, and recommendations....</p>
        <ul class="flex pl0 fw6 f2">
            <span>By&nbsp;</span>
            <li class="list flex items-center">
                <div class="author-name-tooltip">
                    
                    <a href="/author/guest-author/" class="fw5 f2 black no-underline">Guest Author</a>
                </div>
            </li>
        </ul>
        <div class="flex flex-row flex-wrap">
            
            <a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a>
            <span class="f1 fw2 blue3 no-underline underline-hover">,&nbsp;</span>
            <a href="/tag/serverless/" class="no-underline f1 fw2 blue3 underline-hover">Serverless</a>
        </div>
    </article>
    <article class="w-100 w-100-m w-50-l ph3 mb4">
        <p class="f3 fw5 gray5" data-iso-date="2020-10-06T12:00:00+01:00">October 06, 2020 12:00PM</p>
        <a href="/cloudflare-worker-with-webassembly-and-haskell/" class="no-underline gray1 f4 fw5">
            <h2 class="gray1 f4 fw5 mt2">Let&#x27;s build a Cloudflare Worker with WebAssembly and Haskell</h2>
        </a>

        <p class="gray1 lh-copy">Let's combine the power of Haskell and WebAssembly in a Cloudflare Worker!...</p>
        <ul class="flex pl0 fw6 f2">
            <span>By&nbsp;</span>
            <li class="list flex items-center">
                <div class="author-name-tooltip">
                    
                    <a href="/author/cristhian-motoche/" class="fw5 f2 black no-underline">Cristhian Motoche</a>
                </div>
            </li>
        </ul>
        <div class="flex flex-row flex-wrap">
            
            <a href="/tag/workers/" class="no-underline f1 fw2 blue3 underline-hover">Cloudflare Workers</a>
            <span class="f1 fw2 blue3 no-underline underline-hover">,&nbsp;</span>
            <a href="/tag/webassembly/" class="no-underline f1 fw2 blue3 underline-hover">WebAssembly</a>
            <span class="f1 fw2 blue3 no-underline underline-hover">,&nbsp;</span>
            <a href="/tag/wasm/" class="no-underline f1 fw2 blue3 underline-hover">WASM</a>
            <span class="f1 fw2 blue3 no-underline underline-hover">,&nbsp;</span>
            <a href="/tag/serverless/" class="no-underline f1 fw2 blue3 underline-hover">Serverless</a>
        </div>
    </article>

</div>
<div class="pv4 ph3 mw7 center">
    <div id="disqus_thread"></div>
</div>



        <footer class="pt4 pb4 pl1 pr1 main-footer">
  <div class="mw8 center dn db-l ph3">
    <div class="flex flex-row justify-between">
      <div class="main-footer__menu-group">
        <ul id="sales-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="sales-menu"
            class="main-footer__menu-group__header js-toggle-footer-group f1">
            Sales
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/plans/enterprise/contact/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="enterprise_sales"
              class="f1 blue3 no-underline underline-hover">
              Enterprise Sales
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/partners/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="become_a_partner" class="f1 blue3 no-underline underline-hover">
              Become a Partner
            </a>
          </li>
        </ul>
        <p class="phone f1 blue3 no-underline underline-hover">
          <p class="tel f1 blue3 no-underline underline-hover">Contact Sales:</p>
          <p><a data-i18n-phonenumber="" class="tel f1 blue3 no-underline underline-hover" href="tel:+18889935273">+1
              (888) 99 FLARE</a></p>

          <noscript><a class="phone f1 blue3 no-underline underline-hover" href="tel:+16503198930">+1 650 319
              8930</a></noscript>
        </p>
      </div>
      <div class="main-footer__menu-group">
        <ul id="getting-started-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="getting-started-menu"
            class="main-footer__menu-group__header js-toggle-footer-group">
            Getting Started
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/plans/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="plans" class="f1 blue3 no-underline underline-hover">
              Pricing
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/case-studies/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="case_studies" class="f1 blue3 no-underline underline-hover">
              Case Studies
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/resources/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="white_papers" class="f1 blue3 no-underline underline-hover">
              White Papers
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/webinars/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="webinars" class="f1 blue3 no-underline underline-hover">
              Webinars
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/learning/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="learning_center" class="f1 blue3 no-underline underline-hover">
              Learning Center
            </a>
          </li>
        </ul>
      </div>
      <div class="main-footer__menu-group">
        <ul id="community-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="community-menu"
            class="main-footer__menu-group__header js-toggle-footer-group">
            Community
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://community.cloudflare.com" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="community_hub" class="f1 blue3 no-underline underline-hover">
              Community Hub
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://blog.cloudflare.com" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="blog" class="f1 blue3 no-underline underline-hover">
              Blog
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/galileo/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="galileo" class="f1 blue3 no-underline underline-hover">
              Project Galileo
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/athenian/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="athenian" class="f1 blue3 no-underline underline-hover">
              Athenian Project
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.tv/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="tv" class="f1 blue3 no-underline underline-hover">
              Cloudflare TV
            </a>
          </li>
        </ul>
      </div>
      <div class="main-footer__menu-group">
        <ul id="developers-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="developers-menu"
            class="main-footer__menu-group__header js-toggle-footer-group">
            Developers
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://developers.cloudflare.com" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="developer_hub" class="f1 blue3 no-underline underline-hover">
              Developer Hub
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/technical-resources/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="technical_resources"
              class="f1 blue3 no-underline underline-hover">
              Technical Resources
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/products/cloudflare-workers/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="cloudflare_workers"
              class="f1 blue3 no-underline underline-hover">
              Cloudflare Workers
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/integrations/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="integrations" class="f1 blue3 no-underline underline-hover">
              Integrations
            </a>
          </li>
        </ul>
      </div>
      <div class="main-footer__menu-group">
        <ul id="support-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="support-menu"
            class="main-footer__menu-group__header js-toggle-footer-group">
            Support
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://support.cloudflare.com" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="support" class="f1 blue3 no-underline underline-hover">
              Support
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://www.cloudflarestatus.com" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="status" class="f1 blue3 no-underline underline-hover">
              Cloudflare Status
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/compliance/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="compliance" class="f1 blue3 no-underline underline-hover">
              Compliance
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/gdpr/introduction/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="gdpr" class="f1 blue3 no-underline underline-hover">
              GDPR
            </a>
          </li>
        </ul>
      </div>
      <div class="main-footer__menu-group">
        <ul id="company-menu" class="list pl0">
          <li class="pt1 pb1 f1" data-submenu="company-menu"
            class="main-footer__menu-group__header js-toggle-footer-group">
            Company
            <i class="icon-caret-down"></i>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/about-overview/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="overview" class="f1 blue3 no-underline underline-hover">
              About Cloudflare
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/people/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="our_team" class="f1 blue3 no-underline underline-hover">
              Our Team
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/press/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="press" class="f1 blue3 no-underline underline-hover">
              Press
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/analysts/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="analysts" class="f1 blue3 no-underline underline-hover">
              Analysts
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/careers/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="careers" class="f1 blue3 no-underline underline-hover">
              Careers
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/internetsummit/" data-tracking-category="footer"
              data-tracking-action="click" data-tracking-label="internet_summit"
              class="f1 blue3 no-underline underline-hover">
              Internet Summit
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/logo/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="logo" class="f1 blue3 no-underline underline-hover">
              Logo
            </a>
          </li>
          <li class="pt1 pb1">
            <a href="https://cloudflare.com/network/" data-tracking-category="footer" data-tracking-action="click"
              data-tracking-label="network_map" class="f1 blue3 no-underline underline-hover">
              Network Map
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="mw8 center ph3">
    <div class="flex flex-row flex-wrap justify-between pt4">
      <div class="flex flex-row items-start w-100 w-50-l pb4 pb0-l">
        <a target="_blank" rel="noopener" href="https://www.facebook.com/Cloudflare/" class="w-10"><img
            src="https://cloudflare.com/img/footer/facebook.svg" class="w-60"></a>
        <a target=" _blank" rel="noopener" href="https://twitter.com/Cloudflare" class="w-10"><img
            src="https://cloudflare.com/img/footer/twitter.svg" class="w-60"></a>
        <a target="_blank" rel="noopener" href="https://www.linkedin.com/company/cloudflare-inc-" class="w-10"><img
            src="https://cloudflare.com/img/footer/linkedin.svg" class="w-60"></a>
        <a target="_blank" rel="noopener" href="https://www.youtube.com/cloudflare" class="w-10"><img
            src="https://cloudflare.com/img/footer/youtube.svg" class="w-60"></a>
        <a target="_blank" rel="noopener" href="https://www.instagram.com/cloudflare" class="w-10"><img
            src="https://cloudflare.com/img/footer/instagram.svg" class="w-60"></a>
      </div>
      <div class="w-100 w-50-l tr-l tl-ns">
        <div>
          <span class="main-footer__copyright f1">Â© 2020 Cloudflare, Inc.</span>
          <span class="main-footer__copyright f1">|</span>
          <a href="https://cloudflare.com/privacypolicy/"
            class="main-footer__copyright f1 no-underline underline-hover">Privacy
            Policy</a>
          <span class="main-footer__copyright f1">|</span>
          <a href="https://cloudflare.com/website-terms/"
            class="main-footer__copyright f1 no-underline underline-hover">Terms of Use</a>
          <span class="main-footer__copyright f1">|</span>
          <a href="https://cloudflare.com/abuse/"
            class="main-footer__copyright f1 no-underline underline-hover">Trust &amp; Safety</a>
          <span class="main-footer__copyright f1">|</span>
          <a href="https://cloudflare.com/trademark/"
            class="main-footer__copyright f1 no-underline underline-hover">Trademark</a>
        </div>
      </div>
    </div>
  </div>
</footer>    </div>


    <script type="text/javascript" src="/assets/built/prism.js?v=fdf4009e30"></script>
<script type="text/javascript">
    var disqus_shortname = 'cloudflare';
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
        Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');
</script>
<script>(function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=596756540369391";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>
<script src="//platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
<script type="text/javascript">
        (function () {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
</script>

<script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');
</script>
<script>(function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=596756540369391";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>
<script src="//platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
<script type="text/javascript">
        (function () {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = 'https://apis.google.com/js/platform.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
</script>


    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PKQFGQB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<script>
    var links = document.links;

    for (var i = 0, linksLength = links.length; i < linksLength; i++) {  
       if (links[i].hostname != window.location.hostname) {
           links[i].target = '_blank';
       } 
    } 
</script>

</body>

</html>