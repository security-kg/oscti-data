
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>Emissary Panda Attacks Middle East Government SharePoint Servers</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/emissary-panda-attacks-middle-east-government-sharepoint-servers/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Emissary Panda Attacks Middle East Government SharePoint Servers" />
<meta property="og:description" content="Our latest research shows attacks against Middle East government Sharepoint servers using a newly patched vulnerability. In our blog, we provide details of the tools and tactics, explain how we believe these connect to the Emissary Panda threat group, correlate our findings with those of the Saudi Arabian National Cyber Security Center and the Canadian Center for Cyber Security, and provide indicators of compromise (IoCs) from our research." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="APT27" />
<meta property="article:tag" content="Bronze Union" />
<meta property="article:tag" content="China Chopper" />
<meta property="article:tag" content="CVE-2019-0604" />
<meta property="article:tag" content="DLL Sideloading" />
<meta property="article:tag" content="Emissary Panda" />
<meta property="article:tag" content="ETERNALBLUE" />
<meta property="article:tag" content="HyperBro" />
<meta property="article:tag" content="Lucky Mouse" />
<meta property="article:tag" content="MS17-010" />
<meta property="article:tag" content="TG-3390" />
<meta property="article:tag" content="webshell" />
<meta property="article:section" content="Unit 42" />
<meta property="article:published_time" content="2019-05-28T13:00:32+00:00" />
<meta property="article:modified_time" content="2020-03-02T20:21:58+00:00" />
<meta property="og:updated_time" content="2020-03-02T20:21:58+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1-1024x512.png" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1-1024x512.png" />
<meta property="og:image:width" content="1024" />
<meta property="og:image:height" content="512" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Our latest research shows attacks against Middle East government Sharepoint servers using a newly patched vulnerability. In our blog, we provide details of the tools and tactics, explain how we believe these connect to the Emissary Panda threat group, correlate our findings with those of the Saudi Arabian National Cyber Security Center and the Canadian Center for Cyber Security, and provide indicators of compromise (IoCs) from our research." />
<meta name="twitter:title" content="Emissary Panda Attacks Middle East Government SharePoint Servers" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1.png" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; Emissary Panda Attacks Middle East Government SharePoint Servers Comments Feed" href="https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/feed/" />
<meta property="og:likes" content="3"/>
<meta property="og:readtime" content="13"/>
<meta property="og:views" content="49,276"/>
<meta property="og:date_created" content="May 28, 2019 at 6:00 AM"/>
<meta property="og:post_length" content="4510"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit-42/"/>
<meta property="og:author" content="Robert Falcone"/>
<meta property="og:author" content="Tom Lancaster"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/robertfalcone/"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/tom-lancaster/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:post_image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1-380x184.png"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"Emissary Panda Attacks Middle East Government SharePoint Servers","name":"Emissary Panda Attacks Middle East Government SharePoint Servers","description":"Our latest research shows attacks against Middle East government Sharepoint servers using a newly patched vulnerability. In our blog, we provide details of the tools and tactics, explain how we believe these connect to the Emissary Panda threat group, correlate our findings with those of the Saudi Arabian National Cyber Security Center and the Canadian Center for Cyber Security, and provide indicators of compromise (IoCs) from our research.","url":"https:\/\/unit42.paloaltonetworks.com\/emissary-panda-attacks-middle-east-government-sharepoint-servers\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/emissary-panda-attacks-middle-east-government-sharepoint-servers\/","datePublished":"May 28, 2019","articleBody":"Executive Summary\r\n\r\nIn April 2019, Unit 42 observed the Emissary Panda (AKA APT27, TG-3390, Bronze Union, Lucky Mouse) threat group installing webshells on SharePoint servers to compromise Government Organizations of two different countries in the Middle East. We believe the adversary exploited a recently patched vulnerability in Microsoft SharePoint tracked by CVE-2019-0604, which is a remote code execution vulnerability used to compromise the server and eventually install a webshell. The actors uploaded a variety of tools that they used to perform additional activities on the compromised network, such as dumping credentials, as well as locating and pivoting to additional systems on the network. Of particular note is their use of tools to identify systems vulnerable to CVE-2017-0144, which is the same vulnerability exploited by EternalBlue that is best known for its use in the WannaCry attacks of 2017.\r\n\r\nThis activity appears related to campaigns exploiting CVE-2019-0604 mentioned in recent security alerts from Saudi Arabian National Cyber Security Center and the Canadian Center for Cyber Security. In addition to the aforementioned post-exploitation tools, the actors used these webshells to upload legitimate executables that they would use DLL sideloading to run a malicious DLL that has code overlaps with known Emissary Panda attacks. We also found the China Chopper webshell on the SharePoint servers, which has also been used by the Emissary Panda threat group.\r\n\r\nIn this blog, we provide details of the tools and tactics we observed on these compromised SharePoint servers, explain how we believe these connect to the Emissary Panda threat group, correlate our findings with those of the Saudi Arabian National Cyber Security Center and the Canadian Center for Cyber Security, and provide indicators of compromise (IoCs) from our research. You can find the Adversary Playbook for the activity detailed in this blog here.\r\n\r\nAttack Overview\r\n\r\nThis webshell activity took place across three SharePoint servers hosted by two different government organizations between April 1, 2019 and April 16, 2019, where actors uploaded a total of 24 unique executables across the three SharePoint servers. Figure 1 shows a timeline of when the files were uploaded to the three webshells. The timeline shows three main clusters of activity across the three webshells, with activity occurring on two separate webshells (green and orange) within a very small window of time on April 2, 2019 and the activity involving the third webshell two weeks later on April 16, 2019. The actors uploaded several of the same tools to across these three webshells, which provides a relationship between the incidents and indicates that a single threat group is likely involved.\r\nFigure 1. Timeline of file uploads across three related webshells\r\nThe tools uploaded to the webshells range from legitimate applications such as cURL to post-exploitation tools such as Mimikatz. The threat actors also uploaded tools to scan for and exploit potential vulnerabilities in the network, such as the well-known SMB vulnerability patched in MS17-010 commonly exploited by EternalBlue to move laterally to other systems on the network. We also observed the actors uploading custom backdoors such as HyperBro which is commonly associated with Emissary Panda. Based on the functionality of the various tools uploaded to the webshells, we believe the threat actors breach the SharePoint servers to use as a beachhead, then attempt to move laterally across the network via stolen credentials and exploiting vulnerabilities. \r\n\r\nWebshells Installed\r\n\r\nAs previously mentioned, we found webshells installed on three SharePoint servers hosted at two different organizations, two of which had the same file name of errr.aspx and the other a filename of error2.aspx. The webshells were hosted at the following paths on the compromised servers:\r\n\r\n\/_layouts\/15\/error2.aspx\r\n\r\n\/_layouts\/15\/errr.aspx\r\n\r\nWe were able to gather one of the webshells with which we saw the actor interacting, specifically the error2.aspx file listed above. The error2.aspx file (SHA256: 006569f0a7e501e58fe15a4323eedc08f9865239131b28dc5f95f750b4767b38) is a variant of the Antak webshell, which is part of a tool created for red teaming called Nishang. The specific variant of Antak in error2.aspx is version v0.5.0, which is an older version of the webshell that was updated in August 2015 to v0.7.6 to include some basic authentication functionality and the ability to perform SQL queries. It\u2019s possible the actors obtained Antak v0.5.0 via the Nishang GitHub repository or from SecWiki\u2019s GitHub that also has the v0.5.0 version of Antak. Figure 2 shows the Antak webshell loaded on one of the Sharepoint servers. \r\nFigure 2. Antak webshell \u2018error2.aspx\u2019 used to upload post-exploitation tools\r\nWhile we observed the threat actor uploading additional tools to the Antak webshell above, the Sharepoint server also had several other webshells installed. The additional webshells, specifically stylecs.aspx, stylecss.aspx, and test.aspx are listed in Table 1, and appear related to the China Chopper webshell. We cannot be sure all of these webshells were installed by the same actors, as multiple actors could have exploited the SharePoint server. For instance, the China Chopper-related webshells are one-line of JScript code that could be easily copied and used by multiple groups, and the Antak webshell is easily obtained from publicly accessible repositories. However, the installation of China Chopper and the uploading of Emissary Panda related custom payloads to the Antak webshell suggests they are likely related, as this threat group has used China Chopper to compromise servers in the past.\r\n\r\n\r\n\r\nFilename\r\nSHA256\r\n\r\n\r\nstylecs.aspx\r\n2feae7574a2cc4dea2bff4eceb92e3a77cf682c0a1e78ee70be931a251794b86\r\n\r\n\r\nstylecss.aspx\r\nd1ab0dff44508bac9005e95299704a887b0ffc42734a34b30ebf6d3916053dbe\r\n\r\n\r\ntest.aspx\r\n6b3f835acbd954af168184f57c9d8e6798898e9ee650bd543ea6f2e9d5cf6378\r\n\r\n\r\n\r\nTable 1. Additional webshells hosted on Sharepoint server\r\nThe stylecs.aspx webshell provides fairly significant functionality, as its developer wrote this webshell in JScript that ultimately runs any supplied JScript code provided to it within the HTTP request. Figure 3 shows this webshell\u2019s code that will run supplied JScript provided in base64 encoded format within the URL within a parameter e358efa489f58062f10dd7316b65649e. The parameter e358efa489f58062f10dd7316b65649e is interesting as it is the MD5 hash for the letter \u2018t\u2019, which is a known parameter for China Chopper as mentioned in the next section.\r\nFigure 3. China Chopper code found in stylecs.aspx webshell on SharePoint server\r\nThe stylecss.aspx webshell is very similar to the stylecs.aspx, as it runs JScript provided within the e358efa489f58062f10dd7316b65649e parameter of the URL; however, the stylecss.aspx webshell does not accept base64 encoded JScript, but expects the JScript in cleartext that the actor would provide as URL safe text. Figure 4 shows the code within stylecss.aspx, which when compared to Figure 3 above shows the lack of the base64 decoding function \u2018FromBase64String\u2019.\r\n\r\nFigure 4. China Chopper code found in stylecss.aspx webshell on SharePoint server\r\nThe last webshell extracted from the Sharepoint server had a filename of test.aspx, which is very similar to the stylecs.aspx webshell as it runs base64 encoded JScript provided in the URL of the request. However, the test.aspx webshell uses a parameter related to the compromised organization to obtain the base64 encoded JScript that it will run and display within the browser. The test.aspx shell also includes code that sets the HTTP response status to a 404 Not Found, which will display an error page but will still run the provided JScript. Figure 5 shows the code within the test.aspx file. \r\nFigure 5. China Chopper code found in test.aspx webshell on SharePoint server\r\nLinks to Security Advisories\r\n\r\nIn April 2019, several national security organizations released alerts on CVE-2019-0604 exploitation, including the Saudi Arabian National Cyber Security Center and the Canadian Center for Cyber Security. Both of these alerts discussed campaigns in which actors used the CVE-2019-0604 to exploit SharePoint servers to install the China Chopper webshell. While we cannot confirm all of the claims made in these advisories, we noticed overlaps in the webshell code hosted on the compromised SharePoint servers we observed and the webshells mentioned in these advisories.\r\n\r\nThe Saudi Arabian National Cyber Security Center\u2019s alert provided details regarding the activities carried out by the adversary. This alert also displayed the code associated with the China Chopper webshell observed in the attacks, which included Request.Item[\"t\"] to obtain JScript code from the \u2018t\u2019 parameter of the URL. As mentioned in the previous section, stylecs.aspx and stylecss.aspx both used a parameter of e358efa489f58062f10dd7316b65649e, which is the MD5 hash of \u2018t\u2019. This may suggest the actor modified the script slightly between the attack we observed, and the attack mentioned in the NCSC advisory, all while retaining the same functionality. Also, the NCSC advisory mentioned that the actors used a file name stylecss.aspx for their webshell, which is the same filename we saw associated with China Chopper. \r\n\r\nThe alert from the Canadian Center for Cyber Security included the SHA256 hashes of the files associated with the campaign, one of which was 05108ac3c3d708977f2d679bfa6d2eaf63b371e66428018a68efce4b6a45b4b4 for a file named pay.aspx. The pay.aspx file is part of the China Chopper webshell and is very similar to the stylecss.aspx webshell we discussed above, with the only major difference is the URL parameter of \u2018vuiHWNVJAEF\u2019 within the URL that pay.aspx webshell uses to obtain and run JScript. Figure 6 below shows a comparison between the stylecss.aspx and pay.aspx files.\r\nFigure 6. Comparison between stylecss.aspx webshell and pay.aspx webshell discussed in Canadian Center for Cyber Security advisory\r\nTools Uploaded\r\n\r\nDuring our research into this attack campaign, Unit 42 gathered several tools that the actor uploaded to the three webshells at the two government organizations. The chart in Figure 7 shows the same tools being uploaded to the webshells, which provided an initial linkage between the activities. One of the overlapping tools uploaded to the webshells is the legitimate cURL application, which could be used by multiple groups. The other overlapping files are tools used by the adversary to locate other systems on the network (etool.exe), check to see if they are vulnerable to CVE-2017-0144 (EternalBlue) patched in MS07-010 (checker1.exe) and pivot to them using remote execution functionality offered by a tool similar to PsExec offered by Impacket (psexec.exe). These tools are not custom made by the adversary but still provide a medium confidence linkage between the activities. We also observed the actors uploading the HyperBro backdoor to one of the webshells, as well as legitimate executables that would sideload malicious DLLs that have overlapping code associated with known Emissary Panda activity. \r\n\r\nFigure 7. Relationships between tools uploaded to the three webshells hosted on SharePoint servers\r\nThe actors uploaded 10 portable executables to the error2.aspx webshell, as seen in Table 2. The list of tools uploaded to this webshell includes legitimate applications, such as cURL and a component of Sublime Text used to sideload a malicious DLL, which we will discuss in an upcoming section. The list also includes several hack tools, such as Mimikatz for credential dumping and several compiled python scripts used to locate and compromise other systems on the local network. Lastly, we saw the actor uploading a custom backdoor called HyperBro, which has been associated with Emissary Panda operations in the past. We will provide an analysis of the HyperBro tool in an upcoming section. \r\n\r\n\r\n\r\nFilename\r\nSHA256\r\nDescription\r\n\r\n\r\nm2.exe\r\nb279a41359367408c627ffa8d80051ed0f04c76fbf6aed79b3b2963203e08ade\r\nPacked Mimikatz tool.\r\n\r\n\r\npsexec.exe\r\n7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7\r\nCompiled Impacket psexec\r\n\r\n\r\ns.exe\r\n04f48ed27a83a57a971e73072ac5c769709306f2714022770fb364fd575fd462\r\nHyperBro backdoor\r\n\r\n\r\ncurl.exe\r\nabc16344cdfc78f532870f4dcfbb75794c9a7074e796477382564d7ba2122c7d\r\nLegitimate cURL\r\n\r\n\r\ncurl.exe\r\nbbb9cd70fdc581812822679e6a875dcf5b7d32fd529a1d564948a5a3f6f9e3ab\r\nLegitimate cURL\r\n\r\n\r\nchecker1.exe\r\n090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98\r\nCompiled EternalBlue checker script\r\n\r\n\r\netool.exe\r\n38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c\r\nC# Tool, likely from https:\/\/github.com\/mubix\/netview\r\n\r\n\r\nplugin_host.exe\r\n738abaa80e8b6ed21e16302cb91f6566f9322aebf7a22464f11ee9f4501da711\r\nLegitimate Sublime Text plugin host\r\n\r\n\r\nPYTHON33.dll\r\n2dde8881cd9b43633d69dfa60f23713d7375913845ac3fe9b4d8a618660c4528\r\nSideloaded DLL loaded by Sublime Text\r\n\r\n\r\ncurl.exe\r\nbbb9cd70fdc581812822679e6a875dcf5b7d32fd529a1d564948a5a3f6f9e3ab\r\nLegitimate cURL.\r\n\r\n\r\n\r\nTable 2. Unique tools uploaded to the error2.aspx webshell installed on a SharePoint server\r\nWe saw 17 tools uploaded to the errr.aspx webshell hosted on the SharePoint server of one of the government organizations, which is in the middle of the chart in Figure 7. Table 3 shows all of the tools we observed the actor uploading to the webshell, which includes a list of tools used to dump credentials, locate, and exploit remote systems, as well as pivoting to other systems on the network. \r\n\r\n\r\n\r\nFilename\r\nSHA256\r\nDescription\r\n\r\n\r\nsmb1.exe\r\n88027a44dc82a97e21f04121eea2e86b4ddf1bd7bbaa4ad009b97b50307570bd\r\nSMB backdoor based on smbrelay3\r\n\r\n\r\nmcmd.exe\r\n738128b4f42c8d2335d68383d72734130c0c4184725c06851498a4cf0374a841\r\nCompiled zzz_exploit.py\r\n\r\n\r\nmcafee.exe\r\n3bca0bb708c5dad1c683c6ead857a5ebfa15928a59211432459a3efa6a1afc59\r\nCompiled zzz_exploit.py\r\n\r\n\r\ndump.exe\r\n29897f2ae25017455f904595872f2430b5f7fedd00ff1a46f1ea77e50940128e\r\npwdump\r\n\r\n\r\nchecker1.exe\r\nd0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963da38e0b1333\r\nCompiled MS17-010 checker\r\n\r\n\r\nmemory.exe\r\na18326f929229da53d4cc340bde830f75e810122c58b523460c8d6ba62ede0e5\r\nPacked Mimikatz\r\n\r\n\r\nchecker.exe\r\n090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98\r\nCompiled MS17-010 checker\r\n\r\n\r\npsexec.exe\r\n7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7\r\nCompiled Impacket psexec.\r\n\r\n\r\netool.exe\r\n38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c\r\nC# Tool, likely from https:\/\/github.com\/mubix\/netview\r\n\r\n\r\nsmb.exe\r\n4a26ec5fd16ee13d869d6b0b6177e570444f6a007759ea94f1aa18fa831290a8\r\nSMB backdoor based on smbrelay3\r\n\r\n\r\nagent_Win32.exe\r\nb2b2e900aa2e96ff44610032063012aa0435a47a5b416c384bd6e4e58a048ac9\r\nTermite\r\n\r\n\r\nsmb_exec.exe\r\n475c7e88a6d73e619ec585a7c9e6e57d2efc8298b688ebc10a3c703322f1a4a7\r\nhttprelay\r\n\r\n\r\ncurl.exe\r\nbbb9cd70fdc581812822679e6a875dcf5b7d32fd529a1d564948a5a3f6f9e3ab\r\nLegitimate cURL\r\n\r\n\r\nincognito.exe\r\n9f5f3a9ce156213445d08d1a9ea99356d2136924dc28a8ceca6d528f9dbd718b\r\nIncognito \u00a0\r\n\r\n\r\nnbtscan.exe\r\nc9d5dc956841e000bfd8762e2f0b48b66c79b79500e894b4efa7fb9ba17e4e9e\r\nnbtscan\r\n\r\n\r\nfgdump.exe\r\na6cad2d0f8dc05246846d2a9618fc93b7d97681331d5826f8353e7c3a3206e86\r\npwdump\r\n\r\n\r\nsmbexec.exe\r\ne781ce2d795c5dd6b0a5b849a414f5bd05bb99785f2ebf36edb70399205817ee\r\nCompiled Impacket smbexec\r\n\r\n\r\n\r\nTable 3. Unique tools uploaded to the errr.aspx webshell installed on a SharePoint server\r\nTwo of the tools, specifically the compiled zzz_exploit.py and checker.py suggest the actor would check and exploit remote systems if they were not patched for MS17-010, which patched the CVE-2017-0144 (EternalBlue) vulnerability. Also, the use of the Mimikatz and pwdump tools suggests the adversary attempts to dump credentials on compromised systems. We were able to gather the command line arguments the actor used to run the SMB backdoor smb1.exe. The following arguments shows the actor using the SMB backdoor to attempt to run a batch script m.bat on a remote host using a domain username and the account\u2019s password hash:\r\n\r\nc:\\programdata\\smb1.exe &lt;redacted 10.0.0.0\/8 IP&gt; &lt;redacted domain&gt;\\&lt;redacted username&gt; :&lt;redacted password hash&gt; winsk c:\\programdata\\m.bat\r\n\r\nWe saw far fewer portable executable files uploaded to the second errr.aspx webshell, specifically the 3 files seen in Table 4. The files uploaded to this webshell included the same compiled python script that would scan remote systems that were vulnerable to CVE-2017-0144 (EternalBlue) that we saw uploaded to the other errr.aspx webshell. Also, we observed the actor uploading a legitimate Microsoft application that would sideload a malicious DLL, of which was very similar to the DLL sideloaded by the Sublime Text plugin host that was uploaded to the error2.aspx webshell. \r\n\r\n\r\n\r\nFilename\r\nSHA256\r\nDescription\r\n\r\n\r\nchecker1.exe\r\nd0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963da38e0b1333\r\nCompiled MS17-010 checker\r\n\r\n\r\nCreateMedia.exe\r\n2bb22c7b97e4c4d07e17a259cbc48d72f7e3935aa873e3dd78d01c5bbf426088\r\nLegitimate CreateMedia.exe application from Microsoft's System Center 2012 Configuration Manager\r\n\r\n\r\nCreateTsMediaAdm.dll\r\n06510504f30feb1adc7e423d5a24e67e5b97acbfafe40f253a054be8b1c4e8d7\r\nSideloaded DLL loaded by CreateMedia.exe\r\n\r\n\r\n\r\nTable 4. Unique tools uploaded to the errr.aspx webshell installed on a SharePoint server\r\nEmissary Panda Specific Tools\r\n\r\nMany of the tools uploaded to these webshells are hacking tools that are publicly accessible and could be used by multiple threat actors. However, several of the tools uploaded to the webshells appear to be custom made and likely related to the Emissary Panda threat group. \r\n\r\nHyperBro\r\n\r\nThe s.exe (SHA256: 04f48ed27a83a57a971e73072ac5c769709306f2714022770fb364fd575fd462) uploaded to the error2.aspx webshell is a self-extracting 7-zip archive that is an example of the HyperBro backdoor. According to Kaspersky and SecureWorks research, HyperBro is a custom backdoor developed and used by Emissary Panda in their attack campaigns. This sample of HyperBro is similar to the sample discussed in Kaspersky\u2019s research, specifically using a legitimate pcAnywhere application to sideload a DLL to decrypt, decompress and run a payload embedded within a file named \u2018thumb.db\u2019. Table 5 shows the three files associated with this HyperBro sample, which have the same file names as the self-extracting 7zip archives mentioned in Kaspersky\u2019s blog (SHA256 hashes: 34a542356ac8a3f6e367c6827b728e18e905c71574b3813f163e043f70aa3bfa and 2144aa68c7b2a6e3511e482d6759895210cf60c67f14b9485a0236af925d8233).\r\n\r\n&nbsp;\r\n\r\n\r\n\r\nFilename\r\nSHA256\r\nDescription\r\n\r\n\r\nthinprobe.exe\r\n76d2e897ca235beab44ee7eaab9ede7bc7868bbaeb7d6cb10b4323c07eb216af\r\nSymantec pcAnywhere thinprobe application \r\n\r\n\r\nthinhostprobedll.dll \r\nd40414b1173d59597ed1122361fe60303d3526f15320aede355c6ad9e7e239af\r\nSideloaded DLL loaded by thinprobe.exe\r\n\r\n\r\nthumb.db\r\n270ea24f2cef655bd89439ab76c1d49c80caaa8899ffa6f0ef36dc1beb894530\r\nContains encrypted and compressed DLL payload run by sideloaded DLL\r\n\r\n\r\n\r\nTable 5. Files associated with the HyperBro tool uploaded to webshell on SharePoint server\r\nThe functional payload is a DLL compiled on 2019-03-11 02:23:54, which has two functionalities depending if the binary has a command line argument -daemon or -worker passed to it. The daemon functionality handles the C2 communications portion of the Trojan, which is configured to communicate with 185.12.45[.]134 over HTTPS using the following URL:\r\n\r\nhxxps:\/\/185.12.45[.]134:443\/ajax\r\n\r\nThe worker functionality acts on the data received from the C2 server, which is passed from the daemon to the worker via a named pipe called \"\\\\.\\pipe\\testpipe\". The worker subjects the received data to a command handler whose available commands are listed in Table 6. \u00a0\r\n\r\n\r\n\r\nCommand\r\nSub-command\r\nDescription\r\n\r\n\r\n0x12\r\n\r\nFile manager\r\n\r\n\r\n\r\n0x10\r\nEnumerate logical storage volumes\r\n\r\n\r\n\r\n 0x11\r\nDelete a specified file\r\n\r\n\r\n\r\n0x12\r\nUpload a file\r\n\r\n\r\n\r\n0x13\r\nDownload a file\r\n\r\n\r\n\r\n0x17\r\nList contents of a folder\r\n\r\n\r\n\r\n0x19\r\nRun an application (CreateProcessW) or script\/file (ShellExecuteW)\r\n\r\n\r\n0x13\r\n\r\nExecute command on shell\r\n\r\n\r\n0x16\r\n\r\nTakes screenshot\r\n\r\n\r\n0x19\r\n\r\nRuns shellcode it injects into a newly created process 'msiexec.exe'\r\n\r\n\r\n0x1a\r\n\r\nKill specific process\r\n\r\n\r\n0x1e\r\n\r\nService manager\r\n\r\n\r\n\r\n0x17\r\nList all services and their configurations\r\n\r\n\r\n\r\n0x19\r\nStart a specified service\r\n\r\n\r\n\r\n0x1a\r\nStop a specified service\r\n\r\n\r\n\r\nTable 6. The commands available within the HyperBro tool\u2019s command handler\r\nUnknown Sideloaded Payloads\r\n\r\nTable 2 and 4 above include two legitimate executables used for DLL sideloading, specifically the plugin_host.exe application for Sublime Text and the CreateMedia.exe application from Microsoft's System Center 2012 Configuration Manager. The plugin_host.exe application imports several functions from a library named python33, which is how the legitimate application sideloads the malicious DLL named PYTHON33.dll. This is the first instance we have observed Sublime Text\u2019s plugin host application used for sideloading. Like the plugin host application, the CreateMedia.exe application imports several functions from a library named CreateTsMediaAdm that is leveraged to load the malicious DLL named CreateTsMediaAdm.dll.\r\n\r\nThe PYTHON33.dll and the CreateTsMediaAdm.dll libraries are very similar with BinDiff providing a 97% similarity with 99% confidence between the two DLLs. The code diff in Figure 8 shows the decryption routine in PYTHON33.dll (right) and CreateTsMediaAdm.dll (left), both of which use an eight byte XOR key to decrypt a piece of shikata_ga_nai obfuscated shellcode. The shellcode is responsible for patching the entry point of the legitimate application to call another function in the shellcode that is responsible for loading a file with the library name with an .hlp extension (PYTHON33.hlp or CreateTsMediaAdm.hlp).\r\nFigure 8. Code comparison between the sideloaded CreateTsMediaAdm.dll and PYTHON33.dll files uploaded to two webshells\r\nUnfortunately, we do not have access to the PYTHON33.hlp or CreateTsMediaAdm.hlp files, so we do not know the final payload loaded by either of these DLLs. However, using NCC Group\u2019s research published in May 2018, we were able to discover code overlaps between these DLLs and a sideloaded DLL that ran the SysUpdate tool that the NCC group has associated with an Emissary Panda campaign. Figure 9 shows a code comparison between the PYTHON33.dll (right) and inicore_v2.3.30.dll (left) (SHA256: 4d65d371a789aabe1beadcc10b38da1f998cd3ec87d4cc1cfbf0af014b783822), which was sideloaded to run the SysUpdate tool in a previous Emissary Panda campaign. The code overlaps below include the same technique to find the entry point of the loading executable and decrypting the first piece of shellcode used to patch the entry point.\r\nFigure 9. Code comparison between the sideloaded PYTHON33.dll uploaded to webshell and the inicore_v2.3.30.dll file sideloaded in previous Emissary Panda attacks\r\nConclusion\r\n\r\nThe Emissary Panda threat group loaded the China Chopper webshell onto SharePoint servers at two Government organizations in the Middle East, which we believe with high confidence involved exploiting a remote code execution vulnerability in SharePoint tracked in CVE-2019-0604. According to Microsoft\u2019s advisory, this vulnerability was patched on March 12, 2019 and we first saw the webshell activity on April 1, 2019. This suggests that the threat group was able to quickly leverage a known vulnerability to exploit Internet facing servers to gain access to targeted networks.\r\n\r\nOnce the adversary established a foothold on the targeted network, they used China Chopper and other webshells to upload additional tools to the SharePoint server to dump credentials, perform network reconnaissance and pivot to other systems. We believe the actors pivoted to other systems on the network using stolen credentials and by exploiting the CVE-2017-0144 (EternalBlue) vulnerability patched in MS17-010. We also observed the actors uploading legitimate tools that would sideload DLLs, specifically the Sublime Text plugin host and the Microsoft\u2019s Create Media application, both of which we had never seen used for DLL sideloading before. \r\n\r\nPalo Alto Networks customers are protected by:\r\n\r\n \tThe CVE-2019-0604 vulnerability is covered by our IPS signature Microsoft Sharepoint Remote Code Execution Vulnerability (55411)\r\n \tAll illegitimate tools uploaded to the webshells are marked with malicious verdicts by WildFire and Traps.\r\n \tAutoFocus customers can track the custom Emissary Panda payload seen uploaded to the webshell using the HyperBro tag, but can also track the hack tools using the following tags (note the hack tools are used by multiple actors and not just Emissary Panda):\r\n\r\n \tSmbExec\r\n \tPsExec\r\n \tPsExec_Python\r\n \tBChecker\r\n \tZZZ_Exploit\r\n \tTermite\r\n \tIncognito\r\n \tPwDump\r\n\r\n\r\n\r\nPalo Alto Networks has shared our findings, including file samples and indicators of compromise, in this report with our fellow Cyber Threat Alliance members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors. For more information on the Cyber Threat Alliance, visit www.cyberthreatalliance.org.\r\n\r\nIOCs\r\n\r\nWebshells SHA256\r\n\r\n006569f0a7e501e58fe15a4323eedc08f9865239131b28dc5f95f750b4767b38\r\n\r\n2feae7574a2cc4dea2bff4eceb92e3a77cf682c0a1e78ee70be931a251794b86\r\n\r\nd1ab0dff44508bac9005e95299704a887b0ffc42734a34b30ebf6d3916053dbe\r\n\r\n6b3f835acbd954af168184f57c9d8e6798898e9ee650bd543ea6f2e9d5cf6378\r\n\r\nMalicious HackTools and Payloads SHA256\r\n\r\n88027a44dc82a97e21f04121eea2e86b4ddf1bd7bbaa4ad009b97b50307570bd\r\n\r\n738128b4f42c8d2335d68383d72734130c0c4184725c06851498a4cf0374a841\r\n\r\n3bca0bb708c5dad1c683c6ead857a5ebfa15928a59211432459a3efa6a1afc59\r\n\r\n29897f2ae25017455f904595872f2430b5f7fedd00ff1a46f1ea77e50940128e\r\n\r\nd0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963da38e0b1333\r\n\r\na18326f929229da53d4cc340bde830f75e810122c58b523460c8d6ba62ede0e5\r\n\r\n090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98\r\n\r\n7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7\r\n\r\n38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c\r\n\r\n4a26ec5fd16ee13d869d6b0b6177e570444f6a007759ea94f1aa18fa831290a8\r\n\r\nb2b2e900aa2e96ff44610032063012aa0435a47a5b416c384bd6e4e58a048ac9\r\n\r\n475c7e88a6d73e619ec585a7c9e6e57d2efc8298b688ebc10a3c703322f1a4a7\r\n\r\n9f5f3a9ce156213445d08d1a9ea99356d2136924dc28a8ceca6d528f9dbd718b\r\n\r\nc9d5dc956841e000bfd8762e2f0b48b66c79b79500e894b4efa7fb9ba17e4e9e\r\n\r\na6cad2d0f8dc05246846d2a9618fc93b7d97681331d5826f8353e7c3a3206e86\r\n\r\ne781ce2d795c5dd6b0a5b849a414f5bd05bb99785f2ebf36edb70399205817ee\r\n\r\nd0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963da38e0b1333\r\n\r\n06510504f30feb1adc7e423d5a24e67e5b97acbfafe40f253a054be8b1c4e8d7\r\n\r\nb279a41359367408c627ffa8d80051ed0f04c76fbf6aed79b3b2963203e08ade\r\n\r\n7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7\r\n\r\n04f48ed27a83a57a971e73072ac5c769709306f2714022770fb364fd575fd462\r\n\r\n090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98\r\n\r\n38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c\r\n\r\n2dde8881cd9b43633d69dfa60f23713d7375913845ac3fe9b4d8a618660c4528\r\n\r\nHyperBro C2\r\n\r\nhxxps:\/\/185.12.45[.]134:443\/ajax\r\n\r\n185.12.45[.]134","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2019\/05\/Espionage-r3d1-150x150.png","width":150,"height":150},"author":[{"@type":"Person","name":"Robert Falcone"},{"@type":"Person","name":"Tom Lancaster"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"96976","token":"b09d8c8c9d","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=96976' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Femissary-panda-attacks-middle-east-government-sharepoint-servers%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Femissary-panda-attacks-middle-east-government-sharepoint-servers%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-96976 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">Emissary Panda Attacks Middle East Government SharePoint Servers</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-96976 entry-meta">
			
			
			<span class="post-views-count">49,276</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'96976','like')"><i class="ui ui-2"></i><span class="ml-5">3</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 13</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Femissary-panda-attacks-middle-east-government-sharepoint-servers%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Femissary-panda-attacks-middle-east-government-sharepoint-servers%2F+-+Emissary+Panda+Attacks+Middle+East+Government+SharePoint+Servers" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Femissary-panda-attacks-middle-east-government-sharepoint-servers%2F&title=Emissary+Panda+Attacks+Middle+East+Government+SharePoint+Servers&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/emissary-panda-attacks-middle-east-government-sharepoint-servers/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/robertfalcone/" title="Posts by Robert Falcone" class="author url fn" rel="author">Robert Falcone</a> and <a href="https://unit42.paloaltonetworks.com/author/tom-lancaster/" title="Posts by Tom Lancaster" class="author url fn" rel="author">Tom Lancaster</a>        </p>
        <p><time datetime="2019-05-28T13:00:32+00:00">May 28, 2019 at 6:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit-42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/apt27/" rel="tag">APT27</a>, <a href="https://unit42.paloaltonetworks.com/tag/bronze-union/" rel="tag">Bronze Union</a>, <a href="https://unit42.paloaltonetworks.com/tag/china-chopper/" rel="tag">China Chopper</a>, <a href="https://unit42.paloaltonetworks.com/tag/cve-2019-0604/" rel="tag">CVE-2019-0604</a>, <a href="https://unit42.paloaltonetworks.com/tag/dll-sideloading/" rel="tag">DLL Sideloading</a>, <a href="https://unit42.paloaltonetworks.com/tag/emissary-panda/" rel="tag">Emissary Panda</a>, <a href="https://unit42.paloaltonetworks.com/tag/eternalblue/" rel="tag">ETERNALBLUE</a>, <a href="https://unit42.paloaltonetworks.com/tag/hyperbro/" rel="tag">HyperBro</a>, <a href="https://unit42.paloaltonetworks.com/tag/lucky-mouse/" rel="tag">Lucky Mouse</a>, <a href="https://unit42.paloaltonetworks.com/tag/ms17-010/" rel="tag">MS17-010</a>, <a href="https://unit42.paloaltonetworks.com/tag/tg-3390/" rel="tag">TG-3390</a>, <a href="https://unit42.paloaltonetworks.com/tag/webshell/" rel="tag">webshell</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="900" height="450" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1-900x450.png" class="attachment-single size-single" alt="" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1-900x450.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1-300x150.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1-768x384.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1-1024x512.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1-370x185.png 370w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/Espionage-r3d1.png 2001w" sizes="(max-width: 900px) 100vw, 900px" />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/emissary-panda-attacks-middle-east-government-sharepoint-servers/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja"></span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><p><span style="font-weight: 400; font-size: 18pt;">Executive Summary</span></p>
<p><span style="font-weight: 400;">In April 2019, Unit 42 observed the Emissary Panda (AKA APT27, TG-3390, Bronze Union, Lucky Mouse) threat group installing webshells on SharePoint servers to compromise Government Organizations of two different countries in the Middle East. We believe the adversary exploited a recently </span><a href="https://support.microsoft.com/en-us/help/4462211/description-of-the-security-update-for-sharepoint-enterprise-server"><span style="font-weight: 400;">patched</span></a><span style="font-weight: 400;"> vulnerability in Microsoft SharePoint tracked by </span><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-0604"><span style="font-weight: 400;">CVE-2019-0604</span></a><span style="font-weight: 400;">, which is a remote code execution vulnerability used to compromise the server and eventually install a webshell. The actors uploaded a variety of tools that they used to perform additional activities on the compromised network, such as dumping credentials, as well as locating and pivoting to additional systems on the network. Of particular note is their use of tools to identify systems vulnerable to </span><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2017-0144"><span style="font-weight: 400;">CVE-2017-0144</span></a><span style="font-weight: 400;">, which is the same vulnerability exploited by EternalBlue that is best known for its use in the WannaCry attacks of 2017.</span></p>
<p><span style="font-weight: 400;">This activity appears related to campaigns exploiting CVE-2019-0604 mentioned in recent security alerts from </span><a href="https://www.ncsc.gov.sa/wps/portal/ncsc/home/Alerts/!ut/p/z1/lVLRboJAEPwaH8kud-cBj2elYKkxYgpyLwYR67VyaEts-_c9apM2aYS6T3PJ3O7szIKEJUidn9Rj3qha53vzziRf2fbYDUmA9zMnGqMYzRe3QxpQMUVIQIIsdHNodpDp4rXYq_UAWzDAXV2VZ7xq4arULflQqA1khBPGiyGxkOWOxYiXW57tEWvLGS9dToi33kD6NR0njIU2I9EsRkRBkzCk7o2NAQX5W5w7cgTOEZOJmER0HvHv_x0E2b1cz3zyv_l4oQReqf-vQNndfmEcvzuTLntoIlZPx6MUJsdaN-V7A8v-INM2yh5z-uRlZj3nZ70g8bjpEDt-Evt0ljBIT6p8gwddv1TmFhdXXk-IcKgql34oU1aQWs_bqU_ZJ0-OxIA!/dz/d5/L2dBISEvZ0FBIS9nQSEh/#collapseOne1"><span style="font-weight: 400;">Saudi Arabian National Cyber Security Center</span></a><span style="font-weight: 400;"> and the </span><a href="https://cyber.gc.ca/en/alerts/china-chopper-malware-affecting-sharepoint-servers"><span style="font-weight: 400;">Canadian Center for Cyber Security</span></a><span style="font-weight: 400;">. In addition to the aforementioned post-exploitation tools, the actors used these webshells to upload legitimate executables that they would use DLL sideloading to run a malicious DLL that has code overlaps with known </span><a href="https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2018/may/emissary-panda-a-potential-new-malicious-tool/"><span style="font-weight: 400;">Emissary Panda attacks</span></a><span style="font-weight: 400;">. We also found the China Chopper webshell on the SharePoint servers, which has also been used by the Emissary Panda threat group.</span></p>
<p><span style="font-weight: 400;">In this blog, we provide details of the tools and tactics we observed on these compromised SharePoint servers, explain how we believe these connect to the Emissary Panda threat group, correlate our findings with those of the Saudi Arabian National Cyber Security Center and the Canadian Center for Cyber Security, and provide indicators of compromise (IoCs) from our research. You can find the Adversary Playbook for the activity detailed in this blog <a href="https://pan-unit42.github.io/playbook_viewer/">here</a>.</span></p>
<p><span style="font-weight: 400; font-size: 18pt;">Attack Overview</span></p>
<p><span style="font-weight: 400;">This webshell activity took place across three SharePoint servers hosted by two different government organizations between April 1, 2019 and April 16, 2019, where actors uploaded a total of 24 unique executables across the three SharePoint servers. </span><span style="font-weight: 400;">Figure 1</span><span style="font-weight: 400;"> shows a timeline of when the files were uploaded to the three webshells. The timeline shows three main clusters of activity across the three webshells, with activity occurring on two separate webshells (green and orange) within a very small window of time on April 2, 2019 and the activity involving the third webshell two weeks later on April 16, 2019. The actors uploaded several of the same tools to across these three webshells, which provides a relationship between the incidents and indicates that a single threat group is likely involved.</span></p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image7-1.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-97003" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image7-1.png" alt="" width="1490" height="556" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image7-1.png 1490w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image7-1-300x112.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image7-1-768x287.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image7-1-1024x382.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image7-1-900x336.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image7-1-370x138.png 370w" sizes="(max-width: 1490px) 100vw, 1490px" /></a><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Figure 1. Timeline of file uploads across three related webshells</span></i></span></p>
<p><span style="font-weight: 400;">The tools uploaded to the webshells range from legitimate applications such as cURL to post-exploitation tools such as Mimikatz. The threat actors also uploaded tools to scan for and exploit potential vulnerabilities in the network, such as the well-known SMB vulnerability patched in </span><a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010"><span style="font-weight: 400;">MS17-010</span></a><span style="font-weight: 400;"> commonly exploited by EternalBlue to move laterally to other systems on the network. We also observed the actors uploading custom backdoors such as </span><a href="https://securelist.com/luckymouse-hits-national-data-center/86083/"><span style="font-weight: 400;">HyperBro which is commonly associated with Emissary Panda</span></a><span style="font-weight: 400;">. Based on the functionality of the various tools uploaded to the webshells, we believe the threat actors breach the SharePoint servers to use as a beachhead, then attempt to move laterally across the network via stolen credentials and exploiting vulnerabilities. </span></p>
<p><span style="font-weight: 400; font-size: 18pt;">Webshells Installed</span></p>
<p><span style="font-weight: 400;">As previously mentioned, we found webshells installed on three SharePoint servers hosted at two different organizations, two of which had the same file name of </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">errr.aspx</span><span style="font-weight: 400;"> and the other a filename of</span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;"> error2.aspx</span><span style="font-weight: 400;">. The webshells were hosted at the following paths on the compromised servers:</span></p>
<p><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">/_layouts/15/error2.aspx</span></p>
<p><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">/_layouts/15/errr.aspx</span></p>
<p><span style="font-weight: 400;">We were able to gather one of the webshells with which we saw the actor interacting, specifically the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">error2.aspx</span><span style="font-weight: 400;"> file listed above. The </span><span style="font-weight: 400;">error2.aspx</span><span style="font-weight: 400;"> file (SHA256: </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">006569f0a7e501e58fe15a4323eedc08f9865239131b28dc5f95f750b4767b38</span><span style="font-weight: 400;">) is a variant of the </span><a href="http://www.labofapenetrationtester.com/2014/06/introducing-antak.html"><span style="font-weight: 400;">Antak webshell</span></a><span style="font-weight: 400;">, which is part of a tool created for red teaming called </span><a href="https://github.com/samratashok/nishang"><span style="font-weight: 400;">Nishang</span></a><span style="font-weight: 400;">. The specific variant of Antak in </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">error2.aspx</span><span style="font-weight: 400;"> is version v0.5.0, which is an older version of the webshell that was updated in August 2015 to v0.7.6 to include some basic authentication functionality and the ability to perform SQL queries. Its possible the actors obtained Antak v0.5.0 via the </span><a href="https://github.com/samratashok/nishang"><span style="font-weight: 400;">Nishang GitHub repository</span></a><span style="font-weight: 400;"> or from </span><a href="https://github.com/SecWiki/WebShell-2/blob/master/Aspx/Antak%20Webshell.aspx"><span style="font-weight: 400;">SecWikis GitHub</span></a><span style="font-weight: 400;"> that also has the v0.5.0 version of Antak. </span><span style="font-weight: 400;">Figure 2 </span><span style="font-weight: 400;">shows the Antak webshell loaded on one of the Sharepoint servers. </span></p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image8.png" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-96988" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image8.png" alt="" width="1477" height="958" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image8.png 1477w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image8-300x195.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image8-768x498.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image8-1024x664.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image8-900x584.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image8-370x240.png 370w" sizes="(max-width: 1477px) 100vw, 1477px" /></a><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Figure 2. Antak webshell error2.aspx used to upload post-exploitation tools</span></i></span></p>
<p><span style="font-weight: 400;">While we observed the threat actor uploading additional tools to the Antak webshell above, the Sharepoint server also had several other webshells installed. The additional webshells, specifically </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecs.aspx</span><span style="font-weight: 400;">, </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecss.aspx, </span><span style="font-weight: 400;">and</span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;"> test.aspx </span><span style="font-weight: 400;">are listed in </span><span style="font-weight: 400;">Table 1</span><span style="font-weight: 400;">, and appear related to the China Chopper webshell. We cannot be sure all of these webshells were installed by the same actors, as multiple actors could have exploited the SharePoint server. For instance, the China Chopper-related webshells are one-line of JScript code that could be easily copied and used by multiple groups, and the Antak webshell is easily obtained from publicly accessible repositories. However, the installation of China Chopper and the uploading of Emissary Panda related custom payloads to the Antak webshell suggests they are likely related, as this threat group has used</span><a href="https://www.secureworks.com/research/threat-group-3390-targets-organizations-for-cyberespionage"><span style="font-weight: 400;"> China Chopper to compromise servers in the past</span></a><span style="font-weight: 400;">.</span></p>
<table>
<tbody>
<tr>
<td style="width: 91px;"><b>Filename</b></td>
<td style="width: 546px;"><b>SHA256</b></td>
</tr>
<tr>
<td style="width: 91px;"><span style="font-weight: 400;">stylecs.aspx</span></td>
<td style="width: 546px;"><span style="font-weight: 400;">2feae7574a2cc4dea2bff4eceb92e3a77cf682c0a1e78ee70be931a251794b86</span></td>
</tr>
<tr>
<td style="width: 91px;"><span style="font-weight: 400;">stylecss.aspx</span></td>
<td style="width: 546px;"><span style="font-weight: 400;">d1ab0dff44508bac9005e95299704a887b0ffc42734a34b30ebf6d3916053dbe</span></td>
</tr>
<tr>
<td style="width: 91px;"><span style="font-weight: 400;">test.aspx</span></td>
<td style="width: 546px;"><span style="font-weight: 400;">6b3f835acbd954af168184f57c9d8e6798898e9ee650bd543ea6f2e9d5cf6378</span></td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Table 1. Additional webshells hosted on Sharepoint server</span></i></span></p>
<p><span style="font-weight: 400;">The </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecs.aspx</span><span style="font-weight: 400;"> webshell provides fairly significant functionality, as its developer wrote this webshell in JScript that ultimately runs any supplied JScript code provided to it within the HTTP request. </span><span style="font-weight: 400;">Figure 3</span><span style="font-weight: 400;"> shows this webshells code that will run supplied JScript provided in base64 encoded format within the URL within a parameter </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">e358efa489f58062f10dd7316b65649e</span><span style="font-weight: 400;">. The parameter </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">e358efa489f58062f10dd7316b65649e</span><span style="font-weight: 400;"> is interesting as it is the MD5 hash for the letter t, which is a known parameter for China Chopper as mentioned in the next section.</span></p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image9.png" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-96989" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image9.png" alt="" width="664" height="36" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image9.png 664w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image9-300x16.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image9-370x20.png 370w" sizes="(max-width: 664px) 100vw, 664px" /></a><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Figure 3. China Chopper code found in </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">stylecs.aspx</span></i></span><i><span style="font-weight: 400;"> webshell on SharePoint server</span></i></span></p>
<p><span style="font-weight: 400;">The </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecss.aspx</span><span style="font-weight: 400;"> webshell is very similar to the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecs.aspx</span><span style="font-weight: 400;">, as it runs JScript provided within the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">e358efa489f58062f10dd7316b65649e</span><span style="font-weight: 400;"> parameter of the URL; however, the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecss.aspx</span><span style="font-weight: 400;"> webshell does not accept base64 encoded JScript, but expects the JScript in cleartext that the actor would provide as URL safe text. </span><span style="font-weight: 400;">Figure 4 </span><span style="font-weight: 400;">shows the code within </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecss.aspx</span><span style="font-weight: 400;">, which when compared to</span><span style="font-weight: 400;"> Figure 3</span><span style="font-weight: 400;"> above shows the lack of the base64 decoding function FromBase64String.</span></p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image1.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-96982" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image1.png" alt="" width="682" height="22" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image1.png 682w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image1-300x10.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image1-370x12.png 370w" sizes="(max-width: 682px) 100vw, 682px" /></a><br />
<span style="font-size: 10pt;"><i><span style="font-weight: 400;">Figure 4. China Chopper code found in </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">stylecss.aspx</span></i></span><i><span style="font-weight: 400;"> webshell on SharePoint server</span></i></span></p>
<p><span style="font-weight: 400;">The last webshell extracted from the Sharepoint server had a filename of </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">test.aspx</span><span style="font-weight: 400;">, which is very similar to the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecs.aspx </span><span style="font-weight: 400;">webshell as it runs base64 encoded JScript provided in the URL of the request. However, the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">test.aspx</span><span style="font-weight: 400;"> webshell uses a parameter related to the compromised organization to obtain the base64 encoded JScript that it will run and display within the browser. The</span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;"> test.aspx</span><span style="font-weight: 400;"> shell also includes code that sets the HTTP response status to a </span><span style="font-weight: 400;">404 Not Found</span><span style="font-weight: 400;">, which will display an error page but will still run the provided JScript. </span><span style="font-weight: 400;">Figure 5</span><span style="font-weight: 400;"> shows the code within the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">test.aspx</span><span style="font-weight: 400;"> file. </span></p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image3.png" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-96983" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image3.png" alt="" width="720" height="35" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image3.png 720w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image3-300x15.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image3-370x18.png 370w" sizes="(max-width: 720px) 100vw, 720px" /></a><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Figure 5. China Chopper code found in </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">test.aspx</span></i></span><i><span style="font-weight: 400;"> webshell on SharePoint server</span></i></span></p>
<p><span style="font-weight: 400; font-size: 18pt;">Links to Security Advisories</span></p>
<p><span style="font-weight: 400;">In April 2019, several national security organizations released alerts on CVE-2019-0604 exploitation, including the</span><a href="https://www.ncsc.gov.sa/wps/portal/ncsc/home/Alerts/!ut/p/z1/lVLRboJAEPwaH8kud-cBj2elYKkxYgpyLwYR67VyaEts-_c9apM2aYS6T3PJ3O7szIKEJUidn9Rj3qha53vzziRf2fbYDUmA9zMnGqMYzRe3QxpQMUVIQIIsdHNodpDp4rXYq_UAWzDAXV2VZ7xq4arULflQqA1khBPGiyGxkOWOxYiXW57tEWvLGS9dToi33kD6NR0njIU2I9EsRkRBkzCk7o2NAQX5W5w7cgTOEZOJmER0HvHv_x0E2b1cz3zyv_l4oQReqf-vQNndfmEcvzuTLntoIlZPx6MUJsdaN-V7A8v-INM2yh5z-uRlZj3nZ70g8bjpEDt-Evt0ljBIT6p8gwddv1TmFhdXXk-IcKgql34oU1aQWs_bqU_ZJ0-OxIA!/dz/d5/L2dBISEvZ0FBIS9nQSEh/#collapseOne1"><span style="font-weight: 400;"> Saudi Arabian National Cyber Security Center</span></a><span style="font-weight: 400;"> and the </span><a href="https://cyber.gc.ca/en/alerts/china-chopper-malware-affecting-sharepoint-servers"><span style="font-weight: 400;">Canadian Center for Cyber Security</span></a><span style="font-weight: 400;">. Both of these alerts discussed campaigns in which actors used the CVE-2019-0604 to exploit SharePoint servers to install the China Chopper webshell. While we cannot confirm all of the claims made in these advisories, we noticed overlaps in the webshell code hosted on the compromised SharePoint servers we observed and the webshells mentioned in these advisories.</span></p>
<p><span style="font-weight: 400;">The Saudi Arabian National Cyber Security Centers alert provided details regarding the activities carried out by the adversary. This alert also displayed the code associated with the China Chopper webshell observed in the attacks, which included </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">Request.Item[&#8220;t&#8221;] </span><span style="font-weight: 400;">to obtain JScript code from the t parameter of the URL. As mentioned in the previous section, </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecs.aspx</span><span style="font-weight: 400;"> and </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecss.aspx</span><span style="font-weight: 400;"> both used a parameter of </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">e358efa489f58062f10dd7316b65649e</span><span style="font-weight: 400;">, which is the MD5 hash of t. This may suggest the actor modified the script slightly between the attack we observed, and the attack mentioned in the NCSC advisory, all while retaining the same functionality. Also, the NCSC advisory mentioned that the actors used a file name </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecss.aspx</span><span style="font-weight: 400;"> for their webshell, which is the same filename we saw associated with China Chopper. </span></p>
<p><span style="font-weight: 400;">The alert from the Canadian Center for Cyber Security included the SHA256 hashes of the files associated with the campaign, one of which was </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">05108ac3c3d708977f2d679bfa6d2eaf63b371e66428018a68efce4b6a45b4b4</span><span style="font-weight: 400;"> for a file named </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">pay.aspx</span><span style="font-weight: 400;">. The </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">pay.aspx</span><span style="font-weight: 400;"> file is part of the China Chopper webshell and is very similar to the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecss.aspx</span><span style="font-weight: 400;"> webshell we discussed above, with the only major difference is the URL parameter of vuiHWNVJAEF within the URL that </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">pay.aspx</span><span style="font-weight: 400;"> webshell uses to obtain and run JScript. </span><span style="font-weight: 400;">Figure 6</span><span style="font-weight: 400;"> below shows a comparison between the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">stylecss.aspx</span><span style="font-weight: 400;"> and</span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;"> pay.aspx </span><span style="font-weight: 400;">files.</span></p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image2.png" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-96981" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image2.png" alt="" width="1273" height="89" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image2.png 1273w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image2-300x21.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image2-768x54.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image2-1024x72.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image2-900x63.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image2-370x26.png 370w" sizes="(max-width: 1273px) 100vw, 1273px" /></a><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Figure 6. Comparison between </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">stylecss.aspx</span></i></span><i><span style="font-weight: 400;"> webshell and </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">pay.aspx</span></i></span><i><span style="font-weight: 400;"> webshell discussed in Canadian Center for Cyber Security advisory</span></i></span></p>
<p><span style="font-weight: 400; font-size: 18pt;">Tools Uploaded</span></p>
<p><span style="font-weight: 400;">During our research into this attack campaign, Unit 42 gathered several tools that the actor uploaded to the three webshells at the two government organizations. The chart in </span><span style="font-weight: 400;">Figure 7</span><span style="font-weight: 400;"> shows the same tools being uploaded to the webshells, which provided an initial linkage between the activities. One of the overlapping tools uploaded to the webshells is the legitimate cURL application, which could be used by multiple groups. The other overlapping files are tools used by the adversary to locate other systems on the network (</span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">etool.exe</span><span style="font-weight: 400;">), check to see if they are vulnerable to CVE-2017-0144 (EternalBlue) patched in MS07-010 (</span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">checker1.exe</span><span style="font-weight: 400;">) and pivot to them using remote execution functionality offered by a tool similar to PsExec offered by </span><a href="https://github.com/SecureAuthCorp/impacket"><span style="font-weight: 400;">Impacket</span></a><span style="font-weight: 400;"> (</span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">psexec.exe</span><span style="font-weight: 400;">). These tools are not custom made by the adversary but still provide a medium confidence linkage between the activities. We also observed the actors uploading the HyperBro backdoor to one of the webshells, as well as legitimate executables that would sideload malicious DLLs that have overlapping code associated with known Emissary Panda activity. </span></p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image6-1.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-97005 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image6-1.png" alt="" width="3250" height="1390" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image6-1.png 3250w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image6-1-300x128.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image6-1-768x328.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image6-1-1024x438.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image6-1-900x385.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image6-1-370x158.png 370w" sizes="(max-width: 3250px) 100vw, 3250px" /></a></p>
<p style="text-align: center;"><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Figure 7. Relationships between tools uploaded to the three webshells hosted on SharePoint servers</span></i></span></p>
<p><span style="font-weight: 400;">The actors uploaded 10 portable executables to the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">error2.aspx</span><span style="font-weight: 400;"> webshell, as seen in </span><span style="font-weight: 400;">Table 2. </span><span style="font-weight: 400;">The list of tools uploaded to this webshell includes legitimate applications, such as cURL and a component of Sublime Text used to sideload a malicious DLL, which we will discuss in an upcoming section. The list also includes several hack tools, such as Mimikatz for credential dumping and several compiled python scripts used to locate and compromise other systems on the local network. Lastly, we saw the actor uploading a custom backdoor called HyperBro, which has been associated with Emissary Panda operations in the past. We will provide an analysis of the HyperBro tool in an upcoming section. </span></p>
<table>
<tbody>
<tr>
<td><b>Filename</b></td>
<td><b>SHA256</b></td>
<td><b>Description</b></td>
</tr>
<tr>
<td><span style="font-weight: 400;">m2.exe</span></td>
<td><span style="font-weight: 400;">b279a41359367408c627ffa8d80051ed0f04c76fbf6aed79b3b2963203e08ade</span></td>
<td><span style="font-weight: 400;">Packed Mimikatz tool.</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">psexec.exe</span></td>
<td><span style="font-weight: 400;">7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7</span></td>
<td><span style="font-weight: 400;">Compiled </span><a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py"><span style="font-weight: 400;">Impacket psexec</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">s.exe</span></td>
<td><span style="font-weight: 400;">04f48ed27a83a57a971e73072ac5c769709306f2714022770fb364fd575fd462</span></td>
<td><span style="font-weight: 400;">HyperBro backdoor</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">curl.exe</span></td>
<td><span style="font-weight: 400;">abc16344cdfc78f532870f4dcfbb75794c9a7074e796477382564d7ba2122c7d</span></td>
<td><span style="font-weight: 400;">Legitimate cURL</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">curl.exe</span></td>
<td><span style="font-weight: 400;">bbb9cd70fdc581812822679e6a875dcf5b7d32fd529a1d564948a5a3f6f9e3ab</span></td>
<td><span style="font-weight: 400;">Legitimate cURL</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">checker1.exe</span></td>
<td><span style="font-weight: 400;">090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98</span></td>
<td><span style="font-weight: 400;">Compiled </span><a href="https://github.com/3ndG4me/AutoBlue-MS17-010/blob/master/eternalblue_checker.py"><span style="font-weight: 400;">EternalBlue checker script</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">etool.exe</span></td>
<td><span style="font-weight: 400;">38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c</span></td>
<td><span style="font-weight: 400;">C# Tool, likely from </span><a href="https://github.com/mubix/netview."><span style="font-weight: 400;">https://github.com/mubix/netview</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">plugin_host.exe</span></td>
<td><span style="font-weight: 400;">738abaa80e8b6ed21e16302cb91f6566f9322aebf7a22464f11ee9f4501da711</span></td>
<td><span style="font-weight: 400;">Legitimate Sublime Text plugin host</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">PYTHON33.dll</span></td>
<td><span style="font-weight: 400;">2dde8881cd9b43633d69dfa60f23713d7375913845ac3fe9b4d8a618660c4528</span></td>
<td><span style="font-weight: 400;">Sideloaded DLL loaded by Sublime Text</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">curl.exe</span></td>
<td><span style="font-weight: 400;">bbb9cd70fdc581812822679e6a875dcf5b7d32fd529a1d564948a5a3f6f9e3ab</span></td>
<td><span style="font-weight: 400;">Legitimate cURL.</span></td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Table 2. Unique tools uploaded to the </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">error2.aspx</span></i></span><i><span style="font-weight: 400;"> webshell installed on a SharePoint server</span></i></span></p>
<p><span style="font-weight: 400;">We saw 17 tools uploaded to the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">errr.aspx</span><span style="font-weight: 400;"> webshell hosted on the SharePoint server of one of the government organizations, which is in the middle of the chart in </span><span style="font-weight: 400;">Figure 7. Table 3</span><span style="font-weight: 400;"> shows all of the tools we observed the actor uploading to the webshell, which includes a list of tools used to dump credentials, locate, and exploit remote systems, as well as pivoting to other systems on the network. </span></p>
<table>
<tbody>
<tr>
<td><b>Filename</b></td>
<td><b>SHA256</b></td>
<td><b>Description</b></td>
</tr>
<tr>
<td><span style="font-weight: 400;">smb1.exe</span></td>
<td><span style="font-weight: 400;">88027a44dc82a97e21f04121eea2e86b4ddf1bd7bbaa4ad009b97b50307570bd</span></td>
<td><span style="font-weight: 400;">SMB backdoor based on </span><a href="https://github.com/abatchy17/WindowsExploits/blob/master/MS08-068/src/smbrelay3.cpp"><span style="font-weight: 400;">smbrelay3</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">mcmd.exe</span></td>
<td><span style="font-weight: 400;">738128b4f42c8d2335d68383d72734130c0c4184725c06851498a4cf0374a841</span></td>
<td><span style="font-weight: 400;">Compiled </span><a href="https://github.com/worawit/MS17-010/blob/master/zzz_exploit.py"><span style="font-weight: 400;">zzz_exploit.py</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">mcafee.exe</span></td>
<td><span style="font-weight: 400;">3bca0bb708c5dad1c683c6ead857a5ebfa15928a59211432459a3efa6a1afc59</span></td>
<td><span style="font-weight: 400;">Compiled </span><a href="https://github.com/worawit/MS17-010/blob/master/zzz_exploit.py"><span style="font-weight: 400;">zzz_exploit.py</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">dump.exe</span></td>
<td><span style="font-weight: 400;">29897f2ae25017455f904595872f2430b5f7fedd00ff1a46f1ea77e50940128e</span></td>
<td><span style="font-weight: 400;">pwdump</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">checker1.exe</span></td>
<td><span style="font-weight: 400;">d0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963da38e0b1333</span></td>
<td><span style="font-weight: 400;">Compiled MS17-010 </span><a href="https://github.com/worawit/MS17-010/blob/master/checker.py"><span style="font-weight: 400;">checker</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">memory.exe</span></td>
<td><span style="font-weight: 400;">a18326f929229da53d4cc340bde830f75e810122c58b523460c8d6ba62ede0e5</span></td>
<td><span style="font-weight: 400;">Packed Mimikatz</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">checker.exe</span></td>
<td><span style="font-weight: 400;">090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98</span></td>
<td><span style="font-weight: 400;">Compiled MS17-010 </span><a href="https://github.com/worawit/MS17-010/blob/master/checker.py"><span style="font-weight: 400;">checker</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">psexec.exe</span></td>
<td><span style="font-weight: 400;">7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7</span></td>
<td><span style="font-weight: 400;">Compiled </span><a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py"><span style="font-weight: 400;">Impacket psexec</span></a><span style="font-weight: 400;">.</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">etool.exe</span></td>
<td><span style="font-weight: 400;">38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c</span></td>
<td><span style="font-weight: 400;">C# Tool, likely from </span><a href="https://github.com/mubix/netview"><span style="font-weight: 400;">https://github.com/mubix/netview</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">smb.exe</span></td>
<td><span style="font-weight: 400;">4a26ec5fd16ee13d869d6b0b6177e570444f6a007759ea94f1aa18fa831290a8</span></td>
<td><span style="font-weight: 400;">SMB backdoor based on </span><a href="https://github.com/abatchy17/WindowsExploits/blob/master/MS08-068/src/smbrelay3.cpp"><span style="font-weight: 400;">smbrelay3</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">agent_Win32.exe</span></td>
<td><span style="font-weight: 400;">b2b2e900aa2e96ff44610032063012aa0435a47a5b416c384bd6e4e58a048ac9</span></td>
<td><a href="https://klionsec.github.io/2017/11/02/termite/"><span style="font-weight: 400;">Termite</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">smb_exec.exe</span></td>
<td><span style="font-weight: 400;">475c7e88a6d73e619ec585a7c9e6e57d2efc8298b688ebc10a3c703322f1a4a7</span></td>
<td><a href="https://github.com/abatchy17/WindowsExploits/blob/master/MS08-068/src/httprelay.cpp"><span style="font-weight: 400;">httprelay</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">curl.exe</span></td>
<td><span style="font-weight: 400;">bbb9cd70fdc581812822679e6a875dcf5b7d32fd529a1d564948a5a3f6f9e3ab</span></td>
<td><span style="font-weight: 400;">Legitimate cURL</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">incognito.exe</span></td>
<td><span style="font-weight: 400;">9f5f3a9ce156213445d08d1a9ea99356d2136924dc28a8ceca6d528f9dbd718b</span></td>
<td><a href="https://github.com/mwrlabs/incognito"><span style="font-weight: 400;">Incognito</span></a><span style="font-weight: 400;"> </span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">nbtscan.exe</span></td>
<td><span style="font-weight: 400;">c9d5dc956841e000bfd8762e2f0b48b66c79b79500e894b4efa7fb9ba17e4e9e</span></td>
<td><span style="font-weight: 400;">nbtscan</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">fgdump.exe</span></td>
<td><span style="font-weight: 400;">a6cad2d0f8dc05246846d2a9618fc93b7d97681331d5826f8353e7c3a3206e86</span></td>
<td><span style="font-weight: 400;">pwdump</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">smbexec.exe</span></td>
<td><span style="font-weight: 400;">e781ce2d795c5dd6b0a5b849a414f5bd05bb99785f2ebf36edb70399205817ee</span></td>
<td><span style="font-weight: 400;">Compiled </span><a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbexec.py"><span style="font-weight: 400;">Impacket smbexec</span></a></td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Table 3. Unique tools uploaded to the </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">errr.aspx</span></i></span><i><span style="font-weight: 400;"> webshell installed on a SharePoint server</span></i></span></p>
<p><span style="font-weight: 400;">Two of the tools, specifically the compiled </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">zzz_exploit.py</span><span style="font-weight: 400;"> and </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">checker.py</span><span style="font-weight: 400;"> suggest the actor would check and exploit remote systems if they were not patched for MS17-010, which patched the CVE-2017-0144 (EternalBlue) vulnerability. Also, the use of the Mimikatz and pwdump tools suggests the adversary attempts to dump credentials on compromised systems. We were able to gather the command line arguments the actor used to run the SMB backdoor </span><span style="font-weight: 400;">smb1.exe</span><span style="font-weight: 400;">. The following arguments shows the actor using the SMB backdoor to attempt to run a batch script </span><span style="font-weight: 400;">m.bat</span><span style="font-weight: 400;"> on a remote host using a domain username and the accounts password hash:</span></p>
<p><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">c:\programdata\smb1.exe &lt;redacted 10.0.0.0/8 IP&gt; &lt;redacted domain&gt;\&lt;redacted username&gt; :&lt;redacted password hash&gt; winsk c:\programdata\m.bat</span></p>
<p><span style="font-weight: 400;">We saw far fewer portable executable files uploaded to the second </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">errr.aspx</span><span style="font-weight: 400;"> webshell, specifically the 3 files seen in </span><span style="font-weight: 400;">Table 4</span><span style="font-weight: 400;">. The files uploaded to this webshell included the same compiled python script that would scan remote systems that were vulnerable to CVE-2017-0144 (EternalBlue) that we saw uploaded to the other </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">errr.aspx</span><span style="font-weight: 400;"> webshell. Also, we observed the actor uploading a legitimate Microsoft application that would sideload a malicious DLL, of which was very similar to the DLL sideloaded by the Sublime Text plugin host that was uploaded to the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">error2.aspx</span><span style="font-weight: 400;"> webshell. </span></p>
<table>
<tbody>
<tr>
<td><b>Filename</b></td>
<td><b>SHA256</b></td>
<td><b>Description</b></td>
</tr>
<tr>
<td><span style="font-weight: 400;">checker1.exe</span></td>
<td><span style="font-weight: 400;">d0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963da38e0b1333</span></td>
<td><span style="font-weight: 400;">Compiled MS17-010 </span><a href="https://github.com/worawit/MS17-010/blob/master/checker.py"><span style="font-weight: 400;">checker</span></a></td>
</tr>
<tr>
<td><span style="font-weight: 400;">CreateMedia.exe</span></td>
<td><span style="font-weight: 400;">2bb22c7b97e4c4d07e17a259cbc48d72f7e3935aa873e3dd78d01c5bbf426088</span></td>
<td><span style="font-weight: 400;">Legitimate CreateMedia.exe application from Microsoft&#8217;s System Center 2012 Configuration Manager</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">CreateTsMediaAdm.dll</span></td>
<td><span style="font-weight: 400;">06510504f30feb1adc7e423d5a24e67e5b97acbfafe40f253a054be8b1c4e8d7</span></td>
<td><span style="font-weight: 400;">Sideloaded DLL loaded by CreateMedia.exe</span></td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Table 4. Unique tools uploaded to the </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">errr.aspx</span></i></span><i><span style="font-weight: 400;"> webshell installed on a SharePoint server</span></i></span></p>
<p><span style="font-weight: 400; font-size: 18pt;">Emissary Panda Specific Tools</span></p>
<p><span style="font-weight: 400;">Many of the tools uploaded to these webshells are hacking tools that are publicly accessible and could be used by multiple threat actors. However, several of the tools uploaded to the webshells appear to be custom made and likely related to the Emissary Panda threat group. </span></p>
<p><span style="font-weight: 400; font-size: 14pt;">HyperBro</span></p>
<p><span style="font-weight: 400;">The </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">s.exe</span><span style="font-weight: 400;"> (SHA256: </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">04f48ed27a83a57a971e73072ac5c769709306f2714022770fb364fd575fd462</span><span style="font-weight: 400;">) uploaded to the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">error2.aspx</span><span style="font-weight: 400;"> webshell is a self-extracting 7-zip archive that is an example of the HyperBro backdoor. According to </span><a href="https://securelist.com/luckymouse-hits-national-data-center/86083/"><span style="font-weight: 400;">Kaspersky</span></a><span style="font-weight: 400;"> and </span><a href="https://www.secureworks.com/research/a-peek-into-bronze-unions-toolbox"><span style="font-weight: 400;">SecureWorks</span></a><span style="font-weight: 400;"> research, HyperBro is a custom backdoor developed and used by Emissary Panda in their attack campaigns. This sample of HyperBro is similar to the sample discussed in Kasperskys research, specifically using a legitimate pcAnywhere application to sideload a DLL to decrypt, decompress and run a payload embedded within a file named thumb.db. </span><span style="font-weight: 400;">Table 5</span><span style="font-weight: 400;"> shows the three files associated with this HyperBro sample, which have the same file names as the self-extracting 7zip archives mentioned in Kasperskys blog (SHA256 hashes: </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">34a542356ac8a3f6e367c6827b728e18e905c71574b3813f163e043f70aa3bfa</span><span style="font-weight: 400;"> and </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">2144aa68c7b2a6e3511e482d6759895210cf60c67f14b9485a0236af925d8233</span><span style="font-weight: 400;">).</span></p>
<p>&nbsp;</p>
<table>
<tbody>
<tr>
<td><b>Filename</b></td>
<td><b>SHA256</b></td>
<td><b>Description</b></td>
</tr>
<tr>
<td><span style="font-weight: 400;">thinprobe.exe</span></td>
<td><span style="font-weight: 400;">76d2e897ca235beab44ee7eaab9ede7bc7868bbaeb7d6cb10b4323c07eb216af</span></td>
<td><span style="font-weight: 400;">Symantec pcAnywhere thinprobe application </span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">thinhostprobedll.dll </span></td>
<td><span style="font-weight: 400;">d40414b1173d59597ed1122361fe60303d3526f15320aede355c6ad9e7e239af</span></td>
<td><span style="font-weight: 400;">Sideloaded DLL loaded by thinprobe.exe</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">thumb.db</span></td>
<td><span style="font-weight: 400;">270ea24f2cef655bd89439ab76c1d49c80caaa8899ffa6f0ef36dc1beb894530</span></td>
<td><span style="font-weight: 400;">Contains encrypted and compressed DLL payload run by sideloaded DLL</span></td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Table 5. Files associated with the HyperBro tool uploaded to webshell on SharePoint server</span></i></span></p>
<p><span style="font-weight: 400;">The functional payload is a DLL compiled on 2019-03-11 02:23:54, which has two functionalities depending if the binary has a command line argument </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">-daemon</span><span style="font-weight: 400;"> or </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">-worker</span><span style="font-weight: 400;"> passed to it. The </span><span style="font-weight: 400;">daemon</span><span style="font-weight: 400;"> functionality handles the C2 communications portion of the Trojan, which is configured to communicate with </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">185.12.45[.]134 </span><span style="font-weight: 400;">over HTTPS using the following URL:</span></p>
<p><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">hxxps://185.12.45[.]134:443/ajax</span></p>
<p><span style="font-weight: 400;">The </span><span style="font-weight: 400;">worker</span><span style="font-weight: 400;"> functionality acts on the data received from the C2 server, which is passed from the </span><span style="font-weight: 400;">daemon</span><span style="font-weight: 400;"> to the </span><span style="font-weight: 400;">worker</span><span style="font-weight: 400;"> via a named pipe called &#8220;</span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">\\.\pipe\testpipe</span><span style="font-weight: 400;">&#8220;. The worker subjects the received data to a command handler whose available commands are listed in </span><span style="font-weight: 400;">Table 6</span><span style="font-weight: 400;">. </span></p>
<table>
<tbody>
<tr>
<td><b>Command</b></td>
<td><b>Sub-command</b></td>
<td><b>Description</b></td>
</tr>
<tr>
<td><span style="font-weight: 400;">0x12</span></td>
<td></td>
<td><span style="font-weight: 400;">File manager</span></td>
</tr>
<tr>
<td></td>
<td><span style="font-weight: 400;">0x10</span></td>
<td><span style="font-weight: 400;">Enumerate logical storage volumes</span></td>
</tr>
<tr>
<td></td>
<td><span style="font-weight: 400;"> 0x11</span></td>
<td><span style="font-weight: 400;">Delete a specified file</span></td>
</tr>
<tr>
<td></td>
<td><span style="font-weight: 400;">0x12</span></td>
<td><span style="font-weight: 400;">Upload a file</span></td>
</tr>
<tr>
<td></td>
<td><span style="font-weight: 400;">0x13</span></td>
<td><span style="font-weight: 400;">Download a file</span></td>
</tr>
<tr>
<td></td>
<td><span style="font-weight: 400;">0x17</span></td>
<td><span style="font-weight: 400;">List contents of a folder</span></td>
</tr>
<tr>
<td></td>
<td><span style="font-weight: 400;">0x19</span></td>
<td><span style="font-weight: 400;">Run an application (CreateProcessW) or script/file (ShellExecuteW)</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">0x13</span></td>
<td></td>
<td><span style="font-weight: 400;">Execute command on shell</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">0x16</span></td>
<td></td>
<td><span style="font-weight: 400;">Takes screenshot</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">0x19</span></td>
<td></td>
<td><span style="font-weight: 400;">Runs shellcode it injects into a newly created process &#8216;msiexec.exe&#8217;</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">0x1a</span></td>
<td></td>
<td><span style="font-weight: 400;">Kill specific process</span></td>
</tr>
<tr>
<td><span style="font-weight: 400;">0x1e</span></td>
<td></td>
<td><span style="font-weight: 400;">Service manager</span></td>
</tr>
<tr>
<td></td>
<td><span style="font-weight: 400;">0x17</span></td>
<td><span style="font-weight: 400;">List all services and their configurations</span></td>
</tr>
<tr>
<td></td>
<td><span style="font-weight: 400;">0x19</span></td>
<td><span style="font-weight: 400;">Start a specified service</span></td>
</tr>
<tr>
<td></td>
<td><span style="font-weight: 400;">0x1a</span></td>
<td><span style="font-weight: 400;">Stop a specified service</span></td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Table 6. The commands available within the HyperBro tools command handler</span></i></span></p>
<p><span style="font-weight: 400; font-size: 14pt;">Unknown Sideloaded Payloads</span></p>
<p><span style="font-weight: 400;">Table 2 and 4</span><span style="font-weight: 400;"> above include two legitimate executables used for DLL sideloading, specifically the</span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;"> plugin_host.exe</span><span style="font-weight: 400;"> application for Sublime Text and the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">CreateMedia.exe</span><span style="font-weight: 400;"> application from Microsoft&#8217;s System Center 2012 Configuration Manager. The </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">plugin_host.exe</span><span style="font-weight: 400;"> application imports several functions from a library named </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">python33</span><span style="font-weight: 400;">, which is how the legitimate application sideloads the malicious DLL named </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">PYTHON33.dll</span><span style="font-weight: 400;">. This is the first instance we have observed Sublime Texts plugin host application used for sideloading. Like the plugin host application, the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">CreateMedia.exe</span><span style="font-weight: 400;"> application imports several functions from a library named </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">CreateTsMediaAdm</span><span style="font-weight: 400;"> that is leveraged to load the malicious DLL named </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">CreateTsMediaAdm.dll</span><span style="font-weight: 400;">.</span></p>
<p><span style="font-weight: 400;">The </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">PYTHON33.dll</span><span style="font-weight: 400;"> and the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">CreateTsMediaAdm.dll</span><span style="font-weight: 400;"> libraries are very similar with BinDiff providing a 97% similarity with 99% confidence between the two DLLs. The code diff in </span><span style="font-weight: 400;">Figure 8</span><span style="font-weight: 400;"> shows the decryption routine in </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">PYTHON33.dll </span><span style="font-weight: 400;">(right) and </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">CreateTsMediaAdm.dll </span><span style="font-weight: 400;">(left), both of which use an eight byte XOR key to decrypt a piece of </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">shikata_ga_nai </span><span style="font-weight: 400;">obfuscated</span><span style="font-weight: 400;"> shellcode. The shellcode is responsible for patching the entry point of the legitimate application to call another function in the shellcode that is responsible for loading a file with the library name with an <span style="font-family: 'courier new', courier, monospace;">.</span></span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">hlp</span><span style="font-weight: 400;"> extension (</span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">PYTHON33.hlp</span><span style="font-weight: 400;"> or </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">CreateTsMediaAdm.hlp</span><span style="font-weight: 400;">).</span></p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image4.png" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-96984" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image4.png" alt="" width="1539" height="903" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image4.png 1539w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image4-300x176.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image4-768x451.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image4-1024x601.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image4-900x528.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image4-370x217.png 370w" sizes="(max-width: 1539px) 100vw, 1539px" /></a><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Figure 8. Code comparison between the sideloaded </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">CreateTsMediaAdm.dll</span></i></span><i><span style="font-weight: 400;"> and </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">PYTHON33.dll </span></i></span><i><span style="font-weight: 400;">files uploaded to two webshells</span></i></span></p>
<p><span style="font-weight: 400;">Unfortunately, we do not have access to the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">PYTHON33.hlp</span><span style="font-weight: 400;"> or </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">CreateTsMediaAdm.hlp</span><span style="font-weight: 400;"> files, so we do not know the final payload loaded by either of these DLLs. However, using </span><a href="https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2018/may/emissary-panda-a-potential-new-malicious-tool/"><span style="font-weight: 400;">NCC Group</span></a><span style="font-weight: 400;">s research published in May 2018, we were able to discover code overlaps between these DLLs and a sideloaded DLL that ran the SysUpdate tool that the NCC group has associated with an Emissary Panda campaign. </span><span style="font-weight: 400;">Figure 9</span><span style="font-weight: 400;"> shows a code comparison between the </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">PYTHON33.dll</span><span style="font-weight: 400;"> (right) and </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">inicore_v2.3.30.dll</span><span style="font-weight: 400;"> (left) (SHA256: </span><span style="font-weight: 400; font-family: 'courier new', courier, monospace;">4d65d371a789aabe1beadcc10b38da1f998cd3ec87d4cc1cfbf0af014b783822</span><span style="font-weight: 400;">), which was sideloaded to run the SysUpdate tool in a previous Emissary Panda campaign. The code overlaps below include the same technique to find the entry point of the loading executable and decrypting the first piece of shellcode used to patch the entry point.</span></p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image5.png" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-96985" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image5.png" alt="" width="1563" height="896" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image5.png 1563w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image5-300x172.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image5-768x440.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image5-1024x587.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image5-900x516.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2019/05/image5-370x212.png 370w" sizes="(max-width: 1563px) 100vw, 1563px" /></a><span style="font-size: 10pt;"><i><span style="font-weight: 400;">Figure 9. Code comparison between the sideloaded </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">PYTHON33.dll </span></i></span><i><span style="font-weight: 400;">uploaded to webshell and the </span></i><span style="font-family: 'courier new', courier, monospace;"><i><span style="font-weight: 400;">inicore_v2.3.30.dll </span></i></span><i><span style="font-weight: 400;">file sideloaded in previous Emissary Panda</span></i> <i><span style="font-weight: 400;">attacks</span></i></span></p>
<p><span style="font-weight: 400; font-size: 18pt;">Conclusion</span></p>
<p><span style="font-weight: 400;">The Emissary Panda threat group loaded the China Chopper webshell onto SharePoint servers at two Government organizations in the Middle East, which we believe with high confidence involved exploiting a remote code execution vulnerability in SharePoint tracked in CVE-2019-0604. According to </span><a href="https://support.microsoft.com/en-us/help/4462211/description-of-the-security-update-for-sharepoint-enterprise-server"><span style="font-weight: 400;">Microsofts advisory</span></a><span style="font-weight: 400;">, this vulnerability was patched on March 12, 2019 and we first saw the webshell activity on April 1, 2019. This suggests that the threat group was able to quickly leverage a known vulnerability to exploit Internet facing servers to gain access to targeted networks.</span></p>
<p><span style="font-weight: 400;">Once the adversary established a foothold on the targeted network, they used China Chopper and other webshells to upload additional tools to the SharePoint server to dump credentials, perform network reconnaissance and pivot to other systems. We believe the actors pivoted to other systems on the network using stolen credentials and by exploiting the CVE-2017-0144 (EternalBlue) vulnerability patched in MS17-010. We also observed the actors uploading legitimate tools that would sideload DLLs, specifically the Sublime Text plugin host and the Microsofts Create Media application, both of which we had never seen used for DLL sideloading before. </span></p>
<p><span style="font-weight: 400;">Palo Alto Networks customers are protected by:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">The CVE-2019-0604 vulnerability is covered by our IPS signature Microsoft Sharepoint Remote Code Execution Vulnerability (55411)</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">All illegitimate tools uploaded to the webshells are marked with malicious verdicts by WildFire and Traps.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">AutoFocus customers can track the custom Emissary Panda payload seen uploaded to the webshell using the </span><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.HyperBro"><span style="font-weight: 400;">HyperBro</span></a><span style="font-weight: 400;"> tag, but can also track the hack tools using the following tags (note the hack tools are used by multiple actors and not just Emissary Panda):</span>
<ul>
<li style="font-weight: 400;"><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.SmbExec"><span style="font-weight: 400;">SmbExec</span></a></li>
<li style="font-weight: 400;"><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.PsExec"><span style="font-weight: 400;">PsExec</span></a></li>
<li style="font-weight: 400;"><a href="https://autofocus.paloaltonetworks.com/#/tag/Commodity.PsExec_Python"><span style="font-weight: 400;">PsExec_Python</span></a></li>
<li style="font-weight: 400;"><a href="https://autofocus.paloaltonetworks.com/#/tag/Commodity.BChecker"><span style="font-weight: 400;">BChecker</span></a></li>
<li style="font-weight: 400;"><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.ZZZ_Exploit"><span style="font-weight: 400;">ZZZ_Exploit</span></a></li>
<li style="font-weight: 400;"><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.Termite"><span style="font-weight: 400;">Termite</span></a></li>
<li style="font-weight: 400;"><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.Incognito"><span style="font-weight: 400;">Incognito</span></a></li>
<li style="font-weight: 400;"><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.PwDump"><span style="font-weight: 400;">PwDump</span></a></li>
</ul>
</li>
</ul>
<p><span style="font-size: 10pt;"><span style="font-weight: 400;">Palo Alto Networks has shared our findings, including file samples and indicators of compromise, in this report with our fellow Cyber Threat Alliance members. CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors. For more information on the Cyber Threat Alliance, visit</span> <a href="http://www.cyberthreatalliance.org/"><span style="font-weight: 400;">www.cyberthreatalliance.org</span></a><span style="font-weight: 400;">.</span></span></p>
<p><span style="font-weight: 400; font-size: 18pt;">IOCs</span></p>
<p><span style="font-weight: 400; font-size: 14pt;">Webshells SHA256</span></p>
<p><span style="font-weight: 400;">006569f0a7e501e58fe15a4323eedc08f9865239131b28dc5f95f750b4767b38</span></p>
<p><span style="font-weight: 400;">2feae7574a2cc4dea2bff4eceb92e3a77cf682c0a1e78ee70be931a251794b86</span></p>
<p><span style="font-weight: 400;">d1ab0dff44508bac9005e95299704a887b0ffc42734a34b30ebf6d3916053dbe</span></p>
<p><span style="font-weight: 400;">6b3f835acbd954af168184f57c9d8e6798898e9ee650bd543ea6f2e9d5cf6378</span></p>
<p><span style="font-weight: 400; font-size: 14pt;">Malicious HackTools and Payloads SHA256</span></p>
<p><span style="font-weight: 400;">88027a44dc82a97e21f04121eea2e86b4ddf1bd7bbaa4ad009b97b50307570bd</span></p>
<p><span style="font-weight: 400;">738128b4f42c8d2335d68383d72734130c0c4184725c06851498a4cf0374a841</span></p>
<p><span style="font-weight: 400;">3bca0bb708c5dad1c683c6ead857a5ebfa15928a59211432459a3efa6a1afc59</span></p>
<p><span style="font-weight: 400;">29897f2ae25017455f904595872f2430b5f7fedd00ff1a46f1ea77e50940128e</span></p>
<p><span style="font-weight: 400;">d0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963da38e0b1333</span></p>
<p><span style="font-weight: 400;">a18326f929229da53d4cc340bde830f75e810122c58b523460c8d6ba62ede0e5</span></p>
<p><span style="font-weight: 400;">090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98</span></p>
<p><span style="font-weight: 400;">7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7</span></p>
<p><span style="font-weight: 400;">38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c</span></p>
<p><span style="font-weight: 400;">4a26ec5fd16ee13d869d6b0b6177e570444f6a007759ea94f1aa18fa831290a8</span></p>
<p><span style="font-weight: 400;">b2b2e900aa2e96ff44610032063012aa0435a47a5b416c384bd6e4e58a048ac9</span></p>
<p><span style="font-weight: 400;">475c7e88a6d73e619ec585a7c9e6e57d2efc8298b688ebc10a3c703322f1a4a7</span></p>
<p><span style="font-weight: 400;">9f5f3a9ce156213445d08d1a9ea99356d2136924dc28a8ceca6d528f9dbd718b</span></p>
<p><span style="font-weight: 400;">c9d5dc956841e000bfd8762e2f0b48b66c79b79500e894b4efa7fb9ba17e4e9e</span></p>
<p><span style="font-weight: 400;">a6cad2d0f8dc05246846d2a9618fc93b7d97681331d5826f8353e7c3a3206e86</span></p>
<p><span style="font-weight: 400;">e781ce2d795c5dd6b0a5b849a414f5bd05bb99785f2ebf36edb70399205817ee</span></p>
<p><span style="font-weight: 400;">d0df8e1dcf30785a964ecdda9bd86374d35960e1817b25a6b0963da38e0b1333</span></p>
<p><span style="font-weight: 400;">06510504f30feb1adc7e423d5a24e67e5b97acbfafe40f253a054be8b1c4e8d7</span></p>
<p><span style="font-weight: 400;">b279a41359367408c627ffa8d80051ed0f04c76fbf6aed79b3b2963203e08ade</span></p>
<p><span style="font-weight: 400;">7eea6e15bb13a3b65cca9405829123761bf7d12c6dc3b81ce499d8f6a0b25fb7</span></p>
<p><span style="font-weight: 400;">04f48ed27a83a57a971e73072ac5c769709306f2714022770fb364fd575fd462</span></p>
<p><span style="font-weight: 400;">090cefebef655be7f879f2f14bd849ac20c4051d0c13e55410a49789738fad98</span></p>
<p><span style="font-weight: 400;">38fa396770e0ecf60fe1ce089422283e2dc8599489bd18d5eb033255dd8e370c</span></p>
<p><span style="font-weight: 400;">2dde8881cd9b43633d69dfa60f23713d7375913845ac3fe9b4d8a618660c4528</span></p>
<p><span style="font-weight: 400; font-size: 14pt;">HyperBro C2</span></p>
<p><span style="font-weight: 400;">hxxps://185.12.45[.]134:443/ajax</span></p>
<p><span style="font-weight: 400;">185.12.45[.]134</span></p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p> 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
