
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/dns-vulnerabilities/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/dns-vulnerabilities/" />

	<!-- This site is optimized with the Yoast SEO plugin v15.2.1 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>The History of DNS Vulnerabilities and the Cloud</title>
	<meta name="description" content="We review the history of DNS vulnerabilities, particularly DNS cache poisoning, examining both past vulnerabilities and more advanced attacks." />
	<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://unit42.paloaltonetworks.com/dns-vulnerabilities/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="The History of DNS Vulnerabilities and the Cloud" />
	<meta property="og:description" content="We review the history of DNS vulnerabilities, particularly DNS cache poisoning, examining both past vulnerabilities and more advanced attacks." />
	<meta property="og:url" content="https://unit42.paloaltonetworks.com/dns-vulnerabilities/" />
	<meta property="og:site_name" content="Unit42" />
	<meta property="article:published_time" content="2020-12-28T14:00:07+00:00" />
	<meta property="article:modified_time" content="2020-12-23T17:20:47+00:00" />
	<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/DNS-vulnerability-illustration_2.png" />
	<meta property="og:image:width" content="1587" />
	<meta property="og:image:height" content="850" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="Daniel Prizmant">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="16 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://unit42.paloaltonetworks.com/#website","url":"https://unit42.paloaltonetworks.com/","name":"Unit42","description":"Palo Alto Networks","potentialAction":[{"@type":"SearchAction","target":"https://unit42.paloaltonetworks.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://unit42.paloaltonetworks.com/dns-vulnerabilities/#primaryimage","inLanguage":"en-US","url":"https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/DNS-vulnerability-illustration_2.png","width":1587,"height":850,"caption":"A conceptual image illustrating the concept of DNS vulnerabilities through a set of folders with one opened by an attacker."},{"@type":"WebPage","@id":"https://unit42.paloaltonetworks.com/dns-vulnerabilities/#webpage","url":"https://unit42.paloaltonetworks.com/dns-vulnerabilities/","name":"The History of DNS Vulnerabilities and the Cloud","isPartOf":{"@id":"https://unit42.paloaltonetworks.com/#website"},"primaryImageOfPage":{"@id":"https://unit42.paloaltonetworks.com/dns-vulnerabilities/#primaryimage"},"datePublished":"2020-12-28T14:00:07+00:00","dateModified":"2020-12-23T17:20:47+00:00","author":{"@id":"https://unit42.paloaltonetworks.com/#/schema/person/1b903ff77ad07828403fc5b94c101076"},"description":"We review the history of DNS vulnerabilities, particularly DNS cache poisoning, examining both past vulnerabilities and more advanced attacks.","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://unit42.paloaltonetworks.com/dns-vulnerabilities/"]}]},{"@type":"Person","@id":"https://unit42.paloaltonetworks.com/#/schema/person/1b903ff77ad07828403fc5b94c101076","name":"Daniel Prizmant","image":{"@type":"ImageObject","@id":"https://unit42.paloaltonetworks.com/#personlogo","inLanguage":"en-US","url":"https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg","caption":"Daniel Prizmant"}}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; The History of DNS Vulnerabilities and the Cloud Comments Feed" href="https://unit42.paloaltonetworks.com/dns-vulnerabilities/feed/" />
<meta property="og:likes" content="2"/>
<meta property="og:readtime" content="14"/>
<meta property="og:views" content="622"/>
<meta property="og:date_created" content="December 28, 2020 at 6:00 AM"/>
<meta property="og:post_length" content="3956"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit-42/"/>
<meta property="og:author" content="Daniel Prizmant"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/daniel-prizmant/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:post_image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/DNS-vulnerability-illustration_2.png"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"The History of DNS Vulnerabilities and the Cloud","name":"The History of DNS Vulnerabilities and the Cloud","description":"We review the history of DNS vulnerabilities, particularly DNS cache poisoning, examining both past vulnerabilities and more advanced attacks. ","url":"https:\/\/unit42.paloaltonetworks.com\/dns-vulnerabilities\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/dns-vulnerabilities\/","datePublished":"December 28, 2020","articleBody":"Introduction\r\nEvery now and then, a new domain name system (DNS) vulnerability that puts billions of devices around the world at risk is discovered. DNS vulnerabilities are usually critical. Just imagine that you browse to your bank account website, but instead of returning the IP address of your bank website, your DNS resolver gives you the address of an attacker\u2019s website. That website looks exactly the same as the bank\u2019s website. Not only that, but even if you take a look at the URL bar, you won\u2019t see anything wrong because your browser actually thinks this is the website of your bank. This is an example of DNS cache poisoning.\r\n\r\nIn this article, I will explain what DNS is as well as review the history of DNS cache poisoning vulnerabilities, from past vulnerabilities to more advanced ones that were discovered in recent years.\r\n\r\nThe vulnerabilities I chose to cover are the bread and butter of almost all DNS cache poisoning attacks that took place in the last 20 years.\r\n\r\nPalo Alto Networks customers are protected from the attacks outlined in this blog in a variety of ways: Next-Generation Firewalls with a DNS Security Service subscription and Prisma Cloud.\r\nWhat is a DNS?\r\nThe domain name system is a hierarchical and decentralized naming system for computers, services or other resources connected to the internet (or a private network). It associates various information with domain names assigned to each of the participating entities.\r\n\r\nIn simple terms, DNS is a protocol that is mostly used to convert a name into an IP address. When one browses http:\/\/www.example.com, the www.example.com domain name is being translated to the actual IP address, for example, 93.184.216.34.\r\nWhat is a DNS Server?\r\nDNS servers, usually referred to as name servers, are devices or programs that provide DNS resolution. DNS clients, which are built into most desktop and mobile operating systems, interact with DNS servers in order to translate names to IP addresses.\r\n\r\nIt is important to remember that eventually there are only two types of servers: an authoritative name server and a recursive name server. The authoritative name server is the name server that is in charge of the domain \u2013 the last in the chain. Everything that isn\u2019t an authoritative name server is a recursive one. For example, routers\u2019 DNS servers, ISPs\u2019 DNS servers and Kubernetes clusters\u2019 DNS servers are all recursive name servers. All those recursive servers behave the same way. Eventually, after some recursions, they contact the authoritative name server of the desired domain (there are servers that perform functions of both authoritative and recursive name servers, which we will not discuss in this blog).\r\nHow Does It Work?\r\n[caption id=\"attachment_110470\" align=\"aligncenter\" width=\"900\"] Figure 1. How the DNS protocol works.[\/caption]\r\n\r\n\r\nA DNS resolver is the lowest node in the DNS hierarchy \u2013\u00a0the one in your Kubernetes cluster, for example. The basic idea of how DNS works is that when a DNS resolver is being asked about a domain it doesn\u2019t know, it starts by asking the DNS root server. Root servers are the highest nodes in the hierarchy and their addresses are hardcoded in the resolver. The root server answers with a list of addresses for the relevant top-level domain' (TLD) DNS servers, which are in charge of the relevant DNS zone (.com, .net, .etc). The TLD server answers with the address of the next, hierarchically lower server, and so on, until an authoritative server is reached.\r\nDNS in the Cloud\r\nCloud computing skyrocketed in popularity in recent years. The way cloud products implement DNS might not be intuitive in some cases. Virtual machines in the cloud are pretty straightforward. The DNS resolver is determined by the virtual machine\u2019s operating system. If using Windows, then Windows has its built-in DNS resolver. If using Linux, then it is distribution-dependent.\r\n\r\nBut what about other cloud products like Kubernetes? Unlike simple virtual machines, Kubernetes uses a custom virtual machine for its nodes, one that doesn\u2019t come with a built-in DNS resolver.\r\n\r\nEach Kubernetes cluster also contains a special containerized DNS resolver. All the applications in the cluster forward their DNS requests to this containerized DNS resolver, which handles them.\r\n\r\nIn the past, up to version 1.10 of Kubernetes, it used to be kube-dns, a package of applications for handling, caching and forwarding DNS requests. The core application in kube-dns was dnsmasq. dnsmasq is a lightweight, easy-to-configure DNS forwarder, designed to provide DNS services to a small-scale network. Since then, Kubernetes moved to CoreDNS, which is an open source DNS server written in Go. CoreDNS is a fast and flexible DNS server.\r\nCache\r\nCache is a hardware or software component that stores data, so that future requests for that data can be served faster. It is a very important feature in DNS servers. DNS servers use cache to store previously translated names.\r\n\r\nFor example, if client C tried to access www.example.com and the name server resolved www.example.com to 93.184.216.34, it will save that IP address of www.example.com for an arbitrary amount of time so the next DNS client that contacts it to try to resolve this name will be answered immediately from the cache.\r\nWhat Is DNS Cache Poisoning?\r\nDNS cache poisoning is a type of attack on DNS servers that eventually ends with the server saving an attacker\u2019s controlled IP address for a non-attacker\u2019s controlled domain.\r\n\r\nFor example, an attacker manages to trick a DNS server into saving the www.example.com IP address as 13.37.13.37, which is an evil IP address that the attacker controls, instead of the actual real IP address.\r\n\r\nFrom this point onwards, and until the cached IP address is timed out, every DNS client that tries to resolve www.example.com will be \u201credirected\u201d to the attacker\u2019s website.\r\nPast DNS Vulnerabilities\r\nNo Mitigations\r\nThere were many DNS attacks that were discovered in the last 20 years. I will describe DNS cache poisoning, also known as DNS spoofing, the most widely known DNS attack.\r\n\r\nSo how does DNS cache poisoning work?\r\n\r\nAs explained above, it takes some time for the resolver to resolve the IP address of a domain. It usually needs to contact multiple servers before getting to the authoritative one. Attackers can abuse this period of time to send fake answers to the resolver.\r\n\r\nThis attack is possible in the following scenarios, all of which result in an attacker being able to send packets to the resolver:\r\n\r\n \tA resolver that leaves its listening port open to the internet.\r\n \tAn attacker that manages to get control of an endpoint in the internal network.\r\n \tA client in the internal network that browses to an attacker controlled website.\r\n\r\nFor example, let\u2019s assume that an attacker penetrated one of the endpoints in the internal network and is now looking to poison the local resolver\u2019s cache. It is important to note that this attack can be implemented, in the exact same way, on more critical resolvers such as an ISP\u2019s resolver.\r\n\r\nThe client visits www.example.com and the domain is missing from the resolver cache, so it initiates the process described above to resolve the address of the domain. In the meantime, the attacker sends an answer packet to the resolver with a fake IP address, faking the DNS server answer. This is the basic idea of the attack, but there are a few mitigations. These include transaction ID and source port randomization.\r\n\r\nDNS uses something called transaction ID (TXID) to match each response to the correct request. An attacker has to supply a response with the correct transaction ID or the DNS server will just drop the packets. When this mechanism was invented, many years ago, it wasn\u2019t intended to be a security feature, but simply a way to match responses to requests. Before DNS vulnerabilities were discovered, DNS used an ascending index as the transaction ID. It was simple for an attacker to guess that number.\r\n\r\n[caption id=\"attachment_110472\" align=\"aligncenter\" width=\"900\"] Figure 2. A DNS cache poisoning attack.[\/caption]\r\n\r\nAn attacker would have had to buy a domain and configure their own controlled DNS server. Next, the attacker would ask the resolver in the local network about their own domain. The local resolver would forward the request up the hierarchical DNS ladder until it reached a DNS server that knew the attacker\u2019s controlled DNS server. At this point, the original DNS request (the one that the attacker issued from the internal network) would get to the attacker\u2019s controlled DNS server, thus revealing the transaction ID to the attacker.\r\n\r\nUsing the transaction ID the attacker discovered earlier, they would have a good idea of the transaction ID needed for the fake response to be accepted. In such a case, an attacker could send multiple fake responses with multiple transaction IDs to make sure one of them was the correct one. Then, all there is left for an attacker to do is issue a DNS request for a domain that is not in the local DNS resolver\u2019s cache and immediately send fake responses using the transaction ID for that domain.\r\n\r\nThe local resolver would get the response with the correct transaction ID, drop the others and cache the address. From now on, and for an arbitrary amount of time, any local client that would have visited that domain would be directed to the attacker\u2019s website.\r\nNew Mitigations\r\nThe obvious mitigation, which was implemented, was to randomize the transaction ID for each request (instead of using an ascending counter). This mitigation made the attack much harder to execute. How much harder? Well, MAX_SIZE_OF_QUERY_ID harder. Transaction ID is 16 bits, so that mitigation made the attack 65,536 times harder than before. Not bad \u2013 but not bulletproof either.\r\nRound Two, Fight!\r\nThose mitigations held off attackers for quite some time, but eventually the internet caught up. While a 16-bits randomization key is quite large, it isn\u2019t nearly large enough. Let's do the math.\r\n\r\nFor the following calculation, we need to put down some data:\r\n\r\n \tSize of a typical DNS response: 100 bytes = 800 bits\r\n \tBandwidth of the attacker: 1 Megabits per second = 1,000,000 bits\r\n \tTime it takes for a legitimate response to get back to the resolver: two seconds\r\n\r\n(A side note about the two seconds: Nowadays, with modern internet connection, it obviously takes less than two seconds to fulfill a DNS request, even for domains that aren\u2019t cached. But as I picked a latency for the sake of example, I also chose an internet speed from the past: 1 Megabits per second.)\r\n\r\nThere are 65,536 possible transaction IDs, and we have a window of two seconds to send a response with the correct one for a successful attack. In order to calculate our success rate per attack, we need to figure out how many response packets an attacker can dispatch before the actual legitimate response arrives at the resolver. This is easy to calculate: the bandwidth divided by the size of the packet multiplied by the time.\r\n\r\nWith 1 Mbit\/s bandwidth, an attacker can send up to 1,000,000\/800 = 1,250 response packets in a second, meaning 2,500 in the two-second window the attacker has. The amount of tries needed to achieve a likely attack, meaning at least 50% success rate with a 1 Mbit\/s bandwidth, is about 18 tries.\r\n\r\n(You can view the complete calculation here: 1,000,000 is the amount of bits we can send in a second with our 1 Mbits\\s connection. We divide that by 800, which is the size of a DNS response that yields the amount of responses we can send in a second. We multiply that by 2 because of the 2-second window. We then divide that by 2 to the power of 16, which is the size of the transaction ID field. That is the success rate of a single attack. In order to achieve a successful attack we need that in x attempts, one of the attempts will be successful. Our x attempts are called an \u201cexperiment\u201d, and the set of all possible outcomes of that experiment is called a sample space (\u03a9). The chance of hitting anything in the sample space is obviously 100% (this is the outer 1 in the equation). In order to get the chance of a likely attack, we need to take the entire sample space and subtract from that anything that is not \u201csucceeding in at least a single attack\u201d which is another way to say failing in all x attempts. Failing in a single attempt is \u201ceverything (1) minus succeeding in a single attempt\u201d which is exactly 1 minus success rate. We then tell Wolfram Alpha that we are looking for an x that will result in this equation in a number bigger than 0.5, which is 50%.)\r\n\r\nIn other words, with only 18 tries, an attacker with 1 Mbit\/s bandwidth could achieve a success rate that is bigger than 50% with this attack after the mitigations. This is how easy it was to craft this devastating attack back in the day.\r\nMore Mitigations\r\nAt first, it might seem odd that such a weak mitigation was chosen, but it is important to remember that it was simply impossible to completely reinvent the DNS protocol. It would have broken the internet. Just think of all the devices out there that have a built-in resolver. They would have completely stopped working. But something more had to be done. As demonstrated, transaction ID mitigation was weak.\r\n\r\nSo the same mitigation was used, this time with the source port. Each DNS request from a DNS client, resolver or name server comes out from a source port. That port wasn\u2019t randomized prior to this mitigation.\r\n\r\nThe source port is a 16 bits number, same as the transaction ID, and it was there for functionality only. For example, a resolver might try to use port 10650, and if that was in use from a previous request, it would try to use 10651 and so on. Of course, not all 16 bits were available, as there are constant ports for other uses.\r\n\r\nThe source port, combined with the transaction ID, are used together as a key for DNS communication \u2013 a 32 bits key. Remember that, as it will be important in the attacks I will further discuss. Those extra 16 bits reduced the probability of a successful attack drastically.\r\n\r\nBefore, with a 1 Mbit\/s bandwidth, we had a success rate of 3.8% (You can view the relevant calculation in Wolfram Alpha). With the source port mitigation, with the same data as before, the probability of successful attack is 0.00005821%. The number of attempts are needed to achieve the same likely successful attack as before is 1,190,820. That makes the success of the attack not reliable enough \u2013 and indeed, the source port randomization put an end to most DNS cache poisoning attacks.\r\nMore Advanced Vulnerabilities\r\nSo far, we have focused on poisoning the cache of a single DNS record, \u201cwww.example.com is at 93.184.216.34\u201d, also known as an A record. We were poisoning the record at the victim\u2019s own DNS server, like a router or a Kubernetes cluster. In this approach, we work hard on a difficult attack to poison a single domain. We could do better.\r\n\r\nIn 2008, security researcher Dan Kaminsky discovered a better approach that's drastically more effective than what we have discussed so far in this blog. This vulnerability caused quite a furor in the security community. The general execution method is quite similar to what we discussed so far, meaning we still need to guess the transaction ID and the source port. The probability of succeeding in that is pretty much the same, but in Kaminsky\u2019s method, we could have poisoned a lot more than a single record if we had succeeded.\r\nNS Record\r\nAs the name suggests, a name server (NS) record is a DNS record that indicates which DNS server is authoritative for a domain, meaning which server contains the actual IP address of a domain. In our example earlier, the NS record for example.com would be a server that holds the addresses of www.example.com, email.example.com and any ?.example.com.\r\n\r\nThe attacker\u2019s goal here is to poison the victim\u2019s resolver in such a way that when the victim tries to access www.example.com, email.example.com or any ?.example.com, the resolver will forward the request to the attacker\u2019s name server instead of the example.com name server.\r\n\r\nThis way, the attacker controls every access to every single subdomain of example.com instead of just www as before.\r\nBut How?\r\nSurprisingly, the attack is very similar to the previous attacks that we\u2019ve described in this blog, but instead of poisoning the cache of the resolver with an A record, an attacker will attempt to poison the cache with an NS record.\r\n\r\nAn attacker would first configure a name server for the domain they want to poison. There is nothing stopping anybody from configuring their own name server to be authoritative for any domain. However, it would ordinarily be pointless as no other server would point to it.\r\n\r\n[caption id=\"attachment_110474\" align=\"aligncenter\" width=\"900\"] Figure 3. An entire zone poisoning attack.[\/caption]\r\n\r\nThe attacker would then proceed to issue a DNS request for the subdomain of the zone they want to poison. It would have to be a domain that isn\u2019t cached, so they would know for sure the resolver will forward the request to a root server. Not only that, but the NS record of that domain in our example, the authoritative name server of example.com, shouldn\u2019t be cached either. If it were cached, the resolver would simply forward the request to that authoritative name server directly, without even forwarding the request to the root server.\r\n\r\nAfter the attacker makes the victim\u2019s resolver forward their request to the root server, the root server will usually answer with an NS record, which is roughly equivalent to saying, \u201cI don't know the answer, but you can ask this server over there. Here is its IP address.\u201d\r\n\r\nThis is the tricky part. To succeed in the attack, the attacker now needs to outperform the root server and deliver the poisonous response before the root server\u2019s response is sent. This is achieved by sending large amounts of responses with an NS record of the desired domain. Don\u2019t forget the attacker needs to guess the transaction ID (and possibly the source port, too).\r\n\r\nEach NS answer comes with a \u201cglue\u201d record, which is the actual IP address of the name server. If it was any other way, the requesting server wouldn't know where to find the name server. The resolver receives this glue record, caches it and contacts the name server that the glue points to in order to get the address of the requested domain.\r\n\r\nIf the attack succeeds, from now on, each request to the resolver for any domain that is uncached under the poisoned domain zone (example.com in www.example.com) would arrive at the attacker\u2019s name server.\r\nApplications\r\nWith this advanced attack, an attacker can poison a large amount of domains at the same time. Theoretically, an attacker could even poison the entire .com zone.\r\n\r\nWhile poisoning a zone as big as .com would be challenging, there have been cases where an attacker actually managed to poison an entire cache. Some examples:\r\n\r\n \tOn Jan. 26, 2015, a hacker group managed to redirect visitors to the Malaysia Airlines website to another site displaying malicious content.\r\n \tOn Nov. 7, 2011, hackers managed to poison an entire internet service provider\u2019s cache, redirecting users to the installation of malware before redirecting them back to the site they requested.\r\n \tOn Dec. 18, 2009, a DNS hijacking attack left Twitter temporarily affected for about an hour.\r\n\r\nHundreds of such attacks take place every year.\r\nMitigations\r\nNo actual new mitigations took place, as this attack was already nearly impossible to execute with the transaction ID and port randomization mitigations that were already used. But if an attacker managed to overcome those mitigations, using this attack instead of the \u201cregular\u201d single A record attack would be much more severe.\r\n\r\nIn the same way as before, using transaction ID and port randomization together to create a key large enough to be too hard for an attacker to guess mitigates the attack.\r\nRecent Vulnerabilities\r\nEven if the DNS protocol is considered secure, developers could fail to implement it securely.\r\n\r\nFor example, there is a common misconception that randomization functions should be unpredictable, so they can be used to generate cryptographic keys. However, those functions are not meant to be used for cryptography or security. Unfortunately, misuse of randomization functions frequently happen in the case of DNS implementations.\r\n\r\nThis happened with the function that was used to randomize the transaction ID in CoreDNS, just two years ago. The developers chose to use math.rand, which is a non-cryptographically secure pseudorandom number generator in Golang. This was a big problem. If an attacker could predict the transaction ID, they would absolutely be able to poison CoreDNS\u2019s cache as described earlier in this blog. It means that every application that used CoreDNS as its DNS resolver would have been vulnerable to malicious DNS records. In other words, because CoreDNS is mainly used for Kubernetes, every single application in every single node in the entire cluster would have been vulnerable to this attack.\r\n\r\nAnother example is a new technique that was discovered just a few weeks ago, which uses the Internet Control Message Protocol (ICMP) to pinpoint which ports are closed on a server, thus revealing which ports are actually open. This, used in a DNS attack, can drastically reduce the number of ports an attacker needs to guess, reducing the effectiveness of the port randomization mitigation explained earlier.\r\n\r\nAnd of course, there are also typical non cache-related vulnerabilities like buffer overflows. dnsmasq is a common DNS resolver used in many Linux distributions and routers, and was even used in early versions of Kubernetes. In recent years, dnsmasq was found vulnerable to numerous memory flaws that could lead to denial of service (DoS), remote code execution (RCE) and more.\r\nConclusion\r\nThe DNS attacks described in this blog could be devastating if successful. Thanks to modern mitigations, an attacker is unlikely to pull off a DNS poisoning attack, unless combined with any other vulnerability in resolver applications. Unfortunately, such vulnerabilities are frequently found to this day.\r\n\r\nOver the years, researchers discovered techniques to overcome some of the mitigations we discussed in this blog, for instance, user datagram protocol (UDP) fragmentation.\r\n\r\nDespite that, with secured browsing and certificates usage nowadays, even if an attacker manages to poison a DNS server for a domain, it is most likely that the browser\u2019s victim won\u2019t load the page because the certificates won\u2019t match. But the technique can still be used for enormous DoS attacks by poisoning an ISP\u2019s DNS resolver and forwarding requests to a non-existent IP address.\r\n\r\nPalo Alto Networks customers are protected from the attacks outlined in this blog in a variety of ways. Palo Alto Networks Next-Generation Firewalls can block DNS attacks by detecting suspicious DNS queries and anomalous DNS responses. Attacks related to exhaustion or high quantities of traffic are handled with DoS or zone protection profiles that are built into the firewall. These protections are in addition to coverage of DNS threats and indicators through DNS Security Service.\r\n\r\nFurthermore, Prisma Cloud can protect your clusters by alerting about outdated and vulnerable components, as well as misconfigured applications in your cloud. Most of the attacks described in this blog require a breach in the internal network of the cluster to be able to send malicious packets to the DNS server from the inside. Such breaches almost always happen by exploiting outdated and misconfigured applications.\r\n\r\n&nbsp;","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2020\/12\/DNS-vulnerability-illustration_2.png","width":150,"height":80},"author":[{"@type":"Person","name":"Daniel Prizmant"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.2' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.2.4' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='application/json' id="wpp-json">
{"sampling_active":0,"sampling_rate":100,"ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":110465,"token":"d087d97b6b","lang":0,"debug":0}
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp.min.js?ver=5.2.4'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.4.3'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=110465' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fdns-vulnerabilities%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fdns-vulnerabilities%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.4.3 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-110465 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">The History of DNS Vulnerabilities and the Cloud</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-110465 entry-meta">
				
				
				<span class="post-views-count">622</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'110465','like')"><i class="ui ui-2"></i><span class="ml-5">2</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 14</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fdns-vulnerabilities%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/share?text=The+History+of+DNS+Vulnerabilities+and+the+Cloud&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fdns-vulnerabilities%2F" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fdns-vulnerabilities%2F&title=The+History+of+DNS+Vulnerabilities+and+the+Cloud&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/dns-vulnerabilities/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/daniel-prizmant/" title="Posts by Daniel Prizmant" class="author url fn" rel="author">Daniel Prizmant</a>        </p>
        <p><time datetime="2020-12-28T14:00:07+00:00">December 28, 2020 at 6:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit-42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/dns/" rel="tag">DNS</a>, <a href="https://unit42.paloaltonetworks.com/tag/vulnerabilities/" rel="tag">vulnerabilities</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="900" height="482" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/DNS-vulnerability-illustration_2.png" class="attachment-single size-single" alt="A conceptual image illustrating the concept of DNS vulnerabilities through a set of folders with one opened by an attacker." />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/dns-vulnerabilities/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja"></span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><h2><a id="post-110465-_9ojx5m2glpx4"></a>Introduction</h2>
<p>Every now and then, a new domain name system (DNS) vulnerability that puts billions of devices around the world at risk is discovered. DNS vulnerabilities are usually critical. Just imagine that you browse to your bank account website, but instead of returning the IP address of your bank website, your DNS resolver gives you the address of an attackers website. That website looks exactly the same as the banks website. Not only that, but even if you take a look at the URL bar, you wont see anything wrong because your browser actually thinks this is the website of your bank. This is an example of DNS cache poisoning.</p>
<p>In this article, I will explain what DNS is as well as review the history of DNS cache poisoning vulnerabilities, from past vulnerabilities to more advanced ones that were discovered in recent years.</p>
<p>The vulnerabilities I chose to cover are the bread and butter of almost all DNS cache poisoning attacks that took place in the last 20 years.</p>
<p>Palo Alto Networks customers are protected from the attacks outlined in this blog in a variety of ways: <a href="https://www.paloaltonetworks.com/network-security/next-generation-firewall">Next-Generation Firewalls</a> with a <a href="https://www.paloaltonetworks.com/products/threat-detection-and-prevention/dns-security">DNS Security Service</a> subscription and <a href="https://www.paloaltonetworks.com/prisma/cloud">Prisma Cloud</a>.</p>
<h2><a id="post-110465-_pzu3djexkt45"></a>What is a DNS?</h2>
<p>The domain name system is a hierarchical and decentralized naming system for computers, services or other resources connected to the internet (or a private network). It associates various information with domain names assigned to each of the participating entities.</p>
<p>In simple terms, DNS is a protocol that is mostly used to convert a name into an IP address. When one browses <span style="font-family: 'courier new', courier, monospace;">http://www.example.com</span>, the <span style="font-family: 'courier new', courier, monospace;">www.example.com</span> domain name is being translated to the actual IP address, for example, <span style="font-family: 'courier new', courier, monospace;">93.184.216.34</span>.</p>
<h4><a id="post-110465-_h26xln29ofef"></a><strong>What is a DNS Server?</strong></h4>
<p>DNS servers, usually referred to as name servers, are devices or programs that provide DNS resolution. DNS clients, which are built into most desktop and mobile operating systems, interact with DNS servers in order to translate names to IP addresses.</p>
<p>It is important to remember that eventually there are only two types of servers: an authoritative name server and a recursive name server. The authoritative name server is the name server that is in charge of the domain  the last in the chain. Everything that isnt an authoritative name server is a recursive one. For example, routers DNS servers, ISPs DNS servers and Kubernetes clusters DNS servers are all recursive name servers. All those recursive servers behave the same way. Eventually, after some recursions, they contact the authoritative name server of the desired domain (there are servers that perform functions of both authoritative and recursive name servers, which we will not discuss in this blog).</p>
<h4><a id="post-110465-_p9uccfqivp20"></a><strong>How Does It Work?</strong></h4>
<figure id="attachment_110470" aria-describedby="caption-attachment-110470" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110470" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-225.png" alt="This illustration of the DNS protocol shows the flow of requests from a device to the router's resolver to the root server, TLD server and authoritative server for the requested website. " width="900" height="400" /><figcaption id="caption-attachment-110470" class="wp-caption-text">Figure 1. How the DNS protocol works.</figcaption></figure>
<p><em><br />
</em>A DNS resolver is the lowest node in the DNS hierarchy the one in your Kubernetes cluster, for example. The basic idea of how DNS works is that when a DNS resolver is being asked about a domain it doesnt know, it starts by asking the DNS root server. Root servers are the highest nodes in the hierarchy and their addresses are hardcoded in the resolver. The root server answers with a list of addresses for the relevant top-level domain&#8217; (TLD) DNS servers, which are in charge of the relevant DNS zone (.com, .net, .etc). The TLD server answers with the address of the next, hierarchically lower server, and so on, until an authoritative server is reached.</p>
<h4><a id="post-110465-_bngxjwnm97bb"></a><strong>DNS in the Cloud</strong></h4>
<p>Cloud computing skyrocketed in popularity in recent years. The way cloud products implement DNS might not be intuitive in some cases. Virtual machines in the cloud are pretty straightforward. The DNS resolver is determined by the virtual machines operating system. If using Windows, then Windows has its built-in DNS resolver. If using Linux, then it is distribution-dependent.</p>
<p>But what about other cloud products like Kubernetes? Unlike simple virtual machines, Kubernetes uses a custom virtual machine for its nodes, one that doesnt come with a built-in DNS resolver.</p>
<p>Each Kubernetes cluster also contains a special containerized DNS resolver. All the applications in the cluster forward their DNS requests to this containerized DNS resolver, which handles them.</p>
<p>In the past, up to version 1.10 of Kubernetes, it used to be <em>kube-dns</em>, a package of applications for handling, caching and forwarding DNS requests. The core application in <em>kube-dns</em> was <em>dnsmasq</em>. <em>dnsmasq </em>is a lightweight, easy-to-configure DNS forwarder, designed to provide DNS services to a small-scale network. Since then, Kubernetes moved to <a href="https://github.com/coredns/coredns">CoreDNS</a>, which is an open source DNS server written in <a href="https://golang.org/">Go</a>. CoreDNS is a fast and flexible DNS server.</p>
<h4><a id="post-110465-_53nnpex87pem"></a><strong>Cache</strong></h4>
<p>Cache is a hardware or software component that stores data, so that future requests for that data can be served faster. It is a very important feature in DNS servers. DNS servers use cache to store previously translated names.</p>
<p>For example, if client C tried to access <span style="font-family: 'courier new', courier, monospace;">www.example.com</span> and the name server resolved <span style="font-family: 'courier new', courier, monospace;">www.example.com</span> to <span style="font-family: 'courier new', courier, monospace;">93.184.216.34</span>, it will save that IP address of <span style="font-family: 'courier new', courier, monospace;">www.example.com</span> for an arbitrary amount of time so the next DNS client that contacts it to try to resolve this name will be answered immediately from the cache.</p>
<h4><a id="post-110465-_ekdysamka29h"></a><strong>What Is DNS Cache Poisoning?</strong></h4>
<p>DNS cache poisoning is a type of attack on DNS servers that eventually ends with the server saving an attackers controlled IP address for a non-attackers controlled domain.</p>
<p>For example, an attacker manages to trick a DNS server into saving the <span style="font-family: 'courier new', courier, monospace;">www.example.com</span> IP address as <span style="font-family: 'courier new', courier, monospace;">13.37.13.37</span>, which is an evil IP address that the attacker controls, instead of the actual real IP address.</p>
<p>From this point onwards, and until the cached IP address is timed out, every DNS client that tries to resolve <span style="font-family: 'courier new', courier, monospace;">www.example.com</span> will be redirected to the attackers website.</p>
<h2><a id="post-110465-_2ld6z4rrvbh6"></a>Past DNS Vulnerabilities</h2>
<h4><a id="post-110465-_ll5o0dg4zzl6"></a><strong>No Mitigations</strong></h4>
<p>There were many DNS attacks that were discovered in the last 20 years. I will describe DNS cache poisoning, also known as DNS spoofing, the most widely known DNS attack.</p>
<p>So how does DNS cache poisoning work?</p>
<p>As explained above, it takes some time for the resolver to resolve the IP address of a domain. It usually needs to contact multiple servers before getting to the authoritative one. Attackers can abuse this period of time to send fake answers to the resolver.</p>
<p>This attack is possible in the following scenarios, all of which result in an attacker being able to send packets to the resolver:</p>
<ul>
<li>A resolver that leaves its listening port open to the internet.</li>
<li>An attacker that manages to get control of an endpoint in the internal network.</li>
<li>A client in the internal network that browses to an attacker controlled website.</li>
</ul>
<p>For example, lets assume that an attacker penetrated one of the endpoints in the internal network and is now looking to poison the local resolvers cache. It is important to note that this attack can be implemented, in the exact same way, on more critical resolvers such as an ISPs resolver.</p>
<p>The client visits <span style="font-family: 'courier new', courier, monospace;">www.example.com</span> and the domain is missing from the resolver cache, so it initiates the process described above to resolve the address of the domain. In the meantime, the attacker sends an answer packet to the resolver with a fake IP address, faking the DNS server answer. This is the basic idea of the attack, but there are a few mitigations. These include transaction ID and source port randomization.</p>
<p>DNS uses something called transaction ID (TXID) to match each response to the correct request. An attacker has to supply a response with the correct transaction ID or the DNS server will just drop the packets. When this mechanism was invented, many years ago, it wasnt intended to be a security feature, but simply a way to match responses to requests. Before DNS vulnerabilities were discovered, DNS used an ascending index as the transaction ID. It was simple for an attacker to guess that number.</p>
<figure id="attachment_110472" aria-describedby="caption-attachment-110472" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110472" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-226.png" alt="DNS vulnerabilities open the DNS protocol to DNS cache poisoning attacks, such as the attack illustrated here. Here, the attacker interferes with the router's resolver to feed it a fake IP address to use to resolve a requested domain. " width="900" height="404" /><figcaption id="caption-attachment-110472" class="wp-caption-text">Figure 2. A DNS cache poisoning attack.</figcaption></figure>
<p>An attacker would have had to buy a domain and configure their own controlled DNS server. Next, the attacker would ask the resolver in the local network about their own domain. The local resolver would forward the request up the hierarchical DNS ladder until it reached a DNS server that knew the attackers controlled DNS server. At this point, the original DNS request (the one that the attacker issued from the internal network) would get to the attackers controlled DNS server, thus revealing the transaction ID to the attacker.</p>
<p>Using the transaction ID the attacker discovered earlier, they would have a good idea of the transaction ID needed for the fake response to be accepted. In such a case, an attacker could send multiple fake responses with multiple transaction IDs to make sure one of them was the correct one. Then, all there is left for an attacker to do is issue a DNS request for a domain that is not in the local DNS resolvers cache and immediately send fake responses using the transaction ID for that domain.</p>
<p>The local resolver would get the response with the correct transaction ID, drop the others and cache the address. From now on, and for an arbitrary amount of time, any local client that would have visited that domain would be directed to the attackers website.</p>
<h4><a id="post-110465-_ej1fyqx983jm"></a><strong>New Mitigations</strong></h4>
<p>The obvious mitigation, which was implemented, was to randomize the transaction ID for each request (instead of using an ascending counter). This mitigation made the attack much harder to execute. How much harder? Well, MAX_SIZE_OF_QUERY_ID harder. Transaction ID is 16 bits, so that mitigation made the attack 65,536 times harder than before. Not bad  but not bulletproof either.</p>
<h4><a id="post-110465-_5g74a8913yos"></a><strong>Round Two, Fight!</strong></h4>
<p>Those mitigations held off attackers for quite some time, but eventually the internet caught up. While a 16-bits randomization key is quite large, it isnt nearly large enough. Let&#8217;s do the math.</p>
<p>For the following calculation, we need to put down some data:</p>
<ul>
<li>Size of a typical DNS response: 100 bytes = 800 bits</li>
<li>Bandwidth of the attacker: 1 Mega<strong>bits</strong> per second = 1,000,000 bits</li>
<li>Time it takes for a legitimate response to get back to the resolver: two seconds</li>
</ul>
<p>(A side note about the two seconds: Nowadays, with modern internet connection, it obviously takes less than two seconds to fulfill a DNS request, even for domains that arent cached. But as I picked a latency for the sake of example, I also chose an internet speed from the past: 1 Megabits per second.)</p>
<p>There are 65,536 possible transaction IDs, and we have a window of two seconds to send a response with the correct one for a successful attack. In order to calculate our success rate per attack, we need to figure out how many response packets an attacker can dispatch before the actual legitimate response arrives at the resolver. This is easy to calculate: the bandwidth divided by the size of the packet multiplied by the time.</p>
<p>With 1 Mbit/s bandwidth, an attacker can send up to 1,000,000/800 = 1,250 response packets in a second, meaning 2,500 in the two-second window the attacker has. The amount of tries needed to achieve a likely attack, meaning at least 50% success rate with a 1 Mbit/s bandwidth, is about 18 tries.</p>
<p>(You can view the <a href="https://www.wolframalpha.com/input/?i=1-%281-%28%281000000%2F800%29*2%29%2F2%5E16%29%5Ex%3E0.5">complete calculation here</a>: 1,000,000 is the amount of bits we can send in a second with our 1 Mbits\s connection. We divide that by 800, which is the size of a DNS response that yields the amount of responses we can send in a second. We multiply that by 2 because of the 2-second window. We then divide that by 2 to the power of 16, which is the size of the transaction ID field. That is the <em>success rate</em> of a single attack. In order to achieve a successful attack we need that<em> in x attempts, one of the attempts will be successful</em>. Our <em>x </em>attempts are called an experiment, and the set of all possible outcomes of that experiment is called a <em>sample space </em>(). The chance of hitting anything in the sample space is obviously 100% (this is the outer 1 in the equation). In order to get the chance of a likely attack, we need to take the entire sample space and subtract from that anything that is not succeeding in at least a single attack which is another way to say <em>failing in all x attempts</em>. Failing in a single attempt is everything (1) minus succeeding in a single attempt which is exactly 1 minus success rate. We then tell Wolfram Alpha that we are looking for an <em>x </em>that will result in this equation in a number bigger than 0.5, which is 50%.)</p>
<p>In other words, with only 18 tries, an attacker with 1 Mbit/s bandwidth could achieve a success rate that is bigger than 50% with this attack <strong>after </strong>the mitigations. This is how easy it was to craft this devastating attack back in the day.</p>
<h4><a id="post-110465-_sqoovpwg74cc"></a><strong>More Mitigations</strong></h4>
<p>At first, it might seem odd that such a weak mitigation was chosen, but it is important to remember that it was simply impossible to completely reinvent the DNS protocol. It would have broken the internet. Just think of all the devices out there that have a built-in resolver. They would have completely stopped working. But something more had to be done. As demonstrated, transaction ID mitigation was weak.</p>
<p>So the same mitigation was used, this time with the source port. Each DNS request from a DNS client, resolver or name server comes out from a source port. That port wasnt randomized prior to this mitigation.</p>
<p>The source port is a 16 bits number, same as the transaction ID, and it was there for functionality only. For example, a resolver might try to use port 10650, and if that was in use from a previous request, it would try to use 10651 and so on. Of course, not all 16 bits were available, as there are constant ports for other uses.</p>
<p>The source port, combined with the transaction ID, are used together as a <strong>key</strong> for DNS communication  a 32 bits key. Remember that, as it will be important in the attacks I will further discuss. Those extra 16 bits reduced the probability of a successful attack drastically.</p>
<p>Before, with a 1 Mbit/s bandwidth, we had a success rate of 3.8% (You can view the <a href="https://www.wolframalpha.com/input/?i=%28%281000000%2F800%29*2%29%2F2%5E16+in+percent">relevant calculation in Wolfram Alpha</a>). With the source port mitigation, with the same data as before, the probability of successful attack is 0.00005821%. The number of attempts are needed to achieve the same likely successful attack as before is 1,190,820. That makes the success of the attack not reliable enough  and indeed, the source port randomization put an end to most DNS cache poisoning attacks.</p>
<h2><a id="post-110465-_guojbuq7qy12"></a>More Advanced Vulnerabilities</h2>
<p>So far, we have focused on poisoning the cache of a single DNS record, <span style="font-family: 'courier new', courier, monospace;">www.example.com</span> is at <span style="font-family: 'courier new', courier, monospace;">93.184.216.34</span>, also known as an A record. We were poisoning the record at the victims own DNS server, like a router or a Kubernetes cluster. In this approach, we work hard on a difficult attack to poison a single domain. We could do better.</p>
<p>In 2008, security researcher Dan Kaminsky <a href="https://www.blackhat.com/html/webinars/kaminsky-DNS.html">discovered</a> a better approach that&#8217;s drastically more effective than what we have discussed so far in this blog. This vulnerability caused quite a furor in the security community. The general execution method is quite similar to what we discussed so far, meaning we still need to guess the transaction ID and the source port. The probability of succeeding in that is pretty much the same, but in Kaminskys method, we could have poisoned a lot more than a single record if we had succeeded.</p>
<h4><a id="post-110465-_4zmh7uojw99h"></a><strong>NS Record</strong></h4>
<p>As the name suggests, a name server (NS) record is a DNS record that indicates which DNS server is <strong>authoritative</strong> for a domain, meaning which server contains the actual IP address of a domain. In our example earlier, the NS record for <span style="font-family: 'courier new', courier, monospace;">example.com</span> would be a server that holds the addresses of <span style="font-family: 'courier new', courier, monospace;">www.example.com</span>, email.example.com and any <span style="font-family: 'courier new', courier, monospace;">?.example.com</span>.</p>
<p>The attackers goal here is to poison the victims resolver in such a way that when the victim tries to access <span style="font-family: 'courier new', courier, monospace;">www.example.com</span>, <span style="font-family: 'courier new', courier, monospace;">email.example.com</span> or any <span style="font-family: 'courier new', courier, monospace;">?.example.com</span>, the resolver will forward the request to the <strong>attackers </strong>name server instead of the <span style="font-family: 'courier new', courier, monospace;">example.com</span> name server.</p>
<p>This way, the attacker controls every access to every single subdomain of <span style="font-family: 'courier new', courier, monospace;">example.com</span> instead of just <span style="font-family: 'courier new', courier, monospace;">www</span> as before.</p>
<h4><a id="post-110465-_94yw4ka9tg1b"></a><strong>But How?</strong></h4>
<p>Surprisingly, the attack is very similar to the previous attacks that weve described in this blog, but instead of poisoning the cache of the resolver with an A record, an attacker will attempt to poison the cache with an NS record.</p>
<p>An attacker would first configure a name server for the domain they want to poison. There is nothing stopping anybody from configuring their own name server to be authoritative for any domain. However, it would ordinarily be pointless as no other server would point to it.</p>
<figure id="attachment_110474" aria-describedby="caption-attachment-110474" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-110474" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/12/word-image-227.png" alt="More advanced DNS vulnerabilities open the way to an entire zone poisoning attack, such as the one illustrated here. Here, the attacker poisons not just a single record but an NS record, which creates a much larger effect. " width="900" height="311" /><figcaption id="caption-attachment-110474" class="wp-caption-text">Figure 3. An entire zone poisoning attack.</figcaption></figure>
<p>The attacker would then proceed to issue a DNS request for the subdomain of the zone they want to poison. It would have to be a domain that isnt cached, so they would know for sure the resolver will forward the request to a root server. Not only that, but the NS record of that domain in our example, the authoritative name server of <span style="font-family: 'courier new', courier, monospace;">example.com</span>, shouldnt be cached either. If it were cached, the resolver would simply forward the request to that authoritative name server directly, without even forwarding the request to the root server.</p>
<p>After the attacker makes the victims resolver forward their request to the root server, the root server will usually answer with an NS record, which is roughly equivalent to saying, I don&#8217;t know the answer, but you can ask this server over there. Here is its IP address.</p>
<p>This is the tricky part. To succeed in the attack, the attacker now needs to outperform the root server and deliver the poisonous response before the root servers response is sent. This is achieved by sending large amounts of responses with an NS record of the desired domain. Dont forget the attacker needs to guess the transaction ID (and possibly the source port, too).</p>
<p>Each NS answer comes with a glue record, which is the actual IP address of the name server. If it was any other way, the requesting server wouldn&#8217;t know where to find the name server. The resolver receives this glue record, caches it and contacts the name server that the glue points to in order to get the address of the requested domain.</p>
<p>If the attack succeeds, from now on, each request to the resolver for any domain that is uncached under the poisoned domain zone (<span style="font-family: 'courier new', courier, monospace;">example.com</span> in <span style="font-family: 'courier new', courier, monospace;">www.example.com</span>) would arrive at the attackers name server.</p>
<h4><a id="post-110465-_6ciyutgvv5sa"></a><strong>Applications</strong></h4>
<p>With this advanced attack, an attacker can poison a large amount of domains at the same time. Theoretically, an attacker could even poison the entire <span style="font-family: 'courier new', courier, monospace;">.com</span> zone.</p>
<p>While poisoning a zone as big as <span style="font-family: 'courier new', courier, monospace;">.com</span> would be challenging, there have been cases where an attacker actually managed to poison an entire cache. Some examples:</p>
<ul>
<li>On Jan. 26, 2015, a hacker group managed to <a href="https://www.bbc.com/news/world-asia-30978299">redirect visitors to the Malaysia Airlines website</a> to another site displaying malicious content.</li>
<li>On Nov. 7, 2011, hackers managed to <a href="https://securelist.com/massive-dns-poisoning-attacks-in-brazil/31628/">poison an entire internet service providers cache</a>, redirecting users to the installation of malware before redirecting them back to the site they requested.</li>
<li>On Dec. 18, 2009, <a href="https://www.theregister.com/2009/12/18/dns_twitter_hijack/">a DNS hijacking attack</a> left Twitter temporarily affected for about an hour.</li>
</ul>
<p>Hundreds of such attacks take place every year.</p>
<h4><a id="post-110465-_yz4gt871zgw8"></a><strong>Mitigations</strong></h4>
<p>No actual new mitigations took place, as this attack was already nearly impossible to execute with the transaction ID and port randomization mitigations that were already used. But if an attacker managed to overcome those mitigations, using this attack instead of the regular single A record attack would be much more severe.</p>
<p>In the same way as before, using transaction ID and port randomization together to create a key large enough to be too hard for an attacker to guess mitigates the attack.</p>
<h2><a id="post-110465-_fhrg0yfuwszi"></a>Recent Vulnerabilities</h2>
<p>Even if the DNS protocol is considered secure, developers could fail to implement it securely.</p>
<p>For example, there is a common misconception that randomization functions should be unpredictable, so they can be used to generate cryptographic keys. However, those functions are not meant to be used for cryptography or security. Unfortunately, misuse of randomization functions frequently happen in the case of DNS implementations.</p>
<p>This happened with the function that was used to randomize the transaction ID in CoreDNS, <a href="https://github.com/miekg/dns/issues/1043">just two years ago</a>. The developers chose to use <span style="font-family: 'courier new', courier, monospace;">math.rand</span>, which is a non-cryptographically secure pseudorandom number generator in Golang. This was a big problem. If an attacker could predict the transaction ID, they would absolutely be able to poison CoreDNSs cache as described earlier in this blog. It means that every application that used CoreDNS as its DNS resolver would have been vulnerable to malicious DNS records. In other words, because CoreDNS is mainly used for Kubernetes, every single application in every single node in the entire cluster would have been vulnerable to this attack.</p>
<p>Another example is a <a href="https://dl.acm.org/doi/pdf/10.1145/3372297.3417280">new technique that was discovered just a few weeks ago</a>, which uses the Internet Control Message Protocol (ICMP) to pinpoint which ports are closed on a server, thus revealing which ports are actually open. This, used in a DNS attack, can drastically reduce the number of ports an attacker needs to guess, reducing the effectiveness of the port randomization mitigation explained earlier.</p>
<p>And of course, there are also typical non cache-related vulnerabilities like buffer overflows. <em>dnsmasq</em> is a common DNS resolver used in many Linux distributions and routers, and was even used in early versions of Kubernetes. In recent years, <a href="https://access.redhat.com/security/vulnerabilities/3199382"><em>dnsmasq</em> was found vulnerable</a> to numerous memory flaws that could lead to denial of service (DoS), remote code execution (RCE) and more.</p>
<h2><a id="post-110465-_4gh3yx54tinj"></a>Conclusion</h2>
<p>The DNS attacks described in this blog could be devastating if successful. Thanks to modern mitigations, an attacker is unlikely to pull off a DNS poisoning attack, unless combined with any other vulnerability in resolver applications. Unfortunately, such vulnerabilities are frequently found to this day.</p>
<p>Over the years, researchers discovered techniques to overcome some of the mitigations we discussed in this blog, for instance, <a href="https://ripe67.ripe.net/presentations/240-ipfragattack.pdf">user datagram protocol (UDP) fragmentation</a>.</p>
<p>Despite that, with secured browsing and certificates usage nowadays, even if an attacker manages to poison a DNS server for a domain, it is most likely that the browsers victim wont load the page because the certificates wont match. But the technique can still be used for enormous DoS attacks by poisoning an ISPs DNS resolver and forwarding requests to a non-existent IP address.</p>
<p>Palo Alto Networks customers are protected from the attacks outlined in this blog in a variety of ways. Palo Alto Networks Next-Generation Firewalls can block DNS attacks by detecting suspicious DNS queries and anomalous DNS responses. Attacks related to exhaustion or high quantities of traffic are handled with DoS or zone protection profiles that are built into the firewall. These protections are in addition to coverage of DNS threats and indicators through DNS Security Service.</p>
<p>Furthermore, Prisma Cloud can protect your clusters by alerting about outdated and vulnerable components, as well as misconfigured applications in your cloud. Most of the attacks described in this blog require a breach in the internal network of the cluster to be able to send malicious packets to the DNS server from the inside. Such breaches almost always happen by exploiting outdated and misconfigured applications.</p>
<p>&nbsp;</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p> 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
    <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","enable_video_popuping":"enable","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
