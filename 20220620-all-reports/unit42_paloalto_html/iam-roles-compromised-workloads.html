
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>Unit 42 Cloud Threat Report: Misconfigured IAM Roles Lead to Thousands of Compromised Cloud Workloads</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/iam-roles-compromised-workloads/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="We analyze the root cause of risky combinations of IAM policies and offer protection and remediation strategies for misconfigured IAM Roles."/>
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/iam-roles-compromised-workloads/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Unit 42 Cloud Threat Report: Misconfigured IAM Roles Lead to Thousands of Compromised Cloud Workloads" />
<meta property="og:description" content="We analyze the root cause of risky combinations of IAM policies and offer protection and remediation strategies for misconfigured IAM Roles." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/iam-roles-compromised-workloads/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="AWS" />
<meta property="article:tag" content="Cloud Threat Report" />
<meta property="article:tag" content="IAM" />
<meta property="article:tag" content="public cloud" />
<meta property="article:section" content="Unit 42" />
<meta property="article:published_time" content="2020-10-08T13:00:41+00:00" />
<meta property="article:modified_time" content="2020-10-08T15:32:29+00:00" />
<meta property="og:updated_time" content="2020-10-08T15:32:29+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/Cloud-malware.png" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/Cloud-malware.png" />
<meta property="og:image:width" content="601" />
<meta property="og:image:height" content="301" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="We analyze the root cause of risky combinations of IAM policies and offer protection and remediation strategies for misconfigured IAM Roles." />
<meta name="twitter:title" content="Unit 42 Cloud Threat Report: Misconfigured IAM Roles Lead to Thousands of Compromised Cloud Workloads" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/Cloud-malware.png" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; Unit 42 Cloud Threat Report: Misconfigured IAM Roles Lead to Thousands of Compromised Cloud Workloads Comments Feed" href="https://unit42.paloaltonetworks.com/iam-roles-compromised-workloads/feed/" />
<meta property="og:likes" content="2"/>
<meta property="og:readtime" content="15"/>
<meta property="og:views" content="1,532"/>
<meta property="og:date_created" content="October 8, 2020 at 6:00 AM"/>
<meta property="og:post_length" content="3838"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit-42/"/>
<meta property="og:author" content="Jay Chen"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/jaychenpaloaltonetworks-com/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:post_image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/Cloud-malware.png"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"Unit 42 Cloud Threat Report: Misconfigured IAM Roles Lead to Thousands of Compromised Cloud Workloads","name":"Unit 42 Cloud Threat Report: Misconfigured IAM Roles Lead to Thousands of Compromised Cloud Workloads","description":"We analyze the root cause of risky combinations of IAM policies and offer protection and remediation strategies for misconfigured IAM Roles. ","url":"https:\/\/unit42.paloaltonetworks.com\/iam-roles-compromised-workloads\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/iam-roles-compromised-workloads\/","datePublished":"October 8, 2020","articleBody":"Executive Summary\r\nIn the spring of 2020, the Unit 42 Cloud Threat Intelligence Team was approached by a customer who wanted the group to test the defenses of their Amazon Web Services (AWS) infrastructure. The customer ran thousands of workloads, hundreds of Amazon Simple Storage Service (S3) buckets and maintained cloud native databases with over 500 active development users and nearly 1,000 roles across four AWS accounts. For this Red Team exercise, Unit 42 researchers were provided limited information about the internal architecture and were given limited access to the environment itself. The researchers were able to gain privileged access to two AWS accounts using two different identity and access management (IAM) misconfigurations. The misconfigurations allowed the researchers to gain access to the cloud as anonymous users and then pivot to source code repositories hosted outside the cloud.\r\n\r\nThe first identified misconfiguration (see \u201cRisky Combination of Policies\u201d) exploited a risky combination of policies that allow users with an IAM role to elevate to AdministratorAccess. When hundreds of users are given this role, this opens up many potential avenues for exploiting this vulnerability to gain AdministratorAccess and compromise the entire cloud. The second identified misconfiguration (see \u201cOverly Permissive IAM Trust Policy\u201d) exploits an overly permissive IAM trust policy that allows unauthenticated users to gain access to internal resources anonymously. The researchers successfully moved laterally inside the cloud to eventually obtain private keys for certificates, database credentials and repository source code.\r\n\r\nAfter analyzing the severity of overly permissive IAM trust policies, Unit 42 researchers then conducted reconnaissance research on GitHub to look for AWS accounts with misconfigured IAM trust policies. The research found misconfigured accounts belonging to billion-dollar organizations \u2013 a U.S. pharmaceutical company and a financial company based in Brazil.\r\n\r\nAll of these misconfigurations could lead to major data breaches that leak thousands of sensitive details on cloud workloads, such as virtual machine (VM) snapshots, database tables and S3 buckets.\r\n\r\nDetails of the Red Team exercises and GitHub reconnaissance research can be found in the Unit 42 Cloud Threat Report, 2H 2020 (CTR). This blog covers the techniques and processes used to identify the attack paths in the cloud. The blog analyzes the root cause of risky combinations of IAM policies. Protection and remediation strategies specifically for the identified misconfigurations are also included.\r\n\r\nUnit 42 researchers note that all misconfigurations found during the exercise were customer misconfigurations, not AWS platform security misconfigurations. AWS has tried its best to detect and alert users when an IAM trust policy is misconfigured. However, while IAM trust policies are secure by default, users can still override the policies and introduce insecure configurations. AWS also offers its free IAM Access Analyzer to help identify unintended access to resources and data that are shared with an external entity.\r\nAWS IAM\r\nAWS IAM is one of the most complex services in any cloud environment. It governs the interaction between every user, service and resource. While cloud IAM services are securely designed by the cloud service providers (CSPs), like AWS, if misconfigured by the customer or misused, the damage may impact multiple services and resources. For example, the Capital One data breach in 2019 cost the company $80 million due to overly permissive IAM configurations that allowed the attacker to move laterally from AWS Web Application Firewall (WAF) to Amazon Elastic Compute Cloud (EC2) and S3 buckets.\r\n\r\nKnowing how critical IAM services and their configurations can be, when Unit 42 researchers considered how to approach the customer\u2019s requested Red Team exercise, we decided to start with IAM. We tested the customer's cloud environments by poking at different IAM features. Two independent IAM Role-related misconfigurations were identified in two different AWS accounts that allowed researchers to successfully compromise their cloud environments. The next section provides a primer to AWS IAM Roles.\r\nAWS IAM Role\r\nAn AWS IAM Role is an IAM identity that provides temporary access to cloud users or services. The concept of the IAM Role is based on Role-Based Access Control. Users who need the same access permissions are assigned the same role, and multiple roles may be assigned to a single user. In AWS, a principal (meaning a user or service) assigned a role can obtain a short-term access token by \u201cassuming\u201d the role. The token gives the principal access to authorized resources. Each token can be set to expire between 15 minutes and 12 hours from the time it is granted. Once a token has expired, a new token needs to be requested to continue the access. Common use cases for IAM roles include:\r\n\r\n \tUsers who need temporary access to certain cloud resources can be associated with an IAM Role that grants specific permissions.\r\n \tCloud services like EC2 or AWS Lambda that need to interact with certain cloud resources can be attached with IAM roles.\r\n \tOrganizations that have existing Identity Providers (IdP) such as Azure Active Directory (AD) or OpenID can use IAM roles to grant cloud access to users managed by the IdP. Existing users in an AD can simply assume a role to access the cloud without having user accounts in the cloud.\r\n \tUsers or services from one cloud account can be given cross-account access to another. For example, suppose a group of developers in Cloud A need to collaborate with developers in Cloud B using AWS CodeBuild. In that case, an IAM role can be created in Cloud B to grant access to developers in Cloud A.\r\n\r\nRisky Combination of Policies \r\nUnit 42 researchers were provisioned with the developer's role in the customer's development environment to emulate insider attacks and\/or attacks caused by a credential leak. The environment hosted multiple replicas of the production infrastructure for quality assurance (QA) purposes and was actively used by hundreds of developers.\r\n\r\nUnit 42 researchers discovered that users with the developer role could obtain AdministratorAccess by chaining a set of permissions. AdministratorAccess in AWS is the \"key to the kingdom\" that allows attackers to launch any attack against an organization, such as stealing sensitive data or wiping out the entire infrastructure. Although this development environment had no production workloads, an adversary could use the information observed in the development environment to pivot to the production environment. Researchers found credentials, code repositories and even misconfigurations shared in both environments. There were also IAM roles in the production account that allowed users in the development account to assume the role, meaning that attackers in the development account could obtain access tokens in the production account though the AssumeRole. AssumeRole is a unique AWS role that allows cross-account access.\r\n\r\nOne IAM permission that led to this vulnerability was IAM:PassRole. PassRole is a feature that allows a principal to attach an IAM role to another service. For example, a user with PassRole permission can create an EC2 instance and attach a role to a VM. This VM then can use the permissions associated with the role to access AWS resources. IAM PassRole permission is necessary when a principal needs to use an AWS service to manage other AWS resources. AWS Services such as EC2, Lambda, Glue and ECS can all be attached with IAM roles to perform specific actions.\r\n\r\nBecause the PassRole feature allows a principal to grant permissions to cloud services, it can be abused if its permission policy is not restricted. A malicious principal can pass permissions that it doesn't have to a service and exploit this service to perform malicious activities on its behalf.\r\n\r\nThe IAM roles that a principal can pass depend on the principal's permissions policy and the IAM role's trust policy. Permissions policy restricts the IAM roles that the principal can pass and the services that the roles can be passed to. Trust policy restricts the services the role can be attached to.\r\n\r\nIn Figure 1 below, on the left is a permissions policy that allows a principal to pass roles with specific names (role\/DevOpsEC2-* and role\/DevOpsECS-*) to a list of services (ec2.amazonaws.com and ecs.amazonaws.com). On the right is an IAM role's trust policy. In this case, it allows only an EC2 service to assume the role. A principal can pass a role to a target service only when all the following conditions are met:\r\n\r\n \tThe principal\u2019s permissions policy has IAM:PassRole permission.\r\n \tThe role\u2019s name matches the pattern defined in the permissions policy\u2019s resource field.\r\n \tThe target service is listed in the permissions policy\u2019s condition field. If there is no condition field, the principal can pass a role to any service.\r\n \tThe role's trust policy allows the target service to assume the role.\r\n\r\n[caption id=\"attachment_109035\" align=\"aligncenter\" width=\"900\"] Figure 1. The conditions for a principal to pass a role to a service.[\/caption]\r\n\r\nIf the role is more privileged (has more allowed permissions) than the principal, the principal can access the service that the role is attached to, then there is a potential privilege escalation.\r\n\r\nFigure 2 illustrates how Unit 42 researchers discovered, exploited and eventually gained AdministratorAccess in the customer's AWS cloud environment. Researchers identified and confirmed the step-by-step actions an attacker could take to compromise the environment.\r\n\r\n[caption id=\"attachment_109037\" align=\"aligncenter\" width=\"660\"] Figure 2. Attacker\u2019s use of permission chaining to escalate privilege.[\/caption]\r\n\r\n1. An attacker steals a credential from an employee through phishing (e.g. developer role session token). The attacker finds out the permissions of the token by using the AWS IAM API or enumerating the services.\r\n\r\n2. The attacker discovers that the token has IAM:PassRole permission and there is no restriction on the roles that can be passed. The attacker can pass ANY role.\r\n\r\n[caption id=\"attachment_109039\" align=\"aligncenter\" width=\"606\"] Figure 3. An unrestricted PassRole permission.[\/caption]\r\n\r\n3. The attacker checks the existing roles and their trust policies. Normally, each role can only be assumed by a service. The attacker needs to find roles assumable by services to access. The attacker can move forward after finding a subset of roles that meet the conditions.\r\n\r\n[caption id=\"attachment_109041\" align=\"aligncenter\" width=\"710\"] Figure 4. Existing roles and their trust policies.[\/caption]\r\n\r\n4. The attacker checks the permissions policies of the roles that can be exploited. If any of these roles are more privileged (i.e. have more permissions) than the attacker\u2019s current identity, the attacker can pass this role to a service and gain the elevated privilege from the service. The attacker finds multiple roles with AdministratorAccess that can be assumed by EC2.\r\n\r\n[caption id=\"attachment_109043\" align=\"aligncenter\" width=\"608\"] Figure 5. Existing roles with AdministratorAccess[\/caption]\r\n\r\n5. The attacker creates a new EC2 instance and attaches EC2ManagerRole to the VM. The attacker then logs in to the VM and calls the metadata service API at http:\/\/169.254.169[.]254\/latest\/meta-data to retrieve the session token. This session token gives the attacker AdministratorAccess to the entire cloud.\r\n\r\n[caption id=\"attachment_109045\" align=\"aligncenter\" width=\"900\"] Figure 6. Obtain the session token with AdministratorAccess in an EC2 instance.[\/caption]\r\n\r\nThe steps above illustrate just one possible attack path using a misconfigured IAM:PassRole. Unit 42 researchers identified multiple IAM roles and services in the customer's environment that could be exploited the same way.\r\n\r\nThis \"class\" of attack path was exploitable because the permissions policy of the developer's role had no restriction on the PassRole action (Figure 3). Furthermore, AdministratorAccess was given to multiple IAM roles that could be exploited. Considering that hundreds of developers are using this IdP role daily, there is a considerable chance that, had one of the developers\u2019 laptops been hacked, the outcome would have been damaging. With AdministratorAccess, a malicious actor could exfiltrate sensitive data, disrupt the business operation or lock down the entire infrastructure with ransomware.\r\n\r\nUpon identifying the issues, Unit 42 researchers immediately worked with the customer to remediate the misconfiguration and review the logs. Fortunately, the forensic work indicated that no malicious actors had successfully exploited this misconfiguration.\r\nOverly Permissive IAM Trust Policy\r\nUnit 42 researchers found the customer\u2019s production AWS account ID from the customer\u2019s GitHub page. The GitHub page hosts instructions and scripts used for integrating with the customer\u2019s products. With the account ID, researchers were able to enumerate the misconfigured IAM Roles by attempting to assume a list of role names. It did not take long to find a misconfigured role that can be assumed anonymously. Figure 7 illustrates how researchers identified and confirmed the step-by-step actions an attacker could take to compromise the environment:\r\n\r\n[caption id=\"attachment_109047\" align=\"aligncenter\" width=\"640\"] Figure 7. Attacker\u2019s path to compromise the cloud.[\/caption]\r\n\r\n \tAn attacker obtains a list of role names (e.g., prodApp-nat, prodApp-app2-nat) through reconnaissance and enumeration. Because the role names are not long and somewhat predictable, it is feasible to find a misconfigured role through enumeration.\r\n\r\n[caption id=\"attachment_109049\" align=\"aligncenter\" width=\"456\"] Figure 8. IAM roles trust policy that allows anonymous access.[\/caption]\r\n\r\n2.\u00a0 The attacker obtains a temporary access token by assuming the misconfigured role. With the access token, the attacker can enumerate the permissions and find the resources it can access.\r\n\r\n[caption id=\"attachment_109051\" align=\"aligncenter\" width=\"900\"] Figure 9. The misconfigured IAM role has limited access to EC2, S3 and KMS services.[\/caption]\r\n\r\n3. The attacker can see all the EC2 instances and read their metadata. From the startup script in the metadata, the attacker can obtain information such as the Docker images the VM deploys, the database that the VM queries and the S3 buckets the VM pulls data from.\r\n\r\n[caption id=\"attachment_109053\" align=\"aligncenter\" width=\"713\"] Figure 10. A sample of EC2 metadata shows the S3 buckets that the VM can access.[\/caption]\r\n\r\n4. The attacker then accesses the S3 buckets found in the EC2 metadata and downloads all the data. There are certificate keys, multiple shell scripts used for deploying applications and a few encrypted files containing credentials.\r\n\r\n[caption id=\"attachment_109055\" align=\"aligncenter\" width=\"900\"] Figure 11. Sensitive files in the compromised S3 bucket.[\/caption]\r\n\r\n5. The attacker uses the AWS KMS decrypt capability available to the role to decrypt the ciphertext, now giving the attacker plaintext access credentials.\r\n\r\n6. After obtaining the plaintext credentials, the attacker can move laterally and access the Docker Hub repository, Splunk server and databases.\r\n\r\n[caption id=\"attachment_109057\" align=\"aligncenter\" width=\"900\"] Figure 12. Compromised source code repository in Docker Hub.[\/caption]\r\n\r\nThis misconfigured IAM role was a critical vulnerability because it allowed an unauthenticated attacker to exploit it remotely. With the private keys for certificates, attackers could launch man-in-the-middle attacks or impersonate the company\u2019s official sites. With source code repository access, attackers could leak the company\u2019s intellectual properties, find vulnerabilities or even inject malware into the source code. Fortunately, the forensic work indicated that no malicious actors had successfully exploited this misconfiguration.\r\nA Peek at Misconfigured IAM Trust Policies in the Wild\r\nSince it is possible to check the IAM trust policy's configuration remotely and anonymously, Unit 42 researchers were curious to discover how common the misconfiguration is. The researchers' approach was to use publicly available data in GitHub to conduct reconnaissance operations.\r\n\r\nSearching for misconfigured IAM roles is similar to searching for exposed databases that allow logging in without a password. Instead of scanning for IP addresses and ports, Unit 42 researchers performed a scan for AWS account IDs. Instead of searching for database users who can be authenticated without a password, researchers searched for IAM roles that can be assumed anonymously. If the name of a misconfigured role is correctly guessed, researchers (or attackers) could assume the role and obtain an access token.\r\n\r\nOverall, Unit 42 researchers analyzed 283,751 files across 145,623 repositories and identified 32,987 confirmed AWS account IDs and 68,361 role names. Figure 13 illustrates the research methodology:\r\n\r\n[caption id=\"attachment_109059\" align=\"aligncenter\" width=\"900\"] Figure 13. Methodology of finding misconfigured IAM roles on GitHub.[\/caption]\r\n\r\n \tUnit 42 researchers used GitHub API to search for files that may contain Amazon Resource Names (ARNs) or AWS IAM Role Names. Researchers used all possible resource names listed in the IAM document as keywords to query the GitHub API. For example, the keyword arn:aws:amplify matches an AWS Amplify ARN and the keyword arn:aws:cloud9 matches a AWS Cloud9 ARN. IAM Role Name may also appear in an IAM ARN such as arn:aws:iam:123456789012:role\/MyTestRole. Because AWS operates in 3 different partitions, different partition names (aws, aws-cn, aws-us-gov) were also used in the search keywords.\r\n \tOnce all the files had been downloaded, Unit 42 researchers first extracted potential account IDs and role names using regular expressions. If a file was in AWS CloudFormation or Terraform format, the file was further parsed into a JSON object and had all the property names analyzed. Due to the popularity of IaC templates, more than 70% of the downloaded files were IaC, which made the analysis easier and more accurate.\r\n \tBecause not all the extracted account IDs are valid, researchers used the AWS Management Console page to validate each account ID. AWS creates a console page at https:\/\/account_alias_or_id.signin.aws.amazon.com\/console\/ for each active account. If an account ID exists and is active, sending an http request to this URL will receive an HTTP 200 response. AWS accounts in aws-cn and aws-us-gov partitions can also be tested similarly using URLs https:\/\/account_alias_or_id.signin.amazonaws.cn\/console\/ and https:\/\/account_alias_or_id.signin.amazonaws-us-gov.com\/console\/, respectively.\r\n\r\n[caption id=\"attachment_109061\" align=\"aligncenter\" width=\"900\"] Figure 14. Attempt to access the console page of a non-existent AWS account ID.[\/caption]\r\n\r\n4. Finding existing role names in an AWS account is similar to brute-forcing passwordless user names in a database. Thanks to the technique published by Rhino Security Labs, it is possible to check if a role name exists in an AWS account without leaving any trace in the target account. The technique abuses the AWS IAM trust policy validator to check if an IAM role specified in the Principal field exists. Unit 42 researchers enumerated each verified account ID with a subset of role names identified in Step 2. Role names found in the same GitHub repository as the account ID were tested first, followed by the top 500 most common IAM role names found in GitHub.\r\n\r\n[caption id=\"attachment_109063\" align=\"aligncenter\" width=\"708\"] Figure 15. Attempt to set the principal to a non-existent IAM role.[\/caption]\r\n\r\n5. To check if an existing IAM role can be assumed anonymously, Unit 42 researchers attempted to assume each role using the assume-role command. If the role can be assumed anonymously, a secret key and session token set will be returned. Note that this step leaves logs at the target account regardless of whether the role is successfully assumed.\r\n\r\nWithin the misconfigured accounts, hundreds of thousands of EC2 snapshots, thousands of EC2 volumes and hundreds of S3 buckets were found. The resources leaked from a misconfigured IAM role depended on the permission policy of the role itself. Unit 42 researchers discovered misconfigured DevOps roles that had near system administrator permission. Also found were misconfigured DBAccess roles that had access to database services such as Amazon DynamoDB and Amazon Redshift. Finally, there were LambdaExecution roles that allowed only basic Get and Invoke actions on Lambda functions.\r\n\r\nMost notably, the research found misconfigured accounts belonging to billion-dollar organizations \u2013 a U.S. pharmaceutical company and a financial company based in Brazil.\r\n\r\nRegardless of the types of resources these misconfigured roles could access, they all leaked information that malicious actors can exploit. A compromised cloud account could be much worse than a compromised cloud host because a cloud account may have access to hundreds or thousands of cloud resources. The seemingly endless resources in the cloud make the infrastructure an attractive target. Even an account with only LambdaExecution permission could impose significant financial impact by invoking a large number of function calls.\r\nConclusion\r\n Humans are good at many things, but identifying risky permissions across hundreds of identities is a task best left to automation. Research has shown that overly permissive or stale accounts exist in almost every cloud environment. While cloud providers deliver a good baseline for implementing a least-privileged approach to permissions, this breaks down as cloud adoption scales across multiple providers. The complex and dynamic nature of IAM makes it difficult to stay in a secure state continuously. A secure IAM today may become insecure tomorrow when a new role is added or an existing policy is edited. Nevertheless, good IAM hygiene can also greatly reduce risk.\r\n\r\n Unit 42 researchers recommend the following best practices:\r\nAWS users\r\n\r\n \tGranular access control on sensitive data and workloads (least privilege): Grant only absolutely needed permissions to users and services. A few examples:\r\n\r\n \t If a service only needs to access a few files in an S3 bucket, don\u2019t grant the service access to the entire bucket.\r\n \t If a service only needs to decrypt\/encrypt data using a particular key in the KMS, don\u2019t grant the service access to the entire KMS.\r\n \t If a sensitive file in an S3 bucket or a key in KMS is only accessed by a particular service, block all traffic from sources other than the service.\r\n\r\n\r\n \tHarden IAM Role\u2019s Trust Policy: Never grant anonymous access (\"Principal\" : { \"AWS\" : \"*\" }) to any IAM role. Make role names difficult to guess by adding random strings. If the role is shared across AWS accounts, enforce unguessable external ID as another layer of protection. If a role is only assumed by users or services from specific IP addresses, enforce a condition on the principal\u2019s source IPs.\r\n \tHarden the IAM:PassRole Permission: When granting the IAM:PassRole permission in a policy, always enforce restrictions on:\r\n\r\n \tThe role names that the principal can pass.\r\n \tThe services that the principal can pass a role to.\r\n\r\n\r\n\r\nAll CSP users\r\n\r\n \tEnable MFA: Multi-factor authentication (MFA) provides another layer of security in case the primary password is compromised. MFA can be enabled for both users and IAM roles.\r\n \tAutomate Credential Rotation: Implement an automated process to rotate credentials used in the cloud environment. Rotating credentials periodically can mitigate the risk of credential leak.\r\n \tHarden the IAM:PassRole Permission: When granting the IAM:PassRole permission in a policy, always enforce restrictions on:\r\n\r\n \tThe role names that the principal can pass.\r\n \tThe services that the principal can pass a role to.\r\n\r\n\r\n \tCreate groups or roles with granular permissions: Users in the same project tend to have similar permission requirements and can be placed in the same group or role to simplify the permission management. However, if there are smaller teams working on different parts of the project, roles or groups with smaller permission boundaries should be created for each team.\r\n \tMonitor IAM APIs: All major cloud service providers have services to monitor IAM usage. These services help identify abnormal activities, such as brute-force attacks and logging from unrecognized devices or locations.\r\n \tLeverage cloud native security platforms: Managing a large number of privileged users with access to an ever-expanding set of sensitive resources can be challenging. On top of that, cloud resources themselves have permission sets that need to be managed. Cloud native security platforms (CNSPs) like Prisma Cloud help leverage the identity of cloud resources to enforce security policies and ensure secure user behavior across multiple cloud environments.\r\n\r\nDownload the Unit 42 Cloud Threat Report, 2H 2020 for more research and best practices to implement in your organization.\r\nAdditional Resources\r\n\r\n \tHighlights from the Unit 42 Cloud Threat Report, 2H 2020\r\n \tUnit 42 Cloud Threat Report: CSP Findings on Logging, Encryption and Exposed Services\r\n\r\n&nbsp;","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2020\/10\/Cloud-malware.png","width":150,"height":75},"author":[{"@type":"Person","name":"Jay Chen"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"109032","token":"69bfc6ac85","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=109032' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fiam-roles-compromised-workloads%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fiam-roles-compromised-workloads%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-109032 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">Unit 42 Cloud Threat Report: Misconfigured IAM Roles Lead to Thousands of Compromised Cloud Workloads</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-109032 entry-meta">
			
			
			<span class="post-views-count">1,532</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'109032','like')"><i class="ui ui-2"></i><span class="ml-5">2</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 15</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fiam-roles-compromised-workloads%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Fiam-roles-compromised-workloads%2F+-+Unit+42+Cloud+Threat+Report%3A+Misconfigured+IAM+Roles+Lead+to+Thousands+of+Compromised+Cloud+Workloads" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fiam-roles-compromised-workloads%2F&title=Unit+42+Cloud+Threat+Report%3A+Misconfigured+IAM+Roles+Lead+to+Thousands+of+Compromised+Cloud+Workloads&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/iam-roles-compromised-workloads/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/jaychenpaloaltonetworks-com/" title="Posts by Jay Chen" class="author url fn" rel="author">Jay Chen</a>        </p>
        <p><time datetime="2020-10-08T13:00:41+00:00">October 8, 2020 at 6:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit-42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/aws/" rel="tag">AWS</a>, <a href="https://unit42.paloaltonetworks.com/tag/cloud-threat-report/" rel="tag">Cloud Threat Report</a>, <a href="https://unit42.paloaltonetworks.com/tag/iam/" rel="tag">IAM</a>, <a href="https://unit42.paloaltonetworks.com/tag/public-cloud/" rel="tag">public cloud</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="601" height="301" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/Cloud-malware.png" class="attachment-single size-single" alt="The conceptual image illustrates the idea of the risks that misconfigured IAM roles can pose for cloud workloads." />            </figure>
                    <h2><a id="post-109032-_tuxxyu5ges3u"></a><strong>Executive Summary</strong></h2>
<p>In the spring of 2020, the Unit 42 Cloud Threat Intelligence Team was approached by a customer who wanted the group to test the defenses of their Amazon Web Services (AWS) infrastructure. The customer ran thousands of workloads, hundreds of Amazon Simple Storage Service (S3) buckets and maintained cloud native databases with over 500 active development users and nearly 1,000 roles across four AWS accounts. For this Red Team exercise, Unit 42 researchers were provided limited information about the internal architecture and were given limited access to the environment itself. The researchers were able to gain privileged access to two AWS accounts using two different identity and access management (IAM) misconfigurations. The misconfigurations allowed the researchers to gain access to the cloud as anonymous users and then pivot to source code repositories hosted outside the cloud.</p>
<p>The first identified misconfiguration (see Risky Combination of Policies) exploited a risky combination of <a href="https://aws.amazon.com/iam/features/manage-permissions/">policies</a> that allow users with an IAM role to elevate to <span style="font-family: 'courier new', courier, monospace;"><a href="https://console.aws.amazon.com/iam/home#policies/arn:aws:iam::aws:policy/AdministratorAccess">AdministratorAccess</a></span>. When hundreds of users are given this role, this opens up many potential avenues for exploiting this vulnerability to gain <span style="font-family: 'courier new', courier, monospace;">AdministratorAccess</span> and compromise the entire cloud. The second identified misconfiguration (see Overly Permissive IAM Trust Policy) exploits an overly permissive <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_terms-and-concepts.html">IAM trust policy</a> that allows unauthenticated users to gain access to internal resources anonymously. The researchers successfully moved laterally inside the cloud to eventually obtain private keys for certificates, database credentials and repository source code.</p>
<p>After analyzing the severity of overly permissive IAM trust policies, Unit 42 researchers then conducted <a href="#post-109032-p8p3dxoyy8ju">reconnaissance research</a> on GitHub to look for AWS accounts with misconfigured IAM trust policies. The research found misconfigured accounts belonging to billion-dollar organizations  a U.S. pharmaceutical company and a financial company based in Brazil.</p>
<p>All of these misconfigurations could lead to major data breaches that leak thousands of sensitive details on cloud workloads, such as virtual machine (VM) snapshots, database tables and S3 buckets.</p>
<p>Details of the Red Team exercises and GitHub reconnaissance research can be found in the <a href="https://www.paloaltonetworks.com/prisma/cloud/unit42-ctr-oct-2020-IAM">Unit 42 Cloud Threat Report, 2H 2020</a> (CTR). This blog covers the techniques and processes used to identify the attack paths in the cloud. The blog analyzes the root cause of risky combinations of IAM policies. Protection and remediation strategies specifically for the identified misconfigurations are also included.</p>
<p><span style="font-weight: 400;">Unit 42 researchers note that all misconfigurations found during the exercise were customer misconfigurations, not AWS platform security misconfigurations. AWS has tried its best to detect and alert users when an IAM trust policy is misconfigured. However, while IAM trust policies are secure by default, users can still override the policies and introduce insecure configurations. AWS also offers its free IAM Access Analyzer to help identify unintended access to resources and data that are shared with an external entity.</span></p>
<h4><a id="post-109032-_ftqsmijcykta"></a>AWS IAM</h4>
<p><a href="https://aws.amazon.com/iam/">AWS IAM </a>is one of the most complex services in any cloud environment. It governs the interaction between every user, service and resource. While cloud IAM services are securely designed by the cloud service providers (CSPs), like AWS, if misconfigured by the customer or misused, the damage may impact multiple services and resources. For example, the <a href="https://securityboulevard.com/2020/06/the-capital-one-data-breach-a-year-later-a-look-at-what-went-wrong-and-practical-guidance-to-avoid-a-breach-of-your-own/">Capital One data breach</a> in 2019 cost the company <a href="https://apnews.com/article/technology-hacking-u-s-news-business-d4e46b99d0613bb9c967b868bd751a46">$80 million</a> due to overly permissive IAM configurations that allowed the attacker to move laterally from AWS Web Application Firewall (WAF) to Amazon Elastic Compute Cloud (EC2) and S3 buckets.</p>
<p>Knowing how critical IAM services and their configurations can be, when Unit 42 researchers considered how to approach the customers requested Red Team exercise, we decided to start with IAM. We tested the customer&#8217;s cloud environments by poking at different IAM features. Two independent IAM Role-related misconfigurations were identified in two different AWS accounts that allowed researchers to successfully compromise their cloud environments. The next section provides a primer to AWS IAM Roles.</p>
<h2><a id="post-109032-_pjilm0xtl9wq"></a><strong>AWS IAM Role</strong></h2>
<p>An <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">AWS IAM Role</a> is an IAM identity that provides temporary access to cloud users or services. The concept of the IAM Role is based on <a href="https://csrc.nist.gov/CSRC/media/Projects/Role-Based-Access-Control/documents/sandhu96.pdf">Role-Based Access Control</a>. Users who need the same access permissions are assigned the same role, and multiple roles may be assigned to a single user. In AWS, a principal (meaning a user or service) assigned a role can obtain a short-term access token by assuming the role. The token gives the principal access to authorized resources. Each token can be set to expire between 15 minutes and 12 hours from the time it is granted. Once a token has expired, a new token needs to be requested to continue the access. Common use cases for IAM roles include:</p>
<ul>
<li>Users who need temporary access to certain cloud resources can be associated with an IAM Role that grants specific permissions.</li>
<li>Cloud services like EC2 or AWS Lambda that need to interact with certain cloud resources can be attached with IAM roles.</li>
<li>Organizations that have existing Identity Providers (IdP) such as <a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview">Azure Active Directory</a> (AD) or <a href="https://openid.net/connect/">OpenID</a> can use IAM roles to grant cloud access to users managed by the IdP. Existing users in an AD can simply assume a role to access the cloud without having user accounts in the cloud.</li>
<li>Users or services from one cloud account can be given cross-account access to another. For example, suppose a group of developers in Cloud A need to collaborate with developers in Cloud B using <a href="https://aws.amazon.com/codebuild/">AWS CodeBuild</a>. In that case, an IAM role can be created in Cloud B to grant access to developers in Cloud A.</li>
</ul>
<h4><strong>Risky Combination of Policies </strong></h4>
<p>Unit 42 researchers were provisioned with the developer&#8217;s role in the customer&#8217;s development environment to emulate insider attacks and/or attacks caused by a credential leak. The environment hosted multiple replicas of the production infrastructure for quality assurance (QA) purposes and was actively used by hundreds of developers.</p>
<p>Unit 42 researchers discovered that users with the developer role could obtain <span style="font-family: 'courier new', courier, monospace;"><a href="https://console.aws.amazon.com/iam/home#policies/arn:aws:iam::aws:policy/AdministratorAccess">AdministratorAccess</a></span> by chaining a set of permissions. <span style="font-family: 'courier new', courier, monospace;">AdministratorAccess</span> in AWS is the &#8220;key to the kingdom&#8221; that allows attackers to launch any attack against an organization, such as stealing sensitive data or wiping out the entire infrastructure. Although this development environment had no production workloads, an adversary could use the information observed in the development environment to pivot to the production environment. Researchers found credentials, code repositories and even misconfigurations shared in both environments. There were also IAM roles in the production account that allowed users in the development account to assume the role, meaning that attackers in the development account could obtain access tokens in the production account though the <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html">AssumeRole</a>. AssumeRole is a unique AWS role that allows <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_common-scenarios_aws-accounts.html">cross-account access</a>.</p>
<p>One IAM permission that led to this vulnerability was <span style="font-family: 'courier new', courier, monospace;"><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_passrole.html">IAM:PassRole</a></span>. PassRole is a feature that allows a <span style="font-family: 'courier new', courier, monospace;"><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/intro-structure.html#intro-structure-principal">principal</a></span> to attach an IAM role to another service. For example, a user with <span style="font-family: 'courier new', courier, monospace;">PassRole</span> permission can create an EC2 instance and attach a role to a VM. This VM then can use the permissions associated with the role to access AWS resources. IAM PassRole permission is necessary when a principal needs to use an AWS service to manage other AWS resources. AWS Services such as <a href="https://aws.amazon.com/ec2/">EC2</a>, <a href="https://aws.amazon.com/lambda/">Lambda</a>, <a href="https://aws.amazon.com/glue/?whats-new-cards.sort-by=item.additionalFields.postDateTime&amp;whats-new-cards.sort-order=desc">Glue</a> and <a href="https://aws.amazon.com/ecs/">ECS</a> can all be attached with IAM roles to perform specific actions.</p>
<p>Because the <span style="font-family: 'courier new', courier, monospace;">PassRole</span> feature allows a principal to grant permissions to cloud services, it can be abused if its permission policy is not restricted. <strong>A malicious principal can pass permissions that it doesn&#8217;t have to a service and exploit this service to perform malicious activities on its behalf.</strong></p>
<p>The IAM roles that a principal can pass depend on<strong> the principal&#8217;s permissions policy</strong> and <strong>the IAM role&#8217;s trust policy</strong>. Permissions policy restricts the IAM roles that the <span style="font-family: 'courier new', courier, monospace;">principal</span> can pass and the services that the roles can be passed to. Trust policy restricts the services the role can be attached to.</p>
<p>In Figure 1 below, on the left is a permissions policy that allows a <span style="font-family: 'courier new', courier, monospace;">principal</span> to pass roles with specific names (<span style="font-family: 'courier new', courier, monospace;">role/DevOpsEC2-* and role/DevOpsECS-*</span>) to a list of services (<span style="font-family: 'courier new', courier, monospace;">ec2.amazonaws.com and ecs.amazonaws.com</span>). On the right is an IAM role&#8217;s trust policy. In this case, it allows only an EC2 service to assume the role. A <span style="font-family: 'courier new', courier, monospace;">principal</span> can pass a role to a target service only when all the following conditions are met:</p>
<ol>
<li>The <span style="font-family: 'courier new', courier, monospace;">principals</span> permissions policy has <span style="font-family: 'courier new', courier, monospace;">IAM:PassRole</span> permission.</li>
<li>The roles name matches the pattern defined in the permissions policys resource field.</li>
<li>The target service is listed in the permissions policys condition field. If there is no condition field, the <span style="font-family: 'courier new', courier, monospace;">principal</span> can pass a role to any service.</li>
<li>The role&#8217;s trust policy allows the target service to assume the role.</li>
</ol>
<figure id="attachment_109035" aria-describedby="caption-attachment-109035" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-109035" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-9.png" alt="The code shown in the image displays an example of a principal's permissions policy and the trust policy of an IAM Role (in this case, DevOpsEC2-EU-NAT)" width="900" height="428" /><figcaption id="caption-attachment-109035" class="wp-caption-text">Figure 1. The conditions for a principal to pass a role to a service.</figcaption></figure>
<p>If the role is more privileged (has more allowed permissions) than the <span style="font-family: 'courier new', courier, monospace;">principal</span>, the <span style="font-family: 'courier new', courier, monospace;">principal</span> can access the service that the role is attached to, then there is a potential <strong>privilege escalation</strong>.</p>
<p>Figure 2 illustrates how Unit 42 researchers discovered, exploited and eventually gained <span style="font-family: 'courier new', courier, monospace;">AdministratorAccess</span> in the customer&#8217;s AWS cloud environment. Researchers identified and confirmed the step-by-step actions an attacker could take to compromise the environment.</p>
<figure id="attachment_109037" aria-describedby="caption-attachment-109037" style="width: 660px" class="wp-caption aligncenter"><img class="wp-image-109037" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-10.png" alt="The figure displays how an attacker can use permission chaining to escalate privilege. The steps are: 1) Check my permission policies to see my allowed permissions; 2) Check PassRole condition, find list of IAM roles allowed to be passed; 3) Check role trust policies and services I can access, look for roles assumable by some services that I can access; 4) Check role permission policies; 5) Attach a more privileged role to my service" width="660" height="380" /><figcaption id="caption-attachment-109037" class="wp-caption-text">Figure 2. Attackers use of permission chaining to escalate privilege.</figcaption></figure>
<p>1. An attacker steals a credential from an employee through phishing (e.g. <span style="font-family: 'courier new', courier, monospace;">developer role session token</span>). The attacker finds out the permissions of the token by using the <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html">AWS IAM API</a> or enumerating the services.</p>
<p>2. The attacker discovers that the token has <span style="font-family: 'courier new', courier, monospace;">IAM:PassRole</span> permission and there is no restriction on the roles that can be passed. The attacker can pass ANY role.</p>
<figure id="attachment_109039" aria-describedby="caption-attachment-109039" style="width: 606px" class="wp-caption aligncenter"><img class="wp-image-109039" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-11.png" alt="The code shown reads: &quot;iam:GetPolicy&quot;, &quot;Iam:GetPolicyVersion&quot;, &quot;iam:ListRoles&quot;, &quot;iam:PassRole&quot;, &quot;kms:List*&quot;, &quot;s3:*&quot;, &quot;sdb:*&quot;], &quot;Effect&quot;: &quot;Allow&quot;, &quot;Resource&quot;: &quot;*&quot; ], -- this shows an unrestricted PassRole permission" width="606" height="349" /><figcaption id="caption-attachment-109039" class="wp-caption-text">Figure 3. An unrestricted PassRole permission.</figcaption></figure>
<p>3. The attacker checks the existing roles and their trust policies. Normally, each role can only be assumed by a service. The attacker needs to find roles assumable by services to access. The attacker can move forward after finding a subset of roles that meet the conditions.</p>
<figure id="attachment_109041" aria-describedby="caption-attachment-109041" style="width: 710px" class="wp-caption aligncenter"><img class="wp-image-109041" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-12.png" alt="This shows a list of existing IAM roles and their trust policies. Each IAM role is partially obscured and followed by a list of trusted entities, in the form of specific AWS services. " width="710" height="423" /><figcaption id="caption-attachment-109041" class="wp-caption-text">Figure 4. Existing roles and their trust policies.</figcaption></figure>
<p>4. The attacker checks the permissions policies of the roles that can be exploited. If any of these roles are more privileged (i.e. have more permissions) than the attackers current identity, the attacker can pass this role to a service and gain the elevated privilege from the service. The attacker finds multiple roles with <span style="font-family: 'courier new', courier, monospace;">AdministratorAccess</span> that can be assumed by EC2.</p>
<figure id="attachment_109043" aria-describedby="caption-attachment-109043" style="width: 608px" class="wp-caption aligncenter"><img class="wp-image-109043" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-13.png" alt="This screenshot shows an example of what an attacker in search of IAM Roles with AdministratorAccess could check. Under the tab &quot;policy usage&quot; is a list labeled &quot;permissions,&quot; filtered by roles. " width="608" height="912" /><figcaption id="caption-attachment-109043" class="wp-caption-text">Figure 5. Existing roles with AdministratorAccess</figcaption></figure>
<p>5. The attacker creates a new EC2 instance and attaches <span style="font-family: 'courier new', courier, monospace;">EC2ManagerRole</span> to the VM. The attacker then logs in to the VM and calls the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-retrieval.html">metadata service API</a> at <span style="font-family: 'courier new', courier, monospace;">http://169.254.169[.]254/latest/meta-data</span> to retrieve the session token. This session token gives the attacker <span style="font-family: 'courier new', courier, monospace;">AdministratorAccess</span> to the entire cloud.</p>
<figure id="attachment_109045" aria-describedby="caption-attachment-109045" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-109045" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-14.png" alt="The code shown in the screenshot illustrates how an attacker could create a new EC2 instance and attach an IAM Role with elevated privileges, EC2ManagerRole, to the VM. The attacker then logs in to the VM and calls the metadata service API to retrieve the session token. The session token gives the attacker AdministratorAccess to the entire cloud. " width="900" height="380" /><figcaption id="caption-attachment-109045" class="wp-caption-text">Figure 6. Obtain the session token with AdministratorAccess in an EC2 instance.</figcaption></figure>
<p>The steps above illustrate just one possible attack path using a misconfigured <span style="font-family: 'courier new', courier, monospace;">IAM:PassRole</span><em>.</em> Unit 42 researchers identified multiple IAM roles and services in the customer&#8217;s environment that could be exploited the same way.</p>
<p>This &#8220;class&#8221; of attack path was exploitable because the permissions policy of the developer&#8217;s role had no restriction on the <span style="font-family: 'courier new', courier, monospace;">PassRole</span> action (Figure 3). Furthermore, <span style="font-family: 'courier new', courier, monospace;">AdministratorAccess</span> was given to multiple IAM roles that could be exploited. Considering that hundreds of developers are using this IdP role daily, there is a considerable chance that, had one of the developers laptops been hacked, the outcome would have been damaging. With <span style="font-family: 'courier new', courier, monospace;">AdministratorAccess</span>, a malicious actor could exfiltrate sensitive data, disrupt the business operation or lock down the entire infrastructure with ransomware.</p>
<p>Upon identifying the issues, Unit 42 researchers immediately worked with the customer to remediate the misconfiguration and review the logs. Fortunately, the forensic work indicated that no malicious actors had successfully exploited this misconfiguration.</p>
<h4><strong>Overly Permissive IAM Trust Policy</strong></h4>
<p>Unit 42 researchers found the customers production AWS account ID from the customers GitHub page. The GitHub page hosts instructions and scripts used for integrating with the customers products. With the account ID, researchers were able to enumerate the misconfigured IAM Roles by attempting to <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html">assume</a> a list of role names. It did not take long to find a misconfigured role that can be assumed anonymously. Figure 7 illustrates how researchers identified and confirmed the step-by-step actions an attacker could take to compromise the environment:</p>
<figure id="attachment_109047" aria-describedby="caption-attachment-109047" style="width: 640px" class="wp-caption aligncenter"><img class="wp-image-109047" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-15.png" alt="The figure shows an attacker's path to compromise the cloud: 1) Enumerate names in search of misconfigured IAM roles; 2) Enumerate session token permissions in search of EC2, S3, KMSAccess; 3) Enumerate EC2 userdata and get a list of S3 buckets, leading to accessing S3; 4) Get encrypted objects from S3, allowing for KMS decryption; 5) Decrypt objects using KMS, obtaining service credentials; 6) Access more services. " width="640" height="509" /><figcaption id="caption-attachment-109047" class="wp-caption-text">Figure 7. Attackers path to compromise the cloud.</figcaption></figure>
<ol>
<li>An attacker obtains a list of role names (e.g., <span style="font-family: 'courier new', courier, monospace;">prodApp-nat, prodApp-app2-nat</span>) through reconnaissance and enumeration. Because the role names are not long and somewhat predictable, it is feasible to find a misconfigured role through enumeration.</li>
</ol>
<figure id="attachment_109049" aria-describedby="caption-attachment-109049" style="width: 456px" class="wp-caption aligncenter"><img class="wp-image-109049" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-16.png" alt="The code in the image shows an example of an IAM roles trust policy that allows anonymous access: &quot;Effect&quot;: &quot;Allow&quot;, &quot;Principal&quot;: { &quot;AWS&quot;: &quot;*&quot;}, &quot;Action&quot;: &quot;sts:AssumeRole&quot;" width="456" height="306" /><figcaption id="caption-attachment-109049" class="wp-caption-text">Figure 8. IAM roles trust policy that allows anonymous access.</figcaption></figure>
<p>2. The attacker obtains a temporary access token by assuming the misconfigured role. With the access token, the attacker can enumerate the permissions and find the resources it can access.</p>
<figure id="attachment_109051" aria-describedby="caption-attachment-109051" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-109051" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-17.png" alt="This breaks down the specific lines of code in a misconfigured IAM role that enumerate permissions for EC2, S3 and KMS services and show what resources an attacker can access after gaining access to the role. " width="900" height="213" /><figcaption id="caption-attachment-109051" class="wp-caption-text">Figure 9. The misconfigured IAM role has limited access to EC2, S3 and KMS services.</figcaption></figure>
<p>3. The attacker can see all the EC2 instances and read their metadata. From the startup script in the metadata, the attacker can obtain information such as the Docker images the VM deploys, the database that the VM queries and the S3 buckets the VM pulls data from.</p>
<figure id="attachment_109053" aria-describedby="caption-attachment-109053" style="width: 713px" class="wp-caption aligncenter"><img class="wp-image-109053" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-18.png" alt="Once gaining access through misconfigured IAM roles, the attacker can see all the EC2 instances and read their metadata. This allows the attacker to obtain information sucha s the Docker images the VM deploys, the database that the VM queries and the S3 buckets the VM pulls data from. " width="713" height="318" /><figcaption id="caption-attachment-109053" class="wp-caption-text">Figure 10. A sample of EC2 metadata shows the S3 buckets that the VM can access.</figcaption></figure>
<p>4. The attacker then accesses the S3 buckets found in the EC2 metadata and downloads all the data. There are certificate keys, multiple shell scripts used for deploying applications and a few encrypted files containing credentials.</p>
<figure id="attachment_109055" aria-describedby="caption-attachment-109055" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-109055" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-19.png" alt="The attacker then accesses the S3 buckets found in the EC metadata and downloads all the data. The screenshots shown illustrate the types of sensitive files found in the compromised S3 bucket, including certificate keys, multiple shell scripts used for deploying applications and a few encrypted files containing credentials. " width="900" height="400" /><figcaption id="caption-attachment-109055" class="wp-caption-text">Figure 11. Sensitive files in the compromised S3 bucket.</figcaption></figure>
<p>5. The attacker uses the <a href="https://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html">AWS KMS decrypt </a>capability available to the role to decrypt the ciphertext, now giving the attacker plaintext access credentials.</p>
<p>6. After obtaining the plaintext credentials, the attacker can move laterally and access the Docker Hub repository, Splunk server and databases.</p>
<figure id="attachment_109057" aria-describedby="caption-attachment-109057" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-109057" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-20.png" alt="The screenshot shows the compromised source code repository in Docker Hub, which is one of the assets the attacker can move laterally and access after obtaining the plaintext credentials. " width="900" height="642" /><figcaption id="caption-attachment-109057" class="wp-caption-text">Figure 12. Compromised source code repository in Docker Hub.</figcaption></figure>
<p>This misconfigured IAM role was a critical vulnerability because it allowed an unauthenticated attacker to exploit it remotely. With the private keys for certificates, attackers could launch man-in-the-middle attacks or impersonate the companys official sites. With source code repository access, attackers could leak the companys intellectual properties, find vulnerabilities or even inject malware into the source code. Fortunately, the forensic work indicated that no malicious actors had successfully exploited this misconfiguration.</p>
<h4><strong>A Peek at Misconfigured IAM Trust Policies in the Wild</strong></h4>
<p>Since it is possible to check the <a href="https://docs.google.com/document/d/16uvqVBGmqCqnet02ylN8wSsYj5gSsrcySvTrJgYf1QE/edit#bookmark=id.s3k6d9ghyn50">IAM trust policy&#8217;s configuration</a> remotely and anonymously, Unit 42 researchers were curious to discover how common the misconfiguration is. The researchers&#8217; approach was to use publicly available data in GitHub to conduct reconnaissance operations.</p>
<p>Searching for misconfigured IAM roles is similar to searching for exposed databases that allow logging in without a password. Instead of scanning for IP addresses and ports, Unit 42 researchers performed a scan for AWS account IDs. Instead of searching for database users who can be authenticated without a password, researchers searched for IAM roles that can be assumed anonymously. If the name of a misconfigured role is correctly guessed, researchers (or attackers) could assume the role and obtain an access token.</p>
<p>Overall, Unit 42 researchers analyzed 283,751 files across 145,623 repositories and identified 32,987 confirmed AWS account IDs and 68,361 role names. Figure 13 illustrates the research methodology:</p>
<figure id="attachment_109059" aria-describedby="caption-attachment-109059" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-109059" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-21.png" alt="The figure shows the steps taken to find misconfigured IAM roles on GitHub: 1) GitHub search, 2) File Analysis, 3) validation, 4) Role name enumeration, 5) Check misconfigured IAM roles" width="900" height="579" /><figcaption id="caption-attachment-109059" class="wp-caption-text">Figure 13. Methodology of finding misconfigured IAM roles on GitHub.</figcaption></figure>
<ol>
<li>Unit 42 researchers used <a href="https://docs.github.com/en/rest">GitHub API</a> to search for files that may contain <a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html">Amazon Resource Names</a> (ARNs) or <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-iam-role.html">AWS IAM Role Names</a>. Researchers used all possible resource names listed in the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_actions-resources-contextkeys.html">IAM document</a> as keywords to query the GitHub API. For example, the keyword <span style="font-family: 'courier new', courier, monospace;">arn:aws:amplify</span> matches an <a href="https://aws.amazon.com/amplify/">AWS Amplify</a> ARN and the keyword <span style="font-family: 'courier new', courier, monospace;">arn:aws:cloud9</span> matches a <a href="https://aws.amazon.com/cloud9/">AWS Cloud9</a> ARN. IAM Role Name may also appear in an IAM ARN such as <span style="font-family: 'courier new', courier, monospace;">arn:aws:iam:123456789012:role/MyTestRole</span>. Because AWS operates in 3 different <a href="https://docs.amazonaws.cn/en_us/general/latest/gr/aws-arns-and-namespaces.html">partitions</a>, different partition names (<span style="font-family: 'courier new', courier, monospace;">aws, aws-cn, aws-us-gov</span>) were also used in the search keywords.</li>
<li>Once all the files had been downloaded, Unit 42 researchers first extracted potential account IDs and role names using regular expressions. If a file was in <a href="https://aws.amazon.com/cloudformation/">AWS CloudFormation</a> or <a href="https://www.terraform.io/">Terraform</a> format, the file was further parsed into a JSON object and had all the property names analyzed. Due to the popularity of IaC templates, more than 70% of the downloaded files were IaC, which made the analysis easier and more accurate.</li>
<li>Because not all the extracted account IDs are valid, researchers used the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/console.html">AWS Management Console</a> page to validate each account ID. AWS creates a console page at <span style="font-family: 'courier new', courier, monospace;">https://<strong>account_alias_or_id</strong>.signin.aws.amazon.com/console/</span> for each active account. If an account ID exists and is active, sending an http request to this URL will receive an HTTP 200 response. AWS accounts in <span style="font-family: 'courier new', courier, monospace;">aws-cn</span> and <span style="font-family: 'courier new', courier, monospace;">aws-us-gov</span> partitions can also be tested similarly using URLs <span style="font-family: 'courier new', courier, monospace;">https://<strong>account_alias_or_id</strong>.signin.amazonaws.cn/console/ <span style="font-family: georgia, palatino, serif;">and</span> https://<strong>account_alias_or_id</strong>.signin.amazonaws-us-gov.com/console/</span>, respectively.</li>
</ol>
<figure id="attachment_109061" aria-describedby="caption-attachment-109061" style="width: 900px" class="wp-caption aligncenter"><img class="wp-image-109061" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-22.png" alt="This is the 404 page that shows when an attacker attempts to access the console page of a non-existent AWS account ID. " width="900" height="518" /><figcaption id="caption-attachment-109061" class="wp-caption-text">Figure 14. Attempt to access the console page of a non-existent AWS account ID.</figcaption></figure>
<p>4. Finding existing role names in an AWS account is similar to brute-forcing passwordless user names in a database. Thanks to the technique published by <a href="https://rhinosecuritylabs.com/aws/aws-role-enumeration-iam-p2/">Rhino Security Labs</a>, it is possible to check if a role name exists in an AWS account without leaving any trace in the target account. The technique abuses the AWS IAM trust policy validator to check if an IAM role specified in the <span style="font-family: 'courier new', courier, monospace;">Principal</span> field exists. Unit 42 researchers enumerated each verified account ID with a subset of role names identified in Step 2. Role names found in the same GitHub repository as the account ID were tested first, followed by the top 500 most common IAM role names found in GitHub.</p>
<figure id="attachment_109063" aria-describedby="caption-attachment-109063" style="width: 708px" class="wp-caption aligncenter"><img class="wp-image-109063" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2020/10/word-image-23.png" alt="This shows the code that could be used in an attempt to set the principal to a non-existent IAM role, as well as the resulting error message, &quot;Invalid principal in policy.&quot; " width="708" height="371" /><figcaption id="caption-attachment-109063" class="wp-caption-text">Figure 15. Attempt to set the principal to a non-existent IAM role.</figcaption></figure>
<p>5. To check if an existing IAM role can be assumed anonymously, Unit 42 researchers attempted to assume each role using the <span style="font-family: 'courier new', courier, monospace;"><a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/sts/assume-role.html">assume-role</a></span> command. If the role can be assumed anonymously, a secret key and session token set will be returned. Note that this step leaves logs at the target account regardless of whether the role is successfully assumed.</p>
<p>Within the misconfigured accounts, hundreds of thousands of EC2 snapshots, thousands of EC2 volumes and hundreds of S3 buckets were found. The resources leaked from a misconfigured IAM role depended on the permission policy of the role itself. Unit 42 researchers discovered misconfigured DevOps roles that had near system administrator permission. Also found were misconfigured DBAccess roles that had access to database services such as Amazon DynamoDB and Amazon Redshift. Finally, there were LambdaExecution roles that allowed only basic <span style="font-family: 'courier new', courier, monospace;">Get</span> and <span style="font-family: 'courier new', courier, monospace;">Invoke</span> actions on Lambda functions.</p>
<p>Most notably, the research found misconfigured accounts belonging to billion-dollar organizations  a U.S. pharmaceutical company and a financial company based in Brazil.</p>
<p>Regardless of the types of resources these misconfigured roles could access, they all leaked information that malicious actors can exploit. <strong>A compromised cloud account could be much worse than a compromised cloud host because a cloud account may have access to hundreds or thousands of cloud resources.</strong> The seemingly endless resources in the cloud make the infrastructure an attractive target. Even an account with only LambdaExecution permission could impose significant financial impact by invoking a large number of function calls.</p>
<h2>Conclusion</h2>
<p><a id="post-109032-_4uatdypxw5dm"></a> Humans are good at many things, but identifying risky permissions across hundreds of identities is a task best left to automation. Research has shown that overly permissive or stale accounts exist in almost every cloud environment. While cloud providers deliver a good baseline for implementing a least-privileged approach to permissions, this breaks down as cloud adoption scales across multiple providers. The complex and dynamic nature of IAM makes it difficult to stay in a secure state continuously. A secure IAM today may become insecure tomorrow when a new role is added or an existing policy is edited. Nevertheless, good IAM hygiene can also greatly reduce risk.</p>
<p><a id="post-109032-_eo4st6tyjl0e"></a> Unit 42 researchers recommend the following best practices:</p>
<h4><a id="post-109032-_4i4z7rgw0elk"></a><strong>AWS users</strong></h4>
<ul>
<li><a id="post-109032-_g2natpgcdzxx"></a><strong>Granular access control on sensitive data and workloads (least privilege)</strong>: Grant only absolutely needed permissions to users and services. A few examples:
<ul>
<li><a id="post-109032-_oblbgwsfbp7d"></a> If a service only needs to access a few files in an S3 bucket, dont grant the service access to the entire bucket.</li>
<li><a id="post-109032-_umkz66cik3vd"></a> If a service only needs to decrypt/encrypt data using a particular key in the KMS, dont grant the service access to the entire KMS.</li>
<li><a id="post-109032-_a29ymypbn7xz"></a> If a sensitive file in an S3 bucket or a key in KMS is only accessed by a particular service, <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_examples_aws_deny-ip.html">block all traffic from sources</a> other than the service.</li>
</ul>
</li>
<li><strong>Harden IAM Roles Trust Policy</strong>: Never grant <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_principal.html">anonymous access</a> (&#8220;Principal&#8221; : { &#8220;AWS&#8221; : &#8220;*&#8221; }) to any IAM role. Make role names difficult to guess by adding random strings. If the role is shared across AWS accounts, enforce unguessable <a href="https://aws.amazon.com/blogs/security/how-to-use-external-id-when-granting-access-to-your-aws-resources/">external ID</a> as another layer of protection. If a role is only assumed by users or services from specific IP addresses, enforce a <a href="https://aws.amazon.com/premiumsupport/knowledge-center/iam-restrict-calls-ip-addresses/">condition on the principals source IPs</a>.</li>
<li><a id="post-109032-_dr5nqip43w4r"></a><strong>Harden the IAM:PassRole Permission: </strong>When granting the IAM:PassRole permission in a policy, always enforce restrictions on:
<ul>
<li><a id="post-109032-_dnxg8pot1det"></a><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_passrole.html">The role names that the principal can pass</a>.</li>
<li><a id="post-109032-_612qju9iyeka"></a><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_examples_iam-passrole-service.html">The services that the principal can pass a role to</a>.</li>
</ul>
</li>
</ul>
<h4><strong>All CSP users</strong></h4>
<ul>
<li><a id="post-109032-_dr5nqip43w4r"></a><strong>Enable MFA</strong>: Multi-factor authentication (MFA) provides another layer of security in case the primary password is compromised. MFA can be enabled for both users and IAM roles.</li>
<li><strong>Automate Credential Rotation</strong>: Implement an automated process to rotate credentials used in the cloud environment. Rotating credentials periodically can mitigate the risk of credential leak.</li>
<li><a id="post-109032-_dr5nqip43w4r"></a><strong>Harden the IAM:PassRole Permission: </strong>When granting the <span style="font-family: 'courier new', courier, monospace;">IAM:PassRole</span> permission in a policy, always enforce restrictions on:
<ul>
<li><a id="post-109032-_dnxg8pot1det"></a><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_passrole.html">The role names that the principal can pass</a>.</li>
<li><a id="post-109032-_612qju9iyeka"></a><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_examples_iam-passrole-service.html">The services that the principal can pass a role to</a>.</li>
</ul>
</li>
<li><a id="post-109032-_dr5nqip43w4r"></a><strong>Create groups or roles with granular permissions: </strong>Users in the same project tend to have similar permission requirements and can be placed in the same group or role to simplify the permission management. However, if there are smaller teams working on different parts of the project, roles or groups with smaller permission boundaries should be created for each team.</li>
<li><a id="post-109032-_d5ut2a5551qi"></a><strong>Monitor IAM APIs</strong>: All major cloud service providers have services to monitor IAM usage. These services help identify abnormal activities, such as brute-force attacks and logging from unrecognized devices or locations.</li>
<li><strong>Leverage cloud native security platforms</strong>: Managing a large number of privileged users with access to an ever-expanding set of sensitive resources can be challenging. On top of that, cloud resources themselves have permission sets that need to be managed. Cloud native security platforms (CNSPs) like Prisma Cloud help leverage the identity of cloud resources to enforce security policies and ensure secure user behavior across multiple cloud environments.</li>
</ul>
<p>Download the <a href="https://www.paloaltonetworks.com/prisma/cloud/unit42-ctr-oct-2020-IAM">Unit 42 Cloud Threat Report, 2H 2020</a> for more research and best practices to implement in your organization.</p>
<h2><a id="post-109032-_rm7ytmltr9wl"></a>Additional Resources</h2>
<ul>
<li><a href="https://unit42.paloaltonetworks.com/highlight-cloud-threat-report-IAM">Highlights from the Unit 42 Cloud Threat Report, 2H 2020</a></li>
<li><a href="https://unit42.paloaltonetworks.com/cloud-threat-report-CSP-findings-IAM">Unit 42 Cloud Threat Report: CSP Findings on Logging, Encryption and Exposed Services</a></li>
</ul>
<p>&nbsp;</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<div class="ignite20promo">
    <div class="container">
    <div class="ignite20text">
        <div>
            <div class="orange-bar-sm"></div><br/>
        <span class="promo-heading">Secure Today,<br/>for a Better<br/>Tomorrow</span>
        </div>
        <div class="promo-subtext"><span>Join us at IGNITE20</span>
            <a href="https://ignitereg.paloaltonetworks.com/flow/paloaltonetworks/ignite20/regsc/login?source=unit42" onclick="return false;">
                <svg width="17" height="12" viewBox="0 0 17 12" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1.41089 6L15.3143 6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M10.1006 1L15.3144 6L10.1006 11" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a>
        </div>
        </div>
    </div> 
</div>
<script type="text/javascript">
    $('.ignite20promo').click(function(){
        window.open("https://ignitereg.paloaltonetworks.com/flow/paloaltonetworks/ignite20/regsc/login?source=unit42", "_blank"); 
    });
</script>    
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p> 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
