
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>KeyRaider: iOS Malware Steals Over 225,000 Apple Accounts to Create Free App Utopia</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/keyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia/" />
<link rel="alternate" hreflang="ja" href="https://unit42.paloaltonetworks.jp/keyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="Palo Alto Networks Unit 42 has analyzed a new malware, KeyRaider, which they believe to be the largest known Apple account theft caused by malware."/>
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/keyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="KeyRaider: iOS Malware Steals Over 225,000 Apple Accounts to Create Free App Utopia" />
<meta property="og:description" content="Palo Alto Networks Unit 42 has analyzed a new malware, KeyRaider, which they believe to be the largest known Apple account theft caused by malware." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/keyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="Apple" />
<meta property="article:tag" content="Apple ID" />
<meta property="article:tag" content="Cydia" />
<meta property="article:tag" content="iCloud" />
<meta property="article:tag" content="iMessage" />
<meta property="article:tag" content="iOS" />
<meta property="article:tag" content="iPad" />
<meta property="article:tag" content="iPhone" />
<meta property="article:tag" content="iTunes" />
<meta property="article:tag" content="jailbroken" />
<meta property="article:tag" content="KeyRaider" />
<meta property="article:tag" content="WeiPhone" />
<meta property="article:tag" content="WeipTech" />
<meta property="article:section" content="Cybersecurity" />
<meta property="article:published_time" content="2015-08-31T01:00:24+00:00" />
<meta property="og:image" content="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider1-500x276.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Palo Alto Networks Unit 42 has analyzed a new malware, KeyRaider, which they believe to be the largest known Apple account theft caused by malware." />
<meta name="twitter:title" content="KeyRaider: iOS Malware Steals Over 225,000 Apple Accounts to Create Free App Utopia" />
<meta name="twitter:image" content="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider1-500x276.png" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; KeyRaider: iOS Malware Steals Over 225,000 Apple Accounts to Create Free App Utopia Comments Feed" href="https://unit42.paloaltonetworks.com/keyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia/feed/" />
<meta property="og:likes" content="3"/>
<meta property="og:readtime" content="14"/>
<meta property="og:views" content="77,381"/>
<meta property="og:date_created" content="August 30, 2015 at 6:00 PM"/>
<meta property="og:post_length" content="3745"/>
<meta property="og:category" content="Cybersecurity"/>
<meta property="og:category" content="Malware"/>
<meta property="og:category" content="Mobility"/>
<meta property="og:category" content="Threat Prevention"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/cybersecurity-2/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/malware-2/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/mobility/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/threat-prevention-2/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit42/"/>
<meta property="og:author" content="Claud Xiao"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/claud-xiao/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"KeyRaider: iOS Malware Steals Over 225,000 Apple Accounts to Create Free App Utopia","name":"KeyRaider: iOS Malware Steals Over 225,000 Apple Accounts to Create Free App Utopia","description":"This post is also available in: \u65e5\u672c\u8a9e (Japanese)Executive Summary Recently, WeipTech was analyzing suspicious Apple iOS tweaks reported by users and found over 225,000 valid Apple accounts with passwords stored on a server. In cooperation with WeipTech, we have identified 92 samples of a new iOS malware family in the wild. We have analyzed the...","url":"https:\/\/unit42.paloaltonetworks.com\/keyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/keyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia\/","datePublished":"August 30, 2015","articleBody":"Executive Summary\nRecently, WeipTech was analyzing suspicious Apple iOS tweaks reported by users and found over 225,000 valid Apple accounts with passwords stored on a server.\n\nIn cooperation with WeipTech, we have identified 92 samples of a new iOS malware family in the wild. We have analyzed the samples to determine the author\u2019s ultimate goal and have named this malware \u201cKeyRaider\u201d. We believe this to be the largest known Apple account theft caused by malware.\n\nKeyRaider targets jailbroken iOS devices and is distributed through third-party Cydia repositories in China. In total, it appears this threat may have impacted users from 18 countries including China, France, Russia, Japan, United Kingdom, United States, Canada, Germany, Australia, Israel, Italy, Spain, Singapore, and South Korea.\n\nThe malware hooks system processes through MobileSubstrate, and steals Apple account usernames, passwords and device GUID by intercepting iTunes traffic on the device.\u00a0 KeyRaider steals Apple push notification service certificates and private keys, steals and shares App Store purchasing information, and disables local and remote unlocking functionalities on iPhones and iPads.\n\nKeyRaider has successfully stolen over 225,000 valid Apple accounts and thousands of certificates, private keys, and purchasing receipts. The malware uploads stolen data to its command and control (C2) server, which itself contains vulnerabilities that expose user information.\n\nThe purpose of this attack was to make it possible for users of two iOS jailbreak tweaks to download applications from the official App Store and make in-app purchases without actually paying. Jailbreak tweaks are software packages that allow users to perform actions that aren\u2019t typically possible on iOS.\n\nThese two tweaks will hijack app purchase requests, download stolen accounts or purchase receipts from the C2 server, then emulate the iTunes protocol to log in to Apple\u2019s server and purchase apps or other items requested by users. The tweaks have been downloaded over 20,000 times, which suggests around 20,000 users are abusing the 225,000 stolen credentials.\n\nSome victims have reported that their stolen Apple accounts show abnormal app purchasing history and others state that their phones have been held for ransom.\n\nPalo Alto Networks and WeipTech have provided services to detect the KeyRaider malware and identify stolen credentials. In the remainder of this blog, we provide details about the malware and the attacks.\nFinding KeyRaider\nThe attack was first discovered by i_82, a student from Yangzhou University and member of WeipTech. WeipTech (Weiphone Tech Team) is an amateur technical group consisting of users from Weiphone \u2013 one of the largest Apple fans websites in China. Previously, WeipTech cooperated with us to report on other iOS and OS X malware including AppBuyer and WireLurker.\n\nBeginning in July 2015, WeipTech members began investigating reports that some users\u2019 Apple accounts were used to make unauthorized purchases and to install iOS apps. By looking at jailbreak tweaks these users had installed, they found one tweak that collected user information and uploaded it to an unexpected website. They then found this website has a trivial SQL injection vulnerability that allows access to all of the records in the \u201ctop100\u201d database (Figure 1).\n\n\nFigure 1.\u00a0WeipTech found SQL injection vulnerability in the C2 server (from WeipTech)\nIn this database, WeipTech found a table named \u201caid\u201d that contains 225,941 total entries. Approximately 20 thousands entries include usernames, passwords and GUIDs in plaintext, while the rest of the entries are encrypted.\n\nBy reverse-engineering the jailbreak tweak, WeipTech found a piece of code that uses AES encryption with fixed key of \u201cmischa07\u201d. The encrypted usernames and passwords can be successfully decrypted using this static key. They then confirmed that the listed usernames were all Apple accounts and validated some of the credentials. The WeipTech researchers dumped around half of all entries in the database before a website administrator discovered them and shut down the service.\n\nOn August 25, WeipTech posted about the leak on their Weibo account, submitted a vulnerability report to Wooyun (a leading vulnerability crowdsourcing website in China) and forwarded the information to CNCERT\/CC.\n\nWhen Palo Alto Networks researchers analyzed the tweak WeipTech mentioned in their report, we found that it did not contain malicious code to steal passwords and upload them to the C2 server. However, through other information WeipTech provided to us, we determined that there was other malware in the wild that was collecting the stolen credentials and uploading them to the same server.\n\nWe named this new iOS malware family \u201cKeyRaider\u201d because it raids victims\u2019 passwords, private keys and certificates. (Just like \u201cLurker\u201d and \u201cReaper\u201d, Raider is also a unit in Blizzard\u2019s real-time strategy games.)\nKeyRaider Distribution\nKeyRaider, as far as we know, only spreads through Weiphone\u2019s Cydia repositories for jailbroken iOS devices. Unlike other Cydia sources such as BigBoss or ModMyi, Weiphone provides private repository functionality for each registered user so that they can directly upload their own apps and tweaks and share them with each other.\n\nOne Weiphone user, named \u201cmischa07\u201d, uploaded at least 15 KeyRaider samples to his personal repository so far in 2015 (Figure 2). Since his user name was also hard-coded into the malware as the encryption and decryption key (Figure 3), we strongly suspect mischa07 is KeyRaider\u2019s original author.\n\n\nFigure 2.\u00a0mischa07's personal Cydia repository\n\nFigure 3.\u00a0\"mischa07\" was hardcoded in the malware as encryption key\nAccording to Weiphone\u2019s web page, some of the tweaks mischa07 uploaded have been downloaded tens of thousands of times (Figure 4). These apps and tweaks provide functionalities such as game cheating, system tuning and app advertisement stripping.\n\nNote that there are two especially interesting tweaks in mischa07\u2019s repository:\n\n\tiappstore (Figure 5): Provides service to download non-free apps from Apple\u2019s official App Store without purchase.\n\tiappinbuy: Provides service to get some official App Store apps\u2019 In-App-Purchasing items totally free.\n\nMischa07 even posted in Weiphone forum to promote these two tweaks but some users didn\u2019t believe their supposedly magic functionalities. However, from Weiphone\u2019s website, the iappinbuy still received 20,199 downloads (Figure 4), while iappstore got 62 (only counting the newest version).\n\n\nFigure 4.\u00a0One malicious sample was downloaded over 30,000 times\n\nFigure 5.\u00a0The iappstore tweak can directly install non-free apps from App Store\n\nFigure 6.\u00a0Author promotes his iappstore tweak\nAnother Weiphone user that distributed the KeyRaider malware is \u201c\u6c35\u5200\u516b\u6728\u201d or \u201cbamu\u201d. Bamu's personal repository is pretty popular in the community since he frequently provides useful tools. After the attack was exposed, bamu deleted almost all of malware he uploaded from the repository and denied it on the forum. However, with help from Weiphone, we checked all apps or tweaks he has ever uploaded and found at least 77 of them will install the KeyRaider malware on victims\u2019 iOS devices. While mischa07 appears to have created the malware and developed different versions of it, bamu\u2019s malicious apps are mostly created by repackaging existing apps or tweaks such as iFile, iCleanPro and avfun with the malware.\n\nWhen KeyRaider uploads hijacked user password to its C2 server, it includes a parameter named \u201cflag\u201d or \u201cfrom\u201d in the HTTP URL to track the source of the infection. In mischa07\u2019s code, the value of these parameters is always the app\u2019s name such as \u201cletv.\u201d \u00a0While in bamu\u2019s samples, the value will always be \u201cbamu\u201d. From leaked data, we found that over 67% of stolen accounts came from bamu.\n\nSince bamu is only a distributor, our latter behavior analysis will mainly focus on samples directly distributed by mischa07.\nStolen User Data\nKeyRaider collects three kinds of user data and uploads to its C2 server by HTTP; we identified two different C2 servers.\n\n\ttop100.gotoip4[.]com\n\twww.wushidou[.]cn\n\nDuring the course of our analysis, these domain names resolved to the IP address 113.10.174.167. In the \u201ctop100\u201d database in this server there are three tables: \u201caid\u201d, \u201ccert\u201d and \u201cother\u201d. KeyRaider use four PHP scripts on the server to access the database: aid.php, cert.php, other.php and data.php.\n\nBy analyzing the code and data dumped by WeipTech, we found that the \u201caid\u201d table stored 225,941 stolen Apple ID\u2019s user name, password and device GUID combinations. The \u201ccert\u201d table stored \u00a05,841 entries of infected devices\u2019 certificate and private key that are used by Apple\u2019s push notification service (Figure 7). Finally, the \u201cother\u201d table stored over 3,000 entries of device\u2019s GUID and app purchasing receipts from App Store server.\n\n\nFigure 7.\u00a0One entry in the leaked cert table\nWe sorted the email addresses from the stolen Apple IDs and found more than half of them used email service provided by Tencent. Below are top 10 most popular stolen account Email address domains. (Six of them are primarily in use by Chinese users):\n\n\t@qq.com\n\t@163.com\n\t@icloud.com\n\t@gmail.com\n\t@126.com\n\t@hotmail.com\n\t@sina.com\n\t@vip.qq.com\n\t@me.com\n\t@139.com\n\nHowever, we also found some email addresses belong to other countries\u2019 or regions\u2019 domain names, including:\n\n\ttw: Taiwan\n\tfr: France\n\tru: Russia\n\tjp: Japan\n\tuk: United Kingdom\n\tca: Canada\n\tde: Germany\n\tau: Australia\n\tus: United States\n\tcz: Czech Republic\n\til: Israel\n\tit: Italy\n\tnl: Netherlands\n\tes: Spain\n\tvn: Vietnam\n\tpl: Poland\n\tsg: Singapore\n\tkr: South Korea\n\nMalicious Behaviors\nThe KeyRaider malicious code exists in Mach-O dynamic libraries that are used as plugins for the MobileSubstrate framework. Through MobileSubstrate APIs, the malware can hook arbitrary APIs in system processes or in other iOS apps.\n\nMany previous iOS malware families also abused the MobileSubstrate. For example, the Unflod (aka SSLCreds or Unflod Baby Panda) that was found by Reddit users and was analyzed by SektionEins used it to intercept SSL encrypted traffic and steal Apple account passwords. The AppBuyer malware discovered last year used the same technique to steal passwords and to purchase apps from App Store. KeyRaider takes this technique another step further. It implemented the following malicious behaviors:\n\n\tStealing Apple account (user name and password) and device GUID\n\tStealing certificates and private keys used by Apple Push Notification Service\n\tPreventing the infected device being unlocked by passcode or by iCloud service\n\nStealing Apple Account Data\nMost KeyRaider samples hook SSLRead and SSLWrite functions in the itunesstored process (Figure 8). itunesstored is the system daemon that is responsible for communicating with the App Store using the iTunes protocol.\n\n\nFigure 8.\u00a0KeyRaider hooks SSLRead and SSLWrite in itunesstored\nWhen the App Store client asks the user to input their Apple account for login, the information is sent to the App Store server via an SSL encrypted session. In the replacement function of SSLWrite, KeyRaider looks for this kind of login session, and searches for specific patterns to find the Apple account\u2019s username, password and device\u2019s GUID in the data being transferred (Figure 9). Next, in the replacement function for SSLRead, these credentials are encrypted using the AES algorithm with the static key \u201cmischa07\u201d, and then sent to the KeyRaider C2 server (Figure 10).\n\n\nFigure 9.\u00a0Searching for Apple account information in SSL data\n\nFigure 10.\u00a0Uploading stolen credentials to the C2 server\nIn addition to hooking SSLRead and SSLWrite, KeyRaider also invokes MGCopyAnswer(\u201cUniqueDeviceID\u201d) to read the device GUID.\nStealing Certificates and Private Keys\nIn some samples, KeyRaider also hooks the apsd process -- the daemon process responsible for Apple Push Notification Service on iOS systems. It hooks the SecItemCopyMatching function defined in the Security framework. This API is used to search keychain items that match given search query.\n\nAfter installing the hook, when the search query has a label value of \u201cAPSClientIdentity\u201d, KeyRaider will execute the original SecItemCopyMatching, then invoke SecIdentityCopyCertificate and SecIdentityCopyPrivateKey to copy the certificate and private key from the original function\u2019s return result (Figure 11). Together with GUID, these credentials are then sent to the C2 server (Figure 12). In the iOS keychain, the key that labeled with APSClientIdentity is used for the push notification. Through these credentials, an attacker can create a fake push notification to the system.\n\n\nFigure 11.\u00a0Copy push service's certificate and private key\n\nFigure 12.\u00a0Upload certificate and key\n\nLock Device\nWhen KeyRaider hooks the SecItemCopyMatching, except for intercept notification credentials, it will also compare current query\u2019s label with a very special string \u201ccom.apple.lockdown.identity.activation\u201d. If the label is this string, KeyRaider will set this query\u2019s result to zero. (Figure 13)\n\n\nFigure 13.\u00a0Set lockdown activation result always to zero\nAt the time of this publication, there isn\u2019t any public documentation of the com.apple.lockdown.identity.activation query on the Internet. We believe that this query is used to unlock devices. By setting this query\u2019s result to zero, KeyRaider may prevent users from unlocking their own devices either by locally inputting correct unlock passcode or by remotely unlocking the devices via iCloud.\n\nNote that in all samples we\u2019ve found thus far, this piece of code is standalone and not invoked by any other code; it has only been implemented there and exported as a function. However, we have evidence that real attacks using this functionality have occurred.\nFree Apps For Everyone!\nSome samples of KeyRaider implemented code to download purchase receipts and Apple accounts from the C2 server. However, only in the iappstore and iappinbuy jailbreak tweaks were these actually used.\n\nAccording to an author\u2019s description, iappstore can be used to download any app from App Store totally free. Let\u2019s take a look at how they make that possible.\n\nThe app hooks the SSLWrite API twice. The first hook is used for password stealing just like others. The second hook tries to determine whether current HTTP request is equal to \"POST \/WebObjects\/MZBuy.woa\/wa\/buyProduct\". This is used to determine if the session is making a purchase using the iTunes protocol (Figure 14).\n\n\nFigure 14.\u00a0Hooking app purchase session\nIf the request is making the purchase, the next time SSLWrite is invoked, the hooking code will try to match keywords such as \u201csalableAdamId\u201d, \u201cappExtVrsId\u201d, \u201cvid\u201d, \u201cprice\u201d, \u201cguid\u201d, \u201cinstalledSoftwareRating\u201d and \u201cpricingParameters\u201d in the data being sent to get payment information about current app. \u00a0If the app is not free, a function named fire() is then invoked.\n\nThe fire function then invokes the readAid() function. readAid() reads a local file located at \/var\/mobile\/Documents\/iappstore_aid.log. This file contains an Apple account\u2019s username, password, device GUID, related iTunes session\u2019s token, cookie, phone number and carrier, operating system information and iTunes CDN server number. The function then parses this data and creates an Account object.\n\nIf the file doesn\u2019t exist, it will invoke readAidUrl() function which will download new account information from KeyRaider\u2019s C2 server and create an Account object (Figure 15). Figure 16 shows an account downloaded from the server.\n\n\nFigure 15.\u00a0Downloads Apple account from C2 server\n\nFigure 16.\u00a0Stolen Apple account was downloaded from C2 server\nAfter creating the Account object, fire() will generate a plist format string that contains the account information, and invoke login(), then invoke sendBuy().\n\nThe login() function will construct an HTTP connection to the follwing URL with the plist string and a AppStore client like user agent value.\n\n\tp*-buy.itunes.apple.com\/WebObjects\/MZFinance.woa\/wa\/authenticate\n\nThis causes the current iTunes session to be logged in with the remote Apple account. (Figure 17)\n\n\nFigure 17.\u00a0Emulating login protocol\nAfter the login request, login() will parse the returned result for the cookie, token and other information and will save this data together with an account password to the local iappstore_aid.log file, to be used for the next purchase. If the login failed due to a password error, it will invoke readAidUrl() again to get a different Apple account from the C2 server.\n\nThe sendBuy() function works similarly to the login() function but requests another URL for app purchasing verification:\n\n\tp*-buy.itunes.apple.com\/WebObjects\/MZBuy.woa\/wa\/buyProduct\n\nThrough this procedure, the iappstore tweak can successfully purchase any app using another person\u2019s stolen Apple account.\n\nNote that, besides of these operations, in two standalone functions verifySF() and verifySF2() implementation in this sample, KeyRaider also tries to get or use information about Apple account\u2019s password recovery questions and answers. This functionality hasn\u2019t been finished in the samples we analyzed.\n\nThe functionality of iappinpay is similar to iappstore. The only difference is that the purchase interface has changed as well as some of the parameters used (Figure 18). Since the C2 server database also stored some previous In-App-Purchase receipts, it seems that author also planned to implement functionality to reuse these receipts, possibly to send them to Apple to prove that that they have previously purchased an item.\n\n\nFigure 18.\u00a0In-App-Purchase verification request\n\nPhones Held for Ransom\nIn addition to stealing Apple accounts to buy apps, KeyRaider also has built-in functionality to hold iOS devices for ransom.\n\nSome previous iPhone ransomware attacks are based on remotely controlling the iOS device through the iCloud service. \u00a0Some of these attacks can be avoided by resetting the account password to regain control of iCloud. KeyRaider is different. It can locally disable any kind of unlocking operations, whether the correct passcode or password has been entered. Also, it can send a notification message demanding a ransom directly using the stolen certificate and private key, without going through Apple\u2019s push server. Because of this functionality, some of previously used \u201crescue\u201d methods are no longer effective.\n\nWe know that KeyRaider has been used to hold a phone for ransom, as one victim reported that his phone was locked while prompted message in screen is \u201cPlease contact by QQ or phone to unlock it.\u201d (Figure 19)\n\n\nFigure 19.\u00a0Ransom message on locked iPhone\n\nOther Potential Risks\nAt Palo Alto Networks Ignite 2015 conference back in April we introduced the underground economy and supply chain involved with iOS hacking. KeyRaider plays a very important role in this chain.\n\nWith a victim\u2019s Apple account and password, attackers can launch all kinds of additional attacks. For example, they can control the device through iCloud and compromise the victim\u2019s private data contained in their iMessage logs, contacts, photos, emails, documents and location. In 2014, for example, many celebrities\u2019 iCloud accounts were hacked and photos leaked, which raised awareness of the threat from stolen Apple account credentials.\n\nAdditionally, there are many other ways to profit from these stolen accounts.\n\nApp Promotion\n\nSome developers will pay money for their apps to occupy a better position in App Store rankings, and installation count is one of the most important factors in creating these rankings. Using the stolen data, attackers can easily install \u201cpromoted\u201d iOS apps from App Store to increase their installation count. In fact, many of KeyRaider\u2019s victims reported that their Apple accounts had an abnormal app downloading history, which led to the discovery of this attack.\n\nCash Back\n\nAttackers can purchase non-free iOS apps from App Store using stolen accounts. The fee will be paid by victims, but money will go to Apple and then partly to developers. Then developers share this income with attackers, as was the case with the AppBuyer malware.\n\nSpam\n\nValid Apple account usernames can also be sold standalone for use by spammers. Previous SMS based spam may cost money to send and is easily to be blocked by carriers. However, iMessage-based spam only needs Internet access and the recipient\u2019s Apple ID. This kind of spam has become very popular in the last two years.\n\nRansom\n\nHolding the victims\u2019 Apple accounts, their devices or the information contained in their iCloud storage for ransom can also generate revenue for the attacker.\n\nDevice Unlocking\n\nThese stolen accounts can also be sold in another market. Apple adopted a security mechanism to prevent lost or stolen devices being wiped and re-sold that requires you to verify the Apple ID before wiping. Hence there is now a market for individuals looking for certain devices\u2019 Apple account information.\n\nOther Future Attacks\n\nCombined with personal data in iCloud, stolen accounts can also be used in social engineering, fraud and targeted attacks.\nProtection and Prevention\nIt\u2019s important to remember that KeyRaider only impacts jailbroken iOS devices. Users of non-jailbroken iPhones or iPads will not be affected by this attack.\n\nWeipTech has provided a query service in their website http:\/\/www.weiptech.org\/ for potential victims to query whether their Apple accounts was stolen. Palo Alto Networks provided the stolen account information to Apple in August 26.. Worth noting is that WeipTech was only able to recover around half of stolen accounts before the attacker fixed the vulnerability. Users who have ever installed apps or tweaks from untrusted Cydia sources could also be affected.\n\nPalo Alto Networks has released DNS signatures to cover KeyRaider\u2019s C2 traffic to prevent the malware from relaying credentials in protected networks.\n\nUsers can use the following method to determine by themselves whether their iOS devices was infected:\n\n\tInstall openssh server through Cydia\n\tConnect to the device through SSH\n\tGo to \/Library\/MobileSubstrate\/DynamicLibraries\/, and grep for these strings to all files under this directory:\n\n\n\twushidou\n\tgotoip4\n\tbamu\n\tgetHanzi\n\nIf any dylib file contains any one of these strings, we urge users to delete it and delete the plist file with the same filename, then reboot the device.\n\nWe also suggest all affected users change their Apple account password after removing the malware, and enable two-factor verifications for Apple IDs.\n\nOur primary suggestion for those who want to prevent KeyRaider and similar malware is to never jailbreak your iPhone or iPad if you can avoid it. At this point in time, there aren\u2019t any Cydia repositories that perform strict security checks on apps or tweaks uploaded to them. Use all Cydia repositories at your own risk.\nSamples Information\nSHA-1 values of some KeyRaider samples are listed here:\n9ae5549fdd90142985c3ae7a7e983d4fcb2b797f\u00a0 CertPlugin.dylib\nbb56acf8b48900f62eb4e4380dcf7f5acfbdf80d\u00a0 MPPlugin.dylib\n5c7c83ab04858890d74d96cd1f353e24dec3ba66\u00a0 iappinbuy.dylib\n717373f57ff4398316cce593af11bd45c55c9b91\u00a0 iappstore.dylib\n8886d72b087017b0cdca2f18b0005b6cb302e83d\u00a0 9catbbs.GamePlugin_6.1-9.deb\n4a154eabd5a5bd6ad0203eea6ed68b31e25811d7\u00a0 9catbbs.MPPlugin_1.3.deb\ne0576cd9831f1c6495408471fcacb1b54597ac24\u00a0 9catbbs.iappinbuy_1.0.deb\naf5d7ffe0d1561f77e979c189f22e11a33c7a407\u00a0 9catbbs.iappstore_4.0.deb\na05b9af5f4c40129575cce321cd4b0435f89fba8\u00a0 9catbbs.ibackground_3.2.deb\n1cba9fe852b05c4843922c123c06117191958e1d\u00a0 repo.sunbelife.batterylife_1.4.1.deb\n\nAcknowledgements\nSpecial thanks to i_82 from Yangzhou University and WeipTech for sharing data, report and all kinds of useful information with us.\n\nThanks CDSQ from WeipTech and thanks Weiphone for providing potential samples to us. Thanks Xsser and Fenggou from Wooyun in information sharing.\n\nThanks Sereyvathana Ty, Zhaoyan Xu and Rongbo Shao from Palo Alto Networks for their effort on detecting the threat. Thanks Ryan Olson from Palo Alto Networks for reviewing and revising this report.\n","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"","width":"","height":""},"author":[{"@type":"Person","name":"Claud Xiao"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"10111","token":"7e15a0f8b3","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=10111' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fkeyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fkeyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-10111 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">KeyRaider: iOS Malware Steals Over 225,000 Apple Accounts to Create Free App Utopia</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-10111 entry-meta">
			
			
			<span class="post-views-count">77,381</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'10111','like')"><i class="ui ui-2"></i><span class="ml-5">3</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 14</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fkeyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Fkeyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia%2F+-+KeyRaider%3A+iOS+Malware+Steals+Over+225%2C000+Apple+Accounts+to+Create+Free+App+Utopia" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fkeyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia%2F&title=KeyRaider%3A+iOS+Malware+Steals+Over+225%2C000+Apple+Accounts+to+Create+Free+App+Utopia&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/keyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/claud-xiao/" title="Posts by Claud Xiao" class="author url fn" rel="author">Claud Xiao</a>        </p>
        <p><time datetime="2015-08-31T01:00:24+00:00">August 30, 2015 at 6:00 PM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/cybersecurity-2/" rel="category tag">Cybersecurity</a>, <a href="https://unit42.paloaltonetworks.com/category/malware-2/" rel="category tag">Malware</a>, <a href="https://unit42.paloaltonetworks.com/category/mobility/" rel="category tag">Mobility</a>, <a href="https://unit42.paloaltonetworks.com/category/threat-prevention-2/" rel="category tag">Threat Prevention</a>, <a href="https://unit42.paloaltonetworks.com/category/unit42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/apple/" rel="tag">Apple</a>, <a href="https://unit42.paloaltonetworks.com/tag/apple-id/" rel="tag">Apple ID</a>, <a href="https://unit42.paloaltonetworks.com/tag/cydia/" rel="tag">Cydia</a>, <a href="https://unit42.paloaltonetworks.com/tag/icloud/" rel="tag">iCloud</a>, <a href="https://unit42.paloaltonetworks.com/tag/imessage/" rel="tag">iMessage</a>, <a href="https://unit42.paloaltonetworks.com/tag/ios/" rel="tag">iOS</a>, <a href="https://unit42.paloaltonetworks.com/tag/ipad/" rel="tag">iPad</a>, <a href="https://unit42.paloaltonetworks.com/tag/iphone/" rel="tag">iPhone</a>, <a href="https://unit42.paloaltonetworks.com/tag/itunes/" rel="tag">iTunes</a>, <a href="https://unit42.paloaltonetworks.com/tag/jailbroken/" rel="tag">jailbroken</a>, <a href="https://unit42.paloaltonetworks.com/tag/keyraider/" rel="tag">KeyRaider</a>, <a href="https://unit42.paloaltonetworks.com/tag/weiphone/" rel="tag">WeiPhone</a>, <a href="https://unit42.paloaltonetworks.com/tag/weiptech/" rel="tag">WeipTech</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                    <p class="wpml-ls-statics-post_translations wpml-ls">This post is also available in: 
    <span class="wpml-ls-slot-post_translations wpml-ls-item wpml-ls-item-ja wpml-ls-first-item wpml-ls-last-item wpml-ls-item-legacy-post-translations"><a href="https://unit42.paloaltonetworks.jp/keyraider-ios-malware-steals-over-225000-apple-accounts-to-create-free-app-utopia/" class="wpml-ls-link"><span class="wpml-ls-native" lang="ja"></span><span class="wpml-ls-display"><span class="wpml-ls-bracket"> (</span>Japanese<span class="wpml-ls-bracket">)</span></span></a></span></p><h3>Executive Summary</h3>
<p>Recently, WeipTech was analyzing suspicious Apple iOS tweaks reported by users and found over 225,000 valid Apple accounts with passwords stored on a server.</p>
<p>In cooperation with WeipTech, we have identified 92 samples of a new iOS malware family in the wild. We have analyzed the samples to determine the authors ultimate goal and have named this malware KeyRaider. We believe this to be the largest known Apple account theft caused by malware.<span id="more-10111"></span></p>
<p>KeyRaider targets jailbroken iOS devices and is distributed through third-party Cydia repositories in China. In total, it appears this threat may have impacted users from 18 countries including China, France, Russia, Japan, United Kingdom, United States, Canada, Germany, Australia, Israel, Italy, Spain, Singapore, and South Korea.</p>
<p>The malware hooks system processes through MobileSubstrate, and steals Apple account usernames, passwords and device GUID by intercepting iTunes traffic on the device. KeyRaider steals Apple push notification service certificates and private keys, steals and shares App Store purchasing information, and disables local and remote unlocking functionalities on iPhones and iPads.</p>
<p>KeyRaider has successfully stolen over 225,000 valid Apple accounts and thousands of certificates, private keys, and purchasing receipts. The malware uploads stolen data to its command and control (C2) server, which itself contains vulnerabilities that expose user information.</p>
<p>The purpose of this attack was to make it possible for users of two iOS jailbreak tweaks to download applications from the official App Store and make in-app purchases without actually paying. Jailbreak tweaks are software packages that allow users to perform actions that arent typically possible on iOS.</p>
<p>These two tweaks will hijack app purchase requests, download stolen accounts or purchase receipts from the C2 server, then emulate the iTunes protocol to log in to Apples server and purchase apps or other items requested by users. The tweaks have been downloaded over 20,000 times, which suggests around 20,000 users are abusing the 225,000 stolen credentials.</p>
<p>Some victims have reported that their stolen Apple accounts show abnormal app purchasing history and others state that their phones have been held for ransom.</p>
<p>Palo Alto Networks and WeipTech have provided services to detect the KeyRaider malware and identify stolen credentials. In the remainder of this blog, we provide details about the malware and the attacks.</p>
<h3>Finding KeyRaider</h3>
<p>The attack was first discovered by i_82, a student from Yangzhou University and member of WeipTech. <a href="http://weibo.com/weiptech" target="_blank">WeipTech</a> (Weiphone Tech Team) is an amateur technical group consisting of users from <a href="http://www.feng.com/" target="_blank">Weiphone</a>  one of the largest Apple fans websites in China. Previously, WeipTech cooperated with us to report on other iOS and OS X malware including <a href="http://researchcenter.paloaltonetworks.com/2014/09/appbuyer-new-ios-malware-steals-apple-id-password-buy-apps/" target="_blank">AppBuyer</a> and <a href="http://researchcenter.paloaltonetworks.com/2014/11/wirelurker-new-era-os-x-ios-malware/" target="_blank">WireLurker</a>.</p>
<p>Beginning in July 2015, WeipTech members began investigating reports that some users Apple accounts were used to make unauthorized purchases and to install iOS apps. By looking at jailbreak tweaks these users had installed, they found one tweak that collected user information and uploaded it to an unexpected website. They then found this website has a trivial SQL injection vulnerability that allows access to all of the records in the top100 database (Figure 1).</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider1.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10112" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider1-500x276.png" alt="keyraider1" width="500" height="276" /></a></p>
<p style="text-align: center;">Figure 1.WeipTech found SQL injection vulnerability in the C2 server (from WeipTech)</p>
<p>In this database, WeipTech found a table named aid that contains 225,941 total entries. Approximately 20 thousands entries include usernames, passwords and GUIDs in plaintext, while the rest of the entries are encrypted.</p>
<p>By reverse-engineering the jailbreak tweak, WeipTech found a piece of code that uses AES encryption with fixed key of mischa07. The encrypted usernames and passwords can be successfully decrypted using this static key. They then confirmed that the listed usernames were all Apple accounts and validated some of the credentials. The WeipTech researchers dumped around half of all entries in the database before a website administrator discovered them and shut down the service.</p>
<p>On August 25, WeipTech posted about the leak <a href="http://weibo.com/2258131180/CxmTWBLcM" target="_blank">on their Weibo</a> account, submitted a <a href="http://www.wooyun.org/bugs/wooyun-2015-0136806" target="_blank">vulnerability report to Wooyun</a> (a leading vulnerability crowdsourcing website in China) and forwarded the information to CNCERT/CC.</p>
<p>When Palo Alto Networks researchers analyzed the tweak WeipTech mentioned in their report, we found that it did not contain malicious code to steal passwords and upload them to the C2 server. However, through other information WeipTech provided to us, we determined that there was other malware in the wild that was collecting the stolen credentials and uploading them to the same server.</p>
<p>We named this new iOS malware family KeyRaider because it raids victims passwords, private keys and certificates. (Just like <a href="http://researchcenter.paloaltonetworks.com/2014/11/wirelurker-new-era-os-x-ios-malware/" target="_blank">Lurker</a> and <a href="http://researchcenter.paloaltonetworks.com/2014/12/coolreaper-revealed-backdoor-coolpad-android-devices/" target="_blank">Reaper</a>, Raider is also a unit in Blizzards real-time strategy games.)</p>
<h3>KeyRaider Distribution</h3>
<p>KeyRaider, as far as we know, only spreads through <a href="http://apt.so/" target="_blank">Weiphones Cydia repositories</a> for jailbroken iOS devices. Unlike other Cydia sources such as BigBoss or ModMyi, Weiphone provides private repository functionality for each registered user so that they can directly upload their own apps and tweaks and share them with each other.</p>
<p>One Weiphone user, named mischa07, uploaded at least 15 KeyRaider samples to <a href="http://apt.so/index.php?r=cydiaTa/index&amp;user_id=8676626" target="_blank">his personal repository</a> so far in 2015 (Figure 2). Since his user name was also hard-coded into the malware as the encryption and decryption key (Figure 3), we strongly suspect mischa07 is KeyRaiders original author.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider2.png" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-10113" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider2.png" alt="keyraider2" width="409" height="799" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider2.png 409w, https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider2-154x300.png 154w, https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider2-370x723.png 370w" sizes="(max-width: 409px) 100vw, 409px" /></a></p>
<p style="text-align: center;">Figure 2.mischa07&#8217;s personal Cydia repository</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider3.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10114" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider3-500x197.png" alt="keyraider3" width="500" height="197" /></a></p>
<p style="text-align: center;">Figure 3.&#8220;mischa07&#8221; was hardcoded in the malware as encryption key</p>
<p>According to Weiphones web page, some of the tweaks mischa07 uploaded have been downloaded tens of thousands of times (Figure 4). These apps and tweaks provide functionalities such as game cheating, system tuning and app advertisement stripping.</p>
<p>Note that there are two especially interesting tweaks in mischa07s repository:</p>
<ul>
<li><strong>iappstore </strong>(Figure 5): Provides service to download non-free apps from Apples official App Store without purchase.</li>
<li><strong>iappinbuy</strong>: Provides service to get some official App Store apps In-App-Purchasing items totally free.</li>
</ul>
<p>Mischa07 even <a href="http://bbs.feng.com/forum.php?mod=viewthread&amp;tid=8926983" target="_blank">posted in Weiphone forum</a> to promote these two tweaks but some users didnt believe their supposedly magic functionalities. However, from Weiphones website, the iappinbuy still received 20,199 downloads (Figure 4), while iappstore got 62 (only counting the newest version).</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider4.png" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-10115" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider4.png" alt="keyraider4" width="410" height="340" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider4.png 410w, https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider4-300x249.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider4-370x307.png 370w" sizes="(max-width: 410px) 100vw, 410px" /></a></p>
<p style="text-align: center;">Figure 4.One malicious sample was downloaded over 30,000 times</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider5.png" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-10116" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider5.png" alt="keyraider5" width="412" height="870" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider5.png 412w, https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider5-142x300.png 142w, https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider5-370x781.png 370w" sizes="(max-width: 412px) 100vw, 412px" /></a></p>
<p style="text-align: center;">Figure 5.The iappstore tweak can directly install non-free apps from App Store</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider6.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10117" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider6-500x279.png" alt="keyraider6" width="500" height="279" /></a></p>
<p style="text-align: center;">Figure 6.Author promotes his iappstore tweak</p>
<p>Another Weiphone user that distributed the KeyRaider malware is  or bamu. <a href="http://apt.so/aptso">Bamu&#8217;s personal repository</a> is pretty popular in the community since he frequently provides useful tools. After the attack was exposed, bamu deleted almost all of malware he uploaded from the repository and denied it on the forum. However, with help from Weiphone, we checked all apps or tweaks he has ever uploaded and found at least 77 of them will install the KeyRaider malware on victims iOS devices. While mischa07 appears to have created the malware and developed different versions of it, bamus malicious apps are mostly created by repackaging existing apps or tweaks such as iFile, iCleanPro and avfun with the malware.</p>
<p>When KeyRaider uploads hijacked user password to its C2 server, it includes a parameter named flag or from in the HTTP URL to track the source of the infection. In mischa07s code, the value of these parameters is always the apps name such as letv. While in bamus samples, the value will always be bamu. From leaked data, we found that over 67% of stolen accounts came from bamu.</p>
<p>Since bamu is only a distributor, our latter behavior analysis will mainly focus on samples directly distributed by mischa07.</p>
<h3>Stolen User Data</h3>
<p>KeyRaider collects three kinds of user data and uploads to its C2 server by HTTP; we identified two different C2 servers.</p>
<ul>
<li>top100.gotoip4[.]com</li>
<li>www.wushidou[.]cn</li>
</ul>
<p>During the course of our analysis, these domain names resolved to the IP address 113.10.174.167. In the top100 database in this server there are three tables: aid, cert and other. KeyRaider use four PHP scripts on the server to access the database: aid.php, cert.php, other.php and data.php.</p>
<p>By analyzing the code and data dumped by WeipTech, we found that the aid table stored 225,941 stolen Apple IDs user name, password and device GUID combinations. The cert table stored 5,841 entries of infected devices certificate and private key that are used by Apples push notification service (Figure 7). Finally, the other table stored over 3,000 entries of devices GUID and app purchasing receipts from App Store server.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider7.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10118" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider7-500x319.png" alt="keyraider7" width="500" height="319" /></a></p>
<p style="text-align: center;">Figure 7.One entry in the leaked cert table</p>
<p>We sorted the email addresses from the stolen Apple IDs and found more than half of them used email service provided by Tencent. Below are top 10 most popular stolen account Email address domains. (Six of them are primarily in use by Chinese users):</p>
<ul>
<li>@qq.com</li>
<li>@163.com</li>
<li>@icloud.com</li>
<li>@gmail.com</li>
<li>@126.com</li>
<li>@hotmail.com</li>
<li>@sina.com</li>
<li>@vip.qq.com</li>
<li>@me.com</li>
<li>@139.com</li>
</ul>
<p>However, we also found some email addresses belong to other countries or regions domain names, including:</p>
<ul>
<li>tw: Taiwan</li>
<li>fr: France</li>
<li>ru: Russia</li>
<li>jp: Japan</li>
<li>uk: United Kingdom</li>
<li>ca: Canada</li>
<li>de: Germany</li>
<li>au: Australia</li>
<li>us: United States</li>
<li>cz: Czech Republic</li>
<li>il: Israel</li>
<li>it: Italy</li>
<li>nl: Netherlands</li>
<li>es: Spain</li>
<li>vn: Vietnam</li>
<li>pl: Poland</li>
<li>sg: Singapore</li>
<li>kr: South Korea</li>
</ul>
<h3>Malicious Behaviors</h3>
<p>The KeyRaider malicious code exists in Mach-O dynamic libraries that are used as plugins for the MobileSubstrate framework. Through MobileSubstrate APIs, the malware can hook arbitrary APIs in system processes or in other iOS apps.</p>
<p>Many previous iOS malware families also abused the MobileSubstrate. For example, the Unflod (aka SSLCreds or Unflod Baby Panda) that was <a href="http://www.reddit.com/r/jailbreak/comments/23b7qs/what_is_unflod_its_a_mobile_substrate_addon_that/" target="_blank">found by Reddit users</a> and was <a href="https://www.sektioneins.de/en/blog/14-04-18-iOS-malware-campaign-unflod-baby-panda.html" target="_blank">analyzed by SektionEins</a> used it to intercept SSL encrypted traffic and steal Apple account passwords. The <a href="http://researchcenter.paloaltonetworks.com/2014/09/appbuyer-new-ios-malware-steals-apple-id-password-buy-apps/" target="_blank">AppBuyer</a> malware discovered last year used the same technique to steal passwords and to purchase apps from App Store. KeyRaider takes this technique another step further. It implemented the following malicious behaviors:</p>
<ul>
<li>Stealing Apple account (user name and password) and device GUID</li>
<li>Stealing certificates and private keys used by Apple Push Notification Service</li>
<li>Preventing the infected device being unlocked by passcode or by iCloud service</li>
</ul>
<h4>Stealing Apple Account Data</h4>
<p>Most KeyRaider samples hook SSLRead and SSLWrite functions in the itunesstored process (Figure 8). itunesstored is the system daemon that is responsible for communicating with the App Store using the iTunes protocol.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider8.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10119" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider8-500x174.png" alt="keyraider8" width="500" height="174" /></a></p>
<p style="text-align: center;">Figure 8.KeyRaider hooks SSLRead and SSLWrite in itunesstored</p>
<p>When the App Store client asks the user to input their Apple account for login, the information is sent to the App Store server via an SSL encrypted session. In the replacement function of SSLWrite, KeyRaider looks for this kind of login session, and searches for specific patterns to find the Apple accounts username, password and devices GUID in the data being transferred (Figure 9). Next, in the replacement function for SSLRead, these credentials are encrypted using the AES algorithm with the static key mischa07, and then sent to the KeyRaider C2 server (Figure 10).</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider9.png" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-10120" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider9.png" alt="keyraider9" width="463" height="352" srcset="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider9.png 463w, https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider9-300x228.png 300w, https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider9-370x281.png 370w" sizes="(max-width: 463px) 100vw, 463px" /></a></p>
<p style="text-align: center;">Figure 9.Searching for Apple account information in SSL data</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider10.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10121" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider10-500x206.png" alt="keyraider10" width="500" height="206" /></a></p>
<p style="text-align: center;">Figure 10.Uploading stolen credentials to the C2 server</p>
<p>In addition to hooking SSLRead and SSLWrite, KeyRaider also invokes MGCopyAnswer(UniqueDeviceID) to read the device GUID.</p>
<h4>Stealing Certificates and Private Keys</h4>
<p>In some samples, KeyRaider also hooks the apsd process &#8212; the daemon process responsible for Apple Push Notification Service on iOS systems. It hooks the SecItemCopyMatching function defined in the Security framework. This API is used to search keychain items that match given search query.</p>
<p>After installing the hook, when the search query has a label value of APSClientIdentity, KeyRaider will execute the original SecItemCopyMatching, then invoke SecIdentityCopyCertificate and SecIdentityCopyPrivateKey to copy the certificate and private key from the original functions return result (Figure 11). Together with GUID, these credentials are then sent to the C2 server (Figure 12). In the iOS keychain, the key that labeled with APSClientIdentity is used for the push notification. Through these credentials, an attacker can create a fake push notification to the system.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider11.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10122" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider11-500x219.png" alt="keyraider11" width="500" height="219" /></a></p>
<p style="text-align: center;">Figure 11.Copy push service&#8217;s certificate and private key</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider12.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10123" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider12-500x332.png" alt="keyraider12" width="500" height="332" /></a></p>
<p style="text-align: center;">Figure 12.Upload certificate and key</p>
<h4>Lock Device</h4>
<p>When KeyRaider hooks the SecItemCopyMatching, except for intercept notification credentials, it will also compare current querys label with a very special string com.apple.lockdown.identity.activation. If the label is this string, KeyRaider will set this querys result to zero. (Figure 13)</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider13.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10124" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider13-500x70.png" alt="keyraider13" width="500" height="70" /></a></p>
<p style="text-align: center;">Figure 13.Set lockdown activation result always to zero</p>
<p>At the time of this publication, there isnt any public documentation of the com.apple.lockdown.identity.activation query on the Internet. We believe that this query is used to unlock devices. By setting this querys result to zero, KeyRaider may prevent users from unlocking their own devices either by locally inputting correct unlock passcode or by remotely unlocking the devices via iCloud.</p>
<p>Note that in all samples weve found thus far, this piece of code is standalone and not invoked by any other code; it has only been implemented there and exported as a function. However, we have evidence that real attacks using this functionality have occurred.</p>
<h3>Free Apps For Everyone!</h3>
<p>Some samples of KeyRaider implemented code to download purchase receipts and Apple accounts from the C2 server. However, only in the iappstore and iappinbuy jailbreak tweaks were these actually used.</p>
<p>According to an authors description, iappstore can be used to download any app from App Store totally free. Lets take a look at how they make that possible.</p>
<p>The app hooks the SSLWrite API twice. The first hook is used for password stealing just like others. The second hook tries to determine whether current HTTP request is equal to &#8220;POST /WebObjects/MZBuy.woa/wa/buyProduct&#8221;. This is used to determine if the session is making a purchase using the iTunes protocol (Figure 14).</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider14.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10125" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider14-500x329.png" alt="keyraider14" width="500" height="329" /></a></p>
<p style="text-align: center;">Figure 14.Hooking app purchase session</p>
<p>If the request is making the purchase, the next time SSLWrite is invoked, the hooking code will try to match keywords such as salableAdamId, appExtVrsId, vid, price, guid, installedSoftwareRating and pricingParameters in the data being sent to get payment information about current app. If the app is not free, a function named fire() is then invoked.</p>
<p>The fire function then invokes the readAid() function. readAid() reads a local file located at /var/mobile/Documents/iappstore_aid.log. This file contains an Apple accounts username, password, device GUID, related iTunes sessions token, cookie, phone number and carrier, operating system information and iTunes CDN server number. The function then parses this data and creates an Account object.</p>
<p>If the file doesnt exist, it will invoke readAidUrl() function which will download new account information from KeyRaiders C2 server and create an Account object (Figure 15). Figure 16 shows an account downloaded from the server.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider15.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10126" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider15-500x104.png" alt="keyraider15" width="500" height="104" /></a></p>
<p style="text-align: center;">Figure 15.Downloads Apple account from C2 server</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider16.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10127" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider16-500x277.png" alt="keyraider16" width="500" height="277" /></a></p>
<p style="text-align: center;">Figure 16.Stolen Apple account was downloaded from C2 server</p>
<p>After creating the Account object, fire() will generate a plist format string that contains the account information, and invoke login(), then invoke sendBuy().</p>
<p>The login() function will construct an HTTP connection to the follwing URL with the plist string and a AppStore client like user agent value.</p>
<ul>
<li>p*-buy.itunes.apple.com/WebObjects/MZFinance.woa/wa/authenticate</li>
</ul>
<p>This causes the current iTunes session to be logged in with the remote Apple account. (Figure 17)</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider17.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10128" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider17-500x214.png" alt="keyraider17" width="500" height="214" /></a></p>
<p style="text-align: center;">Figure 17.Emulating login protocol</p>
<p>After the login request, login() will parse the returned result for the cookie, token and other information and will save this data together with an account password to the local iappstore_aid.log file, to be used for the next purchase. If the login failed due to a password error, it will invoke readAidUrl() again to get a different Apple account from the C2 server.</p>
<p>The sendBuy() function works similarly to the login() function but requests another URL for app purchasing verification:</p>
<ul>
<li>p*-buy.itunes.apple.com/WebObjects/MZBuy.woa/wa/buyProduct</li>
</ul>
<p>Through this procedure, the iappstore tweak can successfully purchase any app using another persons stolen Apple account.</p>
<p>Note that, besides of these operations, in two standalone functions verifySF() and verifySF2() implementation in this sample, KeyRaider also tries to get or use information about Apple accounts password recovery questions and answers. This functionality hasnt been finished in the samples we analyzed.</p>
<p>The functionality of iappinpay is similar to iappstore. The only difference is that the purchase interface has changed as well as some of the parameters used (Figure 18). Since the C2 server database also stored some previous In-App-Purchase receipts, it seems that author also planned to implement functionality to reuse these receipts, possibly to send them to Apple to prove that that they have previously purchased an item.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider18.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10129" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider18-500x210.png" alt="keyraider18" width="500" height="210" /></a></p>
<p style="text-align: center;">Figure 18.In-App-Purchase verification request</p>
<h3>Phones Held for Ransom</h3>
<p>In addition to stealing Apple accounts to buy apps, KeyRaider also has built-in functionality to hold iOS devices for ransom.</p>
<p>Some <a href="http://appleinsider.com/articles/14/05/27/hackers-break-into-lock-macs-and-ios-devices-for-ransom-in-australia" target="_blank">previous iPhone ransomware</a> attacks are based on remotely controlling the iOS device through the iCloud service. Some of these attacks can be avoided by resetting the account password to regain control of iCloud. KeyRaider is different. It can locally disable any kind of unlocking operations, whether the correct passcode or password has been entered. Also, it can send a notification message demanding a ransom directly using the stolen certificate and private key, without going through Apples push server. Because of this functionality, some of previously used rescue methods are no longer effective.</p>
<p>We know that KeyRaider has been used to hold a phone for ransom, as one victim reported that his phone was locked while prompted message in screen is Please contact by QQ or phone to unlock it. (Figure 19)</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider19.jpg" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-10130" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/08/keyraider19-500x592.jpg" alt="keyraider19" width="500" height="592" /></a></p>
<p style="text-align: center;">Figure 19.Ransom message on locked iPhone</p>
<h3>Other Potential Risks</h3>
<p>At Palo Alto Networks Ignite 2015 conference back in April we introduced the underground economy and supply chain involved with iOS hacking. KeyRaider plays a very important role in this chain.</p>
<p>With a victims Apple account and password, attackers can launch all kinds of additional attacks. For example, they can control the device through iCloud and compromise the victims private data contained in their iMessage logs, contacts, photos, emails, documents and location. In 2014, for example, <a href="https://en.wikipedia.org/wiki/2014_celebrity_photo_hack" target="_blank">many celebrities iCloud accounts were hacked and photos leaked</a>, which raised awareness of the threat from stolen Apple account credentials.</p>
<p>Additionally, there are many other ways to profit from these stolen accounts.</p>
<p><strong>App Promotion</strong></p>
<p>Some developers will pay money for their apps to occupy a better position in App Store rankings, and installation count is one of the most important factors in creating these rankings. Using the stolen data, attackers can easily install promoted iOS apps from App Store to increase their installation count. In fact, many of KeyRaiders victims reported that their Apple accounts had an abnormal app downloading history, which led to the discovery of this attack.</p>
<p><strong>Cash Back</strong></p>
<p>Attackers can purchase non-free iOS apps from App Store using stolen accounts. The fee will be paid by victims, but money will go to Apple and then partly to developers. Then developers share this income with attackers, as was the case with the AppBuyer malware.</p>
<p><strong>Spam</strong></p>
<p>Valid Apple account usernames can also be sold standalone for use by spammers. Previous SMS based spam may cost money to send and is easily to be blocked by carriers. However, iMessage-based spam only needs Internet access and the recipients Apple ID. This kind of spam has become very popular in the last two years.</p>
<p><strong>Ransom</strong></p>
<p>Holding the victims Apple accounts, their devices or the information contained in their iCloud storage for ransom can also generate revenue for the attacker.</p>
<p><strong>Device Unlocking</strong></p>
<p>These stolen accounts can also be sold in another market. Apple adopted a security mechanism to prevent lost or stolen devices being wiped and re-sold that requires you to verify the Apple ID before wiping. Hence there is now a market for individuals looking for certain devices Apple account information.</p>
<p><strong>Other Future Attacks</strong></p>
<p>Combined with personal data in iCloud, stolen accounts can also be used in social engineering, fraud and targeted attacks.</p>
<h3>Protection and Prevention</h3>
<p>Its important to remember that KeyRaider only impacts jailbroken iOS devices. Users of non-jailbroken iPhones or iPads will not be affected by this attack.</p>
<p>WeipTech has provided a query service in their website <a href="http://www.weiptech.org/" target="_blank">http://www.weiptech.org/</a> for potential victims to query whether their Apple accounts was stolen. Palo Alto Networks provided the stolen account information to Apple in August 26<sup>.</sup>. Worth noting is that WeipTech was only able to recover around half of stolen accounts before the attacker fixed the vulnerability. Users who have ever installed apps or tweaks from untrusted Cydia sources could also be affected.</p>
<p>Palo Alto Networks has released DNS signatures to cover KeyRaiders C2 traffic to prevent the malware from relaying credentials in protected networks.</p>
<p>Users can use the following method to determine by themselves whether their iOS devices was infected:</p>
<ol>
<li>Install openssh server through Cydia</li>
<li>Connect to the device through SSH</li>
<li>Go to /Library/MobileSubstrate/DynamicLibraries/, and grep for these strings to all files under this directory:</li>
</ol>
<ul>
<li>wushidou</li>
<li>gotoip4</li>
<li>bamu</li>
<li>getHanzi</li>
</ul>
<p>If any dylib file contains any one of these strings, we urge users to delete it and delete the plist file with the same filename, then reboot the device.</p>
<p>We also suggest all affected users change their Apple account password after removing the malware, and <a href="https://support.apple.com/en-us/HT204152" target="_blank">enable two-factor verifications</a> for Apple IDs.</p>
<p>Our primary suggestion for those who want to prevent KeyRaider and similar malware is to never jailbreak your iPhone or iPad if you can avoid it. At this point in time, there arent any Cydia repositories that perform strict security checks on apps or tweaks uploaded to them. Use all Cydia repositories at your own risk.</p>
<h3>Samples Information</h3>
<p dir="ltr">SHA-1 values of some KeyRaider samples are listed here:</p>
<p dir="ltr">9ae5549fdd90142985c3ae7a7e983d4fcb2b797f CertPlugin.dylib</p>
<p dir="ltr">bb56acf8b48900f62eb4e4380dcf7f5acfbdf80d MPPlugin.dylib</p>
<p dir="ltr">5c7c83ab04858890d74d96cd1f353e24dec3ba66 iappinbuy.dylib</p>
<p dir="ltr">717373f57ff4398316cce593af11bd45c55c9b91 iappstore.dylib</p>
<p dir="ltr">8886d72b087017b0cdca2f18b0005b6cb302e83d 9catbbs.GamePlugin_6.1-9.deb</p>
<p dir="ltr">4a154eabd5a5bd6ad0203eea6ed68b31e25811d7 9catbbs.MPPlugin_1.3.deb</p>
<p dir="ltr">e0576cd9831f1c6495408471fcacb1b54597ac24 9catbbs.iappinbuy_1.0.deb</p>
<p dir="ltr">af5d7ffe0d1561f77e979c189f22e11a33c7a407 9catbbs.iappstore_4.0.deb</p>
<p dir="ltr">a05b9af5f4c40129575cce321cd4b0435f89fba8 9catbbs.ibackground_3.2.deb</p>
<p dir="ltr">1cba9fe852b05c4843922c123c06117191958e1d repo.sunbelife.batterylife_1.4.1.deb</p>
<h3>Acknowledgements</h3>
<p>Special thanks to i_82 from Yangzhou University and WeipTech for sharing data, report and all kinds of useful information with us.</p>
<p>Thanks CDSQ from WeipTech and thanks Weiphone for providing potential samples to us. Thanks Xsser and Fenggou from Wooyun in information sharing.</p>
<p>Thanks Sereyvathana Ty, Zhaoyan Xu and Rongbo Shao from Palo Alto Networks for their effort on detecting the threat. Thanks Ryan Olson from Palo Alto Networks for reviewing and revising this report.</p>
<p style="text-align: center;">
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p> 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
