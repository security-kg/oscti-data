
<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preload" href="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/clearbit-autocomplete.css" as="style">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://usageanalytics.coveo.com">
  <link rel="preconnect" href="https://paloaltonetworks.tt.omtrdc.net">
  <link rel="preconnect" href="https://platform.cloud.coveo.com">
  <link rel="preconnect" href="https://assets.adobedtm.com">
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
  <!-- Adobe -->
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {opacity: 0 !important}", 3000));
</script>
<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<!-- End Adobe -->
  
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">

  <!-- Typekit -->
  <!--
  <script src="//use.typekit.net/itd3sep.js"></script>
  <script>try{Typekit.load({ async: true });}catch(e){}</script>-->
  <!-- End Typekit -->

 


    


<link rel="apple-touch-icon" sizes="57x57" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/manifest.json">
<link rel="mask-icon" href="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/safari-pinned-tab.svg" color="#8ad3de">
<link rel="shortcut icon" href="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/assets/images/icons/favicon.ico">
<meta name="msapplication-TileImage" content="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/mstile-144x144.png">
<meta name="msapplication-config" content="https://www.paloaltonetworks.com/etc/clientlibs/pan/img/favicons2020/browserconfig.xml">
<meta name="msapplication-TileColor" content="#da532c">




  <!-- Start WP HEAD -->
  <link rel="alternate" hreflang="en" href="https://blog.paloaltonetworks.com/2016/05/how-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr/" />

	<!-- This site is optimized with the Yoast SEO plugin v14.2 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>How CVE-2015-7547 (GLIBC getaddrinfo) Can Bypass ASLR</title>
	<meta name="description" content="Find out how CVE-2015-7547 (GLIBC getaddrinfo) can bypass ASLR." />
	<meta name="robots" content="index, follow" />
	<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://blog.paloaltonetworks.com/2016/05/how-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="How CVE-2015-7547 (GLIBC getaddrinfo) Can Bypass ASLR" />
	<meta property="og:description" content="Find out how CVE-2015-7547 (GLIBC getaddrinfo) can bypass ASLR." />
	<meta property="og:url" content="https://blog.paloaltonetworks.com/2016/05/how-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr/" />
	<meta property="og:site_name" content="Palo Alto Networks Blog" />
	<meta property="article:published_time" content="2016-05-27T07:30:48+00:00" />
	<meta property="article:modified_time" content="2016-05-26T21:50:09+00:00" />
	<meta property="og:image" content="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/sample-app-flow-500x222.png" />
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Palo Alto Networks Blog &raquo; Feed" href="https://blog.paloaltonetworks.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Palo Alto Networks Blog &raquo; Comments Feed" href="https://blog.paloaltonetworks.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Palo Alto Networks Blog &raquo; How CVE-2015-7547 (GLIBC getaddrinfo) Can Bypass ASLR Comments Feed" href="https://blog.paloaltonetworks.com/2016/05/how-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr/feed/" />
<meta property="og:date_created" content="May 27, 2016 at 12:30 AM"/>
<meta property="og:post_image" content=""/>
<meta property="og:post_id" content="14028"/>
<meta property="og:post_total_likes" content="2"/>
<meta property="og:post_length" content="1989"/>
<meta property="og:category" content="Endpoint"/>
<meta property="og:category_link" content="https://blog.paloaltonetworks.com/category/endpoint-2/"/>
<meta property="og:author" content="Gal De Leon"/>
<meta property="og:author" content="Nadav Markus"/>
<meta property="og:authorloginname" content="Gal De Leon"/>
<meta property="og:authorloginname" content="Nadav Markus"/>
<meta property="og:authorlink" content="https://blog.paloaltonetworks.com/author/gal-de-leon/"/>
<meta property="og:authorlink" content="https://blog.paloaltonetworks.com/author/nadav-markus/"/>
<meta property="og:author_image_link" content="https://blog.paloaltonetworks.com/wp-content/uploads/2017/05/unit42_400x400.jpg"/>
<meta property="og:author_image_link" content="https://blog.paloaltonetworks.com/wp-content/uploads/2020/03/panw_master-twitter-profile-pic-400x400-1.png"/>
<meta property="og:section" content="Palo Alto Networks"/>
<meta property="og:recent_views" content="415"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"How CVE-2015-7547 (GLIBC getaddrinfo) Can Bypass ASLR","name":"How CVE-2015-7547 (GLIBC getaddrinfo) Can Bypass ASLR","description":"Introduction On February 16, 2016 Google described a critical vulnerability in GLIBC\u2019s getaddrinfo function. They provided a crash PoC, and so the task of producing a reliable exploit began. In this post, &hellip;","url":"https:\/\/blog.paloaltonetworks.com\/2016\/05\/how-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr\/","mainEntityOfPage":"https:\/\/blog.paloaltonetworks.com\/2016\/05\/how-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr\/","datePublished":"May 27, 2016","articleBody":"Introduction\r\nOn February 16, 2016 Google described a critical vulnerability in GLIBC\u2019s getaddrinfo function. They provided a crash PoC, and so the task of producing a reliable exploit began. In this post, we will show how CVE-2015-7547 can bypass ASLR-enabled systems.\r\nThe Bug\r\ngetaddrinfo() is used to resolve a hostname and a service to struct addrinfo. This is done by performing a DNS query to get the corresponding IP address(es).\r\nint getaddrinfo(const char *node, const char *service,\r\n                const struct addrinfo *hints,\r\n                struct addrinfo **res) {\r\n    ...\r\n}\r\n\r\nAs an optimization, getaddrinfo()\u2019s implementation uses alloca() function (which allocates a buffer on the stack) for the DNS response. In case the response is too long, it allocates a heap buffer and uses that instead. The bug stems from the fact that, under certain circumstances, the code updates the buffer size to the newly allocated heap buffer but keeps using the old stack buffer pointer. This creates a classic stack-bases overflow.\r\nASLR? ASLR!\r\nThe return address of getaddrinfo can be overwritten using this vulnerability, but where should we point it? In ASLR-enabled systems, module addresses are randomized. Therefore an attacker is not able to set the execution flow to a predefined address. In case the exploited application is compiled with PIE (as it should be), we cannot rely on its main executable to be located at a predefined location.\r\nfork()\r\nThe standard way to create new processes in Linux is fork(). A typical fork would look like the following:\r\npid = fork();\r\n\r\nif (0 &lt; pid) {\r\n    \/* Parent code goes here... *\/\r\n} else if (0 == pid) {\r\n  \/* Child code goes here... *\/  \r\n} \r\n\u2026\r\n\r\nCode resumes from the same opcode instruction in both parent and child processes. It only differs by the value of \u201cpid\u201d, which is returned by fork(). Unlike Windows, this means that a child process shares many characteristics with its parent -- it has the same register state, stack and memory layout.\r\nSample Application Flow\r\nLet us consider a server application that acts like the following:\r\n\r\n\r\n\r\n \tA client remotely connects to the application.\r\n \tIn order to handle the client\u2019s request, the application daemon forks itself.\r\n \tAs part of handling the request, the forked child process resolves a hostname using the \u201cgetaddrinfo()\" function. Thus, it sends a DNS request to its DNS server.\r\n \tDNS server replies with a valid response for the DNS request.\r\n \tChild process initiates a connection with the resolved host.\r\n\r\nEach time a request is handled by the daemon, it forks itself. This means that all child processes will share the same memory layout \u2013 including the addresses where modules are loaded. This simplified scenario is very common for many services such HTTP-proxies, email servers or DNS servers.\r\nExploitation Flow\r\nFor exploitation, we assume an attacker has the ability to answer arbitrary DNS requests performed by the server victim. The way this can be achieved is out of the scope of this paper; but, to name a few, this can be done by local ARP poisoning attack, DNS spoofing, etc.\r\n\r\n\r\n\r\n \tAn attacker initiates a request to the victim server.\r\n \tIn order to handle the attacker\u2019s request, the victim daemon forks itself.\r\n \tForked child process performs a DNS request.\r\n \tAttacker replies with a malicious DNS response that overwrites the child process\u2019 instruction pointer (RIP) to the address. In this example, it sets it to 0x12121212.\r\n \tAttacker gets a TCP-syn request initiated by the child process using \u201cconnect ()\u201d.\r\n\r\nIf 0x12121212 is indeed the right return address of \u201cgetaddrinfo()\u201d, then the application flow is continued as it should and issues the \u201cconnect()\u201d right afterward.\r\n0x000000001212120d    call _getaddrinfo\r\n0x0000000012121212    test eax, eax\r\n\r\nIf this is not the situation, and the attacker transferred the instruction pointer (RIP) to any other address, the application will crash either due to a segmentation fault or invalid opcode execution.\r\n0x0000000012121200    call _getaddrinfo\r\n0x0000000012121206    test eax, eax\r\n..\r\n0x0000000012121212    invalid-opcode\t(RIP)\r\n\r\nThis behavior can be used as an indication of whether an address is the correct return address of getaddrinfo (if so, a TCP-connection will be created). Since module addresses are not randomized between different forks(), this address remains constant in all child processes. An attacker can abuse this behavior and enumerate all possible addresses until guessed correctly. At each DNS-response, the adversary would reply with a different address, knowing a crash means that address is incorrect.\r\n\r\nHowever, this still requires enumerating ~264, which is not feasible.\r\nByte-by-Byte Approach\r\nInstead, the attacker can overwrite a single byte every time. For example, assume the return address of getaddrinfo is 0x00007fff01020304:\r\n\r\n \r\n\r\nWe first respond with the right amount of bytes that only overwrite the LSB of getaddrinfo\u2019s return address. We overwrite it with 0x00, which is incorrect since, in the above example, the return address LSB is 0x04; getaddrinfo will return to 0x00007fff01020300, which is invalid, and will crash. We repeat this process, but each time we increase the guessed LSB by 1. When we reach 0x04, the application won\u2019t crash \u2013 this means 0x04 is the LSB of the return address!\r\n\r\nNow we repeat the entire process, enumerating the next byte by overwriting 2 bytes of the return address (0x04 0x00). We set the value of the first byte (LSB) to the previously leaked one, so we only enumerate the second. This is proceeded until the entire return address is leaked (each time enumerating the next byte).\r\n\r\nWith this approach, the maximum amount of tries is 8 * 28 tries (28 per byte, 8 bytes per address). This enumeration is quite small and feasible within a few seconds.\r\nFinding Exploitable Applications\r\nWe used the website http:\/\/codesearch.debian.net, which indexes the source of ~18,000 Debian packages. Searching for all the applications that call both \u201cfork()\u201d and \u201cgetaddrinfo()\u201d, we found over 1300 potential exploitable apps. We then need to inspect the source code of each app and check if its flow suits our needs.\r\nTinyproxy\r\nThe tinyproxy application matches this flow. A new child process is \u201cfork()d\u201d when it issues an HTTP-connect request. It then calls \u201cgetaddrinfo()\u201d to retrieve the IP address of the requested website. Then \u201cconnect()\u201ds that host to get the website content.\r\nExploitation\r\nThe diagram previously shown is a simplification of the actual scenario. When overwriting the return address, we also overwrite several stack variables. If the attacker doesn\u2019t set those to the right values beforehand, the application will crash before returning from getaddrinfo. If that happens, the adversary will not be able to overwrite RIP. Thus the attacker would employ the same technique in order to leak them.\r\nLeaking an Arbitrary Stack Pointer\r\nThe first crash we encountered happened to be on the following code block:\r\n\r\n\r\n\r\nFirst, rbx gets overwritten. It is then dereferenced by the \u201cmov BYTE PTR [rbx], sil\u201d instruction. Originally, rbx pointed to a buffer on the stack. This means that, if we use the byte-by-byte approach, we can enumrate its value and leak an address on the stack.\r\n\r\nThe diagram below (output of \/proc\/PID\/maps) shows the stack\u2019s boundaries. As you can see, its initial size is always greater than 0x1000 bytes.\r\n    0x7ffd07882000    0x7ffd078a3000    0x21000      0x0 [stack]\r\n    0x7ffd079f0000     0x7ffd079f2000      0x2000        0x0 [vvar]\r\n    0x7ffd079f2000     0x7ffd079f4000      0x2000        0x0 [vdso]\r\n    0xffffffffff600000  0xffffffffff601000\t0x1000       0x0 [vsyscall]\r\n\r\nThe address pointed by rbx must be writable (otherwise a segmentation fault will be raised). But it happened to be a flaw in which it doesn\u2019t matter to where we write the value of \u201csil\u201d. As long as it is a writeable address, the flow will continue correctly. This means that it does not matter what value we set to the lower 12 bits of rbx since it will always be readable due to the size of the stack.\r\n\r\nSo we leaked an arbitrary pointer within the stack range. What happens when we have to be precise, where the address pointed by a stack variable affects the flow in a considerable way?\r\nLeaking Stack Base\r\nFor situations like these, we have to rely on constant offsets. Since the flow of the application is always the same, the stack depth will always be the same. This means we can rely on the offset from stack base to these variables, structs and buffers.\r\n\r\nLeaking the stack base is simpler than enumerating an arbitrary address. Since we already have an address within stack range \u2013 we can enumerate where the stack base is. We know the stack base is aligned to a page boundary (0x1000), and we also know that it will be the first non-readable address following the stack.\r\n\r\n\r\n\r\nLet us assume that the stack base is at 0x00007fffed008000. We take the arbitrary stack address we leaked and align it to a page boundary \u2013 for instance 0x00007fffed000140 is aligned to 0x00007fffed000000. We then enumerate the stack base, starting from this aligned address and incrementing it between each attempt by 0x1000 (page size). After we send a response that overwrites the previously mentioned pointer, we wait for a short while and check if the server tried to connect to our resolved IP. If it did, it means we haven\u2019t reached the stack base yet. If a timeout occurs, we assume the server crashed and we reached our goal.\r\nStack Base Offset\r\nBefore returning from getaddrinfo, the following check is performed:\r\n\r\n\r\n\r\n(@ glibc nss_dns_gethostbyname4_r)\r\n\r\nNote the block that is highlighted in red. If we reach it and pass an invalid heap pointer as an argument, the application crashes (as it tries to free an invalid heap block). To bypass this free(), r14 and rdi must be equal. r14 points to the original __alloca() stack buffer. Since the stack base was previously leaked, and the __alloca() buffer\u2019s offset from the stack base should be constant, we didn\u2019t expect to encounter any problem. However, we found out that the offset is slightly different at every run. Why?\r\n\r\n\/arch\/x86\/kernel\/process.c\r\nunsigned long arch_align_stack(unsigned long sp)\r\n{\r\n        if (!(current-&gt;personality &amp; ADDR_NO_RANDOMIZE) &amp;&amp; randomize_va_space)\r\n                sp -= get_random_int() % 8192;\r\n        return sp &amp; ~0xf;\r\n} \r\n\r\nObserving the above kernel code, you can see that, if ASLR is enabled, SP (stack-pointer) is decremented by a random number. This means that there will be a random delta between rsp and the stack base on every different run.\r\n\r\n\r\n\r\nFortunately, this number is quite small \u2013 only slightly bigger than the size of your average byte. We can easily enumerate this random offset.\r\n\r\nLooking at the above IDA code snippet, we can see that if rdi equals to r14, the code path that attempts to free rdi won\u2019t be taken. Thus, we used our previously leaked stack base, combined with a pre-calculated (i.e., if arch-align stack would return 0), and then attempted all the other 29 possibilities.\r\nLeaking LIBC Module\r\nThis part is now trivial, as we use the previously mentioned technique to enumerate each byte of the return address.\r\nCode Execution\r\nAll that is left to do is to construct a ROP chain. This is very easy and straightforward. We know the offset of system() function from the base of libc, so we just set up its argument and call it using ROP.\r\nConclusion\r\n\u201cClassic\u201d stack overflow vulnerabilities do not provide address leaks by nature. Still, under certain conditions, an attacker can leverage creative techniques to exploit those vulnerabilities. In this research, we abused the way Linux creates processes to bypass ASLR. In other scenarios, different security mitigations might be evaded.\r\n\r\nThis technique can be leveraged for other memory corruption bugs. Therefore, a vigilant user should always attempt to secure servers by deploying software patches and updates in a timely fashion. At Palo Alto Networks, developing a deeper understanding of such exploitation methods is a core objective of our mission to help our clients prevent breaches and secure our way of life in the digital age. This type of knowledge allows us to develop better threat intelligence and implement preventive techniques that help our customers stay one step ahead of potential threat actors.","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"","width":"","height":""},"author":[{"@type":"Person","name":"Gal De Leon"},{"@type":"Person","name":"Nadav Markus"}]}</script>		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.paloaltonetworks.com\/wp-includes\/js\/wp-emoji-release.min.js"}};
			/*! This file is auto-generated */
			!function(e,a,t){var r,n,o,i,p=a.createElement("canvas"),s=p.getContext&&p.getContext("2d");function c(e,t){var a=String.fromCharCode;s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,e),0,0);var r=p.toDataURL();return s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,t),0,0),r===p.toDataURL()}function l(e){if(!s||!s.fillText)return!1;switch(s.textBaseline="top",s.font="600 32px Arial",e){case"flag":return!c([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])&&(!c([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!c([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]));case"emoji":return!c([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}function d(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(i=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},o=0;o<i.length;o++)t.supports[i[o]]=l(i[o]),t.supports.everything=t.supports.everything&&t.supports[i[o]],"flag"!==i[o]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[i[o]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(r=t.source||{}).concatemoji?d(r.concatemoji):r.wpemoji&&r.twemoji&&(d(r.twemoji),d(r.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='crayon-css'  href='https://blog.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://blog.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://blog.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://blog.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='contact-form-7-css'  href='https://blog.paloaltonetworks.com/wp-content/plugins/contact-form-7/includes/css/styles.css' type='text/css' media='all' />
<style id='contact-form-7-inline-css' type='text/css'>
.wpcf7 .wpcf7-recaptcha iframe {margin-bottom: 0;}.wpcf7 .wpcf7-recaptcha[data-align="center"] > div {margin: 0 auto;}.wpcf7 .wpcf7-recaptcha[data-align="right"] > div {margin: 0 0 0 auto;}
</style>
<link rel='stylesheet' id='dashicons-css'  href='https://blog.paloaltonetworks.com/wp-includes/css/dashicons.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://blog.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//blog.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//blog.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-menu-item-0-css'  href='//blog.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/menu-item/style.css' type='text/css' media='all' />
<link rel='stylesheet' id='sage/css-css'  href='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/styles/main.css' type='text/css' media='all' />
<script>if (document.location.protocol != "https:") {document.location = document.URL.replace(/^http:/i, "https:");}</script><script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/jquery-3.5.1.min.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/jquery-migrate-1.4.1.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/blog.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js'></script>
<link rel='https://api.w.org/' href='https://blog.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://blog.paloaltonetworks.com/?p=14028' />
<link rel="alternate" type="application/json+oembed" href="https://blog.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.paloaltonetworks.com%2F2016%2F05%2Fhow-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://blog.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.paloaltonetworks.com%2F2016%2F05%2Fhow-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:180,186,114,3,12,9,81,84,87,129,138,6,162;" />
  <script>var $ = jQuery;</script>
    <!-- Unit42 Scripts -->
  <script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  <!-- End Unit42 Scripts -->
<meta name="google-site-verification" content="G1onsZ_PNprWXTYsKyATpZKzp8IAJ1jlbavSwUDN5Uo" />
</head>
  <body data-rsssl=1 data-results-per-page="9" class="post-template-default single single-post postid-14028 single-format-standard how-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr sidebar-primary">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <input type="hidden" id="searching" value=""/><header class="container-fluid container-blog sticky-top">
     
      <div class="pan-page-alert pan-page-alert-light">
    		<div class="pan-page-alert-text"><a href="https://www.paloaltonetworks.com/our-response-to-covid-19" data-page-track-value=":en_us: title :covid19" data-page-track="true">See our response to COVID-19</a></div>
    		<button type="button" class="pan-page-alert-close" aria-label="page alert close">
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 1L6 6M6 6L11 1M6 6L1 11M6 6L11 11" stroke="#727272" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
          </button>
		  </div>
    
	
      <div class="container-xl">
        <div class="row">
          <div class="col-logo">
            <a href="https://www.paloaltonetworks.com" class="nav-logo" nav-track="true" nav-track-breadcrumb="nav:logo" aria-label="paloaltonetworks">
              <svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M59.4806 4.69592C57.6725 4.69592 55.7941 5.18876 53.4694 6.43377L54.7609 9.62741C56.7798 8.50019 58.4474 8.00735 59.6687 8.00735C61.0542 8.00735 61.6648 8.52395 61.6648 9.20483V9.25133C61.6648 9.72143 61.2887 9.97974 60.3733 10.0738L58.777 10.238C54.7847 10.6606 53.1409 12.3985 53.1409 14.7934V14.9577C53.1409 17.2359 55.0192 19.0203 57.6725 19.0203C59.4197 19.0203 60.9374 18.2826 61.8601 16.9807L62.1577 18.7857H65.7739V10.5904C65.7739 6.71584 63.5432 4.69592 59.4806 4.69592ZM59.1283 15.8969C57.7903 15.8969 57.1559 15.3803 57.1559 14.5816V14.5351C57.1559 13.8305 57.5547 13.3139 59.0105 13.1031L59.6449 13.0091C60.5717 12.8799 61.141 12.7095 61.6648 12.3923V13.4317C61.6648 15.0052 60.6781 15.8969 59.1283 15.8969Z" fill="black" class="logo-text"></path>
                <path d="M25.4785 4.78994L20.8529 0.164276L16.2272 4.78994L18.5281 7.09192L6.92834 18.6917L11.554 23.3174L16.1797 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="#FA582D" class="logo-icon"></path>
                <path d="M11.6001 0.164063L0 11.7642L4.62603 16.3902L16.2262 4.79009L11.6001 0.164063Z" fill="#FA582D" class="logo-icon"></path>
                <path d="M27.7795 7.09215L16.1793 18.6923L20.8054 23.3183L32.4055 11.7182L27.7795 7.09215Z" fill="#FA582D" class="logo-icon"></path>
                <path d="M72.2314 0H68.1223V18.7857H72.2314V0Z" fill="black" class="logo-text"></path>
                <path d="M46.2362 4.69592C44.3681 4.69592 42.8679 5.52249 42.0424 6.81709L41.7283 4.93046H38.1121V23.4806H42.2211V17.051C43.0033 18.2567 44.4828 19.0193 46.2362 19.0193C49.5238 19.0193 52.2009 16.1077 52.2009 12.0916V11.6215C52.2009 7.60853 49.5238 4.69592 46.2362 4.69592ZM47.974 11.9759C47.974 14.0888 46.8705 15.6159 45.0387 15.6159C43.2068 15.6159 42.1033 14.0898 42.1033 11.9759V11.7414C42.1033 9.62741 43.2068 8.10137 45.0387 8.10137C46.8705 8.10137 47.974 9.62741 47.974 11.7414V11.9759Z" fill="black" class="logo-text"></path>
                <path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="black" class="logo-text"></path>
                <path d="M138.709 5.54211V5.47185C138.709 5.07304 138.404 4.79097 137.864 4.79097H136.924V6.9514H137.371V6.22299H137.867L138.24 6.9514H138.733L138.274 6.09694C138.553 6.01119 138.709 5.80248 138.709 5.54211ZM137.37 5.18979H137.863C138.145 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.144 5.82418 137.863 5.82418H137.37V5.18979Z" fill="black" class="logo-text"></path>
                <path d="M137.77 3.63997C136.502 3.63997 135.539 4.60292 135.539 5.87066C135.539 7.1384 136.502 8.10135 137.77 8.10135C139.037 8.10135 140 7.1384 140 5.87066C140 4.60292 139.037 3.63997 137.77 3.63997ZM137.77 7.79552C136.666 7.79552 135.868 6.99685 135.868 5.86963C135.868 4.7424 136.666 3.94373 137.77 3.94373C138.873 3.94373 139.672 4.7424 139.672 5.86963C139.672 6.99685 138.873 7.79552 137.77 7.79552Z" fill="black" class="logo-text"></path>
                <path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="black" class="logo-text"></path>
                <path d="M116.518 15.6159C115.321 15.6159 114.875 15.029 114.875 13.7613V8.10136H119.712V4.93148H114.875V1.76057L110.766 2.3712V14.159C110.766 17.3764 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="black" class="logo-text"></path>
                <path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="black" class="logo-text"></path>
                <path d="M81.2247 4.69592C77.0216 4.69592 74.0625 7.6075 74.0625 11.6236V12.0937C74.0625 16.1087 77.0216 19.0213 81.2247 19.0213C85.4278 19.0213 88.3869 16.1097 88.3869 12.0937V11.6236C88.3858 7.60853 85.4278 4.69592 81.2247 4.69592ZM84.159 11.9759C84.159 14.0888 83.0555 15.6159 81.2236 15.6159C79.3918 15.6159 78.2883 14.0898 78.2883 11.9759V11.7414C78.2883 9.62741 79.3918 8.10137 81.2236 8.10137C83.0555 8.10137 84.159 9.62741 84.159 11.7414V11.9759Z" fill="black" class="logo-text"></path>
                <path d="M98.0448 22.1168H99.0976L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0253 23.5312H99.0109V25.4964H98.0448V22.1168Z" fill="black" class="logo-text"></path>
                <path d="M102.816 22.1168H105.771L105.81 22.9372H103.826V23.4011H105.385V24.1491H103.826V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="black" class="logo-text"></path>
                <path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="black" class="logo-text"></path>
                <path d="M110.943 22.1168H112.024L112.574 24.4632H112.628L113.342 22.1168H114.333L115.032 24.4632H115.086L115.626 22.1168H116.66L115.771 25.4964H114.443L113.826 23.4589H113.797L113.168 25.4964H111.836L110.943 22.1168Z" fill="black" class="logo-text"></path>
                <path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.258 23.8071C120.258 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.915 24.7391 120.258 24.3909 120.258 23.8071Z" fill="black" class="logo-text"></path>
                <path d="M122.364 22.1168H124.334C125.232 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.45 24.2369 125.015 24.4105L125.816 25.4974H124.668L124.045 24.6089H123.378V25.4974H122.364V22.1168ZM124.203 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.203 22.933H123.377V23.8164H124.203Z" fill="black" class="logo-text"></path>
                <path d="M126.989 22.1168H128.003V23.3628H128.418L129.408 22.1168H130.548L130.553 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.003V25.4964H126.989V22.1168Z" fill="black" class="logo-text"></path>
                <path d="M131.402 25.2743V24.3475H131.407C131.972 24.6326 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3464 133.425 24.3031 132.701 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.913 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.387 22.84 132.952 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5405 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.953 25.5884C132.364 25.5884 131.895 25.4675 131.402 25.2743Z" fill="black" class="logo-text"></path>
              </svg>
            </a>
            <a href="https://blog.paloaltonetworks.com" class="nav-lockup active" >Blog</a>
          </div>
          <div class="col col-mobile">
            <button class="nav-toggle closed" id="nav-mobile-toggle">
              <svg class="menu-dashes open" width="21" height="16" viewBox="0 0 21 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="18.8125" y1="1.5" x2="1.5" y2="1.5" stroke="black" stroke-width="3" stroke-linecap="round"></line>
                <line x1="18.8125" y1="8" x2="1.5" y2="8" stroke="black" stroke-width="3" stroke-linecap="round"></line>
                <line x1="18.8125" y1="14.5" x2="1.5" y2="14.5" stroke="black" stroke-width="3" stroke-linecap="round"></line>
              </svg>
              <svg class="menu-x close" width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="2.95117" y1="14.2207" x2="14.8534" y2="2.31847" stroke="black" stroke-width="3" stroke-linecap="round"></line>
                <line x1="1.5" y1="-1.5" x2="18.3323" y2="-1.5" transform="matrix(-0.707107 -0.707107 -0.707107 0.707107 14.998 16.3422)" stroke="black" stroke-width="3" stroke-linecap="round"></line>
              </svg>
                <span class="mobile-menu">Menu</span>
            </button>
          </div>
            <nav class="col col-navbar navbar" id="nav-mobile">
                <ul>
                    <li class="menu-item-home"><a href="https://blog.paloaltonetworks.com">Palo Alto Networks</a></li>
                                            
                    <li class="menu-item-object-net_sec_post">
                        <a href="https://blog.paloaltonetworks.com/network-security/">Network Security</a>
                    </li>
                    
                                            
                    <li class="menu-item-object-sase_post">
                        <a href="https://blog.paloaltonetworks.com/sase/">SASE</a>
                    </li>
                    
                                            
                    <li class="menu-item-object-cloud_sec_post">
                        <a href="https://blog.paloaltonetworks.com/prisma-cloud/">Cloud Native Security</a>
                    </li>
                    
                                            
                    <li class="menu-item-object-sec_ops_post">
                        <a href="https://blog.paloaltonetworks.com/security-operations/">Security Operations</a>
                    </li>
                    
                                        <li>
                <div class="search"  id="form-search">
                    <input type="text" name="search" autocomplete="off" id="postSearch1" placeholder="Search the Blog" />
                  
                    <button id="nav-search-open-toggle">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" >
                      <path d="M8.66675 15.3335C12.3487 15.3335 15.3335 12.3487 15.3335 8.66675C15.3335 4.9848 12.3487 2 8.66675 2C4.9848 2 2 4.9848 2 8.66675C2 12.3487 4.9848 15.3335 8.66675 15.3335Z" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
                      <path d="M18.0007 18.0001L13.3784 13.3778" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                  </button>
                  
                  <button id="nav-search-close-toggle">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" >
                      <line x1="2.95117" y1="14.2207" x2="14.8534" y2="2.31847" stroke="black" stroke-width="3" stroke-linecap="round"></line>
                      <line x1="1.5" y1="-1.5" x2="18.3323" y2="-1.5" transform="matrix(-0.707107 -0.707107 -0.707107 0.707107 14.998 16.3422)" stroke="black" stroke-width="3" stroke-linecap="round"></line>
                    </svg>
                  </button>
                  
                </div>
              </li>
                </ul>
                        </nav>
          
            
        </div>
      </div>
    </header>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.2/masonry.pkgd.min.js"></script>-->
<script type="text/javascript">
    var main_nav_active_class = '';
    var main_nav_menu_item_name = 'menu-item-home';
    var str_subscription = '<div class="container-fluid container-newsletter-signup" >\
    <div class="container-lg">\
        <div class="row no-gutters row-newsletter-signup">\
            <div class="col-12 col-md-5 col-newsletter-signup-header">\
                <h2>Get updates!</h2>\
                <p class="lead">Sign up to receive the latest news</p>\
            </div>\
            <div class="col-12 col-md-7 col-newsletter-signup-form">\
                <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate="" class="subscribe-form clearfix" name="Unit42_Subscribe" id="subscribe_form1">\
                    <input type="hidden" value="subscribe-unit42" name="FormName">\
    <input id="field14" type="hidden" name="Qualifying_Campaign__c" value="70170000000lBnb">\
                         <input type="hidden" value="1086" name="formid">\
                         <input type="hidden" value="531-OCS-018" name="munchkinId">\
                         <input type="hidden" value="19887" name="lpId">\
                         <input type="hidden" value="1086" name="formVid">\
                         <input type="hidden" name="mkto_opt-in" value="true">\
                <div class="row no-gutters row-newsletter-signup-input">\
                    <div class="col-10 col-sm-11 col-newsletter-signup-input">\
                        <input type="email" name="Email" placeholder="Enter your email" id="input-newsletter-signup" class="subscribe-field rounded business_email" autocomplete="off">\
                    </div>\
                    <div class="col-2 col-sm-1 col-newsletter-signup-button">\
                        <button type="submit" value="Subscribe" disabled="disabled">\
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" viewBox="0 0 16 12" fill="none">\
                            <path d="M1 6L14.3333 6" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\
                            <path d="M9.33301 1L14.333 6L9.33301 11" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\
                            </svg>\
                        </button>\
                    </div>\
                </div>\
                <div class="email_invalid_msg">Please enter a valid email.</div>\
                <div class="row row-legal-disclaimer">\
                    <div class="col-12 col-legal-disclaimer">\
                        <p class="legal-disclaimer">By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>\
                    </div>\
                </div>\
                <div class="row row-recatcha d-none" id="row-recatcha">\
                    <div class="col-12 col-recatcha text-sm-center">\
                        <div id="captcha_container" class="google-recapth"></div>\
                    </div>\
                </div>\
                </form>\
            </div>\
        </div>\
    </div>\
</div>';
</script>
<article class="container-feed-master " id="main-container">
   <!--<div class="container-fluid container-breadcrumb"  data-aos="fade-in">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="https://blog.paloaltonetworks.com">Palo Alto Networks</a></li>
			          </ol>
        </nav>
    </div>-->
    
    <div class="container-fluid container-feed-article">
      <div class="container-lg">
        <div class="row row-feed-filters article-container container-inner" data-aos="fade-in" >
            <h1 class="blog-title">How CVE-2015-7547 (GLIBC getaddrinfo) Can Bypass ASLR</h1>
              <div class="col-xs-12 col-sm-6 col-md-8 col-lg-8 col-xl-9 pad-0">
                   <div class="tags-item">
                    <a href="https://blog.paloaltonetworks.com/category/endpoint-2/">Endpoint</a>                    
                    <a href="https://blog.paloaltonetworks.com/tag/aslr/" rel="tag">ASLR</a><a href="https://blog.paloaltonetworks.com/tag/cve-2015-7547/" rel="tag">CVE-2015-7547</a><a href="https://blog.paloaltonetworks.com/tag/getaddrinfo/" rel="tag">getaddrinfo</a><a href="https://blog.paloaltonetworks.com/tag/glibc/" rel="tag">GLIBC</a><a href="https://blog.paloaltonetworks.com/tag/glibc-exploit/" rel="tag">glibc exploit</a><a href="https://blog.paloaltonetworks.com/tag/glibc-vulnerability/" rel="tag">glibc vulnerability</a><a href="https://blog.paloaltonetworks.com/tag/google/" rel="tag">Google</a>                  </div>
              </div>
              <div class="col-xs-12 col-sm-6 col-md-4 col-lg-4 col-xl-3 pad-0 mobile-links">
                   <ol class="react-items">
                    <li>
				
				
				13,810
			 people reacted</li>
                    <li class="line"></li>
                    <li>
                      <div class="metadata-likes ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'14028','like')">
                          <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M4.74998 15.9999H2.49999C2.10217 15.9999 1.72064 15.8419 1.43934 15.5606C1.15803 15.2793 1 14.8977 1 14.4999V9.24995C1 8.85213 1.15803 8.4706 1.43934 8.18929C1.72064 7.90799 2.10217 7.74996 2.49999 7.74996H4.74998M9.99994 6.24997V3.24999C9.99994 2.65325 9.76289 2.08096 9.34094 1.65901C8.91898 1.23705 8.34669 1 7.74996 1L4.74998 7.74996V15.9999H13.2099C13.5717 16.004 13.9227 15.8772 14.1983 15.6429C14.474 15.4086 14.6557 15.0826 14.7099 14.7249L15.7449 7.97496C15.7775 7.75997 15.763 7.54047 15.7024 7.33165C15.6418 7.12283 15.5365 6.92968 15.3938 6.7656C15.2511 6.60151 15.0745 6.47041 14.8761 6.38138C14.6777 6.29234 14.4623 6.2475 14.2449 6.24997H9.99994Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                          </svg>
                          <span>2</span>
                      </div>
                    </li>
                  </ol>
              </div>
              <div class="container-lg author-desc-row">
                <div class="col-8 author-desc">
                  <div class="metadata-thumbnail" >
                                          <div class="metadata-thumbnail-author" style="background-image: url('https://blog.paloaltonetworks.com/wp-content/uploads/2017/05/unit42_400x400.jpg')">
                                          </div>      
                  </div>
                  <div class="metadata-author" >
                    <span class="author-name">By <a href="https://blog.paloaltonetworks.com/author/gal-de-leon/" title="Posts by Gal De Leon" class="author url fn" rel="author">Gal De Leon</a> and <a href="https://blog.paloaltonetworks.com/author/nadav-markus/" title="Posts by Nadav Markus" class="author url fn" rel="author">Nadav Markus</a></span><br /> 
                      <time datetime="2016-05-27T07:30:48+00:00">May 27, 2016 at 12:30 AM</time><br />
                      10 min. read
                  </div>
                </div>
                <!--<div class="col-6 social-items">
                      <span class="links">
                        <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4.28843 12.8112C4.28843 13.9855 3.32843 14.9375 2.1442 14.9375C0.959967 14.9375 0 13.9855 0 12.8112C0 11.6368 0.96 10.6848 2.14423 10.6848C3.32846 10.6848 4.28843 11.6368 4.28843 12.8112ZM10.1699 14.38C9.89019 9.2468 5.74406 5.13004 0.562199 4.85236C0.256339 4.83596 0 5.07967 0 5.38341V6.97945C0 7.25886 0.217299 7.49317 0.498449 7.5113C4.24282 7.75315 7.2442 10.7221 7.48858 14.4432C7.5069 14.722 7.74318 14.9375 8.0249 14.9375H9.63435C9.94068 14.9375 10.1864 14.6833 10.1699 14.38ZM14.9997 14.3896C14.7186 6.62601 8.41959 0.342913 0.552556 0.062845C0.250212 0.0520872 0 0.294304 0 0.594294V2.1903C0 2.47668 0.22885 2.70976 0.5174 2.72152C6.91848 2.9818 12.0562 8.07771 12.3187 14.4245C12.3305 14.7106 12.5655 14.9375 12.8544 14.9375H14.4638C14.7663 14.9375 15.0105 14.6894 14.9997 14.3896Z" fill="black"/>
                        </svg>
                      </span>
                      <span class="links">
                        <svg width="15" height="18" viewBox="0 0 15 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.7857 11.25C10.9286 11.25 10.1484 11.6016 9.57254 12.1781L6.28125 10.016C6.47879 9.35508 6.47879 8.64141 6.28125 7.98398L9.57254 5.82188C10.1484 6.39844 10.9286 6.75 11.7857 6.75C13.5603 6.75 15 5.23828 15 3.375C15 1.51172 13.5603 0 11.7857 0C10.0112 0 8.57143 1.51172 8.57143 3.375C8.57143 3.71953 8.62165 4.06406 8.71875 4.39102L5.42746 6.55312C4.85156 5.97656 4.07143 5.625 3.21429 5.625C1.43973 5.625 0 7.13672 0 9C0 10.8633 1.43973 12.375 3.21429 12.375C4.07143 12.375 4.85156 12.0234 5.42746 11.4469L8.71875 13.609C8.62165 13.9395 8.57143 14.2805 8.57143 14.625C8.57143 16.4883 10.0112 18 11.7857 18C13.5603 18 15 16.4883 15 14.625C15 12.7617 13.5603 11.25 11.7857 11.25ZM11.7857 1.6875C12.673 1.6875 13.3929 2.44336 13.3929 3.375C13.3929 4.30664 12.673 5.0625 11.7857 5.0625C10.8984 5.0625 10.1786 4.30664 10.1786 3.375C10.1786 2.44336 10.8984 1.6875 11.7857 1.6875ZM3.21429 10.6875C2.32701 10.6875 1.60714 9.93164 1.60714 9C1.60714 8.06836 2.32701 7.3125 3.21429 7.3125C4.10156 7.3125 4.82143 8.06836 4.82143 9C4.82143 9.93164 4.10156 10.6875 3.21429 10.6875ZM11.7857 16.3125C10.8984 16.3125 10.1786 15.5566 10.1786 14.625C10.1786 13.6934 10.8984 12.9375 11.7857 12.9375C12.673 12.9375 13.3929 13.6934 13.3929 14.625C13.3929 15.5566 12.673 16.3125 11.7857 16.3125Z" fill="black"/>
                        </svg>
                      </span>
                </div>-->
                <div class="col-4 social-items">
                  <div class="links">
                      <a href="http://feeds.feedburner.com/PaloAltoNetworks" target="_blank"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M4.28843 12.8112C4.28843 13.9855 3.32843 14.9375 2.1442 14.9375C0.959967 14.9375 0 13.9855 0 12.8112C0 11.6368 0.96 10.6848 2.14423 10.6848C3.32846 10.6848 4.28843 11.6368 4.28843 12.8112ZM10.1699 14.38C9.89019 9.2468 5.74406 5.13004 0.562199 4.85236C0.256339 4.83596 0 5.07967 0 5.38341V6.97945C0 7.25886 0.217299 7.49317 0.498449 7.5113C4.24282 7.75315 7.2442 10.7221 7.48858 14.4432C7.5069 14.722 7.74318 14.9375 8.0249 14.9375H9.63435C9.94068 14.9375 10.1864 14.6833 10.1699 14.38ZM14.9997 14.3896C14.7186 6.62601 8.41959 0.342913 0.552556 0.062845C0.250212 0.0520872 0 0.294304 0 0.594294V2.1903C0 2.47668 0.22885 2.70976 0.5174 2.72152C6.91848 2.9818 12.0562 8.07771 12.3187 14.4245C12.3305 14.7106 12.5655 14.9375 12.8544 14.9375H14.4638C14.7663 14.9375 15.0105 14.6894 14.9997 14.3896Z" fill="black"/>
                    </svg>
                    </a>
                  </div>
                  <div class="links">
                    <div class="dropdown dropup">
                      <a href="#!" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <svg width="15" height="18" viewBox="0 0 15 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11.7857 11.25C10.9286 11.25 10.1484 11.6016 9.57254 12.1781L6.28125 10.016C6.47879 9.35508 6.47879 8.64141 6.28125 7.98398L9.57254 5.82188C10.1484 6.39844 10.9286 6.75 11.7857 6.75C13.5603 6.75 15 5.23828 15 3.375C15 1.51172 13.5603 0 11.7857 0C10.0112 0 8.57143 1.51172 8.57143 3.375C8.57143 3.71953 8.62165 4.06406 8.71875 4.39102L5.42746 6.55312C4.85156 5.97656 4.07143 5.625 3.21429 5.625C1.43973 5.625 0 7.13672 0 9C0 10.8633 1.43973 12.375 3.21429 12.375C4.07143 12.375 4.85156 12.0234 5.42746 11.4469L8.71875 13.609C8.62165 13.9395 8.57143 14.2805 8.57143 14.625C8.57143 16.4883 10.0112 18 11.7857 18C13.5603 18 15 16.4883 15 14.625C15 12.7617 13.5603 11.25 11.7857 11.25ZM11.7857 1.6875C12.673 1.6875 13.3929 2.44336 13.3929 3.375C13.3929 4.30664 12.673 5.0625 11.7857 5.0625C10.8984 5.0625 10.1786 4.30664 10.1786 3.375C10.1786 2.44336 10.8984 1.6875 11.7857 1.6875ZM3.21429 10.6875C2.32701 10.6875 1.60714 9.93164 1.60714 9C1.60714 8.06836 2.32701 7.3125 3.21429 7.3125C4.10156 7.3125 4.82143 8.06836 4.82143 9C4.82143 9.93164 4.10156 10.6875 3.21429 10.6875ZM11.7857 16.3125C10.8984 16.3125 10.1786 15.5566 10.1786 14.625C10.1786 13.6934 10.8984 12.9375 11.7857 12.9375C12.673 12.9375 13.3929 13.6934 13.3929 14.625C13.3929 15.5566 12.673 16.3125 11.7857 16.3125Z" fill="black"/>
                        </svg>
                      </a>

                      <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                        <div class="share-dropdown">
                          <p><strong>SHARE</strong></p>
                          <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.paloaltonetworks.com%2F2016%2F05%2Fhow-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr%2F" target="_blank">
                          <i class="fa fb-icon fa-facebook-official pop-up-icon" aria-hidden="true"></i></a>
                          
                          <a href="https://twitter.com/home?status=https%3A%2F%2Fblog.paloaltonetworks.com%2F2016%2F05%2Fhow-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr%2F+-+How+CVE-2015-7547+%28GLIBC+getaddrinfo%29+Can+Bypass+ASLR" target="_blank"><i class="fa tw-icon fa-twitter pop-up-icon" aria-hidden="true"></i></a>
                          <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.paloaltonetworks.com%2F2016%2F05%2Fhow-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr%2F&title=How+CVE-2015-7547+%28GLIBC+getaddrinfo%29+Can+Bypass+ASLR&summary=&source=" target="_blank"><i class="fa lindn-icon fa-linkedin pop-up-icon" aria-hidden="true"></i></a>
                          <a href="//www.reddit.com/submit?url=https://blog.paloaltonetworks.com/2016/05/how-cve-2015-7547-glibc-getaddrinfo-can-bypass-aslr/" target="_blank"><i class="fa blog-icon fa-stumbleupon-circle pop-up-icon" aria-hidden="true"></i></a>
                          
                          </div>                       
                        </div>
                      </div>
                    </div>
                </div>
              </div>
              <div class="entry-content article-description"><h3>Introduction</h3>
<p>On February 16, 2016 Google described a critical <a href="https://security.googleblog.com/2016/02/cve-2015-7547-glibc-getaddrinfo-stack.html">vulnerability in GLIBCs getaddrinfo function</a>. They provided a crash PoC, and so the task of producing a reliable exploit began. In this post, we will show how CVE-2015-7547 can bypass ASLR-enabled systems.</p>
<h4>The Bug</h4>
<p>getaddrinfo() is used to resolve a hostname and a service to struct addrinfo. This is done by performing a DNS query to get the corresponding IP address(es).</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c469c166552662523" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
int getaddrinfo(const char *node, const char *service,
                const struct addrinfo *hints,
                struct addrinfo **res) {
    ...
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c469c166552662523-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c166552662523-2">2</div><div class="crayon-num" data-line="crayon-5f694c469c166552662523-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c166552662523-4">4</div><div class="crayon-num" data-line="crayon-5f694c469c166552662523-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c469c166552662523-1"><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-e">getaddrinfo</span><span class="crayon-sy">(</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">node</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">char</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-v">service</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c166552662523-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e ">addrinfo *</span><span class="crayon-v">hints</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5f694c469c166552662523-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-t">struct</span><span class="crayon-h"> </span><span class="crayon-e ">addrinfo *</span><span class="crayon-o">*</span><span class="crayon-v">res</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c166552662523-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line" id="crayon-5f694c469c166552662523-5"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>As an optimization, getaddrinfo()s implementation uses alloca() function (which allocates a buffer on the stack) for the DNS response. In case the response is too long, it allocates a heap buffer and uses that instead. The bug stems from the fact that, under certain circumstances, the code updates the buffer size to the newly allocated heap buffer but keeps using the old stack buffer pointer. This creates a classic stack-bases overflow.<span id="more-14028"></span></p>
<h4>ASLR? ASLR!</h4>
<p>The return address of getaddrinfo can be overwritten using this vulnerability, but where should we point it? In ASLR-enabled systems, module addresses are randomized. Therefore an attacker is not able to set the execution flow to a predefined address. In case the exploited application is compiled with PIE (as it should be), we cannot rely on its main executable to be located at a predefined location.</p>
<h3>fork()</h3>
<p>The standard way to create new processes in Linux is fork(). A typical fork would look like the following:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c469c16f540355246" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
pid = fork();

if (0 &lt; pid) {
    /* Parent code goes here... */
} else if (0 == pid) {
  /* Child code goes here... */  
} 
</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c469c16f540355246-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c16f540355246-2">2</div><div class="crayon-num" data-line="crayon-5f694c469c16f540355246-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c16f540355246-4">4</div><div class="crayon-num" data-line="crayon-5f694c469c16f540355246-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c16f540355246-6">6</div><div class="crayon-num" data-line="crayon-5f694c469c16f540355246-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c16f540355246-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c469c16f540355246-1"><span class="crayon-v">pid</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fork</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c16f540355246-2">&nbsp;</div><div class="crayon-line" id="crayon-5f694c469c16f540355246-3"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">pid</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c16f540355246-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/* Parent code goes here... */</span></div><div class="crayon-line" id="crayon-5f694c469c16f540355246-5"><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">pid</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c16f540355246-6"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">/* Child code goes here... */</span><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5f694c469c16f540355246-7"><span class="crayon-sy">}</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c16f540355246-8"></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>Code resumes from the same opcode instruction in both parent and child processes. It only differs by the value of pid, which is returned by fork(). Unlike Windows, this means that a child process shares many characteristics with its parent &#8212; it has the same register state, stack and memory layout.</p>
<h3>Sample Application Flow</h3>
<p>Let us consider a server application that acts like the following:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/sample-app-flow.png"><img class="aligncenter size-large wp-image-14037" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/sample-app-flow-500x222.png" alt="sample app flow" width="500" height="222" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/sample-app-flow-500x222.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/sample-app-flow-230x102.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/sample-app-flow-768x341.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/sample-app-flow-510x226.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/sample-app-flow-90x40.png 90w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/sample-app-flow.png 892w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<ol>
<li>A client remotely connects to the application.</li>
<li>In order to handle the clients request, the application daemon forks itself.</li>
<li>As part of handling the request, the forked child process resolves a hostname using the getaddrinfo()&#8221; function. Thus, it sends a DNS request to its DNS server.</li>
<li>DNS server replies with a valid response for the DNS request.</li>
<li>Child process initiates a connection with the resolved host.</li>
</ol>
<p>Each time a request is handled by the daemon, it forks itself. This means that all child processes will share the same memory layout  including the addresses where modules are loaded. This simplified scenario is very common for many services such HTTP-proxies, email servers or DNS servers.</p>
<h3>Exploitation Flow</h3>
<p>For exploitation, we assume an attacker has the ability to answer arbitrary DNS requests performed by the server victim. The way this can be achieved is out of the scope of this paper; but, to name a few, this can be done by local ARP poisoning attack, DNS spoofing, etc.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/exploit-flow.png"><img class="aligncenter size-large wp-image-14040" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/exploit-flow-500x238.png" alt="exploit flow" width="500" height="238" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/exploit-flow-500x238.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/exploit-flow-230x110.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/exploit-flow-768x366.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/exploit-flow-510x243.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/exploit-flow-84x40.png 84w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/exploit-flow.png 975w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<ol>
<li>An attacker initiates a request to the victim server.</li>
<li>In order to handle the attackers request, the victim daemon forks itself.</li>
<li>Forked child process performs a DNS request.</li>
<li>Attacker replies with a malicious DNS response that overwrites the child process instruction pointer (RIP) to the address. In this example, it sets it to 0x12121212.</li>
<li>Attacker gets a TCP-syn request initiated by the child process using connect ().</li>
</ol>
<p>If 0x12121212 is indeed the right return address of getaddrinfo(), then the application flow is continued as it should and issues the connect() right afterward.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c469c172962539861" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
0x000000001212120d    call _getaddrinfo
0x0000000012121212    test eax, eax</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c469c172962539861-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c172962539861-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c469c172962539861-1"><span class="crayon-cn">0x000000001212120d</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">call </span><span class="crayon-i">_getaddrinfo</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c172962539861-2"><span class="crayon-cn">0x0000000012121212</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">test </span><span class="crayon-v">eax</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">eax</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>If this is not the situation, and the attacker transferred the instruction pointer (RIP) to any other address, the application will crash either due to a segmentation fault or invalid opcode execution.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c469c173429199529" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
0x0000000012121200    call _getaddrinfo
0x0000000012121206    test eax, eax
..
0x0000000012121212    invalid-opcode	(RIP)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c469c173429199529-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c173429199529-2">2</div><div class="crayon-num" data-line="crayon-5f694c469c173429199529-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c173429199529-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c469c173429199529-1"><span class="crayon-cn">0x0000000012121200</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">call </span><span class="crayon-i">_getaddrinfo</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c173429199529-2"><span class="crayon-cn">0x0000000012121206</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">test </span><span class="crayon-v">eax</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">eax</span></div><div class="crayon-line" id="crayon-5f694c469c173429199529-3"><span class="crayon-sy">.</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c173429199529-4"><span class="crayon-cn">0x0000000012121212</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">invalid</span><span class="crayon-o">-</span><span class="crayon-e">opcode</span><span class="crayon-h">	</span><span class="crayon-sy">(</span><span class="crayon-v">RIP</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>This behavior can be used as an indication of whether an address is the correct return address of getaddrinfo (if so, a TCP-connection will be created). Since module addresses are not randomized between different forks(), this address remains constant in all child processes. An attacker can abuse this behavior and enumerate all possible addresses until guessed correctly. At each DNS-response, the adversary would reply with a different address, knowing a crash means that address is incorrect.</p>
<p>However, this still requires enumerating ~2<sup>64</sup>, which is not feasible.</p>
<h4>Byte-by-Byte Approach</h4>
<p>Instead, the attacker can overwrite a single byte every time. For example, assume the return address of getaddrinfo is 0x00007fff01020304:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/Screen-Shot-2016-05-26-at-2.29.31-PM.png"><img class="aligncenter size-full wp-image-14043" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/Screen-Shot-2016-05-26-at-2.29.31-PM.png" alt="Screen Shot 2016-05-26 at 2.29.31 PM" width="380" height="203" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/Screen-Shot-2016-05-26-at-2.29.31-PM.png 380w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/Screen-Shot-2016-05-26-at-2.29.31-PM-230x123.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/Screen-Shot-2016-05-26-at-2.29.31-PM-75x40.png 75w" sizes="(max-width: 380px) 100vw, 380px" /></a> <a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/Screen-Shot-2016-05-26-at-2.29.40-PM.png"><img class="aligncenter size-large wp-image-14046" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/Screen-Shot-2016-05-26-at-2.29.40-PM.png" alt="Screen Shot 2016-05-26 at 2.29.40 PM" width="386" height="42" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/Screen-Shot-2016-05-26-at-2.29.40-PM.png 386w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/Screen-Shot-2016-05-26-at-2.29.40-PM-230x25.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/Screen-Shot-2016-05-26-at-2.29.40-PM-240x26.png 240w" sizes="(max-width: 386px) 100vw, 386px" /></a></p>
<p>We first respond with the right amount of bytes that only overwrite the LSB of getaddrinfos return address. We overwrite it with 0x00, which is incorrect since, in the above example, the return address LSB is 0x04; getaddrinfo will return to 0x00007fff01020300, which is invalid, and will crash. We repeat this process, but each time we increase the guessed LSB by 1. When we reach 0x04, the application wont crash  this means 0x04 is the LSB of the return address!</p>
<p>Now we repeat the entire process, enumerating the next byte by overwriting 2 bytes of the return address (0x04 0x00). We set the value of the first byte (LSB) to the previously leaked one, so we only enumerate the second. This is proceeded until the entire return address is leaked (each time enumerating the next byte).</p>
<p>With this approach, the maximum amount of tries is 8 * 2<sup>8</sup> tries (2<sup>8</sup> per byte, 8 bytes per address). This enumeration is quite small and feasible within a few seconds.</p>
<h3>Finding Exploitable Applications</h3>
<p>We used the website <a href="http://codesearch.debian.net">http://codesearch.debian.net</a>, which indexes the source of ~18,000 Debian packages. Searching for all the applications that call both fork() and getaddrinfo(), we found over 1300 potential exploitable apps. We then need to inspect the source code of each app and check if its flow suits our needs.</p>
<h3>Tinyproxy</h3>
<p>The tinyproxy application matches this flow. A new child process is fork()d when it issues an HTTP-connect request. It then calls getaddrinfo() to retrieve the IP address of the requested website. Then connect()s that host to get the website content.</p>
<h3>Exploitation</h3>
<p>The diagram previously shown is a simplification of the actual scenario. When overwriting the return address, we also overwrite several stack variables. If the attacker doesnt set those to the right values beforehand, the application will crash before returning from getaddrinfo. If that happens, the adversary will not be able to overwrite RIP. Thus the attacker would employ the same technique in order to leak them.</p>
<h4>Leaking an Arbitrary Stack Pointer</h4>
<p>The first crash we encountered happened to be on the following code block:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-pointer.png"><img class="aligncenter size-large wp-image-14049" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-pointer-500x106.png" alt="stack pointer" width="500" height="106" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-pointer-500x106.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-pointer-230x49.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-pointer-768x163.png 768w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-pointer-510x108.png 510w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-pointer-188x40.png 188w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-pointer.png 975w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>First, rbx gets overwritten. It is then dereferenced by the mov BYTE PTR [rbx], sil instruction. Originally, rbx pointed to a buffer on the stack. This means that, if we use the byte-by-byte approach, we can enumrate its value and leak an address on the stack.</p>
<p>The diagram below (output of /proc/PID/maps) shows the stacks boundaries. As you can see, its initial size is always greater than 0x1000 bytes.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c469c177243943551" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    0x7ffd07882000    0x7ffd078a3000    0x21000      0x0 [stack]
    0x7ffd079f0000     0x7ffd079f2000      0x2000        0x0 [vvar]
    0x7ffd079f2000     0x7ffd079f4000      0x2000        0x0 [vdso]
    0xffffffffff600000  0xffffffffff601000	0x1000       0x0 [vsyscall]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c469c177243943551-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c177243943551-2">2</div><div class="crayon-num" data-line="crayon-5f694c469c177243943551-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c177243943551-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c469c177243943551-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0x7ffd07882000</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0x7ffd078a3000</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0x21000</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0x0</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">stack</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c177243943551-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0x7ffd079f0000</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0x7ffd079f2000</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0x2000</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0x0</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">vvar</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5f694c469c177243943551-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0x7ffd079f2000</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0x7ffd079f4000</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0x2000</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0x0</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">vdso</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c177243943551-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-cn">0xffffffffff600000</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-cn">0xffffffffff601000</span><span class="crayon-h">	</span><span class="crayon-cn">0x1000</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-cn">0x0</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">vsyscall</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>The address pointed by rbx must be writable (otherwise a segmentation fault will be raised). But it happened to be a flaw in which it doesnt matter to where we write the value of sil. As long as it is a writeable address, the flow will continue correctly. This means that it does not matter what value we set to the lower 12 bits of rbx since it will always be readable due to the size of the stack.</p>
<p>So we leaked an arbitrary pointer within the stack range. What happens when we have to be precise, where the address pointed by a stack variable affects the flow in a considerable way?</p>
<h4>Leaking Stack Base</h4>
<p>For situations like these, we have to rely on constant offsets. Since the flow of the application is always the same, the stack depth will always be the same. This means we can rely on the offset from stack base to these variables, structs and buffers.</p>
<p>Leaking the stack base is simpler than enumerating an arbitrary address. Since we already have an address within stack range  we can enumerate where the stack base is. We know the stack base is aligned to a page boundary (0x1000), and we also know that it will be the first non-readable address following the stack.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-base.png"><img class="aligncenter size-full wp-image-14052" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-base.png" alt="stack base" width="391" height="189" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-base.png 391w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-base-230x111.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/stack-base-83x40.png 83w" sizes="(max-width: 391px) 100vw, 391px" /></a></p>
<p>Let us assume that the stack base is at 0x00007fffed008000. We take the arbitrary stack address we leaked and align it to a page boundary  for instance 0x00007fffed000140 is aligned to 0x00007fffed000000. We then enumerate the stack base, starting from this aligned address and incrementing it between each attempt by 0x1000 (page size). After we send a response that overwrites the previously mentioned pointer, we wait for a short while and check if the server tried to connect to our resolved IP. If it did, it means we havent reached the stack base yet. If a timeout occurs, we assume the server crashed and we reached our goal.</p>
<h4>Stack Base Offset</h4>
<p>Before returning from getaddrinfo, the following check is performed:</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/offset.png"><img class="aligncenter size-large wp-image-14055" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/offset-500x380.png" alt="offset" width="500" height="380" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/offset-500x380.png 500w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/offset-230x175.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/offset-395x300.png 395w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/offset-53x40.png 53w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/offset.png 602w" sizes="(max-width: 500px) 100vw, 500px" /></a></p>
<p>(@ glibc nss_dns_gethostbyname4_r)</p>
<p>Note the block that is highlighted in red. If we reach it and pass an invalid heap pointer as an argument, the application crashes (as it tries to free an invalid heap block). To bypass this free(), r14 and rdi must be equal. r14 points to the original __alloca() stack buffer. Since the stack base was previously leaked, and the __alloca() buffers offset from the stack base should be constant, we didnt expect to encounter any problem. However, we found out that the offset is slightly different at every run. Why?</p>
<p>/arch/x86/kernel/process.c</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5f694c469c17a907499316" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
unsigned long arch_align_stack(unsigned long sp)
{
        if (!(current-&gt;personality &amp; ADDR_NO_RANDOMIZE) &amp;&amp; randomize_va_space)
                sp -= get_random_int() % 8192;
        return sp &amp; ~0xf;
} </textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5f694c469c17a907499316-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c17a907499316-2">2</div><div class="crayon-num" data-line="crayon-5f694c469c17a907499316-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c17a907499316-4">4</div><div class="crayon-num" data-line="crayon-5f694c469c17a907499316-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5f694c469c17a907499316-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5f694c469c17a907499316-1"><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">long</span><span class="crayon-h"> </span><span class="crayon-e">arch_align_stack</span><span class="crayon-sy">(</span><span class="crayon-t">unsigned</span><span class="crayon-h"> </span><span class="crayon-t">long</span><span class="crayon-h"> </span><span class="crayon-v">sp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c17a907499316-2"><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5f694c469c17a907499316-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-o">!</span><span class="crayon-sy">(</span><span class="crayon-v">current</span><span class="crayon-o">-&gt;</span><span class="crayon-v">personality</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-v">ADDR_NO_RANDOMIZE</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">&amp;&amp;</span><span class="crayon-h"> </span><span class="crayon-v">randomize_va_space</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c17a907499316-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sp</span><span class="crayon-h"> </span><span class="crayon-o">-=</span><span class="crayon-h"> </span><span class="crayon-e">get_random_int</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-cn">8192</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5f694c469c17a907499316-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">sp</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span><span class="crayon-h"> </span><span class="crayon-o">~</span><span class="crayon-cn">0xf</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5f694c469c17a907499316-6"><span class="crayon-sy">}</span><span class="crayon-h"> </span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Observing the above kernel code, you can see that, if ASLR is enabled, SP (stack-pointer) is decremented by a random number. This means that there will be a random delta between rsp and the stack base on every different run.</p>
<p><a href="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/aslr-enabled.png"><img class="aligncenter size-full wp-image-14058" src="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/aslr-enabled.png" alt="aslr enabled" width="282" height="249" srcset="https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/aslr-enabled.png 282w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/aslr-enabled-230x203.png 230w, https://blog.paloaltonetworks.com/wp-content/uploads/2016/05/aslr-enabled-45x40.png 45w" sizes="(max-width: 282px) 100vw, 282px" /></a></p>
<p>Fortunately, this number is quite small  only slightly bigger than the size of your average byte. We can easily enumerate this random offset.</p>
<p>Looking at the above IDA code snippet, we can see that if rdi equals to r14, the code path that attempts to free rdi wont be taken. Thus, we used our previously leaked stack base, combined with a pre-calculated (i.e., if arch-align stack would return 0), and then attempted all the other 2<sup>9 </sup>possibilities.</p>
<h4>Leaking LIBC Module</h4>
<p>This part is now trivial, as we use the previously mentioned technique to enumerate each byte of the return address.</p>
<h4>Code Execution</h4>
<p>All that is left to do is to construct a ROP chain. This is very easy and straightforward. We know the offset of system() function from the base of libc, so we just set up its argument and call it using ROP.</p>
<h3>Conclusion</h3>
<p>Classic stack overflow vulnerabilities do not provide address leaks by nature. Still, under certain conditions, an attacker can leverage creative techniques to exploit those vulnerabilities. In this research, we abused the way Linux creates processes to bypass ASLR. In other scenarios, different security mitigations might be evaded.</p>
<p>This technique can be leveraged for other memory corruption bugs. Therefore, a vigilant user should always attempt to secure servers by deploying software patches and updates in a timely fashion. At Palo Alto Networks, developing a deeper understanding of such exploitation methods is a core objective of our mission to help our clients prevent breaches and secure our way of life in the digital age. This type of knowledge allows us to develop better threat intelligence and implement preventive techniques that help our customers stay one step ahead of potential threat actors.</p>
</div>
            </div>

        </div>       
    </div>
  </article>


<script type="text/javascript">
    $('body').on('mouseover', '.idc_ul_cont_not_liked_inner', function(e) {
          $(this).find('svg').children('path').attr('stroke','#FF2E00');
          //$(this).attr('src','https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/blue-like-icon.png');
      });
      $('body').on('mouseout', '.idc_ul_cont_not_liked_inner', function(e) {
          $(this).find('svg').children('path').attr('stroke','#000000');
          //$(this).attr('src','https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/grey-like-icon.png');
      });
      
    $(document).ready(function(){
        //Moving single post page subscribe box one paragraph above from last
        var cont_width = $(".entry-content").width();
        cont_width = Math.round(cont_width/2);//
        var p_tag_found = false;
        var child_count = $( ".entry-content").children().length;
        var last_p_tag = ''; //2nd p tag 
        var p_tag_traverse_cnt = 0;
        var p_arr = [];
        var next_tag_is_image_container = false;
        for(var i = 0; i < child_count ; i++){
            var p_el = $('.entry-content').children().eq(i);
            /*
            var tag_name = $(p_el).prop('tagName');
            if(tag_name != 'UL' || tag_name == 'P'){
                continue
            }
            */
            
              var temp_text = $(p_el).html();
              temp_text = temp_text.trim();
              
              
              var found_in_child = $( p_el ).find( "img, iframe, video, figure" );
                
              if(temp_text == '&nbsp;' || temp_text == ''){
                 continue;
              }
              else{
                  p_arr.push(p_el);
              }
        }
        console.log(p_arr);
        

        $.each(p_arr, function (index,value) {
            
            if(next_tag_is_image_container){
                next_tag_is_image_container = false;
                return;
            }
            
            var found_img1 = $(p_arr[index]).find( "img, iframe, video, figure" );//finding any image
            var found_txt1 = $(p_arr[index]).text().trim();
            if(found_img1.length != 0 && found_txt1 == ''){//if image exists inside paragraph, with no sibling text
                return;
            }
                
                var p_el = value;
                var current_tag_name = $(p_el).prop('tagName');
                if(current_tag_name == 'IMG' || current_tag_name == 'IFRAME' || current_tag_name == 'VIDEO' || current_tag_name == 'FIGURE'){
                    return;
                }
              
              
                  p_tag_traverse_cnt++;
                  var next_of_p = p_arr[index+1];
                  var next_tag = $(next_of_p).prop('tagName');
                  
                  
                  if(p_tag_traverse_cnt == 3){
                      //If next element is UL, then add subscription box after UL
                      
                      //if next element is image or video, add the box after 3rd paragraph
                      
                      if(next_tag == 'IMG' || next_tag == 'IFRAME' || next_tag == 'VIDEO' || next_tag == 'FIGURE'){
                          //Check if image is not right aligned
                          var img_width = $(next_of_p).width();
                          
                          if(img_width > cont_width){//If image is not right aligned
                              next_tag_is_image_container = true;
                                return;
                          }
                          
                          
                      }
                      //Check if image or video exist as a child element
                      var found_in_child = $( next_of_p ).find( "img, iframe, video, figure" );
                      //console.log(found_in_child[0].width);
                      //console.log(found_in_child);
                      if(found_in_child.length != 0){
                             var img_width = found_in_child[0].width;
                             console.log(img_width+" "+cont_width);
                          if(img_width > cont_width){//If image is not right aligned
                              next_tag_is_image_container = true;
                                return;
                          }
                          
                      }
                      
                      if(next_tag == 'UL' && current_tag_name != 'UL'){
                          last_p_tag = next_of_p;
                          return false;    
                      }
                      else{
                          last_p_tag = p_el;
                          return false;    
                      }
                      
                  }    
                  if(p_tag_traverse_cnt > 3){
                       //If next element is UL, then add subscription box after UL
                      if(next_tag == 'UL' && current_tag_name != 'UL'){
                          last_p_tag = next_of_p;
                          return false;     
                      }
                      else{
                          last_p_tag = p_el;
                          return false;   
                      }
                  }
              
        });
        
        
        if(last_p_tag != ''){
            $( last_p_tag ).after('<div style="clear:both;"></div>',$('.subscribe-form-inner'));
        }
        // $( ".entry-content p:last-child" ).before($('.subscribe-form-inner'));
        
    });
    $('a').each(function() {
        if(this.id == 'share_btn'){
            return;
        }
        var a = new RegExp('/' + window.location.host + '/');
        if(!a.test(this.href)) {
            $(this).click(function(event) {
                event.preventDefault();
                event.stopPropagation();
                window.open(this.href, '_blank');
            });
        }
     });
     $('.comment-form-cookies-consent input[type=checkbox]').prop('checked','checked');
     //$('.form-submit input[type=submit]').after( '<img class="ajax-loader" style="display:none;" src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/backgrounds/ajax-loader.gif" alt="Sending ...">' );
     //Hide manage subscription link
     
     if($('.subscribe-to-comments input[type=checkbox]').length == 0){
         $('.subscribe-to-comments').hide();
     }
     
          $('.form-submit input[type=submit]').attr('disabled',true);
          function enableCommentBtn(){
         $('.form-submit input[type=submit]').attr('disabled',false);
     }
     function disableCommentBtn(){
         $('.form-submit input[type=submit]').attr('disabled',true);
     }
    </script>
<div id="search-result-continer" style="display:none;min-height: 343px;">
    <!--<div id="search-result-heading" class="container-fluid container-breadcrumb"  data-aos="fade-in" style="display:none;">
       <div class="container-lg">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="https://blog.paloaltonetworks.com">Palo Alto Networks</a></li>
              <li class="breadcrumb-item search-term"></li>
          </ol>
        </nav>
       </div>
    </div>-->
    <div class="container-fluid container-feed-cards">
        <div class="container-lg">
            <div class="row row-feed">
                <div class="col col-feed">
                    
                    <div id="ajax_loader" class="text-center pb-40 pt-40">
                  <span>Loading...</span>
			</div>
      <div id="notfound2" class="text-center pt-40 pb-40" style="display: none;">Sorry, no results were found.</div>
      
                    <div class="row row-feed articles_container CoveoResultList" data-layout="list" data-wait-animation="fade" data-fields-to-include="@articlecategory, @articleauthor, @articlepublishedtime, @articlecategory, @articleauthorlink, @articledescription, @articlepostimage, @articlepublishedtimestring, @articleauthorimagelink, @articlepostid, @articlepostlength, @articlecategorylink, @uri" data-result-container-selector='#test_id' id="test_id">
                        <script id="customTemplate" type="text/underscore" class="result-template">
            <% JSON.stringify(raw) %>
              <article data-article-id="<% if(typeof raw.articlepostid !== "undefined") { print(raw.articlepostid); } %>" class="feed-card h-100 pan-coveo-search-list">
                <%if (typeof raw.articlepostimage =='undefined') { 
                    raw.articlepostimage = 'https://blog.paloaltonetworks.com/wp-content/uploads/2016/11/blog-generic-banner-1.jpg';
                 } %>
                        
                <%if (typeof raw.articlepostimage !='undefined') { %> 
                <div onclick="location.href='<%= raw.uri %>'" class="feed-card-thumbnail" style="background-image: url(<%= raw.articlepostimage %>);">
                <% if(typeof raw.articlepostid !== "undefined") { %>
                <!--<div class="total_number_view left-bottom"><span class="people-reacted<% if(typeof raw.articlepostid !== "undefined") { print(raw.articlepostid); } %>">#</span> people reacted</div>-->
                <% } %>
                  
                </div>
                <% } %>

                <div class="feed-card-content">
                <p class="label">
                <%  _.each(raw.articlecategory,function(item,key,list) { %> <a <% if(typeof raw.articlepostid == "undefined"){print(' target="_blank"');} %>  href="<% if(typeof raw.articleauthorimagelink !== "undefined"){ print(raw.articlecategorylink[key]); } else{ print("#");}  %>" class="author url fn" rel="author"><%= item %></a><%if (key+1 < raw.articlecategory.length) { %>,<%  } %><%  }); %>
                            </p>
                  <h3><a <% if(typeof raw.articlepostid == "undefined"){print(' target="_blank"');} %> class="CoveoResultLink"><% var title_article = title.substr(0,75); print(title_article); var title_length = title.length; if(title_length > 75){print("...")} %></a></h3>
                  </div>
                  
                  <div class="feed-card-metadata">
			<div class="metadata-thumbnail">
			<div class="metadata-thumbnail-author">
	  		<img src="<% if(typeof raw.articleauthorimagelink !== "undefined"){ var image_link = raw.articleauthorimagelink[0]; if(image_link.indexOf("unit42.paloaltonetworks.com") != -1 ){ print("https://blog.paloaltonetworks.com/wp-content/themes/PaloAltoNetworksBlog/dist/images/unit42-logo1.jpg");} else{ print(image_link);} }else{ print("https://blog.paloaltonetworks.com/wp-content/uploads/2016/10/Social_BlogIcon_10.13.16.png"); } %>" width="75" height="75" alt="Avatar" class="avatar avatar-75 wp-user-avatar wp-user-avatar-75 photo avatar-default">			</div>
		</div>
		
		<div class="metadata-author">
                    <span class="author-name">
				By <%  _.each(raw.articleauthor,function(item,key,list) { %> <a <% if(typeof raw.articlepostid == "undefined"){print(' target="_blank"');} %> title="Posts by <%= item %>" href="<%= raw.articleauthorlink[key] %>" class="author url fn" rel="author"><%= item %></a><%if (key+1 < raw.articleauthor.length) { %><%if (key+1 == raw.articleauthor.length-1) { %> and <% } else { %>,<% } } %><%  }); %>                        <br>
                        <time datetime="<%= raw.articlepublishedtimestring %>"><%= raw.articlepublishedtimestring %></time>
                        <br>
                       <% if(typeof raw.articlepostlength !== "undefined"){ print(Math.ceil(raw.articlepostlength/200) + " min. read"); } %>
                    
                    </span>
		</div>
    <div class="metadata-likes ldc-ul_cont idc_ul_cont_not_liked" onclick="<%  print("alter_ul_post_values(this,'"+ raw.articlepostid +"','like')"); %>">
        
        <svg class=" " width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M4.74998 15.9999H2.49999C2.10217 15.9999 1.72064 15.8419 1.43934 15.5606C1.15803 15.2793 1 14.8977 1 14.4999V9.24995C1 8.85213 1.15803 8.4706 1.43934 8.18929C1.72064 7.90799 2.10217 7.74996 2.49999 7.74996H4.74998M9.99994 6.24997V3.24999C9.99994 2.65325 9.76289 2.08096 9.34094 1.65901C8.91898 1.23705 8.34669 1 7.74996 1L4.74998 7.74996V15.9999H13.2099C13.5717 16.004 13.9227 15.8772 14.1983 15.6429C14.474 15.4086 14.6557 15.0826 14.7099 14.7249L15.7449 7.97496C15.7775 7.75997 15.763 7.54047 15.7024 7.33165C15.6418 7.12283 15.5365 6.92968 15.3938 6.7656C15.2511 6.60151 15.0745 6.47041 14.8761 6.38138C14.6777 6.29234 14.4623 6.2475 14.2449 6.24997H9.99994Z" stroke="#727272" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                                <span class="<%  print("article-like-id"+raw.articlepostid);  %>"></span></span>
        
    </div>
	
</div>
              </article>
          </script>
          
                </div>     
                      <div class="col">
	
          <div class="loadmore text-center loadmore_main" style="display: none;">
      <button type="button" class="btn  load_more_btn" data-firstres="0">Load more</button>
    </div>
                    </div>
                      <div class="container" style="display: none;">
  
               

    <!-- Each DOM element with a class starting with "coveo-" (lowercase) is for CSS or alignment purpose only. -->
    <div class='coveo-search-section'>
      <div class="coveo-results-column">
        <!--selected breadcrumb-->
        <div class="CoveoBreadcrumb">
          <div class="coveo-breadcrumb-clear-all" title="Clear All Filters" tabindex="0">
            <div class="coveo-icon coveo-breadcrumb-icon-clear-all"></div>
            <div>Clear </div>
          </div>
        </div>
        <span class="CoveoSort coveo-sort-selection" data-sort-criteria="@articlepublishedtime descending" data-caption="Date"></span>
        <div class="coveo-results-header">
          <div class="coveo-summary-section">
            <span class="CoveoQuerySummary"></span>
          </div>
        </div>
      </div>
    </div>
                      </div>
      
          
            </div>
        </div>            
    </div>
</div>
</div>

<script type="text/javascript">
    document.write(str_subscription);
</script>
<section class="pan-mega-footer">
    <div class="container">
        <div class="row pan-mega-footer-links">
            <div class="col-xs-12 col-sm-4 col-md-3">
                <div class="footerTitle1 title baseComponent parbase">
                    <p>Popular Resources</p>
                </div>
                <div class="footerList1 list baseComponent parbase">
                    <ul class=" list-unstyled">
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Blog" href="https://blog.paloaltonetworks.com/">Blog</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Careers" href="https://jobs.paloaltonetworks.com/">Careers</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Communities" href="https://www.paloaltonetworks.com/communities">Communities</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Content Library" href="https://www.paloaltonetworks.com/resources">Content Library</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Cyberpedia" href="https://www.paloaltonetworks.com/cyberpedia">Cyberpedia</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Event Center" href="https://events.paloaltonetworks.com">Event Center</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Investors" href="https://investors.paloaltonetworks.com/investor-relations/overview/default.aspx">Investors</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Tech Docs" href="https://docs.paloaltonetworks.com/">Tech Docs</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Unit 42" href="https://unit42.paloaltonetworks.com/">Unit 42</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Popular Resources:Sitemap" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-xs-12 col-sm-4 col-md-3">
                <div class="footerTitle2 title baseComponent parbase">
                    <p>Legal Notices</p>
                </div>
                <div class="footerList2 list baseComponent parbase">
                    <ul class=" list-unstyled">
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Legal Notices:Privacy" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Legal Notices:Trust Center" href="https://www.paloaltonetworks.com/legal-notices/trust-center">Trust Center</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Legal Notices:Terms of Use" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a>
                        </li>
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Legal Notices:Documents" href="https://www.paloaltonetworks.com/legal">Documents</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-xs-12 col-sm-4 col-md-3">
                <div class="footerTitle3 title baseComponent parbase">
                    <p>Account</p>
                </div>
                <div class="footerList3 list baseComponent parbase">
                    <ul class=" list-unstyled">
                        <li>
                            <a class="" data-page-track="true" data-page-track-value="footer:Account:Manage Subscriptions" href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a>
                        </li>
                    </ul>
                </div>
                <div class="vulnerabilityHtml html baseComponent parbase">
                    <div style="margin-top: 30px">
                        <a href="https://www.paloaltonetworks.com/security-disclosure" style="color: #C63F24; font-family: Arial,sans-serif; font-size: 14px; font-style: normal; font-weight: normal; line-height: normal">Report a Vulnerability</a>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-3 footer-social-col">
                <div class="content">                
                    <ul class="list-inline">
                        <li class="list-inline-item">
                            <a href="https://www.facebook.com/PaloAltoNetworks/" target="_blank"><img alt="Facebook" class="lozad" data-loaded="true" data-src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Facebook-black.svg" src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Facebook-black.svg"></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://www.linkedin.com/company/palo-alto-networks" target="_blank"><img alt="Linkedin" class="lozad" data-loaded="true" data-src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Linkedin-black.svg" src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Linkedin-black.svg"></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://twitter.com/PaloAltoNtwks" target="_blank"><img alt="Twitter" class="lozad" data-loaded="true" data-src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Twitter-black.svg" src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Twitter-black.svg"></a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://www.youtube.com/user/paloaltonetworks" target="_blank"><img alt="Youtube" class="lozad" data-loaded="true" data-src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Youtube-black.svg" src="https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/svg/Youtube-black.svg"></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
<footer class="pan-footer">
    <div class="container">
        <span><p>&copy; 2020 Palo Alto Networks, Inc. All rights reserved.<br></p>
        </span>
    </div>
</footer>
<div class="CoveoSearchbox" data-enable-search-as-you-type="false" data-enable-omnibox="true" data-omnibox-timeout="1000" data-placeholder="Search the blog" data-enable-query-suggest-addon="false" data-trigger-query-on-clear="true" id="pan-coveo-input" style="display: none;"></div>



<script type="text/javascript">
    jQuery('body').attr('data-pipeline', "New Research Center Pipeline");
    var timerIsCoveoDefined = '';
    var resultTotalCount;
    //var root = document.getElementById('coveo-container');
    var root = document.body;
    var isloadCoveoLibraryCalled = false;
    var screenwidth = window.screen.width;
    var isIE11 = !!navigator.userAgent.match(/Trident.*rv\:11\./);
    var topSearch = true;
    //Coveo code
    function loadCoveoLibrary() {
        if (isloadCoveoLibraryCalled) {
            return;
        }
        isloadCoveoLibraryCalled = true;
        $.getScript("https://static.cloud.coveo.com/searchui/v2.3679/js/CoveoJsSearch.Lazy.min.js");
        timerIsCoveoDefined = setInterval(isCoveoDefined, 1000);
    }
    function isCoveoDefined() {
        if (typeof Coveo !== 'undefined') {
            console.log("Coveo object is now defined.")
            executeCoveoSearch();
            clearInterval(timerIsCoveoDefined);
            $('#postSearch1, #postSearch2').attr('title', '');
            $('#postSearch1, #postSearch2').prop("readonly", false);
            $('.dropdown-menu a').css('pointer-events','auto');
        }
    }
    function executeCoveoSearch() {

        var settings = {
            "async": false,
            "url": "https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/coveosearch.getaccesstoken.php",
            //"url": "https://www.paloaltonetworks.com/apps/pan/public/coveosearch.getaccesstoken.json",
            "method": "GET",
        }


        jQuery.ajax(settings).done(function (response) {

            Coveo.SearchEndpoint.endpoints['default'] = new Coveo.SearchEndpoint({
                restUri: 'https://platform.cloud.coveo.com/rest/search',
                queryStringArguments: {
                    organizationId: 'paloaltonetworksintranet'                    
                },
                accessToken: response.token
            });
            Coveo.$$(root).on("querySuccess", function (e, data) {
                //console.log(data.query.q);
                if(!$('#searching').val()){
                    topSearch = false;
                }
                
                if(topSearch){
                    $([document.documentElement, document.body]).animate({
                        scrollTop: 0 
                    }, 1000);
                }
                
                if(topSearch){
                    $('nav.navbar li a.active').removeClass('active');
                }
                resultTotalCount = data.results.totalCount;
                //document.title = "Palo Alto Networks Blog";
                /*
                if(resultTotalCount > 0){
                    $('#search-result-heading .search-term').text(capitalizeFirstLetter(data.query.q));
                    $('#search-result-heading').show();
                }
                else{
                    $('#search-result-heading').hide();
                    $('#search-result-heading .search-term').text('');
                }
                */

            });
            Coveo.$$(root).on("newResultsDisplayed", function (e, args) {
                $('#ajax_loader').hide();
                $('#notfound2').hide();
                $('.load_more_btn').html('Load more');
                $('.load_more_btn').prop('disabled', false);
                $('.CoveoResult').addClass('col-xs-12 col-sm-6 col-md-6 col-lg-4 col-xl-4 col-feed-card grid-item');
                var article_ids = new Array();
                jQuery.each(jQuery('.pan-coveo-search-list'), function (i) {
                    var article_id_tmp = $(this).data("article-id");
                    if (article_id_tmp != '' && !jQuery(this).hasClass('num-like-retrieved')) {
                        article_ids.push(article_id_tmp);
                    }
                    if (article_id_tmp != '') {
                        //If this article is liked, make the thumb icon to blue
                        var article_liked_list = [];
                        var like_found = $.inArray(article_id_tmp, article_liked_list);
                        if (like_found != -1) {
                            $(this).find('.ldc-ul_cont').find('svg').children('path').attr('stroke', '#FF2E00');
                            $(this).find('.ldc-ul_cont').removeClass('idc_ul_cont_not_liked');
                        }
                    }
                });
                if (article_ids.length > 0) {
                    var saveData = $.ajax({
                        type: 'POST',
                        url: wp_vars.ajax_url,
                        data: {action: 'fetch_total_article_likes', article_ids_arr: JSON.stringify(article_ids)},
                        dataType: "json",
                        success: function (resultData) {
                            //var article_likes = JSON.parse(resultData);
                            jQuery.each(article_ids, function (i, val) {
                                $('.article-like-id' + val).text(resultData[val][0]);
                                //$('.people-reacted'+val).text(resultData[val][1]);
                                $('.article-like-id' + val).closest(".pan-coveo-search-list").addClass('num-like-retrieved');
                            });
                        }
                    });
                }
                //console.log($('.CoveoResult').length +'|'+ resultTotalCount);
                //console.log(Coveo.state(root, 'first'));
                if ($('.CoveoResult').length >= resultTotalCount) {
                    $('.load_more_btn').hide();
                } else {
                    $('.load_more_btn').show();
                }
                if (resultTotalCount <= 0) {
                    $('#notfound2').show();
                } else {
                    $('#notfound2').hide();
                }
                
                if (jQuery('.magic-box-input input').val() || $('.CoveoResult').length >= 1) {
                    if(topSearch){
                        jQuery('#main-container').hide();
                        $('#inner_cards').show();
                        jQuery('.loadmore_main2').hide();
                        jQuery('#search-result-continer').show();
                        jQuery('.loadmore_main').show();
                        $('#main-container .container-feed-cards .container-lg').removeAttr('style');
                        $('#search-result-continer .container-feed-cards .container-lg').removeAttr('style');
                    }
                    else{
                        jQuery('#main-container').show();
                        $('#inner_cards').hide();
                        jQuery('.loadmore_main2').hide();
                        jQuery('#search-result-continer').show();
                        jQuery('.loadmore_main').show();
                        $('#main-container .container-feed-cards .container-lg').attr('style','padding-bottom: 0;');
                        $('#search-result-continer .container-feed-cards .container-lg').attr('style','padding-top: 0;');
                    }
                } else {
                    jQuery('#search-result-continer').hide();
                    jQuery('.loadmore_main').hide();
                    $('#inner_cards').show();
                    jQuery('#main-container').show();
                    jQuery('.loadmore_main2').show();
                }
            });
            //Coveo.state(root, 'numberOfResults',9);
            //Coveo.state(Coveo.$$(document).find(".magic-box-input input"), 'f:@articlecategory' , 'Secure the Cloud');
            Coveo.SearchInterface.options.autoTriggerQuery.defaultValue = false;
            Coveo.init(root);
        });
    }

    $('body').on('blur', '.magic-box-input input, #postSearch1', function (e) {
        var has_hash = false;
        if (window.location.hash.length) {
            has_hash = true;
        }
        var to_append = '';
        if (has_hash) {
            to_append = window.location.hash.replace('#', '');
            to_append = '#' + to_append;
        }
        window.history.replaceState(null, null, "?search_field=" + $(this).val() + to_append);
    });

    $('.load_more_btn').on('click', function () {
        //Coveo.SearchEndpoint.endpoints["default"].options.queryStringArguments.numberOfResults = 8;
        load_more_clicked = true;

        var this_btn = $(this);
        $(this).addClass('is-clicked');
        $(this).html('Loading...');
        $(this).prop('disabled', true);
        //jQuery('.articles_container').masonry('reloadItems').masonry();
        //Coveo.SearchEndpoint.endpoints["default"].options.queryStringArguments.numberOfResults = 8;
        //Coveo.state(root, 'firstResult',$('.CoveoResult').length - 1);
        Coveo.$('.CoveoResultList').coveo('displayMoreResults', 9);
        //Coveo.SearchEndpoint.endpoints["default"].options.queryStringArguments.numberOfResults = 9;
        setTimeout(function () {
            this_btn.removeClass('is-clicked');
        }, 1900);
    });
    var interval;
    var timer2;

    if (isIE11) {
        executeCoveoSearch();
    }




    var captcha_rendered = false;
    var subscribeSuccess = false;

    jQuery('body').on('change paste keyup', '.business_email_bot', function () {
        jQuery(this).closest('form').find('.google-recapth').removeClass('d-none');
    });

    $('body').on('mouseover', '.idc_ul_cont_not_liked', function (e) {
        $(this).find('svg').children('path').attr('stroke', '#FF2E00');
        //$(this).attr('src','https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/blue-like-icon.png');
    });
    $('body').on('mouseout', '.idc_ul_cont_not_liked', function (e) {
        $(this).find('svg').children('path').attr('stroke', '#727272');
        //$(this).attr('src','https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/images/grey-like-icon.png');
    });




    $(document).ready(function () {
        getSerializedTracking("Unit42_Subscribe");

    });
    $('body').click(function () {
        $('.CoveoDidYouMean').hide();
    });

    jQuery('body').on('change paste keyup', '.business_email', function () {
        //console.log($('#captcha_container2').children().length);
        if ($('#captcha_container').length == 1 && $('#captcha_container').children().length == 0) {
            console.log("cap1");
            var loadCaptcha = function () {
                captchaContainer = grecaptcha.render('captcha_container', {
                    'sitekey': '6LeyHGkUAAAAAEwfqwKWxNqdht3xjSNf-j3bK7l2',
                    'callback': function (response) {
                        $("form[name='Unit42_Subscribe'] button[type='submit']").prop('disabled', false);
                        subscribeSuccess = true;
                    },
                    'expired-callback' : function(){
                        $("form[name='Unit42_Subscribe'] button[type='submit']").prop('disabled', true);
                        subscribeSuccess = false;
                    }
                });
            }
            loadCaptcha();
        }
        /*
        if ($('#captcha_container2').length == 1 && $('#captcha_container2').children().length == 0) {
            console.log("cap2");
            var loadCaptcha2 = function () {
                captchaContainer = grecaptcha.render('captcha_container2', {
                    'sitekey': '6LeyHGkUAAAAAEwfqwKWxNqdht3xjSNf-j3bK7l2',
                    'callback': function (response) {
                        $("form[name='contact_sales_modal'] input[type='submit']").prop('disabled', false);
                        subscribeSuccess = true;
                    }
                });
            }

            loadCaptcha2();
        }
        */
        setTimeout(function () {
            jQuery('#row-recatcha').removeClass('d-none');
            //jQuery('.articles_container').masonry('layout');
        }, 50);
    });


    jQuery('body').on('submit', 'form.subscribe-form', function () {
        var success = true;
        var form = jQuery(this);
        var mail = form.find('input[name="Email"]');
        if (mail.val() === '' || !isEmail(mail.val())) {
            mail.closest("form").addClass('has-error');
            success = false;
        } else {
            mail.closest("form").removeClass('has-error');
        }

        if (success && subscribeSuccess) {
            $.ajax({
                type: 'POST',
                url: form.attr('action'),
                data: form.serialize(),
                success: function (msg) {
                    form.html('<p style="color: #0c6;">You have been successfully subscribed</p>');
                    //masonry.masonry('layout');
                }
            });
        }
        return false;
    });


    function isEmail(email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    }


    $(document).ready(function () {
        //$('body').attr('data-results-per-page', '9');
        $("#dropdownMenuButton").click(function(){
            if (typeof Coveo === 'undefined') {
                //$(".dropdown-menu a").attr('disabled',"disabled");
                $('.dropdown-menu a').css('pointer-events','none');
                loadCoveoLibrary();
            }
        });
        
        $(".dropdown-menu a").click(function(e){
            $(this).parents(".dropdown").find('.btn').html($(this).text());
            $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
            topSearch = false;
            e.preventDefault(); 
        });
        
        /**
         $('img').each(function() {
         var path = $(this).attr('src');
         $(this).attr('src', path.replace("http://blog-localhost.paloaltonetworks.com/wp-content/upload", "https://blog.paloaltonetworks.com/wp-content/upload"));
         });
         $('figure').each(function() {
         var path = $(this).attr('style');
         if (typeof path !== 'undefined'){
         $(this).attr('style', path.replace("http://blog-localhost.paloaltonetworks.com/wp-content/upload", "https://blog.paloaltonetworks.com/wp-content/upload"));
         }
         });
         * 
         */
        
        $(".pan-page-alert-close").click(function(){
            $("#nav-mobile").css("top", "72px");
          });
          $("#feed-clear").click(function(){
              //$('#mostRecentTab').trigger('click');
            $('#postSearch2').val('');
            $('#sec-search-clear').hide();
            jQuery('#search-result-continer').hide();
            jQuery('.loadmore_main').hide();
            $('#inner_cards').show();
            jQuery('#main-container').show();
            jQuery('.loadmore_main2').show();
            $('#main-container .container-feed-cards .container-lg').removeAttr('style');
            
            
            $('.col-feed-filter #dropdownMenuButton').val("Most Recent");
            $('.col-feed-filter #dropdownMenuButton').html("Most Recent");
            $('#mostRecentTab').addClass('coveo-selected');
            $('#mostPopularTab').removeClass('coveo-selected');
         
            
          });
          

        $('#postSearch2').focus(function () {
            if (typeof Coveo === 'undefined') {
                //$('#postSearch1, #postSearch2').attr('title', 'Loading...please wait');
                $('#postSearch1, #postSearch2').prop("readonly", true);
                loadCoveoLibrary();
            }
        });
        $('body').on('keyup', '#postSearch1, #postSearch2', function (e) {
            //cur_search_txt = jQuery('.magic-box-input input').val(); 
            if(this.id == 'postSearch2'){
                topSearch = false;
            }
            else{
                topSearch = true;
            }
            var typed_text;
            if(topSearch){
                typed_text = $('#postSearch1').val();
            }
            else{
                typed_text = $('#postSearch2').val();
                if((typed_text.length > 0) ){
                    $('#sec-search-clear').show();
                    //$('#feed-search').prop('disabled', false);
                }
                else{
                    $('#sec-search-clear').hide();
                    //$('#feed-search').prop('disabled', true);
                }
            }
            
            
            $('.magic-box-input input').val(typed_text);
            if ((typed_text.length > 0) && e.keyCode === 13) {
                if(topSearch && !$('#searching').val()){
                    location.href='https://blog.paloaltonetworks.com?search_field='+typed_text;
                    return;
                }
                //enterKeyPressed = true;
                if (screenwidth < 992) {
                    if(topSearch){
                    mobileToggle();
                }
                }
                $('.CoveoSearchButton').click();
            }
        });
    });
</script>


    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://blog.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#FA582D');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
    <script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/blog.paloaltonetworks.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"}};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/plugins/contact-form-7/includes/js/scripts.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/popper.min.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/bootstrap.min.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/aos.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wp_vars = {"ajax_url":"https:\/\/blog.paloaltonetworks.com\/wp-admin\/admin-ajax.php"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/masonry2.js?v2'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-content/themes/panwblog2020/dist/scripts/jquery.cookie.js'></script>
<script type='text/javascript' src='https://blog.paloaltonetworks.com/wp-includes/js/wp-embed.min.js'></script>
  </body>
</html>

