
<!doctype html>
<html >
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/favicon-16x16.png">
	<link rel="manifest" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/site.webmanifest">
	<link rel="mask-icon" href="https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/favicon/safari-pinned-tab.svg" color="#000000">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#000">
  <title>UPS: Observations on CVE-2015-3113, Prior Zero-Days and the Pirpi Payload</title>
<link rel="alternate" hreflang="en" href="https://unit42.paloaltonetworks.com/ups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload/" />

<!-- This site is optimized with the Yoast SEO plugin v12.6.2 - https://yoast.com/wordpress/plugins/seo/ -->
<meta name="description" content="Unit 42 observes the APT3 group using the name UPS, CVE-2015-3113, prior zero-days and the Pirpi payload."/>
<meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
<link rel="canonical" href="https://unit42.paloaltonetworks.com/ups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="UPS: Observations on CVE-2015-3113, Prior Zero-Days and the Pirpi Payload" />
<meta property="og:description" content="Unit 42 observes the APT3 group using the name UPS, CVE-2015-3113, prior zero-days and the Pirpi payload." />
<meta property="og:url" content="https://unit42.paloaltonetworks.com/ups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload/" />
<meta property="og:site_name" content="Unit42" />
<meta property="article:tag" content="ActionScript" />
<meta property="article:tag" content="Adobe Flash" />
<meta property="article:tag" content="APT3" />
<meta property="article:tag" content="AutoFocus" />
<meta property="article:tag" content="internet explorer" />
<meta property="article:tag" content="Operation Clandestine Wolf" />
<meta property="article:tag" content="Pirpi" />
<meta property="article:tag" content="shellcode" />
<meta property="article:tag" content="steganography" />
<meta property="article:tag" content="UPS" />
<meta property="article:tag" content="WildFire" />
<meta property="article:tag" content="zero-days" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2015-07-27T10:50:42+00:00" />
<meta property="article:modified_time" content="2018-11-01T09:48:58+00:00" />
<meta property="og:updated_time" content="2018-11-01T09:48:58+00:00" />
<meta property="og:image" content="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi1-500x299.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Unit 42 observes the APT3 group using the name UPS, CVE-2015-3113, prior zero-days and the Pirpi payload." />
<meta name="twitter:title" content="UPS: Observations on CVE-2015-3113, Prior Zero-Days and the Pirpi Payload" />
<meta name="twitter:image" content="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi1-500x299.png" />
<!-- / Yoast SEO plugin. -->

<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Unit42 &raquo; UPS: Observations on CVE-2015-3113, Prior Zero-Days and the Pirpi Payload Comments Feed" href="https://unit42.paloaltonetworks.com/ups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload/feed/" />
<meta property="og:likes" content="0"/>
<meta property="og:readtime" content="10"/>
<meta property="og:views" content="13,065"/>
<meta property="og:date_created" content="July 27, 2015 at 1:50 PM"/>
<meta property="og:post_length" content="2697"/>
<meta property="og:category" content="Malware"/>
<meta property="og:category" content="Threat Prevention"/>
<meta property="og:category" content="Unit 42"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/malware-2/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/threat-prevention-2/"/>
<meta property="og:category_link" content="https://unit42.paloaltonetworks.com/category/unit42/"/>
<meta property="og:author" content="Robert Falcone"/>
<meta property="og:author" content="Richard Wartell"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/robertfalcone/"/>
<meta property="og:authorlink" content="https://unit42.paloaltonetworks.com/author/richard-wartell/"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<meta property="og:author_image_link" content="https://unit42.paloaltonetworks.com/wp-content/uploads/2018/11/unit-news-meta.svg"/>
<script type="application/ld+json">{"@context":"https:\/\/schema.org","@type":"BlogPosting","headline":"UPS: Observations on CVE-2015-3113, Prior Zero-Days and the Pirpi Payload","name":"UPS: Observations on CVE-2015-3113, Prior Zero-Days and the Pirpi Payload","description":"A June 23 FireEye blog post titled \u201cOperation Clandestine Wolf\u201d discussed a cyber espionage group, known as APT3, that had been exploiting a zero-day vulnerability in Adobe Flash. Unit 42 also tracks the APT3 group using the name UPS, which is an intrusion set with Chinese origins that is known for having early access to...","url":"https:\/\/unit42.paloaltonetworks.com\/ups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload\/","mainEntityOfPage":"https:\/\/unit42.paloaltonetworks.com\/ups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload\/","datePublished":"July 27, 2015","articleBody":"A June 23 FireEye blog post titled \u201cOperation Clandestine Wolf\u201d discussed a cyber espionage group, known as APT3, that had been exploiting a zero-day vulnerability in Adobe Flash. Unit 42 also tracks the APT3 group using the name UPS, which is an intrusion set with Chinese origins that is known for having early access to zero-day vulnerabilities and delivering a backdoor called Pirpi.\r\n\r\nThe UPS group has exploited several zero-day vulnerabilities, most recently using the zero-days released in the Hacking Team breach that we discussed in our July 10 blog post, \u201cAPT Group UPS Targets US Government with Hacking Team Flash Exploit\u201d. However, the most recent original zero-day released by this group is tracked by CVE-2015-3113, which has similarities to the once zero-day vulnerabilities CVE-2014-1776 and CVE-2014-6332 exploited by UPS in May and November 2014, respectively. We\u2019ll discuss here the similarities observed between the various components used to exploit these two vulnerabilities, specifically focusing on the malicious Flash files and the payloads delivered.\r\nMalicious Flash Files\r\nRecent zero-day vulnerabilities exploited by UPS exploit or leverage Adobe Flash to exploit other applications on the system. Unit 42 recently analyzed malicious Flash files that exploited CVE-2015-3113, which was a zero-day vulnerability in Adobe Flash that was patched on June 23, 2015.. During the analysis, we noticed similarities between this malicious Flash file, those that UPS used to exploit CVE-2014-1776, and the proof-of-concept code for CVE-2014-6332, albeit these two Flash files were used to exploit zero-day vulnerabilities in Internet Explorer.\r\nOverlaps within ActionScript\r\nUnit 42 analyzed the ActionScript within malicious Flash files created by UPS that exploited CVE-2014-1776 and CVE-2015-3113 and discovered shared code between the two. First, both ActionScripts contain a function named \u201chexToIntArray\u201d, which Figure 1 displays side-by-side for comparison. Not only do these files contain the same function name, but they also share the same exact operation codes (opcodes) to carry out its functionality. The existence of the hexToIntArray function in the CVE-2015-3113 sample is rather interesting, as it is never called or used within the ActionScript. We believe that the threat actor used the CVE-2014-1776 ActionScript as the basis for the CVE-2015-3113 file and forgot to remove the unused hexToIntArray function.\r\n\r\n\r\n\r\nCVE-2014-1776\r\nCVE-2015-3113\r\n\r\n\r\nfunction private::hexToIntArray(String):__AS3__.vec::Vector.&lt;int&gt;\r\n{\r\n0\u00a0\u00a0\u00a0 getlocal0\r\n1\u00a0\u00a0\u00a0 pushscope\r\n2\u00a0\u00a0\u00a0 pushnull\r\n3\u00a0\u00a0\u00a0 coerce_a\r\n4\u00a0\u00a0\u00a0 setlocal2\r\n5\u00a0\u00a0\u00a0 getlocal1\r\n6\u00a0\u00a0\u00a0 getproperty\u00a0\u00a0\u00a0\u00a0 length\r\n8\u00a0\u00a0\u00a0 coerce_a\r\n9\u00a0\u00a0\u00a0 setlocal3\r\n10\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\r\n12\u00a0\u00a0 coerce_a\r\n13\u00a0\u00a0 setlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n15\u00a0\u00a0 getlex\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Vector\r\n17\u00a0\u00a0 getlex\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 int\r\n19\u00a0\u00a0 applytype\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 (1)\r\n21\u00a0\u00a0 getlocal3\r\n22\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 2\r\n24\u00a0\u00a0 divide\r\n25\u00a0\u00a0 construct\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 (1)\r\n27\u00a0\u00a0 coerce\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 __AS3__.vec::Vector.&lt;int&gt;\r\n29\u00a0\u00a0 setlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 5\r\n31\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\r\n33\u00a0\u00a0 coerce_a\r\n34\u00a0\u00a0 setlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 6\r\n36\u00a0\u00a0 jump\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 L1L2:\r\n40\u00a0\u00a0 label\r\n41\u00a0 \u00a0getlocal1\r\n42\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n44\u00a0\u00a0 callproperty\u00a0\u00a0\u00a0 http:\/\/adobe.com\/AS3\/2006\/builtin::charAt (1)\r\n47\u00a0\u00a0 getlocal1\r\n48\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n50\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1\r\n52\u00a0\u00a0 add\r\n53\u00a0\u00a0 callproperty\u00a0\u00a0\u00a0 http:\/\/adobe.com\/AS3\/2006\/builtin::charAt (1)\r\n56\u00a0\u00a0 add\r\n57\u00a0\u00a0 coerce_a\r\n58\u00a0\u00a0 setlocal2\r\n59\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 5\r\n61\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 6\r\n63\u00a0\u00a0 findpropstrict\u00a0 parseInt\r\n65\u00a0\u00a0 getlocal2\r\n66\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 16\r\n68\u00a0\u00a0 callproperty\u00a0\u00a0\u00a0 parseInt (2)\r\n71\u00a0\u00a0 setproperty\u00a0\u00a0\u00a0\u00a0 null\r\n73\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n75\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 2\r\n77\u00a0\u00a0 add\r\n78\u00a0\u00a0 coerce_a\r\n79\u00a0\u00a0 setlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n81\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a06\r\n83\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1\r\n85\u00a0\u00a0 add\r\n86\u00a0\u00a0 coerce_a\r\n87\u00a0\u00a0 setlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 6L1:\r\n89\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n91\u00a0\u00a0 getlocal3\r\n92\u00a0\u00a0 iflt\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 L2\r\n\r\n96\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 5\r\n98\u00a0\u00a0 returnvalue\r\n}\r\nfunction private::hexToIntArray(String):__AS3__.vec::Vector.&lt;int&gt;\r\n{\r\n0\u00a0\u00a0\u00a0 getlocal0\r\n1\u00a0\u00a0\u00a0 pushscope\r\n2\u00a0\u00a0\u00a0 pushnull\r\n3\u00a0\u00a0\u00a0 coerce_a\r\n4\u00a0\u00a0\u00a0 setlocal2\r\n5\u00a0\u00a0\u00a0 getlocal1\r\n6\u00a0\u00a0\u00a0 getproperty\u00a0\u00a0\u00a0\u00a0 length\r\n8\u00a0\u00a0\u00a0 coerce_a\r\n9\u00a0\u00a0\u00a0 setlocal3\r\n10\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\r\n12\u00a0\u00a0 coerce_a\r\n13 \u00a0\u00a0setlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n15\u00a0\u00a0 getlex\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Vector\r\n17\u00a0\u00a0 getlex\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 int\r\n19\u00a0\u00a0 applytype\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 (1)\r\n21\u00a0\u00a0 getlocal3\r\n22\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 2\r\n24\u00a0\u00a0 divide\r\n25\u00a0\u00a0 construct\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 (1)\r\n27\u00a0\u00a0 coerce\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 __AS3__.vec::Vector.&lt;int&gt;\r\n29\u00a0\u00a0 setlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 5\r\n31\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0\r\n33\u00a0\u00a0 coerce_a\r\n34\u00a0\u00a0 setlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 6\r\n36\u00a0\u00a0 jump\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 L1L2:\r\n40\u00a0\u00a0 label\r\n41\u00a0\u00a0 getlocal1\r\n42\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n44\u00a0\u00a0 callproperty\u00a0\u00a0\u00a0 http:\/\/adobe.com\/AS3\/2006\/builtin::charAt (1)\r\n47\u00a0\u00a0 getlocal1\r\n48\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n50\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1\r\n52\u00a0\u00a0 add\r\n53\u00a0\u00a0 callproperty\u00a0\u00a0\u00a0 http:\/\/adobe.com\/AS3\/2006\/builtin::charAt (1)\r\n56\u00a0\u00a0 add\r\n57\u00a0\u00a0 coerce_a\r\n58\u00a0\u00a0 setlocal2\r\n59\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 5\r\n61\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 6\r\n63\u00a0\u00a0 findpropstrict\u00a0 parseInt\r\n65\u00a0\u00a0 getlocal2\r\n66\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 16\r\n68\u00a0\u00a0 callproperty\u00a0\u00a0\u00a0 parseInt (2)\r\n71\u00a0\u00a0 setproperty\u00a0\u00a0\u00a0\u00a0 null\r\n73\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n75\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 2\r\n77\u00a0\u00a0 add\r\n78\u00a0\u00a0 coerce_a\r\n79\u00a0\u00a0 setlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n81\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 6\r\n83\u00a0\u00a0 pushbyte\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 1\r\n85\u00a0\u00a0 add\r\n86\u00a0\u00a0 coerce_a\r\n87\u00a0\u00a0 setlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 6L1:\r\n89\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 4\r\n91\u00a0\u00a0 getlocal3\r\n92\u00a0\u00a0 iflt\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 L2\r\n\r\n96\u00a0\u00a0 getlocal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 5\r\n98\u00a0\u00a0 returnvalue\r\n}\r\n\r\n\r\n\r\nFigure 1.\u00a0Side-by-side comparison of opcodes in hexToIntArray functions\r\nAlso, the Flash file exploiting CVE-2015-3113 had a main class named \"flappyMan\".\u00a0 This class name was also used in the Flash file that Unit 42 analyzed and discussed in its November 26, 2014 blog titled \u201cAddressing CVE-2014-6332 SWF Exploit\u201d, as well as the proof-of-concept (PoC) for CVE-2014-6332 that is now publicly available in exploit-related forums.\u00a0 According to FireEye's \"Operation Double Tap\", UPS exploited CVE-2014-6332 in its November 2014 attacks; however, UPS used a VBScript to exploit the vulnerability instead of a Flash file. While purely speculation, this overlap in class names between the CVE-2014-6332 PoC and the Flash file exploiting CVE-2015-3113 may suggest that UPS also used Flash files to exploit CVE-2014-6332.\r\nShellcode Similarities\r\nAs with most remote code execution vulnerabilities, UPS\u2019 malicious documents execute shellcode in the event of successful exploitation of either CVE-2014-1776 or CVE-2015-3113. The shellcode found in the UPS delivery documents exploiting both of these vulnerabilities are not the same, but have similarities worth noting.\r\n\r\nFirst, the delivery documents share the same technique of locating API functions, which involves using the rotate right (ror 7 to be specific) instruction on the function name in kernel32.dll and checking it with a specific value. The use of the same rotate right algorithm results in several common constants, such as 0xC917432 that both shellcodes use to locate LoadLibraryA. Second, both shellcodes use a similar method of creating the Unicode string \u201ckernel32.dll\u201d, seen in Figure 2. The shellcodes use the Unicode string and the same method to find the base address of the loaded kernel32.dll module from the LDR structures obtained from the process environment block (PEB). Third, both shellcodes have similar single byte XOR algorithms used to decrypt and later execute the functional payload.\r\n\r\n\r\nFigure 2.\u00a0Comparison of Instructions in UPS Shellcodes that Builds Kernel32.dll Unicode String\r\n\r\nSteganography to Conceal Payloads\r\nWhile analyzing the malicious Flash file exploiting CVE-2015-3113, Unit 42 discovered that the ActionScript loaded an animated GIF image. The malware author used steganography to embed an encrypted payload within this animated GIF image. The payload in the CVE-2014-1776 was also embedded within an animated GIF. Ultimately, the shellcode executed in the event of successful exploitation of either of these vulnerabilities decrypt and execute the embedded payload, as mentioned in the previous section. While the animated GIFs themselves are vastly different, as seen in Figure 3 and 4 (payloads removed), the use of steganography and animated images as the carrier of the payload is common between the two campaigns.\r\n\r\n\r\nFigure 3.\u00a0Animated GIF \u201cv.gif\u201d from UPS Campaign Exploiting CVE-2015-3113 (click to\u00a0see .gif)\r\n\r\nFigure 4.\u00a0Animated GIF \u201canyway.gif\u201d from UPS Campaign Exploiting CVE-2014-1776\r\n\r\nPayload Comparison\r\nWith the amount of overlap between the other components in these separate campaigns, we decided to compare the Pirpi payloads delivered by the UPS group using CVE-2014-1776 and CVE-2015-3113. From here on, we will refer to these two payloads as Pirpi.2014 (CVE-2014-1776) and Pirpi.2015 (CVE-2015-3113), whose details are listed in Table 1. Unit 42 discovered several similarities between the two Pirpi variants, as well as a few equally important differences, both of which are worth discussing. We also compared the Pirpi.2014 and Pirpi.2015 payloads to other known Pirpi samples in an attempt to determine which variant they most closely resemble.\r\n\r\n\r\n\r\nFile Name\r\nFile Type\r\nArchitecture\r\nSize\r\n\r\n\r\nMD5\r\nCompile Time\r\n\r\n\r\nSHA256\r\n\r\n\r\nIePorxyv.dll (Pirpi.2014)\r\nPE.DLL\r\nX86\r\n86016\r\n\r\n\r\nB48E578F030A7B5BB93A3E9D6D1E2A83\r\n04:29:14 00:44:04\r\n\r\n\r\n81BD203EF3924BF497E8824ED5F224561487258FF3D8EE55F1E0907155FD5333\r\n\r\n\r\n{CVE-2015-3113 payload} (Pirpi.2015)\r\nPE.DLL\r\nX86\r\n150528\r\n\r\n\r\n1B0E6BA299A522A3B3B02015A3536F6F\r\n06:07:15 01:51:27\r\n\r\n\r\n0649A3DD632CDE57BC2E97B814BE81A7F45454FED2A73800DE476AA75CDBE8CD\r\n\r\n\r\n\r\nTable 1.\u00a0File Details of Pirpi.2014 and Pirpi.2015 Samples\r\n\r\nSimilarities in C2 Communications\r\nBoth Pirpi variants perform an initial check to see if a configuration file exists at %APPDATA%\\vcl.tmp or %TEMP%\\vcl.tmp depending on the operating system. If it finds one, it decodes it and uses the configuration data it finds inside for C2 communication, otherwise it uses hardcoded C2 domains encoded inside the binary. The malware then creates threads to begin C2 communication.\r\n\r\nThe Pirpi.2014 and Pirpi.2015 payloads communicate with their C2 by issuing HTTP GET requests to the C2 domain hardcoded inside the payload or within its \u201cvcl.tmp\u201d configuration file. While the structure of the C2 URL differs between the two variants, both use the HTTP Cookie field to transmit data in encrypted form to the C2 domain. Figure 6 shows examples of C2 communications from Pirpi.2014 and Figure 7 shows communication with the C2 of Pirpi.2015 malware variants, both containing data within the Cookie field.\r\n\r\n\r\nFigure 5.\u00a0Pirpi.2014 C2 Communication using Cookie Field for Exfiltration\r\n\r\nFigure 6.\u00a0Pirpi.2015 C2 Communication using Cookie Field for Exfiltration\r\nThe GET request will return a web page that the malware will parse, specifically looking for encoded commands within two of the HTML tags.\r\nCommand Loop Overlap\r\nOnce the two Pirpi variants successfully communicate with their C2 server and parse the returned HTML for commands, Pirpi enters a command loop that processes the commands and carries out the respective activities. The command loop for the backdoor remains largely unchanged between Pirpi.2014 and Pirpi.2015 with only two of the commands differing between the two. Table 2 shows the commands that each malware can accept with only the 35 and 36 commands differing between the two Pirpi variants.\r\n\r\n\r\n\r\nValue\r\nPirpi.2014 Command\r\nPirpi.2015 Command\r\n\r\n\r\n1\r\nLaunch Process\r\n\r\n\r\n2\r\nProcess Listing\r\n\r\n\r\n3\r\nTerminate Process\r\n\r\n\r\n4\r\nDownload a file from the C2, launch it, and then delete it\r\n\r\n\r\n5\r\nExit the malware\r\n\r\n\r\n6\r\nSleep\r\n\r\n\r\n7\r\nUpdate C2 configuration and save it to %APPDATA%\\vcl.tmp\r\n\r\n\r\n8\r\nDownload a file, load it into memory, then delete the file\r\n\r\n\r\n9\r\nLoad a DLL from %APPDATA% and execute one of its exported functions\r\n\r\n\r\n10\r\nDo nothing\r\n\r\n\r\n11\r\nDo nothing\r\n\r\n\r\n12\r\nList all servers in the domain\r\n\r\n\r\n13\r\nGet network adaptor information\r\n\r\n\r\n14\r\nList TCP connection status (netstat)\r\n\r\n\r\n15\r\nRetrieve information about connected users\r\n\r\n\r\n16\r\nList servers in the primary domain\r\n\r\n\r\n17\r\nLocates DCs on a domain\r\n\r\n\r\n32\r\nDirectory listing\r\n\r\n\r\n33\r\nUpload a file to the C2\r\n\r\n\r\n34\r\nDelete file\r\n\r\n\r\n35\r\nCopy file and delete original\r\nCopy file\r\n\r\n\r\n36\r\nDownload and save file\r\nDo Nothing\r\n\r\n\r\n37\r\nEcho\r\n\r\n\r\n38\r\nExecute Process\r\n\r\n\r\n49\r\nGet location of configuration file and set as current working directory\r\n\r\n\r\n\r\nTable 2.\u00a0Commands Available within Pirpi.2014 and Pirpi.2015\r\n\r\nAnti-Disassembly\r\nThe UPS threat group is a fan of one anti-disassembly trick that can be seen in both Pirpi.2014 and Pirpi.2015. It plays upon the order IDA Pro disassembles instructions. As you can see in the code sample in Figure 6 from Pirpi.2014 there is a \u201cjump above\u201d instruction, followed by a \u201cjump below or equal\u201d instruction which just falls through to the next instruction. This fall-through code path will never get executed since the jump occurs if 0x58693C96 &gt; 0x0D7F31B4.\r\n\r\n\r\nFigure 7.\u00a0Code Showing Anti-Disassembly Technique used in Pirpi Tool\r\nIDA Pro\u2019s disassembly sequence follows the fall-through branch of conditional jumps first, and thus in the previous instruction sequence, IDA keeps disassembling one instruction after another. When IDA goes back to disassemble the jump target for 0x10009133, it finds it pointing to the middle of an instruction. This stops IDA from being able to draw function borders, view a function in graph mode, or decompile with Hex-Rays. To solve this, undefine all of the code that will not be executed, and define code starting from the target of the conditional branch (in this case 0x1000913E), as seen in Figure 7.\r\n\r\n\r\nFigure 8.\u00a0Fixing Anti-Disassembly Trick used by Pirpi Tool by Undefining Errant Instructions\r\nYou will now be able to create a function to improve your ability to do analysis. To make this easier, use an IDA Pro script to fix these anti-disassembly tricks. Please note that this script specifically targets the anti-disassembly used in Pirpi and other UPS samples. It may cause issues with malware that uses other anti-disassembly tricks. Use with caution.\r\nNotable Differences\r\nThe first major difference between the Pirpi.2014 and Pirpi.2015 variants is in the way the command loop is executed in each backdoor. In Pirpi.2014, the malware uses a simple state machine that executes code blocks that correspond to a state value, which the malware updates at the end of each code block. Many of these code blocks include sleep functions, however, if the state value is set to the correct value, the malware executes a code block that contains the command loop. The purpose of this state machine is to intentionally delay the malware\u2019s execution of the command loop.\r\n\r\nIn Pirpi.2015, the malware implements a second state machine that executes the Pirpi.2014 state machine as one of its code blocks. The second state machine introduces a large number of randomized sleep functions, causing the malware to take much longer to execute its command loop. The majority of code blocks in the second state machine either sleep, or create threads and wait for them to finish. \u00a0The malware author likely implemented these state machines as an anti-debugging technique and to defeat most modern sandbox solutions.\r\n\r\nThe second difference between the two Pirpi variants involves the encoding algorithm, which has improved greatly in the past year. Contained in the binary is an invertible math function for encoding and decoding of data. In Pirpi.2014 this function is rather simple, involving a few mathematical operations. However, in Pirpi.2015, the algorithm when decompiled is more than 300 source code lines of mathematical operations.\r\nOther Pirpi Samples\r\nFireEye released two reports in 2014 about APT3 phishing campaigns, Operation Doubletap and Operation Clandestine Fox. Each report containins md5s of other Pirpi samples that were available on VirusTotal. In addition, simple VirusTotal searches resulted in a few more Pirpi samples that came from the same code base. Table 3 contains the file information for each of these Pirpi samples.\r\n\r\n\r\n\r\nFile Name\r\nFile Type\r\nArchitecture\r\nSize\r\n\r\n\r\nMD5\r\nCompile Time\r\n\r\n\r\nSHA256\r\n\r\n\r\n{FireEye Report Sample}\r\nPE.EXE\r\nX86\r\n102400\r\n\r\n\r\n8849538EF1C3471640230605C2623C67\r\n09:25:14 09:09:59\r\n\r\n\r\n854C6BA97B4BD01246AC6EF9258135D2337E6938676421131B6793ABF339FA94\r\n\r\n\r\nmsupd.dll\r\nPE.DLL\r\nX86\r\n81920\r\n\r\n\r\nFA3578C2ABE3F37DDDA76EE40C5A1608\r\n09:10:14 04:54:09\r\n\r\n\r\nCE7ACAE4CDB53C2FB526624855FC8E008608343B177DF348657295578312EB49\r\n\r\n\r\nieupd.dll\r\nPE.DLL\r\nX86\r\n86016\r\n\r\n\r\n1A4B710621EF2E69B1F7790AE9B7A288\r\n05:27:14 08:48:13\r\n\r\n\r\n12AE4A7072C95EAE0E433570B1D563C3D39FE3239816C04426C8E64A49BBE7D7\r\n\r\n\r\nIePorxyv.dll\r\nPE.DLL\r\nX86\r\n86016\r\n\r\n\r\nF4884C0458176AAC848A911683D3DEF5\r\n04:29:14 00:45:45\r\n\r\n\r\n8C64D673CB84F76124FDBDC76941396647FF03725BDDD1D59D0CD32D8EBAD81F\r\n\r\n\r\nIePorxyv.dll\r\nPE.DLL\r\nX86\r\n81920\r\n\r\n\r\n4CA97FF9D72B422589266AA7B532D6E6\r\n04:29:14 00:32:43\r\n\r\n\r\n4F677060D25A5E448BE986759FED5A325CD83F64D9FEF13FB51B18D1D0EB0F52\r\n\r\n\r\n\r\nTable 3.\u00a0Details of Pirpi Samples from FireEye Reports and Samples that Share the Same Code Base\r\nThe sample listed as \u201c{FireEye Report Sample}\u201d in Table 3 is simply a dropper and loader for msupd.dll sample. Unit 42 compared all of the DLL samples listed in the table above and found that they are most closely related to Pirpi.2014. Table 4 below shows the statistics from Zynamics BinDiff from comparing each of the DLLs with Pirpi.2014 and Pirpi.2015.\r\n\r\n\r\n\r\nSample MD5\r\nPirpi.2014 Bindiff\r\nPirpi.2015 Bindiff\r\n\r\n\r\nSimilarity\r\nConfidence\r\nSimilarity\r\nConfidence\r\n\r\n\r\nFA3578C2ABE3F37DDDA76EE40C5A1608\r\n89.5%\r\n98.6%\r\n29.8%\r\n69.5%\r\n\r\n\r\n1A4B710621EF2E69B1F7790AE9B7A288\r\n92.7%\r\n98.8%\r\n29.4%\r\n69.5%\r\n\r\n\r\nF4884C0458176AAC848A911683D3DEF5\r\n91.4%\r\n98.7%\r\n29.6%\r\n71.6%\r\n\r\n\r\n4CA97FF9D72B422589266AA7B532D6E6\r\n93.7%\r\n98.7%\r\n30.7%\r\n71.6%\r\n\r\n\r\nB48E578F030A7B5BB93A3E9D6D1E2A83\r\n100%\r\n100%\r\n34.3%\r\n73.0%\r\n\r\n\r\n1B0E6BA299A522A3B3B02015A3536F6F\r\n34.3%\r\n73.0%\r\n100%\r\n100%\r\n\r\n\r\n\r\nTable 4.\u00a0Resulting Similarity and Confidence Rates of Pirpi Samples\r\n\r\nConclusion\r\nThe UPS threat group continues to exploit zero-day vulnerabilities in their campaigns, which shows that this group is quite sophisticated and has access to significant resources. Within their attack campaigns involving zero-days, UPS has consistently reused delivery techniques and code within various components of the attack. UPS has relied on steganography to conceal the payloads delivered after exploitation of zero-days by embedding payloads, specifically the Pirpi backdoor within animated GIFs. This group also reuses portions of their ActionScript within their malicious Flash files used to exploit vulnerabilities, as well as sharing portions of shellcode that executes after exploitation.\r\nIn regards to similarities amongst payloads, UPS delivers variants of the Pirpi backdoor that are typically very similar to each other. The Pirpi backdoors we analyzed use the same configuration file, a common C2 communications channel and a similar command handler. Also, the author of Pirpi includes several notable fingerprints within the code, specifically using a unique state machine and anti-disassembly techniques. Organizations can use all of these overlaps and similarities to track and hopefully protect themselves from this advanced adversary. AutoFocus users can identify Pirpi payloads with the\u00a0Pirpi\u00a0tag (Figure 9). WildFire automatically classifies Pirpi samples as malicious and we have released IPS signature 14643 to detect Pirpi C2 communications.\r\n\r\nFigure 9. Pirpi tag","publisher":{"@type":"Organization","@id":"#panworg"},"image":{"@type":"ImageObject","url":"","width":"","height":""},"author":[{"@type":"Person","name":"Robert Falcone"},{"@type":"Person","name":"Richard Wartell"}]}</script><link rel='stylesheet' id='crayon-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dist/block-library/style.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='https://unit42.paloaltonetworks.com/wp-includes/css/dashicons.min.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/post-views-counter/css/frontend.css?ver=1.3.1' type='text/css' media='all' />
<link rel='stylesheet' id='bodhi-svgs-attachment-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/svg-support/css/svgs-attachment.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-post-translations-0-css'  href='//unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-post-translations/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='unit42/css-css'  href='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpp_params = {"sampling_active":"0","sampling_rate":"100","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","ID":"9826","token":"7e15a0f8b3","debug":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/wordpress-popular-posts/assets/js/wpp-5.0.0.min.js?ver=5.0.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpml_xdomain_data = {"css_selector":"wpml-ls-item","ajax_url":"https:\/\/unit42.paloaltonetworks.com\/wp-admin\/admin-ajax.php","current_lang":"en"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/sitepress-multilingual-cms/res/js/xdomain-data.js?ver=4.3.5'></script>
<link rel='https://api.w.org/' href='https://unit42.paloaltonetworks.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://unit42.paloaltonetworks.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://unit42.paloaltonetworks.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.1" />
<link rel='shortlink' href='https://unit42.paloaltonetworks.com/?p=9826' />
<link rel="alternate" type="application/json+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://unit42.paloaltonetworks.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.3.5 stt:1,28;" />
<meta name="google-site-verification" content="zHZtYOWm9hm4SZgsH7wqiYcOwmsAsxDUDU4UD1QxB40" /><style>#wpdevart_lb_overlay{background-color:#000000;} #wpdevart_lb_overlay.wpdevart_opacity{opacity:0.8 !important;} #wpdevart_lb_main_desc{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;} #wpdevart_lb_information_content{
				 -webkit-transition: opacity 0.3s ease;
				 -moz-transition: opacity 0.3s ease;
				 -o-transition: opacity 0.3s ease;
				 transition: opacity 0.3s ease;}
		#wpdevart_lb_information_content{
			width:100%;	
		}
		#wpdevart_info_counter_of_imgs{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_caption{
			    display: inline-block;
				padding-left:15px;
				padding-right:4px;
				font-size:20px;
				color:#000000;
		}
		#wpdevart_info_title{
			    display: inline-block;
				padding-left:5px;
				padding-right:5px;
				font-size:15px;
				color:#000000;
		}
		@-webkit-keyframes rotate {
			to   {-webkit-transform: rotate(360deg);}
			from  {-webkit-transform: rotate(0deg);}
		}
		@keyframes rotate {
			to   {transform: rotate(360deg);}
			from  {transform: rotate(0deg);}
		}
		#wpdevart_lb_loading_img,#wpdevart_lb_loading_img_first{
			-webkit-animation: rotate 2s linear  infinite;
    		animation: rotate 2s linear infinite;
		}
	  </style>        <script>var $ = jQuery;</script>
  
  
<script type="text/javascript">
;(function(win, doc, style, timeout) {
var STYLE_ID = 'at-body-style';
function getParent() {
return doc.getElementsByTagName('head')[0];
}
function addStyle(parent, id, def) {
if (!parent) {
return;
}
var style = doc.createElement('style');
style.id = id;
style.innerHTML = def;
parent.appendChild(style);
}
function removeStyle(parent, id) {
if (!parent) {
return;
}
var style = doc.getElementById(id);
if (!style) {
return;
}
parent.removeChild(style);
}
addStyle(getParent(), STYLE_ID, style);
setTimeout(function() {
removeStyle(getParent(), STYLE_ID);
}, timeout);
}(window, document, "body {visibility:hidden !important}", 3000));
</script>

<script src="//assets.adobedtm.com/9273d4aedcd2/0d76ae0322d7/launch-425c423d843b.min.js" async></script>
<script type="text/javascript" src="https://www.paloaltonetworks.com/content/dam/pan/en_US/includes/attribution.js"></script>
  </head>
  <body class="post-template-default single single-post postid-9826 single-format-standard">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="haeder py-15 position-relative z-index-2">
  <div class="container px-sm-30 px-35">
    <div class="row">
      <div class="first-logo col-sm-auto col-6 mb-sm-0 mb-40 text-sm-center order-1">
                  <a href="https://www.paloaltonetworks.com/">
<!--<img src="/wp-content/uploads/2019/07/paloaltonetwork.svg" class="attachment-full size-full" alt="" height="43" width="124" />-->
<svg width="140" height="26" viewBox="0 0 140 26" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M59.4802 4.69592C57.6721 4.69592 55.7937 5.18876 53.469 6.43377L54.7605 9.62741C56.7794 8.50019 58.447 8.00735 59.6682 8.00735C61.0538 8.00735 61.6644 8.52395 61.6644 9.20483V9.25133C61.6644 9.72143 61.2883 9.97974 60.3729 10.0738L58.7766 10.238C54.7843 10.6606 53.1404 12.3985 53.1404 14.7934V14.9577C53.1404 17.2359 55.0188 19.0203 57.6721 19.0203C59.4192 19.0203 60.937 18.2826 61.8597 16.9807L62.1572 18.7857H65.7734V10.5904C65.7734 6.71584 63.5428 4.69592 59.4802 4.69592ZM59.1279 15.8969C57.7899 15.8969 57.1555 15.3803 57.1555 14.5816V14.5351C57.1555 13.8305 57.5543 13.3139 59.0101 13.1031L59.6445 13.0091C60.5713 12.8799 61.1406 12.7095 61.6644 12.3923V13.4317C61.6644 15.0052 60.6777 15.8969 59.1279 15.8969Z" fill="white"/>
<path d="M25.4785 4.78994L20.8528 0.164276L16.2271 4.78994L18.5281 7.09192L6.92828 18.6917L11.5539 23.3174L16.1796 18.6917L13.8787 16.3908L25.4785 4.78994Z" fill="white"/>
<path d="M11.6001 0.164048L0 11.7642L4.62603 16.3902L16.2262 4.79008L11.6001 0.164048Z" fill="white"/>
<path d="M27.7794 7.09215L16.1793 18.6923L20.8053 23.3183L32.4054 11.7182L27.7794 7.09215Z" fill="white"/>
<path d="M72.231 0H68.1219V18.7857H72.231V0Z" fill="white"/>
<path d="M46.2366 4.69592C44.3685 4.69592 42.8683 5.52249 42.0428 6.81709L41.7287 4.93046H38.1125V23.4806H42.2215V17.051C43.0037 18.2567 44.4832 19.0193 46.2366 19.0193C49.5242 19.0193 52.2013 16.1077 52.2013 12.0916V11.6215C52.2013 7.60853 49.5242 4.69592 46.2366 4.69592ZM47.9744 11.9759C47.9744 14.0888 46.871 15.6159 45.0391 15.6159C43.2072 15.6159 42.1038 14.0898 42.1038 11.9759V11.7414C42.1038 9.62741 43.2072 8.10137 45.0391 8.10137C46.871 8.10137 47.9744 9.62741 47.9744 11.7414V11.9759Z" fill="white"/>
<path d="M127.672 4.69592C123.469 4.69592 120.51 7.6075 120.51 11.6236V12.0937C120.51 16.1087 123.469 19.0213 127.672 19.0213C131.875 19.0213 134.834 16.1097 134.834 12.0937V11.6236C134.834 7.60853 131.875 4.69592 127.672 4.69592ZM130.607 11.9759C130.607 14.0888 129.504 15.6159 127.672 15.6159C125.84 15.6159 124.736 14.0898 124.736 11.9759V11.7414C124.736 9.62741 125.84 8.10137 127.672 8.10137C129.504 8.10137 130.607 9.62741 130.607 11.7414V11.9759Z" fill="white"/>
<path d="M138.708 5.54211V5.47185C138.708 5.07304 138.404 4.79097 137.863 4.79097H136.924V6.9514H137.37V6.22299H137.866L138.239 6.9514H138.732L138.274 6.09694C138.552 6.01119 138.708 5.80248 138.708 5.54211ZM137.369 5.18979H137.862C138.144 5.18979 138.261 5.28381 138.261 5.49562V5.51938C138.261 5.70742 138.143 5.82418 137.862 5.82418H137.369V5.18979Z" fill="white"/>
<path d="M137.769 3.63998C136.502 3.63998 135.539 4.60293 135.539 5.87067C135.539 7.13842 136.502 8.10137 137.769 8.10137C139.037 8.10137 140 7.13842 140 5.87067C140 4.60293 139.037 3.63998 137.769 3.63998ZM137.769 7.79554C136.666 7.79554 135.867 6.99687 135.867 5.86964C135.867 4.74241 136.666 3.94375 137.769 3.94375C138.873 3.94375 139.671 4.74241 139.671 5.86964C139.671 6.99687 138.873 7.79554 137.769 7.79554Z" fill="white"/>
<path d="M108.416 0H104.307V18.7857H108.416V0Z" fill="white"/>
<path d="M116.518 15.6159C115.321 15.6159 114.874 15.029 114.874 13.7613V8.10137H119.712V4.93149H114.874V1.76058L110.765 2.37121V14.159C110.765 17.3765 112.409 19.0203 115.697 19.0203C117.153 19.0203 118.867 18.5739 120.276 17.7753L119.102 14.8637C118.279 15.31 117.129 15.6159 116.518 15.6159Z" fill="white"/>
<path d="M95.6662 4.69592C93.8581 4.69592 91.9797 5.18876 89.655 6.43377L90.9465 9.62741C92.9654 8.50019 94.633 8.00735 95.8542 8.00735C97.2397 8.00735 97.8504 8.52395 97.8504 9.20483V9.25133C97.8504 9.72143 97.4743 9.97974 96.5589 10.0738L94.9626 10.238C90.9702 10.6606 89.3264 12.3985 89.3264 14.7934V14.9577C89.3264 17.2359 91.2048 19.0203 93.8581 19.0203C95.6042 19.0203 97.123 18.2826 98.0456 16.9807L98.3432 18.7857H101.959V10.5904C101.959 6.71584 99.7287 4.69592 95.6662 4.69592ZM95.3138 15.8969C93.9748 15.8969 93.3415 15.3803 93.3415 14.5816V14.5351C93.3415 13.8305 93.7403 13.3139 95.1961 13.1031L95.8304 13.0091C96.7572 12.8799 97.3265 12.7095 97.8493 12.3923V13.4317C97.8493 15.0052 96.8637 15.8969 95.3138 15.8969Z" fill="white"/>
<path d="M81.225 4.69592C77.022 4.69592 74.0629 7.6075 74.0629 11.6236V12.0937C74.0629 16.1087 77.022 19.0213 81.225 19.0213C85.4281 19.0213 88.3872 16.1097 88.3872 12.0937V11.6236C88.3862 7.60853 85.4281 4.69592 81.225 4.69592ZM84.1593 11.9759C84.1593 14.0888 83.0559 15.6159 81.224 15.6159C79.3921 15.6159 78.2887 14.0898 78.2887 11.9759V11.7414C78.2887 9.62741 79.3921 8.10137 81.224 8.10137C83.0559 8.10137 84.1593 9.62741 84.1593 11.7414V11.9759Z" fill="white"/>
<path d="M98.0446 22.1168H99.0975L100.551 24.0334H100.566V22.1168H101.532V25.4964H100.513L99.0251 23.5313H99.0107V25.4964H98.0446V22.1168Z" fill="white"/>
<path d="M102.816 22.1168H105.771L105.81 22.9372H103.825V23.4011H105.385V24.1491H103.825V24.676H105.868L105.829 25.4964H102.816V22.1168Z" fill="white"/>
<path d="M107.925 22.9857H106.742L106.78 22.1168H110.088L110.127 22.9857H108.944V25.4964H107.925V22.9857Z" fill="white"/>
<path d="M110.943 22.1168H112.024L112.575 24.4632H112.628L113.342 22.1168H114.333L115.033 24.4632H115.086L115.627 22.1168H116.66L115.771 25.4964H114.444L113.826 23.4589H113.797L113.169 25.4964H111.836L110.943 22.1168Z" fill="white"/>
<path d="M117.404 23.8071C117.404 22.7057 118.152 22.0155 119.335 22.0155C120.518 22.0155 121.267 22.7057 121.267 23.8071C121.267 24.9085 120.519 25.5987 119.335 25.5987C118.152 25.5987 117.404 24.9075 117.404 23.8071ZM120.257 23.8071C120.257 23.2234 119.92 22.8752 119.335 22.8752C118.75 22.8752 118.412 23.2234 118.412 23.8071C118.412 24.3919 118.75 24.7391 119.33 24.7391C119.914 24.7391 120.257 24.3909 120.257 23.8071Z" fill="white"/>
<path d="M122.363 22.1168H124.334C125.231 22.1168 125.672 22.5414 125.672 23.3287C125.672 23.8691 125.449 24.2369 125.014 24.4105L125.816 25.4974H124.667L124.044 24.6089H123.378V25.4974H122.363V22.1168ZM124.202 23.8164C124.54 23.8164 124.661 23.6284 124.661 23.3721C124.661 23.1159 124.54 22.933 124.202 22.933H123.377V23.8164H124.202Z" fill="white"/>
<path d="M126.989 22.1168H128.002V23.3628H128.418L129.408 22.1168H130.547L130.552 22.1209L129.259 23.7389L130.625 25.4923L130.62 25.4964H129.437L128.414 24.1977H128.002V25.4964H126.989V22.1168Z" fill="white"/>
<path d="M131.402 25.2743V24.3475H131.407C131.972 24.6327 132.523 24.7721 133 24.7721C133.363 24.7721 133.546 24.6853 133.546 24.5159C133.546 24.3465 133.425 24.3031 132.7 24.1873C131.909 24.0623 131.382 23.8247 131.382 23.1438C131.382 22.5115 131.938 22.0238 133.024 22.0238C133.459 22.0238 133.912 22.1158 134.333 22.2945V23.212L134.328 23.2172C133.927 22.9857 133.386 22.84 132.951 22.84C132.565 22.84 132.411 22.932 132.411 23.0859C132.411 23.2843 132.648 23.3029 133.242 23.4052C134.033 23.5406 134.56 23.7627 134.56 24.4777C134.56 25.0325 134.145 25.5884 132.952 25.5884C132.364 25.5884 131.894 25.4675 131.402 25.2743Z" fill="white"/>
</svg>

</a>

      </div>

      <div class="col-sm-auto col-6 text-sm-center order-sm-2 order-4 second-logo-unit">
        <a href="https://unit42.paloaltonetworks.com/"><img src="/wp-content/uploads/2019/07/unit42.svg" class="attachment-full size-full" alt="" height="35" width="105" /></a>
      </div>

      <div class="col-auto d-sm-none ml-auto mb-40 order-2">
        <button class="btn__search" data-toggle="collapse" data-target="#search"><i class="ui ui-1"></i></button>
      </div>

      <div id="search" class="collapse d-sm-block col-sm-auto col-12 ml-auto order-3">
        <div class="pt-sm-0 pt-20 pb-sm-0 pb-40 mt-sm-0 mt-n30">
                      <input type="search" placeholder="Search Unit 42" id="innerSearch" class="header__search" value="" required>
                  </div>
      </div>

      <div class="col-auto d-sm-none d-flex ml-auto align-items-center order-5">
        <button class="btn__menu rounded" data-toggle="collapse" data-target="#navigation">Menu</button>
      </div>
    </div>
  </div>
</header>

<nav id="navigation" class="site-nav collapse d-sm-block pb-20 mt-sm-10">
  <div class="container px-sm-30">
    <ul id="menu-primary-navigation" class="main-menu d-sm-flex font-weight-medium"><li id="menu-item-97290" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-97290"><a href="https://unit42.paloaltonetworks.com/tools/">Tools</a></li>
<li id="menu-item-41" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-41"><a href="https://unit42.paloaltonetworks.com/atoms/">ATOMs</a></li>
<li id="menu-item-98931" class="menu-item menu-item-type-post_type_archive menu-item-object-events menu-item-98931"><a href="https://unit42.paloaltonetworks.com/events/">Speaking Events</a></li>
<li id="menu-item-81229" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-81229"><a href="https://unit42.paloaltonetworks.com/about-unit-42/">About Us</a></li>
</ul>  </div>
</nav>

  <article class="article overflow-hidden">
    
<header class="article__header py-sm-25 pt-40 pb-25 bg-gray-700">
  <div class="container">
    
    <h1 class="article__header__title mb-sm-30 mb-40">UPS: Observations on CVE-2015-3113, Prior Zero-Days and the Pirpi Payload</h1>

    <ul class="article__entry-meta d-flex flex-wrap align-items-center text-black">
      <li class="mr-10 mb-10 px-20 rounded-pill d-flex bg-gray-200"><div class="post-views post-9826 entry-meta">
			
			
			<span class="post-views-count">13,065</span>
			</div> <span class="ml-5">people reacted</span></li>
      <li class="d-sm-none col-12 p-0"></li>
      <li class="mr-10 mb-10 px-20 rounded-pill bg-gray-200"><span class="ldc-ul_cont idc_ul_cont_not_liked_inner" onclick="alter_ul_post_values(this,'9826','like')"><i class="ui ui-2"></i><span class="ml-5">0</span></span></li>
      <li class="mb-10 px-20 rounded-pill bg-gray-200"><span class="span-reading-time rt-reading-time"><span class="rt-label rt-prefix"></span> <span class="rt-time"> 10</span> <span class="rt-label rt-postfix"></span></span> min. read</li>
    </ul>

    <div class="article__share position-relative">
      <div class="dropdown dropdown-right">
        <button type="button" class="px-25 text-black bg-white text-uppercase rounded-pill" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Share <i class="ui ui-6 ml-10 align-text-top"></i>
        </button>
        <div class="dropdown-menu rounded-pill" role="toolbar">
          <div class="share-dropdown px-20 py-10 text-black font-size-sm">
            <div class="row align-items-center flex-nowrap">
              <div class="col">
                <div class="d-flex align-items-center">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Funit42.paloaltonetworks.com%2Fups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload%2F" target="_blank"><i class="ui ui-7"></i></a>
                  <a href="https://twitter.com/home?status=https%3A%2F%2Funit42.paloaltonetworks.com%2Fups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload%2F+-+UPS%3A+Observations+on+CVE-2015-3113%2C+Prior+Zero-Days+and+the+Pirpi+Payload" target="_blank"><i class="ui ui-8"></i></a>
                  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Funit42.paloaltonetworks.com%2Fups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload%2F&title=UPS%3A+Observations+on+CVE-2015-3113%2C+Prior+Zero-Days+and+the+Pirpi+Payload&summary=&source=" target="_blank"><i class="ui ui-9"></i></a>
                  <a href="//www.reddit.com/submit?url=https://unit42.paloaltonetworks.com/ups-observations-on-cve-2015-3113-prior-zero-days-and-the-pirpi-payload/" target="_blank"><i class="ui ui-10"></i></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>    <div class="article__summary py-25 text-gray-500 font-size-sm">
  <div class="container">
    <div class="row align-items-center no-gutters">
      <div class="col-sm-auto col-12 mb-sm-0 mb-35">
        <i class="ui ui-11 text-gray-700 mr-sm-20"></i>
      </div>
  
      <div class="col-sm col-12">
        <p>
          By <a href="https://unit42.paloaltonetworks.com/author/robertfalcone/" title="Posts by Robert Falcone" class="author url fn" rel="author">Robert Falcone</a> and <a href="https://unit42.paloaltonetworks.com/author/richard-wartell/" title="Posts by Richard Wartell" class="author url fn" rel="author">Richard Wartell</a>        </p>
        <p><time datetime="2015-07-27T10:50:42+00:00">July 27, 2015 at 1:50 PM</time></p>
        <p>Category: <a href="https://unit42.paloaltonetworks.com/category/malware-2/" rel="category tag">Malware</a>, <a href="https://unit42.paloaltonetworks.com/category/threat-prevention-2/" rel="category tag">Threat Prevention</a>, <a href="https://unit42.paloaltonetworks.com/category/unit42/" rel="category tag">Unit 42</a></p>
        <p>Tags: <a href="https://unit42.paloaltonetworks.com/tag/actionscript/" rel="tag">ActionScript</a>, <a href="https://unit42.paloaltonetworks.com/tag/adobe-flash/" rel="tag">Adobe Flash</a>, <a href="https://unit42.paloaltonetworks.com/tag/apt3/" rel="tag">APT3</a>, <a href="https://unit42.paloaltonetworks.com/tag/autofocus/" rel="tag">AutoFocus</a>, <a href="https://unit42.paloaltonetworks.com/tag/internet-explorer/" rel="tag">internet explorer</a>, <a href="https://unit42.paloaltonetworks.com/tag/operation-clandestine-wolf/" rel="tag">Operation Clandestine Wolf</a>, <a href="https://unit42.paloaltonetworks.com/tag/pirpi/" rel="tag">Pirpi</a>, <a href="https://unit42.paloaltonetworks.com/tag/shellcode/" rel="tag">shellcode</a>, <a href="https://unit42.paloaltonetworks.com/tag/steganography/" rel="tag">steganography</a>, <a href="https://unit42.paloaltonetworks.com/tag/ups/" rel="tag">UPS</a>, <a href="https://unit42.paloaltonetworks.com/tag/wildfire/" rel="tag">WildFire</a>, <a href="https://unit42.paloaltonetworks.com/tag/zero-days/" rel="tag">zero-days</a></p>
      </div>
    </div>
  </div>
</div>    <div class="py-30 bg-white">
      <div class="container">
        <div class="article__content pb-30">
                    <p>A June 23 FireEye blog post titled Operation Clandestine Wolf discussed a cyber espionage group, known as APT3, that had been exploiting a zero-day vulnerability in Adobe Flash. Unit 42 also tracks the APT3 group using the name UPS, which is an intrusion set with Chinese origins that is known for having early access to zero-day vulnerabilities and delivering a backdoor called Pirpi.</p>
<p>The UPS group has exploited several zero-day vulnerabilities, most recently using the zero-days released in the Hacking Team breach that we discussed in our July 10 blog post, <a href="http://researchcenter.paloaltonetworks.com/2015/07/apt-group-ups-targets-us-government-with-hacking-team-flash-exploit/" target="_blank">APT Group UPS Targets US Government with Hacking Team Flash Exploit.</a> However, the most recent original zero-day released by this group is tracked by CVE-2015-3113, which has similarities to the once zero-day vulnerabilities CVE-2014-1776 and <a href="http://researchcenter.paloaltonetworks.com/2014/11/addressing-cve-2014-6332-swf-exploit/" target="_blank">CVE-2014-6332</a> exploited by UPS in May and November 2014, respectively. Well discuss here the similarities observed between the various components used to exploit these two vulnerabilities, specifically focusing on the malicious Flash files and the payloads delivered.<span id="more-9826"></span></p>
<h3>Malicious Flash Files</h3>
<p>Recent zero-day vulnerabilities exploited by UPS exploit or leverage Adobe Flash to exploit other applications on the system. Unit 42 recently analyzed malicious Flash files that exploited <a href="https://helpx.adobe.com/security/products/flash-player/apsb15-14.html" target="_blank">CVE-2015-3113</a>, which was a zero-day vulnerability in Adobe Flash that was patched on June 23, 2015.<sup>.</sup> During the analysis, we noticed similarities between this malicious Flash file, those that UPS used to exploit CVE-2014-1776, and the proof-of-concept code for <a href="http://researchcenter.paloaltonetworks.com/2014/11/addressing-cve-2014-6332-swf-exploit/" target="_blank">CVE-2014-6332</a>, albeit these two Flash files were used to exploit zero-day vulnerabilities in Internet Explorer.</p>
<h4>Overlaps within ActionScript</h4>
<p>Unit 42 analyzed the ActionScript within malicious Flash files created by UPS that exploited CVE-2014-1776 and CVE-2015-3113 and discovered shared code between the two. First, both ActionScripts contain a function named hexToIntArray, which Figure 1 displays side-by-side for comparison. Not only do these files contain the same function name, but they also share the same exact operation codes (opcodes) to carry out its functionality. The existence of the hexToIntArray function in the CVE-2015-3113 sample is rather interesting, as it is never called or used within the ActionScript. We believe that the threat actor used the CVE-2014-1776 ActionScript as the basis for the CVE-2015-3113 file and forgot to remove the unused hexToIntArray function.</p>
<table>
<tbody>
<tr>
<td width="295"><strong>CVE-2014-1776</strong></td>
<td width="295"><strong>CVE-2015-3113</strong></td>
</tr>
<tr>
<td width="295">function private::hexToIntArray(String):__AS3__.vec::Vector.&lt;int&gt;<br />
{<br />
0 getlocal0<br />
1 pushscope<br />
2 pushnull<br />
3 coerce_a<br />
4 setlocal2<br />
5 getlocal1<br />
6 getproperty length<br />
8 coerce_a<br />
9 setlocal3<br />
10 pushbyte 0<br />
12 coerce_a<br />
13 setlocal 4<br />
15 getlex Vector<br />
17 getlex int<br />
19 applytype (1)<br />
21 getlocal3<br />
22 pushbyte 2<br />
24 divide<br />
25 construct (1)<br />
27 coerce __AS3__.vec::Vector.&lt;int&gt;<br />
29 setlocal 5<br />
31 pushbyte 0<br />
33 coerce_a<br />
34 setlocal 6<br />
36 jump L1L2:<br />
40 label<br />
41 getlocal1<br />
42 getlocal 4<br />
44 callproperty http://adobe.com/AS3/2006/builtin::charAt (1)<br />
47 getlocal1<br />
48 getlocal 4<br />
50 pushbyte 1<br />
52 add<br />
53 callproperty http://adobe.com/AS3/2006/builtin::charAt (1)<br />
56 add<br />
57 coerce_a<br />
58 setlocal2<br />
59 getlocal 5<br />
61 getlocal 6<br />
63 findpropstrict parseInt<br />
65 getlocal2<br />
66 pushbyte 16<br />
68 callproperty parseInt (2)<br />
71 setproperty null<br />
73 getlocal 4<br />
75 pushbyte 2<br />
77 add<br />
78 coerce_a<br />
79 setlocal 4<br />
81 getlocal 6<br />
83 pushbyte 1<br />
85 add<br />
86 coerce_a<br />
87 setlocal 6L1:<br />
89 getlocal 4<br />
91 getlocal3<br />
92 iflt L2</p>
<p>96 getlocal 5<br />
98 returnvalue<br />
}</td>
<td width="295">function private::hexToIntArray(String):__AS3__.vec::Vector.&lt;int&gt;<br />
{<br />
0 getlocal0<br />
1 pushscope<br />
2 pushnull<br />
3 coerce_a<br />
4 setlocal2<br />
5 getlocal1<br />
6 getproperty length<br />
8 coerce_a<br />
9 setlocal3<br />
10 pushbyte 0<br />
12 coerce_a<br />
13 setlocal 4<br />
15 getlex Vector<br />
17 getlex int<br />
19 applytype (1)<br />
21 getlocal3<br />
22 pushbyte 2<br />
24 divide<br />
25 construct (1)<br />
27 coerce __AS3__.vec::Vector.&lt;int&gt;<br />
29 setlocal 5<br />
31 pushbyte 0<br />
33 coerce_a<br />
34 setlocal 6<br />
36 jump L1L2:<br />
40 label<br />
41 getlocal1<br />
42 getlocal 4<br />
44 callproperty http://adobe.com/AS3/2006/builtin::charAt (1)<br />
47 getlocal1<br />
48 getlocal 4<br />
50 pushbyte 1<br />
52 add<br />
53 callproperty http://adobe.com/AS3/2006/builtin::charAt (1)<br />
56 add<br />
57 coerce_a<br />
58 setlocal2<br />
59 getlocal 5<br />
61 getlocal 6<br />
63 findpropstrict parseInt<br />
65 getlocal2<br />
66 pushbyte 16<br />
68 callproperty parseInt (2)<br />
71 setproperty null<br />
73 getlocal 4<br />
75 pushbyte 2<br />
77 add<br />
78 coerce_a<br />
79 setlocal 4<br />
81 getlocal 6<br />
83 pushbyte 1<br />
85 add<br />
86 coerce_a<br />
87 setlocal 6L1:<br />
89 getlocal 4<br />
91 getlocal3<br />
92 iflt L2</p>
<p>96 getlocal 5<br />
98 returnvalue<br />
}</td>
</tr>
</tbody>
</table>
<p style="text-align: center;">Figure 1.Side-by-side comparison of opcodes in hexToIntArray functions</p>
<p>Also, the Flash file exploiting CVE-2015-3113 had a main class named &#8220;flappyMan&#8221;. This class name was also used in the Flash file that Unit 42 analyzed and discussed in its November 26, 2014 blog titled <a href="http://researchcenter.paloaltonetworks.com/2014/11/addressing-cve-2014-6332-swf-exploit/" target="_blank">Addressing CVE-2014-6332 SWF Exploit</a>, as well as the proof-of-concept (PoC) for CVE-2014-6332 that is now <a href="https://rstforums.com/forum/92300-exploit-swf-cve-2014-6332-a.rst" target="_blank">publicly available</a> in exploit-related forums. According to FireEye&#8217;s &#8220;<a href="https://www.fireeye.com/blog/threat-research/2014/11/operation_doubletap.html" target="_blank">Operation Double Tap</a>&#8220;, UPS exploited CVE-2014-6332 in its November 2014 attacks; however, UPS used a VBScript to exploit the vulnerability instead of a Flash file. While purely speculation, this overlap in class names between the CVE-2014-6332 PoC and the Flash file exploiting CVE-2015-3113 may suggest that UPS also used Flash files to exploit CVE-2014-6332.</p>
<h3>Shellcode Similarities</h3>
<p>As with most remote code execution vulnerabilities, UPS malicious documents execute shellcode in the event of successful exploitation of either CVE-2014-1776 or CVE-2015-3113. The shellcode found in the UPS delivery documents exploiting both of these vulnerabilities are not the same, but have similarities worth noting.</p>
<p>First, the delivery documents share the same technique of locating API functions, which involves using the rotate right (ror 7 to be specific) instruction on the function name in kernel32.dll and checking it with a specific value. The use of the same rotate right algorithm results in several common constants, such as 0xC917432 that both shellcodes use to locate LoadLibraryA. Second, both shellcodes use a similar method of creating the Unicode string kernel32.dll, seen in Figure 2. The shellcodes use the Unicode string and the same method to find the base address of the loaded kernel32.dll module from the LDR structures obtained from the process environment block (PEB). Third, both shellcodes have similar single byte XOR algorithms used to decrypt and later execute the functional payload.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi1.png" rel="wpdevart_lightbox"><img class="aligncenter wp-image-9827 size-large" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi1-500x299.png" alt="pirpi1" width="500" height="299" /></a></p>
<p style="text-align: center;">Figure 2.Comparison of Instructions in UPS Shellcodes that Builds Kernel32.dll Unicode String</p>
<h3>Steganography to Conceal Payloads</h3>
<p>While analyzing the malicious Flash file exploiting CVE-2015-3113, Unit 42 discovered that the ActionScript loaded an animated GIF image. The malware author used steganography to embed an encrypted payload within this animated GIF image. The payload in the CVE-2014-1776 was also embedded within an animated GIF. Ultimately, the shellcode executed in the event of successful exploitation of either of these vulnerabilities decrypt and execute the embedded payload, as mentioned in the previous section. While the animated GIFs themselves are vastly different, as seen in Figure 3 and 4 (payloads removed), the use of steganography and animated images as the carrier of the payload is common between the two campaigns.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/07/v1.gif.stripped.payload1.gif" rel="wpdevart_lightbox"><img class="aligncenter wp-image-9839 size-large" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/07/v1.gif.stripped.payload1-500x363.gif" alt="v.gif.stripped.payload" width="500" height="363" /></a></p>
<p style="text-align: center;">Figure 3.Animated GIF v.gif from UPS Campaign Exploiting CVE-2015-3113 (click tosee .gif)</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/07/2777r3SH11GE1.gif" rel="wpdevart_lightbox"><img class="aligncenter size-full wp-image-9829" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/07/2777r3SH11GE1.gif" alt="2777r3SH11GE[1]" width="128" height="128" /></a></p>
<p style="text-align: center;">Figure 4.Animated GIF anyway.gif from UPS Campaign Exploiting CVE-2014-1776</p>
<h3>Payload Comparison</h3>
<p>With the amount of overlap between the other components in these separate campaigns, we decided to compare the Pirpi payloads delivered by the UPS group using CVE-2014-1776 and CVE-2015-3113. From here on, we will refer to these two payloads as Pirpi.2014 (CVE-2014-1776) and Pirpi.2015 (CVE-2015-3113), whose details are listed in Table 1. Unit 42 discovered several similarities between the two Pirpi variants, as well as a few equally important differences, both of which are worth discussing. We also compared the Pirpi.2014 and Pirpi.2015 payloads to other known Pirpi samples in an attempt to determine which variant they most closely resemble.</p>
<table>
<tbody>
<tr>
<td width="223"><strong>File Name</strong></td>
<td width="106"><strong>File Type</strong></td>
<td width="146"><strong>Architecture</strong></td>
<td width="107"><strong>Size</strong></td>
</tr>
<tr>
<td colspan="3" width="475"><strong>MD5</strong></td>
<td rowspan="2" width="107"><strong>Compile </strong><strong>Time</strong></td>
</tr>
<tr>
<td colspan="3" width="475"><strong>SHA256</strong></td>
</tr>
<tr>
<td width="223">IePorxyv.dll (Pirpi.2014)</td>
<td width="106">PE.DLL</td>
<td width="146">X86</td>
<td width="107">86016</td>
</tr>
<tr>
<td colspan="3" width="475">B48E578F030A7B5BB93A3E9D6D1E2A83</td>
<td rowspan="2" width="107">04:29:14 00:44:04</td>
</tr>
<tr>
<td colspan="3" width="475">81BD203EF3924BF497E8824ED5F224561487258FF3D8EE55F1E0907155FD5333</td>
</tr>
<tr>
<td width="223">{CVE-2015-3113 payload} (Pirpi.2015)</td>
<td width="106">PE.DLL</td>
<td width="146">X86</td>
<td width="107">150528</td>
</tr>
<tr>
<td colspan="3" width="475">1B0E6BA299A522A3B3B02015A3536F6F</td>
<td rowspan="2" width="107">06:07:15 01:51:27</td>
</tr>
<tr>
<td colspan="3" width="475">0649A3DD632CDE57BC2E97B814BE81A7F45454FED2A73800DE476AA75CDBE8CD</td>
</tr>
</tbody>
</table>
<p style="text-align: center;">Table 1.File Details of Pirpi.2014 and Pirpi.2015 Samples</p>
<h4>Similarities in C2 Communications</h4>
<p>Both Pirpi variants perform an initial check to see if a configuration file exists at %APPDATA%\vcl.tmp or %TEMP%\vcl.tmp depending on the operating system. If it finds one, it decodes it and uses the configuration data it finds inside for C2 communication, otherwise it uses hardcoded C2 domains encoded inside the binary. The malware then creates threads to begin C2 communication.</p>
<p>The Pirpi.2014 and Pirpi.2015 payloads communicate with their C2 by issuing HTTP GET requests to the C2 domain hardcoded inside the payload or within its vcl.tmp configuration file. While the structure of the C2 URL differs between the two variants, both use the HTTP Cookie field to transmit data in encrypted form to the C2 domain. Figure 6 shows examples of C2 communications from Pirpi.2014 and Figure 7 shows communication with the C2 of Pirpi.2015 malware variants, both containing data within the Cookie field.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi5.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-9830" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi5-500x147.png" alt="pirpi5" width="500" height="147" /></a></p>
<p style="text-align: center;">Figure 5.Pirpi.2014 C2 Communication using Cookie Field for Exfiltration</p>
<p style="text-align: center;"><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi6.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-9831" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi6-500x145.png" alt="pirpi6" width="500" height="145" /></a></p>
<p style="text-align: center;">Figure 6.Pirpi.2015 C2 Communication using Cookie Field for Exfiltration</p>
<p>The GET request will return a web page that the malware will parse, specifically looking for encoded commands within two of the HTML tags.</p>
<h4>Command Loop Overlap</h4>
<p>Once the two Pirpi variants successfully communicate with their C2 server and parse the returned HTML for commands, Pirpi enters a command loop that processes the commands and carries out the respective activities. The command loop for the backdoor remains largely unchanged between Pirpi.2014 and Pirpi.2015 with only two of the commands differing between the two. Table 2 shows the commands that each malware can accept with only the 35 and 36 commands differing between the two Pirpi variants.</p>
<table>
<tbody>
<tr>
<td width="73"><strong>Value</strong></td>
<td width="259"><strong>Pirpi.2014 Command</strong></td>
<td width="259"><strong>Pirpi.2015 Command</strong></td>
</tr>
<tr>
<td width="73">1</td>
<td colspan="2" width="517">Launch Process</td>
</tr>
<tr>
<td width="73">2</td>
<td colspan="2" width="517">Process Listing</td>
</tr>
<tr>
<td width="73">3</td>
<td colspan="2" width="517">Terminate Process</td>
</tr>
<tr>
<td width="73">4</td>
<td colspan="2" width="517">Download a file from the C2, launch it, and then delete it</td>
</tr>
<tr>
<td width="73">5</td>
<td colspan="2" width="517">Exit the malware</td>
</tr>
<tr>
<td width="73">6</td>
<td colspan="2" width="517">Sleep</td>
</tr>
<tr>
<td width="73">7</td>
<td colspan="2" width="517">Update C2 configuration and save it to %APPDATA%\vcl.tmp</td>
</tr>
<tr>
<td width="73">8</td>
<td colspan="2" width="517">Download a file, load it into memory, then delete the file</td>
</tr>
<tr>
<td width="73">9</td>
<td colspan="2" width="517">Load a DLL from %APPDATA% and execute one of its exported functions</td>
</tr>
<tr>
<td width="73">10</td>
<td colspan="2" width="517">Do nothing</td>
</tr>
<tr>
<td width="73">11</td>
<td colspan="2" width="517">Do nothing</td>
</tr>
<tr>
<td width="73">12</td>
<td colspan="2" width="517">List all servers in the domain</td>
</tr>
<tr>
<td width="73">13</td>
<td colspan="2" width="517">Get network adaptor information</td>
</tr>
<tr>
<td width="73">14</td>
<td colspan="2" width="517">List TCP connection status (netstat)</td>
</tr>
<tr>
<td width="73">15</td>
<td colspan="2" width="517">Retrieve information about connected users</td>
</tr>
<tr>
<td width="73">16</td>
<td colspan="2" width="517">List servers in the primary domain</td>
</tr>
<tr>
<td width="73">17</td>
<td colspan="2" width="517">Locates DCs on a domain</td>
</tr>
<tr>
<td width="73">32</td>
<td colspan="2" width="517">Directory listing</td>
</tr>
<tr>
<td width="73">33</td>
<td colspan="2" width="517">Upload a file to the C2</td>
</tr>
<tr>
<td width="73">34</td>
<td colspan="2" width="517">Delete file</td>
</tr>
<tr>
<td width="73">35</td>
<td width="259">Copy file and delete original</td>
<td width="259">Copy file</td>
</tr>
<tr>
<td width="73">36</td>
<td width="259">Download and save file</td>
<td width="259">Do Nothing</td>
</tr>
<tr>
<td width="73">37</td>
<td colspan="2" width="517">Echo</td>
</tr>
<tr>
<td width="73">38</td>
<td colspan="2" width="517">Execute Process</td>
</tr>
<tr>
<td width="73">49</td>
<td colspan="2" width="517">Get location of configuration file and set as current working directory</td>
</tr>
</tbody>
</table>
<p style="text-align: center;">Table 2.Commands Available within Pirpi.2014 and Pirpi.2015</p>
<h4>Anti-Disassembly</h4>
<p>The UPS threat group is a fan of one anti-disassembly trick that can be seen in both Pirpi.2014 and Pirpi.2015. It plays upon the order IDA Pro disassembles instructions. As you can see in the code sample in Figure 6 from Pirpi.2014 there is a jump above instruction, followed by a jump below or equal instruction which just falls through to the next instruction. This fall-through code path will never get executed since the jump occurs if 0x58693C96 &gt; 0x0D7F31B4.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi7.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-9832" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi7-500x126.png" alt="pirpi7" width="500" height="126" /></a></p>
<p style="text-align: center;">Figure 7.Code Showing Anti-Disassembly Technique used in Pirpi Tool</p>
<p>IDA Pros disassembly sequence follows the fall-through branch of conditional jumps first, and thus in the previous instruction sequence, IDA keeps disassembling one instruction after another. When IDA goes back to disassemble the jump target for 0x10009133, it finds it pointing to the middle of an instruction. This stops IDA from being able to draw function borders, view a function in graph mode, or decompile with Hex-Rays. To solve this, undefine all of the code that will not be executed, and define code starting from the target of the conditional branch (in this case 0x1000913E), as seen in Figure 7.</p>
<p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi8.png" rel="wpdevart_lightbox"><img class="aligncenter size-large wp-image-9833" src="http://researchcenter.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi8-500x121.png" alt="pirpi8" width="500" height="121" /></a></p>
<p style="text-align: center;">Figure 8.Fixing Anti-Disassembly Trick used by Pirpi Tool by Undefining Errant Instructions</p>
<p>You will now be able to create a function to improve your ability to do analysis. To make this easier, use an <a href="https://github.com/pan-unit42/public_tools/blob/master/ida_scripts/pirpi_anti_disassembly.py" target="_blank">IDA Pro script</a> to fix these anti-disassembly tricks. Please note that this script specifically targets the anti-disassembly used in Pirpi and other UPS samples. It may cause issues with malware that uses other anti-disassembly tricks. Use with caution.</p>
<h4>Notable Differences</h4>
<p>The first major difference between the Pirpi.2014 and Pirpi.2015 variants is in the way the command loop is executed in each backdoor. In Pirpi.2014, the malware uses a simple state machine that executes code blocks that correspond to a state value, which the malware updates at the end of each code block. Many of these code blocks include sleep functions, however, if the state value is set to the correct value, the malware executes a code block that contains the command loop. The purpose of this state machine is to intentionally delay the malwares execution of the command loop.</p>
<p>In Pirpi.2015, the malware implements a second state machine that executes the Pirpi.2014 state machine as one of its code blocks. The second state machine introduces a large number of randomized sleep functions, causing the malware to take much longer to execute its command loop. The majority of code blocks in the second state machine either sleep, or create threads and wait for them to finish. The malware author likely implemented these state machines as an anti-debugging technique and to defeat most modern sandbox solutions.</p>
<p>The second difference between the two Pirpi variants involves the encoding algorithm, which has improved greatly in the past year. Contained in the binary is an invertible math function for encoding and decoding of data. In Pirpi.2014 this function is rather simple, involving a few mathematical operations. However, in Pirpi.2015, the algorithm when decompiled is more than 300 source code lines of mathematical operations.</p>
<h4>Other Pirpi Samples</h4>
<p>FireEye released two reports in 2014 about APT3 phishing campaigns, Operation Doubletap and <a href="https://www.fireeye.com/blog/threat-research/2014/06/clandestine-fox-part-deux.html" target="_blank">Operation Clandestine Fox</a>. Each report containins md5s of other Pirpi samples that were available on VirusTotal. In addition, simple VirusTotal searches resulted in a few more Pirpi samples that came from the same code base. Table 3 contains the file information for each of these Pirpi samples.</p>
<table>
<tbody>
<tr>
<td width="239"><strong>File Name</strong></td>
<td width="114"><strong>File Type</strong></td>
<td width="157"><strong>Architecture</strong></td>
<td width="72"><strong>Size</strong></td>
</tr>
<tr>
<td colspan="3" width="510"><strong>MD5</strong></td>
<td rowspan="2" width="72"><strong>Compile </strong><strong>Time</strong></td>
</tr>
<tr>
<td colspan="3" width="510"><strong>SHA256</strong></td>
</tr>
<tr>
<td width="239">{FireEye Report Sample}</td>
<td width="114">PE.EXE</td>
<td width="157">X86</td>
<td width="72">102400</td>
</tr>
<tr>
<td colspan="3" width="510">8849538EF1C3471640230605C2623C67</td>
<td rowspan="2" width="72">09:25:14 09:09:59</td>
</tr>
<tr>
<td colspan="3" width="510">854C6BA97B4BD01246AC6EF9258135D2337E6938676421131B6793ABF339FA94</td>
</tr>
<tr>
<td width="239">msupd.dll</td>
<td width="114">PE.DLL</td>
<td width="157">X86</td>
<td width="72">81920</td>
</tr>
<tr>
<td colspan="3" width="510">FA3578C2ABE3F37DDDA76EE40C5A1608</td>
<td rowspan="2" width="72">09:10:14 04:54:09</td>
</tr>
<tr>
<td colspan="3" width="510">CE7ACAE4CDB53C2FB526624855FC8E008608343B177DF348657295578312EB49</td>
</tr>
<tr>
<td width="239">ieupd.dll</td>
<td width="114">PE.DLL</td>
<td width="157">X86</td>
<td width="72">86016</td>
</tr>
<tr>
<td colspan="3" width="510">1A4B710621EF2E69B1F7790AE9B7A288</td>
<td rowspan="2" width="72">05:27:14 08:48:13</td>
</tr>
<tr>
<td colspan="3" width="510">12AE4A7072C95EAE0E433570B1D563C3D39FE3239816C04426C8E64A49BBE7D7</td>
</tr>
<tr>
<td width="239">IePorxyv.dll</td>
<td width="114">PE.DLL</td>
<td width="157">X86</td>
<td width="72">86016</td>
</tr>
<tr>
<td colspan="3" width="510">F4884C0458176AAC848A911683D3DEF5</td>
<td rowspan="2" width="72">04:29:14 00:45:45</td>
</tr>
<tr>
<td colspan="3" width="510">8C64D673CB84F76124FDBDC76941396647FF03725BDDD1D59D0CD32D8EBAD81F</td>
</tr>
<tr>
<td width="239">IePorxyv.dll</td>
<td width="114">PE.DLL</td>
<td width="157">X86</td>
<td width="72">81920</td>
</tr>
<tr>
<td colspan="3" width="510">4CA97FF9D72B422589266AA7B532D6E6</td>
<td rowspan="2" width="72">04:29:14 00:32:43</td>
</tr>
<tr>
<td colspan="3" width="510">4F677060D25A5E448BE986759FED5A325CD83F64D9FEF13FB51B18D1D0EB0F52</td>
</tr>
</tbody>
</table>
<p style="text-align: center;">Table 3.Details of Pirpi Samples from FireEye Reports and Samples that Share the Same Code Base</p>
<p>The sample listed as {FireEye Report Sample} in Table 3 is simply a dropper and loader for msupd.dll sample. Unit 42 compared all of the DLL samples listed in the table above and found that they are most closely related to Pirpi.2014. Table 4 below shows the statistics from Zynamics BinDiff from comparing each of the DLLs with Pirpi.2014 and Pirpi.2015.</p>
<table>
<tbody>
<tr>
<td rowspan="2" width="245"><strong>Sample MD5</strong></td>
<td colspan="2" width="173"><strong>Pirpi.2014 Bindiff</strong></td>
<td colspan="2" width="172"><strong>Pirpi.2015 Bindiff</strong></td>
</tr>
<tr>
<td width="84"><strong>Similarity</strong></td>
<td width="89"><strong>Confidence</strong></td>
<td width="83"><strong>Similarity</strong></td>
<td width="89"><strong>Confidence</strong></td>
</tr>
<tr>
<td width="245">FA3578C2ABE3F37DDDA76EE40C5A1608</td>
<td width="84">89.5%</td>
<td width="89">98.6%</td>
<td width="83">29.8%</td>
<td width="89">69.5%</td>
</tr>
<tr>
<td width="245">1A4B710621EF2E69B1F7790AE9B7A288</td>
<td width="84">92.7%</td>
<td width="89">98.8%</td>
<td width="83">29.4%</td>
<td width="89">69.5%</td>
</tr>
<tr>
<td width="245">F4884C0458176AAC848A911683D3DEF5</td>
<td width="84">91.4%</td>
<td width="89">98.7%</td>
<td width="83">29.6%</td>
<td width="89">71.6%</td>
</tr>
<tr>
<td width="245">4CA97FF9D72B422589266AA7B532D6E6</td>
<td width="84">93.7%</td>
<td width="89">98.7%</td>
<td width="83">30.7%</td>
<td width="89">71.6%</td>
</tr>
<tr>
<td width="245">B48E578F030A7B5BB93A3E9D6D1E2A83</td>
<td width="84">100%</td>
<td width="89">100%</td>
<td width="83">34.3%</td>
<td width="89">73.0%</td>
</tr>
<tr>
<td width="245">1B0E6BA299A522A3B3B02015A3536F6F</td>
<td width="84">34.3%</td>
<td width="89">73.0%</td>
<td width="83">100%</td>
<td width="89">100%</td>
</tr>
</tbody>
</table>
<p style="text-align: center;">Table 4.Resulting Similarity and Confidence Rates of Pirpi Samples</p>
<h3 style="text-align: left;">Conclusion</h3>
<p>The UPS threat group continues to exploit zero-day vulnerabilities in their campaigns, which shows that this group is quite sophisticated and has access to significant resources. Within their attack campaigns involving zero-days, UPS has consistently reused delivery techniques and code within various components of the attack. UPS has relied on steganography to conceal the payloads delivered after exploitation of zero-days by embedding payloads, specifically the Pirpi backdoor within animated GIFs. This group also reuses portions of their ActionScript within their malicious Flash files used to exploit vulnerabilities, as well as sharing portions of shellcode that executes after exploitation.</p>
<p style="text-align: left;">In regards to similarities amongst payloads, UPS delivers variants of the Pirpi backdoor that are typically very similar to each other. The Pirpi backdoors we analyzed use the same configuration file, a common C2 communications channel and a similar command handler. Also, the author of Pirpi includes several notable fingerprints within the code, specifically using a unique state machine and anti-disassembly techniques. Organizations can use all of these overlaps and similarities to track and hopefully protect themselves from this advanced adversary. <a href="https://www.paloaltonetworks.com/products/platforms/subscriptions/autofocus.html" target="_blank">AutoFocus</a> users can identify Pirpi payloads with thePirpitag (Figure 9). <a href="https://www.paloaltonetworks.com/products/technologies/wildfire.html" target="_blank">WildFire</a> automatically classifies Pirpi samples as malicious and we have released IPS signature 14643 to detect Pirpi C2 communications.</p>
<p style="text-align: left;"><img class="aligncenter size-full wp-image-9836" src="https://unit42.paloaltonetworks.com/wp-content/uploads/2015/07/pirpi-tag.png" alt="pirpi tag" width="64" height="26" /></p>
<p style="text-align: left;">Figure 9. Pirpi tag</p>
          <div class="article__subscribe mb-40 text-gray-400 bg-gray-200 rounded-lg">
  <h4 class="h3 mb-10 text-black">Get updates from <br class="d-sm-none"> Palo Alto<br class="d-sm-none"> Networks!</h4>
  <p>Sign up to receive the latest news, cyber threat intelligence and research from us</p>
  <!-- <form action="https://app-guse4001.marketo.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe"> -->
  <form action="https://start.paloaltonetworks.com/index.php/leadCapture/save2" method="post" novalidate class="subscribe-form py-25" name="Unit42_Subscribe">
    <input type="hidden" value="1086" name="formid">
    <!-- <input type="hidden" value="818-CZC-273" name="munchkinId"> -->
    <input type="hidden" value="531-OCS-018" name="munchkinId">
    <input type="hidden" value="2141" name="lpId">
    <input type="hidden" value="1086" name="formVid">
    <input type="hidden" name="mkto_optinunit42" value="true">
    <input type="hidden" name="mkto_opt-in" value="true">
    <div class="row">
      <div class="col-sm col-12 mb-sm-0 mb-15">
        <input type="email" name="Email" placeholder="Email address" class="subscribe-field d-block w-100 px-sm-25 px-15 bg-white">
        <p class="error-mail d-none mt-15 text-danger" style="color: #dc3545">Please enter your email address!</p>
      </div>
      <div class="col-sm-auto col-12">
          <input type="submit" value="Subscribe" class="btn btn--black btn--sm w-100" disabled="disabled">
      </div>
    </div>

    <div class="google-recapth mt-15">
      <div class="g-recaptcha" data-expired-callback="captchaExpires" data-callback="captchaComplete" data-sitekey="6LfKOrwUAAAAAOwgjxrEcx-pcfwe8OquUw6ommTK"></div>
      <p class="error-recaptcha d-none mt-15 text-danger" style="color: #dc3545">Please mark, I'm not a robot!</p>
    </div>
  </form>

  <div class="font-size-ex-sm col-sm-7 p-0">
    <p>By submitting this form, you agree to our <a href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a> and acknowledge our <a href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy Statement</a>.</p>
  </div>
</div>

<script type="text/javascript" src="https://researchcenter.paloaltonetworks.com/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.9"></script>
        </div>
      </div>
    </div>
  </article>
<footer class="site-footer px-sm-0 px-15">
  <div class="pt-40">
    <div class="container pt-sm-30">
      <div class="row justify-content-lg-center">
        <div class="col-lg-11 col-12">
          <div class="row">
            <div class="col-lg-4 col-sm-3 col-12 order-sm-2">
              <nav class="footer-socials mb-sm-0 mb-25 text-white text-sm-right">
                                                <a href="https://twitter.com/Unit42_Intel" target="_blank"><span class="ui ui-4"></span></a>
                <a href="https://github.com/pan-unit42" target="_blank"><span class="ui ui-5"></span></a>
              </nav>
            </div>

            <div class="col-lg-8 col-sm-9 col-12 order-sm-1">
              <div class="row">
                <div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Popular Resources</h4><div class="menu-footer-company-phase-container"><ul id="menu-footer-company-phase" class="menu"><li id="menu-item-97096" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97096"><a target="_blank" href="https://www.paloaltonetworks.com/resources">Resource Center</a></li>
<li id="menu-item-97097" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97097"><a target="_blank" href="https://researchcenter.paloaltonetworks.com/">Blog</a></li>
<li id="menu-item-97098" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97098"><a target="_blank" href="https://www.paloaltonetworks.com/communities">Communities</a></li>
<li id="menu-item-97099" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97099"><a target="_blank" href="https://docs.paloaltonetworks.com/">Tech Docs</a></li>
<li id="menu-item-97100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-97100"><a href="https://unit42.paloaltonetworks.com/">Unit 42</a></li>
<li id="menu-item-97101" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97101"><a target="_blank" href="https://www.paloaltonetworks.com/sitemap">Sitemap</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Legal Notices</h4><div class="menu-footer-legal-notices-phase-container"><ul id="menu-footer-legal-notices-phase" class="menu"><li id="menu-item-97093" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97093"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/privacy">Privacy</a></li>
<li id="menu-item-97094" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97094"><a target="_blank" href="https://www.paloaltonetworks.com/legal-notices/terms-of-use">Terms of Use</a></li>
<li id="menu-item-97095" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97095"><a target="_blank" href="https://www.paloaltonetworks.com/legal">Documents</a></li>
</ul></div></div><div class="col-sm col-12 footer-widget widget_nav_menu"><h4 class="h6 mb-15 font-weight-black">Account</h4><div class="menu-footer-trending-topics-phase-container"><ul id="menu-footer-trending-topics-phase" class="menu"><li id="menu-item-97102" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97102"><a href="https://start.paloaltonetworks.com/preference-center">Manage Subscriptions</a></li>
<li id="menu-item-97103" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97103"><a href="#">&nbsp;</a></li>
<li id="menu-item-97104" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97104"><a href="https://www.paloaltonetworks.com/security-disclosure">Report a Vulnerability</a></li>
</ul></div></div>              </div>
            </div>
          </div>

          
            <div class="copyrights py-25 mt-40">
               <p> 2020 Palo Alto Networks, Inc. All rights reserved.</p>
            </div>
          
        </div>
      </div>
    </div>
  </div>
</footer>
    <script type="text/javascript">
	var isProcessing = false; 
    function alter_ul_post_values(obj,post_id,ul_type){
	
		if (isProcessing)    
		return;  
		isProcessing = true;   
		
		jQuery(obj).find("span").html("..");
                jQuery.ajax({
                    type: "POST",
                    url: "https://unit42.paloaltonetworks.com/wp-content/plugins/like-dislike-counter-for-posts-pages-and-comments/ajax_counter.php",
                    data: "post_id="+post_id+"&up_type="+ul_type,
                    success: function(msg){
                            jQuery(obj).find("span").html(msg);
                            isProcessing = false; 
                            jQuery(obj).find('svg').children('path').attr('stroke','#0050FF');
                            jQuery(obj).removeClass('idc_ul_cont_not_liked idc_ul_cont_not_liked_inner');
                    }
 		});
	}
	</script>
            <script type="text/javascript">
            (function(){
                document.addEventListener('DOMContentLoaded', function(){
                    let wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                    if ( wpp_widgets ) {
                        for (let i = 0; i < wpp_widgets.length; i++) {
                            let wpp_widget = wpp_widgets[i];
                            WordPressPopularPosts.theme(wpp_widget);
                        }
                    }
                });
            })();
        </script>
                <script>
            var WPPImageObserver = null;

            function wpp_load_img(img) {
                if ( ! 'imgSrc' in img.dataset || ! img.dataset.imgSrc )
                    return;

                img.src = img.dataset.imgSrc;

                if ( 'imgSrcset' in img.dataset ) {
                    img.srcset = img.dataset.imgSrcset;
                    img.removeAttribute('data-img-srcset');
                }

                img.classList.remove('wpp-lazyload');
                img.removeAttribute('data-img-src');
                img.classList.add('wpp-lazyloaded');
            }

            function wpp_observe_imgs(){
                let wpp_images = document.querySelectorAll('img.wpp-lazyload'),
                    wpp_widgets = document.querySelectorAll('.popular-posts-sr');

                if ( wpp_images.length || wpp_widgets.length ) {
                    if ( 'IntersectionObserver' in window ) {
                        WPPImageObserver = new IntersectionObserver(function(entries, observer) {
                            entries.forEach(function(entry) {
                                if (entry.isIntersecting) {
                                    let img = entry.target;
                                    wpp_load_img(img);
                                    WPPImageObserver.unobserve(img);
                                }
                            });
                        });

                        if ( wpp_images.length ) {
                            wpp_images.forEach(function(image) {
                                WPPImageObserver.observe(image);
                            });
                        }

                        if ( wpp_widgets.length ) {
                            for (var i = 0; i < wpp_widgets.length; i++) {
                                let wpp_widget_images = wpp_widgets[i].querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widgets[i].shadowRoot ) {
                                    wpp_widget_images = wpp_widgets[i].shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    wpp_widget_images.forEach(function(image) {
                                        WPPImageObserver.observe(image);
                                    });
                                }
                            }
                        }
                    } /** Fallback for older browsers */
                    else {
                        if ( wpp_images.length ) {
                            for (var i = 0; i < wpp_images.length; i++) {
                                wpp_load_img(wpp_images[i]);
                                wpp_images[i].classList.remove('wpp-lazyloaded');
                            }
                        }

                        if ( wpp_widgets.length ) {
                            for (var j = 0; j < wpp_widgets.length; j++) {
                                let wpp_widget = wpp_widgets[j],
                                    wpp_widget_images = wpp_widget.querySelectorAll('img.wpp-lazyload');

                                if ( ! wpp_widget_images.length && wpp_widget.shadowRoot ) {
                                    wpp_widget_images = wpp_widget.shadowRoot.querySelectorAll('img.wpp-lazyload');
                                }

                                if ( wpp_widget_images.length ) {
                                    for (var k = 0; k < wpp_widget_images.length; k++) {
                                        wpp_load_img(wpp_widget_images[k]);
                                        wpp_widget_images[k].classList.remove('wpp-lazyloaded');
                                    }
                                }
                            }
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                wpp_observe_imgs();

                // When an ajaxified WPP widget loads,
                // Lazy load its images
                document.addEventListener('wpp-onload', function(){
                    wpp_observe_imgs();
                });
            });
        </script>
        <link rel='stylesheet' id='wpdevart_lightbox_front_end_css-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/wpdevart_lightbox_front.css?ver=5.4.1' type='text/css' media='all' />
<link rel='stylesheet' id='wpdevart_lightbox_effects-css'  href='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/style/effects_lightbox.css?ver=5.4.1' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/themes/unit42-v4/dist/scripts/main.js'></script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-includes/js/wp-embed.min.js?ver=5.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wpdevart_lb_variables = {"eneble_lightbox_content":"enable","overlay_transparency_prancent":"80","popup_background_color":"#000000","popup_loading_image":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/popup_loading.png","popup_initial_width":"350","popup_initial_height":"300","popup_youtube_width":"640","popup_youtube_height":"410","popup_vimeo_width":"500","popup_vimeo_height":"410","popup_max_width":"5000","popup_max_height":"5000","popup_position":"5","popup_fixed_position":"true","popup_outside_margin":"0","popup_border_width":"2","popup_border_color":"#000000","popup_border_radius":"10","control_buttons_show":"true","control_buttons_show_in_content":"false","control_buttons_height":"30","control_buttons_line_bg_color":"#000000","control_button_prev_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev.png","control_button_prev_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/prev_hover.png","control_button_next_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next.png","control_button_next_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/next_hover.png","control_button_download_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download.png","control_button_download_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/download_hover.png","control_button_innewwindow_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow.png","control_button_innewwindow_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/innewwindow_hover.png","control_button_fullwidth_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth.png","control_button_fullwidht_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidth_hover.png","control_button_fullwidthrest_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset.png","control_button_fullwidhtrest_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/fullwidthreset_hover.png","control_button_close_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close.png","control_button_close_hover_img_src":"https:\/\/unit42.paloaltonetworks.com\/wp-content\/plugins\/lightbox-popup\/images\/contorl_buttons\/close_hover.png","information_panel_show":"false","information_panel_show_in_content":"false","information_panel_bg_color":"#000000","information_panel_default_transparency":"100","information_panel_hover_trancparency":"100","information_panel_count_image_after_text":"Image","information_panel_count_image_middle_text":"of","information_panel_count_padding_left":"15","information_panel_count_padding_right":"4","information_panel_count_font_size":"20","information_panel_desc_padding_left":"15","information_panel_desc_padding_right":"4","information_panel_desc_font_size":"20","information_panel_desc_show_if_not":"true","information_panel_text_for_no_caption":"No Caption","information_panel_title_padding_left":"5","information_panel_title_padding_right":"5","information_panel_title_font_size":"15","information_panel_title_show_if_not":"true","information_panel_text_for_no_title":"No Title","information_panel_ordering":"{\"count\":[1,\"count\"],\"title\":[0,\"title\"],\"caption\":[0,\"caption\"]}"};
/* ]]> */
</script>
<script type='text/javascript' src='https://unit42.paloaltonetworks.com/wp-content/plugins/lightbox-popup/includes/javascript/wpdevart_lightbox_front.js?ver=1.0'></script>
          
  </body>
</html>
