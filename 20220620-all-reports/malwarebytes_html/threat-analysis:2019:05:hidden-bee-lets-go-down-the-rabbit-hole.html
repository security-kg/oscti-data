<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>

  
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
    <!-- Taken from www.malwarebytes.com -->
  <!-- Fav Ico -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='shortcut icon' href='//www.malwarebytes.com/images/favicon.ico' type='image/x-icon' />
  <link rel="apple-touch-icon" sizes="57x57" href="//www.malwarebytes.com/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="//www.malwarebytes.com/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="//www.malwarebytes.com/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="//www.malwarebytes.com/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="//www.malwarebytes.com/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="//www.malwarebytes.com/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="//www.malwarebytes.com/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="//www.malwarebytes.com/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="//www.malwarebytes.com/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="///www.malwarebytes.com/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="//www.malwarebytes.com/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="//www.malwarebytes.com/manifest.json">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-TileImage" content="//www.malwarebytes.com/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
<title>

Hidden Bee: Let&#039;s go down the rabbit hole - Malwarebytes Labs | Malwarebytes Labs  </title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://blog.malwarebytes.com/xmlrpc.php">

  
	<!-- Meta Tag Manager -->
	<meta property="fb:app_id" content="358351844222748" />
	<!-- / Meta Tag Manager -->

	<!-- This site is optimized with the Yoast SEO plugin v15.9 - https://yoast.com/wordpress/plugins/seo/ -->
	<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Hidden Bee: Let&#039;s go down the rabbit hole - Malwarebytes Labs" />
	<meta property="og:description" content="The complex and sophisticated custom malware, Hidden Bee, is a Chinese cryptominer that recently released an updated sample. We unpack the sample to look at the functionality of its loader and compare it against earlier versions." />
	<meta property="og:url" content="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/" />
	<meta property="og:site_name" content="Malwarebytes Labs" />
	<meta property="article:published_time" content="2019-05-31T17:32:57+00:00" />
	<meta property="article:modified_time" content="2019-06-01T15:58:39+00:00" />
	<meta property="og:image" content="https://blog.malwarebytes.com/wp-content/uploads/2019/05/shutterstock_665631382.jpg" />
	<meta property="og:image:width" content="800" />
	<meta property="og:image:height" content="400" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:creator" content="@hasherezade" />
	<meta name="twitter:site" content="@malwarebytes" />
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="hasherezade">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="19 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://blog.malwarebytes.com/#website","url":"https://blog.malwarebytes.com/","name":"Malwarebytes Labs","description":"The Security Blog From Malwarebytes","potentialAction":[{"@type":"SearchAction","target":"https://blog.malwarebytes.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/#primaryimage","inLanguage":"en-US","url":"https://blog.malwarebytes.com/wp-content/uploads/2019/05/shutterstock_665631382.jpg","width":800,"height":400},{"@type":"WebPage","@id":"https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/#webpage","url":"https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/","name":"Hidden Bee: Let's go down the rabbit hole - Malwarebytes Labs","isPartOf":{"@id":"https://blog.malwarebytes.com/#website"},"primaryImageOfPage":{"@id":"https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/#primaryimage"},"datePublished":"2019-05-31T17:32:57+00:00","dateModified":"2019-06-01T15:58:39+00:00","author":{"@id":"https://blog.malwarebytes.com/#/schema/person/3c674ace3322ac9b8bd3368413fecf10"},"breadcrumb":{"@id":"https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/"]}]},{"@type":"BreadcrumbList","@id":"https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://blog.malwarebytes.com/","url":"https://blog.malwarebytes.com/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/","url":"https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/","name":"Hidden Bee: Let&#8217;s go down the rabbit hole"}}]},{"@type":"Person","@id":"https://blog.malwarebytes.com/#/schema/person/3c674ace3322ac9b8bd3368413fecf10","name":"hasherezade","image":{"@type":"ImageObject","@id":"https://blog.malwarebytes.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/5d5dda1e7e00492cdb89a26415b1fa8f?s=96&d=identicon&r=g","caption":"hasherezade"},"description":"Unpacks malware with as much joy as a kid unpacking candies.","sameAs":["http://hasherezade.net","https://twitter.com/hasherezade"]}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel="alternate" type="application/rss+xml" title="Malwarebytes Unpacked" href="http://blog.malwarebytes.org/feed/" />
<link rel="alternate" type="application/rss+xml" title="Malwarebytes Unpacked | Comments" href="http://blog.malwarebytes.org/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Malwarebytes Labs &raquo; Hidden Bee: Let&#8217;s go down the rabbit hole Comments Feed" href="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.malwarebytes.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.6.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='https://blog.malwarebytes.com/wp-includes/css/dist/block-library/style.min.css?ver=5.6.2' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<link rel='stylesheet' id='responsive-lightbox-prettyphoto-css'  href='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/assets/prettyphoto/prettyPhoto.min.css?ver=2.3.2' type='text/css' media='all' />
<link crossorigin="anonymous" rel='stylesheet' id='mb_labs-fonts-css'  href='//fonts.googleapis.com/css?family=Source+Sans+Pro%3A300%2C400%2C700%2C300italic%2C400italic%2C700italic%7CBitter%3A400%2C700&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='https://blog.malwarebytes.com/wp-content/plugins/jetpack/_inc/genericons/genericons/genericons.css?ver=3.1' type='text/css' media='all' />
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/jquery/jquery.min.js?ver=3.5.1' id='jquery-core-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/assets/prettyphoto/jquery.prettyPhoto.min.js?ver=2.3.2' id='responsive-lightbox-prettyphoto-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/underscore.min.js?ver=1.8.3' id='underscore-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/assets/infinitescroll/infinite-scroll.pkgd.min.js?ver=5.6.2' id='responsive-lightbox-infinite-scroll-js'></script>
<script type='text/javascript' id='responsive-lightbox-js-extra'>
/* <![CDATA[ */
var rlArgs = {"script":"prettyphoto","selector":"lightbox","customEvents":"","activeGalleries":"1","animationSpeed":"normal","slideshow":"0","slideshowDelay":"5000","slideshowAutoplay":"0","opacity":"0.75","showTitle":"1","allowResize":"1","allowExpand":"1","width":"1080","height":"720","separator":"\/","theme":"pp_default","horizontalPadding":"20","hideFlash":"0","wmode":"opaque","videoAutoplay":"0","modal":"0","deeplinking":"0","overlayGallery":"1","keyboardShortcuts":"1","social":"0","woocommerce_gallery":"0","ajaxurl":"https:\/\/blog.malwarebytes.com\/wp-admin\/admin-ajax.php","nonce":"34b79a074b"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/responsive-lightbox/js/front.js?ver=2.3.2' id='responsive-lightbox-js'></script>
<link rel="https://api.w.org/" href="https://blog.malwarebytes.com/wp-json/" /><link rel="alternate" type="application/json" href="https://blog.malwarebytes.com/wp-json/wp/v2/posts/38182" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.malwarebytes.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.malwarebytes.com/wp-includes/wlwmanifest.xml" /> 
<link rel='shortlink' href='https://blog.malwarebytes.com/?p=38182' />
<link rel="alternate" type="application/json+oembed" href="https://blog.malwarebytes.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.malwarebytes.com%2Fthreat-analysis%2F2019%2F05%2Fhidden-bee-lets-go-down-the-rabbit-hole%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://blog.malwarebytes.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.malwarebytes.com%2Fthreat-analysis%2F2019%2F05%2Fhidden-bee-lets-go-down-the-rabbit-hole%2F&#038;format=xml" />
	<style type="text/css" id="mb_labs-header-css">
			.site-header {
			background: url(https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/headers/circle.png) no-repeat scroll top;
			background-size: 1600px auto;
		}
		</style>
	<link rel="amphtml" href="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/amp/">    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.css" />
	<link rel="stylesheet" type="text/css" href="//www.malwarebytes.com/css/style.css?12-20-2016" />
	<link rel="stylesheet" type="text/css" href="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/style.css?03-03-2021" />


  <script src="//www.malwarebytes.com/js/jquery-1.11.3.min.js" type="text/javascript"></script>

<!-- OneTrust Cookies Consent Notice (Production Standard, malwarebytes.com, en-GB) start -->

<script src="https://optanon.blob.core.windows.net/consent/9530a107-0af8-4204-a2c2-217efb78222b.js" type="text/javascript" charset="UTF-8"></script>

<script type="text/javascript">

function OptanonWrapper() { }

</script>

<!-- OneTrust Cookies Consent Notice (Production Standard, malwarebytes.com, en-GB) end -->

  <script src="//www.malwarebytes.com/js/bootstrap.js" type="text/javascript"></script>
  <script src="//www.malwarebytes.com/js/ie-fixes/respond.min.js" type="text/javascript"></script>

<script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/modernizr.js"></script>
<!--[if gte IE 9]><!-->
<script type="text/javascript" src="//www.malwarebytes.com/js/nav-resize.js"></script>
<!--<![endif]-->
	
  <script src="//www.malwarebytes.com/js/flexibility.js"></script>

  <!--<script src="//www.malwarebytes.com/js/nav.js"></script>-->
  <script>
function readCookie(name) {
  var nameEQ = name + "=";
  var ca = document.cookie.split(';');
  for (var i = 0; i < ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
  }
  return null;
}

//disable functions based on cookie preference
var acceptCookies = readCookie('ce-cookie');
if (acceptCookies === "N") {
    $('body').css('visibility','visible');
    function setCookie() {
        return false;
    }
}
  
  
  
</script>
 
  <script src="//www.malwarebytes.com/js/global.js"></script>

  <script src="//www.malwarebytes.com/js/xs.js"></script>
  <script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/search.js"></script>

<link rel="amphtml" href="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/amp/">
<script>
$(document).ready(function() {
  $("link[rel=amphtml]").each(function(){
    amphtml = $(this).attr("href");
    $(this).attr("href",amphtml.replace("/?amp","/amp"));
  });
});
</script>

<!-- New nav -->
  <link href="//www.malwarebytes.com/css/NEW-NAV.css" rel="stylesheet" type="text/css">
  <script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/new-nav.js" type="text/javascript"></script>

  
</head>
<body>
<!-- Google Tag Manager -->
<noscript>
<iframe src="//www.googletagmanager.com/ns.html?id=GTM-MKSKW3"
height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MKSKW3');</script> 
<!-- End Google Tag Manager --> 

  
  

<!-- global nav -->
<nav id="mbnav" class="abtest">
    <div id="nav-background"></div>
    <div class="nav-container">
        <div class="logo">
            <a href="/" id="cta-navbar-company-logo-en-test">
                <!--<img src="https://blog.malwarebytes.com/wp-content/themes/labs.malwarebytes.org-1.7d/images/labs-log-w-tagline.svg" id="mb-labs-logo">-->
                <script>
                  $('document').ready(function () {
                    setTimeout(function () {
                      $('#main-logo, #logo-tagline').attr('class', 'changed');
                    }, 3000);
                    setTimeout(function () {
                      $('#main-logo, #logo-tagline').attr('class', '');
                    }, 7000);
                  })
                </script>

                <svg version="1.1" id="main-logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="-672 235.9 278.5 31.1" style="enable-background:new -672 235.9 254.5 31.1;" xml:space="preserve" class="" aria-labelledby="malwarebytes-main-logo-title malwarebytes-main-logo-desc" role="img">
    <title id="malwarebytes-main-logo-title">The official Malwarebytes logo</title>
                    <desc id="malwarebytes-main-logo-desc">The official Malwarebytes logo in a blue font</desc>
                    <image src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/malwarebytes-labs-logo.png" xlink:href=""></image>
                    <style type="text/css">
                        .st0 {
                            fill: #0D3ECC !important;
                        }

                        .st1 {
                            fill: #414042;
                        }

                        .st2 {
                            fill: none;
                        }

                        .st3 {
                            enable-background: new;
                        }

                        .st4 {
                            fill: #FFFFFF;
                        }
                    </style>
                    <path id="logo-icon" class="st0" d="M-659.1,263.1C-659,263.1-659,263.1-659.1,263.1c0.3,0,0.4-0.2,0.4-0.4c0-0.2-0.1-0.3-0.3-0.4h-0.1h-0.2
  c-3.8-0.8-6.8-4.2-6.8-8.2c0-1.7,0.5-3.3,1.4-4.7c0.1-0.2,0.4-0.3,0.6-0.1l6.1,6.2c0.1,0.1,0.2,0.1,0.3,0.1s0.2,0,0.3-0.1l6.2-6.1
  c0.2-0.2,0.4-0.2,0.6,0c0.9,1.3,1.4,2.9,1.4,4.7c0,2.2-0.8,4.1-2.1,5.6c0,0-0.1,0.1-0.1,0.2v0.1c0,0.2,0.2,0.3,0.3,0.3l0,0
  c0,0,0.1,0,0.2-0.1c8.1-3.5,7.8-11.5,7.8-11.5c0-4.6-2.2-8.8-5.6-11.4c-0.2-0.1-0.4-0.1-0.5,0l-8.1,8.1c-0.2,0.2-0.4,0.2-0.5,0
  l-8.1-8.1c-0.1-0.1-0.4-0.2-0.5,0c-3.4,2.6-5.6,6.8-5.6,11.4l0,0C-672,256.2-666.3,262.3-659.1,263.1"></path>
                    <g id="logo-maintext">
                        <polygon class="st1" points="-446.9,260.3 -454.3,242.4 -461.7,260.4 -459.7,260.4 -458.3,256.8 -453.5,256.8 -457.4,254.5
    -454.3,246.9 -450.3,257.1 -453.8,257.1 -446.8,260.3   "></polygon>
                        <path class="st0" d="M-545.7,244L-545.7,244l-0.1-7.8c0-0.2-0.2-0.3-0.4-0.3l-2.2,0.3c-0.2,0-0.3,0.2-0.3,0.3v23.1
    c0,0.2,0.1,0.3,0.2,0.3c1.9,0.4,4.3,0.6,5.8,0.6c6.3,0,7.2-3,7.2-6.3v-6c0-3.5-1.6-5.3-4.9-5.3C-542.6,242.8-544.6,243.5-545.7,244
    z M-538.2,248v6.3c0,2.3-0.7,3.8-4.2,3.8c-1.2,0-2.3-0.1-3.4-0.2h-0.1v-11.3l0,0c1-0.5,3.1-1.3,4.7-1.3
    C-539.1,245.3-538.2,246.1-538.2,248z"></path>
                        <path class="st0" d="M-531.7,243.2h-2.1c-0.2,0-0.4,0.2-0.3,0.4l5.3,16.3c0,0.1,0.2,0.2,0.3,0.2h0.6c0.2,0,0.4,0.2,0.3,0.4
    l-2.1,6.1c-0.1,0.2,0.1,0.4,0.3,0.4h2c0.1,0,0.2-0.1,0.3-0.2l2.3-6.6l5.5-16.6c0.1-0.2-0.1-0.4-0.3-0.4h-2.1
    c-0.1,0-0.2,0.1-0.3,0.2l-4.4,13.8c-0.1,0.3-0.5,0.3-0.6,0l-4.4-13.8C-531.4,243.3-531.6,243.2-531.7,243.2z"></path>
                        <path class="st0" d="M-505.6,249.2v5.1c0,4.2,2.1,6.2,6.7,6.2c2,0,4.1-0.3,5.7-0.9c0.2,0,0.2-0.2,0.2-0.4l-0.3-1.6
    c0-0.2-0.2-0.3-0.4-0.2c-1.9,0.5-3.5,0.7-5,0.7c-3.5,0-4.1-1.3-4.1-3.8v-1.2c0-0.2,0.1-0.3,0.3-0.3h9.6c0.2,0,0.3-0.1,0.3-0.3v-3.2
    c0-4.3-2.1-6.4-6.3-6.4C-503.3,242.8-505.6,245-505.6,249.2z M-502.8,248.9c0-2.6,1.2-3.8,3.8-3.8s3.7,1.1,3.7,3.8v1.2
    c0,0.2-0.1,0.3-0.3,0.3h-6.9c-0.2,0-0.3-0.1-0.3-0.3L-502.8,248.9L-502.8,248.9z"></path>
                        <path class="st0" d="M-484.4,250.5c-2.9-0.7-3-1.1-3-3c0-1.6,0.4-2.2,2.9-2.2c1.2,0,2.9,0.2,4.3,0.4c0.2,0,0.4-0.1,0.4-0.3l0.2-1.7
    c0-0.2-0.1-0.3-0.2-0.3c-1.3-0.3-2.9-0.5-4.5-0.5c-4.2,0-5.8,1.2-5.8,4.5c0,3.5,0.4,4.4,4.6,5.4c3.4,0.8,3.6,1,3.6,2.9
    c0,1.8-0.4,2.4-3.2,2.4c-1.3,0-3.1-0.2-4.5-0.6c-0.2,0-0.4,0.1-0.4,0.2l-0.3,1.6c0,0.2,0.1,0.3,0.2,0.4c1.4,0.5,3.5,0.8,5.1,0.8
    c4.9,0,5.8-1.6,5.8-4.9C-479.2,252-479.8,251.6-484.4,250.5z"></path>
                        <g>
                            <path class="st0" d="M-613.7,259.9l-3-16.5c0-0.2,0.1-0.4,0.3-0.4h3.4c0.2,0,0.3,0.1,0.3,0.2l1.8,9.9c0,0.3,0.5,0.4,0.6,0l3-10
      c0-0.1,0.2-0.2,0.3-0.2h4c0.1,0,0.2,0.1,0.3,0.2l2.9,10c0.1,0.3,0.5,0.3,0.6,0l1.8-9.9c0-0.2,0.2-0.2,0.3-0.2h3.4
      c0.2,0,0.3,0.2,0.3,0.4l-3,16.5c0,0.2-0.2,0.2-0.3,0.2h-4.5c-0.1,0-0.2-0.1-0.3-0.2l-3.3-11c-0.1-0.3-0.5-0.3-0.6,0l-3.3,11
      c0,0.1-0.2,0.2-0.3,0.2h-4.5C-613.5,260.2-613.7,260.1-613.7,259.9z"></path>
                        </g>
                        <path class="st0" d="M-618.6,257c-1.5,0-2-0.7-2-2.6v-12.3v-4.9c0-0.2-0.2-0.3-0.4-0.3l-3.6,0.5c-0.2,0-0.3,0.2-0.3,0.3v0.2v4.2
    v12.8c0,3.9,2.4,5.6,5.5,5.6c0.3,0,1.5,0,2-0.1c0.2,0,0.3-0.2,0.3-0.3v-2.7c0-0.2-0.2-0.3-0.3-0.3C-617.8,257-618.3,257-618.6,257z
    "></path>
                        <g>
                            <path class="st0" d="M-566.9,246.8c-1.5,0.7-2.7,1.4-4.2,2.3c-0.1,0-0.2,0.2-0.2,0.3v10.5c0,0.2-0.1,0.3-0.3,0.3h-3.7
      c-0.2,0-0.3-0.1-0.3-0.3V244c0-0.2,0.1-0.3,0.2-0.3l3.1-0.5c0.2,0,0.3,0.1,0.4,0.2l0.2,1.1c0,0.2,0.3,0.3,0.5,0.2
      c0.9-0.6,2.5-1.5,3.7-1.9c0.2-0.1,0.4,0.1,0.4,0.3l0.4,3.3C-566.7,246.6-566.7,246.7-566.9,246.8z"></path>
                        </g>
                        <path class="st0" d="M-510,258.1c-1.7,0-1.8-0.8-1.8-2v-10.3c0-0.2,0.1-0.3,0.3-0.3h4c0.2,0,0.3-0.1,0.3-0.3l0.2-1.7
    c0-0.2-0.1-0.4-0.3-0.4h-4.2c-0.2,0-0.3-0.1-0.3-0.3v-3.9c0-0.2-0.2-0.3-0.4-0.3l-2.2,0.3c-0.2,0-0.3,0.2-0.3,0.3v3.7
    c0,0.2-0.1,0.3-0.3,0.3h-2.4c-0.2,0-0.3,0.1-0.3,0.3v1.7c0,0.2,0.1,0.3,0.3,0.3h2.4c0.2,0,0.3,0.1,0.3,0.3v10.8
    c0,2.7,1.2,3.8,4.2,3.8c0.7,0,1.3-0.1,2-0.2c0.2,0,0.2-0.2,0.2-0.3v-1.6c0-0.2-0.2-0.3-0.4-0.3C-509.1,258.1-509.5,258.1-510,258.1
    z"></path>
                        <path class="st2" d="M-557.3,246.2c-0.2,0-0.4,0-0.7,0c-2.1,0-2.8,1.1-2.8,2.7v1.5l0,0h5.4c0.2,0,0.3-0.1,0.3-0.3v-1.2
    C-555.1,247.4-555.7,246.4-557.3,246.2z"></path>
                        <path class="st0" d="M-554.5,243.3c-0.9-0.4-2.1-0.6-3.5-0.6c-1.6,0-3,0.3-4,0.8c-2.3,1.1-3.1,3.4-3.1,5.9v4.5c0,4,1.8,6.5,6.9,6.6
    c0.4,0,0.8,0,1.2,0c1.4,0,2.8-0.2,4.2-0.4c0.2,0,0.3-0.2,0.3-0.4v-0.2l-0.4-2.3l0,0c-1.3,0.1-2.4,0.2-3.7,0.2l0,0
    c-3.1,0-4.1-0.9-4.1-2.8V254l0,0v-0.8l0,0h9.2c0.2,0,0.3-0.1,0.3-0.3v-1.3v-2.1C-551.3,246.8-552,244.4-554.5,243.3z M-555.1,250.1
    c0,0.2-0.1,0.3-0.3,0.3h-5.4l0,0v-1.5c0-1.6,0.7-2.7,2.8-2.7c0.2,0,0.5,0,0.7,0c1.6,0.2,2.2,1.3,2.2,2.7V250.1z"></path>
                        <path class="st0" d="M-635.8,242.8c-1.5,0-3.1,0.1-4.5,0.3c-0.2,0-0.3,0.2-0.2,0.4l0.4,2.6c0,0.2,0.2,0.3,0.3,0.3
    c1.4-0.2,2.3-0.2,3.7-0.2c3.1,0,4.1,0.9,4.1,2.8v1.1c0,0.2-0.1,0.3-0.3,0.3h-4c-3.5,0-5.5,1.8-5.5,5c0,3,2.3,5.1,5.7,5.1
    c2.2,0,3-0.3,3.7-1c0.2-0.2,0.5,0,0.5,0.2v0.2c0,0.2,0.1,0.3,0.3,0.3h3.4c0.2,0,0.3-0.1,0.3-0.3V249
    C-627.9,244.8-630.8,242.8-635.8,242.8z M-632.1,253.8c0,2.1-1.5,3.6-3.7,3.6c-1.8,0-2.7-0.7-2.7-2.1c0-1.5,0.9-2.1,2.7-2.1h3.4
    c0.2,0,0.3,0.1,0.3,0.3V253.8z"></path>
                        <path class="st0" d="M-586.4,242.8c-1.5,0-3.1,0.1-4.5,0.3c-0.2,0-0.3,0.2-0.2,0.4l0.4,2.6c0,0.2,0.2,0.3,0.3,0.3
    c1.4-0.2,2.3-0.2,3.7-0.2c3.1,0,4.1,0.9,4.1,2.8v1.1c0,0.2-0.1,0.3-0.3,0.3h-4c-3.5,0-5.5,1.8-5.5,5c0,3,2.3,5.1,5.7,5.1
    c2.2,0,3-0.3,3.7-1c0.2-0.2,0.5,0,0.5,0.2v0.2c0,0.2,0.1,0.3,0.3,0.3h3.5c0.2,0,0.3-0.1,0.3-0.3V249
    C-578.4,244.8-581.4,242.8-586.4,242.8z M-582.7,253.8c0,2.1-1.5,3.6-3.7,3.6c-1.8,0-2.7-0.7-2.7-2.1c0-1.5,0.9-2.1,2.7-2.1h3.4
    c0.2,0,0.3,0.1,0.3,0.3C-582.7,253.5-582.7,253.8-582.7,253.8z"></path>
                        <path class="st1" d="M-424,260.4c-2.2,0-4.6-0.5-6.9-1.4l0.5-1.8c2.1,0.7,4.4,1.2,6.3,1.2c2.7,0,4.3-1.1,4.3-2.6
    c0-1.3-0.8-2-4.7-3.5c-4.4-1.6-5.9-2.8-5.9-5.4c0-2.8,2.3-4,6.4-4c1.8,0,4.3,0.3,6,0.9l-0.4,1.8c-1.7-0.4-3.7-0.7-5.5-0.7
    c-3,0-4.2,0.5-4.2,2c0,1.6,1.1,2.2,5.1,3.7c4.4,1.7,5.5,2.7,5.5,5.1C-417.4,258.5-420,260.4-424,260.4z"></path>
                        <g>
                            <path class="st1" d="M-462.7,260.3h-7.5c-1,0-1.6-0.4-1.9-0.7c-0.6-0.7-0.6-1.5-0.6-1.8v-15h1.8V258c0,0.1,0,0.3,0.1,0.4
      c0.1,0.1,0.4,0.2,0.5,0.2h7.5L-462.7,260.3L-462.7,260.3z"></path>
                        </g>
                        B <path class="st1" d="M-432.2,255.4c0-2.1-1-3.8-3.1-4.6c1.3-0.7,2.3-2,2.3-3.8c0-2.6-2-4.1-5.5-4.1h-7v14.5l0,0v0.4
    c0,0.2,0,1.1,0.6,1.8c0.3,0.4,0.9,0.7,1.9,0.7h4.9h0.1l0,0h0.3l0,0C-433.9,260.2-432.2,258-432.2,255.4z M-443.6,244.6h5.1
    c2.5,0,3.7,0.8,3.7,2.6s-1.2,3-3.5,3h-5.3L-443.6,244.6L-443.6,244.6z M-436.8,258.5h-6.2c-0.2,0-0.4,0-0.5-0.2
    c-0.1-0.1-0.1-0.4-0.1-0.4v-6h5.9c2.5,0,3.7,1.5,3.6,3.4C-434.2,257-435.1,258.2-436.8,258.5z"></path>
                    </g>
    </svg>
                <p id="logo-tagline" class="">We research. You level up.</p>
            </a>
        </div>
        <div id="mb-nav-icon" type="button" data-target="#navbar" data-toggle="collapse" role="button" aria-label="Open mobile menu" tabindex="0" aria-pressed="true" aria-haspopup="true" aria-expanded="false" aria-controls="navbar">&nbsp;
            <span class="firstline">&nbsp;</span>
            <span class="secondline">&nbsp;</span>
            <span class="thirdline">&nbsp;</span>
        </div>
        <div id="main-nav-menu">
            <div id="main-top-nav">
                <div class="navitem has-dropdown" data-submenu="personal-nav" tabindex="0" aria-haspopup="true" >
                    <span>Personal</span>
                    <div class="submenu">
                        <div class="submenu-container submenu-container-full">
                            <div class="submenu-box divider" role="menuitem">
                                <a href="javascript:void(0)"  data-submenu="personal-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Personal</a>
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Security & Antivirus</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/premium/" id="cta-navbar-windows-en-test" tabindex="-1">Malwarebytes for Windows</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/mac/" id="cta-navbar-mac-en-test" tabindex="-1">Malwarebytes for Mac</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/chromebook/" id="cta-navbar-chromebook-en-test" tabindex="-1">Malwarebytes for Chromebook</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/browserguard/" id="cta-navbar-browserguard-en-test" tabindex="-1">Malwarebytes Browser Guard</a></li>
                                        <li role="none"><a href="//www.malwarebytes.com/for-home/" id="cta-press-navbar-forhome-en-test" class="bold-link" tabindex="-1">Overview <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Security & Antivirus for Mobile</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/android/" id="cta-navbar-android-en-test" tabindex="-1">Malwarebytes for Android</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/ios/" id="cta-navbar-ios-en-test" tabindex="-1">Malwarebytes for iOS</a></li>

                                        <li class="title" role="none">Online Privacy</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/vpn/" id="cta-navbar-malwarebytes-privacy-en-test" tabindex="-1">Malwarebytes Privacy VPN</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Get Started</li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/for-home/products/" id="cta-navbar-viewall-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/personal-icon.svg" alt="Personal Icon">
                                                Explore all Personal Products
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/pricing/" id="cta-navbar-pricing-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/pricing-icon.svg" alt="Pricing Icon">
                                                Explore Pricing
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a id="cta-navbar-freedownload-personaldropdown-en-test" href="//www.malwarebytes.com/mwb-download/thankyou/" class="free-download link-box" tabindex="-1">
                                                <div>
                                                    <h4>Free Trial of Malwarebytes Premium</h4>
                                                    <p>Protect your devices, your data, and your privacy—at home or on the go.</p>
                                                    <span class="cta-text">Get free trial <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></span>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem has-dropdown" data-submenu="business-nav" tabindex="0">
                    <span>Business</span>
                    <div id="business-nav" class="submenu">
                        <div class="submenu-container submenu-container-full">
                            <div class="submenu-box divider">
                                <a href="javascript:void(0)" data-submenu="business-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Business</a>
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Security & Antivirus</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/cloud/" id="cta-navbar-forbusiness-nebula-en-test" tabindex="-1">Malwarebytes Nebula - Cloud Hosted Security Platform</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/endpoint-protection/" id="cta-navbar-forbusiness-ep-en-test" tabindex="-1">Malwarebytes Endpoint Protection</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/edr/" id="cta-navbar-forbusiness-edr-en-test" tabindex="-1">Malwarebytes Endpoint Detection & Response</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/incident-response/" id="cta-navbar-forbusiness-ir-en-test" tabindex="-1">Malwarebytes Incident Response</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/crowdstrike/" id="cta-navbar-forbusiness-crowdstrike-en-test" tabindex="-1">Malwarebytes Remediation for CrowdStrike</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/teams/" id="cta-navbar-forbusiness-teams-en-test" tabindex="-1">Malwarebytes for Teams</a></li>
                                        <li class="title" role="none">Services</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/services/malware-removal/" id="cta-navbar-forbusiness-malwareremovalservice-en-test" tabindex="-1">Malwarebytes Malware Removal</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Server Protection</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/endpoint-protection/server-security/" id="cta-navbar-forbusiness-ep-server-security-en-test" tabindex="-1">Malwarebytes Endpoint Protection for Servers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/edr/server-security/" id="cta-navbar-forbusiness-edr-server-security-en-test" tabindex="-1">Malwarebytes Endpoint Detection and Response for Servers</a></li>

                                        <li class="title" role="none">Solutions</li>
                                        <li class="subtitle" role="none">BUSINESS SOLUTIONS</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/solutions/small-business/" id="cta-navbar-forbusiness-solutions-small-business-en-test" tabindex="-1">Small Business Antivirus</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/solutions/mid-market/" id="cta-navbar-forbusiness-solutions-mid-market-en-test" tabindex="-1">Secure Remote Workers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/solutions/enterprise/" id="cta-navbar-forbusiness-solutions-enterprise-en-test" tabindex="-1">Enterprise Antivirus and Cybersecurity</a></li>

                                        <li class="subtitle" role="none">INDUSTRY SOLUTIONS</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/education/" id="cta-navbar-forbusiness-education-en-test" tabindex="-1">Education</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/finance/" id="cta-navbar-forbusiness-finance-en-test" tabindex="-1">Finance</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/healthcare/" id="cta-navbar-forbusiness-healthcare-en-test" tabindex="-1">Healthcare</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Get Started</li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/business/" id="cta-navbar-forbusiness-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/business-icon.svg" alt="Business Icon">
                                                Explore all Business Products
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a href="//www.malwarebytes.com/pricing/business/" id="cta-navbar-forbusiness-pricing-en-test" class="bold-link" tabindex="-1">
                                                <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/pricing-icon.svg" alt="Pricing Icon">
                                                Explore Pricing
                                            </a>
                                        </li>
                                        <li role="none">
                                            <a id="cta-navbar-businesstrial-businessdropdown-en-test" href="//www.malwarebytes.com/business/request_trial/?ref=nav" class="link-box" tabindex="-1">
                                                <div class="biz">
                                                    <h4>Get a Free Trial</h4>
                                                    <p>Secure your endpoints and servers with industry-leading protection, detection, and response solutions.</p>
                                                    <span class="cta-text">Get Started <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></span>
                                                </div>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem" tabindex="0">
                    <a href="//www.malwarebytes.com/pricing/" class="pricing-link" id="cta-navbar-pricing-en-test" ><span>Pricing</span></a>
                </div>
                <div class="navitem has-dropdown" data-submenu="partners-nav" tabindex="0">
                    <span>Partners</span>
                    <div id="partner-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box"></div>
                            <div class="submenu-box divider">
                                <a  href="javascript:void(0)" data-submenu="partner-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Partners</a>
                                <div class="submenu-content">
                                    <div class="submenu-content submenu-gradient">
                                        <ul>
                                            <li role="none">
                                                <a href="//www.malwarebytes.com/partners/" id="cta-navbar-partners-explore-partnerships-en-test" class="bold-link" tabindex="-1">
                                                    <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/partner-icon.svg" alt="Partner Icon">
                                                    Explore Partnerships
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <ul class="submenu-content divider-top">
                                        <li class="title" role="none">Partner Solutions</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/partners/solution-providers/" id="cta-navbar-partners-solution-providers-en-test" tabindex="-1">Resellers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/partners/managed-service-providers/" id="cta-navbar-partners-managed-service-providers-en-test" tabindex="-1">Managed Service Providers</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/techbench/" id="cta-navbar-partners-computer-repair-en-test" tabindex="-1">Computer Repair</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/integrations/" id="cta-navbar-partners-tech-partnerships-en-test" tabindex="-1">Technology Partners</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Partner Success Story</li>
                                        <li class="partner-highlight" role="none">
                                            <div>
                                                <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/partners/optimus-systems.webp" onerror='this.onerror = null; this.src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/partners/optimus-systems.png"' alt="Optimus Systems Logo">
                                            </div>
                                            <div class="name">Marek Drummond</div>
                                            <div class="position">Managing Director at Optimus Systems</div>
                                            <p>"Thanks to the Malwarebytes MSP program, we have this high-quality product in our stack. It’s a great addition, and I have confidence that customers’ systems are protected."</p>
                                        </li>
                                        <li role="none"><a href="https://resources.malwarebytes.com/casestudy/optimus-systems-delivers-trusted-desktop-security-services-malwarebytes-managed-services-provider/" id="cta-navbar-partners-featured-optimus-en-test" class="bold-link" tabindex="-1">See full story <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem has-dropdown" data-submenu="resources-nav" tabindex="0">
                    <span>Resources</span>
                    <div id="resources-nav" class="submenu">
                        <div class="submenu-container submenu-container-full">
                            <div class="submenu-box divider">
                                <a  href="javascript:void(0)" data-submenu="resources-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Resources</a>
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Learn About Cybersecurity</li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/antivirus/" id="cta-navbar-resources-antivirus-en-test" tabindex="-1">Antivirus</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/malware/" id="cta-navbar-resources-malware-en-test" tabindex="-1">Malware</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/ransomware/" id="cta-navbar-resources-ransomware-en-test" tabindex="-1">Ransomware</a></li>
                                        <li role="none"><a href="//www.malwarebytes.com/cybersecurity/" id="cta-navbar-resources-pillarhub-en-test" class="bold-link" tabindex="-1">See all <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>

                                        <li class="title" role="none">Malwarebytes Labs</li>
                                        <li role="none"><a href="https://blog.malwarebytes.com/" id="cta-navbar-resources-blog-en-test" class="bold-link" tabindex="-1">Explore <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul>
                                        <li class="title" role="none">Business Resources</li>
                                        <li class="link" role="none"><a href="https://resources.malwarebytes.com/#reviews" id="cta-navbar-resources-reviews-en-test" tabindex="-1">Reviews</a></li>
                                        <li class="link" role="none"><a href="https://resources.malwarebytes.com/#analyst-reports" id="cta-navbar-resources-analyst-reports-en-test" tabindex="-1">Analyst Reports</a></li>
                                        <li class="link" role="none"><a href="https://resources.malwarebytes.com/casestudies/" id="cta-navbar-resources-casestudies-en-test" tabindex="-1">Case Studies</a></li>
                                        <li role="none"><a href="https://resources.malwarebytes.com/" id="cta-navbar-resources-viewall-en-test" class="bold-link" tabindex="-1">See all <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>

                                        <li class="title" role="none">Press & News</li>
                                        <li role="none"><a href="https://press.malwarebytes.com/" id="cta-navbar-resources-news-press-en-test" class="bold-link" tabindex="-1">Learn more <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content submenu-gradient">
                                    <ul>
                                        <li class="title" role="none">Events</li>
                                        <li>
                                            <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/rsa2021.jpg" alt="RSA 2021" width="250px">
                                            <br><br>
                                            <p><span class="title">Featured Event:</span> RSA 2021</p>
                                        </li>
                                        <li role="none"><a href="https://www.rsaconference.com/usa" id="cta-navbar-resources-featured-rsa-en-text" class="bold-link" tabindex="-1">See Event <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem has-dropdown" data-submenu="support-nav" tabindex="0">
                    <span>Support</span>
                    <div id="support-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box"></div>
                            <div class="submenu-box divider">
                                <a href="javascript:void(0)" data-submenu="support-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Support</a>
                                <div class="submenu-content">
                                    <ul class="submenu-content">
                                        <li class="title" role="none">Technical Support</li>
                                        <li class="link" role="none"><a href="https://support.malwarebytes.com/hc/en-us" id="cta-navbar-support-en-test" tabindex="-1">Support</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/business/services/" id="cta-navbar-support-business_services-en-test" tabindex="-1">Premium Services</a></li>
                                        <li class="link" role="none"><a href="https://forums.malwarebytes.com/" id="cta-navbar-support-forum-en-test" tabindex="-1">Forums</a></li>
                                        <li class="link" role="none"><a href="//www.malwarebytes.com/secure/" id="cta-navbar-support-vulnerability_disclosure-en-test" tabindex="-1">Vulnerability Disclosure</a></li>
                                    </ul>
                                    <div class="submenu-content submenu-gradient divider-top">
                                        <ul>
                                            <li role="none">
                                                <a href="https://www.youtube.com/channel/UCB7JQhkZpiyvGPufW2RPBoQ" id="cta-navbar-support-support_services-en-test" class="bold-link" tabindex="-1">
                                                    <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/watch-personal-icon.svg" alt="Watch Icon">
                                                    Training for Personal Products
                                                </a>
                                            </li>
                                            <li role="none">
                                                <a href="//www.malwarebytes.com/business/academy/" id="cta-navbar-support-training_for_business-en-test" class="bold-link" tabindex="-1">
                                                    <img class="link-icon" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/icons/watch-business-icon.svg" alt="Watch Icon">
                                                    Training for Business Products
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="submenu-box divider">
                                <div class="submenu-content">
                                    <ul class="submenu-content submenu-gradient">
                                        <li class="title" role="none">Featured Content</li>
                                        <li role="none">
                                            <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/privacy.svg" alt="Privacy Logo">
                                            <br>
                                            <br>
                                            <p>Activate Malwarebytes Privacy on Windows device.</p>
                                        </li>
                                        <li role="none"><a href="https://support.malwarebytes.com/hc/en-us/articles/360046199873-Activate-Malwarebytes-Privacy-on-Windows-device" id="cta-navbar-support-privacy_activation-en-test" class="bold-link" tabindex="-1">See Content <img class="text-arrow" src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/refreshed_homepage/arrow.svg" alt="Arrow"></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                  <a id="cta-navbar-freedownload-main-en-test" href="//www.malwarebytes.com/mwb-download/thankyou/" class="free-download nav-download-btn">FREE DOWNLOAD</a>
                </div>
            </div>
            <div id="main-util-nav">
                <div class="navitem-caps">
                    <a href="//www.malwarebytes.com/contact/" id="cta-navbar-company-contactus-en-test">CONTACT US</a>
                </div>
                <div class="navitem-caps has-dropdown" data-submenu="company-nav" tabindex="0">
                    <span>COMPANY</span>
                    <div id="company-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box">
                                <a href="javascript:void(0)" data-submenu="company-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Company</a>
                                <ul>
                                    <li class="link" role="none"><a href="//www.malwarebytes.com/company/" id="cta-utilbar-company-aboutus-en-test" tabindex="-1">About Malwarebytes</a></li>
                                    <li class="link" role="none"><a href="https://jobs.malwarebytes.com/" id="cta-utilbar-company-careers-en-test" tabindex="-1">Careers</a></li>
                                    <li class="link" role="none"><a href="https://press.malwarebytes.com/" id="cta-utilbar-company-news-press-en-test" tabindex="-1">News & Press</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navitem-caps has-dropdown" data-submenu="signin-nav" tabindex="0">
                    <span>SIGN IN</span>
                    <div id="signin-nav" class="submenu">
                        <div class="submenu-container">
                            <div class="submenu-box">
                                <a href="javascript:void(0)" data-submenu="signin-nav" tabindex="-1" class="main-nav-item nav-back-link"><span class="back-arrow"></span> Sign In</a>
                                <ul>
                                    <li class="link" role="none">
                                        <a href="https://my.malwarebytes.com/en/login/" id="cta-utilbar-login-myaccount-en-test" tabindex="-1">My Account</a>
                                    </li>
                                    <li class="link" role="none">
                                        <a href="https://cloud.malwarebytes.com/" id="cta-utilbar-login-cloud-console-en-test" tabindex="-1">Cloud Console</a>
                                    </li>
                                    <li class="link">
                                        <a href="https://partners.malwarebytes.com/English/" id="cta-utilbar-partner-portal-en-test">Partner Portal</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>

<div id="labs-sub-nav">
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-xs-6" id="search-section">
                <form id="search-form" onsubmit="submitSearchrightrail(event)" method="get">
                    <div class="searchbar-wrap-rightrail">
                        <label for="cta-labs-rightrail-search-submit-en" aria-label="cta-labs-rightrail-search-submit-en" aria-labelledby="cta-labs-rightrail-search-submit-en">
                            <input type="text" id="st-search-input-rightrail" class="st-search-input-rightrail"
                            placeholder="Search Labs" />
                        </label>
                        <button type="submit" id="cta-labs-rightrail-search-submit-en" aria-label="Submit your search query" /><span class=""><img
                                src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/search.svg" alt="Magnifying glass"></span>
                    </div>

                </form>
            </div>
            <div class="col-md-offset-4 col-md-4 col-xs-6" id="social">
                <div class="left col-lg-6 col-md-8 col-sm-7">
                    <a href="https://www.malwarebytes.com/newsletter/?email=&source=labs"
                        class="subscribe-btn">SUBSCRIBE</a>
                    <a href="https://blog.malwarebytes.com/feed/" target="_blank" class="socicon-rss" aria-label="Subscribe to Malwarebytes Labs RSS Feed"></a>
                </div>
                <div class="right col-lg-5 col-md-4 col-sm-4 col-xs-9">
                    <a class="social socicon-facebook" href="https://www.facebook.com/Malwarebytes/"
                        id="social-follow-facebook" target="_blank" aria-label="Visit Malwarebytes on Facebook"></a>
                    <a class="social socicon-twitter" href="https://twitter.com/malwarebytes" id="social-follow-twitter"
                        target="_blank" aria-label="Visit Malwarebytes on Twitter"></a>
                    <a class="social socicon-linkedin" href="https://www.linkedin.com/company/malwarebytes"
                        id="social-follow-linkedin" target="_blank" aria-label="Visit Malwarebytes on LinkedIn"></a>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">  
  $(function () {

    var navlinks = document.getElementsByClassName('has-dropdown');
    var mainNav = document.getElementById('main-nav-menu');
    var navBackLinks = document.getElementsByClassName('nav-back-link');
    var currentOpenNav = null;

    window.isMac = navigator.platform.match(/(Mac)/i) ? true : false;
    window.isWindows = navigator.userAgent.match(/(Windows)/i) ? true : false;
    window.isAndroid = navigator.userAgent.match(/(Android)/i) ? true : false;
    window.isiPhone = navigator.platform.match(/(iPhone)/i) ? true : false;
    window.isiPad = navigator.platform.match(/(iPad)/i) ? true : false;
    window.isChromeOS = (/\bCrOS\b/.test(navigator.userAgent)) ? true : false;

    var freeDownloadLinkElms = document.getElementsByClassName('free-download');
    var freeDownloadLink = "https://www.malwarebytes.com/mwb-download/thankyou/";

    if (isMac == true) {
      freeDownloadLink = "https://www.malwarebytes.com/mac-download/";
    }
    else if (isiPad || isiPhone) {
      freeDownloadLink = "https://go.onelink.me/app/633d1f14";
    }
    else if (isAndroid) {
      freeDownloadLink = "https://go.onelink.me/app/516cebeb";
    }
    else if (isChromeOS) {
      freeDownloadLink = "https://go.onelink.me/app/fe20dca8";
    }

    for(var i=0; i < freeDownloadLinkElms.length; i++) {
      freeDownloadLinkElms[i].setAttribute('href', freeDownloadLink);
    }

    var outsideClickClose = function(e) {
      closeNav(currentOpenNav);
    };

    var openNav = function(newNav, currentNav) {
      closeNav(currentNav);
      newNav.classList.add('open');
      var subMenu = newNav.getElementsByClassName('submenu')[0];
      if(isSubmenuTooLong(subMenu)) {
        subMenu.classList.add('submenu-scroll');
      } else {
        subMenu.classList.remove('submenu-scroll');
      }
      window.addEventListener('click', outsideClickClose);
      return newNav;
    };

    var isSubmenuTooLong = function(subMenuElm) {
      var subMenuContainer = subMenuElm.getElementsByClassName('submenu-container')[0];
      var subMenuContainerHeight = subMenuContainer.offsetHeight;
      var windowHeightMinusNav = window.innerHeight - 100;
      if(windowHeightMinusNav < subMenuContainerHeight) {
        return true;
      }
      return false;
    }

    var closeNav = function(currentNav) {
      if(!currentNav) return;
      window.removeEventListener('click', outsideClickClose);
      currentNav.classList.remove('open');
      currentNav.blur();
      currentOpenNav = null;
    };

    for(var i=0; i < navlinks.length; i++) {
      var navItem = navlinks[i];

      navItem.addEventListener('click', function(event) {
        event.stopPropagation();

        if(currentOpenNav && this.dataset.submenu === currentOpenNav.dataset.submenu) return;

        console.log('click');
        currentOpenNav = openNav(this, currentOpenNav);

      });

    };

    for(var i=0; i < navBackLinks.length; i++) {
      var navBackItem = navBackLinks[i];

      navBackItem.addEventListener('click', function(event) {
        event.stopPropagation();
        console.log('back click');
        closeNav(currentOpenNav);
      });
    }

    document.getElementById('mb-nav-icon').addEventListener('click', function(e) {

      if(this.classList.contains('open')) {
        document.documentElement.style.overflow = null;
        this.classList.remove('open');
        mainNav.classList.remove('open');
        closeNav(currentOpenNav);
      } else {
        document.documentElement.style.overflow = 'hidden';
        this.classList.add('open');
        mainNav.classList.add('open');
      }

    });

    var b2bRegex = /^\/business\/|^\/pricing\/business\/|^\/education\/|^\/finance\/|^\/healthcare\/|^\/partners\//;

    if(b2bRegex.test(window.location.pathname)){
      $('.pricing-link').attr('href', '/pricing/business/');
    }

  })
</script>
 

 
<!--
Start of DoubleClick Floodlight Tag: Please do not remove
Activity name of this tag: security blog articles
URL of the webpage where the tag is expected to be placed: https://blog.malwarebytes.com/
This tag must be placed between the <body> and </body> tags, as close as possible to the opening tag.
Creation Date: 05/20/2016
-->
<script type="text/plain" class="optanon-category-4">
var axel = Math.random() + "";
var a = axel * 10000000000000;
$('body').append('<iframe src="https://5118230.fls.doubleclick.net/activityi;src=5118230;type=count0;cat=secur00;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord=1;num=' + a + '?" width="1" height="1" frameborder="0" style="display:none"></iframe>');
</script>
<noscript>
<iframe src="https://5118230.fls.doubleclick.net/activityi;src=5118230;type=count0;cat=secur00;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord=1;num=1?" width="1" height="1" frameborder="0" style="display:none"></iframe>
</noscript>
<!-- End of DoubleClick Floodlight Tag: Please do not remove -->


<div class="wrapper" id="post">
           

  
  
<article id="single-post" class="h-entry">
  <section>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://google.com/article"
  },
  "headline": "Hidden Bee: Let&#8217;s go down the rabbit hole",
  "image": {
    "@type": "ImageObject",
    "url": "https://blog.malwarebytes.com/wp-content/uploads/2019/05/shutterstock_665631382-604x270.jpg",
    "height": 405,
    "width": 720
  },
  "datePublished": "May 31, 2019",
  "dateModified": "June 1, 2019",
  "author": {
    "@type": "Person",
    "name": "hasherezade"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Malwarebytes",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.malwarebytes.com/images/mb-logo-2.png",
      "width": 600,
      "height": 60
    }
  },
  "description": "The complex and sophisticated custom malware, Hidden Bee, is a Chinese cryptominer that recently released an updated sample. We unpack the sample to look at the functionality of its loader and compare it against earlier versions."
}
</script>

<div class="container">
  <div class="row">

    <div class="col-md-8" id="content">
      <div>
          <P><img src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/shutterstock_665631382.jpg" alt="Hidden Bee: Let&#8217;s go down the rabbit hole"></P>
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/threat-analysis/" rel="category tag">Threat analysis</a></p>
       <h1 class="entry-title p-name">
					Hidden Bee: Let&#8217;s go down the rabbit hole				</h1>
      <p class="small">Posted: <span class="published"><time class="dt-published" datetime="May 31, 2019">May 31, 2019</time></span> by <span class="vcard author p-author h-card"><a href="https://blog.malwarebytes.com/author/hasherezade/" title="Posts by hasherezade" rel="author">hasherezade</a></span> 
       
       <!-- shows last modified date if modified from original post -->
        <br>Last updated: <span class='updated'><time class='dt-updated' datetime='June 1, 2019'>June 1, 2019</time></span>        
      </p>
      <div class="entry-summary p-summary" style="display:none;">The complex and sophisticated custom malware, Hidden Bee, is a Chinese cryptominer that recently released an updated sample. We unpack the sample to look at the functionality of its loader and compare it against earlier versions.</div>
           <div class="post-content entry-content e-content" id="articleBody" itemprop="articleBody"> 
<p>Some time ago, we discussed the interesting malware, <a rel="noreferrer noopener" aria-label="Hidden Bee (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2018/08/reversing-malware-in-a-custom-format-hidden-bee-elements/" target="_blank">Hidden Bee</a>. It is a Chinese miner, composed of userland components, as well as of a bootkit part. One of its unique features is a custom format used for some of the high-level elements (this format was featured in <a href="https://www.youtube.com/watch?v=0ndK-Az0RO4" data-rel="lightbox-video-0" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">my recent presentation at SAS</a>).</p>



<p>Recently, we stumbled upon a new sample of Hidden Bee. As it turns out, its authors decided to redesign some elements, as well as the used formats. In this post, we will take a deep dive in the functionality of the loader and the included changes.</p>



<h3>Sample</h3>



<p><a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://www.virustotal.com/#/file/fd9edb6d9ac9674e797e51b3767e45a2eb23343c2ce88e64ef20d26f641064af/detection" target="_blank">831d0b55ebeb5e9ae19732e18041aa54</a> &#8211; shared by <a href="https://twitter.com/james_inthe_box/status/1117526091101396992?s=21" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">@James_inthe_box</a></p>



<h3>Overview</h3>



<p>The Hidden Bee runs silently—only increased processor usage can hint that the system is infected. More can be revealed with the help of tools inspecting the memory of running processes.</p>



<p>Initially, the main sample installs itself as a Windows service:</p>



<figure class="wp-block-image"><img data-attachment-id="38532" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/added_service/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/added_service.png" data-orig-size="816,180" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="added_service" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/added_service-300x66.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/added_service-600x132.png" loading="lazy" width="816" height="180" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/added_service.png" alt="" class="wp-image-38532" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/added_service.png 816w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/added_service-300x66.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/added_service-600x132.png 600w" sizes="(max-width: 816px) 100vw, 816px" /><figcaption>Hidden Bee service</figcaption></figure>



<p>However, once the next component is downloaded, this service is removed.</p>



<p>The payloads are injected into several applications, such as svchost.exe, msdtc.exe, dllhost.exe, and WmiPrvSE.exe.</p>



<figure class="wp-block-image"><img data-attachment-id="38517" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/injected2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected2.png" data-orig-size="800,106" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="injected2" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected2-300x40.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected2-600x80.png" loading="lazy" width="800" height="106" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected2.png" alt="" class="wp-image-38517" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected2.png 800w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected2-300x40.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected2-600x80.png 600w" sizes="(max-width: 800px) 100vw, 800px" /></figure>



<p>If we scan the system with <a href="https://github.com/hasherezade/hollows_hunter" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">hollows_hunter</a>, we can see that there are some implants in the memory of those processes:</p>



<figure class="wp-block-image"><img data-attachment-id="38689" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/scanned_list/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/scanned_list.png" data-orig-size="554,245" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="scanned_list" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/scanned_list-300x133.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/scanned_list.png" loading="lazy" width="554" height="245" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/scanned_list.png" alt="" class="wp-image-38689" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/scanned_list.png 554w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/scanned_list-300x133.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/scanned_list-195x85.png 195w" sizes="(max-width: 554px) 100vw, 554px" /><figcaption>Results of the scan by hollows_hunter</figcaption></figure>



<p>Indeed, if we take a look inside each process&#8217; memory (with the help of Process Hacker), we can see atypical executable elements:</p>



<figure class="wp-block-image"><img data-attachment-id="38684" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/malware_modules_implanted/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_modules_implanted.png" data-orig-size="840,297" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="malware_modules_implanted" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_modules_implanted-300x106.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_modules_implanted-600x212.png" loading="lazy" width="840" height="297" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_modules_implanted.png" alt="" class="wp-image-38684" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_modules_implanted.png 840w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_modules_implanted-300x106.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_modules_implanted-600x212.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_modules_implanted-470x165.png 470w" sizes="(max-width: 840px) 100vw, 840px" /><figcaption>Hidden Bee implants are placed in RWX memory</figcaption></figure>



<p>Some of them are lacking typical PE headers, for example:</p>



<figure class="wp-block-image"><img data-attachment-id="38685" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/malware_module1/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_module1.png" data-orig-size="605,194" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="malware_module1" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_module1-300x96.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_module1-600x192.png" loading="lazy" width="605" height="194" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_module1.png" alt="" class="wp-image-38685" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_module1.png 605w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_module1-300x96.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_module1-600x192.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/malware_module1-604x194.png 604w" sizes="(max-width: 605px) 100vw, 605px" /><figcaption>Executable in one of the multiple customized formats used by Hidden Bee</figcaption></figure>



<p>But in addition to this, we can also find PE files implanted at unusual addresses in the memory:</p>



<figure class="wp-block-image"><img data-attachment-id="38520" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/pe_files_injected/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/pe_files_injected.png" data-orig-size="610,297" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="pe_files_injected" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/pe_files_injected-300x146.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/pe_files_injected-600x292.png" loading="lazy" width="610" height="297" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/pe_files_injected.png" alt="" class="wp-image-38520" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/pe_files_injected.png 610w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/pe_files_injected-300x146.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/pe_files_injected-600x292.png 600w" sizes="(max-width: 610px) 100vw, 610px" /><figcaption>Manually-loaded PE files in the memory of WmiPrvSE.exe</figcaption></figure>



<p>Those manually-loaded PE files turned out to be legitimate DLLs: <a href="https://www.virustotal.com/#/file/bc0d5b5d63cf39bf2da62271f7ff8615bfd550a803a72ea70204746e03bfdfd2/details" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">OpenCL.dll</a> and <a rel="noreferrer noopener" aria-label="cudart32_80.dll (opens in a new tab)" href="https://www.virustotal.com/#/file/88931308f09fb89222a5a84e5ad9b6074f43db5dbc0f0f6321c5b58691dff2df/details" target="_blank">cudart32_80.dll</a> (NVIDIA CUDA Runtime, Version 8.0.61 ). CUDA is a technology belonging to NVidia graphic cards. So, their presence suggests that the malware uses GPU in order to boost the mining performance.</p>



<p>When we inspect the memory even closer, we see within the executable implants there are some strings referencing LUA components:</p>



<figure class="wp-block-image"><img data-attachment-id="38686" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/lua_references-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/lua_references-1.png" data-orig-size="609,314" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="lua_references" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/lua_references-1-300x155.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/lua_references-1-600x309.png" loading="lazy" width="609" height="314" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/lua_references-1.png" alt="" class="wp-image-38686" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/lua_references-1.png 609w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/lua_references-1-300x155.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/lua_references-1-600x309.png 600w" sizes="(max-width: 609px) 100vw, 609px" /><figcaption>Strings referencing LUA scripting language, used by Hidden Bee components</figcaption></figure>



<p>Those strings are typical for the Hidden Bee miner, and they were also mentioned in <a rel="noreferrer noopener" aria-label="the previous reports (opens in a new tab)" href="https://www.freebuf.com/column/174581.html" target="_blank">the previous reports</a>.</p>



<p>We can also see the strings referencing the mining activity, i.e. the Cryptonight miner.</p>



<figure class="wp-block-image"><img data-attachment-id="38687" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/list/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/list.png" data-orig-size="582,534" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="list" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/list-300x275.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/list.png" loading="lazy" width="582" height="534" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/list.png" alt="" class="wp-image-38687" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/list.png 582w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/list-300x275.png 300w" sizes="(max-width: 582px) 100vw, 582px" /></figure>



<p>List of modules:</p>



<pre class="wp-block-preformatted">bin/i386/coredll.bin<br /><a rel="noreferrer noopener" aria-label="dispatcher.lua (opens in a new tab)" href="https://gist.github.com/malwarezone/b83a5db804aa2379f4a4647aab18f771#file-dispatcher-lua" target="_blank">dispatcher.lua</a><br />bin/i386/ocl_detect.bin<br />bin/i386/cuda_detect.bin<br />bin/amd64/coredll.bin<br />bin/amd64/algo_cn_ocl.bin<br />lib/amd64/cudart64_80.dll<br />src/cryptonight.cl<br />src/cryptonight_r.cl<br />bin/i386/algo_cn_ocl.bin<br /><a href="https://gist.github.com/malwarezone/b83a5db804aa2379f4a4647aab18f771#file-config-lua" target="_blank" rel="noreferrer noopener" aria-label="config.lua (opens in a new tab)">config.lua</a><br />lib/i386/cudart32_80.dll<br />src/CryptonightR.cu<br />bin/i386/algo_cn.bin<br />bin/amd64/precomp.bin<br />bin/amd64/ocl_detect.bin<br />bin/amd64/cuda_detect.bin<br />lib/amd64/opencl.dll<br />lib/i386/opencl.dll<br />bin/amd64/algo_cn.bin<br />bin/i386/precomp.bin</pre>



<p>And we can even retrieve the miner configuration:</p>



<figure class="wp-block-embed"><div class="wp-block-embed__wrapper">
<style>.gist table { margin-bottom: 0; }</style><div style="tab-size: 8" id="gist96245879" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-config-lua" class="file my-2">
    

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-lua  ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tr>
        <td id="file-config-lua-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-config-lua-LC1" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>stratum.connect.timeout<span class="pl-pds">&quot;</span></span>,<span class="pl-c1">20</span>)</td>
      </tr>
      <tr>
        <td id="file-config-lua-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-config-lua-LC2" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>stratum.login.timeout<span class="pl-pds">&quot;</span></span>,<span class="pl-c1">60</span>)</td>
      </tr>
      <tr>
        <td id="file-config-lua-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-config-lua-LC3" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>stratum.keepalive.timeout<span class="pl-pds">&quot;</span></span>,<span class="pl-c1">240</span>)</td>
      </tr>
      <tr>
        <td id="file-config-lua-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-config-lua-LC4" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>stratum.stream.timeout<span class="pl-pds">&quot;</span></span>,<span class="pl-c1">360</span>)</td>
      </tr>
      <tr>
        <td id="file-config-lua-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-config-lua-LC5" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>stratum.keepalive<span class="pl-pds">&quot;</span></span>,<span class="pl-c1">true</span>)</td>
      </tr>
      <tr>
        <td id="file-config-lua-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-config-lua-LC6" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>job.idle.count<span class="pl-pds">&quot;</span></span>,<span class="pl-c1">30</span>)</td>
      </tr>
      <tr>
        <td id="file-config-lua-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-config-lua-LC7" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>stratum.lock.count<span class="pl-pds">&quot;</span></span>,<span class="pl-c1">30</span>)</td>
      </tr>
      <tr>
        <td id="file-config-lua-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-config-lua-LC8" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>miner.protocol<span class="pl-pds">&quot;</span></span>,<span class="pl-s"><span class="pl-pds">&quot;</span>stratum+ssl://r.twotouchauthentication.online:17555/<span class="pl-pds">&quot;</span></span>)</td>
      </tr>
      <tr>
        <td id="file-config-lua-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-config-lua-LC9" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>miner.username<span class="pl-pds">&quot;</span></span>,configuration.<span class="pl-c1">uuid</span>())</td>
      </tr>
      <tr>
        <td id="file-config-lua-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-config-lua-LC10" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>miner.password<span class="pl-pds">&quot;</span></span>,<span class="pl-s"><span class="pl-pds">&quot;</span>x<span class="pl-pds">&quot;</span></span>)</td>
      </tr>
      <tr>
        <td id="file-config-lua-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-config-lua-LC11" class="blob-code blob-code-inner js-file-line">configuration.<span class="pl-c1">set</span>(<span class="pl-s"><span class="pl-pds">&quot;</span>miner.agent<span class="pl-pds">&quot;</span></span>,<span class="pl-s"><span class="pl-pds">&quot;</span>MinGate/5.1<span class="pl-pds">&quot;</span></span>)</td>
      </tr>
</table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/malwarezone/b83a5db804aa2379f4a4647aab18f771/raw/2b96dc5e3ef2029c315bba7deb57c07cd6cf9c26/config.lua" style="float:right">view raw</a>
        <a href="https://gist.github.com/malwarezone/b83a5db804aa2379f4a4647aab18f771#file-config-lua">config.lua</a>
        hosted with &#10084; by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>

</div></figure>



<h3>Inside</h3>



<p>Hidden Bee has a long chain of components that finally lead to loading of the miner. On the way, we will find a variety of customized formats: data packages, executables, and filesystems. The filesystems are going to be mounted in the memory of the malware, and additional plugins and configuration are retrieved from there. Hidden Bee communicates with the C&amp;C to retrieve the modules—on the way also using its own TCP-based protocol.</p>



<p>The first part of the loading process is described by the following diagram:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/05/hidden_bee_loader-2.png" data-rel="lightbox-image-0" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="38969" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/hidden_bee_loader-3/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/hidden_bee_loader-2.png" data-orig-size="681,739" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="hidden_bee_loader" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/hidden_bee_loader-2-276x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/hidden_bee_loader-2-553x600.png" loading="lazy" width="681" height="739" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/hidden_bee_loader-2.png" alt="" class="wp-image-38969" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/hidden_bee_loader-2.png 681w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/hidden_bee_loader-2-276x300.png 276w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/hidden_bee_loader-2-553x600.png 553w" sizes="(max-width: 681px) 100vw, 681px" /></a></figure>



<p>Each of the .spk packages contains a custom &#8216;SPUTNIK&#8217; filesystem, containing more executable modules.</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/05/bee_plugins-1.png" data-rel="lightbox-image-1" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="38910" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/bee_plugins-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/bee_plugins-1.png" data-orig-size="628,584" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="bee_plugins" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/bee_plugins-1-300x279.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/bee_plugins-1-600x558.png" loading="lazy" width="628" height="584" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/bee_plugins-1.png" alt="" class="wp-image-38910" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/bee_plugins-1.png 628w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/bee_plugins-1-300x279.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/bee_plugins-1-600x558.png 600w" sizes="(max-width: 628px) 100vw, 628px" /></a></figure>



<p>Starting the analysis from the loader, we will go down to the plugins, showing the inner workings of each element taking part in the loading process.</p>



<h3>The loader</h3>



<p>In contrast to most of the malware that we see nowadays, the loader is not packed by any crypter. According the header, it was compiled in November 2018.</p>



<figure class="wp-block-image"><img data-attachment-id="38191" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/compile_time/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/04/compile_time.png" data-orig-size="684,150" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="compile_time" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/04/compile_time-300x66.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/04/compile_time-600x132.png" loading="lazy" width="684" height="150" src="https://blog.malwarebytes.com/wp-content/uploads/2019/04/compile_time.png" alt="" class="wp-image-38191" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/04/compile_time.png 684w, https://blog.malwarebytes.com/wp-content/uploads/2019/04/compile_time-300x66.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/04/compile_time-600x132.png 600w" sizes="(max-width: 684px) 100vw, 684px" /></figure>



<p>While in the former edition the modules in the custom formats were dropped as separate files, this time the next stage is unpacked from inside the loader.</p>



<p> The loader is not obfuscated. Once we load it with typical tools (IDA), we can clearly see how the new format is loaded.</p>



<figure class="wp-block-image"><img data-attachment-id="38187" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/to_load_custom/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/04/to_load_custom.png" data-orig-size="306,123" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="to_load_custom" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/04/to_load_custom-300x121.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/04/to_load_custom.png" loading="lazy" width="306" height="123" src="https://blog.malwarebytes.com/wp-content/uploads/2019/04/to_load_custom.png" alt="" class="wp-image-38187" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/04/to_load_custom.png 306w, https://blog.malwarebytes.com/wp-content/uploads/2019/04/to_load_custom-300x121.png 300w" sizes="(max-width: 306px) 100vw, 306px" /><figcaption>The loading function</figcaption></figure>



<p>Section .shared contains the configuration:</p>



<figure class="wp-block-image"><img data-attachment-id="38533" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/section_shared/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/section_shared.png" data-orig-size="881,539" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="section_shared" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/section_shared-300x184.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/section_shared-600x367.png" loading="lazy" width="881" height="539" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/section_shared.png" alt="" class="wp-image-38533" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/section_shared.png 881w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/section_shared-300x184.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/section_shared-600x367.png 600w" sizes="(max-width: 881px) 100vw, 881px" /><figcaption>Encrypted configuration. The last 16 bytes after the data block is the key.</figcaption></figure>



<p>The configuration is decrypted with the help of XTEA algorithm.</p>



<figure class="wp-block-image"><img data-attachment-id="38534" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/decrypt_config/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_config.png" data-orig-size="330,342" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decrypt_config" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_config-289x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_config.png" loading="lazy" width="330" height="342" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_config.png" alt="" class="wp-image-38534" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_config.png 330w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_config-289x300.png 289w" sizes="(max-width: 330px) 100vw, 330px" /><figcaption>Decrypting the configuration</figcaption></figure>



<p>The decrypted configuration must start from the magic WORD &#8220;pZ.&#8221; It contains the C&amp;C and the name under which the service will be installed:</p>



<figure class="wp-block-image"><img data-attachment-id="38535" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/decrypted_config/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypted_config.png" data-orig-size="450,261" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decrypted_config" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypted_config-300x174.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypted_config.png" loading="lazy" width="450" height="261" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypted_config.png" alt="" class="wp-image-38535" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypted_config.png 450w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypted_config-300x174.png 300w" sizes="(max-width: 450px) 100vw, 450px" /></figure>



<h4>Unscrambling the NE format</h4>



<p>The NE format <a href="https://www.freebuf.com/column/174581.html" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">was seen before</a>, in former editions of Hidden Bee. It is just a scrambled version of the PE. By observing which fields have been misplaced, we can easily reconstruct the original PE.</p>



<figure class="wp-block-image"><img data-attachment-id="38522" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/unpack_from_loader/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_from_loader.png" data-orig-size="628,409" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="unpack_from_loader" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_from_loader-300x195.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_from_loader-600x391.png" loading="lazy" width="628" height="409" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_from_loader.png" alt="" class="wp-image-38522" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_from_loader.png 628w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_from_loader-300x195.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_from_loader-600x391.png 600w" sizes="(max-width: 628px) 100vw, 628px" /><figcaption>The loader, unpacking the next stage</figcaption></figure>



<p>NE is one of the two similar formats being used by this malware. Another similar one starts from a DWORD 0x0EF1FAB9 and is used to further load components. Both of them have an analogical structure that comes from slightly modified PE format:</p>



<figure class="wp-block-image"><img data-attachment-id="38213" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/reconstruct_pe-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/04/reconstruct_pe-1.png" data-orig-size="706,320" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="reconstruct_pe" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/04/reconstruct_pe-1-300x136.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/04/reconstruct_pe-1-600x272.png" loading="lazy" width="706" height="320" src="https://blog.malwarebytes.com/wp-content/uploads/2019/04/reconstruct_pe-1.png" alt="" class="wp-image-38213" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/04/reconstruct_pe-1.png 706w, https://blog.malwarebytes.com/wp-content/uploads/2019/04/reconstruct_pe-1-300x136.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/04/reconstruct_pe-1-600x272.png 600w" sizes="(max-width: 706px) 100vw, 706px" /></figure>



<p>Header:

</p>



<pre class="wp-block-preformatted">WORD magic; // 'NE'<br />WORD pe_offset;<br />WORD machine_id; </pre>



<p>The conversion back to PE format is trivial: It is enough to add the erased magic numbers: MZ and PE, and to move displaced fields to their original offsets. The tool that automatically does the mentioned conversion is available <a href="https://github.com/hasherezade/bee_parser/tree/master/bee_lvl2_converter" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">here</a>. </p>



<p>In the previous edition, the parts of Hidden Bee with analogical functionality were delivered in a different, more complex <a rel="noreferrer noopener" aria-label="another proprietary format used for the loader (opens in a new tab)" href="https://blog.malwarebytes.com/threat-analysis/2018/08/reversing-malware-in-a-custom-format-hidden-bee-elements/" target="_blank">proprietary format</a>  than the one currently being analyzed.</p>



<h4 id="mce_31">Second stage: a downloader (in NE format)</h4>



<p>As a result of the conversion, we get the following PE: (<a href="https://www.virustotal.com/#/file/3a1c218de4d653dff06a68cfc12b958766dcb869450c9dd06928be819beb365c/details" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">fddfd292eaf33a490224ebe5371d3275</a>). This module is a downloader of the next stage. The interesting thing is that the subsystem of this module is set as a driver, however, it is not loaded like a typical driver. The custom loader loads it into a user space just like any typical userland component.</p>



<p>The function at the module&#8217;s Entry Point is called with three parameters. The first is a path of the main module. Then, the parameters from the configuration are passed. Example:</p>



<p><pre>0012FE9C     00601A34  UNICODE "\"C:\Users\tester\Desktop\new_bee.exe\""<br />0012FEA0     00407104  UNICODE "NAPCUYWKOxywEgrO"<br />0012FEA4     00407004  UNICODE "118.41.45.124:9000"</pre></p>



<figure class="wp-block-image"><img data-attachment-id="38541" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/call_module_ep/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_module_ep.png" data-orig-size="725,172" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="call_module_ep" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_module_ep-300x71.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_module_ep-600x142.png" loading="lazy" width="725" height="172" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_module_ep.png" alt="" class="wp-image-38541" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_module_ep.png 725w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_module_ep-300x71.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_module_ep-600x142.png 600w" sizes="(max-width: 725px) 100vw, 725px" /><figcaption>Calling the Entry Point of the manually-loaded NE module</figcaption></figure>



<p>The execution of the module can take one of the two paths. The first one is meant for adding persistence: The module installs itself as a service.</p>



<p>If the module detects that it is already running as a service, it takes the second path. In such a case, it proceeds to download the next module from the server. The next module is packed as as Cabinet file.</p>



<figure class="wp-block-image"><img data-attachment-id="38538" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/to_unpack_cabinet/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_cabinet.png" data-orig-size="611,534" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="to_unpack_cabinet" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_cabinet-300x262.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_cabinet-600x524.png" loading="lazy" width="611" height="534" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_cabinet.png" alt="" class="wp-image-38538" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_cabinet.png 611w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_cabinet-300x262.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_cabinet-600x524.png 600w" sizes="(max-width: 611px) 100vw, 611px" /><figcaption>The downloaded Cabinet file is being passed to the unpacking function</figcaption></figure>



<p>It is first unpacked into a file named &#8220;core.sdb&#8221;. The unpacked module is in a customized format based on PE. This time, the format has a different signature: &#8220;NS&#8221; and it is different from the aforementioned &#8220;NE&#8221; format (detailed explanation will be given further).</p>



<figure class="wp-block-image"><img data-attachment-id="38540" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/unpacked_ns_file/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpacked_NS_file.png" data-orig-size="625,236" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="unpacked_NS_file" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpacked_NS_file-300x113.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpacked_NS_file-600x227.png" loading="lazy" width="600" height="227" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpacked_NS_file-600x227.png" alt="" class="wp-image-38540" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpacked_NS_file-600x227.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpacked_NS_file-300x113.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpacked_NS_file.png 625w" sizes="(max-width: 600px) 100vw, 600px" /></figure>



<p>It is loaded by the proprietary loader.</p>



<figure class="wp-block-image"><img data-attachment-id="38539" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/check_ns_sign/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_ns_sign.png" data-orig-size="307,115" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_ns_sign" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_ns_sign-300x112.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_ns_sign.png" loading="lazy" width="307" height="115" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_ns_sign.png" alt="" class="wp-image-38539" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_ns_sign.png 307w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_ns_sign-300x112.png 300w" sizes="(max-width: 307px) 100vw, 307px" /></figure>



<p>The loader enumerates all the executables in a directory: <code>%Systemroot%\Microsoft.NET\</code> and selects the ones with the compatible bitness (in the analyzed case it was selecting 32bit PEs). Once it finds a suitable PE, it runs it and injects the payload there. The injected code is run by adding its entry point to APC queue. </p>



<figure class="wp-block-image"><img data-attachment-id="38548" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/created_process/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/created_process.png" data-orig-size="692,38" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="created_process" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/created_process-300x16.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/created_process-600x33.png" loading="lazy" width="692" height="38" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/created_process.png" alt="" class="wp-image-38548" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/created_process.png 692w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/created_process-300x16.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/created_process-600x33.png 600w" sizes="(max-width: 692px) 100vw, 692px" /><figcaption>Hidden Bee component injecting the next stage (core.sdb) into a new process</figcaption></figure>



<p>In case it failed to find the suitable executable in that directory, it performs the injection into dllhost.exe instead.</p>



<h4 id="mce_22">Unscrambling the NS format</h4>



<p>As mentioned before, the core.sdb is in yet another format named NS. It is also a customized PE, however, this time the conversion is more complex than the NE format because more structures are customized. It looks like a next step in the evolution of the NE format.</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/05/core_sdb.png" data-rel="lightbox-image-2" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="38919" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/core_sdb/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/core_sdb.png" data-orig-size="769,494" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="core_sdb" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/core_sdb-300x193.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/core_sdb-600x385.png" loading="lazy" width="769" height="494" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/core_sdb.png" alt="" class="wp-image-38919" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/core_sdb.png 769w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/core_sdb-300x193.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/core_sdb-600x385.png 600w" sizes="(max-width: 769px) 100vw, 769px" /></a><figcaption>Header of the NS format</figcaption></figure>



<p>We can see that the changes in the PE headers are bigger and more lossy—only minimalist information is maintained. Only few Data Directories are left. Also the sections table is shrunk: Each section header contains only four out of nine fields that are in the original PE. </p>



<p>Additionally, the format allows to pass a runtime argument from the loader to the payload via header: The pointer is saved into an additional field (marked &#8220;Filled Data&#8221; on the picture).</p>



<p>Not only is the PE header shrunk. Similar customization is done on the Import Table:</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/05/custom_import_table1.png" data-rel="lightbox-image-3" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="38572" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/custom_import_table1/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/custom_import_table1.png" data-orig-size="803,156" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="custom_import_table1" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/custom_import_table1-300x58.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/custom_import_table1-600x117.png" loading="lazy" width="803" height="156" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/custom_import_table1.png" alt="" class="wp-image-38572" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/custom_import_table1.png 803w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/custom_import_table1-300x58.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/custom_import_table1-600x117.png 600w" sizes="(max-width: 803px) 100vw, 803px" /></a><figcaption>Customized part of the NS format&#8217;s import table</figcaption></figure>



<p>This custom format can also be converted back to the PE format with the help of a dedicated converter, available <a rel="noreferrer noopener" aria-label="here (opens in a new tab)" href="https://github.com/hasherezade/bee_parser/tree/master/bee_lvl2_converter" target="_blank">here</a>.</p>



<h4 id="mce_27">Third stage: core.sdb</h4>



<p>The core.sdb module converted to PE format is available here: <a href="https://malshare.com/sample.php?action=detail&amp;hash=a17645fac4bcb5253f36a654ea369bf9" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">a17645fac4bcb5253f36a654ea369bf9</a>.</p>



<p>The interesting part is that the external loader does not complete the full loading process of the module. It only copies the sections. But the rest of the module loading, such as applying relocations and filling imports, is done internally in the core.sdb. </p>



<figure class="wp-block-image"><img data-attachment-id="38549" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/coresdb_at_ep_/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/coresdb_at_ep_.png" data-orig-size="281,139" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="coresdb_at_ep_" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/coresdb_at_ep_.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/coresdb_at_ep_.png" loading="lazy" width="281" height="139" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/coresdb_at_ep_.png" alt="" class="wp-image-38549" /><figcaption>The loading function is just at the Entry Point of core.sdb</figcaption></figure>



<p>The previous component was supposed to pass to the core.sdb an additional buffer with the data about the installed service: the name and the path. During its execution, core.sdb will look up this data. If found, it will delete the previously-created service, and the initial file that started the infection:</p>



<figure class="wp-block-image"><img data-attachment-id="38948" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/removing_the_service/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/removing_the_service.png" data-orig-size="473,630" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="removing_the_service" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/removing_the_service-225x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/removing_the_service-450x600.png" loading="lazy" width="473" height="630" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/removing_the_service.png" alt="" class="wp-image-38948" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/removing_the_service.png 473w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/removing_the_service-225x300.png 225w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/removing_the_service-450x600.png 450w" sizes="(max-width: 473px) 100vw, 473px" /><figcaption>Removing the initial service</figcaption></figure>



<p>Getting rid of the previous persistence method suggests that it will be replaced by some different technique. Knowing previous editions of Hidden Bee, we can suspect that it may be a bootkit.</p>



<p>After locking the mutex in a format Global\SC_{%08lx-%04x-%04x-%02x%02x-%02x%02x%02x%02x%02x%02x}, the module proceeds to download another component. But before it goes to download, first, a few things are checked.</p>



<figure class="wp-block-image"><img data-attachment-id="38552" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/can_continue/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/can_continue.png" data-orig-size="693,442" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="can_continue" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/can_continue-300x191.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/can_continue-600x383.png" loading="lazy" width="693" height="442" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/can_continue.png" alt="" class="wp-image-38552" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/can_continue.png 693w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/can_continue-300x191.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/can_continue-600x383.png 600w" sizes="(max-width: 693px) 100vw, 693px" /><figcaption>Checks done before download of the next module</figcaption></figure>



<p>First of all, there is a defensive check if any of the known debuggers or sniffers are running. If so, the function quits. </p>



<figure class="wp-block-image"><img data-attachment-id="38577" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/blacklisted_names/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/blacklisted_names.png" data-orig-size="639,228" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="blacklisted_names" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/blacklisted_names-300x107.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/blacklisted_names-600x214.png" loading="lazy" width="639" height="228" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/blacklisted_names.png" alt="" class="wp-image-38577" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/blacklisted_names.png 639w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/blacklisted_names-300x107.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/blacklisted_names-600x214.png 600w" sizes="(max-width: 639px) 100vw, 639px" /><figcaption>The blacklist</figcaption></figure>



<p>Also, there is a check if the application can open a file &#8216;\??\NPF-{0179AC45-C226-48e3-A205-DCA79C824051}&#8217;.</p>



<p>If all the checks pass, the function proceeds and queries the following URL, where GET variables contain the system fingerprint:</p>



<p><code>sltp://bbs.favcom.space:1108/setup.bin?id=999&amp;sid=0&amp;sz=a7854b960e59efdaa670520bb9602f87&amp;os=65542&amp;ar=0</code></p>



<p>The hash (sz=) is an MD5 generated from VolumeIDs. Then follows the (os=) identifying version of the operating system, and the identifier of the architecture (ar=), where 0 means 32 bit, 1 means 64bit.</p>



<p>The content downloaded from this URL (starting from a magic DWORD 0xFEEDFACE &#8211; <a rel="noreferrer noopener" aria-label="79e851622ac5298198c04034465017c0 (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=79e851622ac5298198c04034465017c0" target="_blank">79e851622ac5298198c04034465017c0</a>) contains the encrypted package (in !rbx format), and a shellcode that will be used to unpack it. The shellcode is loaded to the current process and then executed.</p>



<figure class="wp-block-image"><img data-attachment-id="38946" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/load_shellcode-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_shellcode-1.png" data-orig-size="588,294" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="load_shellcode" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_shellcode-1-300x150.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_shellcode-1.png" loading="lazy" width="588" height="294" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_shellcode-1.png" alt="" class="wp-image-38946" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_shellcode-1.png 588w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_shellcode-1-300x150.png 300w" sizes="(max-width: 588px) 100vw, 588px" /><figcaption>The &#8216;FEEDFACE&#8217; module contains the shellcode to be loaded</figcaption></figure>



<p>The shellcode&#8217;s start function uses three parameters: pointer to the functions in the previous module (core sdb), pointer to the buffer with encrypted data, size of the encrypted data.</p>



<figure class="wp-block-image"><img data-attachment-id="38947" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/calling_the_shellcode/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_the_shellcode.png" data-orig-size="581,274" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="calling_the_shellcode" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_the_shellcode-300x141.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_the_shellcode.png" loading="lazy" width="581" height="274" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_the_shellcode.png" alt="" class="wp-image-38947" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_the_shellcode.png 581w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_the_shellcode-300x141.png 300w" sizes="(max-width: 581px) 100vw, 581px" /><figcaption>The loader calling the shellcode</figcaption></figure>



<h4 id="mce_27">Fourth stage: the shellcode decrypting !rbx</h4>



<p>The beginning of the loaded shellcode:</p>



<figure class="wp-block-image"><img data-attachment-id="38942" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/shellcode_bgn/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/shellcode_bgn.png" data-orig-size="397,206" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="shellcode_bgn" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/shellcode_bgn-300x156.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/shellcode_bgn.png" loading="lazy" width="397" height="206" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/shellcode_bgn.png" alt="" class="wp-image-38942" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/shellcode_bgn.png 397w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/shellcode_bgn-300x156.png 300w" sizes="(max-width: 397px) 100vw, 397px" /></figure>



<p>The shellcode does not fill any imports by itself. Instead, it fully relies on the functions from core.sdb module, to which it passes the pointer. It makes use of the following function: malloc, mecpy, memfree, VirtualAlloc. </p>



<figure class="wp-block-image"><img data-attachment-id="38589" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/calling_via_coresdb/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_via_coresdb.png" data-orig-size="554,216" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="calling_via_coresdb" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_via_coresdb-300x117.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_via_coresdb.png" loading="lazy" width="554" height="216" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_via_coresdb.png" alt="" class="wp-image-38589" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_via_coresdb.png 554w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/calling_via_coresdb-300x117.png 300w" sizes="(max-width: 554px) 100vw, 554px" /><figcaption>Example: calling malloc via core.sdb</figcaption></figure>



<p>Its role is to reveal another part. It comes in an encrypted package starting from a marker !rbx. The decryption function is called just at the beginning:</p>



<figure class="wp-block-image"><img data-attachment-id="38583" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/decrypt_rbx/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_rbx.png" data-orig-size="418,209" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="decrypt_rbx" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_rbx-300x150.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_rbx.png" loading="lazy" width="418" height="209" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_rbx.png" alt="" class="wp-image-38583" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_rbx.png 418w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/decrypt_rbx-300x150.png 300w" sizes="(max-width: 418px) 100vw, 418px" /><figcaption>Calling the decrypting function (at Entry Point of the shellcode)</figcaption></figure>



<p>First, the function checks the !rbx marker and the checksum at the beginning of the encrypted buffer:</p>



<figure class="wp-block-image"><img data-attachment-id="38584" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/checking_the_marker/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_the_marker.png" data-orig-size="549,443" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="checking_the_marker" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_the_marker-300x242.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_the_marker.png" loading="lazy" width="549" height="443" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_the_marker.png" alt="" class="wp-image-38584" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_the_marker.png 549w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_the_marker-300x242.png 300w" sizes="(max-width: 549px) 100vw, 549px" /><figcaption>Checking marker and then checksum</figcaption></figure>



<p>It is decrypted with the help of RC4 algorithm, and then decompressed.</p>



<p>After decryption, the markers at the beginning of the buffer are checked. The expected format must start from predefined magic DWORDs: 0xCAFEBABE,0, 0xBABECAFE:</p>



<figure class="wp-block-image"><img data-attachment-id="38943" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/check_format/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_format.png" data-orig-size="590,517" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_format" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_format-300x263.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_format.png" loading="lazy" width="590" height="517" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_format.png" alt="" class="wp-image-38943" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_format.png 590w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_format-300x263.png 300w" sizes="(max-width: 590px) 100vw, 590px" /></figure>



<p><strong>The !rbx package format</strong></p>



<p>The !rbx is also a custom format with a consistent structure. </p>



<figure class="wp-block-image"><img data-attachment-id="38590" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/copy_afer_rbx_hdr/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/copy_afer_rbx_hdr.png" data-orig-size="616,140" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="copy_afer_rbx_hdr" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/copy_afer_rbx_hdr-300x68.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/copy_afer_rbx_hdr-600x136.png" loading="lazy" width="616" height="140" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/copy_afer_rbx_hdr.png" alt="" class="wp-image-38590" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/copy_afer_rbx_hdr.png 616w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/copy_afer_rbx_hdr-300x68.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/copy_afer_rbx_hdr-600x136.png 600w" sizes="(max-width: 616px) 100vw, 616px" /></figure>



<pre class="wp-block-preformatted">DWORD magic; // "!rbx"<br />DWORD checksum;<br />DWORD content_size;<br />BYTE rc4_key[16];<br />DWORD out_size;<br />BYTE content[];</pre>



<p><strong>The custom file system (BABECAFE)</strong></p>



<p> <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=a93c90a210aed61255dc34102335af8d" target="_blank">The full decrypted content</a> has a consistent structure, reminiscent of a file system. According to the previous reports, earlier versions of Hidden Bee used to adapt the ROMS filesystem, adding few modifications. They called their customized version &#8220;Mixed ROM FS&#8221;. Now it seems that their customization process has progressed. Also the keywords suggesting ROMFS cannot be found. The headers starts from the markers in the form of three DWORDS: { 0xCAFEBABE, 0, 0xBABECAFE }.</p>



<figure class="wp-block-image"><img data-attachment-id="38588" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/checkibng_babecafe_format/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checkibng_babecafe_format.png" data-orig-size="461,325" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="checkibng_babecafe_format" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checkibng_babecafe_format-300x211.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checkibng_babecafe_format.png" loading="lazy" width="461" height="325" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checkibng_babecafe_format.png" alt="" class="wp-image-38588" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checkibng_babecafe_format.png 461w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/checkibng_babecafe_format-300x211.png 300w" sizes="(max-width: 461px) 100vw, 461px" /></figure>



<p>The layout of BABECAFE FS:</p>



<figure class="wp-block-image"><img data-attachment-id="38592" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/babecafe_fs-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/babecafe_fs-1.png" data-orig-size="750,489" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="babecafe_fs" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/babecafe_fs-1-300x196.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/babecafe_fs-1-600x391.png" loading="lazy" width="750" height="489" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/babecafe_fs-1.png" alt="" class="wp-image-38592" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/babecafe_fs-1.png 750w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/babecafe_fs-1-300x196.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/babecafe_fs-1-600x391.png 600w" sizes="(max-width: 750px) 100vw, 750px" /></figure>



<p>We notice that it differs at many points from <a rel="noreferrer noopener" aria-label="ROM FS (opens in a new tab)" href="http://lxr.linux.no/#linux+v4.15.14/Documentation/filesystems/romfs.txt" target="_blank">ROM FS</a>, from which it evolved.</p>



<p>The structure contains the following files:</p>



<p>/bin/amd64/coredll.bin<br /> /bin/i386/coredll.bin<br /> /bin/i386/preload<br /> /bin/amd64/preload<br /> /pkg/sputnik.spk<br /> /installer/com_x86.dll (<a href="https://www.virustotal.com/#/file/04d62f3c9ab18370184a5aad9717434b5a8f71abadb92fcbc00b04d7dfa49a7d/details" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">6177bc527853fe0f648efd17534dd28b</a>)<br /> /installer/com_x64.dll<br /> /pkg/plugins.spk</p>



<p>The files /pkg/sputnik.spk and /pkg/plugins.spk are both compressed packages in a custom !rsi format.</p>



<figure class="wp-block-image"><img data-attachment-id="38628" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/rsi_package_bgn/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rsi_package_bgn.png" data-orig-size="613,102" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rsi_package_bgn" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rsi_package_bgn-300x50.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rsi_package_bgn-600x100.png" loading="lazy" width="613" height="102" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rsi_package_bgn.png" alt="" class="wp-image-38628" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rsi_package_bgn.png 613w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/rsi_package_bgn-300x50.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/rsi_package_bgn-600x100.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/rsi_package_bgn-604x102.png 604w" sizes="(max-width: 613px) 100vw, 613px" /><figcaption><br />Beginning of the !rsi package in the BABECAFE FS</figcaption></figure>



<p>Each of the spk packages contain another custom filesystem, identified by the keyword SPUTNIK (possibly the extension &#8216;spk&#8217; is derived from the  SPUTNIK format). They will be unpacked during the next steps of the execution.</p>



<p>Unpacked plugins.spk: <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=4c01273fb77550132c42737912cbeb36" target="_blank">4c01273fb77550132c42737912cbeb36</a><br />Unpacked sputnik.spk: <a href="https://malshare.com/sample.php?action=detail&amp;hash=36f3247dad5ec73ed49c83e04b120523" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">36f3247dad5ec73ed49c83e04b120523</a>.</p>



<p><strong>Selecting and running modules</strong></p>



<p>Some executables stored in the filesystem are in two version: 32 and 64 bit. Only the modules relevant to the current architecture are loaded. So, in the analyzed case, the loader chooses first: /bin/i386/preload (shellcode) and /bin/i386/coredll.bin (a module in NS custom format). The names are hardcoded in the loader within the loading shellcode:</p>



<figure class="wp-block-image"><img data-attachment-id="38585" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/loading_modules/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/loading_modules.png" data-orig-size="622,573" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="loading_modules" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/loading_modules-300x276.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/loading_modules-600x553.png" loading="lazy" width="622" height="573" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/loading_modules.png" alt="" class="wp-image-38585" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/loading_modules.png 622w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/loading_modules-300x276.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/loading_modules-600x553.png 600w" sizes="(max-width: 622px) 100vw, 622px" /><figcaption>Searching the modules in the custom file system</figcaption></figure>



<p>After the proper elements are fetched (preload and coredll.bin), they are copied together into a newly-allocated memory area. The coredll.bin is copied just after preload. Then, the preload module is called: </p>



<figure class="wp-block-image"><img data-attachment-id="38586" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/call_preload/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_preload.png" data-orig-size="439,98" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="call_preload" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_preload-300x67.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_preload.png" loading="lazy" width="439" height="98" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_preload.png" alt="" class="wp-image-38586" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_preload.png 439w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_preload-300x67.png 300w" sizes="(max-width: 439px) 100vw, 439px" /><figcaption>Redirecting execution to preload</figcaption></figure>



<p>The preload is position-independent, and its execution starts from the beginning of the page. </p>



<figure class="wp-block-image"><img data-attachment-id="38602" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/to_enter_preload/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_enter_preload.png" data-orig-size="537,261" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="to_enter_preload" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_enter_preload-300x146.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_enter_preload.png" loading="lazy" width="537" height="261" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_enter_preload.png" alt="" class="wp-image-38602" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_enter_preload.png 537w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_enter_preload-300x146.png 300w" sizes="(max-width: 537px) 100vw, 537px" /><figcaption>Entering &#8216;preload&#8217;</figcaption></figure>



<p>The only role of this shellcode is to prepare and run the coredll.bin. So, it contains a custom loader for the NS format that allocates another memory area and loads the NS file there.</p>



<h4 id="mce_27">Fifth stage: preload and coredll </h4>



<p>After loading coredll, preload redirects the execution there. <br /></p>



<figure class="wp-block-image"><img data-attachment-id="38603" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/coredll_ep/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/coredll_ep.png" data-orig-size="562,378" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="coredll_ep" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/coredll_ep-300x202.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/coredll_ep.png" loading="lazy" width="562" height="378" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/coredll_ep.png" alt="" class="wp-image-38603" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/coredll_ep.png 562w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/coredll_ep-300x202.png 300w" sizes="(max-width: 562px) 100vw, 562px" /><figcaption>coredll at its Entry Point</figcaption></figure>



<p>The coredll patches a function inside the NTDLL— KiUserExceptionDispatcher—redirecting one of the inner calls to its own code:</p>



<figure class="wp-block-image"><img data-attachment-id="38604" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/patched_kiuserdispatch/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/patched_kiuserdispatch.png" data-orig-size="822,143" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="patched_kiuserdispatch" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/patched_kiuserdispatch-300x52.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/patched_kiuserdispatch-600x104.png" loading="lazy" width="822" height="143" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/patched_kiuserdispatch.png" alt="" class="wp-image-38604" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/patched_kiuserdispatch.png 822w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/patched_kiuserdispatch-300x52.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/patched_kiuserdispatch-600x104.png 600w" sizes="(max-width: 822px) 100vw, 822px" /><figcaption>A patch inside KiUserExceptionDispatcher</figcaption></figure>



<p>Depending on which process the coredll was injected into, it can take one of a few paths of execution.</p>



<p>If it is running for the first time, it will try to inject itself again—this time into rundll32. For the purpose of the injection, it will again unpack the original !rbx package and use its original copy stored there.</p>



<figure class="wp-block-image"><img data-attachment-id="38606" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/to_unpack_rbx-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rbx-1.png" data-orig-size="327,146" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="to_unpack_rbx" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rbx-1-300x134.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rbx-1.png" loading="lazy" width="327" height="146" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rbx-1.png" alt="" class="wp-image-38606" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rbx-1.png 327w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rbx-1-300x134.png 300w" sizes="(max-width: 327px) 100vw, 327px" /><figcaption>Entering the unpacking function</figcaption></figure>



<figure class="wp-block-image"><img data-attachment-id="38607" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/checking_magic/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_magic.png" data-orig-size="325,166" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="checking_magic" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_magic-300x153.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_magic.png" loading="lazy" width="325" height="166" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_magic.png" alt="" class="wp-image-38607" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_magic.png 325w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/checking_magic-300x153.png 300w" sizes="(max-width: 325px) 100vw, 325px" /><figcaption>Inside the unpacking function: checking the magic &#8220;!rbx&#8221;</figcaption></figure>



<p>Then it will choose the modules depending on the bitness of the rundll32: </p>



<figure class="wp-block-image"><img data-attachment-id="38617" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/create_rundll32_suspended/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/create_rundll32_suspended.png" data-orig-size="620,324" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="create_rundll32_suspended" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/create_rundll32_suspended-300x157.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/create_rundll32_suspended-600x314.png" loading="lazy" width="620" height="324" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/create_rundll32_suspended.png" alt="" class="wp-image-38617" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/create_rundll32_suspended.png 620w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/create_rundll32_suspended-300x157.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/create_rundll32_suspended-600x314.png 600w" sizes="(max-width: 620px) 100vw, 620px" /></figure>



<p>It selects the pair of modules (preload/coredll.bin) appropriate for the architecture, either from the directory amd64 or from i386:</p>



<figure class="wp-block-image"><img data-attachment-id="38608" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/choose_modules/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/choose_modules.png" data-orig-size="769,614" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="choose_modules" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/choose_modules-300x240.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/choose_modules-600x479.png" loading="lazy" width="769" height="614" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/choose_modules.png" alt="" class="wp-image-38608" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/choose_modules.png 769w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/choose_modules-300x240.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/choose_modules-600x479.png 600w" sizes="(max-width: 769px) 100vw, 769px" /></figure>



<p>If the injection failed, it makes another attempt, this time trying to inject into dllhost:</p>



<figure class="wp-block-image"><img data-attachment-id="38609" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/try_inject/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/try_inject.png" data-orig-size="580,352" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="try_inject" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/try_inject-300x182.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/try_inject.png" loading="lazy" width="580" height="352" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/try_inject.png" alt="" class="wp-image-38609" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/try_inject.png 580w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/try_inject-300x182.png 300w" sizes="(max-width: 580px) 100vw, 580px" /></figure>



<p>Each time it uses the same, hardcoded parameter (<code>/Processid: {...}</code>) that is passed to the created process:</p>



<figure class="wp-block-image"><img data-attachment-id="38610" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/with_processid/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/with_processid.png" data-orig-size="653,286" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="with_processid" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/with_processid-300x131.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/with_processid-600x263.png" loading="lazy" width="653" height="286" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/with_processid.png" alt="" class="wp-image-38610" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/with_processid.png 653w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/with_processid-300x131.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/with_processid-600x263.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/with_processid-195x85.png 195w" sizes="(max-width: 653px) 100vw, 653px" /></figure>



<p>The thread context of the target process is modified, and then the thread is resumed, running the injected content:</p>



<figure class="wp-block-image"><img data-attachment-id="38611" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/injected_to_rundll32/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected_to_rundll32.png" data-orig-size="529,46" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="injected_to_rundll32" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected_to_rundll32-300x26.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected_to_rundll32.png" loading="lazy" width="529" height="46" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected_to_rundll32.png" alt="" class="wp-image-38611" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected_to_rundll32.png 529w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/injected_to_rundll32-300x26.png 300w" sizes="(max-width: 529px) 100vw, 529px" /></figure>



<p>Now, when we look inside the memory of rundll32, we can find the preload and coredll being mapped:</p>



<figure class="wp-block-image"><img data-attachment-id="38612" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/rundll32_injected_preload/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rundll32_injected_preload.png" data-orig-size="589,190" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rundll32_injected_preload" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rundll32_injected_preload-300x97.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rundll32_injected_preload.png" loading="lazy" width="589" height="190" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rundll32_injected_preload.png" alt="" class="wp-image-38612" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rundll32_injected_preload.png 589w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/rundll32_injected_preload-300x97.png 300w" sizes="(max-width: 589px) 100vw, 589px" /></figure>



<p>Inside the injected part, the execution follows a similar path: preload loads the coredll and redirects to its Entry Point. But then, another path of execution is taken.</p>



<p>The parameter passed to the coredll decides which round of execution it is. On the second round, another injection is made: this time to dllhost.exe. And finally, it proceeds to the final round, when other modules are unpacked from the BABECAFE filesystem.</p>



<figure class="wp-block-image"><img data-attachment-id="38613" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/to_unpack_spk/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_spk.png" data-orig-size="673,613" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="to_unpack_spk" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_spk-300x273.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_spk-600x547.png" loading="lazy" width="673" height="613" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_spk.png" alt="" class="wp-image-38613" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_spk.png 673w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_spk-300x273.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_spk-600x547.png 600w" sizes="(max-width: 673px) 100vw, 673px" /><figcaption>Parameter deciding which path to take</figcaption></figure>



<p>The unpacking function first searches by name for two more modules: sputnik.spk and plugins.spk. They are both in the mysterious !rsi format, which reminds us of !rbx, but has a slightly different structure.</p>



<figure class="wp-block-image"><img data-attachment-id="38614" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/find_sputnik_and_plugins/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/find_sputnik_and_plugins.png" data-orig-size="475,465" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="find_sputnik_and_plugins" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/find_sputnik_and_plugins-300x294.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/find_sputnik_and_plugins.png" loading="lazy" width="475" height="465" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/find_sputnik_and_plugins.png" alt="" class="wp-image-38614" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/find_sputnik_and_plugins.png 475w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/find_sputnik_and_plugins-300x294.png 300w" sizes="(max-width: 475px) 100vw, 475px" /></figure>



<p>Entering the function unpacking the first !rsi package:</p>



<figure class="wp-block-image"><img data-attachment-id="38616" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/to_unpack_rsi/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rsi.png" data-orig-size="522,300" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="to_unpack_rsi" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rsi-300x172.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rsi.png" loading="lazy" width="522" height="300" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rsi.png" alt="" class="wp-image-38616" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rsi.png 522w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_unpack_rsi-300x172.png 300w" sizes="(max-width: 522px) 100vw, 522px" /></figure>



<p>The function unpacking the !rsi format is structured similarly to the !rbx unpacking. It also starts from checking the keyword:</p>



<figure class="wp-block-image"><img data-attachment-id="38619" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/check_rsi_keyword/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_rsi_keyword.png" data-orig-size="545,174" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_rsi_keyword" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_rsi_keyword-300x96.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_rsi_keyword.png" loading="lazy" width="545" height="174" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_rsi_keyword.png" alt="" class="wp-image-38619" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_rsi_keyword.png 545w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_rsi_keyword-300x96.png 300w" sizes="(max-width: 545px) 100vw, 545px" /><figcaption>Checking &#8220;!rsi&#8221; keyword</figcaption></figure>



<p>As mentioned before, both !rsi packages are used to store filesystems marked with the keyword &#8220;SPUTNIK&#8221;. It is another custom filesystem invented by the Hidden Bee authors that contain additional modules.  </p>



<figure class="wp-block-image"><img data-attachment-id="38941" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/check_sputnik_keyword/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_keyword.png" data-orig-size="334,117" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_sputnik_keyword" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_keyword-300x105.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_keyword.png" loading="lazy" width="334" height="117" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_keyword.png" alt="" class="wp-image-38941" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_keyword.png 334w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_keyword-300x105.png 300w" sizes="(max-width: 334px) 100vw, 334px" /><figcaption>The &#8220;SPUTNIK&#8221; keyword is checked after the module is unpacked</figcaption></figure>



<p>Unpacking the sputnik.spk resulted in getting the following SPUTNIK module: <a href="https://malshare.com/sample.php?action=detail&amp;hash=455738924b7665e1c15e30cf73c9c377" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">455738924b7665e1c15e30cf73c9c377</a></p>



<figure class="wp-block-image"><img data-attachment-id="38615" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/check_sputnik_format/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_format.png" data-orig-size="544,298" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="check_sputnik_format" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_format-300x164.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_format.png" loading="lazy" width="544" height="298" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_format.png" alt="" class="wp-image-38615" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_format.png 544w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/check_sputnik_format-300x164.png 300w" sizes="(max-width: 544px) 100vw, 544px" /></figure>



<p>It is worth noting that the unpacked filesystem has inside of it four executables: two pairs consisting of NS and PE, appropriately 32 and 64 bit. In the currently-analyzed setup, 32 bit versions are deployed. </p>



<p>The NS module will be the next to be run. First, it is loaded by the current executable, and then the execution is redirected there. Interestingly, both !rsi modules are passed as arguments to the entry point of the new module. (They will be used later to retrieve more components.)</p>



<figure class="wp-block-image"><img data-attachment-id="38882" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/call_another/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_another.png" data-orig-size="559,313" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="call_another" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_another-300x168.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_another.png" loading="lazy" width="559" height="313" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_another.png" alt="" class="wp-image-38882" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_another.png 559w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_another-300x168.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_another-400x225.png 400w" sizes="(max-width: 559px) 100vw, 559px" /><figcaption>Calling the newly-loaded NS executable</figcaption></figure>



<h4 id="mce_29">Sixth stage: mpsi.dll (unpacked from SPUTNIK)</h4>



<p>Entering into the NS module starts another layer of the malware:</p>



<figure class="wp-block-image"><img data-attachment-id="38881" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/call_ns_ep/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_ns_ep.png" data-orig-size="680,415" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="call_ns_ep" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_ns_ep-300x183.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_ns_ep-600x366.png" loading="lazy" width="680" height="415" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_ns_ep.png" alt="" class="wp-image-38881" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_ns_ep.png 680w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_ns_ep-300x183.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/call_ns_ep-600x366.png 600w" sizes="(max-width: 680px) 100vw, 680px" /><figcaption>Entry Point of the NS module: the !rsi modules, perpended with their size, are passed </figcaption></figure>



<p>The analyzed module, converted to PE is available here: <a href="https://malshare.com/sample.php?action=detail&amp;hash=455738924b7665e1c15e30cf73c9c377" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">537523ee256824e371d0bc16298b3849</a> </p>



<p>This module is responsible for loading plugins. It will also create a named pipe through which it is will communicate with other modules. It sets up the commands that are going to be executed on demand. </p>



<p>This is how the beginning of the main function looks:</p>



<figure class="wp-block-image"><img data-attachment-id="38884" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/start_main/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/start_main.png" data-orig-size="586,341" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="start_main" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/start_main-300x175.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/start_main.png" loading="lazy" width="586" height="341" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/start_main.png" alt="" class="wp-image-38884" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/start_main.png 586w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/start_main-300x175.png 300w" sizes="(max-width: 586px) 100vw, 586px" /></figure>



<p>Like in previous cases, it starts from finishing to load itself (relocations and imports). Then, it patches the function in NTDLL. This is a common prolog in many HiddenBee modules.</p>



<p>Then, we have another phase of loading elements from the supplied packages. The path that will be taken depends on the runtime arguments. If the function received both !rsi packages, it will start by parsing one of them, retrieving loading submodules.<br /></p>



<p>First, the SPUTNIK filesystem must be unpacked from the !rsi package:</p>



<figure class="wp-block-image"><img data-attachment-id="38678" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/unpack_and_mount_plugins/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_and_mount_plugins.png" data-orig-size="537,430" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="unpack_and_mount_plugins" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_and_mount_plugins-300x240.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_and_mount_plugins.png" loading="lazy" width="537" height="430" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_and_mount_plugins.png" alt="" class="wp-image-38678" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_and_mount_plugins.png 537w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/unpack_and_mount_plugins-300x240.png 300w" sizes="(max-width: 537px) 100vw, 537px" /></figure>



<p>After being unpacked, it is mounted. The filesystems are mounted internally in the memory: A global structure is filled with pointers to appropriate elements of the filesystem.</p>



<figure class="wp-block-image"><a href="https://blog.malwarebytes.com/wp-content/uploads/2019/05/retrieve_plugins.png" data-rel="lightbox-image-4" data-rl_title="" data-rl_caption="" title=""><img data-attachment-id="38885" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/retrieve_plugins/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/retrieve_plugins.png" data-orig-size="758,606" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="retrieve_plugins" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/retrieve_plugins-300x240.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/retrieve_plugins-600x480.png" loading="lazy" width="758" height="606" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/retrieve_plugins.png" alt="" class="wp-image-38885" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/retrieve_plugins.png 758w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/retrieve_plugins-300x240.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/retrieve_plugins-600x480.png 600w" sizes="(max-width: 758px) 100vw, 758px" /></a></figure>



<p>At the beginning, we can see the list of the plugins that are going to be loaded: <a rel="noreferrer noopener" aria-label="cloudcompute.api (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=62a44aace15cb728f1f5f96a1c2a4a37" target="_blank">cloudcompute.api</a>, <a rel="noreferrer noopener" aria-label="deepfreeze.api (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=95a2387f103608f6eebcc64a01aefece" target="_blank">deepfreeze.api,</a> and <a rel="noreferrer noopener" aria-label="netscan.api (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=4b2d33b818f53377620ac159e9f8a613" target="_blank">netscan.api</a>. Those names are being appended to the root path of the modules.</p>



<figure class="wp-block-image"><img data-attachment-id="38679" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/rootpath/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rootpath.png" data-orig-size="385,122" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="rootpath" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rootpath-300x95.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rootpath.png" loading="lazy" width="385" height="122" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rootpath.png" alt="" class="wp-image-38679" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/rootpath.png 385w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/rootpath-300x95.png 300w" sizes="(max-width: 385px) 100vw, 385px" /></figure>



<p>Each module is fetched from the mounted filesystem and loaded:</p>



<figure class="wp-block-image"><img data-attachment-id="38886" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/load_plugin/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_plugin.png" data-orig-size="821,290" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="load_plugin" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_plugin-300x106.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_plugin-600x212.png" loading="lazy" width="821" height="290" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_plugin.png" alt="" class="wp-image-38886" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_plugin.png 821w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_plugin-300x106.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_plugin-600x212.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_plugin-470x165.png 470w" sizes="(max-width: 821px) 100vw, 821px" /><figcaption>Calling the function to load the plugin</figcaption></figure>



<p>Consecutive modules are loaded one after another in the same executable memory area. After the module is loaded, its header is erased. It is a common technique used in order to make dumping of the payload from the memory more difficult.</p>



<p>The cloudcompute.api is a plugin that will load the miner. More about the plugins will be explained in the next section of this post.</p>



<p>Reading its code, we find out that the SPUTNIK modules are filesystems that can be mounted and dismounted on demand. This module will be communicating with others with the help of a named pipe. It will be receiving commands and executing appropriate handlers.</p>



<p>Initialization of the commands&#8217; parser:</p>



<figure class="wp-block-image"><img data-attachment-id="38657" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/to_setup_commands/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_setup_commands.png" data-orig-size="371,343" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="to_setup_commands" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_setup_commands-300x277.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_setup_commands.png" loading="lazy" width="371" height="343" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_setup_commands.png" alt="" class="wp-image-38657" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_setup_commands.png 371w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_setup_commands-300x277.png 300w" sizes="(max-width: 371px) 100vw, 371px" /></figure>



<p>The function setting up the commands: For each name, a handler is registered. (This is probably the Lua dispatcher, first described <a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://www.freebuf.com/column/175106.html" target="_blank">here</a>.)</p>



<figure class="wp-block-image"><img data-attachment-id="38962" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/setup_commands-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/setup_commands-1.png" data-orig-size="442,443" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="setup_commands" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/setup_commands-1-300x300.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/setup_commands-1.png" loading="lazy" width="442" height="443" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/setup_commands-1.png" alt="" class="wp-image-38962" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/setup_commands-1.png 442w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/setup_commands-1-150x150.png 150w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/setup_commands-1-300x300.png 300w" sizes="(max-width: 442px) 100vw, 442px" /></figure>



<p> When plugins are run, we can see some additional child processes created by the process running the coredll (in the analyzed case it is inside rundll32):</p>



<figure class="wp-block-image"><img data-attachment-id="38680" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/plugin_running/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/plugin_running.png" data-orig-size="570,74" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="plugin_running" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/plugin_running-300x39.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/plugin_running.png" loading="lazy" width="570" height="74" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/plugin_running.png" alt="" class="wp-image-38680" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/plugin_running.png 570w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/plugin_running-300x39.png 300w" sizes="(max-width: 570px) 100vw, 570px" /></figure>



<p>Also it triggers a firewall alert, which means the malware requested to open some ports (triggered by netscan.api plugin):</p>



<figure class="wp-block-image"><img data-attachment-id="38963" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/open_ports/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/open_ports.png" data-orig-size="538,385" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="open_ports" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/open_ports-300x215.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/open_ports.png" loading="lazy" width="538" height="385" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/open_ports.png" alt="" class="wp-image-38963" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/open_ports.png 538w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/open_ports-300x215.png 300w" sizes="(max-width: 538px) 100vw, 538px" /></figure>



<p>We can see that it started listening on one TCP and one UDP port:</p>



<figure class="wp-block-image"><img data-attachment-id="38682" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/socket/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/socket.png" data-orig-size="432,169" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="socket" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/socket-300x117.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/socket.png" loading="lazy" width="432" height="169" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/socket.png" alt="" class="wp-image-38682" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/socket.png 432w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/socket-300x117.png 300w" sizes="(max-width: 432px) 100vw, 432px" /></figure>



<h3>The plugins</h3>



<p>As mentioned in the previous section, the SPUTNIK filesystem contains three plugins: <a rel="noreferrer noopener" href="https://malshare.com/sample.php?action=detail&amp;hash=62a44aace15cb728f1f5f96a1c2a4a37" target="_blank">cloudcompute.api</a>, <a rel="noreferrer noopener" href="https://malshare.com/sample.php?action=detail&amp;hash=95a2387f103608f6eebcc64a01aefece" target="_blank">deepfreeze.api</a>, and <a rel="noreferrer noopener" href="https://malshare.com/sample.php?action=detail&amp;hash=4b2d33b818f53377620ac159e9f8a613" target="_blank">netscan.api</a>. If we convert them to PE, we can see that all of them import an unknown DLL: mpsi.dll. When we see the filled import table, we find out that the addresses have been filled redirecting to the functions from the previous NS module:</p>



<figure class="wp-block-image"><img data-attachment-id="38891" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/mpsi_imports-2/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/mpsi_imports-1.png" data-orig-size="486,270" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="mpsi_imports" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/mpsi_imports-1-300x167.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/mpsi_imports-1.png" loading="lazy" width="486" height="270" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/mpsi_imports-1.png" alt="" class="wp-image-38891" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/mpsi_imports-1.png 486w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/mpsi_imports-1-300x167.png 300w" sizes="(max-width: 486px) 100vw, 486px" /></figure>



<p>So we can conclude that the previous element is the mpsi.dll. Although its export table has been destroyed, the functions are fetched by the custom loader and filled in the import tables of the loaded plugins.</p>



<p>First the cloudcompute.api is run.</p>



<p>This plugin retrieves from the filesystem a file named &#8220;/etc/ccmain.json&#8221; that contains the list of URLs:</p>



<figure class="wp-block-image"><img data-attachment-id="38887" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/next_part_addresses/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/next_part_addresses.png" data-orig-size="535,386" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="next_part_addresses" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/next_part_addresses-300x216.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/next_part_addresses.png" loading="lazy" width="535" height="386" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/next_part_addresses.png" alt="" class="wp-image-38887" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/next_part_addresses.png 535w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/next_part_addresses-300x216.png 300w" sizes="(max-width: 535px) 100vw, 535px" /></figure>



<p>Those are addresses from which another set of modules is going to be downloaded:</p>



<p><pre>["sstp://news.onetouchauthentication.online:443/mlf_plug.zip.sig","sstp://news.onetouchauthentication.club:443/mlf_plug.zip.sig","sstp://news.onetouchauthentication.icu:443/mlf_plug.zip.sig","sstp://news.onetouchauthentication.xyz:443/mlf_plug.zip.sig"]</pre></p>



<p>It also retrieves another component from the SPUTNIK filesystem: /bin/i386/ccmain.bin. This time, it is an executable in NE format (version converted to PE is available here: <a rel="noreferrer noopener" aria-label="367db629beedf528adaa021bdb7c12de (opens in a new tab)" href="https://malshare.com/sample.php?action=detail&amp;hash=367db629beedf528adaa021bdb7c12de" target="_blank">367db629beedf528adaa021bdb7c12de</a>)</p>



<figure class="wp-block-image"><img data-attachment-id="38892" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/load_ccmain/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_ccmain.png" data-orig-size="704,362" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="load_ccmain" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_ccmain-300x154.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_ccmain-600x309.png" loading="lazy" width="600" height="309" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_ccmain-600x309.png" alt="" class="wp-image-38892" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_ccmain-600x309.png 600w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_ccmain-300x154.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_ccmain.png 704w" sizes="(max-width: 600px) 100vw, 600px" /></figure>



<p>This is the component that is injected into msdtc.exe.</p>



<figure class="wp-block-image"><img data-attachment-id="38893" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/implanted_in_msdtc/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/implanted_in_msdtc.png" data-orig-size="621,295" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="implanted_in_msdtc" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/implanted_in_msdtc-300x143.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/implanted_in_msdtc-600x285.png" loading="lazy" width="621" height="295" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/implanted_in_msdtc.png" alt="" class="wp-image-38893" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/implanted_in_msdtc.png 621w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/implanted_in_msdtc-300x143.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/implanted_in_msdtc-600x285.png 600w" sizes="(max-width: 621px) 100vw, 621px" /><figcaption>The HiddenBee module mapped into msdtc.exe</figcaption></figure>



<p>The configuration is also copied into the remote process and is used to retrieve an additional package from the C&amp;C:</p>



<figure class="wp-block-image"><img data-attachment-id="38894" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/to_download_modules/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_download_modules.png" data-orig-size="524,496" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="to_download_modules" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_download_modules-300x284.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_download_modules.png" loading="lazy" width="524" height="496" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_download_modules.png" alt="" class="wp-image-38894" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_download_modules.png 524w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/to_download_modules-300x284.png 300w" sizes="(max-width: 524px) 100vw, 524px" /></figure>



<p>This is the plugin responsible for downloading and deploying the Mellifera Miner: core component of the Hidden Bee.</p>



<p>Next, the netscan.api loads module /bin/i386/kernelbase.bin (converted to PE: <a href="https://malshare.com/sample.php?action=detail&amp;hash=d7516ad354a3be2299759cd21e161a04" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">d7516ad354a3be2299759cd21e161a04</a>)</p>



<figure class="wp-block-image"><img data-attachment-id="38895" data-permalink="https://blog.malwarebytes.com/threat-analysis/2019/05/hidden-bee-lets-go-down-the-rabbit-hole/attachment/load_kernelbase/" data-orig-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_kernelbase.png" data-orig-size="629,262" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="load_kernelbase" data-image-description="" data-medium-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_kernelbase-300x125.png" data-large-file="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_kernelbase-600x250.png" loading="lazy" width="629" height="262" src="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_kernelbase.png" alt="" class="wp-image-38895" srcset="https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_kernelbase.png 629w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_kernelbase-300x125.png 300w, https://blog.malwarebytes.com/wp-content/uploads/2019/05/load_kernelbase-600x250.png 600w" sizes="(max-width: 629px) 100vw, 629px" /></figure>



<h3>The miner in APT-style</h3>



<p>Hidden Bee is an eclectic malware. Although it is a commodity malware used for cryptocurrency mining, its design reminds us of espionage platforms used by APTs. Going through all its components is exhausting, but also fascinating. The authors are highly professional, not only as individuals but also as a team, because the design is consistent in all its complexity.</p>



<h3>Appendix</h3>



<p><a href="https://github.com/hasherezade/hidden_bee_tools" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">https://github.com/hasherezade/hidden_bee_tools</a> &#8211; helper tools for parsing and converting Hidden Bee custom formats</p>



<p><a rel="noreferrer noopener" aria-label=" (opens in a new tab)" href="https://www.bleepingcomputer.com/news/security/new-underminer-exploit-kit-discovered-pushing-bootkits-and-coinminers/" target="_blank">https://www.bleepingcomputer.com/news/security/new-underminer-exploit-kit-discovered-pushing-bootkits-and-coinminers/</a></p>



<p>Articles about the previous version (in Chinese):  </p>



<ul><li><a href="https://www.freebuf.com/column/174581.html" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">https://www.freebuf.com/column/174581.html</a></li><li><a rel="noreferrer noopener" aria-label="https://www.freebuf.com/column/175106.html (opens in a new tab)" href="https://www.freebuf.com/column/175106.html" target="_blank">https://www.freebuf.com/column/175106.html</a></li></ul>



<p>Our first encounter with the Hidden Bee:</p>



<p><a href="https://blog.malwarebytes.com/threat-analysis/2018/07/hidden-bee-miner-delivered-via-improved-drive-by-download-toolkit/" target="_blank" rel="noreferrer noopener" aria-label=" (opens in a new tab)">https://blog.malwarebytes.com/threat-analysis/2018/07/hidden-bee-miner-delivered-via-improved-drive-by-download-toolkit/</a><br /></p>
</div>
        
      <div class="share-section">
          <p><b>SHARE THIS ARTICLE</b></p>
         


         <a class="socicon-facebook" target="_blank" href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D38182&t=Hidden+Bee%3A+Let%26%238217%3Bs+go+down+the+rabbit+hole" id="social-share-facebook" aria-label="Share this post on Facebook"></a>
         <a class="socicon-twitter" target="_blank" href="https://twitter.com/intent/tweet?text=Hidden+Bee%3A+Let%26%238217%3Bs+go+down+the+rabbit+hole+https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D38182&via=Malwarebytes" id="social-share-twitter" aria-label="Share this post on Twitter"></a> 
        
          <a class="socicon-linkedin" target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.malwarebytes.com%2F%3Fp%3D38182&title=Hidden+Bee%3A+Let%26%238217%3Bs+go+down+the+rabbit+hole&summary=&source=" id="social-share-linkedin" aria-label="Share this post on LinkedIn"></a>
          

        
          
        </div>
      <hr />
      <div class="comments-section">
        <p><b>COMMENTS</b></p>
<div id="disqus_thread"></div>
</div>
        </div>
      <hr />
      <div class="related-articles">
        <p><b>RELATED ARTICLES</b></p>
    <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/awareness/2021/01/adobe-flash-player-reaches-end-of-life/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2021/01/AdobeFlashPlayer-598x270.png" alt="Adobe Flash Player reaches end-of-life">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/awareness/" rel="category tag">Awareness</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/awareness/2021/01/adobe-flash-player-reaches-end-of-life/ ">Adobe Flash Player reaches end-of-life</a></h2>
            
          </div>
        </div>
                      <p class="desc"> January 6, 2021 - Adobe Flash Player has reached end-of-life. Here's why you might want to uninstall it.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/awareness/2021/01/adobe-flash-player-reaches-end-of-life/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/awareness/2021/01/adobe-flash-player-reaches-end-of-life/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="46089 https://blog.malwarebytes.com/?p=46089">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/threat-analysis/2020/11/malsmoke-operators-abandon-exploit-kits-in-favor-of-social-engineering-scheme/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2020/11/shutterstock_378646651-604x270.png" alt="Malsmoke operators abandon exploit kits in favor of social engineering scheme">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/threat-analysis/exploits-threat-analysis/" rel="category tag">Exploits</a> | <a href="https://blog.malwarebytes.com/category/threat-analysis/" rel="category tag">Threat analysis</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/threat-analysis/2020/11/malsmoke-operators-abandon-exploit-kits-in-favor-of-social-engineering-scheme/ ">Malsmoke operators abandon exploit kits in favor of social engineering scheme</a></h2>
            
          </div>
        </div>
                      <p class="desc"> November 16, 2020 - Threat actors behind malsmoke, one of the largest malvertising campaigns we've seen in recent months, have switched malware delivery tactics.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/threat-analysis/2020/11/malsmoke-operators-abandon-exploit-kits-in-favor-of-social-engineering-scheme/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/threat-analysis/2020/11/malsmoke-operators-abandon-exploit-kits-in-favor-of-social-engineering-scheme/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="45289 https://blog.malwarebytes.com/?p=45289">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/malwarebytes-news/2020/09/taurus-project-stealer-now-spreading-via-malvertising-campaign/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2015/09/photodune-4549927-internet-abstract-m-604x270.jpg" alt="Taurus Project stealer now spreading via malvertising campaign">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/malwarebytes-news/" rel="category tag">Malwarebytes news</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/malwarebytes-news/2020/09/taurus-project-stealer-now-spreading-via-malvertising-campaign/ ">Taurus Project stealer now spreading via malvertising campaign</a></h2>
            
          </div>
        </div>
                      <p class="desc"> September 24, 2020 - The Taurus Project stealer gains an additional distribution vector via exploit kit.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/malwarebytes-news/2020/09/taurus-project-stealer-now-spreading-via-malvertising-campaign/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/malwarebytes-news/2020/09/taurus-project-stealer-now-spreading-via-malvertising-campaign/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="44715 https://blog.malwarebytes.com/?p=44715">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/social-engineering/2020/09/malvertising-campaigns-come-back-in-full-swing/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2020/09/shutterstock_523273009-604x270.png" alt="Malvertising campaigns come back in full swing">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/social-engineering/" rel="category tag">Social engineering</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/social-engineering/2020/09/malvertising-campaigns-come-back-in-full-swing/ ">Malvertising campaigns come back in full swing</a></h2>
            
          </div>
        </div>
                      <p class="desc"> September 9, 2020 - Threat actors monetize on adult traffic in several large malvertising campaigns.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/social-engineering/2020/09/malvertising-campaigns-come-back-in-full-swing/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/social-engineering/2020/09/malvertising-campaigns-come-back-in-full-swing/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="44544 https://blog.malwarebytes.com/?p=44544">No Comments</span></a></div>
          </div> 

            <div class="post">
      <div class="large-card">
                  <div class="thumb">
            <a href="https://blog.malwarebytes.com/exploits-and-vulnerabilities/2020/04/copycat-criminals-abuse-malwarebytes-brand-in-malvertising-campaign/ ">
            <img src="https://blog.malwarebytes.com/wp-content/uploads/2020/04/shutterstock_1657362259-604x270.jpg" alt="Copycat criminals abuse Malwarebytes brand in malvertising campaign">
            </a>
          </div>
                    <div class="content">
            <p class="breadcrumbs hidden-xs"><a href="https://blog.malwarebytes.com/category/exploits-and-vulnerabilities/" rel="category tag">Exploits and vulnerabilities</a></p>
            
                      <h2><a href="https://blog.malwarebytes.com/exploits-and-vulnerabilities/2020/04/copycat-criminals-abuse-malwarebytes-brand-in-malvertising-campaign/ ">Copycat criminals abuse Malwarebytes brand in malvertising campaign</a></h2>
            
          </div>
        </div>
                      <p class="desc"> April 7, 2020 - This fake, copycat Malwarebytes site was set up by cybercriminals to distribute malware in a malvertising campaign. We examine the campaign—and the criminals' motives.</p>
            <div class="post-action"><a href="https://blog.malwarebytes.com/exploits-and-vulnerabilities/2020/04/copycat-criminals-abuse-malwarebytes-brand-in-malvertising-campaign/" class="continue-read">CONTINUE READING</a><a class="num-comments" href="https://blog.malwarebytes.com/exploits-and-vulnerabilities/2020/04/copycat-criminals-abuse-malwarebytes-brand-in-malvertising-campaign/#disqus_thread"><span class="dsq-postid" data-dsqidentifier="42907 https://blog.malwarebytes.com/?p=42907">No Comments</span></a></div>
          </div> 

          
        
      
      </div>
      
      
      
    </div>
    <div class="col-md-4" id="right-rail">
      <hr class="visible-xs visible-sm">



<!-- AUTHOR MODULE -->
<div class="right-rail-section author-info">
      <p><b>ABOUT THE AUTHOR</b></p>
              <div class="small-card">
            <img alt='' src='https://secure.gravatar.com/avatar/5d5dda1e7e00492cdb89a26415b1fa8f?s=96&#038;d=identicon&#038;r=g' srcset='https://secure.gravatar.com/avatar/5d5dda1e7e00492cdb89a26415b1fa8f?s=192&#038;d=identicon&#038;r=g 2x' class='avatar avatar-96 photo' height='96' width='96' loading='lazy'/>            <div class="content">
              <p class="details">
              <span class="name"><a href="https://blog.malwarebytes.com/author/hasherezade/" title="Posts by hasherezade" rel="author">hasherezade</a></span>
                
                                <span class="author-twitter"><a href="https://www.twitter.com/hasherezade" class="socicon-twitter" aria-label="See @hasherezade's tweets on Twitter"></a></span>
                                
                
                              <br/><span class="title">Malware Intelligence Analyst </span>
                            </p>

                            <p class="desc">Unpacks malware with as much joy as a kid unpacking candies.</p>
                          </div>
          </div>
      </div>

<!-- SUB CATEGORIES -->
      


	


         
<!-- TOP THREATS -->
    </div>
  </div>
</div>
  
</section>
</article>
  
  
      </div>


<script type="text/plain" class="optanon-category-3">
  var embeds = document.getElementsByClassName('embedded-video');
  var alts = document.getElementsByClassName('embedded-video-alt');
  if(embeds && alts) {
    for(var i = 0; i < embeds.length; i++) {
      embeds[i].src = embeds[i].dataset.src;
      embeds[i].style.display = 'inline-block';
    }

    for(var i = 0; i < alts.length; i++) {
      alts[i].style.display = 'none';
    }
  }
</script>

<script type="text/javascript">
    setTimeout(function() {
        var alts = document.getElementsByClassName('embedded-video-alt');
        for( i = 0; i < alts.length; i++) {
            alts[i].style.background = "none";
        }
    }, 2500);
</script>


<script type="text/plain" class="optanon-category-4">
  $("script[src='https://malwarebytesunpacked.disqus.com/embed.js']").each(function() {
    var scriptSrc = $(this).attr("src");
    var newScript = "<script type='text/javascript' async='' src='" + scriptSrc + "'>";
    $(this).before(newScript).remove();
  });
  
  $("link[href*='https://c.disquscdn.com/next/embed/lounge.bundle'], link[href*='https://c.disquscdn.com/next/embed/common.bundle']").each(function() {
    /**/
  });
  
</script>


<!-- for Labs Nav -->
<script>
var urlID = "blog";
</script>
<script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/labs-nav.js"></script>
<section id="labs-links">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
      <div class="lablink">
        <p><a href="/authors/" id="cta-labs-footernavigation-linkto-contributors-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/contributors.svg" alt="Silouette of person"><br>
            Contributors</a></p>

      </div>

      <div class="lablink">
        <p><a href="/threats/" id="cta-labs-footernavigation-linkto-threatcenter-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/threat-center.svg" alt="Malware"><br>
            Threat Center</a></p>
            
      </div>

      <div class="lablink">
        <p><a href="/glossary/" id="cta-labs-footernavigation-linkto-glossary-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/glossary.svg" alt="Book with bookmark"><br>
            Glossary</a></p>
            
      </div>

      <div class="lablink">
        <p><a href="/tech-support-scams/" id="cta-labs-footernavigation-linkto-scams-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/scams.svg" alt="Suspicious person"><br>
            Scams</a></p>
            
      </div>

      <div class="lablink">
        <p><a href="/write/" id="cta-labs-footernavigation-linkto-writeforlabs-en"><img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/write.svg" alt="Pencil"><br>
            Write for Labs</a></p>
            
      </div>
</div>
    </div>
  </div>
</section>


<footer class="refresh-footer">
    <div class="container">
        <div class="row links-row">
            <!-- newsletter -->
            <div class="col-md-3 col-xs-12 col-md-push-9 newsletter-col">
                <div class="row soc-icon-row newsletter-icons hidden-xs hidden-sm">
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-twitter-en" class="social socicon-twitter"
                           href="https://twitter.com/malwarebytes" aria-label="Visit Malwarebytes on Twitter"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-facebook-en" class="social socicon-facebook"
                           href="https://www.facebook.com/Malwarebytes/"
                           aria-label="Visit Malwarebytes on Facebook"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-linkedin-en" class="social socicon-linkedin"
                           href="https://www.linkedin.com/company/malwarebytes"
                           aria-label="Visit Malwarebytes on LinkedIn"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-youtube-en" class="social socicon-youtube"
                           href="https://www.youtube.com/user/Malwarebytes"
                           aria-label="Visit Malwarebytes on YouTube"></a>
                    </div>
                    <div class="footer-soc-icon">
                        <a id="cta-footer-social-instagram-en" class="social socicon-instagram-v2"
                           href="https://www.instagram.com/malwarebytesofficial/"
                           aria-label="Visit Malwarebytes on Instagram"></a>
                    </div>
                </div>
                <div class="row newsletter-refresh">
                    <div class="col-xs-12">
                        <h4>Cybersecurity info you can't do without</h4>
                        <p>Want to stay informed on the latest news in cybersecurity? Sign up for our newsletter and
                            learn
                            how to protect your computer from threats.</p>
                    </div>
                    <div class="col-xs-12">
                        <form class="newsletter-form form-inline" action="//www.malwarebytes.com/newsletter/" _lpchecked="1">
                            <div class="email-input">
                                <label for="cta-footer-newsletter-input-email-en"
                                       aria-label="cta-footer-newsletter-input-email-en"
                                       aria-labelledby="cta-footer-newsletter-input-email-en">
                                    <input type="text" class="email-input-field"
                                           id="cta-footer-newsletter-input-email-en" name="email"
                                           placeholder="Email address">
                                </label>
                                <input name="source" type="hidden" value="">
                                <input type="submit" class="submit-bttn" id="cta-footer-newsletter-subscribe-email-en"
                                       value="">
                            </div>
                        </form>
                    </div>
                </div>

            </div>
            <!--logo col-->
            <div class="col-md-2 col-xs-12 col-md-pull-3 footer-col">
                <div class="footer-logo hidden-xs hidden-sm">
                    <svg width="160px" height="25px" viewBox="0 0 160 25" version="1.1"
                         xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="Footer-desktop" transform="translate(-165.000000, -68.000000)" fill="#FFFFFF">
                                <g id="Footer">
                                    <g id="Group-3">
                                        <g transform="translate(165.000000, 68.000000)">
                                            <g id="logo">
                                                <path
                                                        d="M104.620758,6.81492418 L104.53414,6.84800885 L104.53414,0.579460088 C104.53414,0.43037976 104.412794,0.314384104 104.256721,0.347468775 L102.436133,0.61294337 C102.314787,0.61294337 102.245333,0.728939026 102.245333,0.844934683 L102.245333,19.1016943 C102.245333,19.21769 102.33235,19.3340842 102.436133,19.3340842 C104.01363,19.6820712 105.99069,19.8315502 107.221712,19.8315502 C112.440783,19.8315502 113.151295,17.4434746 113.151295,14.840548 L113.151295,10.0313123 C113.151295,7.27890681 111.7642,5.86981868 109.076628,5.86981868 C107.135093,5.86981868 105.52247,6.36728459 104.620758,6.81492418 M110.827761,9.96514299 L110.827761,14.923459 C110.827761,16.7805854 110.238195,17.9078559 107.394949,17.9078559 C106.441346,17.9078559 105.504907,17.8249449 104.586031,17.7256909 L104.551304,17.7256909 L104.551304,8.85421552 L104.586031,8.85421552 C105.418288,8.47274526 107.152257,7.82580042 108.504625,7.82580042 C110.100084,7.80945739 110.827761,8.48908829 110.827761,9.96514299"
                                                        id="Fill-1"></path>
                                                <path
                                                        d="M116.202745,6.1348548 L114.469175,6.1348548 C114.313102,6.1348548 114.191357,6.28433374 114.226483,6.43341407 L118.612898,19.3675277 C118.647625,19.4835233 118.734244,19.516608 118.85559,19.516608 L119.375701,19.516608 C119.531774,19.516608 119.653519,19.6656883 119.618792,19.8151673 L117.884823,24.657089 C117.850095,24.8061694 117.971441,24.9556483 118.127115,24.9556483 L119.739738,24.9556483 C119.861084,24.9556483 119.930539,24.8727373 119.982829,24.8061694 L121.924763,19.5496927 L126.467251,6.43341407 C126.501978,6.28433374 126.380632,6.1348548 126.224559,6.1348548 L124.49059,6.1348548 C124.369244,6.1348548 124.300189,6.21776579 124.247898,6.28433374 L120.571996,17.2118421 C120.485377,17.4438334 120.173231,17.4438334 120.103776,17.2118421 L116.497727,6.28433374 C116.393945,6.21776579 116.306927,6.1348548 116.202745,6.1348548"
                                                        id="Fill-3"></path>
                                                <path
                                                        d="M137.858597,10.8605816 L137.858597,14.9068768 C137.858597,18.2731425 139.592566,19.8153666 143.389415,19.8153666 C145.002038,19.8153666 146.787898,19.549892 148.088375,19.135337 C148.21012,19.1022524 148.278776,18.9862567 148.245246,18.8702611 L148.001756,17.57677 C147.967029,17.4276897 147.846082,17.3447787 147.68961,17.3942064 C146.146441,17.7756766 144.759346,17.9582402 143.545887,17.9582402 C140.615224,17.9582402 140.112676,16.9796514 140.112676,14.8901352 L140.112676,13.9450297 C140.112676,13.7955508 140.234022,13.7126398 140.355368,13.7126398 L148.261612,13.7126398 C148.417685,13.7126398 148.504703,13.5966441 148.504703,13.4806485 L148.504703,10.9765773 C148.504703,7.57762552 146.805461,5.9524905 143.251304,5.9524905 C139.713512,5.86957951 137.858597,7.54454085 137.858597,10.8605816 L137.858597,10.8605816 Z M140.147005,10.7115013 C140.147005,8.63912529 141.135734,7.72710446 143.303195,7.72710446 C145.43553,7.72710446 146.302515,8.58929898 146.302515,10.7115013 L146.302515,11.6566068 C146.302515,11.8056871 146.181568,11.8885981 146.059823,11.8885981 L140.372931,11.8885981 C140.216858,11.8885981 140.12984,11.7726025 140.12984,11.6566068 L140.12984,10.7115013 L140.147005,10.7115013 Z"
                                                        id="Fill-5"></path>
                                                <path
                                                        d="M155.370725,11.888638 C152.995299,11.3254013 152.925845,11.0599267 152.925845,9.50135967 C152.925845,8.20786859 153.289883,7.76022899 155.370725,7.76022899 C156.359056,7.76022899 157.780479,7.87622465 158.977173,8.10821596 C159.133246,8.14169924 159.254193,8.02530497 159.254193,7.87622465 L159.375938,6.54925028 C159.375938,6.43325463 159.28892,6.31725897 159.185537,6.2841743 C158.075461,6.0186997 156.740656,5.86922077 155.474907,5.86922077 C151.954679,5.86922077 150.654601,6.84780955 150.654601,9.46827499 C150.654601,12.2202819 150.966747,12.9166545 154.45145,13.7457643 C157.260368,14.3927091 157.451169,14.5417895 157.451169,16.0840135 C157.451169,17.5269835 157.087131,17.9746231 154.763597,17.9746231 C153.65392,17.9746231 152.232497,17.7924581 151.053366,17.5269835 C150.897293,17.4938989 150.775548,17.5600682 150.74122,17.7095471 L150.498528,18.9532119 C150.463801,19.0692076 150.533255,19.1852032 150.654601,19.2182879 C151.799005,19.5997581 153.532974,19.8652327 154.885342,19.8652327 C158.95961,19.8652327 159.705248,18.5717417 159.705248,16.0011025 C159.722812,13.1323027 159.167974,12.8006588 155.370725,11.888638"
                                                        id="Fill-7"></path>
                                                <path
                                                        d="M48.2703991,19.417075 L45.7389002,6.3669657 C45.704173,6.21788537 45.8255189,6.06840643 45.9819912,6.06840643 L48.7909092,6.06840643 C48.9118559,6.06840643 49.033601,6.15131742 49.033601,6.25097004 L50.541643,14.1103733 C50.5763703,14.3762465 50.940408,14.3762465 51.0098626,14.1438566 L53.4547428,6.2342284 C53.489071,6.11823275 53.5760887,6.0520634 53.6974346,6.0520634 L57.0268626,6.0520634 C57.1478094,6.0520634 57.2168648,6.13497439 57.2691553,6.2342284 L59.7140355,14.1438566 C59.8006542,14.3762465 60.1475278,14.3762465 60.1822551,14.1103733 L61.6902971,6.25097004 C61.7250244,6.13497439 61.8120422,6.06840643 61.9333881,6.06840643 L64.7423061,6.06840643 C64.8979801,6.06840643 65.019326,6.21788537 64.9845987,6.3669657 L62.4359357,19.417075 C62.4012085,19.5330706 62.314989,19.5996386 62.1932439,19.5996386 L58.5177407,19.5996386 C58.3959956,19.5996386 58.326541,19.5167276 58.2746497,19.417075 L55.5874768,10.6452522 C55.500459,10.4132609 55.1883127,10.4132609 55.1192573,10.6452522 L52.4320843,19.417075 C52.3973571,19.5330706 52.3103393,19.5996386 52.1889934,19.5996386 L48.5130909,19.5996386 C48.391745,19.5996386 48.3051264,19.5330706 48.2703991,19.417075"
                                                        id="Fill-9"></path>
                                                <path
                                                        d="M44.1961309,17.1122293 C42.9303814,17.1122293 42.5312173,16.5816787 42.5312173,15.0725394 L42.5312173,5.27270015 L42.5312173,1.40856993 C42.5312173,1.25948961 42.4098714,1.14309534 42.2541974,1.17657862 L39.2025876,1.59113354 C39.0812417,1.59113354 39.0117872,1.70752781 39.0117872,1.82352347 L39.0117872,1.93951912 L39.0117872,5.27270015 L39.0117872,15.437268 C39.0117872,18.505373 40.9537207,19.8650334 43.554275,19.8650334 C43.8320932,19.8650334 44.733805,19.8315502 45.2535167,19.7817238 C45.3748626,19.7817238 45.4962085,19.6657282 45.4962085,19.5497325 L45.4962085,17.3940469 C45.4962085,17.2449666 45.3748626,17.1620556 45.2191885,17.1620556 C44.8723149,17.1122293 44.4040954,17.1122293 44.1961309,17.1122293"
                                                        id="Fill-11"></path>
                                                <path
                                                        d="M87.0914657,9.02011721 C85.8257163,9.55066779 84.8030578,10.114303 83.658255,10.8274172 C83.5720356,10.8605019 83.5373083,10.9434129 83.5373083,11.0099808 L83.5373083,19.3672486 C83.5373083,19.5167276 83.4155633,19.5996386 83.2942174,19.5996386 L80.2426076,19.5996386 C80.0865344,19.5996386 79.9999158,19.4832443 79.9999158,19.3672486 L79.9999158,6.78152062 C79.9999158,6.66552497 80.0865344,6.54952931 80.1907163,6.54952931 L82.7222152,6.13457578 C82.8782883,6.10149111 82.9996342,6.21748676 82.9996342,6.31713939 L83.1209801,7.1793339 C83.1557074,7.36189752 83.3636719,7.4448085 83.5197451,7.32881284 C84.317275,6.83134694 85.5834236,6.20114373 86.6060821,5.85275815 C86.7621553,5.81967348 86.9178293,5.88624143 86.9178293,6.03532176 L87.1956475,8.68847327 C87.2475389,8.85429524 87.1784835,8.93720622 87.0914657,9.02011721"
                                                        id="Fill-13"></path>
                                                <path
                                                        d="M134.217781,17.9744637 C132.795559,17.9744637 132.709339,17.3777438 132.709339,16.4322396 L132.709339,8.22405217 C132.709339,8.07497184 132.830286,7.99206086 132.951632,7.99206086 L136.28106,7.99206086 C136.402406,7.99206086 136.523353,7.90914987 136.523353,7.76006955 L136.679825,6.43349379 C136.679825,6.28401485 136.55808,6.1680192 136.437133,6.1680192 L132.951632,6.1680192 C132.795559,6.1680192 132.709339,6.05202354 132.709339,5.93562927 L132.709339,2.81889375 C132.709339,2.66941482 132.587594,2.55302055 132.431521,2.58650383 L130.611333,2.85197843 C130.489987,2.85197843 130.420532,2.96757547 130.420532,3.08357113 L130.420532,5.95237092 C130.420532,6.10184985 130.299186,6.18476084 130.17784,6.18476084 L128.20118,6.18476084 C128.045107,6.18476084 127.958089,6.3007565 127.958089,6.41675215 L127.958089,7.74332791 C127.958089,7.89240823 128.079834,7.97531922 128.20118,7.97531922 L130.17784,7.97531922 C130.333914,7.97531922 130.420532,8.09171348 130.420532,8.20770914 L130.420532,16.7638836 C130.420532,18.9195692 131.408863,19.7817637 133.853344,19.7817637 C134.408581,19.7817637 134.96302,19.748679 135.518257,19.6326834 C135.639603,19.5995987 135.708659,19.5166877 135.708659,19.4006921 L135.708659,18.0741163 C135.708659,17.9246374 135.552985,17.8086417 135.43124,17.8417264 C134.980184,17.941379 134.581818,17.9744637 134.217781,17.9744637"
                                                        id="Fill-15"></path>
                                                <path
                                                        d="M97.3387274,6.21776579 C96.5930888,5.91920652 95.6394857,5.72029988 94.4084635,5.72029988 C93.0213682,5.72029988 91.9631841,5.95229119 91.131326,6.31741841 C89.1893925,7.22943924 88.565499,9.00365459 88.565499,10.9600349 L88.565499,14.5586906 C88.565499,17.7423926 90.0216497,19.698773 94.2523903,19.781684 L95.2403216,19.781684 C96.3847251,19.781684 97.58102,19.6656883 98.6739314,19.5162094 C98.7948781,19.4831247 98.916224,19.3675277 98.8639335,19.251532 L98.8639335,19.1351377 L98.5869136,17.2780114 C97.5119646,17.3940071 96.5755256,17.4274903 95.5009757,17.4274903 C92.9000223,17.4274903 92.1024923,16.7143762 92.1024923,15.1888938 L92.1024923,14.7408556 L92.1024923,14.111051 L99.7313172,14.111051 C99.8873903,14.111051 99.974009,13.9946567 99.974009,13.878661 L99.974009,12.8506446 L99.974009,11.1920263 C99.9396808,9.02039623 99.4016076,7.07996031 97.3387274,6.21776579 L97.3387274,6.21776579 Z M96.8182174,11.5906368 C96.8182174,11.7397171 96.6972706,11.8226281 96.5755256,11.8226281 L92.0677651,11.8226281 L92.0677651,10.644734 C92.0677651,9.35164156 92.6569313,8.48944704 94.4084635,8.48944704 C94.599264,8.48944704 94.8068293,8.48944704 94.9980289,8.52293033 C96.2985057,8.70509533 96.8182174,9.5505482 96.8182174,10.644734 L96.8182174,11.5906368 Z"
                                                        id="Fill-17"></path>
                                                <path
                                                        d="M10.6807539,21.9044842 L10.7673725,21.9044842 C10.9230465,21.9044842 11.0443924,21.7825165 11.0443924,21.6257607 C11.0443924,21.5033739 10.9577738,21.3466181 10.8020998,21.3466181 L10.715082,21.3466181 L10.5242816,21.31183 C7.31659864,20.6839687 4.94157208,17.8070392 4.94157208,14.4414006 C4.94157208,13.0121568 5.37506432,11.6520699 6.12030375,10.5539413 C6.24204881,10.3967664 6.4324501,10.2747986 6.64081377,10.4667616 L11.7038116,15.6271281 C11.7377405,15.6619161 11.8247583,15.7143078 11.8942129,15.7143078 C11.9808315,15.7143078 12.050286,15.6795197 12.0850133,15.6271281 L17.1823392,10.5015496 C17.3731397,10.3095867 17.5467761,10.3447939 17.6509579,10.5363377 C18.3961974,11.6520699 18.8296896,12.9949723 18.8296896,14.4242161 C18.8296896,16.2197822 18.1535056,17.8418273 17.0434301,19.0799464 C17.009102,19.1147344 16.9572107,19.1671261 16.9224834,19.2019141 C16.9224834,19.2367022 16.8877561,19.2890938 16.8877561,19.3238818 C16.8877561,19.4810567 17.009102,19.6030245 17.1651752,19.6030245 L17.1999025,19.6030245 C17.2346297,19.6030245 17.2865211,19.5682364 17.3212484,19.5682364 C24.0830887,16.7084914 23.7713415,9.94368351 23.7713415,9.94368351 C23.7713415,6.09017397 21.9503548,2.62059033 19.1418359,0.441098316 C19.0204901,0.353918635 18.8296896,0.353918635 18.7426718,0.475886362 L12.1025765,7.24111341 C11.9808315,7.36308113 11.790031,7.36308113 11.6690843,7.24111341 L4.97590019,0.475886362 C4.8545543,0.353918635 4.69888029,0.353918635 4.57753439,0.441098316 C1.82050776,2.62059033 -7.98328266e-05,6.03778233 -7.98328266e-05,9.94368351 C-7.98328266e-05,16.1502062 4.66415301,21.2766229 10.6807539,21.9044842"
                                                        id="Fill-19"></path>
                                                <path
                                                        d="M29.9264125,5.80321087 C28.6953903,5.80321087 27.3949136,5.88612185 26.1638914,6.06828685 C26.0425455,6.10177013 25.9211996,6.21776579 25.9730909,6.33376145 L26.25051,8.37345139 C26.2852373,8.48944704 26.3722551,8.6054427 26.5275299,8.6054427 C27.6723326,8.48944704 28.4179712,8.45636237 29.5795388,8.45636237 C32.1800931,8.45636237 32.9780222,9.16907795 32.9780222,10.694959 L32.9780222,11.6073784 C32.9780222,11.7564587 32.8566763,11.8393697 32.7349313,11.8393697 L29.4577938,11.8393697 C26.5798204,11.8393697 24.8634147,13.2317162 24.8634147,15.768872 C24.8634147,18.1071213 26.7534568,19.781684 29.6146653,19.781684 C31.4001264,19.781684 32.1114369,19.516608 32.7006031,18.9860574 C32.8566763,18.8365785 33.1340954,18.9525741 33.1340954,19.1351377 L33.1340954,19.3177014 C33.1340954,19.4667817 33.2554413,19.5496927 33.3767872,19.5496927 L36.2547605,19.5496927 C36.4108337,19.5496927 36.4978515,19.433697 36.4978515,19.3177014 L36.4978515,10.794213 C36.5321796,7.42834589 34.0876985,5.80321087 29.9264125,5.80321087 L29.9264125,5.80321087 Z M33.0123503,14.5750336 C33.0123503,16.2830796 31.8332195,17.4107487 29.9264125,17.4107487 C28.4702617,17.4107487 27.7070599,16.8801981 27.7070599,15.7856137 C27.7070599,14.5750336 28.5045898,14.0775677 29.9264125,14.0775677 L32.7349313,14.0775677 C32.8914036,14.0775677 32.9780222,14.1935633 32.9780222,14.3099576 L32.9780222,14.5750336 L33.0123503,14.5750336 Z"
                                                        id="Fill-21"></path>
                                                <path
                                                        d="M70.879694,5.80321087 C69.649071,5.80321087 68.3485943,5.88612185 67.1175721,6.06828685 C66.9962262,6.10177013 66.8748803,6.21776579 66.9267717,6.33376145 L67.2041908,8.37345139 C67.238918,8.48944704 67.3255366,8.6054427 67.4812107,8.6054427 C68.6260134,8.48944704 69.371652,8.45636237 70.5332196,8.45636237 C73.1337739,8.45636237 73.931703,9.16907795 73.931703,10.694959 L73.931703,11.6073784 C73.931703,11.7564587 73.8099579,11.8393697 73.688612,11.8393697 L70.4118737,11.8393697 C67.5335012,11.8393697 65.8170954,13.2317162 65.8170954,15.768872 C65.8170954,18.1071213 67.7071376,19.781684 70.5679469,19.781684 C72.353408,19.781684 73.0647185,19.516608 73.6538847,18.9860574 C73.8099579,18.8365785 74.0877761,18.9525741 74.0877761,19.1351377 L74.0877761,19.3177014 C74.0877761,19.4667817 74.209122,19.5496927 74.3304679,19.5496927 L77.2084413,19.5496927 C77.3645145,19.5496927 77.4515323,19.433697 77.4515323,19.3177014 L77.4515323,10.794213 C77.5377517,7.42834589 75.0413792,5.80321087 70.879694,5.80321087 L70.879694,5.80321087 Z M73.9660311,14.5750336 C73.9660311,16.2830796 72.7869003,17.4107487 70.879694,17.4107487 C69.4235433,17.4107487 68.6603415,16.8801981 68.6603415,15.7856137 C68.6603415,14.5750336 69.4578714,14.0775677 70.879694,14.0775677 L73.688612,14.0775677 C73.8450844,14.0775677 73.931703,14.1935633 73.931703,14.3099576 L73.931703,14.5750336 L73.9660311,14.5750336 Z"
                                                        id="Fill-23"></path>
                                            </g>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                </div>
                <p class="col-header imagine-title">Imagine a world without malware. We do. </p>

                <p>
                    <a href="//www.malwarebytes.com/for-home/" id="cta-footernavigation-company-linkto-for_home-en" class="for-home-link-en">FOR
                        PERSONAL</a>
                </p>
                <p>
                    <a href="//www.malwarebytes.com/business/" id="cta-footernavigation-company-linkto-for_business-en">FOR
                        BUSINESS</a>
                </p>

            </div>
            <!-- company -->
            <div class="col-md-2 col-xs-12 col-md-pull-3 footer-col company-col">
                <p class="col-header">COMPANY</p>
                <p>
                    <a href="//www.malwarebytes.com/company/" id="cta-footernavigation-company-linkto-about_us-en">ABOUT
                        US</a>
                </p>
                <p>
                    <a href="https://jobs.malwarebytes.com/"
                       id="cta-footernavigation-learn-linkto-careers-en">CAREERS</a>
                </p>
                <p>
                    <a href="https://press.malwarebytes.com/"
                       id="cta-footernavigation-learn-linkto-news_and_press-en">NEWS AND
                        PRESS</a>
                </p>
            </div>
            <!-- my account -->
            <div class="col-md-2 col-xs-12 col-md-pull-3 footer-col">
                <p class="col-header">MY ACCOUNT</p>
                <p>
                    <a href="https://my.malwarebytes.com/en/login"
                       id="cta-footernavigation-myaccount-linkto-sign_in-en">SIGN
                        IN</a>
                </p>
            </div>
            <!-- contact us -->
            <div class="col-md-3 col-xs-12 col-md-pull-3 footer-col">
                <p class="col-header">CONTACT US</p>
                <p>
                    <a href="https://support.malwarebytes.com/hc/en-us" class="pillar-page-lightbox"
                       id="cta-footernavigation-contactus-linkto-get_support-en">GET
                        SUPPORT</a>
                </p>
                <p>
                    <a href="https://www.malwarebytes.com/contact/" class="pillar-page-lightbox"
                       id="cta-footernavigation-contactus-linkto-contact_sales-en">CONTACT
                        SALES</a>
                </p>
                <div class="address">
                    <!-- icon here -->
                    <div class="hq">
                        <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/ic-pin-map.svg" alt="Map pin">
                        <div class="address-text">
                            3979 Freedom Circle, 12th Floor<br />Santa Clara, CA 95054
                        </div>
                    </div>
                    <div class="local hidden outside-na">
                        <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/ic-pin-map.svg" alt="Map pin">
                        <div class="address-text">
                            One Albert Quay, 2nd Floor<br />Cork T12 X8N6<br />Ireland
                        </div>
                    </div>
                </div>

            </div>

        </div>
        <div class="row soc-icon-row hidden-md hidden-lg">
            <div class="footer-soc-icon">
                <a id="cta-footer-social-twitter-en" class="social socicon-twitter"
                   href="https://twitter.com/malwarebytes" aria-label="Visit Malwarebytes on Twitter"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-facebook-en" class="social socicon-facebook"
                   href="https://www.facebook.com/Malwarebytes/" aria-label="Visit Malwarebytes on Facebook"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-linkedin-en" class="social socicon-linkedin"
                   href="https://www.linkedin.com/company/malwarebytes"
                   aria-label="Visit Malwarebytes on LinkedIn"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-youtube-en" class="social socicon-youtube"
                   href="https://www.youtube.com/user/Malwarebytes" aria-label="Visit Malwarebytes on YouTube"></a>
            </div>
            <div class="footer-soc-icon">
                <a id="cta-footer-social-instagram-en" class="social socicon-instagram-v2"
                   href="https://www.instagram.com/malwarebytesofficial/"
                   aria-label="Visit Malwarebytes on Instagram"></a>
            </div>
        </div>

    </div>
    <div class="footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-xs-10 col-md-2">
                    <div class="lang-select-container">
                        <img src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/images/footer/world.svg" alt="Globe icon">
                        &nbsp;&nbsp; <a href="#" class="language-select col-header"
                                        id="cta-footernavigation-linkto-languageselect-en">English</a>
                    </div>
                </div>
                <div class="col-xs-12 col-md-10 legal-list-col">
                    <div class="legal-list">
                        <div class="legal-link">
                            <a class="legal" href="//www.malwarebytes.com/legal/" id="cta-footernavigation-linkto-legal-en">Legal</a>
                        </div>
                        <div class="legal-link">
                            <a class="legal" href="//www.malwarebytes.com/privacy/" id="cta-footernavigation-linkto-privacy-en">Privacy</a>
                        </div>
                        <div class="legal-link">
                            <a class="legal" href="//www.malwarebytes.com/accessibility/"
                               id="cta-footernavigation-linkto-accessibility-en">Accessibility</a>
                        </div>

                        <div class="legal-link legal-last">
                            <a class="legal" href="//www.malwarebytes.com/tos/" id="cta-footernavigation-linkto-tos-en">Terms of Service</a>
                        </div>
                    </div>
                    <br class="hidden-md hidden-lg">
                    <p class="p-year">&copy;
                        <script>
                          $(document).ready(function () {
                            var d = new Date();
                            var year = d.getFullYear();
                            $(".currentYear").text(year);
                          });
                        </script><span class="currentYear"></span> All Rights Reserved</p>
                </div>
            </div>

        </div>
    </div>

</footer>

<!-- language select overlay -->
<section id="overlay-lang" class="text-center text-white" style="overflow-y: scroll;">
  <div class="container">
    <div class="row center-row">
      <div class="col-md-10">
     
        <p class="h2">Select your language</p>
      </div>
    </div>
    <div class="row center-row">
      <div class="col-md-5">
        <div class="text-center">
          <ul class="list-unstyled" id="intl-sites">
            </ul>
        </div>
      </div>
      
    </div>
  </div>
</section>
<!-- pillar page select overlay -->
<section id="pillar-pages" class="text-white overlay" style="overflow-y: scroll; display: none;">
  <div class="container">
    <div class="row">
      <div class="col-md-10">
        <p class="h2"><a href="https://www.malwarebytes.com/cybersecurity/" id="cta-labs-footernavigation-lightbox-learn-linkto-cybersecurity-en">Cybersecurity basics</a></p>
        <p>Your intro to everything relating to cyberthreats, and how to stop them.</p>
      </div>
    </div>
    <div class="row"> 
      <div class="col-md-8 pillar-pages-list">
              
              
              
            </div>
    </div>
  </div>
</section>
 <script>
  overlay('.language-select', '#overlay-lang');
  overlay('.pillar-page-lightbox', '#pillar-pages');
</script>

	<div style="display:none">
	<div class="grofile-hash-map-5d5dda1e7e00492cdb89a26415b1fa8f">
	</div>
	</div>
<link rel='stylesheet' id='jetpack-gist-styling-css'  href='https://github.githubassets.com/assets/gist-embed-b09c7e88e117e1fd6852e6ac73c952b3.css?ver=9.4' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-carousel-css'  href='https://blog.malwarebytes.com/wp-content/plugins/jetpack/modules/carousel/jetpack-carousel.css?ver=9.4' type='text/css' media='all' />
<script type='text/javascript' id='disqus_count-js-extra'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"malwarebytesunpacked"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.21' id='disqus_count-js'></script>
<script type='text/javascript' id='disqus_embed-js-extra'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.21"},"disqusIdentifier":"38182 https:\/\/blog.malwarebytes.com\/?p=38182","disqusShortname":"malwarebytesunpacked","disqusTitle":"Hidden Bee: Let\u2019s go down the rabbit hole","disqusUrl":"https:\/\/blog.malwarebytes.com\/threat-analysis\/2019\/05\/hidden-bee-lets-go-down-the-rabbit-hole\/","postId":"38182"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.21' id='disqus_embed-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/imagesloaded.min.js?ver=4.1.4' id='imagesloaded-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/masonry.min.js?ver=4.2.2' id='masonry-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2b' id='jquery-masonry-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/functions.js?ver=2013-07-18' id='mb_labs-script-js'></script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-includes/js/wp-embed.min.js?ver=5.6.2' id='wp-embed-js'></script>
<script type='text/javascript' id='jetpack-carousel-js-extra'>
/* <![CDATA[ */
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/blog.malwarebytes.com\/wp-admin\/admin-ajax.php","nonce":"d36e4f7e5d","display_exif":"1","display_comments":"1","display_geo":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"1","require_name_email":"0","login_url":"https:\/\/blog.malwarebytes.com\/wp-login.php?redirect_to=https%3A%2F%2Fblog.malwarebytes.com%2Fthreat-analysis%2F2019%2F05%2Fhidden-bee-lets-go-down-the-rabbit-hole%2F","blog_id":"1","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"],"local_comments_commenting_as":"<p id=\"jp-carousel-commenting-as\">You must be <a href=\"#\" class=\"jp-carousel-comment-login\">logged in<\/a> to post a comment.<\/p>"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.malwarebytes.com/wp-content/plugins/jetpack/_inc/build/carousel/jetpack-carousel.min.js?ver=9.4' id='jetpack-carousel-js'></script>
<script src="https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/js/standard-search-results-footer.js" type="text/javascript"></script>
<script type="text/javascript">
  var countryError, country;
  $.browser = {};
  (function() {
    $.browser.msie = false;
    $.browser.version = 0;
    if (navigator.userAgent.match(/MSIE ([0-9]+)\./)) {
      $.browser.msie = true;
      $.browser.version = RegExp.$1;
    }
  })();
  // Use Microsoft XDR for IE8/9
  if ($.browser.msie && window.XDomainRequest && $.browser.version < 10) {
    //console.log("browser is IE less than 10");

    var xdr = new XDomainRequest();
    xdr.open("GET", "https://genesis.malwarebytes.com/api/v1/wai.gif");
    xdr.onload = function() {
      //console.log("onload function");
      // use xdr.responseText for ie8/9, since unable to specify JSON accept request header
      var dom = new ActiveXObject("Microsoft.XMLDOM");
      var data = $.parseJSON(xdr.responseText);
      //console.log("IE data: " + data);
      dom.async = false;
      if (data == null || typeof(data) == "undefined") {
        // console.log("data is null or undefined");
        window.countryError = data["error"]["errorCode"];
      }
      window.country = data["location"]["countryCode"];
      //console.log("IE country in geo: " + country);
    };
    // function to call when an error occurs
    xdr.onerror = function() {
      //console.log("onerror XDR");
      window.countryError = data["error"]["errorCode"];
    };
    //console.log("before the send");
    xdr.send();
    //console.log("after the function");
  } else { // not IE 8/9, so use AJAX
    $.ajax({
      url: "https://genesis.malwarebytes.com/api/v1/wai.gif",
      type: "GET",
      crossDomain: true,
      dataType: "json",
      success: function(data) {
        //set country     
        //console.log("in success" + JSON.stringify(data));
        window.country = data["location"]["countryCode"];
      },
      error: function(data, jqXHR, textStatus, errorThrown) {
        //      console.log('geohtml genesis error POST1: ' + JSON.stringify(data)); 
        //      console.log("jqXHR: " + jqXHR);
        //      console.log("textStatus: " + textStatus);
        //      console.log("errorThrown: " + errorThrown);
        window.countryError = data["error"]["errorCode"];
      },
      async: false
    });
  }
</script>

<script type="text/plain" class="optanon-category-4">
  $("script[src='https://malwarebytesunpacked.disqus.com/embed.js']").each(function() {
    var scriptSrc = $(this).attr("src");
    var newScript = "<script type='text/javascript' async='' src='" + scriptSrc + "'>";
    $(this).before(newScript).remove();
  });
</script>

<!--replace with onetrust -->

<!---->

<script>
/*
  function enableCookies() {
    //fire inline scripts
    $('.ce-script').each(function() {
      var scripts = $(this).text();
      var scriptParent = $(this).parent();
      //console.log($(this).attr('data-ce-src'));
      if (!$(this).attr('data-ce-src')) {
        //console.log('no attribute')
          //fire marketo forms
        if (scripts.indexOf("MktoForms2") > -1) {
          
          //set interval for mkto
          var mktoInt = setInterval(function() {
            if(typeof(MktoForms2) !== "undefined") {
              clearInterval(mktoInt);
              $(scriptParent).append('<script>' + scripts + '<\/script>');
              $(scriptParent).append("<script>(function(d,b,a,s,e){ var t = b.createElement(a),fs = b.getElementsByTagName(a)[0]; t.async=1; t.id=e; t.src=('https:'==document.location.protocol ? 'https://' : 'http://') + s; fs.parentNode.insertBefore(t, fs); })(window,document,'script','scripts.demandbase.com/HWyTnY16.min.js','demandbase_js_lib');<\/script>");
              
            }
          }, 10);
        } else {

          $(scriptParent).append('<script>' + scripts + '<\/script>');
        }
      } else {
        var attr = $(this).attr('data-ce-src');
        $(this).attr('src', attr);
        //console.log('attribute is: ' + attr);
        $(scriptParent).append('<script src="' + attr + '"><\/script>');
      }
      //console.log(scripts);
    });
    
    //iframes
    
    $('.ce-iframe').each(function() {
      var iframesrc = $(this).attr('data-ce-src');
      $(this).attr('src', iframesrc);
    });
    
    
  }

  var gdprCountries = [
    "BE",
    "BG",
    "CZ",
    "DK",
    "DE",
    "EE",
    "IE",
    "EL",
    "ES",
    "FR",
    "HR",
    "IT",
    "CY",
    "LV",
    "LT",
    "LU",
    "HU",
    "MT",
    "NL",
    "AT",
    "PL",
    "PT",
    "RO",
    "SI",
    "SK",
    "FI",
    "SE",
    "UK",
    "GB"
  ];
  //read user preference cookie
  var cookiePreference = $.cookie('ce-cookie');
  

  
  
  //cookie config
  if (gdprCountries.indexOf(country) > -1) {
    if (cookiePreference === "N" && cookiePreference !== "Y") {
      $(window).load(function() {
        $('a[href*="https://my.malwarebytes"]').attr('href','https://www.malwarebytes.com/myaccount-consent');
        //$('form[id*="mktoForm"]').append('<p>To view this content you need to enable cookies. <br>' + '<a style="text-decoration: underline;" href="#" class="ce-accept">Enable All Cookies</a>' + '</p>');
      });

    } else {
      enableCookies();
    }

    //variable for cookies to fire or not
    //var cookies = "no";

    //if (cookies === "yes") {
    //  enableCookies();
    //}
    
    //remove for onetrust
    COOKIES_ENABLER.init({
      scriptClass: 'ce-script',
      iframeClass: 'ce-iframe',
      acceptClass: 'ce-accept',
      dismissClass: 'ce-dismiss',
      disableClass: 'ce-disable',
      bannerClass: 'ce-banner',
      bannerHTML: '<p>By continuing to browse our website or by clicking "Accept All Cookies," you agree to the storing of first- and third-party cookies on your device to enhance site navigation, analyze site usage, and assist in our marketing efforts. <a href="https://www.malwarebytes.com/privacy/" style="margin-left:0;" id="cta-labs-cookiegdpr-linkto-privacypolicy-en">Privacy and Cookie Policy</a><br>' + '<a href="#" class="ce-accept bluecta-sm" style="width: auto; padding-left:10px; padding-right:10px;" id="cta-labs-cookiegdpr-acceptallcookies-en">' + 'Accept All Cookies' + '</a>' + '<a href="#" class="ce-disable ce-disable" id="cta-labs-cookiegdpr-disableallcookies-en">Disable Cookies</a>' + '</p>',
      eventScroll: false,
      scrollOffset: 200,
      clickOutside: false,
      cookieName: 'ce-cookie',
      cookieDuration: '365',
      wildcardDomain: true,
      iframesPlaceholder: true,
      iframesPlaceholderHTML: '<p>To view this content you need to enable cookies. <br>' + '<a style="text-decoration: underline;" href="#" class="ce-accept"  id="cta-labs-cookiegdpr-enablecookies-viaiframe-en">Enable All Cookies</a>' + '</p>',
      iframesPlaceholderClass: 'ce-iframe-placeholder',
      // Callbacks
      onEnable: function() {
        //enableCookies();
      },
      onDismiss: function() {
        //console.log('the banner has been dismissed');
      },
      onDisable: function() {
        $('a[href*="https://my.malwarebytes"]').attr('href','https://www.malwarebytes.com/myaccount-consent');
        $('form[id*="mktoForm"]').append('<p id="consent-message">To view this content you need to enable cookies. <br>' + '<a style="text-decoration: underline;" href="#" class="ce-accept">Enable All Cookies</a>' + '</p>');
        $('#consent-message .ce-accept').click(function() {
          setTimeout(function() {
            window.location.reload()
          }, 250);
          $('#consent-message').remove();
        });
      }
    });
  } else {
    enableCookies();
  }
  */
</script>
<style>
  .ce-banner {
    display: block;
    position: fixed;
    width: 100vw;
    background: #fff;
    bottom: 0;
    left: 0;
    z-index: 99999;
    box-sizing: border-box;
    padding: 20px;
    text-align: center;
    box-shadow: 0px 0px 20px #424242;
  }
  
  .ce-banner a {
    margin: 0 10px;
  }
</style>
<script>
$(document).ready(function() {
  $.getJSON("https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/pillarpages.json", function(allpillarpages){
    number_of_pillar_pages_to_show = 5;
    var pillar_card_slug;

    function pillar_card() {
      if (typeof allpillarpages[i].uri === "undefined") { 
        var pillar_card_slug = allpillarpages[i].pillarpage.replace(" ", "-").toLowerCase();
      }
      else {
        var pillar_card_slug = allpillarpages[i].uri;
      }
      var pillar_card_html = '<div class="col-md-3"><p><a href="https://www.malwarebytes.com/' + pillar_card_slug + '/" id="cta-labs-footernavigation-lightbox-learn-linkto-' + pillar_card_slug + '-en">' + allpillarpages[i].pillarpage +'</a></p></div>';
      
      var pillar_card_list_html = '<p><a href="https://www.malwarebytes.com/' + pillar_card_slug + '/" id="cta-labs-footernavigation-learn-linkto-' + pillar_card_slug + '-en">' + allpillarpages[i].pillarpage +'</a></p>'
      
      $("section#pillar-pages .pillar-pages-list").append(pillar_card_html);
      
      if ([i] < number_of_pillar_pages_to_show) {
        $("footer .pillar-pages-list").append(pillar_card_list_html);
      }
    };
    for (i=0;i<allpillarpages.length;i++) {
      pillar_card();
    } 
  });
});
</script>
<script>
$(document).ready(function() {
  $.getJSON("https://blog.malwarebytes.com/wp-content/themes/mb-labs-theme/intl-sites.json", function(intlSites){

    function listIntlSites() {
      let indCountry = '<li><a href="' + intlSites[i].url + '/" class="' + intlSites[i].country + '-site" id="cta-labs-footer-linkto-' + intlSites[i].country + '_site-en">' + intlSites[i].lang + '</a></li>'
      $("#intl-sites").append(indCountry);
    };
    for (i=0;i<intlSites.length;i++) {
            listIntlSites();
          }  
  });
});
</script>
</body>
</html>