<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Aleksandr Matrosov',
        'ArticleCategory': 'Malware',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Mysterious Avatar rootkit with API, SDK, and Yahoo Groups for C&#038;C communication | WeLiveSecurity</title>
<link rel="canonical" href="https://www.welivesecurity.com/2013/05/01/mysterious-avatar-rootkit-with-api-sdk-and-yahoo-groups-for-cc-communication/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Mysterious Avatar rootkit with API, SDK, and Yahoo Groups for C&#038;C communication | WeLiveSecurity" />
<meta property="og:description" content="The mysterious Avatar rootkit, detected by ESET as Win32/Rootkit.Avatar, appears to reflect a heavy investment in code development, with an API and a SDK available, plus an interesting abuse of Yahoo Groups for C&amp;C communications." />
<meta property="og:url" content="https://www.welivesecurity.com/2013/05/01/mysterious-avatar-rootkit-with-api-sdk-and-yahoo-groups-for-cc-communication/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:tag" content="Botnet" />
<meta property="article:tag" content="dropper" />
<meta property="article:tag" content="Malware" />
<meta property="article:tag" content="rootkit" />
<meta property="article:tag" content="TDL3" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2013-05-01T07:44:57+00:00" />
<meta property="article:modified_time" content="2013-05-02T23:53:43+00:00" />
<meta property="og:updated_time" content="2013-05-02T23:53:43+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2013/04/rootkit.png" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2013/04/rootkit.png" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="409" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="The mysterious Avatar rootkit, detected by ESET as Win32/Rootkit.Avatar, appears to reflect a heavy investment in code development, with an API and a SDK available, plus an interesting abuse of Yahoo Groups for C&amp;C communications." />
<meta name="twitter:title" content="Mysterious Avatar rootkit with API, SDK, and Yahoo Groups for C&#038;C communication | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2013/04/rootkit.png" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single noimage">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-noimage">
	<div class="container promo-text">
		<div class="inner clearfix">
			<div class="col-md-11 col-sm-11 col-xs-12 no-padding">
				<h1>Mysterious Avatar rootkit with API, SDK, and Yahoo Groups for C&#038;C communication</h1>
<div class="excerpt">The mysterious Avatar rootkit, detected by ESET as Win32/Rootkit.Avatar, appears to reflect a heavy investment in code development, with an API and a SDK available, plus an interesting abuse of Yahoo Groups for C&C communications.</div>
<div class="post-meta">
    <div class="wls-authors">
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2013-05-01 07:44:57">1 May 2013 - 07:44AM</time>
		</span>
			</span>
</div>
			</div>
		</div>
	</div>
</div>	

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F05%2F01%2Fmysterious-avatar-rootkit-with-api-sdk-and-yahoo-groups-for-cc-communication%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F05%2F01%2Fmysterious-avatar-rootkit-with-api-sdk-and-yahoo-groups-for-cc-communication%2F&text=Mysterious Avatar rootkit with API, SDK, and Yahoo Groups for C&#038;C communication%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F05%2F01%2Fmysterious-avatar-rootkit-with-api-sdk-and-yahoo-groups-for-cc-communication%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt noimage">
                                <p>The mysterious Avatar rootkit, detected by ESET as Win32/Rootkit.Avatar, appears to reflect a heavy investment in code development, with an API and a SDK available, plus an interesting abuse of Yahoo Groups for C&#038;C communications.</p>
                            </div>

                            <p>The story of the mysterious malware detected by ESET as Win32/Rootkit.Avatar began in February 2013 when some adverts for this rootkit leaked from Russian cybercrime forums (<a title="http://pastebin.com/maPY7SS8)" href="http://pastebin.com/maPY7SS8)" target="_blank">http://pastebin.com/maPY7SS8</a>). This information produced some heated discussions in the malware research community, however a sample of the Avatar rootkit was not found and published, until now. In this blog we present an in-depth analysis of the Win32/Rootkit.Avatar family, which has some surprising features, and is currently available for sale or rent in the crimeware marketplace.</p>
<p>In March ESET detected two droppers with different C&amp;C’s and compilation time stamps:</p>
<p><a href="/wp-content/uploads/2013/04/avatar1.png"><img class="aligncenter size-full wp-image-20683" title="avatar1" src="/wp-content/uploads/2013/04/avatar1.png" alt="" width="345" height="142" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar1.png 345w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar1-300x123.png 300w" sizes="(max-width: 345px) 100vw, 345px" /></a></p>
<p><a href="/wp-content/uploads/2013/04/image002.png"><img class="aligncenter size-full wp-image-20730" title="Avatar-image002" src="/wp-content/uploads/2013/04/image002.png" alt="" width="344" height="143" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/image002.png 344w, https://www.welivesecurity.com/wp-content/uploads/2013/04/image002-300x124.png 300w" sizes="(max-width: 344px) 100vw, 344px" /></a></p>
<p>Win32/Rootkit.Avatar uses a driver infection technique twice: the first in the dropper so as to bypass detections by HIPS, and the second in the rootkit driver for surviving after system reboot. The infection technique is restricted in its capability (by code signing policy for kernel-mode modules) and Win32/Rootkit.Avatar works only on x86 systems. We already analyzed in detail, some years ago, how the TDL3 rootkit family also infected system drivers so as to survive after reboot (<a title="TDL3 white papers" href="/2011/03/30/tdss-the-next-generation/" target="_blank">TDL3: The Rootkit of All Evil?</a>).</p>
<p>Before 64-bit versions of Microsoft Windows became so prevalent, operating system tricks for infection using system drivers were really popular in rootkits. But the need for bypassing code signing policy has brought in a new generation of bootkits. More details about the complex bootkit family Win32/Gapz were presented a few weeks ago in our research whitepaper “<a title="/?p=20026" href="/?p=20026" target="_blank">Mind the Gapz: The most complex bootkit ever analyzed</a>?”.</p>
<h3>The Droppers</h3>
<p>The first level dropper implements LZMA decompression for the second level dropper and the malicious driver module. The second level dropper and driver are unique in every instance because the first level dropper generates random names for mutexes/events and enforces modifications directly in the body of the modules. The most interesting trick used in the first level dropper is an anti-debugging technique based on time comparison from the <em>KUSER_SHARED_DATA.InterruptTime</em> system structure. The first level dropper modifies the <em>RtlDispatchException()</em> routine inside the <em>KiUserExceptionDispatcher()</em> body. The next step raises an exception and passes control to the exception-handler:</p>
<p><a href="/wp-content/uploads/2013/04/avatarXX.png"><img class="aligncenter  wp-image-20722" title="avatarXX" src="/wp-content/uploads/2013/04/avatarXX.png" alt="" width="666" height="211" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatarXX.png 666w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatarXX-300x95.png 300w" sizes="(max-width: 666px) 100vw, 666px" /></a>The current time is collected from the <em>KUSER_SHARED_DATA.InterruptTime</em> system structure and compared during the next steps of execution. This non-standard trick can detect emulation or debugging at the first stages of dropper execution.</p>
<p>The second level dropper also has checks for known virtual machine software. But these checks are based on standard, already-known tricks. Before the code for VM checking is executed it is decrypted by XOR based encryption using the key “explorer”.</p>
<p><a href="/wp-content/uploads/2013/04/avatar2.png"><img class="aligncenter size-full wp-image-20684" title="avatar2" src="/wp-content/uploads/2013/04/avatar2.png" alt="" width="428" height="306" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar2.png 428w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar2-300x214.png 300w" sizes="(max-width: 428px) 100vw, 428px" /></a></p>
<p>At the next steps the operating system version and current user privileges level are checked. The second level dropper uses two ways of escalating privilege:</p>
<ol>
<li>Exploitation of the <a href="http://technet.microsoft.com/en-us/security/bulletin/ms11-080" target="_blank">MS11-080</a> vulnerability</li>
<li><a href="http://www.pretentiousname.com/misc/win7_uac_whitelist2.html" target="_blank">COM Elevation</a> (UAC whitelist)</li>
</ol>
<p>The system infection process by dropper works as presented in the following diagram:</p>
<p><a href="/wp-content/uploads/2013/04/avatar3.png"><img class="aligncenter size-full wp-image-20685" title="avatar3" src="/wp-content/uploads/2013/04/avatar3.png" alt="" width="665" height="837" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar3.png 665w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar3-238x300.png 238w" sizes="(max-width: 665px) 100vw, 665px" /></a></p>
<p>The exploit for the MS11-080 vulnerability uses the same exploitation code as a public exploit from <a href="http://www.metasploit.com/modules/exploit/windows/local/ms11_080_afdjoinleaf" target="_blank">Metasploit Framework</a> with minor changes. After a version check for afd.sys the dropper uses the following exploitation code:</p>
<p><a href="/wp-content/uploads/2013/04/avatar4.png"><img class="aligncenter size-full wp-image-20686" title="avatar4" src="/wp-content/uploads/2013/04/avatar4.png" alt="" width="720" height="784" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar4.png 720w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar4-275x300.png 275w" sizes="(max-width: 720px) 100vw, 720px" /></a></p>
<p>The next figure presents the code which triggers an <em>AFDJoinLeaf</em> pointer overwrite by sending a specific IOCTL code = 0x000120BB:</p>
<p><a href="/wp-content/uploads/2013/04/avatar5.png"><img class="aligncenter size-full wp-image-20687" title="avatar5" src="/wp-content/uploads/2013/04/avatar5.png" alt="" width="995" height="227" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar5.png 995w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar5-300x68.png 300w" sizes="(max-width: 995px) 100vw, 995px" /></a></p>
<p>The most interesting part of the exploit code is the steps taken after exploitation. After a successful exploitation kernel-mode shellcode will be executed for loading the malicious driver.<br />
<a href="/wp-content/uploads/2013/04/avatar6.png"><img class="aligncenter  wp-image-20688" title="avatar6" src="/wp-content/uploads/2013/04/avatar6.png" alt="" width="352" height="737" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar6.png 352w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar6-143x300.png 143w" sizes="(max-width: 352px) 100vw, 352px" /></a></p>
<p>The Avatar rootkit driver is not stored on the hard drive and loads only from a memory region. Here’s the call graph for the routine that loads the malicious driver:</p>
<p style="text-align: center;"><a href="/wp-content/uploads/2013/04/avatar7.png"><img class="aligncenter" title="avatar7" src="/wp-content/uploads/2013/04/avatar7.png" alt="" width="556" height="197" /></a></p>
<p>Another way to escalate privilege is to use an old technique based on COM Elevation (UAC whitelist). Upon successful escalation, the system directory (<em>%WINDIR%\system32\drivers</em>) is checked, searching for the driver following the infection. After successful infection the <em>GsDriverEntry()</em> routine is modified to execute the following malicious code stub. The modified <em>GsDriverEntry()</em> routine code looks like this:</p>
<p style="text-align: center;"><a href="/wp-content/uploads/2013/04/avatar8.png"><img class="aligncenter  wp-image-20690" title="avatar8" src="/wp-content/uploads/2013/04/avatar8-1024x188.png" alt="" width="614" height="113" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar8-1024x188.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar8-300x55.png 300w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar8.png 1271w" sizes="(max-width: 614px) 100vw, 614px" /></a></p>
<p>One of the main tasks of the malicious code stub is to attach itself to the second level dropper process and read the Avatar rootkit driver body in memory. The malicious code stub as presented in the following figure:</p>
<p><a href="/wp-content/uploads/2013/04/avatar9.png"><img class="aligncenter size-full wp-image-20691" title="avatar9" src="/wp-content/uploads/2013/04/avatar9.png" alt="" width="565" height="593" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar9.png 565w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar9-285x300.png 285w" sizes="(max-width: 565px) 100vw, 565px" /></a></p>
<p>After a successful infection, the modified driver will copy itself to the <em>%TEMP%</em> directory and try to load itself using standard system techniques (Service Control Manager or <em>ZwLoadDriver()</em>).</p>
<p style="text-align: center;"><a href="/wp-content/uploads/2013/04/avatar101.png"><img class="aligncenter  wp-image-20693" title="avatar10" src="/wp-content/uploads/2013/04/avatar101.png" alt="" width="739" height="132" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar101.png 924w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar101-300x53.png 300w" sizes="(max-width: 739px) 100vw, 739px" /></a></p>
<p>So the Avatar rootkit driver is not stored on the hard drive and will load with the same code used in the method for MS11-080 exploitation for driver execution (see the call graph load_avatar_driver routine above).</p>
<p>This method for loading the Avatar rootkit driver by system driver infection is effective for bypassing security software, and loads other kernel-mode modules from a &#8220;trusted&#8221; (but malicious) system driver.</p>
<h3>Avatar rootkit driver</h3>
<p>After successfully loading the Avatar rootkit driver, Avatar executes an algorithm for infecting system drivers so as to survive after reboot. In order to perform its infection, Avatar randomly chooses a driver and checks its name against a blacklist that varies for every Windows versions.</p>
<p><a href="/wp-content/uploads/2013/04/avatar11.png"><img class="aligncenter  wp-image-20694" title="avatar11" src="/wp-content/uploads/2013/04/avatar11.png" alt="" width="721" height="418" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar11.png 721w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar11-300x173.png 300w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar11-257x149.png 257w" sizes="(max-width: 721px) 100vw, 721px" /></a></p>
<p>The execution flow for an infected system driver looks like this:</p>
<p>1. At the entry point, the following stub code is executed:</p>
<p><a href="/wp-content/uploads/2013/04/avatar12.png"><img class="aligncenter size-full wp-image-20695" title="avatar12" src="/wp-content/uploads/2013/04/avatar12.png" alt="" width="561" height="465" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar12.png 561w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar12-300x248.png 300w" sizes="(max-width: 561px) 100vw, 561px" /></a></p>
<p style="text-align: left;">2. Then, the <em>GUID_DEVINTERFACE_DISK</em> callback routine is installed into the system driver to loaded the Avatar rootkit driver from the hidden file storage. This is the same technique used by TDL3, TDL4 (<a href="http://http://go.eset.com/us/resources/white-papers/The_Evolution_of_TDL.pdf" target="_blank">The Evolution of TDL: Conquering x64</a>) and Olmasco (MaxSS/SST).</p>
<p><a href="/wp-content/uploads/2013/04/avatar13.png"><img title="avatar13" src="/wp-content/uploads/2013/04/avatar13.png" alt="" width="566" height="180" /></a></p>
<p>3. The original code is restored in memory:</p>
<p style="text-align: center;"><a href="/wp-content/uploads/2013/04/avatar14.png"><img class="aligncenter  wp-image-20697" title="avatar14" src="/wp-content/uploads/2013/04/avatar14-747x1024.png" alt="" width="672" height="922" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar14-747x1024.png 747w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar14-218x300.png 218w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar14.png 758w" sizes="(max-width: 672px) 100vw, 672px" /></a></p>
<p>The Avatar rootkit driver is able to infect several system drivers without changing the original driver&#8217;s file size.</p>
<p>The Avatar rootkit driver implements an interesting technique to detect the presence of a virtual machine environment. The driver module calls the <em>MmMapIoSpace()</em> routine from the driver to read BIOS data at address 0xF0000 and check for some specific strings:</p>
<ul>
<li>Parallels Software</li>
<li>Virtual Machine</li>
<li>VirtualBox</li>
<li>QEMU BIOS</li>
<li>VMware</li>
<li>Bochs</li>
</ul>
<p>Additional checks were also found for KVM and Hyper-V based on tricks already known using cpuid instructions.</p>
<p>The hidden file system is used to store the user-mode payload module and additional files. All files are encrypted with a custom symmetric cipher. Here’s the call graph for the routine that communicates with the hidden file system:</p>
<p><a href="/wp-content/uploads/2013/04/avatar151.png"><img class="aligncenter size-full wp-image-20699" title="avatar15" src="/wp-content/uploads/2013/04/avatar151.png" alt="" width="301" height="127" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar151.png 301w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar151-300x126.png 300w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar151-298x127.png 298w" sizes="(max-width: 301px) 100vw, 301px" /></a></p>
<p>The attributes for files stored in the hidden file system look like this:</p>
<p><a href="/wp-content/uploads/2013/04/avatar16.png"><img class="aligncenter size-full wp-image-20700" title="avatar16" src="/wp-content/uploads/2013/04/avatar16.png" alt="" width="392" height="197" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar16.png 392w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar16-300x150.png 300w" sizes="(max-width: 392px) 100vw, 392px" /></a></p>
<p>On the infected machine, additional user-mode and kernel-mode modules can be downloaded and executed that are stored in the hidden file storage. Win32/Rootkit.Avatar does not store malicious components in any standard NTFS storage, except for infected system drivers. The combination of encrypted hidden file storage and infected system drivers make it harder to use typical forensics approaches to investigate an infection by Win32/Rootkit.Avatar.</p>
<p>The user-mode payload code injection uses the <em>KeInitializeApc()</em> routine to initialize an APC user-mode object and schedules the execution of this thread into the system process address space.</p>
<p><a href="/wp-content/uploads/2013/04/avatar17.png"><img class="aligncenter size-full wp-image-20701" title="avatar17" src="/wp-content/uploads/2013/04/avatar17.png" alt="" width="506" height="465" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar17.png 506w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar17-300x275.png 300w" sizes="(max-width: 506px) 100vw, 506px" /></a></p>
<h3>Win32/Rootkit.Avatar Payload</h3>
<p>The version of the payload from the sample currently researched sample of Win32/Rootkit.Avatar doesn’t have many interesting features. Its main functionalities are:</p>
<ul>
<li>command center communications</li>
<li>parsing configuration information</li>
<li>read/write into hidden file storage</li>
<li>communicating with the rootkit driver</li>
<li>installing additional user-mode and kernel-mode modules</li>
</ul>
<p>Of course, this means the initial infection can be the starting point of a variety of malicious activities based on the modules that deployed. In our case the payload component avcmd.dll was injected into svchost.exe system process which started communicating with C&amp;C IP addresses stored in the configuration file. This configuration file has the following structure:</p>
<ul>
<li>name of the botnet</li>
<li>command center URLs</li>
<li>1024-bit key for custom encryption algorithm</li>
<li>RSA-1024 public key</li>
<li>Name of process for the subsequent code injection</li>
</ul>
<p>Examples of decrypted configuration information from two different droppers are shown here:</p>
<p><a href="/wp-content/uploads/2013/04/avatar18.png"><img class="aligncenter  wp-image-20702" title="avatar18" src="/wp-content/uploads/2013/04/avatar18.png" alt="" width="526" height="517" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar18.png 526w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar18-300x294.png 300w" sizes="(max-width: 526px) 100vw, 526px" /></a></p>
<p>and here:</p>
<p><a href="/wp-content/uploads/2013/04/image021.png"><img class="aligncenter size-full wp-image-20731" title="image021" src="/wp-content/uploads/2013/04/image021.png" alt="" width="526" height="604" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/image021.png 526w, https://www.welivesecurity.com/wp-content/uploads/2013/04/image021-261x300.png 261w" sizes="(max-width: 526px) 100vw, 526px" /></a></p>
<p>In order to protect communications with the command center, a custom encryption algorithm is used, which output is base64-encoded. All network communications are done from user-mode and use standard <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa383630(v=vs.85).aspx" target="_blank">WinINet API</a> functions.</p>
<p>Win32/Rootkit.Avatar has an additional way of communicating with the C&amp;C if the other methods are not working correctly. The payload tries to search for messages in Yahoo groups using special parameters.</p>
<p><a href="/wp-content/uploads/2013/04/avatar19.png"><img class="aligncenter  wp-image-20703" title="avatar19" src="/wp-content/uploads/2013/04/avatar19.png" alt="" width="704" height="49" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar19.png 704w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar19-300x20.png 300w" sizes="(max-width: 704px) 100vw, 704px" /></a></p>
<p><a href="/wp-content/uploads/2013/04/image023.png"><img class="aligncenter size-full wp-image-20732" title="image023" src="/wp-content/uploads/2013/04/image023.png" alt="" width="1148" height="69" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/image023.png 1148w, https://www.welivesecurity.com/wp-content/uploads/2013/04/image023-300x18.png 300w, https://www.welivesecurity.com/wp-content/uploads/2013/04/image023-1024x61.png 1024w" sizes="(max-width: 1148px) 100vw, 1148px" /></a></p>
<p>Search sequences are based on the following parameter (in our case 17BTN1 and 17NET1):</p>
<p><a href="/wp-content/uploads/2013/04/avatar20.png"><img class="aligncenter size-full wp-image-20704" title="avatar20" src="/wp-content/uploads/2013/04/avatar20.png" alt="" width="231" height="51" /></a></p>
<p>After strings are concatenated, the resulting byte sequence is encrypted using a custom algorithm with a 1024-bit key from the configuration file.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581a5f1b78a919767246" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
BTN1 key = 6mQ98EXP3v7TKMdk704uOUzGqvikuoHt98n8IPp4K19
a3qyZ96LoOc54sb3g9eJVyAs7VmPxQjkkM9R960ev275K24PQ550K1
9fNk8305jRDUTb4cEut4579Zg9i32qU</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581a5f1b78a919767246-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581a5f1b78a919767246-2">2</div><div class="crayon-num" data-line="crayon-60581a5f1b78a919767246-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581a5f1b78a919767246-1"><span class="crayon-e">BTN1 </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">6mQ98EXP3v7TKMdk704uOUzGqvikuoHt98n8IPp4K19</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581a5f1b78a919767246-2"><span class="crayon-i">a3qyZ96LoOc54sb3g9eJVyAs7VmPxQjkkM9R960ev275K24PQ550K1</span></div><div class="crayon-line" id="crayon-60581a5f1b78a919767246-3"><span class="crayon-cn">9fNk8305jRDUTb4cEut4579Zg9i32qU</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581a5f1b792064740007" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
NET1 key =  E623J5XKJ9NF4bseM5J2nkwhs1K2766DUOMUDSee3c
7xu06Q9QayV61U4fm5H89ppuNgLt9M5D2XTCLcd0aS3m9CO1aZg9h9
o2zb2EIC437IU3X1P3ec07481E0j2Tdr</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581a5f1b792064740007-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-60581a5f1b792064740007-2">2</div><div class="crayon-num" data-line="crayon-60581a5f1b792064740007-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581a5f1b792064740007-1"><span class="crayon-e">NET1 </span><span class="crayon-v">key</span><span class="crayon-h"> </span><span class="crayon-o">=</span> <span class="crayon-h"> </span><span class="crayon-i">E623J5XKJ9NF4bseM5J2nkwhs1K2766DUOMUDSee3c</span></div><div class="crayon-line crayon-striped-line" id="crayon-60581a5f1b792064740007-2"><span class="crayon-cn">7xu06Q9QayV61U4fm5H89ppuNgLt9M5D2XTCLcd0aS3m9CO1aZg9h9</span></div><div class="crayon-line" id="crayon-60581a5f1b792064740007-3"><span class="crayon-v">o2zb2EIC437IU3X1P3ec07481E0j2Tdr</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>After encryption the resulting string is encoded with a base64 algorithm, after which all letters are converted to upper case and some symbols are filtered out. An example for botnet BTN1 looks like this:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581a5f1b794597532023" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
SymFilter(UpperCase(Base64(Encrypt(17BTN1)))) = EZTFDHWP</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581a5f1b794597532023-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581a5f1b794597532023-1"><span class="crayon-e">SymFilter</span><span class="crayon-sy">(</span><span class="crayon-e">UpperCase</span><span class="crayon-sy">(</span><span class="crayon-e">Base64</span><span class="crayon-sy">(</span><span class="crayon-e">Encrypt</span><span class="crayon-sy">(</span><span class="crayon-cn">17BTN1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">EZTFDHWP</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>EZTFDHWP is used for the subsequent search request on Yahoo groups. If the search request is successful, the next step is to check the group number and read the group description data.</p>
<p><a href="/wp-content/uploads/2013/04/avatar21.png"><img class="aligncenter  wp-image-20705" title="avatar21" src="/wp-content/uploads/2013/04/avatar21.png" alt="" width="471" height="91" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar21.png 471w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar21-300x57.png 300w" sizes="(max-width: 471px) 100vw, 471px" /></a></p>
<p>The group description is encrypted with an RSA algorithm and a 1024-bit private key. It is possible to decrypt this data with the public key stored in the configuration file. We suppose this information is to be found in the encrypted message used for returning control for a botnet without an active C&amp;C.</p>
<p>After we identified this functionality, we started to search for possible messages on the Yahoo groups web site. Only one group was found with the relevent parameters (11BTN1 = EFS9KHRF).  The search request looks like this:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581a5f1b795793132307" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
http://groups.yahoo.com/search?query=EFS9KHRF&amp;amp;sort=relevance</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581a5f1b795793132307-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581a5f1b795793132307-1"><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//groups.yahoo.com/search?query=EFS9KHRF&amp;amp;sort=relevance</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p><a href="/wp-content/uploads/2013/04/avatar22.png"><img class="aligncenter size-full wp-image-20706" title="avatar22" src="/wp-content/uploads/2013/04/avatar22.png" alt="" width="422" height="191" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar22.png 422w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar22-300x135.png 300w" sizes="(max-width: 422px) 100vw, 422px" /></a></p>
<p>An encrypted message is present in this group&#8217;s description:</p>
<p><a href="/wp-content/uploads/2013/04/image027.png"><img class="aligncenter size-full wp-image-20733" title="image027" src="/wp-content/uploads/2013/04/image027.png" alt="" width="1144" height="133" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/image027.png 1144w, https://www.welivesecurity.com/wp-content/uploads/2013/04/image027-300x34.png 300w, https://www.welivesecurity.com/wp-content/uploads/2013/04/image027-1024x119.png 1024w" sizes="(max-width: 1144px) 100vw, 1144px" /></a></p>
<p>We were able to decrypt this message using the known RSA-1024 public keys from the configuration information. The key from the BTN1 botnet successfully decrypted this message:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581a5f1b796056310781" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
dZ8FsJ4z0::http://www.avatarbut.info http://www.avatarsbut.info</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581a5f1b796056310781-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581a5f1b796056310781-1"><span class="crayon-v">dZ8FsJ4z0</span><span class="crayon-o">::</span><span class="crayon-v">http</span><span class="crayon-o">:</span><span class="crayon-c">//www.avatarbut.info http://www.avatarsbut.info</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0000 seconds] -->
<p>This information looks similar to C&amp;Cs found in the BTN1 botnet configuration information. The authors of this blog post suspect that this Yahoo group was created to test this communication functionality because it includes the same information already present in the BTN1 configuration file.</p>
<p>Avatar’s scheme to maintain botnet control via Yahoo groups messages provide an excellent protection against sinkhole attemps, because information about C&amp;C’s domains is encrypted using an asymmetric algorithm based on the RSA scheme. In the reversing process, researchers can only extract the public key to decrypting messages: this key can’t be used to encrypt new messages to create bogus groups.</p>
<h3>Avatar Runtime Library</h3>
<p>Win32/Rootkit.Avatar has a special API for developing additional components without the source code of the Avatar rootkit. This development process is based around the Avatar Runtime Library, a special SDK for developing additional user-mode components which allow communication with the Avatar rootkit driver. The Avatar Runtime Library has the following API functions:</p>
<ul>
<li><em>aTakeProcessToken()</em> – assign process token from one process to other</li>
<li><em>aExecute()</em> &#8211; execute custom module in the context of remote process</li>
<li><em>aLoadDriver()</em> – load driver from hidden file system</li>
<li><em>aLoadFileFromAvatarDisk()</em> – read file from hidden file system</li>
<li><em>aSaveFileOrAttrToAvatarDisk()</em> – write file into hidden file system</li>
<li><em>aSendReport()</em> – send the specific report to C&amp;C</li>
</ul>
<p>The storage structure for payload injection into the user-mode process looks like this:</p>
<p><a href="/wp-content/uploads/2013/04/avatar23.png"><img class="aligncenter size-full wp-image-20707" title="avatar23" src="/wp-content/uploads/2013/04/avatar23.png" alt="" width="331" height="160" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar23.png 331w, https://www.welivesecurity.com/wp-content/uploads/2013/04/avatar23-300x145.png 300w" sizes="(max-width: 331px) 100vw, 331px" /></a></p>
<p>After analysis of the Avatar Runtime Library SDK it seems like a development project by a really skilled system developer or developers. We think that the malware developers worked on it for not less than half year because many kernel-mode techniques need lengthy testing to ensure stability.</p>
<h3>Conclusion</h3>
<p>Win32/Rootkit.Avatar is an interesting rootkit family using many interesting techniques for bypassing detection by security software. Rootkits at the level of sophistication of Avatar or Gapz can be used for long term infection by the system executing the attack. Avatar does not store its files in the standard file system and its technique for driver infection makes it harder for typical forensic approaches to be used for successful incident investigation.</p>
<p>Avatar also has additional ways to restore botnet control if the command center is taken down or C&amp;C is disrupted for other reasons. For cleaning it’s necessary first to deactivate the Avatar rootkit driver and user-mode payload, and only then is it possible to clean or restore the infected system driver.</p>
<p><strong>Anton Cherepanov, Malware Researcher<br />
Aleksandr Matrosov, Security Intelligence Team Lead</strong></p>
<p>SHA1 hashes for analyzed samples:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581a5f1b797105367859" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Dropper1 (BTN1 botnet) – b2b3bb4b7c5a050a583246a8abe5a79d723b8b57</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581a5f1b797105367859-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581a5f1b797105367859-1"><span class="crayon-e">Dropper1</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">BTN1 </span><span class="crayon-v">botnet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span>–<span class="crayon-h"> </span><span class="crayon-v">b2b3bb4b7c5a050a583246a8abe5a79d723b8b57</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-60581a5f1b799416212014" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
Dropper2 (NET1 botnet) – 93473126a9aa13834413c494ae5f62eec1016fde</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-60581a5f1b799416212014-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-60581a5f1b799416212014-1"><span class="crayon-e">Dropper2</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">NET1 </span><span class="crayon-v">botnet</span><span class="crayon-sy">)</span><span class="crayon-h"> </span>–<span class="crayon-h"> </span><span class="crayon-cn">93473126a9aa13834413c494ae5f62eec1016fde</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>

                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                                            </div>
                                    <span class="strong">
								        <time datetime="2013-05-01 07:44:57">1 May 2013 - 07:44AM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/fbi-cybercrime-losses-2020-ic3-623x432.jpg"
                                                         alt="Mysterious Avatar rootkit with API, SDK, and Yahoo Groups for C&#038;C communication">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/">
                                                    FBI: Cybercrime losses topped US$4.2 billion in 2020                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/exchange-servers-under-siege-10-apt-groups-623x432.jpg"
                                                         alt="Mysterious Avatar rootkit with API, SDK, and Yahoo Groups for C&#038;C communication">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/">
                                                    Exchange servers under siege from at least 10 APT groups                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/apple-m1-macs-malware-1-623x432.jpg"
                                                         alt="Mysterious Avatar rootkit with API, SDK, and Yahoo Groups for C&#038;C communication">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/">
                                                    Malware authors already taking aim at Apple M1 Macs                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/eset-kobalos-hpc-high-performance-computing-malware-research-623x432.jpg"
                                                         alt="Mysterious Avatar rootkit with API, SDK, and Yahoo Groups for C&#038;C communication">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/">
                                                    Kobalos – A complex Linux threat to high performance computing infrastructure                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F05%2F01%2Fmysterious-avatar-rootkit-with-api-sdk-and-yahoo-groups-for-cc-communication%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F05%2F01%2Fmysterious-avatar-rootkit-with-api-sdk-and-yahoo-groups-for-cc-communication%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F05%2F01%2Fmysterious-avatar-rootkit-with-api-sdk-and-yahoo-groups-for-cc-communication%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-azeu -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"20681 \/?p=20681","disqusShortname":"welivesecurity","disqusTitle":"Mysterious Avatar rootkit with API, SDK, and Yahoo Groups for C&C communication","disqusUrl":"https:\/\/www.welivesecurity.com\/2013\/05\/01\/mysterious-avatar-rootkit-with-api-sdk-and-yahoo-groups-for-cc-communication\/","postId":"20681"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>