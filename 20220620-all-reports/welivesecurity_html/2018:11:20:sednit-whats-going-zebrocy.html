<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'ESET Research',
        'ArticleCategory': 'Malware',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Sednit: What’s going on with Zebrocy? | WeLiveSecurity</title>
<meta name="description" content="In August 2018, Sednit’s operators deployed two new Zebrocy components, and since then we have seen an uptick in Zebrocy deployments, with targets in Central Asia, as well as countries in Central and Eastern Europe, notably embassies, ministries of foreign affairs, and diplomats."/>
<link rel="canonical" href="https://www.welivesecurity.com/2018/11/20/sednit-whats-going-zebrocy/" />
<meta property="og:locale" content="en_US" />
<meta property="og:locale:alternate" content="fr_FR" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Sednit: What’s going on with Zebrocy? | WeLiveSecurity" />
<meta property="og:description" content="In August 2018, Sednit’s operators deployed two new Zebrocy components, and since then we have seen an uptick in Zebrocy deployments, with targets in Central Asia, as well as countries in Central and Eastern Europe, notably embassies, ministries of foreign affairs, and diplomats." />
<meta property="og:url" content="https://www.welivesecurity.com/2018/11/20/sednit-whats-going-zebrocy/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2018-11-20T16:34:30+00:00" />
<meta property="article:modified_time" content="2018-11-28T06:29:50+00:00" />
<meta property="og:updated_time" content="2018-11-28T06:29:50+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2018/11/shutterstock_797077930-1024x576.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2018/11/shutterstock_797077930-1024x576.jpg" />
<meta property="og:image:width" content="1024" />
<meta property="og:image:height" content="576" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="In August 2018, Sednit’s operators deployed two new Zebrocy components, and since then we have seen an uptick in Zebrocy deployments, with targets in Central Asia, as well as countries in Central and Eastern Europe, notably embassies, ministries of foreign affairs, and diplomats." />
<meta name="twitter:title" content="Sednit: What’s going on with Zebrocy? | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2018/11/shutterstock_797077930.jpg" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel="alternate" href="https://www.welivesecurity.com/fr/2018/11/22/sednit-nouveautes-zebrocy/" hreflang="fr" />
<link rel="alternate" href="https://www.welivesecurity.com/2018/11/20/sednit-whats-going-zebrocy/" hreflang="en" />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single wide">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/2018/11/22/sednit-nouveautes-zebrocy/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/2018/11/22/sednit-nouveautes-zebrocy/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-wide" style="background-image: url('../../../../wp-content/uploads/2018/11/shutterstock_797077930.jpg'); background-position: 50% 50%;">
    <div class="text-wrapper">
        <div class="container promo-text">
            <div class="col-md-11 col-sm-11 col-xs-12 no-padding">
                <h1>Sednit: What’s going on with Zebrocy?</h1>
<div class="excerpt">In August 2018, Sednit’s operators deployed two new Zebrocy components, and since then we have seen an uptick in Zebrocy deployments, with targets in Central Asia, as well as countries in Central and Eastern Europe, notably embassies, ministries of foreign affairs, and diplomats</div>
<div class="post-meta">
    <div class="wls-authors">
                <div class="wls-author with-avatar">
                            <div class="wls-author-avatar">
                    <a href="https://www.welivesecurity.com/author/esetresearch/" title="ESET Research">
                        <img src="https://www.welivesecurity.com/wp-content/uploads/2020/04/android-fullpage-1024x576-Copy-222x179.jpg" alt="ESET Research">
                    </a>
                </div>
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/esetresearch/" title="ESET Research">
                    ESET Research                </a>
            </div>
        </div>
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2018-11-20 17:34:30">20 Nov 2018 - 05:34PM</time>
		</span>
			</span>
</div>
            </div>
        </div>
    </div>
</div>

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F11%2F20%2Fsednit-whats-going-zebrocy%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F11%2F20%2Fsednit-whats-going-zebrocy%2F&text=Sednit: What’s going on with Zebrocy?%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F11%2F20%2Fsednit-whats-going-zebrocy%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt wide">
                                <p>In August 2018, Sednit’s operators deployed two new Zebrocy components, and since then we have seen an uptick in Zebrocy deployments, with targets in Central Asia, as well as countries in Central and Eastern Europe, notably embassies, ministries of foreign affairs, and diplomats</p>
                            </div>

                            <p>The Sednit group has been operating since at least 2004, and has made headlines frequently in past years: it is believed to be behind major, high profile attacks. For instance, the US Department of Justice named the group as being responsible for the Democratic National Committee (DNC) hack just before the US 2016 elections. The group is also presumed to be behind the hacking of global television network TV5Monde, the World Anti-Doping Agency (WADA) email leak, and many others. This group has a diversified set of malware tools in its arsenal, several examples of which we have documented previously in <a href="https://www.welivesecurity.com/wp-content/uploads/2016/10/eset-sednit-full.pdf">our Sednit white paper from 2016</a>.</p>
<p>Meanwhile, ESET researchers released a whitepaper on <a href="https://www.welivesecurity.com/2018/09/27/lojax-first-uefi-rootkit-found-wild-courtesy-sednit-group/">LoJax</a>, a UEFI rootkit we attribute to Sednit, used against organizations in the Balkans, and Central and Eastern Europe.</p>
<p>In August 2018, Sednit’s operators deployed two new Zebrocy components, and since then we have seen an uptick in Zebrocy deployments. Zebrocy is a set of downloaders, droppers and backdoors; while downloaders and droppers are doing reconnaissance, backdoors implement persistence and spying activities against the target. These new components use a an unusual way to exfiltrate gathered information by using protocols related to mail services such as SMTP and POP3.</p>
<p>The victims targeted by these new components are similar to victims mentioned in our previous <a href="https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/">Zebrocy</a> post and by <a href="https://securelist.com/masha-and-these-bears/84311/">Kaspersky</a>. The targets of such attacks are located in Central Asia, as well as countries in Central and Eastern Europe, notably embassies, ministries of foreign affairs, and diplomats.</p>
<h2 class="Heading" style="text-align: left;" align="left"><span lang="FR">The big picture</span></h2>
<p><img class="aligncenter wp-image-119082 size-large" src="/wp-content/uploads/2018/11/Afigure1-1024x895.jpg" alt="" width="1024" height="895" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/11/Afigure1-1024x895.jpg 1024w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Afigure1-300x262.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Afigure1-768x671.jpg 768w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Afigure1-87x77.jpg 87w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Afigure1-60x53.jpg 60w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Afigure1-85x75.jpg 85w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Afigure1.jpg 1299w" sizes="(max-width: 1024px) 100vw, 1024px" /></p>
<p>For two years now, the Sednit group has primarily used phishing emails as the infection vector for Zebrocy campaigns (Case 1 and Case 2). Once the targets have been compromised, they use different first stage downloaders to gather information about the victims and, should the victims be interesting enough, after a delay of several hours – or even days – they deploy one of their second-level backdoors.</p>
<p>The classic modus operandi for a Zebrocy campaign is for the victim to receive an archive attached to an email. This archive contains two files, one a benign document and one an executable. The operator tries to fool the victim by naming the executable with an apparent document or image file name by incorporating the “double extension” trick..</p>
<p>This new campaign, depicted as Case 3 in Figure 1, uses a more involved procedure.  We dissect this process below.</p>
<h2>Delphi dropper</h2>
<p>The first binary is a Delphi dropper, which is kind of unusual for a Zebrocy campaign. Most of the time it’s a downloader rather than a dropper that is installed on the victim system as the first stage.</p>
<p>This dropper contains some tricks to make it more difficult to reverse-engineer. It uses a keyword – <strong><em>liver</em></strong> in the samples we described here – to mark the start and end of key elements as shown below.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b636525954732" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$ yara -s tag_yara.yar  SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe
find_tag SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe
0x4c260:$tag: l\x00i\x00v\x00e\x00r\x00
0x6f000:$tag: liver
0x6f020:$tag: liver
0x13ab0c:$tag: liver</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b636525954732-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b636525954732-2">2</div><div class="crayon-num" data-line="crayon-605814505b636525954732-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b636525954732-4">4</div><div class="crayon-num" data-line="crayon-605814505b636525954732-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b636525954732-6">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b636525954732-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">yara</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-v">tag_yara</span><span class="crayon-sy">.</span><span class="crayon-i">yar</span> <span class="crayon-h"> </span><span class="crayon-v">SCANPASS_QXWEGRFGCVT_323803488900X_jpeg</span><span class="crayon-sy">.</span><span class="crayon-e">exe</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b636525954732-2"><span class="crayon-e">find_tag </span><span class="crayon-v">SCANPASS_QXWEGRFGCVT_323803488900X_jpeg</span><span class="crayon-sy">.</span><span class="crayon-i">exe</span></div><div class="crayon-line" id="crayon-605814505b636525954732-3"><span class="crayon-cn">0x4c260</span><span class="crayon-o">:</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-sy">\</span><span class="crayon-v">x00i</span><span class="crayon-sy">\</span><span class="crayon-v">x00v</span><span class="crayon-sy">\</span><span class="crayon-v">x00e</span><span class="crayon-sy">\</span><span class="crayon-v">x00r</span><span class="crayon-sy">\</span><span class="crayon-i">x00</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b636525954732-4"><span class="crayon-cn">0x6f000</span><span class="crayon-o">:</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">liver</span></div><div class="crayon-line" id="crayon-605814505b636525954732-5"><span class="crayon-cn">0x6f020</span><span class="crayon-o">:</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">liver</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b636525954732-6"><span class="crayon-cn">0x13ab0c</span><span class="crayon-o">:</span><span class="crayon-sy">$</span><span class="crayon-v">tag</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">liver</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>The YARA rule above looks for the string <strong><em>liver</em></strong>. The first <strong><em>liver</em></strong> is the one used in the code and it doesn’t separate anything from anything, while the others separate the key descriptor, the image (hexdump below) and the encrypted payload in the dropper.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b63c460109867" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$ hexdump -Cn 48 -s 0x6f000  SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe
0006f000  6c 69 76 65 72 4f 70 65  6e 41 69 72 33 39 30 34  |liverOpenAir3904|
0006f010  35 5f 42 61 79 72 65 6e  5f 4d 75 6e 63 68 65 6e  |5_Bayren_Munchen|
0006f020  6c 69 76 65 72 ff d8 ff  e0 00 10 4a 46 49 46 00  |liver……JFIF.|</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b63c460109867-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b63c460109867-2">2</div><div class="crayon-num" data-line="crayon-605814505b63c460109867-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b63c460109867-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b63c460109867-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-v">hexdump</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">Cn</span><span class="crayon-h"> </span><span class="crayon-cn">48</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-i">s</span><span class="crayon-h"> </span><span class="crayon-cn">0x6f000</span> <span class="crayon-h"> </span><span class="crayon-v">SCANPASS_QXWEGRFGCVT_323803488900X_jpeg</span><span class="crayon-sy">.</span><span class="crayon-i">exe</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b63c460109867-2"><span class="crayon-cn">0006f000</span> <span class="crayon-h"> </span><span class="crayon-cn">6c</span><span class="crayon-h"> </span><span class="crayon-cn">69</span><span class="crayon-h"> </span><span class="crayon-cn">76</span><span class="crayon-h"> </span><span class="crayon-cn">65</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-h"> </span><span class="crayon-cn">4f</span><span class="crayon-h"> </span><span class="crayon-cn">70</span><span class="crayon-h"> </span><span class="crayon-cn">65</span> <span class="crayon-h"> </span><span class="crayon-cn">6e</span><span class="crayon-h"> </span><span class="crayon-cn">41</span><span class="crayon-h"> </span><span class="crayon-cn">69</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-h"> </span><span class="crayon-cn">33</span><span class="crayon-h"> </span><span class="crayon-cn">39</span><span class="crayon-h"> </span><span class="crayon-cn">30</span><span class="crayon-h"> </span><span class="crayon-cn">34</span> <span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-v">liverOpenAir3904</span><span class="crayon-o">|</span></div><div class="crayon-line" id="crayon-605814505b63c460109867-3"><span class="crayon-cn">0006f010</span> <span class="crayon-h"> </span><span class="crayon-cn">35</span><span class="crayon-h"> </span><span class="crayon-cn">5f</span><span class="crayon-h"> </span><span class="crayon-cn">42</span><span class="crayon-h"> </span><span class="crayon-cn">61</span><span class="crayon-h"> </span><span class="crayon-cn">79</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-h"> </span><span class="crayon-cn">65</span><span class="crayon-h"> </span><span class="crayon-cn">6e</span> <span class="crayon-h"> </span><span class="crayon-cn">5f</span><span class="crayon-h"> </span><span class="crayon-cn">4d</span><span class="crayon-h"> </span><span class="crayon-cn">75</span><span class="crayon-h"> </span><span class="crayon-cn">6e</span><span class="crayon-h"> </span><span class="crayon-cn">63</span><span class="crayon-h"> </span><span class="crayon-cn">68</span><span class="crayon-h"> </span><span class="crayon-cn">65</span><span class="crayon-h"> </span><span class="crayon-cn">6e</span> <span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-cn">5_Bayren_Munchen</span><span class="crayon-o">|</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b63c460109867-4"><span class="crayon-cn">0006f020</span> <span class="crayon-h"> </span><span class="crayon-cn">6c</span><span class="crayon-h"> </span><span class="crayon-cn">69</span><span class="crayon-h"> </span><span class="crayon-cn">76</span><span class="crayon-h"> </span><span class="crayon-cn">65</span><span class="crayon-h"> </span><span class="crayon-cn">72</span><span class="crayon-h"> </span><span class="crayon-e">ff </span><span class="crayon-e">d8 </span><span class="crayon-i">ff</span> <span class="crayon-h"> </span><span class="crayon-i">e0</span><span class="crayon-h"> </span><span class="crayon-cn">00</span><span class="crayon-h"> </span><span class="crayon-cn">10</span><span class="crayon-h"> </span><span class="crayon-cn">4a</span><span class="crayon-h"> </span><span class="crayon-cn">46</span><span class="crayon-h"> </span><span class="crayon-cn">49</span><span class="crayon-h"> </span><span class="crayon-cn">46</span><span class="crayon-h"> </span><span class="crayon-cn">00</span> <span class="crayon-h"> </span><span class="crayon-o">|</span><span class="crayon-i">liver</span>……<span class="crayon-v">JFIF</span><span class="crayon-sy">.</span><span class="crayon-o">|</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Starting with the image, this is dropped as <strong><em>C:\Users\public\Pictures\scanPassport.jpg</em></strong> if a file of that name does not already exist. Interestingly, the dropper&#8217;s filename, <strong><em>SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe</em></strong>, also hints at a phishing scheme revolving around traveling or passport information. This might indicate that the operator knew the phishing message’s target. The dropper opens the image: if the file exists, it stops executing; otherwise, it drops the image, opens it, and retrieves the key descriptor <strong><em>OpenAir39045_Bayren_Munchen</em></strong>. The image doesn’t seem to display anything while the file format is valid; see Figure 2.</p>
<p><img class="aligncenter wp-image-119084 size-large" src="/wp-content/uploads/2018/11/figure2-1024x788.jpg" alt="" width="1024" height="788" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/11/figure2-1024x788.jpg 1024w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure2-300x231.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure2-768x591.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px" /></p>
<p>The key descriptor’s string contains <strong><em>Bayren_Munchen</em></strong> which seems likely to refer to the German soccer team FC Bayern Munich. Regardless, it is not the content of the key descriptor<em> – </em>but its length <em>–  </em> that matters, with that length used to retrieve the XOR key used to encrypt the payload.</p>
<p>To get the XOR key, the dropper looks for the last <strong><em>liver</em></strong> keyword and adds the offset of the key descriptor. The length of the XOR key – 27 (0x1b) bytes – is the same as that of the key descriptor.</p>
<p>Using the XOR key and a simple XOR loop, the dropper decrypts the last part – which is the encrypted payload – right after the last tag until the end of the file. Notice that the executable payload’s MZ header starts right after the keyword <strong><em>liver</em></strong> and the XOR key retrieved from a part of the PE header that is normally a sequence of 0x00 bytes, which are restored once the payload is decrypted, as seen in Figure 3.</p>
<p><img class="aligncenter wp-image-119078 size-large" src="/wp-content/uploads/2018/11/figure3-1024x144.jpg" alt="" width="1024" height="144" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/11/figure3-1024x144.jpg 1024w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure3-300x42.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure3-768x108.jpg 768w" sizes="(max-width: 1024px) 100vw, 1024px" /></p>
<p>It drops the payload as <strong><em>C:\Users\Public\Documents\AcrobatReader.txt</em></strong> and moves the file to <strong><em>C:\Users\Public\Documents\AcrobatReader.exe</em></strong></p>
<p>Perhaps this is an attempt to avoid endpoint protection systems triggering an alert based on a binary dropping a file with a .exe extension.</p>
<p>Once again, the operator tries to fool victims in the event that they take a look at the directory, in which case they&#8217;ll see the file displayed as in Figure 4:</p>
<p><img class="aligncenter wp-image-119086 size-full" src="/wp-content/uploads/2018/11/Payload.jpg" alt="" width="986" height="824" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/11/Payload.jpg 986w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Payload-300x251.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Payload-768x642.jpg 768w" sizes="(max-width: 986px) 100vw, 986px" /></p>
<p>By default, Windows hides the extension, and this is leveraged by the operator to drop an executable in a Documents directory and it makes it look like a PDF file.</p>
<p>Finally, the dropper executes its freshly-dropped payload, and exits.</p>
<h2>MSIL mail downloader</h2>
<p>The payload of the previous dropper is a UPX-packed MSIL downloader. To make the process easier to understand, the main logic is described below, followed by source code, then an overview of the dissected control flow.</p>
<p>The Main method calls <strong><em>Run</em></strong> to start the application, which then creates the form <strong><em>Form1</em></strong>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b63e589409317" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
{
    Application.EnableVisualStyles();
    Application.SetCompatibleTextRenderingDefault(false);
    Application.Run((Form) new Form1());
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b63e589409317-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b63e589409317-2">2</div><div class="crayon-num" data-line="crayon-605814505b63e589409317-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b63e589409317-4">4</div><div class="crayon-num" data-line="crayon-605814505b63e589409317-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b63e589409317-1"><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b63e589409317-2">  <span class="crayon-h"> </span> <span class="crayon-v">Application</span><span class="crayon-sy">.</span><span class="crayon-e">EnableVisualStyles</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b63e589409317-3">   <span class="crayon-h"> </span><span class="crayon-v">Application</span><span class="crayon-sy">.</span><span class="crayon-e">SetCompatibleTextRenderingDefault</span><span class="crayon-sy">(</span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b63e589409317-4">   <span class="crayon-h"> </span><span class="crayon-v">Application</span><span class="crayon-sy">.</span><span class="crayon-e">Run</span><span class="crayon-sy">(</span><span class="crayon-sy">(</span><span class="crayon-v">Form</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Form1</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b63e589409317-5"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p><strong><em>Form1</em></strong> initiates a lot of variables, including a new <a href="https://docs.microsoft.com/en-us/dotnet/api/system.timers.timer">Timer</a> for seven of them.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b640396903393" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    this.start = new Timer(this.components);
    this.inf = new Timer(this.components);
    this.txt = new Timer(this.components);
    this.subject = new Timer(this.components);
    this.run = new Timer(this.components);
    this.load = new Timer(this.components);
    this.screen = new Timer(this.components);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b640396903393-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b640396903393-2">2</div><div class="crayon-num" data-line="crayon-605814505b640396903393-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b640396903393-4">4</div><div class="crayon-num" data-line="crayon-605814505b640396903393-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b640396903393-6">6</div><div class="crayon-num" data-line="crayon-605814505b640396903393-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b640396903393-1">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">start</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Timer</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">components</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b640396903393-2"> <span class="crayon-h"> </span> <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">inf</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Timer</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">components</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b640396903393-3">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">txt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Timer</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">components</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b640396903393-4">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">subject</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Timer</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">components</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b640396903393-5">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">run</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Timer</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">components</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b640396903393-6">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">load</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Timer</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">components</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b640396903393-7">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">screen</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Timer</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">components</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>A Timer object has three important fields:</p>
<ul>
<li>Enabled: indicates if the timer is active.</li>
<li>Interval: the time, in milliseconds, between elapsed events.</li>
<li>Tick: the callback executed when the timer interval has elapsed and the timer is enabled.</li>
</ul>
<p>Here these fields are initialized as:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b641696066589" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
   this.start.Enabled = true;
    this.start.Interval = 120000;
    this.start.Tick += new EventHandler(this.start_Tick);
    this.inf.Interval = 10000;
    this.inf.Tick += new EventHandler(this.inf_Tick);
    this.txt.Interval = 120000;
    this.txt.Tick += new EventHandler(this.txt_Tick);
    this.subject.Interval = 120000;
    this.subject.Tick += new EventHandler(this.subject_Tick);
    this.run.Interval = 60000;
    this.run.Tick += new EventHandler(this.run_Tick);
    this.load.Interval = 120000;
    this.load.Tick += new EventHandler(this.load_Tick);
    this.screen.Interval = 8000;
    this.screen.Tick += new EventHandler(this.screen_Tick);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b641696066589-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b641696066589-2">2</div><div class="crayon-num" data-line="crayon-605814505b641696066589-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b641696066589-4">4</div><div class="crayon-num" data-line="crayon-605814505b641696066589-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b641696066589-6">6</div><div class="crayon-num" data-line="crayon-605814505b641696066589-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b641696066589-8">8</div><div class="crayon-num" data-line="crayon-605814505b641696066589-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b641696066589-10">10</div><div class="crayon-num" data-line="crayon-605814505b641696066589-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b641696066589-12">12</div><div class="crayon-num" data-line="crayon-605814505b641696066589-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b641696066589-14">14</div><div class="crayon-num" data-line="crayon-605814505b641696066589-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b641696066589-1">  <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">start</span><span class="crayon-sy">.</span><span class="crayon-v">Enabled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b641696066589-2">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">start</span><span class="crayon-sy">.</span><span class="crayon-v">Interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">120000</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b641696066589-3">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">start</span><span class="crayon-sy">.</span><span class="crayon-v">Tick</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">EventHandler</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">start_Tick</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b641696066589-4">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">inf</span><span class="crayon-sy">.</span><span class="crayon-v">Interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">10000</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b641696066589-5">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">inf</span><span class="crayon-sy">.</span><span class="crayon-v">Tick</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">EventHandler</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">inf_Tick</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b641696066589-6">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">txt</span><span class="crayon-sy">.</span><span class="crayon-v">Interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">120000</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b641696066589-7">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">txt</span><span class="crayon-sy">.</span><span class="crayon-v">Tick</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">EventHandler</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">txt_Tick</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b641696066589-8">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">subject</span><span class="crayon-sy">.</span><span class="crayon-v">Interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">120000</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b641696066589-9">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">subject</span><span class="crayon-sy">.</span><span class="crayon-v">Tick</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">EventHandler</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">subject_Tick</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b641696066589-10">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">run</span><span class="crayon-sy">.</span><span class="crayon-v">Interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">60000</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b641696066589-11">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">run</span><span class="crayon-sy">.</span><span class="crayon-v">Tick</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">EventHandler</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">run_Tick</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b641696066589-12">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">load</span><span class="crayon-sy">.</span><span class="crayon-v">Interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">120000</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b641696066589-13">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">load</span><span class="crayon-sy">.</span><span class="crayon-v">Tick</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">EventHandler</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">load_Tick</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b641696066589-14">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">screen</span><span class="crayon-sy">.</span><span class="crayon-v">Interval</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">8000</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b641696066589-15">   <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">screen</span><span class="crayon-sy">.</span><span class="crayon-v">Tick</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">EventHandler</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">screen_Tick</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p><em> </em>For each object, it sets an <strong><em>Interval</em></strong> which is from 8 seconds to 2 minutes. A callback is added to the event handler. Notice that <strong><em>start</em></strong> is the only one that sets <strong><em>Enabled</em></strong> as true, meaning that after 2 minutes (12000 milliseconds = 120 seconds) <strong><em>start_Tick</em></strong> will be called by the event handler.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b642198596381" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    private void start_Tick(object sender, EventArgs e)
    {
        try
        {
            this.start.Enabled = false;
            Lenor lenor = new Lenor();
            this.dir = !Directory.Exists(this.label15.Text.ToString()) ? this.label16.Text.ToString() + "\" : this.label15.Text.ToString() + "\";
            this.att = this.dir + "audev.txt";
            this._id = lenor.id(this.dir);
            this.inf.Enabled = true;
        }</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b642198596381-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b642198596381-2">2</div><div class="crayon-num" data-line="crayon-605814505b642198596381-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b642198596381-4">4</div><div class="crayon-num" data-line="crayon-605814505b642198596381-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b642198596381-6">6</div><div class="crayon-num" data-line="crayon-605814505b642198596381-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b642198596381-8">8</div><div class="crayon-num" data-line="crayon-605814505b642198596381-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b642198596381-10">10</div><div class="crayon-num" data-line="crayon-605814505b642198596381-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b642198596381-1">   <span class="crayon-h"> </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">start_Tick</span><span class="crayon-sy">(</span><span class="crayon-t">object</span><span class="crayon-h"> </span><span class="crayon-v">sender</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-i">EventArgs</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b642198596381-2">   <span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-605814505b642198596381-3">       <span class="crayon-h"> </span><span class="crayon-st">try</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b642198596381-4">       <span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-605814505b642198596381-5">           <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">start</span><span class="crayon-sy">.</span><span class="crayon-v">Enabled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">false</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b642198596381-6">           <span class="crayon-h"> </span><span class="crayon-e">Lenor </span><span class="crayon-v">lenor</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Lenor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b642198596381-7">           <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">dir</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-o">!</span><span class="crayon-v">Directory</span><span class="crayon-sy">.</span><span class="crayon-e">Exists</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">label15</span><span class="crayon-sy">.</span><span class="crayon-v">Text</span><span class="crayon-sy">.</span><span class="crayon-e">ToString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">label16</span><span class="crayon-sy">.</span><span class="crayon-v">Text</span><span class="crayon-sy">.</span><span class="crayon-e">ToString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"\" : this.label15.Text.ToString() + "</span><span class="crayon-sy">\</span>"<span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b642198596381-8">           <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">att</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">dir</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"audev.txt"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b642198596381-9">           <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">lenor</span><span class="crayon-sy">.</span><span class="crayon-e">id</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">dir</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b642198596381-10">           <span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">inf</span><span class="crayon-sy">.</span><span class="crayon-v">Enabled</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">true</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b642198596381-11">       <span class="crayon-h"> </span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>Thereafter each method has the same behavior: it sets the <strong><em>Enabled</em></strong> variable to <strong><em>false</em></strong> at the beginning of the method. The method occurs, and afterwards sets the <strong><em>Enabled</em></strong> variable of the next object to <strong><em>true</em></strong>, which will activate the next timer. The <strong><em>Enabled</em></strong> variable is used by the operator to put in place a kind of state machine: if the functions fail, this is a mechanism to repeat failed functions until they succeed. The time between the execution of two functions might be an attempt to evade endpoint protection systems by adding a delay.</p>
<p>Now the structure of each method is defined; the following part will focus on the control flow of the malware.</p>
<p>As the exchanges happen between different email inboxes, here is an overview of the different steps.</p>
<p><img class="aligncenter wp-image-119079 size-large" src="/wp-content/uploads/2018/11/figure5-1024x929.jpg" alt="" width="1024" height="929" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/11/figure5-1024x929.jpg 1024w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure5-300x272.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure5-768x696.jpg 768w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure5-60x53.jpg 60w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure5.jpg 1299w" sizes="(max-width: 1024px) 100vw, 1024px" /></p>
<p>One of the early checks made by the malware is for the existence of a specific path used to drop every file used during its execution. If possible, it uses <strong><em>C:\Users\Public\Videos\</em></strong> &#8212; otherwise it will fall back to <strong><em>C:\Documents and Settings\All Users\Documents\</em></strong> as its default directory. Notice that the latter path is specific to Windows XP while the former is for Vista and above.</p>
<p>A 16-byte <strong><em>id</em></strong> is generated by concatenating the <strong><em>C:</em></strong> volume serial number and the UserName,  and stored in the file <strong><em>audev.txt</em></strong>.</p>
<p>The downloader gathers the following information:</p>
<ul>
<li>current path of the application</li>
<li>operating system version</li>
<li>system directory</li>
<li>user domain</li>
<li>machine name</li>
<li>UserName</li>
<li>current time zone</li>
<li>current date</li>
<li>logical drive list and information about each of them (model, serial number, etc…)</li>
<li>directory listing of <strong><em>C:\Program Files\</em></strong> and <strong><em>C:\Program Files (x86)\</em></strong></li>
<li>process list</li>
</ul>
<p>All this information is stored in the <strong><em>C:\Users\Public\Videos\si.ini</em></strong> file and sent in an email message, as an attachment, via SMTPS, using the default port 465. The email body contains the string <strong><em>SI</em></strong> (which probably stands for System Information), the recipient is <strong><em>sym777.g@post.cz</em></strong>. For all email exchange, the message&#8217;s Subject: set to the <strong><em>id</em></strong>.</p>
<p>The operator chooses to have multiple fallback addresses and sends the same email to two other, different recipients, presumably in case the main one is not working. Once the email has been sent, the downloader deletes the <strong><em>si.ini</em></strong> file.</p>
<p>For the first execution of the malware, it creates the file <strong><em>set.txt</em></strong> with <strong><em>{System_Parametrs = 10} </em></strong>inside and creates the Windows registry entry:</p>
<p><img class="aligncenter wp-image-119080 size-large" src="/wp-content/uploads/2018/11/figure6-1024x259.jpg" alt="" width="1024" height="259" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/11/figure6-1024x259.jpg 1024w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure6-300x76.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure6-768x194.jpg 768w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure6.jpg 1533w" sizes="(max-width: 1024px) 100vw, 1024px" /></p>
<p>One screenshot of the victim’s computer is taken under the name <strong><em>scx.bin</em></strong> and sent as an email attachment with <strong><em>SC</em></strong> (which probably stands for Screenshot) in the email’s body.</p>
<p>After dispatch, this malware connects to the <strong><em>kae.mezhnosh@post.cz</em></strong> mailbox via POP3 over SSL (port 995) and looks for messages with a Subject: that corresponds to its own <strong><em>id</em></strong>. If there is such a message and the body is not empty, the malware hex decodes it and then sends a message with <strong><em>okey</em></strong> in the body to <strong><em>sym777.g@post.cz</em></strong>. The content of the email previously retrieved is cleaned and parsed as below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b644762992029" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
        string[] strArray = this._adr.Replace("B&amp;", "").Replace("Db", "").Split('%');
        string str1 = strArray[0];
        string str2 = strArray[1];</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b644762992029-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b644762992029-2">2</div><div class="crayon-num" data-line="crayon-605814505b644762992029-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b644762992029-1">       <span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">strArray</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">_adr</span><span class="crayon-sy">.</span><span class="crayon-e">Replace</span><span class="crayon-sy">(</span><span class="crayon-s">"B&amp;"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Replace</span><span class="crayon-sy">(</span><span class="crayon-s">"Db"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">Split</span><span class="crayon-sy">(</span><span class="crayon-s">'%'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b644762992029-2">       <span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-v">str1</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">strArray</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-605814505b644762992029-3">       <span class="crayon-h"> </span><span class="crayon-t">string</span><span class="crayon-h"> </span><span class="crayon-v">str2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">strArray</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>Two strings are obtained: the first one is a password and the second is a username for an email address.</p>
<p>These new credentials are used to connect to the specified inbox freshly collected, and to also look there for a message with a subject that matches the malware’s <strong><em>id</em></strong> as well as an attachment with the string <strong><em>audev</em></strong> in its filename. If both conditions are met, the malware saves the attachment and deletes the message from the server.</p>
<p>All logging messages are sent to <strong><em>sym777.g@post.cz </em></strong>while messages retrieved via POP3 come from credentials recently obtained.</p>
<p>These decisions from the operators make forensics more difficult. First, if you have the downloader with emails, you can’t connect to the mailbox that contains the next stage.</p>
<p>Second, if you retrieve the email credentials, you still can’t get the next payload because it was deleted after retrieval.</p>
<p>Once the downloader successfully writes the attachment to disk, it sends an email with <strong><em>okey2</em></strong> in the body and an attachment, named <strong><em>l.txt,</em></strong> containing <strong><em>090</em></strong>. The same file is overwritten with <strong><em>000</em></strong> and the malware tries to retrieve another message. Again – if it works – the <strong><em>l.txt</em></strong> file is sent with body text of <strong><em>okey3</em></strong>. The content of the attachment is a directory and a filename. The malware moves the <strong><em>audev</em></strong> file to this filepath. Finally, the malware sends an email with a body message of <strong><em>okey4</em></strong> and <strong><em>l.txt</em></strong> as attachment. It starts the executable — <strong><em>audev.exe</em></strong> and checks in the list of processes to see if one of them contains the string <strong><em>audev</em></strong>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b646170248921" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
   Process.Start(this.rn);
    foreach (Process process in Process.GetProcesses())
    {
        if (process.ProcessName.Contains("audev"))
    }</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b646170248921-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b646170248921-2">2</div><div class="crayon-num" data-line="crayon-605814505b646170248921-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b646170248921-4">4</div><div class="crayon-num" data-line="crayon-605814505b646170248921-5">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b646170248921-1">  <span class="crayon-h"> </span><span class="crayon-v">Process</span><span class="crayon-sy">.</span><span class="crayon-e">Start</span><span class="crayon-sy">(</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">rn</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b646170248921-2">   <span class="crayon-h"> </span><span class="crayon-st">foreach</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">Process </span><span class="crayon-e">process </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">Process</span><span class="crayon-sy">.</span><span class="crayon-e">GetProcesses</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-605814505b646170248921-3">   <span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b646170248921-4">       <span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">process</span><span class="crayon-sy">.</span><span class="crayon-v">ProcessName</span><span class="crayon-sy">.</span><span class="crayon-e">Contains</span><span class="crayon-sy">(</span><span class="crayon-s">"audev"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-605814505b646170248921-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p>If a process with such a name is found, it sends a last email with <strong><em>okey5</em></strong> as the body message and <strong><em>l.txt</em></strong> as the attachment. Finally, it deletes <strong><em>l.txt</em></strong> and <strong><em>set.txt</em></strong>, deletes the Windows registry key it created, and exits.</p>
<h2>Delphi mail downloader</h2>
<p>The main role of this downloader is to assess the importance of the compromised system and, if it is deemed important enough, to download and execute Zebrocy’s last downloader.</p>
<p>The binary is written in Delphi and packed with UPX. The complete definition of the <strong><em>TForm1</em></strong> object can be found in its resource section and contains some configuration parameters used by the malware. The following sections focus on the initialization, capabilities, and network protocol of the downloader.</p>
<h2>Initialization</h2>
<p>At the beginning, it decrypts a bunch of strings that are email addresses and passwords. The operator uses the <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Electronic_Codebook_(ECB)">AES ECB</a> encryption algorithm. Each string is hex-encoded, with the first four bytes corresponding to the final size of the decrypted string (the decrypted strings may contain some padding at the end). There are two AES keys in the <strong><em>TForm1</em></strong> object; the first one is used to encrypt data while the second is used to decrypt.</p>
<p>Emails and passwords are used by the operator to send commands to the malware and also to retrieve information harvested from the victim’s computer. The communication protocols are SMTP and POP3 – both of them over SSL. To use OpenSSL, the malware drops and uses two OpenSSL dynamic link libraries (DLLs): <strong><em>libeay32.dll</em></strong> (<strong><em>98c348cab0f835d6cf17c3a31cd5811f86c0388b</em></strong>) and <strong><em>ssleay32.dll</em></strong> (<strong><em>6d981d71895581dfb103170486b8614f7f203bdc</em></strong>).</p>
<p><img class="aligncenter wp-image-119087 size-large" src="/wp-content/uploads/2018/11/Open-SSL-1024x703.jpg" alt="" width="1024" height="703" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/11/Open-SSL-1024x703.jpg 1024w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Open-SSL-300x206.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Open-SSL-768x527.jpg 768w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Open-SSL-151x103.jpg 151w, https://www.welivesecurity.com/wp-content/uploads/2018/11/Open-SSL.jpg 1580w" sizes="(max-width: 1024px) 100vw, 1024px" /></p>
<p>Notice that all files are dropped in the malware’s working directory, <strong><em>C:\Users\Public\</em></strong></p>
<p>The persistence is done during the first execution of the malware using a well-known <a href="http://www.hexacorn.com/blog/2014/11/14/beyond-good-ol-run-key-part-18/">technique</a>, the “Logon scripts”. It creates a script file <strong><em>registration.bat</em></strong> and writes several strings from the <strong><em>TForm1</em></strong> object. The final script is:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b647910302384" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
reg add HKCU\Environment /v "UserInitMprLogonScript" /t REG_EXPAND_SZ /d "C:\Users\Public\Videos\audev.exe" /f
del C:\Users\Public\Videos\registr.bat
exit</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b647910302384-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b647910302384-2">2</div><div class="crayon-num" data-line="crayon-605814505b647910302384-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b647910302384-1"><span class="crayon-e">reg </span><span class="crayon-e">add </span><span class="crayon-v">HKCU</span><span class="crayon-sy">\</span><span class="crayon-v">Environment</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">v</span><span class="crayon-h"> </span><span class="crayon-s">"UserInitMprLogonScript"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">t</span><span class="crayon-h"> </span><span class="crayon-v">REG_EXPAND_SZ</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">d</span><span class="crayon-h"> </span><span class="crayon-s">"C:\Users\Public\Videos\audev.exe"</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-i">f</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b647910302384-2"><span class="crayon-i">del</span><span class="crayon-h"> </span><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">Users</span><span class="crayon-sy">\</span><span class="crayon-m">Public</span><span class="crayon-sy">\</span><span class="crayon-v">Videos</span><span class="crayon-sy">\</span><span class="crayon-v">registr</span><span class="crayon-sy">.</span><span class="crayon-e">bat</span></div><div class="crayon-line" id="crayon-605814505b647910302384-3"><span class="crayon-v">exit</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>Last but not least, the malware creates an <strong><em>id</em></strong>, in the same way as seen in previous Zebrocy binaries. It retrieves the UserName via the <strong><em>GetUserNameW</em></strong> Windows API and prepends the volume serial number of the C:\ drive.</p>
<h2>Capabilities</h2>
<p>While there are some conditions and order in the execution flow to collect information about the victim, the following section describes different gathering capabilities. The scan configuration is stored in the <strong><em>TForm1</em></strong> object, grouped under seven different possibilities for retrieving information from the victim’s computer.</p>
<p>Starting with a simple scan, the first information that the malware can collect is related to files with the following extensions: <strong><em>.docx, .xlsx, .pdf, .pptx, .rar, .zip, .jpg, .bmp, .tiff</em></strong>. For each file found on the disk, it retrieves the full path and the last modified date of the file. That information is encrypted using the AES key mentioned earlier and stored in the file <strong><em>0.txt</em></strong>. Another scan targets the extensions <strong><em>.dat, .json, .db</em></strong> and like the previous scan it retrieves the full path and last modified date of the file. Then it encrypts them and it stores it under the file <strong><em>57.txt</em></strong>.</p>
<p>Listing running processes is also one of the capabilities of this malware and it stores that information in the <strong><em>08.txt</em></strong> file, and this looks like the listing below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b648354131579" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
======Listing_of_processes=======
[System Process]
System
smss.exe
csrss.exe
wininit.exe
csrss.exe
winlogon.exe
services.exe
lsass.exe
[…]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b648354131579-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b648354131579-2">2</div><div class="crayon-num" data-line="crayon-605814505b648354131579-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b648354131579-4">4</div><div class="crayon-num" data-line="crayon-605814505b648354131579-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b648354131579-6">6</div><div class="crayon-num" data-line="crayon-605814505b648354131579-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b648354131579-8">8</div><div class="crayon-num" data-line="crayon-605814505b648354131579-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b648354131579-10">10</div><div class="crayon-num" data-line="crayon-605814505b648354131579-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b648354131579-1"><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-v">Listing_of_processes</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">=</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b648354131579-2"><span class="crayon-sy">[</span><span class="crayon-e">System </span><span class="crayon-v">Process</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-605814505b648354131579-3"><span class="crayon-e">System</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b648354131579-4"><span class="crayon-v">smss</span><span class="crayon-sy">.</span><span class="crayon-e">exe</span></div><div class="crayon-line" id="crayon-605814505b648354131579-5"><span class="crayon-v">csrss</span><span class="crayon-sy">.</span><span class="crayon-e">exe</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b648354131579-6"><span class="crayon-v">wininit</span><span class="crayon-sy">.</span><span class="crayon-e">exe</span></div><div class="crayon-line" id="crayon-605814505b648354131579-7"><span class="crayon-v">csrss</span><span class="crayon-sy">.</span><span class="crayon-e">exe</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b648354131579-8"><span class="crayon-v">winlogon</span><span class="crayon-sy">.</span><span class="crayon-e">exe</span></div><div class="crayon-line" id="crayon-605814505b648354131579-9"><span class="crayon-v">services</span><span class="crayon-sy">.</span><span class="crayon-e">exe</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b648354131579-10"><span class="crayon-v">lsass</span><span class="crayon-sy">.</span><span class="crayon-i">exe</span></div><div class="crayon-line" id="crayon-605814505b648354131579-11"><span class="crayon-sy">[</span>…<span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p>In the file <strong><em>i.txt</em></strong> the malware gathers general information regarding the victim’s computer as well as some information about the malware, like the version number and the path where it’s executed, as shown below:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-605814505b64a266820642" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
v7.00
C:\Users\Public\Videos\audev.txt 
============================================
Log_Drivers:
 C: fixed; size= 102297 Mb, free=83927 Mb S/N: [redacted]
 ==================================================
 OSV: Windows 7
WinType: 32
WinDir: C:\Windows
Lang: English (United States)
TZ: UTC1:0 Romance Standard Time
HostN: [redacted]-PC
User: [redacted]
===============S_LIST=====================
C:\Program Files\Common Files
C:\Program Files\desktop.ini
C:\Program Files\DVD Maker
C:\Program Files\Internet Explorer
C:\Program Files\Microsoft.NET
C:\Program Files\MSBuild
C:\Program Files\Reference Assemblies
C:\Program Files\Uninstall Information
C:\Program Files\Windows Defender
[…]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-605814505b64a266820642-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-2">2</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-4">4</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-6">6</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-8">8</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-10">10</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-12">12</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-14">14</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-16">16</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-18">18</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-20">20</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-22">22</div><div class="crayon-num" data-line="crayon-605814505b64a266820642-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-605814505b64a266820642-24">24</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-605814505b64a266820642-1"><span class="crayon-v">v7</span><span class="crayon-sy">.</span><span class="crayon-cn">00</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-2"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-v">Users</span><span class="crayon-sy">\</span><span class="crayon-m">Public</span><span class="crayon-sy">\</span><span class="crayon-v">Videos</span><span class="crayon-sy">\</span><span class="crayon-v">audev</span><span class="crayon-sy">.</span><span class="crayon-i">txt</span> </div><div class="crayon-line" id="crayon-605814505b64a266820642-3"><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">==</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-4"><span class="crayon-v">Log_Drivers</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-605814505b64a266820642-5"> <span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">fixed</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">size</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">102297</span><span class="crayon-h"> </span><span class="crayon-v">Mb</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">free</span><span class="crayon-o">=</span><span class="crayon-cn">83927</span><span class="crayon-h"> </span><span class="crayon-i">Mb</span><span class="crayon-h"> </span><span class="crayon-v">S</span><span class="crayon-o">/</span><span class="crayon-v">N</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">redacted</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-6"> <span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">==</span></div><div class="crayon-line" id="crayon-605814505b64a266820642-7"> <span class="crayon-v">OSV</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-i">Windows</span><span class="crayon-h"> </span><span class="crayon-cn">7</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-8"><span class="crayon-v">WinType</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">32</span></div><div class="crayon-line" id="crayon-605814505b64a266820642-9"><span class="crayon-v">WinDir</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-e">Windows</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-10"><span class="crayon-v">Lang</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">English</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">United </span><span class="crayon-v">States</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-605814505b64a266820642-11"><span class="crayon-v">TZ</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">UTC1</span><span class="crayon-o">:</span><span class="crayon-cn">0</span><span class="crayon-h"> </span><span class="crayon-e">Romance </span><span class="crayon-e">Standard </span><span class="crayon-e">Time</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-12"><span class="crayon-v">HostN</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">redacted</span><span class="crayon-sy">]</span><span class="crayon-o">-</span><span class="crayon-e">PC</span></div><div class="crayon-line" id="crayon-605814505b64a266820642-13"><span class="crayon-v">User</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">redacted</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-14"><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-v">S_LIST</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span><span class="crayon-o">===</span></div><div class="crayon-line" id="crayon-605814505b64a266820642-15"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-e">Program </span><span class="crayon-v">Files</span><span class="crayon-sy">\</span><span class="crayon-e">Common </span><span class="crayon-i">Files</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-16"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-e">Program </span><span class="crayon-v">Files</span><span class="crayon-sy">\</span><span class="crayon-v">desktop</span><span class="crayon-sy">.</span><span class="crayon-i">ini</span></div><div class="crayon-line" id="crayon-605814505b64a266820642-17"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-e">Program </span><span class="crayon-v">Files</span><span class="crayon-sy">\</span><span class="crayon-e">DVD </span><span class="crayon-i">Maker</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-18"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-e">Program </span><span class="crayon-v">Files</span><span class="crayon-sy">\</span><span class="crayon-e">Internet </span><span class="crayon-i">Explorer</span></div><div class="crayon-line" id="crayon-605814505b64a266820642-19"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-e">Program </span><span class="crayon-v">Files</span><span class="crayon-sy">\</span><span class="crayon-v">Microsoft</span><span class="crayon-sy">.</span><span class="crayon-i">NET</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-20"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-e">Program </span><span class="crayon-v">Files</span><span class="crayon-sy">\</span><span class="crayon-i">MSBuild</span></div><div class="crayon-line" id="crayon-605814505b64a266820642-21"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-e">Program </span><span class="crayon-v">Files</span><span class="crayon-sy">\</span><span class="crayon-e">Reference </span><span class="crayon-i">Assemblies</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-22"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-e">Program </span><span class="crayon-v">Files</span><span class="crayon-sy">\</span><span class="crayon-e">Uninstall </span><span class="crayon-i">Information</span></div><div class="crayon-line" id="crayon-605814505b64a266820642-23"><span class="crayon-v">C</span><span class="crayon-o">:</span><span class="crayon-sy">\</span><span class="crayon-e">Program </span><span class="crayon-v">Files</span><span class="crayon-sy">\</span><span class="crayon-e">Windows </span><span class="crayon-i">Defender</span></div><div class="crayon-line crayon-striped-line" id="crayon-605814505b64a266820642-24"><span class="crayon-sy">[</span>…<span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
<p>The malware is capable of taking screenshots, which are stored as <strong><em>2\[YYYY-mm-dd HH-MM-SS]-Image_001.jpg</em></strong><strong>,</strong> and generates another file <strong><em>2\sa.bin,</em></strong> populated with the path listing of all screenshots taken. Its last capability is network enumeration; the output is found as <strong><em>4.txt</em></strong>.</p>
<h2>Network Protocol</h2>
<p>The Delphi Mail Downloader is quite a new addition to Zebrocy’s toolset and it features a new way to exfiltrate data and retrieve commands from the operator. The exfiltration is quite simple but very noisy on the network, as all the encrypted files gathered previously are sent over SMTPS and each version of the file is sent three times.</p>

<table id="tablepress-612" class="tablepress tablepress-id-612">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Sender</th><th class="column-2">Recipient</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">kevin30@ambcomission.com</td><td class="column-2">rishit333@ambcomission.com</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">salah444@ambcomission.com</td><td class="column-2">rishit333@ambcomission.com</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">karakos3232@seznam.cz</td><td class="column-2">antony.miloshevich128@seznam.cz</td>
</tr>
</tbody>
</table>

<p>The Subject: of the mail is the <strong><em>id</em></strong> of the victim and the file is sent as an attachment with a keyword corresponding to the file content. Notice that for each file there is an encrypted version of the file sent.</p>

<table id="tablepress-613" class="tablepress tablepress-id-613">
<thead>
<tr class="row-1 odd">
	<th class="column-1">files</th><th class="column-2">files encrypted</th><th class="column-3">keywords</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">-</td><td class="column-2">0.txt</td><td class="column-3">SCAN</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">57.txt</td><td class="column-2">58.txt</td><td class="column-3">ACC</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">08.txt</td><td class="column-2">082.txt</td><td class="column-3">PrL</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">i.txt</td><td class="column-2">i2.txt</td><td class="column-3">SYS_INFO</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">4.txt</td><td class="column-2">42.txt</td><td class="column-3">GET_NETWORK</td>
</tr>
</tbody>
</table>

<p class="Body2"><span lang="EN-US">Screenshots taken and files matching both scans are sent as well but with different keywords.</span></p>

<table id="tablepress-614" class="tablepress tablepress-id-614">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Content</th><th class="column-2">Keywords</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">screenshots</td><td class="column-2">SC</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">.docx, .xlsx, .pdf, .pptx, .rar, .zip, .jpg, .bmp, .tiff</td><td class="column-2">FILEs</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">.dat, .json, .db</td><td class="column-2">D_ACC</td>
</tr>
</tbody>
</table>

<p><img class="aligncenter wp-image-119081 size-large" src="/wp-content/uploads/2018/11/figure8-1024x647.jpg" alt="" width="1024" height="647" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/11/figure8-1024x647.jpg 1024w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure8-300x190.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure8-768x485.jpg 768w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure8-65x42.jpg 65w, https://www.welivesecurity.com/wp-content/uploads/2018/11/figure8.jpg 1337w" sizes="(max-width: 1024px) 100vw, 1024px" /></p>
<p>While the exfiltration uses SMTP, the binary connects to the email address <strong><em>tomasso25@ambcomission.com</em></strong> via POP3 and parses emails. The body of the email contains different keywords that are interpreted as commands by the malware.</p>

<table id="tablepress-615" class="tablepress tablepress-id-615">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Keywords</th><th class="column-2">Purpose</th><th class="column-3">Log</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">scan</td><td class="column-2">scan</td><td class="column-3"></td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">ldfile</td><td class="column-2">scan</td><td class="column-3"></td>
</tr>
<tr class="row-4 even">
	<td class="column-1">edit34</td><td class="column-2">execute and delete</td><td class="column-3"></td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">pKL90</td><td class="column-2">register</td><td class="column-3">isreg</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">prlist</td><td class="column-2">process listing</td><td class="column-3"></td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">Start23</td><td class="column-2">execute</td><td class="column-3">isr</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">net40</td><td class="column-2">enumerating network resources</td><td class="column-3"></td>
</tr>
<tr class="row-9 odd">
	<td class="column-1">dele5</td><td class="column-2">delete file</td><td class="column-3">isd</td>
</tr>
<tr class="row-10 even">
	<td class="column-1">dele6</td><td class="column-2">delete directory</td><td class="column-3">isd</td>
</tr>
<tr class="row-11 odd">
	<td class="column-1">cd25</td><td class="column-2">create directory</td><td class="column-3">isc</td>
</tr>
<tr class="row-12 even">
	<td class="column-1">autodel</td><td class="column-2">delete itself</td><td class="column-3"></td>
</tr>
<tr class="row-13 odd">
	<td class="column-1">Co55</td><td class="column-2">copy file</td><td class="column-3">is_cp</td>
</tr>
<tr class="row-14 even">
	<td class="column-1">Mo00</td><td class="column-2">move file</td><td class="column-3">is_m</td>
</tr>
</tbody>
</table>

<p>Once executed, a debug log and the result of the command, if any, are sent back to the operator. For example, for a scan command, the operator receives a file that contains the list of files matching the scan extensions along with each matching file.</p>
<p>While this downloader has some backdoor features, it drops a Delphi downloader already associated with the group, and described in our previous Zebrocy <a href="https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/">article</a>.</p>
<h2>Summary</h2>
<p>In the past, we identified an overlap between Zebrocy and other traditional Sednit malware. We caught Zebrocy dropping XAgent, the Sednit flagship backdoor. Thus, we attribute Zebrocy to the Sednit group with high confidence.</p>
<p>However, the analysis of these binaries shows some mistakes at the language level as well as development decisions that indicate a different maturity in the development of the toolset. Both downloaders are using mail protocols to exfiltrate information and share common mechanisms to gather the same information. Both are also very noisy on the network and on the system, as they create a lot of files and send a lot of them over the network. While analyzing the Delphi mail downloader, some features seem to have disappeared but some strings still remain the binary. Thus, while this toolset is being operated by the Sednit group, we are very confident that it is being developed by a different and less experienced team, as compared to those who develop the traditional Sednit components.</p>
<p>Zebrocy components are fresh add-ons to the Sednit toolset, and the recent events might explain the increasing use of Zebrocy’s binaries rather than the good old Sednit main malware.</p>
<h2>Indicators of Compromise (IoCs)</h2>

<table id="tablepress-616" class="tablepress tablepress-id-616">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Filename</th><th class="column-2">SHA-1</th><th class="column-3"> ESET detection</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe</td><td class="column-2">7768fd2812ceff05db8f969a7bed1de5615bfc5a</td><td class="column-3">Win32/Sednit.ORQ</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">C:\Users\public\Pictures\scanPassport.jpg</td><td class="column-2">da70c54a8b9fd236793bb2ab3f8a50e6cd37e2df</td><td class="column-3">-</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">C:\Users\Public\Documents\AcrobatReader.{exe,txt}</td><td class="column-2">a225d457c3396e647ffc710cd1edd4c74dc57152</td><td class="column-3">MSIL/Sednit.D</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">C:\Users\Public\Videos\audev.txt</td><td class="column-2">a659a765536d2099ecbde988d6763028ff92752e</td><td class="column-3">Win32/Sednit.CH</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">%TMP%\Indy0037C632.tmp</td><td class="column-2">20954fe36388ae8b1174424c8e4996ea2689f747</td><td class="column-3">Win32/TrojanDownloader.Sednit.CMR</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">%TMP%\Indy01863A21.tmp</td><td class="column-2">e0d8829d2e76e9bb02e3b375981181ae02462c43</td><td class="column-3">Win32/TrojanDownloader.Sednit.CMQ</td>
</tr>
</tbody>
</table>

<h3>List of emails</h3>

<table id="tablepress-617" class="tablepress tablepress-id-617">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Emails</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">carl.dolzhek17@post.cz</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">shinina.lezh@post.cz</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">P0tr4h4s7a@post.cz</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">carl.dolzhek17@post.cz</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">sym777.g@post.cz</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">kae.mezhnosh@post.cz</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">tomasso25@ambcomission.com</td>
</tr>
<tr class="row-9 odd">
	<td class="column-1">kevin30@ambcomission.com</td>
</tr>
<tr class="row-10 even">
	<td class="column-1">salah444@ambcomission.com</td>
</tr>
<tr class="row-11 odd">
	<td class="column-1">karakos3232@seznam.cz</td>
</tr>
<tr class="row-12 even">
	<td class="column-1">rishit333@ambcomission.com</td>
</tr>
<tr class="row-13 odd">
	<td class="column-1">antony.miloshevich128@seznam.cz</td>
</tr>
</tbody>
</table>


                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                <div class="wls-author">
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/esetresearch/" title="ESET Research">
                    ESET Research                </a>
            </div>
        </div>
                                            </div>
                                    <span class="strong">
								        <time datetime="2018-11-20 17:34:30">20 Nov 2018 - 05:34PM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/fbi-cybercrime-losses-2020-ic3-623x432.jpg"
                                                         alt="Sednit: What’s going on with Zebrocy?">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/">
                                                    FBI: Cybercrime losses topped US$4.2 billion in 2020                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/exchange-servers-under-siege-10-apt-groups-623x432.jpg"
                                                         alt="Sednit: What’s going on with Zebrocy?">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/">
                                                    Exchange servers under siege from at least 10 APT groups                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/apple-m1-macs-malware-1-623x432.jpg"
                                                         alt="Sednit: What’s going on with Zebrocy?">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/">
                                                    Malware authors already taking aim at Apple M1 Macs                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/eset-kobalos-hpc-high-performance-computing-malware-research-623x432.jpg"
                                                         alt="Sednit: What’s going on with Zebrocy?">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/">
                                                    Kobalos – A complex Linux threat to high performance computing infrastructure                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F11%2F20%2Fsednit-whats-going-zebrocy%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F11%2F20%2Fsednit-whats-going-zebrocy%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F11%2F20%2Fsednit-whats-going-zebrocy%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-azeu -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"119018 https:\/\/ba-infohub-web01-v.hq.eset.com\/?p=119018","disqusShortname":"welivesecurity","disqusTitle":"Sednit: What\u2019s going on with Zebrocy?","disqusUrl":"https:\/\/www.welivesecurity.com\/2018\/11\/20\/sednit-whats-going-zebrocy\/","postId":"119018"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/tablepress/js/jquery.datatables.min.js?ver=1.9.1'></script>
<script type="text/javascript">
jQuery(document).ready(function($){
$('#tablepress-615').dataTable({"order":[],"orderClasses":false,"stripeClasses":["even","odd"],"pagingType":"simple"});
});
</script>    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>