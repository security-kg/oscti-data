<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Robert Lipovsky',
        'ArticleCategory': 'Malware',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Hesperbot – Technical analysis part 1/2 | WeLiveSecurity</title>
<meta name="description" content="Win32/Spy.Hesperbot is a new banking trojan that has been targeting online banking users in Turkey, the Czech Republic, Portugal and the United Kingdom."/>
<link rel="canonical" href="https://www.welivesecurity.com/2013/09/06/hesperbot-technical-analysis-part-12/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hesperbot – Technical analysis part 1/2 | WeLiveSecurity" />
<meta property="og:description" content="Win32/Spy.Hesperbot is a new banking trojan that has been targeting online banking users in Turkey, the Czech Republic, Portugal and the United Kingdom." />
<meta property="og:url" content="https://www.welivesecurity.com/2013/09/06/hesperbot-technical-analysis-part-12/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:tag" content="banking Trojan" />
<meta property="article:tag" content="hesperbot" />
<meta property="article:tag" content="Malware" />
<meta property="article:tag" content="online banking" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2013-09-06T09:51:28+00:00" />
<meta property="article:modified_time" content="2013-09-10T09:53:34+00:00" />
<meta property="og:updated_time" content="2013-09-10T09:53:34+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2013/09/hesperbot-banking-trojan-3.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2013/09/hesperbot-banking-trojan-3.jpg" />
<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="420" />
<meta property="og:image:alt" content="Hesperbot banking trojan" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="Win32/Spy.Hesperbot is a new banking trojan that has been targeting online banking users in Turkey, the Czech Republic, Portugal and the United Kingdom." />
<meta name="twitter:title" content="Hesperbot – Technical analysis part 1/2 | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2013/09/hesperbot-banking-trojan-3.jpg" />
<meta name="twitter:creator" content="@Robert_Lipovsky" />
<!-- / Yoast SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single noimage">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-noimage">
	<div class="container promo-text">
		<div class="inner clearfix">
			<div class="col-md-11 col-sm-11 col-xs-12 no-padding">
				<h1>Hesperbot – Technical analysis part 1/2</h1>
<div class="excerpt">Win32/Spy.Hesperbot  is a new banking trojan that has been targeting online banking users in Turkey, the Czech Republic, Portugal and the United Kingdom. For more information about its malware spreading campaigns and victims, refer to our first blog post. In this post we’ll cover the technical details of the malware, including the overall architecture, as well as the mobile component.</div>
<div class="post-meta">
    <div class="wls-authors">
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2013-09-06 09:51:28">6 Sep 2013 - 09:51AM</time>
		</span>
			</span>
</div>
			</div>
		</div>
	</div>
</div>	

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F09%2F06%2Fhesperbot-technical-analysis-part-12%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F09%2F06%2Fhesperbot-technical-analysis-part-12%2F&text=Hesperbot – Technical analysis part 1/2%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F09%2F06%2Fhesperbot-technical-analysis-part-12%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt noimage">
                                <p>Win32/Spy.Hesperbot  is a new banking trojan that has been targeting online banking users in Turkey, the Czech Republic, Portugal and the United Kingdom. For more information about its malware spreading campaigns and victims, refer to our first blog post. In this post we’ll cover the technical details of the malware, including the overall architecture, as well as the mobile component.</p>
                            </div>

                            <p><b>Win32/Spy.Hesperbot  is a new banking trojan that has been targeting online banking users in Turkey, the Czech Republic, Portugal and the United Kingdom. For more information about its malware spreading campaigns and victims, refer to </b><a href="/2013/09/04/hesperbot-a-new-advanced-banking-trojan-in-the-wild/"><b>our first blog post</b></a><b>. In this post we’ll cover the technical details of the malware, including the overall architecture, as well as the mobile component. The Trojan is analyzed in t</b><strong><strong>hree blog posts: <a title="/2013/09/04/hesperbot-a-new-advanced-banking-trojan-in-the-wild/" href="/2013/09/04/hesperbot-a-new-advanced-banking-trojan-in-the-wild/" target="_blank">Hesperbot &#8211; A New Advanced Banking Trojan in the Wild</a>, <a title="/2013/09/06/hesperbot-technical-analysis-part-12/" href="/2013/09/06/hesperbot-technical-analysis-part-12/" target="_blank">Hesperbot Technical Analysis Part 1/2</a> and <a title="/2013/09/09/hesperbot-technical-analysis-part-22/" href="/2013/09/09/hesperbot-technical-analysis-part-22/" target="_blank">Hesperbot Technical Analysis Part 2/2</a>. You can download the comprehensive <a title="/wp-content/uploads/2013/09/Hesperbot_Whitepaper.pdf" href="/wp-content/uploads/2013/09/Hesperbot_Whitepaper.pdf" target="_blank">whitepaper</a> here.</strong></strong></p>
<p>&nbsp;</p>
<h1>Overview</h1>
<p>Like many other malware families, Win32/Spy.Hesperbot has a modular architecture. As the first step in infection, the victim downloads and runs a dropper component. The dropper is also protected by a custom malware packer and distributed in a ZIP archive.</p>
<div id="attachment_24361" style="width: 1034px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2013/09/1_Diagramy-01.jpg"><img class=" wp-image-24361 " title="Hesperbot initial modules overview" alt="Hesperbot diagram" src="/wp-content/uploads/2013/09/1_Diagramy-01-1024x576.jpg" width="1024" height="576" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/09/1_Diagramy-01-1024x576.jpg 1024w, https://www.welivesecurity.com/wp-content/uploads/2013/09/1_Diagramy-01-300x168.jpg 300w, https://www.welivesecurity.com/wp-content/uploads/2013/09/1_Diagramy-01-143x79.jpg 143w" sizes="(max-width: 1024px) 100vw, 1024px" /></a><p class="wp-caption-text">Figure 1 – Hesperbot initial modules overview</p></div>
<p>&nbsp;</p>
<p>The dropper’s role is to inject the main component – ‘core’ – into <i>explorer.exe</i>. The core then downloads and loads additional modules, plug-ins used to carry out malicious actions.</p>
<div id="attachment_24400" style="width: 360px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2013/09/Screen-Shot-2013-09-06-at-16.37.33.png"><img class="size-full wp-image-24400" alt="Win32/Spy.Hesperbot modules" src="/wp-content/uploads/2013/09/Screen-Shot-2013-09-06-at-16.37.33.png" width="350" height="170" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/09/Screen-Shot-2013-09-06-at-16.37.33.png 350w, https://www.welivesecurity.com/wp-content/uploads/2013/09/Screen-Shot-2013-09-06-at-16.37.33-300x145.png 300w" sizes="(max-width: 350px) 100vw, 350px" /></a><p class="wp-caption-text">Figure 2 – Description of Win32/Spy.Hesperbot modules</p></div>
<p>The various modules are available both as x86 and x64 variants according to the host system platform.</p>
<p>Selected internal functions of individual modules are available for other modules to use through a virtual method table (vtable).</p>
<p>We have reverse-engineered the malware components and will highlight the most interesting features in the following paragraphs. Most malware components were compiled using Visual Studio 2010 and written in the C programming language, but without using the C Run-Time library. While this isn’t the most sophisticated malware we’ve analysed, Win32/Spy.Hesperbot can’t be dismissed as amateurish.</p>
<h1>Main Modules</h1>
<p><b>dropper</b></p>
<p>The dropper can use one of several methods for injecting the <i>core</i> component into the address space of <i>explorer.exe</i>:</p>
<ul>
<li>Starting a new instance of <i>explorer.exe </i>and patching its entry-point using NtGetContextThread to point to its own code (written using WriteProcessMemory). This can be done either directly or through an intermediate <i>attrib.exe </i>process.</li>
<li>Injecting itself into the actual <i>explorer.exe</i> using the elaborate Shell_TrayWnd/SetWindowLong/SendNotifyMessage trick used in PowerLoader and other malware. (Aleks Matrosov has published <a href="/2013/08/27/the-powerloader-64-bit-update-based-on-leaked-exploits/">multiple</a> <a href="/2013/03/19/gapz-and-redyms-droppers-based-on-power-loader-code/">blog</a> <a href="/2012/12/27/win32gapz-steps-of-evolution/">posts</a> about it recently, so I won’t go into details here.)</li>
<li>Injecting itself into <i>explorer.exe</i> using the common approach with CreateRemoteThread</li>
</ul>
<p>Interestingly, the injection method is also based on whether the <i>cmdguard.sys</i> (Comodo) or <i>klif.sys</i> (Kaspersky) drivers are found on the system.</p>
<p><b>core</b></p>
<p>The core module, now running in the context of <i>explorer.exe</i>, handles communication with the C&amp;C server and launching other plug-in modules. Typical malware functionality, such as writing to the <i>Run</i> Windows Registry key, is also handled by <i>core</i>.</p>
<p>In order to access the C&amp;C server, Win32/Spy.Hesperbot.A uses either a hard-coded URL (different ones were seen in the variants used by the Czech, Turkish and Portuguese botnets) or generates new C&amp;C URLs using a domain generation algorithm in case the first server is inaccessible.</p>
<p>The following information is sent to the command-and-control server:</p>
<ul>
<li>Bot name based on the Computer Name</li>
<li>Botnet name – so far, we have seen “cz-botnet”, “tr-botnet”, “pt-botnet”, “uk-botnet” and “super-botnet” (used in early “beta” versions)</li>
<li>IP addresses of present network adapters</li>
<li><span style="font-size: 13px; line-height: 19px;">Names of active smart-cards</span></li>
<li><span style="font-size: 13px; line-height: 19px;"><span style="font-size: 13px; line-height: 19px;">Information about installed Hesperbot plug-ins</span></span></li>
</ul>
<div id="attachment_24366" style="width: 326px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2013/09/31.png"><img class=" wp-image-24366 " title="Hesperbot botnet identifier" alt="Hesperbot botnet identifier" src="/wp-content/uploads/2013/09/31.png" width="316" height="90" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/09/31.png 316w, https://www.welivesecurity.com/wp-content/uploads/2013/09/31-300x85.png 300w" sizes="(max-width: 316px) 100vw, 316px" /></a><p class="wp-caption-text">Figure 3 – Botnet identifier in Hesperbot code</p></div>
<p style="font-size: 13px; line-height: 19px;">In return, the server can send:</p>
<ul>
<li><span style="font-size: 13px; line-height: 19px;">A configuration file</span></li>
<li><span style="font-size: 13px; line-height: 19px;">Plugin modules</span></li>
<li><span style="font-size: 13px; line-height: 19px;">An arbitrary executable to run</span></li>
<li><span style="color: #000000; font-size: 13px; line-height: 19px;">A new version of itself</span></li>
</ul>
<p><span style="font-size: 13px; line-height: 19px;"><span style="font-size: 13px; line-height: 19px;"> </span></span>Several technical details regarding the abovementioned functionality are worth mentioning. Firstly, the malware is able to enumerate smart cards present in the system using the <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa379479%28v=vs.85%29.aspx">SCardEstablishContext</a>, <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa379793%28v=vs.85%29.aspx">SCardListReaders</a> and <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa379473%28v=vs.85%29.aspx">SCardConnect</a> API functions. Unlike more sophisticated attacks against smart cards (described by Aleks <a href="/2012/06/05/smartcard-vulnerabilities-in-modern-banking-malware/">here</a> and <a href="/2010/11/05/dr-zeus-the-bot-in-the-hat/">here</a>), Win32/Spy.Hesperbot only collects smart-card names and doesn’t contain the ability to interact with them.</p>
<p><span style="font-size: 13px; line-height: 19px;">Secondly, the downloaded data (namely the configuration file and plugin modules) is encrypted using the </span><a style="font-size: 13px; line-height: 19px;" href="http://en.wikipedia.org/wiki/Twofish">Twofish cipher</a><span style="font-size: 13px; line-height: 19px;">. The 256-bit key is a hash based on:</span></p>
<ul>
<li><span style="font-size: 13px; line-height: 19px;">Computer Name</span></li>
<li><span style="font-size: 13px; line-height: 19px;">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion] &#8220;InstallDate&#8221;</span></li>
<li><span style="font-size: 13px; line-height: 19px;">Windows version</span></li>
<li><span style="font-size: 13px; line-height: 19px;">Processor architecture (x86, x64 or IA64)</span></li>
<li><span style="font-size: 13px; line-height: 19px;">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography] &#8220;MachineGuid&#8221;</span></li>
<li><span style="font-size: 13px; line-height: 19px;">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion] &#8220;DigitalProductId&#8221;</span></li>
</ul>
<p><span style="font-size: 13px; line-height: 19px;">For storing the downloaded data as well as other auxiliary binaries (e.g. the log created by the keylogger module), Hesperbot uses a randomly named subdirectory under %APPDATA%.<br />
</span><br />
<span style="font-size: 13px; line-height: 19px;">The core module can inject itself into all running processes. Furthermore, an undocumented trick of hooking UserNotifyProcessCreate is used when running inside </span><i style="font-size: 13px; line-height: 19px;">csrss.exe</i><span style="font-size: 13px; line-height: 19px;">, to ensure that the trojan’s code will be injected into every new process.<br />
</span></p>
<h1>Mobile Component</h1>
<p>It’s common nowadays that banking trojans also utilize mobile components (like ZitMo and SpitMo, for instance) in order to bypass banks’ out-of-band authentication through mTANs (<a href="http://en.wikipedia.org/wiki/Transaction_authentication_number#Mobile_TAN_.28mTAN.29">Mobile Transaction Authentication Number</a>).</p>
<p>In the web-inject scripts that we have seen so far, the malware injects code into the website, which prompts the user to install an application on their mobile phone. The victim is offered a dropdown list of phone models and after entering their phone number a link to download the mobile component is sent to their phone. Three mobile platforms are supported: <b>Android</b>, <b>Symbian</b> and <b>Blackberry</b>.</p>
<div id="attachment_24370" style="width: 445px" class="wp-caption alignnone"><a href="/wp-content/uploads/2013/09/41.png"><img class="size-full wp-image-24370" alt="Support mobile platforms in web-inject Javascript" src="/wp-content/uploads/2013/09/41.png" width="435" height="198" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/09/41.png 435w, https://www.welivesecurity.com/wp-content/uploads/2013/09/41-300x136.png 300w" sizes="(max-width: 435px) 100vw, 435px" /></a><p class="wp-caption-text">Figure 4 &#8211; Supported mobile platforms in web-inject JavaScript</p></div>
<p><span style="font-size: 13px; line-height: 19px;">We have analysed the Symbian and Android versions, but haven’t so far been able to obtain the Blackberry malware. The Symbian version supports a broad range of devices, including Symbian S60 3</span><sup style="line-height: 19px;">rd</sup><span style="font-size: 13px; line-height: 19px;"> edition, Symbian S60 5</span><sup style="line-height: 19px;">th</sup><span style="font-size: 13px; line-height: 19px;"> edition and the latest Symbian^3.</span></p>
<p>Both of the analysed mobile trojans exhibit similar functionality. First, there is an “activation procedure”. The web-inject JavaScript on the Hesperbot-infected computer generates a random “activation number”, which is displayed to the user. The user is supposed re-type the number when prompted by the mobile application. The mobile app then displays a “response code”, which is calculated from the activation number. The user is then asked to enter it back into the webpage on their computer for verification. (The injected script contains the same algorithm for calculating the response code as in the mobile component.) This functionality provides the attackers confirmation that the victim has installed the mobile component successfully and ties it with the bot infection.</p>
<div id="attachment_24368" style="width: 490px" class="wp-caption aligncenter"><img class="alignleft size-full wp-image-24487" alt="5_without_eset-1" src="/wp-content/uploads/2013/09/5_without_eset-1.png" width="480" height="800" srcset="https://www.welivesecurity.com/wp-content/uploads/2013/09/5_without_eset-1.png 480w, https://www.welivesecurity.com/wp-content/uploads/2013/09/5_without_eset-1-180x300.png 180w" sizes="(max-width: 480px) 100vw, 480px" /><p class="wp-caption-text">Screenshot of Android component – Android/Spy.Hesperbot.A</p></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>As expected, the code, both in the Symbian and Android versions (and likely in the Blackberry version as well), registers a service that waits for incoming SMS messages and forwards them to the attacker’s phone number. This way the attacker will get the mTAN necessary for logging into the hijacked bank account.</p>
<p>The mobile code also implements the attacker’s ability to control the service remotely through SMS commands.</p>
<p>The Android component is detected by ESET as <b>Android/Spy.Hesperbot.A</b> and the Symbian version as <b>SymbOS9/Spy.Hesperbot.A</b>.</p>
<h1>Other Functionality</h1>
<h2>Keylogger</h2>
<p>The keylogger module intercepts key strokes by hooking the functions <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms644936%28v=vs.85%29.aspx">GetMessage</a> and <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms644955%28v=vs.85%29.aspx">TranslateMessage</a> in user32.dll. They are then written to a log file, along with the originating process module name and window title text. Afterwards, the log gets sent to the C&amp;C server.</p>
<h2>Screenshots and Video Capture</h2>
<p>The screenshots and video capture is done by the httpi module, if specified in the configuration file.</p>
<p>The video capture functionality has been used by the Zeus banking trojan spin-off Citadel and provides the attackers with an even better overview of what’s happening on the victim’s screen. It’s implemented using Avifil32.dll functions <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd756793%28v=vs.85%29.aspx">AVIFileCreateStream</a>, <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd756811%28v=vs.85%29.aspx">AVIFileMakeCompressedStream</a>, <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd756860%28v=vs.85%29.aspx">AVIStreamWrite</a>, etc.</p>
<div id="attachment_24371" style="width: 269px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2013/09/61.png"><img class=" wp-image-24371 " title="Hesperbot banking trojan" alt="Hesperbot's video capturing code" src="/wp-content/uploads/2013/09/61.png" width="259" height="196" /></a><p class="wp-caption-text">Figure 6 &#8211; Part of Hesperbot&#8217;s video capturing code</p></div>
<p>The more common screenshot functionality is implemented using the Gdi32.dll functions <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd183370%28v=vs.85%29.aspx">BitBlt</a>, <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/dd144879%28v=vs.85%29.aspx">GetDIBits</a>, etc.</p>
<p><b>Hidden VNC</b></p>
<p>The VNC functionality has previously been used in the infamous <a href="/2013/03/25/carberp-the-never-ending-story/">Carberp malware</a>. (In fact, Carberp may have also been an inspiration to the Hesperbot creators after its <a href="/2013/06/26/carberp-code-leak-could-lead-to-new-wave-of-attacks/">source code leak</a>.) It enables the trojan to create a hidden VNC server, to which the attacker can remotely connect. As VNC doesn’t log the user off like RDP, the attacker can connect to the unsuspecting victim’s computer while they’re working. The VNC session runs in a separate desktop (see <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms682124%28v=vs.85%29.aspx">CreateDesktop on MSDN</a>), invisible to the user. The module also provides the attacker with the capability to launch a browser that’s installed on the host system. In this way, the attacker will also have access to all browser-associated data (cookies, sessions, etc.).</p>
<p><b><i>In our 3<sup>rd</sup> blog post on Win32/Spy.Hesperbot, we will cover the technical details regarding the network interception and web-inject functionality. Stay tuned.</i></b></p>

                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                                            </div>
                                    <span class="strong">
								        <time datetime="2013-09-06 09:51:28">6 Sep 2013 - 09:51AM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/fbi-cybercrime-losses-2020-ic3-623x432.jpg"
                                                         alt="Hesperbot – Technical analysis part 1/2">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/">
                                                    FBI: Cybercrime losses topped US$4.2 billion in 2020                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/exchange-servers-under-siege-10-apt-groups-623x432.jpg"
                                                         alt="Hesperbot – Technical analysis part 1/2">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/">
                                                    Exchange servers under siege from at least 10 APT groups                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/apple-m1-macs-malware-1-623x432.jpg"
                                                         alt="Hesperbot – Technical analysis part 1/2">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/">
                                                    Malware authors already taking aim at Apple M1 Macs                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/eset-kobalos-hpc-high-performance-computing-malware-research-623x432.jpg"
                                                         alt="Hesperbot – Technical analysis part 1/2">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/">
                                                    Kobalos – A complex Linux threat to high performance computing infrastructure                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F09%2F06%2Fhesperbot-technical-analysis-part-12%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F09%2F06%2Fhesperbot-technical-analysis-part-12%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2013%2F09%2F06%2Fhesperbot-technical-analysis-part-12%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-azeu -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"24360 \/?p=24360","disqusShortname":"welivesecurity","disqusTitle":"Hesperbot \u2013\u00a0Technical analysis part 1\/2","disqusUrl":"https:\/\/www.welivesecurity.com\/2013\/09\/06\/hesperbot-technical-analysis-part-12\/","postId":"24360"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>