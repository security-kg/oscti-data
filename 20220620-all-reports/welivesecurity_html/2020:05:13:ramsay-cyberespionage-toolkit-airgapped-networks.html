<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Ignacio Sanmillan',
        'ArticleCategory': 'Malware',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>Ramsay: A cyber&#8209;espionage toolkit tailored for air&#8209;gapped networks | WeLiveSecurity</title>
<meta name="description" content="ESET researchers have discovered Ramsay, a previously unreported cyber-espionage framework that is tailored for collection and exfiltration of sensitive documents and is capable of operating within air-gapped networks."/>
<link rel="canonical" href="https://www.welivesecurity.com/2020/05/13/ramsay-cyberespionage-toolkit-airgapped-networks/" />
<meta property="og:locale" content="en_US" />
<meta property="og:locale:alternate" content="fr_FR" />
<meta property="og:locale:alternate" content="de_DE" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Ramsay: A cyber&#8209;espionage toolkit tailored for air&#8209;gapped networks | WeLiveSecurity" />
<meta property="og:description" content="ESET researchers have discovered Ramsay, a previously unreported cyber-espionage framework that is tailored for collection and exfiltration of sensitive documents and is capable of operating within air-gapped networks." />
<meta property="og:url" content="https://www.welivesecurity.com/2020/05/13/ramsay-cyberespionage-toolkit-airgapped-networks/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="Malware" />
<meta property="article:published_time" content="2020-05-13T09:30:23+00:00" />
<meta property="article:modified_time" content="2020-05-15T00:37:03+00:00" />
<meta property="og:updated_time" content="2020-05-15T00:37:03+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2020/05/Ramsay-cyber-espionage-toolkit-airgapped-networks-1-e1589309436588.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2020/05/Ramsay-cyber-espionage-toolkit-airgapped-networks-1-e1589309436588.jpg" />
<meta property="og:image:width" content="623" />
<meta property="og:image:height" content="416" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="ESET researchers have discovered Ramsay, a previously unreported cyber-espionage framework that is tailored for collection and exfiltration of sensitive documents and is capable of operating within air-gapped networks." />
<meta name="twitter:title" content="Ramsay: A cyber&#8209;espionage toolkit tailored for air&#8209;gapped networks | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2020/05/Ramsay-cyber-espionage-toolkit-airgapped-networks-1-e1589309436588.jpg" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel="alternate" href="https://www.welivesecurity.com/fr/2020/05/18/ramsay-cyberespionnage-reseaux-air-gapped/" hreflang="fr" />
<link rel="alternate" href="https://www.welivesecurity.com/2020/05/13/ramsay-cyberespionage-toolkit-airgapped-networks/" hreflang="en" />
<link rel="alternate" href="https://www.welivesecurity.com/la-es/2020/05/15/ramsay-framework-ciberespionaje-disenado-comprometer-redes-aisladas/" hreflang="es" />
<link rel="alternate" href="https://www.welivesecurity.com/deutsch/2020/05/13/ramsay-ein-cyberspionage-toolkit-speziell-fuer-air-gap-netzwerke/" hreflang="de" />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single wide">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/2020/05/18/ramsay-cyberespionnage-reseaux-air-gapped/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2020/05/15/ramsay-framework-ciberespionaje-disenado-comprometer-redes-aisladas/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2020/05/13/ramsay-ein-cyberspionage-toolkit-speziell-fuer-air-gap-netzwerke/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/2020/05/18/ramsay-cyberespionnage-reseaux-air-gapped/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2020/05/15/ramsay-framework-ciberespionaje-disenado-comprometer-redes-aisladas/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2020/05/13/ramsay-ein-cyberspionage-toolkit-speziell-fuer-air-gap-netzwerke/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-wide" style="background-image: url('../../../../wp-content/uploads/2020/05/Ramsay-cyber-espionage-toolkit-networks-airgapped.jpg'); background-position: 50% 50%;">
    <div class="text-wrapper">
        <div class="container promo-text">
            <div class="col-md-11 col-sm-11 col-xs-12 no-padding">
                <h1>Ramsay: A cyber&#8209;espionage toolkit tailored for air&#8209;gapped networks</h1>
<div class="excerpt">ESET researchers uncover several instances of malware that uses various attack vectors to target systems isolated by an air gap
</div>
<div class="post-meta">
    <div class="wls-authors">
                <div class="wls-author with-avatar">
                            <div class="wls-author-avatar">
                    <a href="https://www.welivesecurity.com/author/isanmillan/" title="Ignacio Sanmillan">
                        <img src="https://www.welivesecurity.com/wp-content/uploads/2020/05/M-Ignacio-Sanmillan-217x179.jpg" alt="Ignacio Sanmillan">
                    </a>
                </div>
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/isanmillan/" title="Ignacio Sanmillan">
                    Ignacio Sanmillan                </a>
            </div>
        </div>
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2020-05-13 11:30:23">13 May 2020 - 11:30AM</time>
		</span>
			</span>
</div>
            </div>
        </div>
    </div>
</div>

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F05%2F13%2Framsay-cyberespionage-toolkit-airgapped-networks%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F05%2F13%2Framsay-cyberespionage-toolkit-airgapped-networks%2F&text=Ramsay: A cyber&#8209;espionage toolkit tailored for air&#8209;gapped networks%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F05%2F13%2Framsay-cyberespionage-toolkit-airgapped-networks%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt wide">
                                <p>ESET researchers uncover several instances of malware that uses various attack vectors to target systems isolated by an air gap</p>
                            </div>

                            <p>ESET researchers have discovered a previously unreported cyber-espionage framework that we named Ramsay and that is tailored for collection and exfiltration of sensitive documents and is capable of operating within air‑gapped networks.</p>
<p>We initially found an instance of Ramsay in VirusTotal. That sample was uploaded from Japan and led us to the discovery of further components and versions of the framework, along with substantial evidence to conclude that this framework is at a developmental stage, with its delivery vectors still undergoing fine-tuning.</p>
<p>The current visibility of targets is low; based on ESET’s telemetry, few victims have been discovered to date. We believe this scarcity of victims reinforces the hypothesis that this framework is under an ongoing development process, although the low visibility of victims could also be due to the nature of targeted systems being in air‑gapped networks.</p>
<p>Shared artifacts were found alongside the <a href="https://blog.360totalsecurity.com/en/analysis-cve-2018-8174-vbscript-0day-apt-actor-related-office-targeted-attack/" target="_blank" rel="noopener">Retro</a> backdoor. This malware has been associated with <a href="https://attack.mitre.org/groups/G0012/" target="_blank" rel="noopener">Darkhotel</a>, a notorious APT group known to have conducted cyber-espionage operations since at least 2004, having targeted government entities in <a href="https://blogs.360.cn/post/apt-c-06_0day.html" target="_blank" rel="noopener">China</a> and <a href="https://blogs.jpcert.or.jp/en/2020/04/ie-firefox-0day.html" target="_blank" rel="noopener">Japan</a> in the past.</p>
<h2>Attack vectors</h2>
<p>Along with the discovery of the different instances of Ramsay<em>, </em>we found they were leveraged using a series of attack vectors. These are:</p>
<div id="attachment_138380" style="width: 760px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-1-2.png"><img class="wp-image-138380" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-1-2-150x150.png" alt="" width="750" height="479" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-1-2-300x191.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-1-2-768x490.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-1-2-1024x653.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-1-2-65x42.png 65w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-1-2.png 1100w" sizes="(max-width: 750px) 100vw, 750px" /></a><p class="wp-caption-text"><i>Figure 1. Overview of discovered Ramsay versions</i></p></div>
<h3>Malicious documents dropping Ramsay version 1</h3>
<p>This attack vector consists of malicious documents exploiting <a href="https://www.cvedetails.com/cve/CVE-2017-0199/" target="_blank" rel="noopener">CVE-2017-0199</a> intended to drop an older version of Ramsay. <em> </em></p>
<p>This document delivers an initial Visual Basic Script, shown in the screenshot below as <span style="font-family: courier new, courier, monospace;">OfficeTemporary.sct</span>, that will extract within the document’s body the Ramsay agent, masquerading as a JPG image by having a base64-encoded PE under a JPG header.</p>

<table id="tablepress-826" class="tablepress tablepress-id-826">
<thead>
<tr class="row-1 odd">
	<th class="column-1"><span style="font-family: courier new, courier, monospace;">ID</span></th><th class="column-2"><span style="font-family: courier new, courier, monospace;">Index</span></th><th class="column-3"><span style="font-family: courier new, courier, monospace;">OLE Object</span></th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;">0</span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;">0x80c8</span></td><td class="column-3"><span style="font-family: courier new, courier, monospace;">Format_id: 2 (Embedded)<br />
Class name: ‘Package’<br />
Data size: 8994<br />
OLE Package object:<br />
Filename: u‘OfficeTemporary.sct’<br />
Source path: u‘C:\\Intel\\OfficeTemporary.sct’<br />
Temp path = u:‘C\\Intel\\OfficeTemporary.sct’<br />
MD5 = ‘cf133c06180f130c471c95b3a4ebd7a5’<br />
EXECUTABLE FILE</span></td>
</tr>
<tr class="row-3 odd">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;">1</span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;">0xc798</span></td><td class="column-3"><span style="font-family: courier new, courier, monospace;">Format_id: 2 (Embedded)<br />
Class name: ‘OLE2Link’<br />
Data size: 2560<br />
MD5 = ‘daee337d42fba92badbea2a4e085f73f’<br />
CLSID: 00000300-0000-0000-C000-000000000046<br />
StdOleLink (embedded OLE object - known related to CVE-2017-0199, CVE-2017-8570, CVE-2017-8759 or CVE-2018-8174.<br />
Possibly an exploit for the OLE2Link vulnerability (VU#921560, CVE-2017-0199)</span></td>
</tr>
</tbody>
</table>

<p><em>Table 1. OLE object layout contained within Ramsay version 1 RTF file as seen by oletools</em></p>
<p>We noticed that the specific Ramsay instance dropped by these documents showed low complexity in its implementation and lacked many of the more advanced features seen leveraged by later Ramsay versions.</p>
<p>Several instances of these same malicious documents were found uploaded to public sandbox engines, labeled as testing artifacts such as <em>‘access_test.docx</em>’ or ‘<em>Test.docx</em>’ denoting an ongoing effort for trial of this specific attack vector.</p>
<p>Based on the low complexity of the Ramsay agent delivered, the threat actors may be embedding this specific instance within these malicious documents for evaluation purposes.</p>
<h3>Decoy installer dropping Ramsay version 2.a</h3>
<p>We found one instance uploaded to VirusTotal of Ramsay masquerading as a 7zip installer.</p>
<p>The reason we named this malware Ramsay was due to some of the strings contained in this binary, such as the following:</p>
<div id="attachment_138381" style="width: 760px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-3-1.png"><img class="wp-image-138381" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-3-1-150x124.png" alt="" width="750" height="111" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-3-1-300x44.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-3-1-768x114.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-3-1.png 838w" sizes="(max-width: 750px) 100vw, 750px" /></a><p class="wp-caption-text"><i>Figure 2. Strings containing &#8220;Ramsay&#8221;</i></p></div>
<p>This version of Ramsay shows a clear refinement of its evasion and persistence tactics along with the introduction of new features such as a Spreader component and a rootkit; the Spreader component is documented more thoroughly in <a href="#Spreading">this part</a> of the Capabilities section.</p>
<h3>Malicious documents dropping Ramsay version 2.b</h3>
<p>This attack vector consists of the delivery of a different malicious document abusing  <a href="https://www.cvedetails.com/cve/CVE-2017-11882/" target="_blank" rel="noopener">CVE-2017-11882</a><em>.</em> This document will drop a Ramsay Installer named <span style="font-family: courier new, courier, monospace;">lmsch.exe</span> as shown in Table 2.</p>

<table id="tablepress-827" class="tablepress tablepress-id-827">
<thead>
<tr class="row-1 odd">
	<th class="column-1"><span style="font-family: courier new, courier, monospace;">ID</span></th><th class="column-2"><span style="font-family: courier new, courier, monospace;">Index</span></th><th class="column-3"><span style="font-family: courier new, courier, monospace;">OLE Object</span></th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;">0</span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;">0x80c8</span></td><td class="column-3"><span style="font-family: courier new, courier, monospace;">Format_id: 2 (Embedded)<br />
Class name: ‘Package’<br />
Data size: 644790<br />
OLE Package object:<br />
Filename: u‘lmsch.exe’<br />
Source path: u‘C:\\fakepath\\lmsch.exe’<br />
Temp path = u:‘C:\\fakepath\\lmsch.exe’<br />
MD5 = ‘27cd5b330a93d891bdcbd08050a5a6e1’</span></td>
</tr>
<tr class="row-3 odd">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;">1</span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;">0xc798</span></td><td class="column-3"><span style="font-family: courier new, courier, monospace;">Format_id: 2 (Embedded)<br />
Class name: ‘Equation.3’<br />
Data size: 3584<br />
MD5 = ‘5ae434c951b106d63d79c98b1a95e99d’<br />
CLSID: 0002CE02-0000-0000-C000-000000000046<br />
Microsoft Equation 3.0 (Known related to CVE-2017-11882 or CVE-2018-0802)<br />
Possibly an exploit for the Equation Editor vulnerability (VU#421280, CVE-2017-11882)</span></td>
</tr>
</tbody>
</table>

<p><em>Table 2. OLE object layout contained within Ramsay version 2.b RTF file as seen by oletools</em></p>
<p>The Ramsay version leveraged by this document is a slightly modified version of Ramsay version 2.a, with the main difference of not leveraging the spreader component. The functionality of the remaining components is the same in regard to Ramsay version 2.a.</p>
<h3>Client Execution of Infected Files</h3>
<p>As previously mentioned, Ramsay Version 2.a delivers a Spreader component that will behave as a file infector, changing the structure of benign PE executable files held within removable and network shared drives in order to embed malicious Ramsay artifacts triggered on host file execution.</p>
<p>The Spreader is highly aggressive in its propagation mechanism and any PE executables residing in the targeted drives would be candidates for infection.</p>
<p>Based on compilation timestamps among the components of the various versions of Ramsay found, we can estimate the following development timeline of this framework:</p>
<div id="attachment_138382" style="width: 760px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-5-1.png"><img class="wp-image-138382" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-5-1-150x150.png" alt="" width="750" height="168" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-5-1-300x67.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-5-1-768x172.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-5-1-1024x229.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-5-1.png 1140w" sizes="(max-width: 750px) 100vw, 750px" /></a><p class="wp-caption-text"><i>Figure 3. Estimation of Ramsay’s development timeline </i></p></div>
<p>The analysis of the different compilation timestamps found across different components implies that this framework has been under development since late 2019, with the possibility of currently having two maintained versions tailored based on the configuration of different targets.</p>
<h2>Persistence mechanisms</h2>
<p>Based on its version, Ramsay implements various persistence mechanisms of different complexity. Some of these persistence mechanisms are the following:</p>
<ul>
<li><strong>AppInit DLL registry key</strong></li>
</ul>
<p>The Windows operating system provides the functionality to allow custom DLLs to be loaded into the address space of almost all application processes via AppInit DLL registry key. This technique is not particularly complex; it is implemented in early Ramsay versions and is common in other malware families.</p>
<ul>
<li><strong>Scheduled Task via COM API</strong></li>
</ul>
<p>Scheduled tasks enable administrators to run tasks or “jobs” at designated times rather than every time the system is booted or the user logs in. This feature can be implemented via the Windows COM API, which the first versions of Ramsay have tailored. Based on the high ratio of similarity with <a href="https://raw.githubusercontent.com/hzeroo/Carberp/master/source%20-%20absource/pro/all%20source/schtasks/schtasks.cpp" target="_blank" rel="noopener">Carberp</a>’s implementation, it&#8217;s highly probable that Ramsay&#8217;s implementation was adapted from Carberp&#8217;s publicly available source code.</p>
<ul>
<li><strong>Phantom DLL Hijacking</strong></li>
</ul>
<p>More mature versions of Ramsay denote an increase in complexity of its persistence techniques, which include a technique sometimes referred to as “Phantom DLL Hijacking”.</p>
<p>Phantom DLL Hijacking abuses the fact that many Windows applications use outdated dependencies not strictly necessary for the functionality of the application itself, allowing the possibility of leveraging malicious versions of these dependencies.</p>
<p>Two services will be targeted in order to enforce this technique. These are:</p>
<ul>
<li>WSearch (Windows Search) hijacking <span style="font-family: courier new, courier, monospace;">msfte.dll</span>:</li>
</ul>
<div id="attachment_138383" style="width: 760px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-6.png"><img class="wp-image-138383" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-6-150x150.png" alt="" width="750" height="154" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-6-300x62.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-6-768x158.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-6-1024x210.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-6.png 1033w" sizes="(max-width: 750px) 100vw, 750px" /></a><p class="wp-caption-text"><i>Figure 4. Hijacking of Microsoft Search Service msfte.dll</i></p></div>
<ul>
<li>MSDTC (Microsoft Distributed Transaction Coordinator) service hijacking an oracle dependency seen below as<span style="font-family: courier new, courier, monospace;"> oci.dll</span>:</li>
</ul>
<div id="attachment_138384" style="width: 754px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-7.png"><img class="wp-image-138384 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-7.png" alt="" width="744" height="291" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-7.png 744w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-7-300x117.png 300w" sizes="(max-width: 744px) 100vw, 744px" /></a><p class="wp-caption-text"><i>Figure 5. Hijacking of MSDTC service dependency oci.dll</i></p></div>
<p>This persistence technique is highly versatile, enabling Ramsay agents delivered as DLLs to fragment their logic into separated sections, implementing different functionality tailored for the subject processes where the agent will be loaded. In addition, the use of this technique makes detection more difficult since the loading of these DLLs into their respective processes/services won&#8217;t necessarily trigger an alert.</p>
<h2>Capabilities</h2>
<p>Ramsay&#8217;s architecture provides a series of capabilities monitored via a logging mechanism intended to assist operators by supplying a feed of actionable intelligence to conduct exfiltration, control, and lateral movement actions, as well as providing overall behavioral and system statistics of each compromised system. The realization of these actions is possible due to the following capabilities:</p>
<ul>
<li>
<h3>File collection and covert storage</h3>
</li>
</ul>
<p>The primary goal of this framework is to collect all existing <em>Microsoft Word </em>documents within the target&#8217;s filesystem. The overall collection stages are shown in Figure 6:</p>
<p>&nbsp;</p>
<div id="attachment_138385" style="width: 760px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-8.png"><img class="wp-image-138385" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-8-150x150.png" alt="" width="750" height="876" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-8-257x300.png 257w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-8-768x897.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-8-877x1024.png 877w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-8.png 943w" sizes="(max-width: 750px) 100vw, 750px" /></a><p class="wp-caption-text"><i>Figure 6. Mechanism of document collection</i></p></div>
<p>Word documents will first be collected and stored in a preliminary collection directory. The location of this directory may vary depending on the Ramsay version. Two of the directories we observed being used for this purpose were <span style="font-family: courier new, courier, monospace;">%APPDATA%\Microsoft\UserSetting</span> and <span style="font-family: courier new, courier, monospace;">%APPDATA%\Microsoft\UserSetting\MediaCache</span><em>.</em></p>
<p>Depending on the Ramsay version, file collection won&#8217;t be restricted to the local system drive, but also will search additional drives such as network or removable drives:</p>
<div id="attachment_138386" style="width: 661px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-9.png"><img class="wp-image-138386 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-9.png" alt="" width="651" height="337" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-9.png 651w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-9-300x155.png 300w" sizes="(max-width: 651px) 100vw, 651px" /></a><p class="wp-caption-text"><i>Figure 7. Hex-Rays output of procedure to scan removable drives for collection</i></p></div>
<div id="attachment_138387" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-10.png"><img class="wp-image-138387" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-10-150x150.png" alt="" width="650" height="309" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-10-300x143.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-10-768x365.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-10.png 835w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 8. Hex-Rays output of procedure to scan network drives for collection</i></p></div>
<p>Collected documents are encrypted using the RC4 Stream Cipher Algorithm<em>.</em></p>
<p>The RC4 key used to encrypt each file will be a computed MD5 hash of a randomly generated sequence of 16 bytes, salted with 16 bytes hardcoded in the malware sample. The first 16 bytes of the buffer where the encrypted file will be held will correspond to the actual RC4 key used:</p>
<div id="attachment_138388" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-11.png"><img class="wp-image-138388" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-11-150x150.png" alt="" width="650" height="182" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-11-300x84.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-11.png 715w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 9. Hex-Rays output of RC4 key generation and storage</i></p></div>
<p>Collected files under the preliminary collection directory will be compressed using a <a href="http://wintertechsolutions.weebly.com/blog/winrar" target="_blank" rel="noopener">WinRAR</a> instance that the Ramsay Installer drops. This compressed archive will be saved within the preliminary collection directory and then generate a Ramsay container artifact:</p>
<div id="attachment_138389" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-12.png"><img class="wp-image-138389" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-12-150x150.png" alt="" width="650" height="159" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-12-300x74.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-12-768x188.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-12.png 816w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 10. Hex-Rays output of Ramsay container generation</i></p></div>
<p>As shown in the previous screenshot, these Ramsay containers contain a magic value at the beginning of the file, along with a Hardware Profile <em>GUID </em>denoting an identifier of the victim&#8217;s machine; an additional XOR-based encryption layer will be applied to the generated compressed archive. The following diagram shows the structure of these artifacts:</p>
<div id="attachment_138390" style="width: 411px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-13.png"><img class="wp-image-138390 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-13.png" alt="" width="401" height="568" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-13.png 401w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-13-212x300.png 212w" sizes="(max-width: 401px) 100vw, 401px" /></a><p class="wp-caption-text"><i>Figure 11. Ramsay Container Structure&lt;{i&gt;</i></p></div>
<p>Ramsay implements a decentralized way of storing these artifacts among the victim&#8217;s file system by using inline hooks applied on two Windows API functions, <span style="font-family: courier new, courier, monospace;">WriteFile</span> and <span style="font-family: courier new, courier, monospace;">CloseHandle</span>.</p>
<p>The hooked <span style="font-family: courier new, courier, monospace;">WriteFile</span> procedure&#8217;s main purpose is to save the file handle of the subject file to write and install another hook in the <span style="font-family: courier new, courier, monospace;">CloseHandle</span> API function. The <span style="font-family: courier new, courier, monospace;">CloseHandle</span> hooked procedure will then check whether the subject file name has a <span style="font-family: courier new, courier, monospace;">.doc</span> extension; if that&#8217;s the case, it will then append at the end of the subject document the Ramsay container artifact followed by a stream of 1024 bytes denoting a Microsoft Word document footer.</p>
<p>This is done as an evasion measure in order to provide a means to hide the embedded artifact within the subject document from the naked eye:</p>
<div id="attachment_138391" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-14.png"><img class="wp-image-138391" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-14-150x150.png" alt="" width="650" height="267" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-14-300x123.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-14.png 722w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 12. Hex-Rays output of code for appending Word document footer at the end of the target document</i></p></div>
<p>Ramsay containers appended to Word documents will be marked in order to avoid redundant artifacts being appended to already affected documents and the preliminary storage directory will be cleared in order to generate a brand-new Ramsay artifact in intervals.</p>
<p>Even though affected documents will be modified, it won&#8217;t impact their integrity; each affected Word document remains fully operational after artifact appending has taken place.</p>
<p>Exfiltration of these artifacts is done via an external component that we haven&#8217;t been able to retrieve. However, based on the decentralized methodology Ramsay implements for storage of collected artifacts, we believe this component would scan the victim&#8217;s file system in search for the Ramsay container&#8217;s magic values, in order to identify the location of artifacts to exfiltrate.</p>
<ul>
<li>
<h3>Command execution</h3>
</li>
</ul>
<p>Unlike most conventional malware, Ramsay does not have a network-based C&amp;C communication protocol nor does it make any attempt to connect to a remote host for communication purposes. Ramsay&#8217;s control protocol follows the same decentralized philosophy implemented for collected artifact storage.</p>
<p>Ramsay will scan all the network shares and removable drives<em> (</em>excluding <span style="font-family: courier new, courier, monospace;">A:</span> and <span style="font-family: courier new, courier, monospace;">B:</span> drives usually reserved for floppy disks) for potential control files. First, Ramsay looks for Word documents and also, in more recent versions, for PDFs and ZIP archives:</p>
<div id="attachment_138392" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-15.png"><img class="wp-image-138392" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-15-150x150.png" alt="" width="650" height="350" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-15-300x162.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-15.png 739w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 13. Hex-Rays output of Ramsay Scan procedure for Control File retrieval</i></p></div>
<p>These files are parsed for the presence of a magic marker specific to the control file format. More specifically, Ramsay looks for any of two given encoded Hardware Profile GUIDs. One of these GUIDs is hardcoded as shown in Figure 14, while the other is dynamically generated based on the compromised victim’s machine. If any of the subject identifiers are found, parsing for a command signature will be attempted.</p>
<div id="attachment_138393" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-16.png"><img class="wp-image-138393" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-16-150x150.png" alt="" width="650" height="401" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-16-300x185.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-16.png 713w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 14. Hex-Rays output of Ramsay Control File Parsing</i></p></div>
<p>The search for these two GUID instances implies that Ramsay’s control documents can be deliberately crafted to be “victim agnostic”, capable of deploying the same control document instance across a number of victims by leveraging a “global” GUID within control documents. On the other hand, control documents can be crafted by embedding a specific GUID intended to be delivered exclusively on a single victim’s machine. This indicator of Ramsay&#8217;s control protocol implementation implies that its backend counterpart may be somewhat automated.</p>
<p>Ramsay control protocol supports three different commands:</p>

<table id="tablepress-828" class="tablepress tablepress-id-828">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Signature</th><th class="column-2">Command</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">Rr*e#R79m3QNU3Sy</td><td class="column-2">File Execution</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">CNDkS_&amp;pgaU#7Yg9</td><td class="column-2">DLL Load</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">2DWcdSqcv3?(XYqT</td><td class="column-2">Batch Execution</td>
</tr>
</tbody>
</table>

<p><em>Table 3. Ramsay’s control commands</em></p>
<p>After a given command signature is retrieved, the contained artifact to execute will be extracted within the control document’s body to then be restored, modifying the subject control document to its original form after command execution.</p>
<ul>
<li>
<h3>Spreading<a id="Spreading"></a></h3>
</li>
</ul>
<p>Among the different files dropped by the latest versions of Ramsay we find a <em>Spreader </em>component. This executable will attempt to scan for network shares and removable drives excluding <span style="font-family: courier new, courier, monospace;">A:</span> and <span style="font-family: courier new, courier, monospace;">B:</span> drives:</p>
<div id="attachment_138394" style="width: 618px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-18.png"><img class="wp-image-138394 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-18.png" alt="" width="608" height="492" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-18.png 608w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-18-300x243.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-18-222x179.png 222w" sizes="(max-width: 608px) 100vw, 608px" /></a><p class="wp-caption-text"><i>Figure 15. Hex-Rays output of spreader scanning routines</i></p></div>
<p>It is important to notice that there is a correlation between the target drives Ramsay scans for propagation and control document retrieval. This assesses the relationship between Ramsay’s spreading and control capabilities showing how Ramsay’s operators leverage the framework for lateral movement, denoting the likelihood that this framework has been designed to operate within air-gapped networks.</p>
<p>The propagation technique mainly consists of file infection much like a prepender file infector in order to generate executables similar in structure to Ramsay’s decoy installers for every accessible PE file within the aforementioned targeted drives. The following diagram illustrates the changes applied to targeted executables after infection has taken place and how these components interact on execution:</p>
<div id="attachment_138395" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-19.png"><img class="wp-image-138395" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-19-150x150.png" alt="" width="650" height="208" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-19-300x96.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-19-768x246.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-19-1024x328.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-19.png 1500w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 16. File structure changes during an infection and execution </i></p></div>
<p>All of the different artifacts involved in the infection stage are either within the context of the spreader or dropped previously by another Ramsay component. Some of the artifacts are parsed for the following tokens:</p>
<div id="attachment_138396" style="width: 647px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-20.png"><img class="wp-image-138396 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-20.png" alt="" width="637" height="200" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-20.png 637w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-20-300x94.png 300w" sizes="(max-width: 637px) 100vw, 637px" /></a><p class="wp-caption-text"><i>Figure 17. Hex-Rays output of tokens to search for different artifacts within the spreader context</i></p></div>
<p>After a given file has been infected, it will be marked by writing a specific token at the end of it in order to provide the spreader an identifier to prevent redundant infection.</p>
<p>In addition, some components of Ramsay have implemented a network scanner intended for the discovery of machines within the compromised host’s subnet that are susceptible to the <a href="https://www.cvedetails.com/cve/CVE-2017-0143/" target="_blank" rel="noopener">EternalBlue</a> SMBv1 vulnerability. This information will be contained within all logged information Ramsay collects and may be leveraged by operators in order to do further lateral movement over the network in a later stage via a different channel.</p>
<h2>Further remarks</h2>
<p>Ramsay’s version 2.a Spreader component was found to have reused a series of tokens seen before in Darkhotel’s <a href="https://s.tencent.com/research/report/741.html" target="_blank" rel="noopener">Retro</a> Backdoor. These tokens are the following:</p>
<div id="attachment_138397" style="width: 755px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-21.png"><img class="wp-image-138397 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-21.png" alt="" width="745" height="560" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-21.png 745w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-21-300x226.png 300w" sizes="(max-width: 745px) 100vw, 745px" /></a><p class="wp-caption-text"><i>Figure 18. Hex-Rays output of Token Reuse with Retro</i></p></div>
<div id="attachment_138398" style="width: 769px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-22.png"><img class="wp-image-138398 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-22.png" alt="" width="759" height="422" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-22.png 759w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-22-300x167.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-22-143x79.png 143w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-22-298x165.png 298w" sizes="(max-width: 759px) 100vw, 759px" /></a><p class="wp-caption-text"><i>Figure 19. Token Reuse on Retro URL Crafting</i></p></div>
<p>Ramsay serializes victims using the <span style="font-family: courier new, courier, monospace;">GetCurrentHwProfile</span> API to then retrieve a GUID for the specific victim’s machine. This is also seen implemented in Retro. They both use the same default GUID in case the API call fails:</p>
<div id="attachment_138399" style="width: 543px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-23.png"><img class="wp-image-138399 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-23.png" alt="" width="533" height="332" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-23.png 533w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-23-300x187.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-23-275x172.png 275w" sizes="(max-width: 533px) 100vw, 533px" /></a><p class="wp-caption-text"><i>Figure 20. Ramsay and Retro GUID generation</i></p></div>
<p>Both Ramsay and Retro share the same encoding algorithm to encode the retrieved GUID.</p>
<div id="attachment_138400" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-24.png"><img class="wp-image-138400" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-24-150x150.png" alt="" width="650" height="265" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-24-300x122.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-24-768x313.png 768w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-24.png 840w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 21. Ramsay and Retro GUID encoding scheme</i></p></div>
<p>The GUID retrieved by <span style="font-family: courier new, courier, monospace;">GetCurrentHwProfile</span> is specific for the system’s hardware but not for the user or PC instance. Therefore, it is likely that by just leveraging this GUID operators may encounter duplicates intended to serialize different victims.</p>
<p>The purpose of this scheme is to generate a GUID that is less likely to be duplicate-prone by ‘salting’ it with the machine’s ethernet adapter address. This implies that Retro and Ramsay share the same scheme to generate unique identifiers.</p>
<p>We also found similarities in the way Ramsay and Retro saved some of their log files, sharing a similar filename convention:</p>
<div id="attachment_138401" style="width: 660px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/figure-25.png"><img class="wp-image-138401" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/figure-25-150x150.png" alt="" width="650" height="355" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/figure-25-300x164.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/figure-25-143x79.png 143w, https://www.welivesecurity.com/wp-content/uploads/2020/05/figure-25.png 723w" sizes="(max-width: 650px) 100vw, 650px" /></a><p class="wp-caption-text"><i>Figure 22. Some of Ramsay and Retro filename convention</i></p></div>
<p>Is important to highlight that among Retro’s documented techniques, it leverages malicious instances of<span style="font-family: courier new, courier, monospace;"> <a href="https://blog.360totalsecurity.com/en/analysis-cve-2018-8174-vbscript-0day-apt-actor-related-office-targeted-attack/" target="_blank" rel="noopener">msfte.dll</a></span>, <a href="https://s.tencent.com/research/report/741.html" target="_blank" rel="noopener"><span style="font-family: courier new, courier, monospace;">oci.dll</span> and <span style="font-family: courier new, courier, monospace;">lame_enc.dll</span></a>, and via Phantom DLL Hijacking. As previously documented, Ramsay also uses this technique in some of its versions also using <span style="font-family: courier new, courier, monospace;">msfte.dll</span> and <span style="font-family: courier new, courier, monospace;">oci.dll</span>.</p>
<p>In addition, we also observed similarities among Ramsay and Retro in regard to the open-source tools used among their toolsets, such as leveraging <a href="https://github.com/hfiref0x/UACME" target="_blank" rel="noopener">UACMe</a> for privilege escalation and <a href="https://github.com/dismantl/ImprovedReflectiveDLLInjection/" target="_blank" rel="noopener">ImprovedReflectiveDLLInjection</a> for deploying some of their components.</p>
<p>Finally, we noticed Korean language metadata within the malicious documents leveraged by Ramsay, denoting the use of Korean-based templates.</p>
<div id="attachment_138402" style="width: 345px" class="wp-caption aligncenter"><a href="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-26.png"><img class="wp-image-138402 size-full" src="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-26.png" alt="" width="335" height="291" srcset="https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-26.png 335w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-26-300x261.png 300w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-26-87x77.png 87w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-26-60x53.png 60w, https://www.welivesecurity.com/wp-content/uploads/2020/05/Figure-26-85x75.png 85w" sizes="(max-width: 335px) 100vw, 335px" /></a><p class="wp-caption-text"><i>Figure 23. Malicious document metadata showing the Korean word “title”</i></p></div>
<h2>Conclusion</h2>
<p>Based on the different instances of the framework found, Ramsay has gone through various development stages, denoting an increasing progression in the number and complexity of its capabilities.</p>
<p>Developers in charge of attack vectors seem to be trying various approaches such as old exploits for Word vulnerabilities from 2017 as well as deploying trojanized applications.</p>
<p>We interpret this as that developers have a prior understanding of the victims’ environment and are tailoring attack vectors that would successfully intrude into targeted systems without the need to waste unnecessary resources.</p>
<p>Some stages of Ramsay’s framework are still under evaluation, which could explain the current low visibility of victims, having in mind that Ramsay’s intended targets may be under air-gapped networks, which would also impact victim visibility.</p>
<p>We will continue monitoring new Ramsay activities and will publish relevant information on our blog. For any inquiries, contact us as <em>threatintel@eset.com</em>. Indicators of Compromise can also be found in our <a href="https://github.com/eset/malware-ioc">GitHub</a> repository.</p>
<h2>Indicators of Compromise (IoCs)</h2>

<table id="tablepress-824" class="tablepress tablepress-id-824">
<thead>
<tr class="row-1 odd">
	<th class="column-1">SHA-1</th><th class="column-2">ESET detection name</th><th class="column-3">Comments</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> f79da0d8bb1267f9906fad1111bd929a41b18c03 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/TrojanDropper.Agent.SHN </span></td><td class="column-3">Initial Installer</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> 62d2cc1f6eedba2f35a55beb96cd59a0a6c66880 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/Ramsay.A </span></td><td class="column-3">Installer Launcher</td>
</tr>
<tr class="row-4 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> baa20ce99089fc35179802a0cc1149f929bdf0fa </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/HackTool.UACMe.T </span></td><td class="column-3">UAC Bypass Module</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> 5c482bb8623329d4764492ff78b4fbc673b2ef23 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/HackTool.UACMe.T </span></td><td class="column-3">UAC Bypass Module</td>
</tr>
<tr class="row-6 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> e7987627200d542bb30d6f2386997f668b8a928c </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/TrojanDropper.Agent.SHM </span></td><td class="column-3">Spreader</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> 3bb205698e89955b4bd07a8a7de3fc75f1cb5cde </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/TrojanDropper.Agent.SHN </span></td><td class="column-3">Malware Installer</td>
</tr>
<tr class="row-8 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> bd8d0143ec75ef4c369f341c2786facbd9f73256 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/HideProc.M </span></td><td class="column-3">HideDriver Rootkit</td>
</tr>
<tr class="row-9 odd">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> 7d85b163d19942bb8d047793ff78ea728da19870 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/HideProc.M </span></td><td class="column-3">HideDriver Rootkit</td>
</tr>
<tr class="row-10 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> 3849e01bff610d155a3153c897bb662f5527c04c </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win64/HackTool.Inject.A </span></td><td class="column-3">Darkhotel Retro Backdoor Loader</td>
</tr>
<tr class="row-11 odd">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> 50eb291fc37fe05f9e55140b98b68d77bd61149e </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/Ramsay.B </span></td><td class="column-3">Ramsay Initial Installer (version 2.b)</td>
</tr>
<tr class="row-12 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> 87ef7bf00fe6aa928c111c472e2472d2cb047eae </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/Exploit.CVE-2017-11882.H </span></td><td class="column-3">RTF file that drops   <span style="font-family: courier new, courier, monospace;"> 50eb291fc37fe05f9e55140b98b68d77bd61149e </span></td>
</tr>
<tr class="row-13 odd">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> 5a5738e2ec8af9f5400952be923e55a5780a8c55 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/Ramsay.C </span></td><td class="column-3">Ramsay Agent DLL (32bits)</td>
</tr>
<tr class="row-14 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> 19bf019fc0bf44828378f008332430a080871274 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/Ramsay.C </span></td><td class="column-3">Ramsay Agent EXE (32bits)</td>
</tr>
<tr class="row-15 odd">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> bd97b31998e9d673661ea5697fe436efe026cba1 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/Ramsay.C </span></td><td class="column-3">Ramsay Agent DLL (32bits)</td>
</tr>
<tr class="row-16 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> eb69b45faf3be0135f44293bc95f06dad73bc562 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win32/Ramsay.C </span></td><td class="column-3">Ramsay Agent DLL (32bits)</td>
</tr>
<tr class="row-17 odd">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> f74d86b6e9bd105ab65f2af10d60c4074b8044c9 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win64/Ramsay.C </span></td><td class="column-3">Ramsay Agent DLL (64bits)</td>
</tr>
<tr class="row-18 even">
	<td class="column-1"><span style="font-family: courier new, courier, monospace;"> ae722a90098d1c95829480e056ef8fd4a98eedd7 </span></td><td class="column-2"><span style="font-family: courier new, courier, monospace;"> Win64/Ramsay.C </span></td><td class="column-3">Ramsay Agent DLL (64bits)</td>
</tr>
</tbody>
</table>

<h2>MITRE ATT&amp;CK techniques</h2>

<table id="tablepress-825" class="tablepress tablepress-id-825">
<thead>
<tr class="row-1 odd">
	<th class="column-1">Tactic</th><th class="column-2">ID</th><th class="column-3">Name</th><th class="column-4">Description</th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">Initial Access</td><td class="column-2"><a href="https://attack.mitre.org/techniques/T1091/" rel="noopener" target="_blank">T1091</a></td><td class="column-3">Replication Through Removable Media</td><td class="column-4">Ramsay’s spreading mechanism is done via removable drives.</td>
</tr>
<tr class="row-3 odd">
	<td rowspan="5" class="column-1">Execution</td><td class="column-2"><a href="https://attack.mitre.org/techniques/T1106/" rel="noopener" target="_blank">T1106</a></td><td class="column-3">Execution through API</td><td class="column-4">Ramsay’s embedded components are executed via  <span style="font-family: courier new, courier, monospace;"> CreateProcessA </span>  and  <span style="font-family: courier new, courier, monospace;"> ShellExecute </span> .</td>
</tr>
<tr class="row-4 even">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1129/" rel="noopener" target="_blank">T1129</a></td><td class="column-3">Execution through Module Load</td><td class="column-4">Ramsay agent can be delivered as a DLL.</td>
</tr>
<tr class="row-5 odd">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1203/" rel="noopener" target="_blank">T1203</a></td><td class="column-3">Exploitation for Client Execution</td><td class="column-4">Ramsay attack vectors exploit  CVE-2017-1188 or CVE-2017-0199.</td>
</tr>
<tr class="row-6 even">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1035/" rel="noopener" target="_blank">T1035</a></td><td class="column-3">Service Execution</td><td class="column-4">Ramsay components can be executed as service dependencies.</td>
</tr>
<tr class="row-7 odd">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1204/" rel="noopener" target="_blank">T1204</a></td><td class="column-3">User Execution</td><td class="column-4">Ramsay Spreader component infects files within the file system.</td>
</tr>
<tr class="row-8 even">
	<td rowspan="3" class="column-1">Persistence</td><td class="column-2"><a href="https://attack.mitre.org/techniques/T1103/" rel="noopener" target="_blank">T1103</a></td><td class="column-3">AppInit DLLs</td><td class="column-4">Ramsay can use this registry key for persistence.</td>
</tr>
<tr class="row-9 odd">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1050/" rel="noopener" target="_blank">T1050</a></td><td class="column-3">New Service</td><td class="column-4">Ramsay components can be executed as service dependencies.</td>
</tr>
<tr class="row-10 even">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1053/" rel="noopener" target="_blank">T1053</a></td><td class="column-3">Scheduled Task</td><td class="column-4">Ramsay sets a scheduled task to persist after reboot.</td>
</tr>
<tr class="row-11 odd">
	<td class="column-1">Privilege Escalation</td><td class="column-2"><a href="https://attack.mitre.org/techniques/T1088/" rel="noopener" target="_blank">T1088</a></td><td class="column-3">Bypass User Account Control</td><td class="column-4">Ramsay drops UACMe instances for privilege escalation.</td>
</tr>
<tr class="row-12 even">
	<td rowspan="4" class="column-1">Defense Evasion</td><td class="column-2"><a href="https://attack.mitre.org/techniques/T1038/" rel="noopener" target="_blank">T1038</a></td><td class="column-3">DLL Order Hijacking</td><td class="column-4">Ramsay agents will masquerade as service dependencies leveraging Phantom DLL Hijacking.</td>
</tr>
<tr class="row-13 odd">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1107/" rel="noopener" target="_blank">T1107</a></td><td class="column-3">File Deletion</td><td class="column-4">Ramsay installer is deleted after execution.</td>
</tr>
<tr class="row-14 even">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1055/" rel="noopener" target="_blank">T1055</a></td><td class="column-3">Process Injection</td><td class="column-4">Ramsay’s agent is injected into various processes.</td>
</tr>
<tr class="row-15 odd">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1045/" rel="noopener" target="_blank">T1045</a></td><td class="column-3">Software Packing</td><td class="column-4">Ramsay installer may be packed with UPX.</td>
</tr>
<tr class="row-16 even">
	<td rowspan="3" class="column-1">Discovery</td><td class="column-2"><a href="https://attack.mitre.org/techniques/T1083/" rel="noopener" target="_blank">T1083</a></td><td class="column-3">File and Directory Discovery</td><td class="column-4">Ramsay agent scans for files and directories on the system drive.</td>
</tr>
<tr class="row-17 odd">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1135/" rel="noopener" target="_blank">T1135</a></td><td class="column-3">Network Share Discovery</td><td class="column-4">Ramsay agent scans for available network shares.</td>
</tr>
<tr class="row-18 even">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1057/" rel="noopener" target="_blank">T1057</a></td><td class="column-3">Process Discovery</td><td class="column-4">Ramsay will attempt to find if host is already compromised by checking the existence of specific processes.</td>
</tr>
<tr class="row-19 odd">
	<td rowspan="3" class="column-1">Lateral Movement</td><td class="column-2"><a href="https://attack.mitre.org/techniques/T1210/" rel="noopener" target="_blank">T1210</a></td><td class="column-3">Exploitation of Remote Services</td><td class="column-4">Ramsay network scanner may scan the host’s subnet to find targets vulnerable to EternalBlue.</td>
</tr>
<tr class="row-20 even">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1105/" rel="noopener" target="_blank">T1105</a></td><td class="column-3">Remote File Copy</td><td class="column-4">Ramsay attempts to infect files on network shares.</td>
</tr>
<tr class="row-21 odd">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1091/" rel="noopener" target="_blank">T1091</a></td><td class="column-3">Replication Through Removable Media</td><td class="column-4">Ramsay attempts to infect files on removable drives.</td>
</tr>
<tr class="row-22 even">
	<td rowspan="5" class="column-1">Collection</td><td class="column-2"><a href="https://attack.mitre.org/techniques/T1119/" rel="noopener" target="_blank">T1119</a></td><td class="column-3">Automated Collection</td><td class="column-4">Ramsay agent collects files  in intervals.</td>
</tr>
<tr class="row-23 odd">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1005/" rel="noopener" target="_blank">T1005</a></td><td class="column-3">Data from Local System</td><td class="column-4">Ramsay agent  scans files on system drive.</td>
</tr>
<tr class="row-24 even">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1039/" rel="noopener" target="_blank">T1039</a></td><td class="column-3">Data from Network Shared Drive</td><td class="column-4">Ramsay agent scans files on network shares.</td>
</tr>
<tr class="row-25 odd">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1025/" rel="noopener" target="_blank">T1025</a></td><td class="column-3">Data from Removable Media</td><td class="column-4">Ramsay agent scans files on removable drives.</td>
</tr>
<tr class="row-26 even">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1113/" rel="noopener" target="_blank">T1113</a></td><td class="column-3">Screen Capture</td><td class="column-4">Ramsay agent may generate and collect screenshots.</td>
</tr>
<tr class="row-27 odd">
	<td rowspan="2" class="column-1">Command and Control</td><td class="column-2"><a href="https://attack.mitre.org/techniques/T1092/" rel="noopener" target="_blank">T1092</a></td><td class="column-3">Communication Through Removable Media</td><td class="column-4">Ramsay agent scans for control files for its file-based communication protocol on removable drives.</td>
</tr>
<tr class="row-28 even">
	<td class="column-2"><a href="https://attack.mitre.org/techniques/T1094/" rel="noopener" target="_blank">T1094</a></td><td class="column-3">Custom Command and Control Protocol</td><td class="column-4">Ramsay implements a custom, file-based C&amp;C protocol.</td>
</tr>
<tr class="row-29 odd">
	<td class="column-1">Exfiltration</td><td class="column-2"><a href="https://attack.mitre.org/techniques/T1002/" rel="noopener" target="_blank">T1002</a></td><td class="column-3">Data Compressed</td><td class="column-4">Ramsay agent compresses its collection directory.</td>
</tr>
</tbody>
</table>


                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                <div class="wls-author">
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/isanmillan/" title="Ignacio Sanmillan">
                    Ignacio Sanmillan                </a>
            </div>
        </div>
                                            </div>
                                    <span class="strong">
								        <time datetime="2020-05-13 11:30:23">13 May 2020 - 11:30AM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/cybercrime/" class="category-tag-btn">Cybercrime</a>                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/fbi-cybercrime-losses-2020-ic3-623x432.jpg"
                                                         alt="Ramsay: A cyber&#8209;espionage toolkit tailored for air&#8209;gapped networks">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/18/fbi-cybercrime-losses-topped-us42billion-2020/">
                                                    FBI: Cybercrime losses topped US$4.2 billion in 2020                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/03/exchange-servers-under-siege-10-apt-groups-623x432.jpg"
                                                         alt="Ramsay: A cyber&#8209;espionage toolkit tailored for air&#8209;gapped networks">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/03/10/exchange-servers-under-siege-10-apt-groups/">
                                                    Exchange servers under siege from at least 10 APT groups                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/apple-m1-macs-malware-1-623x432.jpg"
                                                         alt="Ramsay: A cyber&#8209;espionage toolkit tailored for air&#8209;gapped networks">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/18/malware-authors-already-taking-aim-apple-m1-macs/">
                                                    Malware authors already taking aim at Apple M1 Macs                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2021/02/eset-kobalos-hpc-high-performance-computing-malware-research-623x432.jpg"
                                                         alt="Ramsay: A cyber&#8209;espionage toolkit tailored for air&#8209;gapped networks">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2021/02/02/kobalos-complex-linux-threat-high-performance-computing-infrastructure/">
                                                    Kobalos – A complex Linux threat to high performance computing infrastructure                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F05%2F13%2Framsay-cyberespionage-toolkit-airgapped-networks%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F05%2F13%2Framsay-cyberespionage-toolkit-airgapped-networks%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2020%2F05%2F13%2Framsay-cyberespionage-toolkit-airgapped-networks%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-awus -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"138363 https:\/\/backend.welivesecurity.com\/?p=138363","disqusShortname":"welivesecurity","disqusTitle":"Ramsay: A cyber\u2011espionage toolkit tailored for air\u2011gapped networks","disqusUrl":"https:\/\/www.welivesecurity.com\/2020\/05\/13\/ramsay-cyberespionage-toolkit-airgapped-networks\/","postId":"138363"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>