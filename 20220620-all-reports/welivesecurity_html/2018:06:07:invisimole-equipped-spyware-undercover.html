<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="google-site-verification" content="_b2avZwzr79oru6lM2Ddae1fNpSIbPaP0H0WNkc2x3k"/>
    <meta name="msvalidate.01" content="CE77828A466C2513F660017CFCB6BA13"/>
    <link rel="icon" href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/favicon.ico">

    

            
    
    <link href="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/css/main-8633bd3c28.css" rel="stylesheet">
    <script type="text/javascript"> var appInsights=window.appInsights||function(a){ function b(a){c[a]=function(){var b=arguments;c.queue.push(function(){c[a].apply(c,b)})}}var c={config:a},d=document,e=window;setTimeout(function(){var b=d.createElement("script");b.src=a.url||"https://az416426.vo.msecnd.net/scripts/a/ai.0.js",d.getElementsByTagName("script")[0].parentNode.appendChild(b)});try{c.cookie=d.cookie}catch(a){}c.queue=[];for(var f=["Event","Exception","Metric","PageView","Trace","Dependency"];f.length;)b("track"+f.pop());if(b("setAuthenticatedUserContext"),b("clearAuthenticatedUserContext"),b("startTrackEvent"),b("stopTrackEvent"),b("startTrackPage"),b("stopTrackPage"),b("flush"),!a.disableExceptionTracking){f="onerror",b("_"+f);var g=e[f];e[f]=function(a,b,d,e,h){var i=g&&g(a,b,d,e,h);return!0!==i&&c["_"+f](a,b,d,e,h),i}}return c }({ instrumentationKey:"dcb460fe-684e-4d39-bfcd-d3a6f2710a32" }); window.appInsights=appInsights,appInsights.queue&&0===appInsights.queue.length&&appInsights.trackPageView(); </script>
    <script>
        window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        'Author': 'Zuzana Hromcová',
        'ArticleCategory': 'spyware',
        'ArticleSection': 'Research',
        'cookie-bar-hq': true
    });

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PMDGSM');
</script>
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '1518099328403839']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript><img height="1" width="1" alt="" style="display:none" src="https://www.facebook.com/tr?id=1518099328403839&amp;ev=NoScript" /></noscript>
<meta property="fb:pages" content="56844830907" />
<!-- This site is optimized with the Yoast SEO plugin v9.2 - https://yoast.com/wordpress/plugins/seo/ -->
<title>InvisiMole: Surprisingly equipped spyware, undercover since 2013 | WeLiveSecurity</title>
<meta name="description" content="InvisiMole is fully-equipped spyware whose rich capabilities can compete with other espionage tools seen in the wild. The latest ESET research has found that the spyware was deployed against a very small number of high-value targets for at least five years."/>
<link rel="canonical" href="https://www.welivesecurity.com/2018/06/07/invisimole-equipped-spyware-undercover/" />
<meta property="og:locale" content="en_US" />
<meta property="og:locale:alternate" content="de_DE" />
<meta property="og:type" content="article" />
<meta property="og:title" content="InvisiMole: Surprisingly equipped spyware, undercover since 2013 | WeLiveSecurity" />
<meta property="og:description" content="InvisiMole is fully-equipped spyware whose rich capabilities can compete with other espionage tools seen in the wild. The latest ESET research has found that the spyware was deployed against a very small number of high-value targets for at least five years." />
<meta property="og:url" content="https://www.welivesecurity.com/2018/06/07/invisimole-equipped-spyware-undercover/" />
<meta property="og:site_name" content="WeLiveSecurity" />
<meta property="article:section" content="spyware" />
<meta property="article:published_time" content="2018-06-07T13:00:40+00:00" />
<meta property="article:modified_time" content="2018-06-26T06:15:16+00:00" />
<meta property="og:updated_time" content="2018-06-26T06:15:16+00:00" />
<meta property="og:image" content="https://www.welivesecurity.com/wp-content/uploads/2018/06/InvisiMole_Spyware.jpg" />
<meta property="og:image:secure_url" content="https://www.welivesecurity.com/wp-content/uploads/2018/06/InvisiMole_Spyware.jpg" />
<meta property="og:image:width" content="1000" />
<meta property="og:image:height" content="611" />
<meta property="og:image:alt" content="InvisiMole" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="InvisiMole is fully-equipped spyware whose rich capabilities can compete with other espionage tools seen in the wild. The latest ESET research has found that the spyware was deployed against a very small number of high-value targets for at least five years." />
<meta name="twitter:title" content="InvisiMole: Surprisingly equipped spyware, undercover since 2013 | WeLiveSecurity" />
<meta name="twitter:site" content="@welivesecurity" />
<meta name="twitter:image" content="https://www.welivesecurity.com/wp-content/uploads/2018/06/InvisiMole_Spyware.jpg" />
<meta name="twitter:creator" content="@welivesecurity" />
<!-- / Yoast SEO plugin. -->

<link rel="alternate" href="https://www.welivesecurity.com/2018/06/07/invisimole-equipped-spyware-undercover/" hreflang="en" />
<link rel="alternate" href="https://www.welivesecurity.com/la-es/2018/08/20/invisimole-sorprendente-spyware-encubierto-desde-2013/" hreflang="es" />
<link rel="alternate" href="https://www.welivesecurity.com/deutsch/2018/06/07/invisimole-ueberraschend-ausgestattete-spyware-seit-2013-unentdeckt/" hreflang="de" />
<link rel="alternate" type="application/rss+xml" title="WeLiveSecurity RSS 2.0 Feed" href="/rss-configurator/" /><style type="text/css" id="syntaxhighlighteranchor"></style>
        <link id="cookie-style" rel="stylesheet" type="text/css" href="https://assets.esetstatic.com/3PS/cookiebar.min.css">
</head>
<body class="no-js single wide">
<noscript>
	<iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMDGSM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="main">
    <header id="site-header" class="container">
        <div class="row">
            <div class="col-md-4 col-sm-12 col-xs-12 pull-right" id="header-nav">
                <div class="row">
                    <div class="col-xs-12 mobile-search-input">
                        <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                    </div>
                    <div class="hidden-lg hidden-md col-sm-7 col-xs-8 hidden-xxs">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
                    <div class="col-md-8 hidden-sm hidden-xs languages">
                        <div class="dropdown">
	<button class="btn btn-default dropdown-toggle" type="button" id="main-language-picker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    	<span class="text">In English</span>
    	<span class="icomoon icon-icon_arrow"></span>
  	</button>
  	<ul class="dropdown-menu" aria-labelledby="main-language-picker">
            <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2018/08/20/invisimole-sorprendente-spyware-encubierto-desde-2013/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2018/06/07/invisimole-ueberraschend-ausgestattete-spyware-seit-2013-unentdeckt/" title="In Deutsch">
            In Deutsch        </a>
    </li>
      	</ul>
</div>                    </div>
                    <div class="col-md-4 col-sm-2 col-xs-3 menu-trigger">
                        <div class="menu-btn">
	<span class="text">Menu</span>
	<button type="button" id="menu-trigger" class="tcon tcon-menu--xcross" aria-label="toggle menu">
        <span class="wrapper">
            <span class="tcon-menu__lines" aria-hidden="true"></span>
            <span class="tcon-visuallyhidden">toggle menu</span>
        </span>
    </button>
</div>                    </div>
                    <div class="hidden-lg hidden-md hidden-sm hidden-xs col-xs-2 mobile-search imc">
                        <button class="imc">
                            <span class="icomoon icon-icon_search imc"></span>
                        </button>
                    </div>
                    <div class="col-md-12 col-sm-12 col-xs-12 imc" id="main-menu">
                        <nav class="menu clearfix imc">
                            <ul class="col-md-12 col-sm-6 col-xs-6 imc">
                                                                    <li class="">
                                        <a href="/">
                                            All Posts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/research">
                                            Research                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="/category/how-to/">
                                            How To                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/videos/">
                                            Videos                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/media/podcasts/">
                                            Podcasts                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/conference-papers/">
                                            Conference Materials                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/white-papers/">
                                            White Papers                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/threat-reports/">
                                            Threat Reports                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/papers/magazine/">
                                            Magazine                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://www.welivesecurity.com/our-experts/">
                                            Our Experts                                        </a>
                                    </li>
                                                            </ul>

                            <div class="col-md-12 col-sm-6 col-xs-6 imc">
                                <ul class="languages hidden-lg hidden-md hidden-xxs col-xs-12 imc">
                                        <li>
        <a href="/br/" title="Em Português">
            Em Português        </a>
    </li>
        <li>
        <a href="/fr/" title="En français">
            En français        </a>
    </li>
        <li>
        <a href="/la-es/2018/08/20/invisimole-sorprendente-spyware-encubierto-desde-2013/" title="En Español">
            En Español        </a>
    </li>
        <li>
        <a href="/deutsch/2018/06/07/invisimole-ueberraschend-ausgestattete-spyware-seit-2013-unentdeckt/" title="In Deutsch">
            In Deutsch        </a>
    </li>
                                    </ul>
                                <div class="hidden-lg hidden-md col-xs-12 imc">
                                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc dark col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="menu-overlay col-md-12 col-sm-12 col-xs-12 imc">
                        <div class="inner imc"></div>
                    </div>
                </div>
                <div class="row hidden-sm hidden-xs">
                    <form action="https://www.welivesecurity.com/" class="basic-searchform imc  col-md-12 col-sm-10 col-xs-12" method="get" role="search">
	<div class="search-input clearfix">
		<input type="text" name="s" value="" placeholder="Search..." class="imc">
		<button class="imc">
			<span class="icomoon icon-icon_search imc"></span>
		</button>
	</div>
</form>	                </div>
            </div>
            <div class="col-md-5 hidden-sm hidden-xs pull-left" id="header-logo">
                <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                <span class="slogan hidden-sm hidden-xs">
						Award-winning news, views, and insight from the ESET <strong>security community</strong> 
					</span>
            </div>
        </div>
    </header>
        <section id="article-detail">
            <div class="hero-wide" style="background-image: url('../../../../wp-content/uploads/2018/06/InvisiMole_Spyware.jpg'); background-position: 50% 50%;">
    <div class="text-wrapper">
        <div class="container promo-text">
            <div class="col-md-11 col-sm-11 col-xs-12 no-padding">
                <h1>InvisiMole: Surprisingly equipped spyware, undercover since 2013</h1>
<div class="excerpt">Hunting for secrets from high-profile targets while staying in the shadows </div>
<div class="post-meta">
    <div class="wls-authors">
                <div class="wls-author with-avatar">
                            <div class="wls-author-avatar">
                    <a href="https://www.welivesecurity.com/author/zhromcova/" title="Zuzana Hromcová">
                        <img src="https://www.welivesecurity.com/wp-content/uploads/2018/06/zuzana.hromcova@eset.sk_-222x179.jpg" alt="Zuzana Hromcová">
                    </a>
                </div>
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/zhromcova/" title="Zuzana Hromcová">
                    Zuzana Hromcová                </a>
            </div>
        </div>
            </div>
    <span class="meta">
		<span class="strong">
			<time datetime="2018-06-07 15:00:40">7 Jun 2018 - 03:00PM</time>
		</span>
			</span>
</div>
            </div>
        </div>
    </div>
</div>

            <div class="content">
                <div class="social-wrapper" id="social-sharer">
                    <span class="text">Share</span>
	<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F06%2F07%2Finvisimole-equipped-spyware-undercover%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
		<span class="icomoon icon-icon_fb"></span>
	</a>
	<a class="share-twitter" href="https://twitter.com/intent/tweet?&url=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F06%2F07%2Finvisimole-equipped-spyware-undercover%2F&text=InvisiMole: Surprisingly equipped spyware, undercover since 2013%0A&via=welivesecurity" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
		<span class="icomoon icon-icon_tw"></span>
	</a>
	<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F06%2F07%2Finvisimole-equipped-spyware-undercover%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
		<span class="icomoon icon-icon_in"></span>
	</a>
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-1 col-sm-1 hidden-xs">

                        </div>
                        <div class="col-md-10 col-sm-10 col-xs-12 formatted">

                            <div class="excerpt wide">
                                <p>Hunting for secrets from high-profile targets while staying in the shadows </p>
                            </div>

                            <p>This is the modus operandi of the two malicious components of InvisiMole. They turn the affected computer into a video camera, letting the attackers see and hear what’s going on in the victim’s office or wherever their device may be. Uninvited, InvisiMole’s operators access the system, closely monitoring the victim’s activities and stealing the victim’s secrets.</p>
<p>Our telemetry indicates that the malicious actors behind this malware have been active at least since 2013, yet the <a href="https://www.welivesecurity.com/category/espionage/" target="_blank" rel="noopener">cyber-espionage</a> tool was never analyzed nor detected until discovered by ESET products on compromised computers in Ukraine and Russia.</p>
<p>The campaign is highly targeted – no wonder the malware has a low infection ratio, with only a few dozen computers being affected.</p>
<p>InvisiMole has a modular architecture, starting its journey with a wrapper DLL, and performing its activities using two other modules that are embedded in its resources. Both of the modules are feature-rich backdoors, which together give it the ability to gather as much information about the target as possible.</p>
<p>Extra measures are taken to avoid attracting the attention of the compromised user, enabling the malware to reside on the system for a longer period of time. How the <a href="https://www.welivesecurity.com/category/spyware/" target="_blank" rel="noopener">spyware</a> was spread to the infected machines is yet to be determined by further investigation. All infection vectors are possible, including installation facilitated by physical access to the machine.</p>
<h2>Installation and persistence</h2>
<p>The first part of the malware we are looking at is a wrapper DLL, compiled with the <a href="https://www.freepascal.org/">Free Pascal</a> Compiler. From our telemetry, we have observed that this DLL is placed in the Windows folder, masquerading as a legitimate <span style="font-family: courier new, courier, monospace;">mpr.dll</span> library file with a forged version info resource.</p>
<div id="attachment_112767" style="width: 534px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/06/1.png"><img class="size-full wp-image-112767" src="/wp-content/uploads/2018/06/1.png" alt="" width="524" height="390" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/06/1.png 524w, https://www.welivesecurity.com/wp-content/uploads/2018/06/1-300x223.png 300w" sizes="(max-width: 524px) 100vw, 524px" /></a><p class="wp-caption-text">Figure 1 – The wrapper DLL poses as a legitimate mpr.dll library, both by its name and version info</p></div>
<p>We have not seen a wrapper DLL named differently; however, there are hints in the DLL code that it might be also named <span style="font-family: courier new, courier, monospace;">fxsst.dll</span> or <span style="font-family: courier new, courier, monospace;">winmm.dll</span>.</p>
<p>The first way in which the malware can be launched is by hijacking a DLL. Being placed in the same folder as <span style="font-family: courier new, courier, monospace;">explorer.exe</span>, the wrapper DLL is loaded during the Windows startup into the Windows Explorer process instead of the legitimate library located in the <span style="font-family: courier new, courier, monospace;">%windir%\system32</span> folder.</p>
<p>We have found both 32-bit and 64-bit versions of the malware, which makes this persistence technique functional on both architectures.</p>
<p>As an alternative to <span style="font-family: georgia, palatino, serif;">DLL hijacking</span>, other loading and persistence methods are possible. The wrapper DLL exports a function called <span style="font-family: courier new, courier, monospace;">GetDataLength</span>. When this function is called, the DLL checks whether it was loaded by the <span style="font-family: courier new, courier, monospace;">rundll32.exe</span> process with either <span style="font-family: courier new, courier, monospace;">explorer.exe</span> or <span style="font-family: courier new, courier, monospace;">svchost.exe</span> as its parent process, and only then does it launch the payload. This suggests other possible persistence methods – by scheduling a task (i.e. having <span style="font-family: courier new, courier, monospace;">svchost.exe</span> as a parent process) or by installation in a startup registry key (<span style="font-family: courier new, courier, monospace;">explorer.exe</span> being the parent process).</p>
<p>Regardless of the persistence method, the behavior of the malware and of the actual payload is the same in all cases. The wrapper DLL loads both the modules stored in its resources, named <span style="font-family: courier new, courier, monospace;">RC2FM</span> and <span style="font-family: courier new, courier, monospace;">RC2CL</span>, and (if DLL hijacking was used) finally loads the legitimate library into the <span style="font-family: courier new, courier, monospace;">explorer.exe</span> process, in order not to disrupt the normal operation of the application, and thereby remain hidden.</p>
<div id="attachment_112772" style="width: 518px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/06/2.png"><img class="size-full wp-image-112772" src="/wp-content/uploads/2018/06/2.png" alt="" width="508" height="151" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/06/2.png 508w, https://www.welivesecurity.com/wp-content/uploads/2018/06/2-300x89.png 300w" sizes="(max-width: 508px) 100vw, 508px" /></a><p class="wp-caption-text">Figure 2 – Exported functions of the wrapper DLL</p></div>
<h2>Technical analysis</h2>
<p>The exact date when the malware was compiled is unknown – the recent wrapper DLL samples were tampered with by the malware authors, with the PE timestamps manually set to zero values. However, during our research, we found an earlier version of the malware with a PE timestamp reading Oct 13, 2013, so the compilation date of the later version is almost surely more recent.</p>
<div id="attachment_112776" style="width: 830px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/06/3.png"><img class="size-full wp-image-112776" src="/wp-content/uploads/2018/06/3.png" alt="" width="820" height="492" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/06/3.png 820w, https://www.welivesecurity.com/wp-content/uploads/2018/06/3-300x180.png 300w, https://www.welivesecurity.com/wp-content/uploads/2018/06/3-768x461.png 768w" sizes="(max-width: 820px) 100vw, 820px" /></a><p class="wp-caption-text">Figure 3 – The compilation timestamp is set to zero in all the latest samples</p></div>
<h2>Encryption and decryption</h2>
<p>To increase its level of stealth, the malware protects itself from the eyes of administrators and analysts by encrypting its strings, internal files, configuration data and network communication. While the <span style="font-family: courier new, courier, monospace;">RC2FM</span> module uses a handful of custom ciphers, the wrapper DLL and the <span style="font-family: courier new, courier, monospace;">RC2CL</span> module share one particular routine for all purposes, especially for decrypting other malware modules embedded in the wrapper DLL.</p>
<p>A script that is able to extract the embedded modules <span style="font-family: courier new, courier, monospace;">RC2FM</span> and <span style="font-family: courier new, courier, monospace;">RC2CL</span> from the wrapper DLL, using this routine, is available on <a href="https://github.com/eset/malware-research/tree/master/invisimole" target="_blank" rel="noopener">ESET’s malware-research GitHub repository</a>.</p>
<div id="attachment_112812" style="width: 1433px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/06/4a_4b.png"><img class="size-full wp-image-112812" src="/wp-content/uploads/2018/06/4a_4b.png" alt="" width="1423" height="1238" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/06/4a_4b.png 1423w, https://www.welivesecurity.com/wp-content/uploads/2018/06/4a_4b-300x261.png 300w, https://www.welivesecurity.com/wp-content/uploads/2018/06/4a_4b-768x668.png 768w, https://www.welivesecurity.com/wp-content/uploads/2018/06/4a_4b-1024x891.png 1024w, https://www.welivesecurity.com/wp-content/uploads/2018/06/4a_4b-87x77.png 87w, https://www.welivesecurity.com/wp-content/uploads/2018/06/4a_4b-60x53.png 60w, https://www.welivesecurity.com/wp-content/uploads/2018/06/4a_4b-85x75.png 85w" sizes="(max-width: 1423px) 100vw, 1423px" /></a><p class="wp-caption-text">Figure 4 – Encryption routine used across the samples (decompiled and disassembled)</p></div>
<h2>Module <span style="font-family: georgia, palatino, serif;">RC2FM</span></h2>
<p>The first, smaller module <span style="font-family: courier new, courier, monospace;">RC2FM</span> contains a backdoor with fifteen supported commands. These are executed on the affected computer when so instructed by the attackers. The module is designed to make various changes to the system but it also offers a bunch of spying commands.</p>
<p>A logging option is implemented throughout the file but the name of the log file is not configured in the analyzed sample. This suggests that it was only used during the development of the malware.</p>
<h2>Network communication</h2>
<p>This module communicates with C&amp;C servers that are either hardcoded in the sample, or updated later by the attackers.</p>
<p>Moreover, the module is able to reach out to the C&amp;C servers even if there is a proxy configured on the infected computer. If a direct connection is unsuccessful, the module attempts to connect to any of its C&amp;C servers using locally-configured proxies or proxies configured for various browsers (Firefox, Pale Moon, and Opera).</p>
<p><span style="font-family: courier new, courier, monospace;">RC2FM</span> can go as far as inspecting the recently executed applications list and look specifically for portable browser executables:</p>
<ul>
<li><span style="font-family: courier new, courier, monospace;">FirefoxPortable.exe</span></li>
<li><span style="font-family: courier new, courier, monospace;">OperaPortable.exe</span></li>
<li><span style="font-family: courier new, courier, monospace;">Run waterfox.exe</span></li>
<li><span style="font-family: courier new, courier, monospace;">OperaAC.exe</span></li>
<li><span style="font-family: courier new, courier, monospace;">Palemoon-Portable.exe</span></li>
</ul>
<p>Should the victim use one of these portable browsers <em>with a proxy server configured</em>, the malware can find that in the user’s preferences and use that proxy to communicate with its C&amp;C servers.</p>
<p>C&amp;C communication consists of a series of HTTP GET and POST requests, as shown in Figure 5. The encrypted request includes a PC identifier and timestamp, and optionally some other data. It is worth noting that the <span style="font-family: courier new, courier, monospace;">RC2FM</span> module uses a number of encryption methods (variations of a simple XOR encryption routine), unlike the other InvisiMole parts.</p>
<div id="attachment_112813" style="width: 961px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/06/5.png"><img class="size-full wp-image-112813" src="/wp-content/uploads/2018/06/5.png" alt="" width="951" height="627" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/06/5.png 951w, https://www.welivesecurity.com/wp-content/uploads/2018/06/5-300x198.png 300w, https://www.welivesecurity.com/wp-content/uploads/2018/06/5-768x506.png 768w, https://www.welivesecurity.com/wp-content/uploads/2018/06/5-65x42.png 65w, https://www.welivesecurity.com/wp-content/uploads/2018/06/5-114x76.png 114w, https://www.welivesecurity.com/wp-content/uploads/2018/06/5-97x65.png 97w" sizes="(max-width: 951px) 100vw, 951px" /></a><p class="wp-caption-text">Figure 5 – Example of a request sent to the C&amp;C server by the RC2FM module</p></div>
<p>After successfully registering the victim with the C&amp;C server, additional data are downloaded, which are to be interpreted on the local computer as backdoor commands.</p>
<h2>Capabilities</h2>
<p><span style="font-family: courier new, courier, monospace;">RC2FM</span> supports commands for listing basic system information and performing simple changes on the system, but also includes a few spyware features. When required by the attacker, it is capable of remotely activating the microphone on the compromised computer and capturing sounds. The audio recordings are encoded to MP3 format using a legitimate <span style="font-family: courier new, courier, monospace;">lame.dll</span> library, which is downloaded and misused by the malware.</p>
<p>Another way in which the malware can interfere with the victim’s privacy is by taking screenshots, which is another of the backdoor commands.</p>
<p>The malware also monitors all fixed and removable drives mapped on the local system. Whenever a new drive is inserted, it creates a list of all the files on the drive and stores it encrypted in a file.</p>
<p>All of the collected data can ultimately be sent to the attackers, when the appropriate command is issued.</p>
<h2>Backdoor commands</h2>
<p>Fifteen commands are supported, as listed below. The backdoor interpreter function is visualized in Figure 6.</p>
<p>&nbsp;</p>
<div style="height: 150px; overflow: auto;">

<table id="tablepress-556" class="tablepress tablepress-id-556">
<thead>
<tr class="row-1 odd">
	<th class="column-1"><stong>Command ID</strong></th><th class="column-2"><stong>Command description</strong></th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">0</td><td class="column-2">List information about mapped drives, list files in a folder, list network shares</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">2</td><td class="column-2">Create, move, rename, execute or delete a file, delete a directory using the specified path</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">4</td><td class="column-2">Open a file, set the file pointer to the file beginning</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">5</td><td class="column-2">Close a previously opened file</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">6</td><td class="column-2">Write data into a previously opened file</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">7</td><td class="column-2">Modify file times / delete a file</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">8</td><td class="column-2">Open a file, set the file pointer to the end of the file </td>
</tr>
<tr class="row-9 odd">
	<td class="column-1">10</td><td class="column-2">Modify file times / delete a file</td>
</tr>
<tr class="row-10 even">
	<td class="column-1">12</td><td class="column-2">Search files by supplied file mask in a specified directory</td>
</tr>
<tr class="row-11 odd">
	<td class="column-1">13</td><td class="column-2">Take a screenshot</td>
</tr>
<tr class="row-12 even">
	<td class="column-1">14</td><td class="column-2">Upload or modify files with internal data</td>
</tr>
<tr class="row-13 odd">
	<td class="column-1">15</td><td class="column-2">Record sound using input audio devices, list available devices, send recordings, change configuration</td>
</tr>
<tr class="row-14 even">
	<td class="column-1">16</td><td class="column-2">Check whether this module currently has any files open</td>
</tr>
<tr class="row-15 odd">
	<td class="column-1">17</td><td class="column-2">Update list of C&amp;C servers</td>
</tr>
<tr class="row-16 even">
	<td class="column-1">19</td><td class="column-2">Create, set, copy, enumerate or delete the specified registry keys or values</td>
</tr>
</tbody>
</table>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</div>
<p>&nbsp;</p>
<div id="attachment_112814" style="width: 638px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/06/6A_6B.png"><img class="size-full wp-image-112814" src="/wp-content/uploads/2018/06/6A_6B.png" alt="" width="628" height="322" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/06/6A_6B.png 628w, https://www.welivesecurity.com/wp-content/uploads/2018/06/6A_6B-300x154.png 300w" sizes="(max-width: 628px) 100vw, 628px" /></a><p class="wp-caption-text">Figure 6 – Backdoor interpreter function (original and after our analysis, changed using Group Nodes functionality of IDA Pro for better readability)</p></div>
<h2>Module RC2CL</h2>
<p>The<span style="font-family: courier new, courier, monospace;"> RC2CL</span> module is also a backdoor with extensive spying capabilities. It is started by the wrapper DLL, launched at the same time as the <span style="font-family: courier new, courier, monospace;">RC2FM</span> module. This one is more complex and offers features for collecting as much data about the infected computer as possible, rather than for making system changes.</p>
<p>Interestingly, there is an option in the <span style="font-family: courier new, courier, monospace;">RC2CL</span> module to turn off its backdoor functionality and act as a proxy. In this case, the malware turns off the Windows firewall and creates a server that relays communication between a client and C&amp;C server, or between two clients.</p>
<h2>Network communication</h2>
<p>The malware communicates with its C&amp;C servers through a TCP socket. Messages sent from a client mimic the HTTP protocol, but note the invalid &#8220;HIDE&#8221; HTTP verb in the example in Figure 7.</p>
<p>These requests comprise an identifier of the compromised PC, the request type, and encrypted data that are to be sent to the attackers, i.e. the results of the backdoor commands or appeals for further instructions.</p>
<div id="attachment_112815" style="width: 961px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/06/7.png"><img class="size-full wp-image-112815" src="/wp-content/uploads/2018/06/7.png" alt="" width="951" height="502" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/06/7.png 951w, https://www.welivesecurity.com/wp-content/uploads/2018/06/7-300x158.png 300w, https://www.welivesecurity.com/wp-content/uploads/2018/06/7-768x405.png 768w" sizes="(max-width: 951px) 100vw, 951px" /></a><p class="wp-caption-text">Figure 7 – Example of a request sent to the C&amp;C server by the RC2CL module</p></div>
<h2>Capabilities</h2>
<p>Depending on the commands received, the backdoor can perform various actions on the infected computer. Common backdoors often support commands such as file system operations, file execution, registry key manipulation or remote shell activation. This spyware supports all of these instructions and a whole lot more – its 84 commands provide the attackers with all they need to look at their victims more closely.</p>
<p>The malware can inspect the infected computer and provide various data, from system information such as lists of active processes, running services, loaded drivers or available drives, to networking information, including the IP forward table and the speed of the internet connection.</p>
<p>InvisiMole is capable of scanning enabled wireless networks on the compromised system. It records information such as the SSID and MAC address of the visible Wi-Fi access points. These data can then be compared to public databases, letting the attackers track the geolocation of the victim.</p>
<p>Other commands can provide information about the users of the compromised machine, their accounts and previous sessions.</p>
<p>The software installed on the compromised computer is of particular interest. Which programs are installed on the system? Which of them are executed automatically at each system start or user logon? Which programs are used by a particular user? If the attackers are interested, they are only one command away from these valuable data.</p>
<p>The malware can be instructed to search for recently-used documents or other interesting files. It can monitor specific directories and removable devices, report any changes and exfiltrate files of the attackers’ choice.</p>
<p>The malware may enable or disable the User Account Control (UAC), or even bypass the UAC and work with the files in secure locations without having administrator privileges (see more at <a href="https://wikileaks.org/ciav7p1/cms/page_3375231.html" target="_blank" rel="noopener">https://wikileaks.org/ciav7p1/cms/page_3375231.html</a>). If the malware is running under the <span style="font-family: courier new, courier, monospace;">explorer.exe</span> process, which is auto-elevated, it can create an elevated COM object and use it to delete or move files in locations that require admin rights.</p>
<p>What is even more disturbing is that it can remotely activate the victim’s webcam and microphone and spy on the victim by taking pictures and recording sound. Screen activity can be monitored by capturing screenshots. What is particularly interesting about InvisiMole is that not only are the usual “whole display” screenshots taken – it can separately capture each window, which helps the attackers gain more information even when the windows are overlapped.</p>
<p>Further, one of the backdoor commands is used to replace the contents of drivers with the following names:</p>
<ul>
<li><span style="font-family: courier new, courier, monospace;">blbdrive.sys</span></li>
<li><span style="font-family: courier new, courier, monospace;">compbatt.sys</span></li>
<li><span style="font-family: courier new, courier, monospace;">secdrv.sys</span></li>
</ul>
<p>We have not observed the attackers actually using this command but we can speculate that it does so to achieve additional persistence on 32-bit systems.</p>
<p>Though the backdoor is capable of interfering with the system (e.g. to log off a user, terminate a process or shut down the system), it mostly provides passive operations. Whenever possible, it tries to hide its activities.</p>
<p>For instance, the malware sniffs around interesting places on the system, reads recent documents or even modifies some files. This leaves traces on the system and could raise the victim&#8217;s suspicions as the time of the last access or modification of the files is changed with each such activity. To prevent this, the malware always restores the original file access or modification times, so that the user is unaware of its operation.</p>
<p>Another example of how the malware authors attempt to act covertly is the way they treat traces left on the disk. The malware collects loads of sensitive data, which are then temporarily stored in files and deleted after they have been successfully uploaded to the C&amp;C servers. Even the deleted files can, however, be recovered by an experienced system administrator, which could help further investigation of the attack – after the victim becomes aware of it. This is possible due to the fact that some data still reside on a disk even after a file is deleted. To prevent this, the malware has the ability to safe-delete all the files, which means it first overwrites the data in a file with zeroes or random bytes, and only then is the file deleted.</p>
<h2>Internal storage</h2>
<p>The backdoor configuration and the data collected are stored in one of two places – a working directory and working registry keys. A substantial portion of the backdoor command set is dedicated to manipulating these storage locations and their contents.</p>
<p>The location of the working directory is determined by the instructions from the remote server. The directory is used as temporary storage for files containing collected data about the compromised computer. Such files share a common naming convention, encryption algorithm and structure. They are encrypted by a simple variation of the XOR cipher which is used across the malware components. The type of the file can be derived from the 4-byte control sequences placed at the beginning of the file.</p>
<p>Besides being a storehouse for the gathered data, the working directory is also home to a copy of the legitimate WinRAR.exe application. This is copied by the malware and abused by the attackers for compressing the data that are to be exfiltrated.</p>
<p>The working registry keys store configuration data, as well as a list of files in the working directory. The data are packed using a Zlib routine implemented in the malware binary and encrypted with the same cipher as the internal files.</p>
<div style="height: 150px; overflow: auto;">

<table id="tablepress-557" class="tablepress tablepress-id-557">
<thead>
<tr class="row-1 odd">
	<th class="column-1"><strong>Subdirectory name</strong></th><th class="column-2"><strong>File name</strong></th><th class="column-3"><strong>Control sequences</strong></th><th class="column-4"><strong>File content</strong></th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">\</td><td class="column-2">~mrc_%random%.tmp</td><td class="column-3">932101DA</td><td class="column-4">Audio recordings</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">\</td><td class="column-2">~src_%random%.tmp</td><td class="column-3">958901DA</td><td class="column-4">Audio recordings</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">\</td><td class="column-2">~wbc_%random%.tmp</td><td class="column-3">938901DA</td><td class="column-4">Webcam photos</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">sc\</td><td class="column-2">~sc%random%.tmp</td><td class="column-3">DFE43A08</td><td class="column-4">Screenshots</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">~zlp\</td><td class="column-2">zdf_%random%.data</td><td class="column-3">B1CBF218</td><td class="column-4">Zlib-compressed packages</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">~lcf\</td><td class="column-2">tfl_%random%</td><td class="column-3">C0AFF208</td><td class="column-4">Internal data</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">fl_%timestamp%\strcn%num%\</td><td class="column-2">fdata.dat</td><td class="column-3">A1CAF108</td><td class="column-4">Data from removable drives</td>
</tr>
<tr class="row-9 odd">
	<td class="column-1">fl_%timestamp%\strcn%num%\</td><td class="column-2">index.dat</td><td class="column-3">BAAB0019</td><td class="column-4">Data from removable drives</td>
</tr>
<tr class="row-10 even">
	<td class="column-1">Winrar\</td><td class="column-2">WinRAR.exe</td><td class="column-3">-</td><td class="column-4">Copy of a legitimate application</td>
</tr>
<tr class="row-11 odd">
	<td class="column-1">Winrar\</td><td class="column-2">comment.txt</td><td class="column-3">-</td><td class="column-4">-</td>
</tr>
<tr class="row-12 even">
	<td class="column-1">Winrar\</td><td class="column-2">descript.ion</td><td class="column-3">-</td><td class="column-4">-</td>
</tr>
<tr class="row-13 odd">
	<td class="column-1">Winrar\</td><td class="column-2">Default.SFX</td><td class="column-3">-</td><td class="column-4">-</td>
</tr>
<tr class="row-14 even">
	<td class="column-1">Winrar\</td><td class="column-2">main.ico </td><td class="column-3">-</td><td class="column-4">-</td>
</tr>
</tbody>
</table>

</div>
<h2>Backdoor commands</h2>
<p>The backdoor provides more than eighty commands that utilize the working directory and registry keys to store their intermediate results and configuration data. The graph of the backdoor interpreter is shown in Figure 8.</p>
<p>Approximately a third of the commands are dedicated to reading and updating the configuration data stored in the registry. The rest of the commands are listed in the table below.</p>
<div style="height: 150px; overflow: auto;">

<table id="tablepress-558" class="tablepress tablepress-id-558">
<thead>
<tr class="row-1 odd">
	<th class="column-1"><strong>Command ID(s)</strong></th><th class="column-2"><strong>Command description</strong></th>
</tr>
</thead>
<tbody class="row-hover">
<tr class="row-2 even">
	<td class="column-1">4</td><td class="column-2">List information about files in a directory</td>
</tr>
<tr class="row-3 odd">
	<td class="column-1">6</td><td class="column-2">Upload a file</td>
</tr>
<tr class="row-4 even">
	<td class="column-1">20</td><td class="column-2">List information about active processes</td>
</tr>
<tr class="row-5 odd">
	<td class="column-1">22</td><td class="column-2">Terminate a process by ID</td>
</tr>
<tr class="row-6 even">
	<td class="column-1">24</td><td class="column-2">Execute a file</td>
</tr>
<tr class="row-7 odd">
	<td class="column-1">26</td><td class="column-2">Delete a file</td>
</tr>
<tr class="row-8 even">
	<td class="column-1">28</td><td class="column-2">Get the IP forward table</td>
</tr>
<tr class="row-9 odd">
	<td class="column-1">30</td><td class="column-2">Write data to a file</td>
</tr>
<tr class="row-10 even">
	<td class="column-1">31</td><td class="column-2">Sleep</td>
</tr>
<tr class="row-11 odd">
	<td class="column-1">38</td><td class="column-2">List account information</td>
</tr>
<tr class="row-12 even">
	<td class="column-1">40</td><td class="column-2">List information about services on the system</td>
</tr>
<tr class="row-13 odd">
	<td class="column-1">42</td><td class="column-2">List information about loaded drivers</td>
</tr>
<tr class="row-14 even">
	<td class="column-1">43</td><td class="column-2">Collect basic system information (computer name, OS version, memory status, local time, drive information, configured proxy information, system and process DEP policy…)</td>
</tr>
<tr class="row-15 odd">
	<td class="column-1">44</td><td class="column-2">List installed software</td>
</tr>
<tr class="row-16 even">
	<td class="column-1">46</td><td class="column-2">List local users and session information</td>
</tr>
<tr class="row-17 odd">
	<td class="column-1">48</td><td class="column-2">List applications accessed by users</td>
</tr>
<tr class="row-18 even">
	<td class="column-1">52</td><td class="column-2">Create a directory structure</td>
</tr>
<tr class="row-19 odd">
	<td class="column-1">78</td><td class="column-2">Create a remote shell</td>
</tr>
<tr class="row-20 even">
	<td class="column-1">81</td><td class="column-2">Execute a command via a remote shell</td>
</tr>
<tr class="row-21 odd">
	<td class="column-1">91</td><td class="column-2">Enable/disable UAC</td>
</tr>
<tr class="row-22 even">
	<td class="column-1">93</td><td class="column-2">Log off the user/shutdown/restart the system</td>
</tr>
<tr class="row-23 odd">
	<td class="column-1">101</td><td class="column-2">Monitor and record changes in the specified directories</td>
</tr>
<tr class="row-24 even">
	<td class="column-1">103</td><td class="column-2">Delete directories</td>
</tr>
<tr class="row-25 odd">
	<td class="column-1">109</td><td class="column-2">Turn the monitor on/off/onto standby</td>
</tr>
<tr class="row-26 even">
	<td class="column-1">120</td><td class="column-2">Capture screenshots of the display/active windows</td>
</tr>
<tr class="row-27 odd">
	<td class="column-1">126</td><td class="column-2">Capture screenshots of the display/active windows &amp; update configuration data</td>
</tr>
<tr class="row-28 even">
	<td class="column-1">130</td><td class="column-2">List information about resources on unmapped drives</td>
</tr>
<tr class="row-29 odd">
	<td class="column-1">132</td><td class="column-2">Rename/move a file, modify create/access/write times of the file to the given values</td>
</tr>
<tr class="row-30 even">
	<td class="column-1">134</td><td class="column-2">List information about recently opened files</td>
</tr>
<tr class="row-31 odd">
	<td class="column-1">152</td><td class="column-2">Disconnect (previously connected) remote drives</td>
</tr>
<tr class="row-32 even">
	<td class="column-1">155</td><td class="column-2">Create/delete a registry key, set/delete a registry key value, or enumerate registry values/keys/data </td>
</tr>
<tr class="row-33 odd">
	<td class="column-1">159, 161</td><td class="column-2">Disable routing/firewall, create a proxy server on a specified port</td>
</tr>
<tr class="row-34 even">
	<td class="column-1">172</td><td class="column-2">Repeatedly display a dialog requesting the user to reboot the computer</td>
</tr>
<tr class="row-35 odd">
	<td class="column-1">175</td><td class="column-2">Bypass UAC to manipulate a file</td>
</tr>
<tr class="row-36 even">
	<td class="column-1">177</td><td class="column-2">Create and write a file, set the create/access/modify times</td>
</tr>
<tr class="row-37 odd">
	<td class="column-1">181</td><td class="column-2">Remove all system restore points</td>
</tr>
<tr class="row-38 even">
	<td class="column-1">183</td><td class="column-2">Drop (legitimate) WinRAR components</td>
</tr>
<tr class="row-39 odd">
	<td class="column-1">185</td><td class="column-2">Add files to a password-protected archive (password = "12KsNh92Dwd")</td>
</tr>
<tr class="row-40 even">
	<td class="column-1">187</td><td class="column-2">Decrypt, unpack and load a DLL, load executables from its resources RC2CL, RC2FM</td>
</tr>
<tr class="row-41 odd">
	<td class="column-1">189</td><td class="column-2">Create a system restore point</td>
</tr>
<tr class="row-42 even">
	<td class="column-1">191</td><td class="column-2">Extract a password-protected archive (12KsNh92Dwd)</td>
</tr>
<tr class="row-43 odd">
	<td class="column-1">193</td><td class="column-2">Modify an encrypted file</td>
</tr>
<tr class="row-44 even">
	<td class="column-1">195</td><td class="column-2">Restart itself after the primary process finishes</td>
</tr>
<tr class="row-45 odd">
	<td class="column-1">197</td><td class="column-2">Send 198 bytes of data hardcoded in the sample</td>
</tr>
<tr class="row-46 even">
	<td class="column-1">199</td><td class="column-2">Rename/move a file</td>
</tr>
<tr class="row-47 odd">
	<td class="column-1">206</td><td class="column-2">Decrypt, unpack and load a DLL, load executables from its resources RC2CL, RC2FM</td>
</tr>
<tr class="row-48 even">
	<td class="column-1">211</td><td class="column-2">Upload collected information (captured screenshots, audio recordings, etc.)</td>
</tr>
<tr class="row-49 odd">
	<td class="column-1">213</td><td class="column-2">List information about active windows</td>
</tr>
<tr class="row-50 even">
	<td class="column-1">218</td><td class="column-2">API for recording input audio devices</td>
</tr>
<tr class="row-51 odd">
	<td class="column-1">220</td><td class="column-2">API for capturing webcam photos</td>
</tr>
<tr class="row-52 even">
	<td class="column-1">224</td><td class="column-2">List files executed with each system start</td>
</tr>
<tr class="row-53 odd">
	<td class="column-1">226</td><td class="column-2">List information about enabled wireless networks (MAC address, SSID, beacon interval)</td>
</tr>
<tr class="row-54 even">
	<td class="column-1">228</td><td class="column-2">Drop a Zlib-compressed package</td>
</tr>
</tbody>
</table>

</div>
<p>&nbsp;</p>
<p><a href="/wp-content/uploads/2018/06/8a.png"><img class="aligncenter size-full wp-image-112818" src="/wp-content/uploads/2018/06/8a.png" alt="" width="1811" height="707" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/06/8a.png 1811w, https://www.welivesecurity.com/wp-content/uploads/2018/06/8a-300x117.png 300w, https://www.welivesecurity.com/wp-content/uploads/2018/06/8a-768x300.png 768w, https://www.welivesecurity.com/wp-content/uploads/2018/06/8a-1024x400.png 1024w" sizes="(max-width: 1811px) 100vw, 1811px" /></a></p>
<div id="attachment_112819" style="width: 1326px" class="wp-caption aligncenter"><a href="/wp-content/uploads/2018/06/8b.png"><img class=" wp-image-112819" src="/wp-content/uploads/2018/06/8b.png" alt="" width="1316" height="427" srcset="https://www.welivesecurity.com/wp-content/uploads/2018/06/8b.png 1534w, https://www.welivesecurity.com/wp-content/uploads/2018/06/8b-300x97.png 300w, https://www.welivesecurity.com/wp-content/uploads/2018/06/8b-768x249.png 768w, https://www.welivesecurity.com/wp-content/uploads/2018/06/8b-1024x332.png 1024w" sizes="(max-width: 1316px) 100vw, 1316px" /></a><p class="wp-caption-text">Figure 8 – Backdoor interpreter function (original and after our analysis, changed using Group Nodes functionality of IDA Pro for better readability)</p></div>
<h2>Conclusion</h2>
<p>InvisiMole is fully-equipped spyware whose rich capabilities can surely compete with other espionage tools seen in the wild.</p>
<p>We can only wonder why the authors decided to use two modules with overlapping capabilities. One might think the smaller module, <span style="font-family: courier new, courier, monospace;">RC2FM</span>, is used as an initial reconnaissance tool, while the bigger <span style="font-family: courier new, courier, monospace;">RC2CL</span> module is only run on interesting targets. This is, however, not the case – both of the modules are launched simultaneously. Another possible explanation is that the modules might have been crafted by various authors and then bundled together to provide the malware operators a more complex range of functionalities.</p>
<p>The malware uses only a few techniques to avoid detection and analysis, yet, deployed against a very small number of high-value targets, it was able to stay under the radar for at least five years.</p>
<h2>Indicators of Compromise (IoCs)</h2>
<div style="height: 150px; overflow: auto;">
<p>A full and comprehensive list of IoCs, C&amp;C servers, along with registry keys and values can be <a href="https://github.com/eset/malware-ioc/tree/master/invisimole" target="_blank" rel="noopener">found on GitHub.</a></p>
</div>

                            
                                                            <div class="dot">
                                    <span class="icomoon icon-icon_article_dot"></span>
                                </div>

                                <div class="meta">
                                    <div class="wls-authors wls-authors-footer">
                                                <div class="wls-author">
                        <div class="wls-author-name">
                <a href="https://www.welivesecurity.com/author/zhromcova/" title="Zuzana Hromcová">
                    Zuzana Hromcová                </a>
            </div>
        </div>
                                            </div>
                                    <span class="strong">
								        <time datetime="2018-06-07 15:00:40">7 Jun 2018 - 03:00PM</time>
                                    </span>
                                </div>
                            
                            <div class="widgets row">
                                <div class="col-md-12 col-sm-12 col-xs-12">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12 no-padding">
                                        <h3><span class="text">Newsletter</span></h3>
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-6 col-xs-12 newsletter-wrapper">
                                    			
		<div class="heading-line col-md-12 no-padding sidebar-item clearfix">
			<h3>
				<span class="text">Newsletter</span>
			</h3>

			<form action="//liondigital.us3.list-manage.com/subscribe/post?u=b76f82b1cc198ab1d80665c99&amp;id=102b0810e2" class="basic-searchform col-md-12 col-sm-12 col-xs-12 no-padding newsletter" method="post" role="search">
				<div class="search-input clearfix">
					<input type="text" name="email" value="" placeholder="Email...">
					<button>
						Submit					</button>
				</div>
			</form>		
		</div>
                                </div>
                            </div>

                                                            <div class="similar-articles row">
                                    <div class="heading-line col-md-12 col-sm-12 col-xs-12">
                                        <h3><span class="text">Similar Articles</span></h3>
                                    </div>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/spyware/" class="category-tag-btn">spyware</a>                                                <a href="https://www.welivesecurity.com/2018/01/23/guide-makes-possible-peek-finfisher/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2018/01/Le-guide-ESET-permet-de-jeter-un-coup-doeil-sur-FinFisher.jpg"
                                                         alt="InvisiMole: Surprisingly equipped spyware, undercover since 2013">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2018/01/23/guide-makes-possible-peek-finfisher/">
                                                    ESET’s guide makes it possible to peek into FinFisher                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/spyware/" class="category-tag-btn">spyware</a>                                                <a href="https://www.welivesecurity.com/2017/12/08/strongpity-like-spyware-replaces-finfisher/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2017/12/Computer_Spyware-623x432-1.jpg"
                                                         alt="InvisiMole: Surprisingly equipped spyware, undercover since 2013">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2017/12/08/strongpity-like-spyware-replaces-finfisher/">
                                                    StrongPity2 spyware replaces FinFisher in MitM campaign – ISP involved?                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/spyware/" class="category-tag-btn">spyware</a>                                                <a href="https://www.welivesecurity.com/2017/09/21/new-finfisher-surveillance-campaigns/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2017/09/internet_surveillance-623x432.jpg"
                                                         alt="InvisiMole: Surprisingly equipped spyware, undercover since 2013">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2017/09/21/new-finfisher-surveillance-campaigns/">
                                                    New FinFisher surveillance campaigns: Internet providers involved?                                                </a>
                                            </h4>
                                        </article>
                                                                            <article class="col-md-3 col-sm-3 col-xs-3">
                                            <div class="img-wrapper">
                                                <a href="https://www.welivesecurity.com/category/malware/" class="category-tag-btn">Malware</a>                                                <a href="https://www.welivesecurity.com/2017/02/17/8-things-know-spyware/"
                                                   class="related-article-thumb">
                                                    <img class="col-xs-12 no-padding clickable"
                                                         src="https://www.welivesecurity.com/wp-content/uploads/2019/10/spyware-623x432.jpg"
                                                         alt="InvisiMole: Surprisingly equipped spyware, undercover since 2013">
                                                </a>
                                            </div>
                                            <h4>
                                                <a href="https://www.welivesecurity.com/2017/02/17/8-things-know-spyware/">
                                                    8 things you should know about spyware                                                </a>
                                            </h4>
                                        </article>
                                                                    </div>
                            
                            <div class="comments row">
                                <div class="heading-line col-xs-12">
                                    <h3><span class="text">Discussion</span></h3>
                                                                            
<div id="disqus_thread"></div>
                                                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    	</div> 	<footer id="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-md-2">
                    <div class="hidden-sm hidden-xs">
                        <div class="logo-wrapper footer clearfix">
                            <div class="dark clearfix">
                                <a href="https://www.welivesecurity.com/" class="wls">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-1.svg" alt="Welivesecurity.com">
                                </a>
                                <a href="https://www.eset.com" class="eset">
                                    <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-footer-2.svg" alt="by ESET">
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="hidden-lg hidden-md">
                        <div class="logo-wrapper clearfix">
    <div class="dark clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-dark-header-2.svg" alt="by ESET">
        </a>
    </div>
    <div class="light clearfix">
        <a href="https://www.welivesecurity.com/" class="wls">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-1.svg" alt="Welivesecurity.com">
        </a>
        <a href="https://www.eset.com" class="eset">
            <img src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/img/new-logo/eset-wls-light-header-2.svg" alt="by ESET">
        </a>
    </div>
</div>                    </div>
				</div>
				<nav id="footer" class="clearfix">
											<div class="mobile-block">
																<div class="col-md-2 col-md-offset-2">
										<ul>
																							<li>
													<a href="/">Home</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/about-us/">About Us</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/contact-us/">Contact Us</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/sitemap/">Sitemap</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/our-experts/">Our Experts</a>
												</li>
																							<li>
													<a href="https://eset.com">ESET</a>
												</li>
																					</ul>
									</div>
													</div>
											<div class="mobile-block">
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/research/">Research</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/category/how-to/">How To</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/categories/">Categories</a>
												</li>
																					</ul>
									</div>
																<div class="col-md-2 ">
										<ul>
																							<li>
													<a href="https://www.welivesecurity.com/rss-configurator/">RSS Configurator</a>
												</li>
																							<li>
													<a href="https://www.welivesecurity.com/news-widget-generator/">News Widget</a>
												</li>
																					</ul>
									</div>
													</div>
									</nav>
			</div>
			<div class="row">
				<div class="col-md-12 legal clearfix">
					<div class="wrap clearfix">
													<span>
								<a href="https://www.welivesecurity.com/privacy/">
									Privacy policy								</a>
							</span>
													<span>
								<a href="https://www.welivesecurity.com/legal-information/">
									Legal Information								</a>
							</span>
											</div>
					<span class="copyright pull-right">Copyright &copy; ESET, All Rights Reserved</span>
				</div>
							</div>
		</div>
	</footer>
	
	<button id="back-to-top" class="animated-scroll" data-target="absoluteTop">
		<span class="icomoon icon-icon_arrow"></span>
		<span class="text">Back to top</span>
	</button>

			<div class="social-wrapper-mobile hidden-lg hidden-md hidden-sm" id="mobile-article-sharer">
			<div class="col-xs-12">
				<div class="icons" style="text-align: center;">
											<a class="share-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F06%2F07%2Finvisimole-equipped-spyware-undercover%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Facebook">
							<span class="icomoon icon-icon_fb"></span>
						</a>
											<a class="share-twitter" href="https://twitter.com/intent/tweet?https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F06%2F07%2Finvisimole-equipped-spyware-undercover%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Twitter">
							<span class="icomoon icon-icon_tw"></span>
						</a>
											<a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.welivesecurity.com%2F2018%2F06%2F07%2Finvisimole-equipped-spyware-undercover%2F" target="blank" data-toggle="tooltip" data-placement="top" data-original-title="Share on Linkedin">
							<span class="icomoon icon-icon_in"></span>
						</a>
									</div>
			</div>
		</div>
	
	<script>
		var baseUrl = "https://www.welivesecurity.com/";
	</script>
	
			<script>
            !function(){if(-1==window.document.cookie.indexOf("user_rec=1")){function e(e,o){var t=document.createElement("img");t.setAttribute("style","display:none"),t.src=e+o,window.document.body.appendChild(t)}function o(){d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Default%20status&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=defaultStatus&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c)}function t(){console.log("GA and GTM are loaded."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=11",e(u,a),e(s,c)}function n(){var e=new Date;e.setTime(e.getTime()+63072e6);var o="expires="+e.toUTCString();window.document.cookie="user_rec=1; "+o+"; path=/"}var d,a,c,i,r,l="UA-76266002-27",g=window.location.href,s="https://cdn1.esetstatic.com/ESET/INT/assets/img/check.png",u="https://www.google-analytics.com/collect",w="wls",m=0,h=function e(){i=window.ga&&ga.create?1:0,r=window.google_tag_manager?1:0,m++,console.log("Timer: ",m),h=setTimeout(e,500)};window.document.addEventListener&&(d=1e6*Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=Script%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=scriptLoaded&z="+Math.floor(1e6*Math.random(0,1)),e(u,a),e(s,c),window.addEventListener("beforeunload",o),window.ga&&ga.create&&window.google_tag_manager?(t(),window.removeEventListener("beforeunload",o),n()):(setTimeout(h,500),setTimeout(function(){clearTimeout(h),i&&r?t():i&&!r?(console.log("GA is loaded and GTM is blocked."),d=ga.getAll()[0].get("clientId"),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20loaded,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=10",e(u,a),e(s,c)):!i&&r?(console.log("GA is blocked and GTM is loaded."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20loaded&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=01",e(u,a),e(s,c)):i||r||(console.log("GA is blocked and GTM is blocked."),d||Math.random(1e6,9999999),a="?v=1&cid="+d+"&tid="+l+"&dl="+g+"&t=event&ec=Tracking%20check%20-%20recurring&ea=GA%20blocked,%20GTM%20blocked&ni=1&cd1="+w+"&aip=1&z="+Math.floor(1e6*Math.random(0,1)),c="?country=wls&gcode=00",e(u,a),e(s,c)),window.removeEventListener("beforeunload",o),n()},1e4)))}}();
		</script>
	
	<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/build/js/main-0ba0c3843d.js"></script>
    <!-- Version: v1.1.76.32619db9.pro-awus -->
    		<script type="text/javascript">
			var disqus_config = function () { 
				this.language = "en";
			};
			var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":"", "numsVisible": false};
			var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
		</script>
		<script src="https://www.welivesecurity.com/wp-content/themes/eset-wls-2018/assets/static/js/crayon.min.js"></script>

			
		
    <script>
    	Main.init();
    </script>

    <script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"welivesecurity"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_count.js?ver=3.0.16'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"112766 https:\/\/ba-infohub-web01-v.hq.eset.com\/?p=112766","disqusShortname":"welivesecurity","disqusTitle":"InvisiMole: Surprisingly equipped spyware, undercover since 2013","disqusUrl":"https:\/\/www.welivesecurity.com\/2018\/06\/07\/invisimole-equipped-spyware-undercover\/","postId":"112766"};
/* ]]> */
</script>
<script type='text/javascript' src='https://www.welivesecurity.com/wp-content/plugins/disqus-comment-system/public/js/comment_embed.js?ver=3.0.16'></script>
    <script src="https://assets.esetstatic.com/3PR/app.min.js"></script>
  </body>
</html>